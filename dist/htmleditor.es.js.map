{"version":3,"file":"htmleditor.es.js","sources":["../node_modules/react/cjs/react-jsx-runtime.production.js","../node_modules/react/cjs/react-jsx-runtime.development.js","../node_modules/react/jsx-runtime.js","../src/store/slices/documentSlice.js","../src/hooks/useFormatting.js","../src/hooks/useContinuousReflow.js","../src/components/editor/Sidebar.jsx","../src/lib/storage/local-storage.js","../src/lib/editor/utils/logger.js","../src/components/editor/EditorToolbar.jsx","../src/components/editor/ContinuousPageView.jsx","../src/components/editor/PageManager.jsx","../src/components/editor/ContentEditableEditor.jsx","../src/index.js"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\nvar REACT_ELEMENT_TYPE = Symbol.for(\"react.transitional.element\"),\n  REACT_FRAGMENT_TYPE = Symbol.for(\"react.fragment\");\nfunction jsxProd(type, config, maybeKey) {\n  var key = null;\n  void 0 !== maybeKey && (key = \"\" + maybeKey);\n  void 0 !== config.key && (key = \"\" + config.key);\n  if (\"key\" in config) {\n    maybeKey = {};\n    for (var propName in config)\n      \"key\" !== propName && (maybeKey[propName] = config[propName]);\n  } else maybeKey = config;\n  config = maybeKey.ref;\n  return {\n    $$typeof: REACT_ELEMENT_TYPE,\n    type: type,\n    key: key,\n    ref: void 0 !== config ? config : null,\n    props: maybeKey\n  };\n}\nexports.Fragment = REACT_FRAGMENT_TYPE;\nexports.jsx = jsxProd;\nexports.jsxs = jsxProd;\n","/**\n * @license React\n * react-jsx-runtime.development.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\n\"production\" !== process.env.NODE_ENV &&\n  (function () {\n    function getComponentNameFromType(type) {\n      if (null == type) return null;\n      if (\"function\" === typeof type)\n        return type.$$typeof === REACT_CLIENT_REFERENCE\n          ? null\n          : type.displayName || type.name || null;\n      if (\"string\" === typeof type) return type;\n      switch (type) {\n        case REACT_FRAGMENT_TYPE:\n          return \"Fragment\";\n        case REACT_PROFILER_TYPE:\n          return \"Profiler\";\n        case REACT_STRICT_MODE_TYPE:\n          return \"StrictMode\";\n        case REACT_SUSPENSE_TYPE:\n          return \"Suspense\";\n        case REACT_SUSPENSE_LIST_TYPE:\n          return \"SuspenseList\";\n        case REACT_ACTIVITY_TYPE:\n          return \"Activity\";\n      }\n      if (\"object\" === typeof type)\n        switch (\n          (\"number\" === typeof type.tag &&\n            console.error(\n              \"Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue.\"\n            ),\n          type.$$typeof)\n        ) {\n          case REACT_PORTAL_TYPE:\n            return \"Portal\";\n          case REACT_CONTEXT_TYPE:\n            return (type.displayName || \"Context\") + \".Provider\";\n          case REACT_CONSUMER_TYPE:\n            return (type._context.displayName || \"Context\") + \".Consumer\";\n          case REACT_FORWARD_REF_TYPE:\n            var innerType = type.render;\n            type = type.displayName;\n            type ||\n              ((type = innerType.displayName || innerType.name || \"\"),\n              (type = \"\" !== type ? \"ForwardRef(\" + type + \")\" : \"ForwardRef\"));\n            return type;\n          case REACT_MEMO_TYPE:\n            return (\n              (innerType = type.displayName || null),\n              null !== innerType\n                ? innerType\n                : getComponentNameFromType(type.type) || \"Memo\"\n            );\n          case REACT_LAZY_TYPE:\n            innerType = type._payload;\n            type = type._init;\n            try {\n              return getComponentNameFromType(type(innerType));\n            } catch (x) {}\n        }\n      return null;\n    }\n    function testStringCoercion(value) {\n      return \"\" + value;\n    }\n    function checkKeyStringCoercion(value) {\n      try {\n        testStringCoercion(value);\n        var JSCompiler_inline_result = !1;\n      } catch (e) {\n        JSCompiler_inline_result = !0;\n      }\n      if (JSCompiler_inline_result) {\n        JSCompiler_inline_result = console;\n        var JSCompiler_temp_const = JSCompiler_inline_result.error;\n        var JSCompiler_inline_result$jscomp$0 =\n          (\"function\" === typeof Symbol &&\n            Symbol.toStringTag &&\n            value[Symbol.toStringTag]) ||\n          value.constructor.name ||\n          \"Object\";\n        JSCompiler_temp_const.call(\n          JSCompiler_inline_result,\n          \"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.\",\n          JSCompiler_inline_result$jscomp$0\n        );\n        return testStringCoercion(value);\n      }\n    }\n    function getTaskName(type) {\n      if (type === REACT_FRAGMENT_TYPE) return \"<>\";\n      if (\n        \"object\" === typeof type &&\n        null !== type &&\n        type.$$typeof === REACT_LAZY_TYPE\n      )\n        return \"<...>\";\n      try {\n        var name = getComponentNameFromType(type);\n        return name ? \"<\" + name + \">\" : \"<...>\";\n      } catch (x) {\n        return \"<...>\";\n      }\n    }\n    function getOwner() {\n      var dispatcher = ReactSharedInternals.A;\n      return null === dispatcher ? null : dispatcher.getOwner();\n    }\n    function UnknownOwner() {\n      return Error(\"react-stack-top-frame\");\n    }\n    function hasValidKey(config) {\n      if (hasOwnProperty.call(config, \"key\")) {\n        var getter = Object.getOwnPropertyDescriptor(config, \"key\").get;\n        if (getter && getter.isReactWarning) return !1;\n      }\n      return void 0 !== config.key;\n    }\n    function defineKeyPropWarningGetter(props, displayName) {\n      function warnAboutAccessingKey() {\n        specialPropKeyWarningShown ||\n          ((specialPropKeyWarningShown = !0),\n          console.error(\n            \"%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)\",\n            displayName\n          ));\n      }\n      warnAboutAccessingKey.isReactWarning = !0;\n      Object.defineProperty(props, \"key\", {\n        get: warnAboutAccessingKey,\n        configurable: !0\n      });\n    }\n    function elementRefGetterWithDeprecationWarning() {\n      var componentName = getComponentNameFromType(this.type);\n      didWarnAboutElementRef[componentName] ||\n        ((didWarnAboutElementRef[componentName] = !0),\n        console.error(\n          \"Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.\"\n        ));\n      componentName = this.props.ref;\n      return void 0 !== componentName ? componentName : null;\n    }\n    function ReactElement(\n      type,\n      key,\n      self,\n      source,\n      owner,\n      props,\n      debugStack,\n      debugTask\n    ) {\n      self = props.ref;\n      type = {\n        $$typeof: REACT_ELEMENT_TYPE,\n        type: type,\n        key: key,\n        props: props,\n        _owner: owner\n      };\n      null !== (void 0 !== self ? self : null)\n        ? Object.defineProperty(type, \"ref\", {\n            enumerable: !1,\n            get: elementRefGetterWithDeprecationWarning\n          })\n        : Object.defineProperty(type, \"ref\", { enumerable: !1, value: null });\n      type._store = {};\n      Object.defineProperty(type._store, \"validated\", {\n        configurable: !1,\n        enumerable: !1,\n        writable: !0,\n        value: 0\n      });\n      Object.defineProperty(type, \"_debugInfo\", {\n        configurable: !1,\n        enumerable: !1,\n        writable: !0,\n        value: null\n      });\n      Object.defineProperty(type, \"_debugStack\", {\n        configurable: !1,\n        enumerable: !1,\n        writable: !0,\n        value: debugStack\n      });\n      Object.defineProperty(type, \"_debugTask\", {\n        configurable: !1,\n        enumerable: !1,\n        writable: !0,\n        value: debugTask\n      });\n      Object.freeze && (Object.freeze(type.props), Object.freeze(type));\n      return type;\n    }\n    function jsxDEVImpl(\n      type,\n      config,\n      maybeKey,\n      isStaticChildren,\n      source,\n      self,\n      debugStack,\n      debugTask\n    ) {\n      var children = config.children;\n      if (void 0 !== children)\n        if (isStaticChildren)\n          if (isArrayImpl(children)) {\n            for (\n              isStaticChildren = 0;\n              isStaticChildren < children.length;\n              isStaticChildren++\n            )\n              validateChildKeys(children[isStaticChildren]);\n            Object.freeze && Object.freeze(children);\n          } else\n            console.error(\n              \"React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.\"\n            );\n        else validateChildKeys(children);\n      if (hasOwnProperty.call(config, \"key\")) {\n        children = getComponentNameFromType(type);\n        var keys = Object.keys(config).filter(function (k) {\n          return \"key\" !== k;\n        });\n        isStaticChildren =\n          0 < keys.length\n            ? \"{key: someKey, \" + keys.join(\": ..., \") + \": ...}\"\n            : \"{key: someKey}\";\n        didWarnAboutKeySpread[children + isStaticChildren] ||\n          ((keys =\n            0 < keys.length ? \"{\" + keys.join(\": ..., \") + \": ...}\" : \"{}\"),\n          console.error(\n            'A props object containing a \"key\" prop is being spread into JSX:\\n  let props = %s;\\n  <%s {...props} />\\nReact keys must be passed directly to JSX without using spread:\\n  let props = %s;\\n  <%s key={someKey} {...props} />',\n            isStaticChildren,\n            children,\n            keys,\n            children\n          ),\n          (didWarnAboutKeySpread[children + isStaticChildren] = !0));\n      }\n      children = null;\n      void 0 !== maybeKey &&\n        (checkKeyStringCoercion(maybeKey), (children = \"\" + maybeKey));\n      hasValidKey(config) &&\n        (checkKeyStringCoercion(config.key), (children = \"\" + config.key));\n      if (\"key\" in config) {\n        maybeKey = {};\n        for (var propName in config)\n          \"key\" !== propName && (maybeKey[propName] = config[propName]);\n      } else maybeKey = config;\n      children &&\n        defineKeyPropWarningGetter(\n          maybeKey,\n          \"function\" === typeof type\n            ? type.displayName || type.name || \"Unknown\"\n            : type\n        );\n      return ReactElement(\n        type,\n        children,\n        self,\n        source,\n        getOwner(),\n        maybeKey,\n        debugStack,\n        debugTask\n      );\n    }\n    function validateChildKeys(node) {\n      \"object\" === typeof node &&\n        null !== node &&\n        node.$$typeof === REACT_ELEMENT_TYPE &&\n        node._store &&\n        (node._store.validated = 1);\n    }\n    var React = require(\"react\"),\n      REACT_ELEMENT_TYPE = Symbol.for(\"react.transitional.element\"),\n      REACT_PORTAL_TYPE = Symbol.for(\"react.portal\"),\n      REACT_FRAGMENT_TYPE = Symbol.for(\"react.fragment\"),\n      REACT_STRICT_MODE_TYPE = Symbol.for(\"react.strict_mode\"),\n      REACT_PROFILER_TYPE = Symbol.for(\"react.profiler\");\n    Symbol.for(\"react.provider\");\n    var REACT_CONSUMER_TYPE = Symbol.for(\"react.consumer\"),\n      REACT_CONTEXT_TYPE = Symbol.for(\"react.context\"),\n      REACT_FORWARD_REF_TYPE = Symbol.for(\"react.forward_ref\"),\n      REACT_SUSPENSE_TYPE = Symbol.for(\"react.suspense\"),\n      REACT_SUSPENSE_LIST_TYPE = Symbol.for(\"react.suspense_list\"),\n      REACT_MEMO_TYPE = Symbol.for(\"react.memo\"),\n      REACT_LAZY_TYPE = Symbol.for(\"react.lazy\"),\n      REACT_ACTIVITY_TYPE = Symbol.for(\"react.activity\"),\n      REACT_CLIENT_REFERENCE = Symbol.for(\"react.client.reference\"),\n      ReactSharedInternals =\n        React.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,\n      hasOwnProperty = Object.prototype.hasOwnProperty,\n      isArrayImpl = Array.isArray,\n      createTask = console.createTask\n        ? console.createTask\n        : function () {\n            return null;\n          };\n    React = {\n      react_stack_bottom_frame: function (callStackForError) {\n        return callStackForError();\n      }\n    };\n    var specialPropKeyWarningShown;\n    var didWarnAboutElementRef = {};\n    var unknownOwnerDebugStack = React.react_stack_bottom_frame.bind(\n      React,\n      UnknownOwner\n    )();\n    var unknownOwnerDebugTask = createTask(getTaskName(UnknownOwner));\n    var didWarnAboutKeySpread = {};\n    exports.Fragment = REACT_FRAGMENT_TYPE;\n    exports.jsx = function (type, config, maybeKey, source, self) {\n      var trackActualOwner =\n        1e4 > ReactSharedInternals.recentlyCreatedOwnerStacks++;\n      return jsxDEVImpl(\n        type,\n        config,\n        maybeKey,\n        !1,\n        source,\n        self,\n        trackActualOwner\n          ? Error(\"react-stack-top-frame\")\n          : unknownOwnerDebugStack,\n        trackActualOwner ? createTask(getTaskName(type)) : unknownOwnerDebugTask\n      );\n    };\n    exports.jsxs = function (type, config, maybeKey, source, self) {\n      var trackActualOwner =\n        1e4 > ReactSharedInternals.recentlyCreatedOwnerStacks++;\n      return jsxDEVImpl(\n        type,\n        config,\n        maybeKey,\n        !0,\n        source,\n        self,\n        trackActualOwner\n          ? Error(\"react-stack-top-frame\")\n          : unknownOwnerDebugStack,\n        trackActualOwner ? createTask(getTaskName(type)) : unknownOwnerDebugTask\n      );\n    };\n  })();\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","import { createSlice } from '@reduxjs/toolkit';\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\nconst DEFAULT_PAGE_SIZE = 'A4';\r\nconst EMPTY_PARAGRAPH = '<p><br></p>';\r\n\r\nconst createEmptyPage = (index, size = DEFAULT_PAGE_SIZE) => ({\r\n  id: uuidv4(),\r\n  index,\r\n  size,\r\n  content: EMPTY_PARAGRAPH,\r\n  images: [],\r\n  isBreakPoint: false\r\n});\r\n\r\nconst withMinimumPage = (pages, pageSize = DEFAULT_PAGE_SIZE) => {\r\n  const nextPages = pages.length > 0 ? pages : [createEmptyPage(0, pageSize)];\r\n  return nextPages.map((page, index) => ({\r\n    id: page.id || uuidv4(),\r\n    index,\r\n    size: page.size || pageSize,\r\n    content: sanitizeContent(page.content),\r\n    images: page.images || [],\r\n    isBreakPoint: Boolean(page.isBreakPoint)\r\n  }));\r\n};\r\n\r\nconst sanitizeContent = (html) => {\r\n  if (typeof html !== 'string' || html.trim() === '') {\r\n    return EMPTY_PARAGRAPH;\r\n  }\r\n  return html;\r\n};\r\n\r\nconst buildInitialState = (overrides = {}) => {\r\n  const now = new Date().toISOString();\r\n  const pageSize = overrides.pageSize || DEFAULT_PAGE_SIZE;\r\n  const pages = withMinimumPage(overrides.pages || [createEmptyPage(0, pageSize)], pageSize);\r\n\r\n  return {\r\n    id: uuidv4(),\r\n    title: overrides.title || 'Untitled Document',\r\n    createdAt: now,\r\n    updatedAt: now,\r\n    pageSize,\r\n    pages,\r\n    activePage: overrides.activePage && overrides.activePage < pages.length ? overrides.activePage : 0,\r\n    pageBreaks: overrides.pageBreaks || [],\r\n    totalPages: pages.length,\r\n    // Continuous mode state\r\n    editorMode: overrides.editorMode || 'continuous', // 'continuous' or 'paged'\r\n    continuousContent: overrides.continuousContent || EMPTY_PARAGRAPH,\r\n    pageBoundaries: overrides.pageBoundaries || []\r\n  };\r\n};\r\n\r\nconst initialState = buildInitialState();\r\n\r\nexport const documentSlice = createSlice({\r\n  name: 'document',\r\n  initialState,\r\n  reducers: {\r\n    initializeDocument: (state, action) => {\r\n      const { initialContent = EMPTY_PARAGRAPH, pageSize = DEFAULT_PAGE_SIZE } = action.payload || {};\r\n      const page = { ...createEmptyPage(0, pageSize), content: sanitizeContent(initialContent) };\r\n      return buildInitialState({\r\n        title: state.title,\r\n        pageSize,\r\n        pages: [page]\r\n      });\r\n    },\r\n\r\n    updateTitle: (state, action) => {\r\n      state.title = action.payload;\r\n      state.updatedAt = new Date().toISOString();\r\n    },\r\n\r\n    updatePageContent: (state, action) => {\r\n      const { pageIndex, content } = action.payload;\r\n      if (pageIndex < 0 || pageIndex >= state.pages.length) {\r\n        return;\r\n      }\r\n\r\n      state.pages[pageIndex].content = sanitizeContent(content);\r\n      state.updatedAt = new Date().toISOString();\r\n    },\r\n\r\n    updatePages: (state, action) => {\r\n      const payload = Array.isArray(action.payload)\r\n        ? { pages: action.payload }\r\n        : action.payload || {};\r\n\r\n      const nextPages = withMinimumPage(payload.pages || [], state.pageSize);\r\n      state.pages = nextPages;\r\n      state.activePage = Math.min(state.activePage, nextPages.length - 1);\r\n      state.pageBreaks = Array.isArray(payload.pageBreaks)\r\n        ? payload.pageBreaks\r\n        : nextPages.slice(0, -1).map((_, index) => ({\r\n            id: `auto-break-${index}`,\r\n            pageNumber: index + 1\r\n          }));\r\n      state.totalPages = nextPages.length;\r\n      state.updatedAt = new Date().toISOString();\r\n    },\r\n\r\n    addPage: (state, action) => {\r\n      const insertIndex = typeof action.payload?.index === 'number'\r\n        ? Math.min(Math.max(action.payload.index, 0), state.pages.length)\r\n        : state.pages.length;\r\n\r\n      state.pages.splice(insertIndex, 0, createEmptyPage(insertIndex, state.pageSize));\r\n      state.pages = state.pages.map((page, index) => ({\r\n        ...page,\r\n        index,\r\n        size: state.pageSize\r\n      }));\r\n\r\n      state.activePage = insertIndex;\r\n      state.pageBreaks = state.pages.slice(0, -1).map((_, index) => ({\r\n        id: `auto-break-${index}`,\r\n        pageNumber: index + 1\r\n      }));\r\n      state.totalPages = state.pages.length;\r\n      state.updatedAt = new Date().toISOString();\r\n    },\r\n\r\n    deletePage: (state, action) => {\r\n      const pageIndex = action.payload;\r\n      if (state.pages.length <= 1) {\r\n        return;\r\n      }\r\n\r\n      state.pages.splice(pageIndex, 1);\r\n      state.pages = state.pages.map((page, index) => ({\r\n        ...page,\r\n        index,\r\n        size: state.pageSize\r\n      }));\r\n\r\n      if (state.activePage >= state.pages.length) {\r\n        state.activePage = state.pages.length - 1;\r\n      } else if (pageIndex <= state.activePage && state.activePage > 0) {\r\n        state.activePage -= 1;\r\n      }\r\n\r\n      state.pageBreaks = state.pages.slice(0, -1).map((_, index) => ({\r\n        id: `auto-break-${index}`,\r\n        pageNumber: index + 1\r\n      }));\r\n      state.totalPages = state.pages.length;\r\n      state.updatedAt = new Date().toISOString();\r\n    },\r\n\r\n    setActivePage: (state, action) => {\r\n      const pageIndex = action.payload;\r\n      if (pageIndex >= 0 && pageIndex < state.pages.length && pageIndex !== state.activePage) {\r\n        state.activePage = pageIndex;\r\n        state.updatedAt = new Date().toISOString();\r\n      }\r\n    },\r\n\r\n    updatePageSize: (state, action) => {\r\n      const newSize = action.payload;\r\n      state.pageSize = newSize;\r\n      state.pages = state.pages.map((page, index) => ({\r\n        ...page,\r\n        index,\r\n        size: newSize\r\n      }));\r\n      state.pageBreaks = state.pages.slice(0, -1).map((_, index) => ({\r\n        id: `auto-break-${index}`,\r\n        pageNumber: index + 1\r\n      }));\r\n      state.updatedAt = new Date().toISOString();\r\n    },\r\n\r\n    resetDocument: () => buildInitialState(),\r\n\r\n    // Continuous mode actions\r\n    updateContinuousContent: (state, action) => {\r\n      state.continuousContent = sanitizeContent(action.payload);\r\n      state.updatedAt = new Date().toISOString();\r\n    },\r\n\r\n    updatePageBoundaries: (state, action) => {\r\n      state.pageBoundaries = action.payload || [];\r\n      state.totalPages = state.pageBoundaries.length;\r\n      state.updatedAt = new Date().toISOString();\r\n    },\r\n\r\n    // Manual page operations for continuous mode\r\n    addPageBreak: (state, action) => {\r\n      const { position = 'end' } = action.payload || {};\r\n      \r\n      // Create page break tag\r\n      const pageBreakTag = '<page-break data-page-break=\"true\" style=\"display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;\"></page-break>';\r\n      \r\n      if (position === 'end') {\r\n        // Add page break at the end\r\n        state.continuousContent = state.continuousContent + pageBreakTag + '<p><br></p>';\r\n      } else if (typeof position === 'number') {\r\n        // Insert at specific position (character index)\r\n        const before = state.continuousContent.substring(0, position);\r\n        const after = state.continuousContent.substring(position);\r\n        state.continuousContent = before + pageBreakTag + after;\r\n      }\r\n      \r\n      state.updatedAt = new Date().toISOString();\r\n    },\r\n\r\n    removePageBreak: (state, action) => {\r\n      const { pageIndex } = action.payload || {};\r\n      \r\n      if (typeof pageIndex !== 'number') {\r\n        return;\r\n      }\r\n      \r\n      // Create a temporary div to parse HTML\r\n      if (typeof document !== 'undefined') {\r\n        const tempDiv = document.createElement('div');\r\n        tempDiv.innerHTML = state.continuousContent;\r\n        \r\n        // Find all page breaks\r\n        const pageBreaks = tempDiv.querySelectorAll('page-break, [data-page-break=\"true\"]');\r\n        \r\n        // Remove the page break at the specified index\r\n        // For first page (pageIndex 0), we remove the first page break\r\n        if (pageBreaks[pageIndex]) {\r\n          pageBreaks[pageIndex].remove();\r\n        }\r\n        \r\n        // Renumber all remaining page breaks\r\n        const remainingBreaks = tempDiv.querySelectorAll('page-break, [data-page-break=\"true\"]');\r\n        remainingBreaks.forEach((breakEl, index) => {\r\n          // Page number is index + 2 (page 1 has no break, first break creates page 2)\r\n          breakEl.setAttribute('data-page-number', String(index + 2));\r\n        });\r\n        \r\n        state.continuousContent = tempDiv.innerHTML;\r\n        state.updatedAt = new Date().toISOString();\r\n      }\r\n    },\r\n\r\n    setEditorMode: (state, action) => {\r\n      const newMode = action.payload;\r\n      if (newMode !== state.editorMode) {\r\n        state.editorMode = newMode;\r\n        \r\n        // Convert content between modes\r\n        if (newMode === 'continuous') {\r\n          // Merge all pages into continuous content\r\n          const allContent = state.pages\r\n            .map(page => page.content)\r\n            .filter(content => content && content !== EMPTY_PARAGRAPH)\r\n            .join('\\n');\r\n          state.continuousContent = allContent || EMPTY_PARAGRAPH;\r\n        } else {\r\n          // Split continuous content into pages (will be handled by reflow)\r\n          if (state.continuousContent && state.continuousContent !== EMPTY_PARAGRAPH) {\r\n            state.pages = [{ ...createEmptyPage(0, state.pageSize), content: state.continuousContent }];\r\n          }\r\n        }\r\n        \r\n        state.updatedAt = new Date().toISOString();\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\nexport const {\r\n  initializeDocument,\r\n  updateTitle,\r\n  updatePageContent,\r\n  updatePages,\r\n  addPage,\r\n  deletePage,\r\n  setActivePage,\r\n  updatePageSize,\r\n  resetDocument,\r\n  updateContinuousContent,\r\n  updatePageBoundaries,\r\n  addPageBreak,\r\n  removePageBreak,\r\n  setEditorMode\r\n} = documentSlice.actions;\r\n\r\nexport default documentSlice.reducer;","import { useState, useCallback } from 'react';\r\n\r\n/**\r\n * useFormatting - Hook for managing text formatting state and commands\r\n * Handles document.execCommand for rich text formatting\r\n */\r\nexport const useFormatting = () => {\r\n  const [currentFormat, setCurrentFormat] = useState({\r\n    bold: false,\r\n    italic: false,\r\n    underline: false,\r\n    strikethrough: false,\r\n    alignLeft: false,\r\n    alignCenter: false,\r\n    alignRight: false,\r\n    alignJustify: false,\r\n    fontFamily: 'Arial',\r\n    fontSize: '16px'\r\n  });\r\n\r\n  /**\r\n   * Format text using document.execCommand\r\n   */\r\n  const formatText = useCallback((command, value = null) => {\r\n    document.execCommand(command, false, value);\r\n    \r\n    // Update format state\r\n    if (command === 'bold') {\r\n      setCurrentFormat(prev => ({ ...prev, bold: !prev.bold }));\r\n    } else if (command === 'italic') {\r\n      setCurrentFormat(prev => ({ ...prev, italic: !prev.italic }));\r\n    } else if (command === 'underline') {\r\n      setCurrentFormat(prev => ({ ...prev, underline: !prev.underline }));\r\n    } else if (command === 'strikethrough') {\r\n      setCurrentFormat(prev => ({ ...prev, strikethrough: !prev.strikethrough }));\r\n    } else if (command === 'justifyLeft') {\r\n      setCurrentFormat(prev => ({ ...prev, alignLeft: true, alignCenter: false, alignRight: false, alignJustify: false }));\r\n    } else if (command === 'justifyCenter') {\r\n      setCurrentFormat(prev => ({ ...prev, alignLeft: false, alignCenter: true, alignRight: false, alignJustify: false }));\r\n    } else if (command === 'justifyRight') {\r\n      setCurrentFormat(prev => ({ ...prev, alignLeft: false, alignCenter: false, alignRight: true, alignJustify: false }));\r\n    } else if (command === 'justifyFull') {\r\n      setCurrentFormat(prev => ({ ...prev, alignLeft: false, alignCenter: false, alignRight: false, alignJustify: true }));\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    currentFormat,\r\n    formatText\r\n  };\r\n};\r\n","import { useCallback, useRef, useEffect } from 'react';\r\nimport { useDispatch } from 'react-redux';\r\nimport { updatePageBoundaries, updateContinuousContent } from '../store/slices/documentSlice';\r\n\r\nconst PAGE_DIMENSIONS = {\r\n  A4: { width: 794, height: 1123 },\r\n  Letter: { width: 816, height: 1056 },\r\n  Legal: { width: 816, height: 1344 }\r\n};\r\n\r\nconst CONTENT_PADDING = {\r\n  top: 60,\r\n  bottom: 100,\r\n  left: 72,\r\n  right: 72\r\n};\r\n\r\n/**\r\n * useContinuousReflow - Automatically insert page breaks based on content height\r\n * Monitors content height and inserts <page-break> tags when content exceeds page dimensions\r\n * Content remains in a single continuous contenteditable surface\r\n */\r\nexport const useContinuousReflow = (pageSize, editorRef) => {\r\n  const dispatch = useDispatch();\r\n  const boundaryTimeoutRef = useRef(null);\r\n  const reflowTimeoutRef = useRef(null);\r\n  const latestPageSizeRef = useRef(pageSize);\r\n  const isReflowingRef = useRef(false);\r\n\r\n  useEffect(() => {\r\n    latestPageSizeRef.current = pageSize;\r\n  }, [pageSize]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (boundaryTimeoutRef.current) {\r\n        clearTimeout(boundaryTimeoutRef.current);\r\n      }\r\n      if (reflowTimeoutRef.current) {\r\n        clearTimeout(reflowTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  /**\r\n   * Check if content in a page section exceeds the maximum height\r\n   * Returns the element where overflow occurs\r\n   */\r\n  const findOverflowPoint = useCallback((pageElements, maxHeight) => {\r\n    let currentHeight = 0;\r\n    \r\n    for (let i = 0; i < pageElements.length; i++) {\r\n      const element = pageElements[i];\r\n      const elementHeight = element.getBoundingClientRect().height;\r\n      \r\n      if (currentHeight + elementHeight > maxHeight) {\r\n        return { overflowIndex: i, overflowElement: element, accumulatedHeight: currentHeight };\r\n      }\r\n      \r\n      currentHeight += elementHeight;\r\n    }\r\n    \r\n    return null; // No overflow\r\n  }, []);\r\n\r\n  /**\r\n   * Insert a page break element before the specified element\r\n   */\r\n  const insertPageBreakBefore = useCallback((targetElement, pageNumber) => {\r\n    if (!targetElement || !editorRef?.current) {\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const editor = editorRef.current;\r\n      const pageBreak = document.createElement('page-break');\r\n      pageBreak.setAttribute('data-page-break', 'true');\r\n      pageBreak.setAttribute('contenteditable', 'false');\r\n      pageBreak.setAttribute('data-page-number', pageNumber || '2');\r\n      \r\n      // Insert before the target element\r\n      targetElement.parentNode.insertBefore(pageBreak, targetElement);\r\n      \r\n      return true;\r\n    } catch (error) {\r\n      console.warn('[insertPageBreakBefore] Failed to insert page break:', error);\r\n      return false;\r\n    }\r\n  }, [editorRef]);\r\n\r\n  /**\r\n   * Automatic reflow: Insert page breaks when content exceeds page height\r\n   */\r\n  const checkAndReflow = useCallback(() => {\r\n    if (!editorRef?.current || isReflowingRef.current) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      isReflowingRef.current = true;\r\n      const editor = editorRef.current;\r\n      const targetPageSize = latestPageSizeRef.current || 'A4';\r\n      const dimensions = PAGE_DIMENSIONS[targetPageSize] || PAGE_DIMENSIONS.A4;\r\n      \r\n      // Calculate max content height (page height - padding)\r\n      const maxHeight = dimensions.height - CONTENT_PADDING.top - CONTENT_PADDING.bottom;\r\n      \r\n      // Get all child elements in the editor\r\n      const allChildren = Array.from(editor.children);\r\n      \r\n      // Find existing page breaks\r\n      const existingBreaks = allChildren.filter(el => \r\n        el.tagName === 'PAGE-BREAK' || el.getAttribute('data-page-break') === 'true'\r\n      );\r\n      \r\n      // Split content into pages based on existing breaks\r\n      const pages = [];\r\n      let currentPage = [];\r\n      \r\n      for (const child of allChildren) {\r\n        if (child.tagName === 'PAGE-BREAK' || child.getAttribute('data-page-break') === 'true') {\r\n          if (currentPage.length > 0) {\r\n            pages.push(currentPage);\r\n            currentPage = [];\r\n          }\r\n        } else {\r\n          currentPage.push(child);\r\n        }\r\n      }\r\n      \r\n      // Add the last page\r\n      if (currentPage.length > 0) {\r\n        pages.push(currentPage);\r\n      }\r\n      \r\n      // If no pages, all elements are on one page\r\n      if (pages.length === 0 && allChildren.length > 0) {\r\n        pages.push(allChildren.filter(el => \r\n          !(el.tagName === 'PAGE-BREAK' || el.getAttribute('data-page-break') === 'true')\r\n        ));\r\n      }\r\n      \r\n      // Check each page for overflow\r\n      let insertedBreaks = false;\r\n      \r\n      for (let pageIndex = 0; pageIndex < pages.length; pageIndex++) {\r\n        const pageElements = pages[pageIndex];\r\n        const overflow = findOverflowPoint(pageElements, maxHeight);\r\n        \r\n        if (overflow && overflow.overflowIndex > 0) {\r\n          // Insert page break before the overflow element\r\n          // Page number is pageIndex + 2 (since we're creating the break for the next page)\r\n          const pageNumber = pageIndex + 2;\r\n          const inserted = insertPageBreakBefore(overflow.overflowElement, pageNumber);\r\n          if (inserted) {\r\n            insertedBreaks = true;\r\n            // Only process one page at a time to avoid complexity\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Update boundaries if we inserted breaks\r\n      if (insertedBreaks) {\r\n        // Trigger content update to Redux\r\n        const html = editor.innerHTML;\r\n        dispatch(updateContinuousContent(html));\r\n        \r\n        // Recalculate boundaries\r\n        setTimeout(() => {\r\n          updateBoundaries();\r\n        }, 50);\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.warn('[checkAndReflow] Reflow failed:', error);\r\n    } finally {\r\n      isReflowingRef.current = false;\r\n    }\r\n  }, [editorRef, findOverflowPoint, insertPageBreakBefore, dispatch]);\r\n\r\n  /**\r\n   * Debounced automatic reflow check\r\n   */\r\n  const triggerAutoReflow = useCallback((delay = 500) => {\r\n    if (reflowTimeoutRef.current) {\r\n      clearTimeout(reflowTimeoutRef.current);\r\n    }\r\n\r\n    reflowTimeoutRef.current = setTimeout(() => {\r\n      reflowTimeoutRef.current = null;\r\n      checkAndReflow();\r\n    }, delay);\r\n  }, [checkAndReflow]);\r\n\r\n  /**\r\n   * Calculate visual page boundaries based on <page-break> tags in content\r\n   * Returns array of boundary objects with top positions\r\n   */\r\n  const calculatePageBoundaries = useCallback((options = {}) => {\r\n    if (!editorRef?.current || typeof document === 'undefined') {\r\n      return [];\r\n    }\r\n\r\n    const targetPageSize = options.pageSize || latestPageSizeRef.current || 'A4';\r\n    const dimensions = PAGE_DIMENSIONS[targetPageSize] || PAGE_DIMENSIONS.A4;\r\n    \r\n    const editor = editorRef.current;\r\n    \r\n    // Find all <page-break> elements in the content\r\n    const pageBreakElements = editor.querySelectorAll('page-break, [data-page-break=\"true\"]');\r\n    \r\n    const boundaries = [];\r\n    let currentTop = 0;\r\n    \r\n    // Always have at least one page (page 1)\r\n    boundaries.push({\r\n      id: 'page-0',\r\n      pageNumber: 1,\r\n      top: 0,\r\n      height: dimensions.height\r\n      // No breakElement for first page\r\n    });\r\n\r\n    // Add boundaries for each page break\r\n    pageBreakElements.forEach((breakEl, index) => {\r\n      const rect = breakEl.getBoundingClientRect();\r\n      const editorRect = editor.getBoundingClientRect();\r\n      const relativeTop = rect.top - editorRect.top + editor.scrollTop;\r\n      \r\n      boundaries.push({\r\n        id: `page-${index + 1}`,\r\n        pageNumber: index + 2,\r\n        top: relativeTop,\r\n        height: dimensions.height\r\n        // Don't store breakElement - not serializable\r\n      });\r\n    });\r\n\r\n    return boundaries;\r\n  }, [editorRef]);\r\n\r\n  /**\r\n   * Update page boundaries in Redux state\r\n   */\r\n  const updateBoundaries = useCallback((options = {}) => {\r\n    const boundaries = calculatePageBoundaries(options);\r\n    dispatch(updatePageBoundaries(boundaries));\r\n    return boundaries;\r\n  }, [calculatePageBoundaries, dispatch]);\r\n\r\n  /**\r\n   * Debounced boundary calculation\r\n   * Triggers after content changes to recalculate page boundaries\r\n   */\r\n  const checkAndUpdateBoundaries = useCallback((options = {}) => {\r\n    if (boundaryTimeoutRef.current) {\r\n      clearTimeout(boundaryTimeoutRef.current);\r\n    }\r\n\r\n    const delay = typeof options.delay === 'number' ? options.delay : 300;\r\n\r\n    boundaryTimeoutRef.current = setTimeout(() => {\r\n      boundaryTimeoutRef.current = null;\r\n      updateBoundaries(options);\r\n    }, Math.max(0, delay));\r\n  }, [updateBoundaries]);\r\n\r\n  /**\r\n   * Get current page number based on cursor position\r\n   */\r\n  const getCurrentPage = useCallback(() => {\r\n    if (!editorRef?.current) {\r\n      return 0;\r\n    }\r\n\r\n    const selection = window.getSelection();\r\n    if (!selection || selection.rangeCount === 0) {\r\n      return 0;\r\n    }\r\n\r\n    try {\r\n      const range = selection.getRangeAt(0);\r\n      const editor = editorRef.current;\r\n      let currentNode = range.startContainer;\r\n      \r\n      // Find all page breaks before cursor\r\n      const pageBreaks = Array.from(editor.querySelectorAll('page-break, [data-page-break=\"true\"]'));\r\n      \r\n      if (pageBreaks.length === 0) {\r\n        return 0; // Only one page\r\n      }\r\n\r\n      // Walk up the tree to find the editor\r\n      while (currentNode && currentNode !== editor) {\r\n        // Check if current node is after any page breaks\r\n        for (let i = pageBreaks.length - 1; i >= 0; i--) {\r\n          const breakEl = pageBreaks[i];\r\n          const position = breakEl.compareDocumentPosition(currentNode);\r\n          \r\n          // If currentNode is after this page break\r\n          if (position & Node.DOCUMENT_POSITION_FOLLOWING) {\r\n            return i + 1; // Page number (0-indexed internally)\r\n          }\r\n        }\r\n        \r\n        currentNode = currentNode.parentNode;\r\n      }\r\n      \r\n      return 0; // Default to first page\r\n    } catch (error) {\r\n      console.warn('[getCurrentPage] Failed to calculate page:', error);\r\n      return 0;\r\n    }\r\n  }, [editorRef]);\r\n\r\n  /**\r\n   * Scroll to a specific page and position cursor at the start of that page\r\n   */\r\n  const scrollToPage = useCallback((pageNumber, containerRef) => {\r\n    if (!containerRef?.current || !editorRef?.current) {\r\n      return;\r\n    }\r\n\r\n    const editor = editorRef.current;\r\n    const boundaries = calculatePageBoundaries();\r\n    \r\n    // Find the boundary for the requested page\r\n    const targetBoundary = boundaries.find(b => b.pageNumber === pageNumber + 1);\r\n    \r\n    if (targetBoundary) {\r\n      // Scroll to the page\r\n      containerRef.current.scrollTo({\r\n        top: targetBoundary.top - 40,\r\n        behavior: 'smooth'\r\n      });\r\n      \r\n      // Position cursor at the start of this page\r\n      setTimeout(() => {\r\n        positionCursorAtPage(pageNumber);\r\n      }, 300); // Wait for smooth scroll\r\n    }\r\n  }, [editorRef]);\r\n\r\n  /**\r\n   * Position cursor at the start of a specific page\r\n   */\r\n  const positionCursorAtPage = useCallback((pageNumber) => {\r\n    if (!editorRef?.current) {\r\n      return;\r\n    }\r\n\r\n    const editor = editorRef.current;\r\n    editor.focus();\r\n\r\n    try {\r\n      let targetNode = null;\r\n      let targetOffset = 0;\r\n\r\n      if (pageNumber === 0) {\r\n        // First page - position at start\r\n        targetNode = editor.firstChild;\r\n        targetOffset = 0;\r\n      } else {\r\n        // Find the page break element for this page\r\n        const pageBreaks = editor.querySelectorAll('page-break, [data-page-break=\"true\"]');\r\n        const breakElement = pageBreaks[pageNumber - 1];\r\n        \r\n        if (breakElement && breakElement.nextSibling) {\r\n          targetNode = breakElement.nextSibling;\r\n          targetOffset = 0;\r\n        }\r\n      }\r\n\r\n      if (targetNode) {\r\n        const range = document.createRange();\r\n        const selection = window.getSelection();\r\n        \r\n        // If target is a text node, use it directly\r\n        if (targetNode.nodeType === Node.TEXT_NODE) {\r\n          range.setStart(targetNode, targetOffset);\r\n        } else {\r\n          // If it's an element, position at its start\r\n          range.setStart(targetNode, 0);\r\n        }\r\n        \r\n        range.collapse(true);\r\n        selection.removeAllRanges();\r\n        selection.addRange(range);\r\n      }\r\n    } catch (error) {\r\n      console.warn('[positionCursorAtPage] Failed to position cursor:', error);\r\n    }\r\n  }, [editorRef]);\r\n\r\n  /**\r\n   * Remove a page and its content from the continuous editor\r\n   * Removes the page break and all content between the page boundaries\r\n   * @param {number} pageIndex - The index of the page to remove (0-based)\r\n   */\r\n  const removePageAndContent = useCallback((pageIndex) => {\r\n    if (!editorRef?.current) {\r\n      return false;\r\n    }\r\n\r\n    const editor = editorRef.current;\r\n    const boundaries = calculatePageBoundaries();\r\n\r\n    // Cannot delete if only one page\r\n    if (boundaries.length <= 1) {\r\n      console.warn('[removePageAndContent] Cannot delete the only page');\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      // Find all page breaks in the editor\r\n      const pageBreaks = Array.from(editor.querySelectorAll('page-break, [data-page-break=\"true\"]'));\r\n      \r\n      if (pageIndex > pageBreaks.length) {\r\n        console.warn('[removePageAndContent] Invalid page index');\r\n        return false;\r\n      }\r\n\r\n      // Save cursor position before deletion\r\n      const selection = window.getSelection();\r\n      let cursorWasInDeletedContent = false;\r\n      \r\n      let nodesToRemove = [];\r\n      let pageBreakToRemove = null;\r\n\r\n      // Special handling for first page (pageIndex === 0)\r\n      if (pageIndex === 0) {\r\n        // For the first page, remove all content before the first page break\r\n        const firstPageBreak = pageBreaks[0];\r\n        \r\n        if (!firstPageBreak) {\r\n          console.warn('[removePageAndContent] No page break found for first page');\r\n          return false;\r\n        }\r\n\r\n        // Collect all nodes before the first page break\r\n        let currentNode = editor.firstChild;\r\n        while (currentNode && currentNode !== firstPageBreak) {\r\n          nodesToRemove.push(currentNode);\r\n          currentNode = currentNode.nextSibling;\r\n        }\r\n\r\n        // The first page break itself should also be removed\r\n        pageBreakToRemove = firstPageBreak;\r\n\r\n      } else {\r\n        // For pages 1 and onwards, remove content between page breaks\r\n        // The page break that starts this page is at index (pageIndex - 1)\r\n        // because page 0 has no break, page 1 has break[0], page 2 has break[1], etc.\r\n        const pageBreakElement = pageBreaks[pageIndex - 1];\r\n        \r\n        if (!pageBreakElement) {\r\n          console.warn('[removePageAndContent] Page break not found');\r\n          return false;\r\n        }\r\n\r\n        // Find the next page break (if any) to determine the end of this page\r\n        const nextPageBreakElement = pageBreaks[pageIndex];\r\n\r\n        // Collect all nodes between the current page break and the next one (or end)\r\n        let currentNode = pageBreakElement.nextSibling;\r\n\r\n        while (currentNode) {\r\n          // Stop if we reach the next page break\r\n          if (currentNode === nextPageBreakElement) {\r\n            break;\r\n          }\r\n          \r\n          nodesToRemove.push(currentNode);\r\n          currentNode = currentNode.nextSibling;\r\n        }\r\n\r\n        pageBreakToRemove = pageBreakElement;\r\n      }\r\n\r\n      // Check if cursor is in the content being deleted\r\n      if (selection && selection.rangeCount > 0) {\r\n        const range = selection.getRangeAt(0);\r\n        const cursorNode = range.startContainer;\r\n        \r\n        for (const node of nodesToRemove) {\r\n          if (node.contains(cursorNode) || node === cursorNode) {\r\n            cursorWasInDeletedContent = true;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Remove the page break element\r\n      if (pageBreakToRemove && pageBreakToRemove.parentNode) {\r\n        pageBreakToRemove.remove();\r\n      }\r\n\r\n      // Remove all content nodes\r\n      nodesToRemove.forEach(node => {\r\n        if (node.parentNode) {\r\n          node.remove();\r\n        }\r\n      });\r\n\r\n      // Renumber remaining page breaks\r\n      const remainingBreaks = editor.querySelectorAll('page-break, [data-page-break=\"true\"]');\r\n      remainingBreaks.forEach((breakEl, index) => {\r\n        breakEl.setAttribute('data-page-number', String(index + 2));\r\n      });\r\n\r\n      // Position cursor appropriately after deletion\r\n      if (cursorWasInDeletedContent) {\r\n        // Position cursor at the start of the first remaining page (page 0)\r\n        setTimeout(() => {\r\n          positionCursorAtPage(0);\r\n        }, 50);\r\n      }\r\n\r\n      // Update content in Redux\r\n      const updatedHTML = editor.innerHTML;\r\n      dispatch(updateContinuousContent(updatedHTML));\r\n\r\n      // Update boundaries after deletion\r\n      setTimeout(() => {\r\n        updateBoundaries();\r\n      }, 100);\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('[removePageAndContent] Failed to remove page:', error);\r\n      return false;\r\n    }\r\n  }, [editorRef, calculatePageBoundaries, dispatch, updateBoundaries, positionCursorAtPage]);\r\n\r\n  return {\r\n    calculatePageBoundaries,\r\n    checkAndUpdateBoundaries,\r\n    updateBoundaries,\r\n    getCurrentPage,\r\n    scrollToPage,\r\n    positionCursorAtPage,\r\n    checkAndReflow,\r\n    triggerAutoReflow,\r\n    removePageAndContent,\r\n    boundaryTimeoutRef,\r\n    reflowTimeoutRef\r\n  };\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport './Sidebar.css';\r\n\r\n/**\r\n * Sidebar Component\r\n * Displays document information, outline, and word count\r\n * @param {Object} props\r\n * @param {Object} props.editorView - Editor view instance (not used in contenteditable)\r\n * @param {boolean} props.isCollapsed - Whether sidebar is collapsed\r\n * @param {Function} props.onToggle - Callback for collapse toggle\r\n * @param {number} props.wordCount - Optional word count (for continuous mode)\r\n * @param {number} props.pageCount - Optional page count (for continuous mode)\r\n */\r\nexport const Sidebar = ({ editorView, isCollapsed, onToggle, wordCount: propWordCount, pageCount: propPageCount }) => {\r\n  const documentState = useSelector(state => state.document);\r\n  const { pages, activePage, continuousContent, editorMode } = documentState;\r\n  const [wordCount, setWordCount] = useState(0);\r\n  const [outline, setOutline] = useState([]);\r\n\r\n  // Calculate word count and extract outline from content\r\n  useEffect(() => {\r\n    // Use prop values if provided (continuous mode)\r\n    if (propWordCount !== undefined && propPageCount !== undefined) {\r\n      setWordCount(propWordCount);\r\n      \r\n      // Extract outline from continuous content\r\n      if (continuousContent) {\r\n        const tempDiv = document.createElement('div');\r\n        tempDiv.innerHTML = continuousContent;\r\n        const headingElements = tempDiv.querySelectorAll('h1, h2, h3, h4, h5, h6');\r\n        const headings = Array.from(headingElements).map((heading, index) => {\r\n          const level = parseInt(heading.tagName.charAt(1));\r\n          const text = heading.textContent.trim();\r\n          return text ? {\r\n            id: `heading-${index}`,\r\n            level,\r\n            text,\r\n            page: 1 // Continuous mode doesn't have meaningful page numbers for headings\r\n          } : null;\r\n        }).filter(Boolean);\r\n        setOutline(headings);\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Paged mode: Calculate from pages array\r\n    let totalWords = 0;\r\n    const headings = [];\r\n\r\n    pages.forEach((page, pageIndex) => {\r\n      if (page.content) {\r\n        // Extract text content and count words\r\n        const tempDiv = document.createElement('div');\r\n        tempDiv.innerHTML = page.content;\r\n        const text = tempDiv.textContent || tempDiv.innerText || '';\r\n        const words = text.trim().split(/\\s+/).filter(word => word.length > 0);\r\n        totalWords += words.length;\r\n\r\n        // Extract headings for outline\r\n        const headingElements = tempDiv.querySelectorAll('h1, h2, h3, h4, h5, h6');\r\n        headingElements.forEach((heading, index) => {\r\n          const level = parseInt(heading.tagName.charAt(1));\r\n          const text = heading.textContent.trim();\r\n          if (text) {\r\n            headings.push({\r\n              id: `heading-${pageIndex}-${index}`,\r\n              level,\r\n              text,\r\n              page: pageIndex + 1\r\n            });\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    setWordCount(totalWords);\r\n    setOutline(headings);\r\n  }, [pages, propWordCount, propPageCount, continuousContent]);\r\n\r\n  const displayPageCount = propPageCount !== undefined ? propPageCount : pages.length;\r\n\r\n  return (\r\n    <aside \r\n      className={`sidebar ${isCollapsed ? 'collapsed' : ''}`} \r\n      role=\"complementary\"\r\n      aria-label=\"Document information\"\r\n      data-testid=\"sidebar\"\r\n    >\r\n      <div className=\"sidebar-header\">\r\n        <h2>Document Info</h2>\r\n        <button\r\n          className=\"sidebar-toggle\"\r\n          onClick={onToggle}\r\n          aria-label={isCollapsed ? \"Expand sidebar\" : \"Collapse sidebar\"}\r\n          title={isCollapsed ? \"Expand sidebar\" : \"Collapse sidebar\"}\r\n        >\r\n          {isCollapsed ? '▶' : '◀'}\r\n        </button>\r\n      </div>\r\n\r\n      {!isCollapsed && (\r\n        <div className=\"sidebar-content\">\r\n          <div className=\"sidebar-section\">\r\n            <h3>Statistics</h3>\r\n            <div className=\"stat-item\">\r\n              <span className=\"stat-label\">Pages:</span>\r\n              <span className=\"stat-value\">{displayPageCount}</span>\r\n            </div>\r\n            <div className=\"stat-item\" data-testid=\"word-count\">\r\n              <span className=\"stat-label\">Words:</span>\r\n              <span className=\"stat-value\">{wordCount.toLocaleString()}</span>\r\n            </div>\r\n            <div className=\"stat-item\">\r\n              <span className=\"stat-label\">Active Page:</span>\r\n              <span className=\"stat-value\">{activePage + 1}</span>\r\n            </div>\r\n          </div>\r\n\r\n          {outline.length > 0 && (\r\n            <div className=\"sidebar-section\">\r\n              <h3>Document Outline</h3>\r\n              <div className=\"document-outline\" data-testid=\"outline\">\r\n                {outline.map((heading) => (\r\n                  <div \r\n                    key={heading.id}\r\n                    className={`outline-item outline-level-${heading.level}`}\r\n                    style={{ marginLeft: `${(heading.level - 1) * 12}px` }}\r\n                  >\r\n                    <span className=\"outline-text\">{heading.text}</span>\r\n                    <span className=\"outline-page\">p.{heading.page}</span>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"sidebar-section\">\r\n            <h3>Document</h3>\r\n            <p>HTML Editor</p>\r\n            <p>Multi-page support</p>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </aside>\r\n  );\r\n};\r\n\r\nexport default Sidebar;\r\n","/**\r\n * Local storage service for handling image persistence in the editor\r\n * Stores images as base64 data URLs with size validation\r\n */\r\n\r\n/**\r\n * Generates a UUID v4 string for unique image keys\r\n * @returns {string} UUID string\r\n */\r\nfunction generateUUID() {\r\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\r\n    const r = Math.random() * 16 | 0;\r\n    const v = c === 'x' ? r : (r & 0x3 | 0x8);\r\n    return v.toString(16);\r\n  });\r\n}\r\n\r\n/**\r\n * Saves an image file to browser local storage\r\n * @param {File} file - Image file to store\r\n * @returns {Promise<string>} Promise resolving to storage key\r\n * @throws {Error} When image validation fails or storage quota exceeded\r\n */\r\nexport function saveImage(file) {\r\n  return new Promise((resolve, reject) => {\r\n    // Validate file type\r\n    const validTypes = ['image/png', 'image/jpeg', 'image/gif', 'image/webp'];\r\n    if (!validTypes.includes(file.type)) {\r\n      reject(new Error('Invalid image format. Supported formats: png, jpeg, gif, webp'));\r\n      return;\r\n    }\r\n\r\n    // Check file size (5MB limit)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      reject(new Error('Image exceeds maximum size of 5MB'));\r\n      return;\r\n    }\r\n\r\n    const reader = new FileReader();\r\n    \r\n    reader.onload = (event) => {\r\n      const dataUrl = event.target.result;\r\n      \r\n      // Calculate base64 size (3 bytes for every 4 characters)\r\n      const base64String = dataUrl.split(',')[1];\r\n      const sizeInBytes = (base64String.length * 3) / 4;\r\n      \r\n      if (sizeInBytes > 5 * 1024 * 1024) {\r\n        reject(new Error('Image exceeds maximum size of 5MB'));\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const key = `editor-image-${generateUUID()}`;\r\n        localStorage.setItem(key, dataUrl);\r\n        resolve(key);\r\n      } catch (error) {\r\n        if (error.name === 'QuotaExceededError') {\r\n          reject(new Error('Storage quota exceeded'));\r\n        } else {\r\n          reject(error);\r\n        }\r\n      }\r\n    };\r\n\r\n    reader.onerror = () => {\r\n      reject(new Error('Error reading image file'));\r\n    };\r\n\r\n    reader.readAsDataURL(file);\r\n  });\r\n}\r\n\r\n/**\r\n * Retrieves an image from local storage by key\r\n * @param {string} key - Storage key for the image\r\n * @returns {string|null} Data URL of the image or null if not found\r\n */\r\nexport function getImage(key) {\r\n  return localStorage.getItem(key);\r\n}\r\n\r\n/**\r\n * Deletes an image from local storage\r\n * @param {string} key - Storage key for the image\r\n */\r\nexport function deleteImage(key) {\r\n  localStorage.removeItem(key);\r\n}\r\n\r\n/**\r\n * Clears all editor images from local storage\r\n */\r\nexport function clearImages() {\r\n  Object.keys(localStorage).forEach(key => {\r\n    if (key.startsWith('editor-image-')) {\r\n      localStorage.removeItem(key);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Gets all stored image keys\r\n * @returns {string[]} Array of image storage keys\r\n */\r\nexport function getAllImageKeys() {\r\n  return Object.keys(localStorage).filter(key => \r\n    key.startsWith('editor-image-')\r\n  );\r\n}","/**\r\n * Logger utility for the editor\r\n * Provides consistent logging across the application\r\n * Disabled in production for performance\r\n */\r\n\r\nconst isDevelopment = import.meta.env.MODE === 'development';\r\n\r\n/**\r\n * Logger class for structured logging\r\n */\r\nclass Logger {\r\n  constructor(namespace = 'Editor') {\r\n    this.namespace = namespace;\r\n  }\r\n\r\n  /**\r\n   * Formats log message with namespace\r\n   * @param {string} level - Log level\r\n   * @param {string} message - Log message\r\n   * @param {any} data - Optional data to log\r\n   * @returns {string} Formatted message\r\n   */\r\n  _format(level, message, data) {\r\n    const timestamp = new Date().toISOString();\r\n    return `[${timestamp}] [${this.namespace}] [${level}] ${message}`;\r\n  }\r\n\r\n  /**\r\n   * Info level logging\r\n   * @param {string} message - Info message\r\n   * @param {any} data - Optional data\r\n   */\r\n  info(message, data) {\r\n    if (!isDevelopment) return;\r\n    \r\n    console.log(this._format('INFO', message));\r\n    if (data) console.log(data);\r\n  }\r\n\r\n  /**\r\n   * Warning level logging\r\n   * @param {string} message - Warning message\r\n   * @param {any} data - Optional data\r\n   */\r\n  warn(message, data) {\r\n    if (!isDevelopment) return;\r\n    \r\n    console.warn(this._format('WARN', message));\r\n    if (data) console.warn(data);\r\n  }\r\n\r\n  /**\r\n   * Error level logging\r\n   * @param {string} message - Error message\r\n   * @param {Error|any} error - Error object or data\r\n   */\r\n  error(message, error) {\r\n    if (!isDevelopment) return;\r\n    \r\n    console.error(this._format('ERROR', message));\r\n    if (error) {\r\n      if (error instanceof Error) {\r\n        console.error(error.message);\r\n        console.error(error.stack);\r\n      } else {\r\n        console.error(error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Debug level logging\r\n   * @param {string} message - Debug message\r\n   * @param {any} data - Optional data\r\n   */\r\n  debug(message, data) {\r\n    if (!isDevelopment) return;\r\n    \r\n    console.debug(this._format('DEBUG', message));\r\n    if (data) console.debug(data);\r\n  }\r\n}\r\n\r\n// Create default logger instance\r\nexport const logger = new Logger('Editor');\r\n\r\n// Export Logger class for custom instances\r\nexport default Logger;\r\n","import React from 'react';\r\nimport { saveImage } from '../../lib/storage/local-storage';\r\nimport { logger } from '../../lib/editor/utils/logger';\r\n\r\n/**\r\n * EditorToolbar - Formatting toolbar for the multi-page editor\r\n * Provides text formatting, alignment, lists, links, tables, and image insertion\r\n */\r\nconst EditorToolbar = ({ \r\n  currentFormat, \r\n  pageSize, \r\n  onFormatText, \r\n  onPageSizeChange,\r\n  onAddPageBreak\r\n}) => {\r\n  /**\r\n   * Handle image upload\r\n   */\r\n  const handleImageUpload = async (file) => {\r\n    try {\r\n      const validTypes = ['image/png', 'image/jpeg', 'image/gif', 'image/webp'];\r\n      if (!validTypes.includes(file.type)) {\r\n        alert('Invalid image format. Supported: PNG, JPEG, GIF, WEBP');\r\n        return;\r\n      }\r\n\r\n      if (file.size > 5 * 1024 * 1024) {\r\n        alert('Image exceeds maximum size of 5MB');\r\n        return;\r\n      }\r\n\r\n      const key = await saveImage(file);\r\n      const imageUrl = localStorage.getItem(key);\r\n      \r\n      if (imageUrl) {\r\n        document.execCommand('insertImage', false, imageUrl);\r\n        logger.info('Image inserted', { key });\r\n      }\r\n    } catch (error) {\r\n      logger.error('Error uploading image', error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"editor-toolbar\">\r\n      <button \r\n        onClick={() => onFormatText('bold')} \r\n        className={currentFormat.bold ? 'active' : ''} \r\n        title=\"Bold\"\r\n      >\r\n        <strong>B</strong>\r\n      </button>\r\n      <button \r\n        onClick={() => onFormatText('italic')} \r\n        className={currentFormat.italic ? 'active' : ''} \r\n        title=\"Italic\"\r\n      >\r\n        <em>I</em>\r\n      </button>\r\n      <button \r\n        onClick={() => onFormatText('underline')} \r\n        className={currentFormat.underline ? 'active' : ''} \r\n        title=\"Underline\"\r\n      >\r\n        <u>U</u>\r\n      </button>\r\n      <button \r\n        onClick={() => onFormatText('strikethrough')} \r\n        className={currentFormat.strikethrough ? 'active' : ''} \r\n        title=\"Strikethrough\"\r\n      >\r\n        <s>S</s>\r\n      </button>\r\n      \r\n      <div className=\"toolbar-separator\" />\r\n      \r\n      <button \r\n        onClick={() => onFormatText('justifyLeft')} \r\n        className={currentFormat.alignLeft ? 'active' : ''} \r\n        title=\"Align Left\"\r\n      >\r\n        ⬅️\r\n      </button>\r\n      <button \r\n        onClick={() => onFormatText('justifyCenter')} \r\n        className={currentFormat.alignCenter ? 'active' : ''} \r\n        title=\"Align Center\"\r\n      >\r\n        ⬌\r\n      </button>\r\n      <button \r\n        onClick={() => onFormatText('justifyRight')} \r\n        className={currentFormat.alignRight ? 'active' : ''} \r\n        title=\"Align Right\"\r\n      >\r\n        ➡️ \r\n      </button>\r\n      <button \r\n        onClick={() => onFormatText('justifyFull')} \r\n        className={currentFormat.alignJustify ? 'active' : ''} \r\n        title=\"Justify\"\r\n      >\r\n        ⬌\r\n      </button>\r\n      \r\n      <div className=\"toolbar-separator\" />\r\n      \r\n      <select \r\n        onChange={(e) => onFormatText('fontName', e.target.value)}\r\n        defaultValue=\"Arial\"\r\n        title=\"Font Family\"\r\n      >\r\n        <option value=\"Arial\">Arial</option>\r\n        <option value=\"Times New Roman\">Times New Roman</option>\r\n        <option value=\"Courier New\">Courier New</option>\r\n        <option value=\"Georgia\">Georgia</option>\r\n        <option value=\"Verdana\">Verdana</option>\r\n      </select>\r\n      \r\n      <select \r\n        onChange={(e) => onFormatText('fontSize', e.target.value)}\r\n        defaultValue=\"16px\"\r\n        title=\"Font Size\"\r\n      >\r\n        <option value=\"10px\">10</option>\r\n        <option value=\"12px\">12</option>\r\n        <option value=\"14px\">14</option>\r\n        <option value=\"16px\">16</option>\r\n        <option value=\"18px\">18</option>\r\n        <option value=\"24px\">24</option>\r\n        <option value=\"32px\">32</option>\r\n      </select>\r\n      \r\n      <div className=\"toolbar-separator\" />\r\n      \r\n      <button \r\n        onClick={() => onFormatText('insertUnorderedList')} \r\n        title=\"Bullet List\"\r\n      >\r\n        • List\r\n      </button>\r\n      <button \r\n        onClick={() => onFormatText('insertOrderedList')} \r\n        title=\"Numbered List\"\r\n      >\r\n        1. List\r\n      </button>\r\n      <button \r\n        onClick={() => onFormatText('insertCheckList')} \r\n        title=\"Checklist\"\r\n      >\r\n        ☑️ List\r\n      </button>\r\n      \r\n      <div className=\"toolbar-separator\" />\r\n      \r\n      <button \r\n        onClick={() => {\r\n          const url = prompt('Enter URL:');\r\n          if (url) onFormatText('createLink', url);\r\n        }} \r\n        title=\"Insert Link\"\r\n      >\r\n        🔗 Link\r\n      </button>\r\n      <button \r\n        onClick={() => onFormatText('insertHTML', '<table border=\"1\"><tr><td>Cell 1</td><td>Cell 2</td></tr><tr><td>Cell 3</td><td>Cell 4</td></tr></table>')} \r\n        title=\"Insert Table\"\r\n      >\r\n        📊 Table\r\n      </button>\r\n      \r\n      {onAddPageBreak && (\r\n        <button \r\n          onClick={onAddPageBreak} \r\n          title=\"Insert Page Break\"\r\n        >\r\n          📄 Page Break\r\n        </button>\r\n      )}\r\n      \r\n      <div className=\"toolbar-separator\" />\r\n      \r\n      <button \r\n        onClick={() => onFormatText('undo')} \r\n        title=\"Undo\"\r\n      >\r\n        ↶ Undo\r\n      </button>\r\n      <button \r\n        onClick={() => onFormatText('redo')} \r\n        title=\"Redo\"\r\n      >\r\n        ↷ Redo\r\n      </button>\r\n      \r\n      <div className=\"toolbar-separator\" />\r\n      \r\n      <input \r\n        type=\"file\" \r\n        accept=\"image/*\" \r\n        onChange={(e) => e.target.files[0] && handleImageUpload(e.target.files[0])}\r\n        style={{ display: 'none' }}\r\n        id=\"image-upload\"\r\n      />\r\n      <button \r\n        onClick={() => document.getElementById('image-upload').click()} \r\n        title=\"Insert Image\"\r\n      >\r\n        🖼️ Image\r\n      </button>\r\n      \r\n      <div className=\"toolbar-separator\" />\r\n      \r\n      <select \r\n        value={pageSize}\r\n        onChange={(e) => onPageSizeChange(e.target.value)}\r\n        title=\"Page Size\"\r\n      >\r\n        <option value=\"A4\">A4</option>\r\n        <option value=\"Letter\">Letter</option>\r\n        <option value=\"Legal\">Legal</option>\r\n      </select>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EditorToolbar;\r\n","import React from 'react';\r\n\r\n/**\r\n * ContinuousPageView - MS Word-like continuous contenteditable surface\r\n * Single contenteditable div with manual page breaks using <page-break> tags\r\n * Content flows continuously with explicit page boundaries\r\n */\r\nconst ContinuousPageView = ({ \r\n  content, \r\n  dimensions, \r\n  pageSize,\r\n  pageBoundaries = [],\r\n  editorRef,\r\n  onInput,\r\n  onKeyDown,\r\n  onClick,\r\n  onScroll\r\n}) => {\r\n  const padding = {\r\n    top: 60,\r\n    bottom: 100,\r\n    left: 72,\r\n    right: 72\r\n  };\r\n\r\n  // Prevent deletion of page-break elements\r\n  const handleKeyDown = (event) => {\r\n    const selection = window.getSelection();\r\n    if (!selection || selection.rangeCount === 0) return;\r\n\r\n    const range = selection.getRangeAt(0);\r\n    const { startContainer, endContainer } = range;\r\n\r\n    // Check if we're trying to delete a page-break\r\n    const checkNode = (node) => {\r\n      if (!node) return false;\r\n      if (node.nodeType === Node.ELEMENT_NODE) {\r\n        return node.tagName === 'PAGE-BREAK' || node.getAttribute('data-page-break') === 'true';\r\n      }\r\n      return node.parentElement && checkNode(node.parentElement);\r\n    };\r\n\r\n    if (event.key === 'Backspace' || event.key === 'Delete') {\r\n      if (checkNode(startContainer) || checkNode(endContainer)) {\r\n        event.preventDefault();\r\n        return false;\r\n      }\r\n    }\r\n\r\n    if (onKeyDown) {\r\n      onKeyDown(event);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div \r\n      className=\"continuous-page-container\"\r\n      style={{\r\n        position: 'relative',\r\n        width: '100%',\r\n        maxWidth: `${dimensions.width}px`,\r\n        margin: '40px auto',\r\n        backgroundColor: 'transparent',\r\n        minHeight: '100vh'\r\n      }}\r\n    >\r\n      {/* Continuous contenteditable surface with page styling */}\r\n      <div\r\n        ref={editorRef}\r\n        contentEditable={true}\r\n        suppressContentEditableWarning={true}\r\n        className=\"continuous-content\"\r\n        style={{\r\n          position: 'relative',\r\n          zIndex: 1,\r\n          minHeight: `${dimensions.height}px`,\r\n          backgroundColor: 'white',\r\n          padding: `${padding.top}px ${padding.right}px ${padding.bottom}px ${padding.left}px`,\r\n          boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)',\r\n          outline: 'none',\r\n          cursor: 'text',\r\n          fontFamily: 'Arial, sans-serif',\r\n          fontSize: '16px',\r\n          lineHeight: '1.6',\r\n          color: '#333',\r\n          wordWrap: 'break-word',\r\n          whiteSpace: 'pre-wrap',\r\n          overflowWrap: 'break-word',\r\n          border: '1px solid #e0e0e0'\r\n        }}\r\n        onInput={onInput}\r\n        onKeyDown={handleKeyDown}\r\n        onClick={onClick}\r\n        onScroll={onScroll}\r\n        data-testid=\"continuous-editor\"\r\n      >\r\n        {/* Content is set via innerHTML in parent component */}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ContinuousPageView;\r\n","import React from 'react';\r\n\r\n/**\r\n * PageManager Component\r\n * Displays page thumbnails and controls for navigating between pages\r\n * @param {Object} props\r\n * @param {Array} props.pages - Array of page objects in the document\r\n * @param {number} props.activePage - Index of the currently active page\r\n * @param {string} props.pageSize - Current page size setting\r\n * @param {Function} props.onNavigate - Callback when page selection changes\r\n * @param {Function} props.onAddPage - Callback to add a new page (paged mode only)\r\n * @param {Function} props.onDeletePage - Callback to delete a page (paged mode only)\r\n * @param {Function} props.onPageSizeChange - Callback to change page size\r\n * @param {boolean} props.continuousMode - Whether in continuous mode (hides add/delete buttons)\r\n */\r\nexport const PageManager = ({ \r\n  pages, \r\n  activePage, \r\n  pageSize,\r\n  onNavigate, \r\n  onAddPage,\r\n  onDeletePage,\r\n  onPageSizeChange,\r\n  continuousMode = false\r\n}) => {\r\n  return (\r\n    <div className=\"page-manager\">\r\n      {/* Page Size Selector */}\r\n      <div className=\"page-size-controls\">\r\n        <label htmlFor=\"page-size-selector\">Page Size:</label>\r\n        <select\r\n          id=\"page-size-selector\"\r\n          role=\"combobox\"\r\n          aria-label=\"Page size selector\"\r\n          value={pageSize}\r\n          onChange={(e) => onPageSizeChange(e.target.value)}\r\n        >\r\n          <option value=\"A4\">A4</option>\r\n          <option value=\"Letter\">Letter</option>\r\n          <option value=\"Legal\">Legal</option>\r\n        </select>\r\n      </div>\r\n\r\n      <div className=\"page-list\">\r\n        {pages.map((page, index) => (\r\n          <div key={page.id} className=\"page-item\">\r\n            <button\r\n              type=\"button\"\r\n              className={`page-button ${index === activePage ? 'active' : ''}`}\r\n              onClick={() => onNavigate(index)}\r\n              aria-label={`Go to page ${index + 1}`}\r\n            >\r\n              Page {index + 1}\r\n            </button>\r\n            {/* Show delete button for all pages when more than 1 page exists */}\r\n            {!continuousMode && pages.length > 1 && (\r\n              <button\r\n                type=\"button\"\r\n                className=\"delete-page-button\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  onDeletePage(index);\r\n                }}\r\n                aria-label={`Delete page ${index + 1}`}\r\n                title=\"Delete this page and its content\"\r\n              >\r\n                ×\r\n              </button>\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n      {!continuousMode && (\r\n        <button\r\n          type=\"button\"\r\n          className=\"add-page-button\"\r\n          onClick={onAddPage}\r\n          aria-label=\"Add new page\"\r\n        >\r\n          + Add Page\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PageManager;","import React, { useCallback, useEffect, useRef, useState } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport {\r\n  setActivePage,\r\n  updatePageSize,\r\n  updateContinuousContent,\r\n  addPageBreak,\r\n  removePageBreak\r\n} from '../../store/slices/documentSlice';\r\nimport { useFormatting, useContinuousReflow } from '../../hooks';\r\nimport Sidebar from './Sidebar';\r\nimport EditorToolbar from './EditorToolbar';\r\nimport ContinuousPageView from './ContinuousPageView';\r\nimport PageManager from './PageManager';\r\nimport './MultiPageEditor.css';\r\nconst PAGE_DIMENSIONS = {\r\n  A4: { width: 794, height: 1123 },\r\n  Letter: { width: 816, height: 1056 },\r\n  Legal: { width: 816, height: 1344 }\r\n};\r\n\r\n/**\r\n * ContentEditableEditor - Main WYSIWYG HTML Editor Component\r\n * \r\n * @param {Object} props\r\n * @param {React.ReactNode} props.pageManagerComponent - Optional custom PageManager component from parent app\r\n * @param {Function} props.onNavigatePage - Optional callback when navigating to a page (pageIndex)\r\n * @param {Function} props.onAddPage - Optional callback when adding a page\r\n * @param {Function} props.onDeletePage - Optional callback when deleting a page (pageIndex)\r\n * @param {Function} props.onPageSizeChange - Optional callback when page size changes (newSize)\r\n * @param {boolean} props.showSidebar - Whether to show the sidebar (default: true)\r\n * @param {boolean} props.showToolbar - Whether to show the toolbar (default: true)\r\n */\r\nconst ContentEditableEditor = ({\r\n  pageManagerComponent = null,\r\n  onNavigatePage,\r\n  onAddPage,\r\n  onDeletePage,\r\n  onPageSizeChange: onPageSizeChangeCallback,\r\n  showSidebar = true,\r\n  showToolbar = true\r\n}) => {\r\n  const dispatch = useDispatch();\r\n  const documentState = useSelector((state) => state.document);\r\n  const { pageSize, continuousContent, pageBoundaries, activePage } = documentState;\r\n\r\n  const containerRef = useRef(null);\r\n  const editorRef = useRef(null);\r\n\r\n  const { currentFormat, formatText } = useFormatting();\r\n  const { \r\n    checkAndUpdateBoundaries, \r\n    getCurrentPage, \r\n    scrollToPage,\r\n    positionCursorAtPage,\r\n    updateBoundaries,\r\n    triggerAutoReflow,\r\n    removePageAndContent\r\n  } = useContinuousReflow(pageSize, editorRef);\r\n\r\n  const dimensions = PAGE_DIMENSIONS[pageSize] || PAGE_DIMENSIONS.A4;\r\n  const [sidebarCollapsed, setSidebarCollapsed] = useState(false);\r\n\r\n  // Initialize editor content\r\n  useEffect(() => {\r\n    if (editorRef.current && editorRef.current.innerHTML !== continuousContent) {\r\n      editorRef.current.innerHTML = continuousContent;\r\n      // Calculate initial boundaries after content is set\r\n      setTimeout(() => {\r\n        updateBoundaries();\r\n      }, 100);\r\n    }\r\n  }, [continuousContent, updateBoundaries]);\r\n\r\n  // Focus editor on mount\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      if (editorRef.current) {\r\n        editorRef.current.focus();\r\n      }\r\n    }, 200);\r\n    return () => clearTimeout(timer);\r\n  }, []);\r\n\r\n  const handleInput = useCallback((event) => {\r\n    const html = event.currentTarget.innerHTML;\r\n    dispatch(updateContinuousContent(html));\r\n    \r\n    // Update page boundaries after content change\r\n    checkAndUpdateBoundaries();\r\n    \r\n    // Trigger automatic reflow to insert page breaks when content overflows\r\n    triggerAutoReflow();\r\n    \r\n    // Update active page based on cursor position\r\n    const currentPage = getCurrentPage();\r\n    if (currentPage !== activePage) {\r\n      dispatch(setActivePage(currentPage));\r\n    }\r\n  }, [checkAndUpdateBoundaries, dispatch, getCurrentPage, activePage, triggerAutoReflow]);\r\n\r\n  const handlePageSizeChange = useCallback((newSize) => {\r\n    dispatch(updatePageSize(newSize));\r\n    // Recalculate boundaries with new page size\r\n    updateBoundaries({ pageSize: newSize });\r\n    \r\n    // Call parent callback if provided\r\n    if (onPageSizeChangeCallback) {\r\n      onPageSizeChangeCallback(newSize);\r\n    }\r\n  }, [dispatch, updateBoundaries, onPageSizeChangeCallback]);\r\n\r\n  const handleNavigatePage = useCallback((pageIndex) => {\r\n    dispatch(setActivePage(pageIndex));\r\n    scrollToPage(pageIndex, containerRef);\r\n    \r\n    // Call parent callback if provided\r\n    if (onNavigatePage) {\r\n      onNavigatePage(pageIndex);\r\n    }\r\n  }, [dispatch, scrollToPage, onNavigatePage]);\r\n\r\n  const handleAddPage = useCallback(() => {\r\n    // Add a page break at the end\r\n    dispatch(addPageBreak({ position: 'end' }));\r\n    \r\n    // Update boundaries after adding page break\r\n    setTimeout(() => {\r\n      updateBoundaries();\r\n    }, 100);\r\n    \r\n    // Call parent callback if provided\r\n    if (onAddPage) {\r\n      onAddPage();\r\n    }\r\n  }, [dispatch, updateBoundaries, onAddPage]);\r\n\r\n  const handleAddPageBreak = useCallback(() => {\r\n    // Insert page break at current cursor position\r\n    const selection = window.getSelection();\r\n    if (selection && selection.rangeCount > 0) {\r\n      if (!editorRef?.current) return;\r\n      \r\n      // Count existing page breaks to determine the page number\r\n      const existingBreaks = editorRef.current.querySelectorAll('page-break, [data-page-break=\"true\"]');\r\n      const pageNumber = existingBreaks.length + 2; // +2 because we're creating a break for the next page\r\n      \r\n      const pageBreakHTML = `<page-break data-page-break=\"true\" contenteditable=\"false\" data-page-number=\"${pageNumber}\"></page-break><p><br></p>`;\r\n      \r\n      // Insert the page break\r\n      document.execCommand('insertHTML', false, pageBreakHTML);\r\n      \r\n      // Update boundaries after a short delay\r\n      setTimeout(() => {\r\n        updateBoundaries();\r\n      }, 100);\r\n    }\r\n  }, [updateBoundaries, editorRef]);\r\n\r\n  const handleDeletePage = useCallback((pageIndex) => {\r\n    if (pageBoundaries.length <= 1) {\r\n      console.warn('Cannot delete the only page');\r\n      return;\r\n    }\r\n    \r\n    // Use the new removePageAndContent function from the hook\r\n    // This will remove both the page break and all content within that page\r\n    const success = removePageAndContent(pageIndex);\r\n    \r\n    if (success) {\r\n      // Set active page to the first page after deletion\r\n      dispatch(setActivePage(0));\r\n      \r\n      // Call parent callback if provided\r\n      if (onDeletePage) {\r\n        onDeletePage(pageIndex);\r\n      }\r\n    }\r\n  }, [pageBoundaries.length, removePageAndContent, dispatch, onDeletePage]);\r\n\r\n  const handleScroll = useCallback(() => {\r\n    if (!containerRef.current || !editorRef.current) return;\r\n\r\n    // Update active page based on scroll position\r\n    const currentPage = getCurrentPage();\r\n    if (currentPage !== activePage) {\r\n      dispatch(setActivePage(currentPage));\r\n    }\r\n  }, [getCurrentPage, activePage, dispatch]);\r\n\r\n  // Word count for sidebar\r\n  const wordCount = continuousContent\r\n    ? (continuousContent.replace(/<[^>]*>/g, ' ').match(/\\b\\w+\\b/g) || []).length\r\n    : 0;\r\n\r\n  const totalPages = pageBoundaries.length || 1;\r\n\r\n  return (\r\n    <div className=\"multi-page-editor\">\r\n      {showToolbar && (\r\n        <EditorToolbar\r\n          currentFormat={currentFormat}\r\n          pageSize={pageSize}\r\n          onFormatText={formatText}\r\n          onPageSizeChange={handlePageSizeChange}\r\n          onAddPageBreak={handleAddPageBreak}\r\n        />\r\n      )}\r\n\r\n      <div className=\"editor-container\">\r\n        {showSidebar && (\r\n          <Sidebar\r\n            editorView={null}\r\n            isCollapsed={sidebarCollapsed}\r\n            onToggle={() => setSidebarCollapsed((prev) => !prev)}\r\n            wordCount={wordCount}\r\n            pageCount={totalPages}\r\n          />\r\n        )}\r\n\r\n        <div\r\n          className=\"editor-viewport continuous-scroll\"\r\n          ref={containerRef}\r\n          onScroll={handleScroll}\r\n        >\r\n          <ContinuousPageView\r\n            content={continuousContent}\r\n            dimensions={dimensions}\r\n            pageSize={pageSize}\r\n            pageBoundaries={pageBoundaries}\r\n            editorRef={editorRef}\r\n            onInput={handleInput}\r\n            onClick={() => editorRef.current?.focus()}\r\n          />\r\n        </div>\r\n\r\n        {/* Render custom PageManager if provided, otherwise render default */}\r\n        <div className=\"page-manager-sidebar\">\r\n          {pageManagerComponent ? (\r\n            React.cloneElement(pageManagerComponent, {\r\n              pages: pageBoundaries.map((b, i) => ({ \r\n                id: b.id, \r\n                index: i,\r\n                size: pageSize \r\n              })),\r\n              activePage,\r\n              pageSize,\r\n              onNavigate: handleNavigatePage,\r\n              onAddPage: handleAddPage,\r\n              onDeletePage: handleDeletePage,\r\n              onPageSizeChange: handlePageSizeChange\r\n            })\r\n          ) : (\r\n            <PageManager\r\n              pages={pageBoundaries.map((b, i) => ({ \r\n                id: b.id, \r\n                index: i,\r\n                size: pageSize \r\n              }))}\r\n              activePage={activePage}\r\n              pageSize={pageSize}\r\n              onNavigate={handleNavigatePage}\r\n              onAddPage={handleAddPage}\r\n              onDeletePage={handleDeletePage}\r\n              onPageSizeChange={handlePageSizeChange}\r\n              continuousMode={false}\r\n            />\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ContentEditableEditor;\r\n","// Main library entry point\r\n// Export all public components, hooks, and utilities\r\n\r\n// Core Editor Component (without PageManager)\r\nexport { default as ContentEditableEditor } from './components/editor/ContentEditableEditor';\r\n\r\n// Individual Components (can be used separately)\r\nexport { default as EditorToolbar } from './components/editor/EditorToolbar';\r\nexport { default as Sidebar } from './components/editor/Sidebar';\r\nexport { default as ContinuousPageView } from './components/editor/ContinuousPageView';\r\n\r\n// PageManager is exported separately so parent apps can customize or replace it\r\nexport { default as PageManager } from './components/editor/PageManager';\r\n\r\n// Custom Hooks\r\nexport { useFormatting, useContinuousReflow } from './hooks';\r\n\r\n// Redux Store and Slice\r\nexport { default as documentReducer } from './store/slices/documentSlice';\r\nexport {\r\n  initializeDocument,\r\n  updateTitle,\r\n  updatePageContent,\r\n  updatePages,\r\n  addPage,\r\n  deletePage,\r\n  setActivePage,\r\n  updatePageSize,\r\n  resetDocument,\r\n  updateContinuousContent,\r\n  updatePageBoundaries,\r\n  addPageBreak,\r\n  removePageBreak,\r\n  setEditorMode\r\n} from './store/slices/documentSlice';\r\n\r\n// Storage utilities\r\nexport { saveImage, getImage, deleteImage, clearImages, getAllImageKeys } from './lib/storage/local-storage';\r\n\r\n// Constants\r\nexport const PAGE_DIMENSIONS = {\r\n  A4: { width: 794, height: 1123 },\r\n  Letter: { width: 816, height: 1056 },\r\n  Legal: { width: 816, height: 1344 }\r\n};\r\n\r\n// Logger utility\r\nexport { default as logger } from './lib/editor/utils/logger';\r\n"],"names":["REACT_ELEMENT_TYPE","REACT_FRAGMENT_TYPE","jsxProd","type","config","maybeKey","key","propName","reactJsxRuntime_production","getComponentNameFromType","REACT_CLIENT_REFERENCE","REACT_PROFILER_TYPE","REACT_STRICT_MODE_TYPE","REACT_SUSPENSE_TYPE","REACT_SUSPENSE_LIST_TYPE","REACT_ACTIVITY_TYPE","REACT_PORTAL_TYPE","REACT_CONTEXT_TYPE","REACT_CONSUMER_TYPE","REACT_FORWARD_REF_TYPE","innerType","REACT_MEMO_TYPE","REACT_LAZY_TYPE","testStringCoercion","value","checkKeyStringCoercion","JSCompiler_inline_result","JSCompiler_temp_const","JSCompiler_inline_result$jscomp$0","getTaskName","name","getOwner","dispatcher","ReactSharedInternals","UnknownOwner","hasValidKey","hasOwnProperty","getter","defineKeyPropWarningGetter","props","displayName","warnAboutAccessingKey","specialPropKeyWarningShown","elementRefGetterWithDeprecationWarning","componentName","didWarnAboutElementRef","ReactElement","self","source","owner","debugStack","debugTask","jsxDEVImpl","isStaticChildren","children","isArrayImpl","validateChildKeys","keys","k","didWarnAboutKeySpread","node","React","require$$0","createTask","callStackForError","unknownOwnerDebugStack","unknownOwnerDebugTask","reactJsxRuntime_development","trackActualOwner","jsxRuntimeModule","require$$1","DEFAULT_PAGE_SIZE","EMPTY_PARAGRAPH","createEmptyPage","index","size","uuidv4","withMinimumPage","pages","pageSize","page","sanitizeContent","html","buildInitialState","overrides","now","initialState","documentSlice","createSlice","state","action","initialContent","pageIndex","content","payload","nextPages","_","insertIndex","newSize","position","pageBreakTag","before","after","tempDiv","pageBreaks","breakEl","newMode","allContent","initializeDocument","updateTitle","updatePageContent","updatePages","addPage","deletePage","setActivePage","updatePageSize","resetDocument","updateContinuousContent","updatePageBoundaries","addPageBreak","removePageBreak","setEditorMode","documentSlice$1","useFormatting","currentFormat","setCurrentFormat","useState","formatText","useCallback","command","prev","PAGE_DIMENSIONS","CONTENT_PADDING","useContinuousReflow","editorRef","dispatch","useDispatch","boundaryTimeoutRef","useRef","reflowTimeoutRef","latestPageSizeRef","isReflowingRef","useEffect","findOverflowPoint","pageElements","maxHeight","currentHeight","i","element","elementHeight","insertPageBreakBefore","targetElement","pageNumber","editor","pageBreak","error","checkAndReflow","targetPageSize","allChildren","existingBreaks","el","currentPage","child","insertedBreaks","overflow","updateBoundaries","triggerAutoReflow","delay","calculatePageBoundaries","options","dimensions","pageBreakElements","boundaries","rect","editorRect","relativeTop","checkAndUpdateBoundaries","getCurrentPage","selection","range","currentNode","scrollToPage","containerRef","targetBoundary","b","positionCursorAtPage","targetNode","targetOffset","breakElement","removePageAndContent","cursorWasInDeletedContent","nodesToRemove","pageBreakToRemove","firstPageBreak","pageBreakElement","nextPageBreakElement","cursorNode","updatedHTML","Sidebar","editorView","isCollapsed","onToggle","propWordCount","propPageCount","documentState","useSelector","activePage","continuousContent","editorMode","wordCount","setWordCount","outline","setOutline","headingElements","headings","heading","level","text","totalWords","words","word","displayPageCount","jsxs","jsx","generateUUID","c","r","saveImage","file","resolve","reject","reader","event","dataUrl","getImage","deleteImage","clearImages","getAllImageKeys","Logger","namespace","message","data","logger","EditorToolbar","onFormatText","onPageSizeChange","onAddPageBreak","handleImageUpload","imageUrl","e","url","ContinuousPageView","pageBoundaries","onInput","onKeyDown","onClick","onScroll","padding","handleKeyDown","startContainer","endContainer","checkNode","PageManager","onNavigate","onAddPage","onDeletePage","continuousMode","ContentEditableEditor","pageManagerComponent","onNavigatePage","onPageSizeChangeCallback","showSidebar","showToolbar","sidebarCollapsed","setSidebarCollapsed","timer","handleInput","handlePageSizeChange","handleNavigatePage","handleAddPage","handleAddPageBreak","pageBreakHTML","handleDeletePage","handleScroll","totalPages"],"mappings":"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","x_google_ignoreList":[0,1,2]}