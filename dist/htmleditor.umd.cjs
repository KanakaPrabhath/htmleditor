(function(f,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("react"),require("react-redux"),require("@reduxjs/toolkit"),require("uuid")):typeof define=="function"&&define.amd?define(["exports","react","react-redux","@reduxjs/toolkit","uuid"],g):(f=typeof globalThis<"u"?globalThis:f||self,g(f.HTMLEditor={},f.React,f.ReactRedux,f.RTK,f.uuid))})(this,(function(f,g,X,we,re){"use strict";var Z={exports:{}},W={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ce;function Ne(){if(ce)return W;ce=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function a(o,i,s){var d=null;if(s!==void 0&&(d=""+s),i.key!==void 0&&(d=""+i.key),"key"in i){s={};for(var h in i)h!=="key"&&(s[h]=i[h])}else s=i;return i=s.ref,{$$typeof:e,type:o,key:d,ref:i!==void 0?i:null,props:s}}return W.Fragment=n,W.jsx=a,W.jsxs=a,W}var Y={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ue;function Te(){return ue||(ue=1,process.env.NODE_ENV!=="production"&&(function(){function e(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===z?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case T:return"Fragment";case R:return"Profiler";case L:return"StrictMode";case l:return"Suspense";case k:return"SuspenseList";case A:return"Activity"}if(typeof t=="object")switch(typeof t.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),t.$$typeof){case N:return"Portal";case p:return(t.displayName||"Context")+".Provider";case c:return(t._context.displayName||"Context")+".Consumer";case x:var u=t.render;return t=t.displayName,t||(t=u.displayName||u.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case b:return u=t.displayName||null,u!==null?u:e(t.type)||"Memo";case y:u=t._payload,t=t._init;try{return e(t(u))}catch{}}return null}function n(t){return""+t}function a(t){try{n(t);var u=!1}catch{u=!0}if(u){u=console;var v=u.error,I=typeof Symbol=="function"&&Symbol.toStringTag&&t[Symbol.toStringTag]||t.constructor.name||"Object";return v.call(u,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",I),n(t)}}function o(t){if(t===T)return"<>";if(typeof t=="object"&&t!==null&&t.$$typeof===y)return"<...>";try{var u=e(t);return u?"<"+u+">":"<...>"}catch{return"<...>"}}function i(){var t=C.A;return t===null?null:t.getOwner()}function s(){return Error("react-stack-top-frame")}function d(t){if(P.call(t,"key")){var u=Object.getOwnPropertyDescriptor(t,"key").get;if(u&&u.isReactWarning)return!1}return t.key!==void 0}function h(t,u){function v(){F||(F=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",u))}v.isReactWarning=!0,Object.defineProperty(t,"key",{get:v,configurable:!0})}function w(){var t=e(this.type);return K[t]||(K[t]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),t=this.props.ref,t!==void 0?t:null}function m(t,u,v,I,U,M,ie,se){return v=M.ref,t={$$typeof:D,type:t,key:u,props:M,_owner:U},(v!==void 0?v:null)!==null?Object.defineProperty(t,"ref",{enumerable:!1,get:w}):Object.defineProperty(t,"ref",{enumerable:!1,value:null}),t._store={},Object.defineProperty(t._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(t,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(t,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:ie}),Object.defineProperty(t,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:se}),Object.freeze&&(Object.freeze(t.props),Object.freeze(t)),t}function _(t,u,v,I,U,M,ie,se){var O=u.children;if(O!==void 0)if(I)if(j(O)){for(I=0;I<O.length;I++)E(O[I]);Object.freeze&&Object.freeze(O)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else E(O);if(P.call(u,"key")){O=e(t);var G=Object.keys(u).filter(function(Ze){return Ze!=="key"});I=0<G.length?"{key: someKey, "+G.join(": ..., ")+": ...}":"{key: someKey}",ae[O+I]||(G=0<G.length?"{"+G.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,I,O,G,O),ae[O+I]=!0)}if(O=null,v!==void 0&&(a(v),O=""+v),d(u)&&(a(u.key),O=""+u.key),"key"in u){v={};for(var le in u)le!=="key"&&(v[le]=u[le])}else v=u;return O&&h(v,typeof t=="function"?t.displayName||t.name||"Unknown":t),m(t,O,M,U,i(),v,ie,se)}function E(t){typeof t=="object"&&t!==null&&t.$$typeof===D&&t._store&&(t._store.validated=1)}var S=g,D=Symbol.for("react.transitional.element"),N=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),L=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),p=Symbol.for("react.context"),x=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),k=Symbol.for("react.suspense_list"),b=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),A=Symbol.for("react.activity"),z=Symbol.for("react.client.reference"),C=S.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,P=Object.prototype.hasOwnProperty,j=Array.isArray,B=console.createTask?console.createTask:function(){return null};S={react_stack_bottom_frame:function(t){return t()}};var F,K={},te=S.react_stack_bottom_frame.bind(S,s)(),ne=B(o(s)),ae={};Y.Fragment=T,Y.jsx=function(t,u,v,I,U){var M=1e4>C.recentlyCreatedOwnerStacks++;return _(t,u,v,!1,I,U,M?Error("react-stack-top-frame"):te,M?B(o(t)):ne)},Y.jsxs=function(t,u,v,I,U){var M=1e4>C.recentlyCreatedOwnerStacks++;return _(t,u,v,!0,I,U,M?Error("react-stack-top-frame"):te,M?B(o(t)):ne)}})()),Y}var de;function Re(){return de||(de=1,process.env.NODE_ENV==="production"?Z.exports=Ne():Z.exports=Te()),Z.exports}var r=Re();const Q="A4",H="<p><br></p>",J=(e,n=Q)=>({id:re.v4(),index:e,size:n,content:H,images:[],isBreakPoint:!1}),ge=(e,n=Q)=>(e.length>0?e:[J(0,n)]).map((o,i)=>({id:o.id||re.v4(),index:i,size:o.size||n,content:q(o.content),images:o.images||[],isBreakPoint:!!o.isBreakPoint})),q=e=>typeof e!="string"||e.trim()===""?H:e,oe=(e={})=>{const n=new Date().toISOString(),a=e.pageSize||Q,o=ge(e.pages||[J(0,a)],a);return{id:re.v4(),title:e.title||"Untitled Document",createdAt:n,updatedAt:n,pageSize:a,pages:o,activePage:e.activePage&&e.activePage<o.length?e.activePage:0,pageBreaks:e.pageBreaks||[],totalPages:o.length,editorMode:e.editorMode||"continuous",continuousContent:e.continuousContent||H,pageBoundaries:e.pageBoundaries||[]}},Ie=oe(),pe=we.createSlice({name:"document",initialState:Ie,reducers:{initializeDocument:(e,n)=>{const{initialContent:a=H,pageSize:o=Q}=n.payload||{},i={...J(0,o),content:q(a)};return oe({title:e.title,pageSize:o,pages:[i]})},updateTitle:(e,n)=>{e.title=n.payload,e.updatedAt=new Date().toISOString()},updatePageContent:(e,n)=>{const{pageIndex:a,content:o}=n.payload;a<0||a>=e.pages.length||(e.pages[a].content=q(o),e.updatedAt=new Date().toISOString())},updatePages:(e,n)=>{const a=Array.isArray(n.payload)?{pages:n.payload}:n.payload||{},o=ge(a.pages||[],e.pageSize);e.pages=o,e.activePage=Math.min(e.activePage,o.length-1),e.pageBreaks=Array.isArray(a.pageBreaks)?a.pageBreaks:o.slice(0,-1).map((i,s)=>({id:`auto-break-${s}`,pageNumber:s+1})),e.totalPages=o.length,e.updatedAt=new Date().toISOString()},addPage:(e,n)=>{const a=typeof n.payload?.index=="number"?Math.min(Math.max(n.payload.index,0),e.pages.length):e.pages.length;e.pages.splice(a,0,J(a,e.pageSize)),e.pages=e.pages.map((o,i)=>({...o,index:i,size:e.pageSize})),e.activePage=a,e.pageBreaks=e.pages.slice(0,-1).map((o,i)=>({id:`auto-break-${i}`,pageNumber:i+1})),e.totalPages=e.pages.length,e.updatedAt=new Date().toISOString()},deletePage:(e,n)=>{const a=n.payload;e.pages.length<=1||(e.pages.splice(a,1),e.pages=e.pages.map((o,i)=>({...o,index:i,size:e.pageSize})),e.activePage>=e.pages.length?e.activePage=e.pages.length-1:a<=e.activePage&&e.activePage>0&&(e.activePage-=1),e.pageBreaks=e.pages.slice(0,-1).map((o,i)=>({id:`auto-break-${i}`,pageNumber:i+1})),e.totalPages=e.pages.length,e.updatedAt=new Date().toISOString())},setActivePage:(e,n)=>{const a=n.payload;a>=0&&a<e.pages.length&&a!==e.activePage&&(e.activePage=a,e.updatedAt=new Date().toISOString())},updatePageSize:(e,n)=>{const a=n.payload;e.pageSize=a,e.pages=e.pages.map((o,i)=>({...o,index:i,size:a})),e.pageBreaks=e.pages.slice(0,-1).map((o,i)=>({id:`auto-break-${i}`,pageNumber:i+1})),e.updatedAt=new Date().toISOString()},resetDocument:()=>oe(),updateContinuousContent:(e,n)=>{e.continuousContent=q(n.payload),e.updatedAt=new Date().toISOString()},updatePageBoundaries:(e,n)=>{e.pageBoundaries=n.payload||[],e.totalPages=e.pageBoundaries.length,e.updatedAt=new Date().toISOString()},addPageBreak:(e,n)=>{const{position:a="end"}=n.payload||{},o='<page-break data-page-break="true" style="display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;"></page-break>';if(a==="end")e.continuousContent=e.continuousContent+o+"<p><br></p>";else if(typeof a=="number"){const i=e.continuousContent.substring(0,a),s=e.continuousContent.substring(a);e.continuousContent=i+o+s}e.updatedAt=new Date().toISOString()},removePageBreak:(e,n)=>{const{pageIndex:a}=n.payload||{};if(typeof a=="number"&&typeof document<"u"){const o=document.createElement("div");o.innerHTML=e.continuousContent;const i=o.querySelectorAll('page-break, [data-page-break="true"]');i[a]&&i[a].remove(),o.querySelectorAll('page-break, [data-page-break="true"]').forEach((d,h)=>{d.setAttribute("data-page-number",String(h+2))}),e.continuousContent=o.innerHTML,e.updatedAt=new Date().toISOString()}},setEditorMode:(e,n)=>{const a=n.payload;if(a!==e.editorMode){if(e.editorMode=a,a==="continuous"){const o=e.pages.map(i=>i.content).filter(i=>i&&i!==H).join(`
`);e.continuousContent=o||H}else e.continuousContent&&e.continuousContent!==H&&(e.pages=[{...J(0,e.pageSize),content:e.continuousContent}]);e.updatedAt=new Date().toISOString()}}}}),{initializeDocument:_e,updateTitle:Be,updatePageContent:Oe,updatePages:Le,addPage:De,deletePage:ze,setActivePage:V,updatePageSize:fe,resetDocument:Me,updateContinuousContent:$,updatePageBoundaries:me,addPageBreak:he,removePageBreak:Ue,setEditorMode:He}=pe.actions,Ge=pe.reducer,be=()=>{const[e,n]=g.useState({bold:!1,italic:!1,underline:!1,strikethrough:!1,alignLeft:!1,alignCenter:!1,alignRight:!1,alignJustify:!1,fontFamily:"Arial",fontSize:"16px"}),a=g.useCallback((o,i=null)=>{document.execCommand(o,!1,i),o==="bold"?n(s=>({...s,bold:!s.bold})):o==="italic"?n(s=>({...s,italic:!s.italic})):o==="underline"?n(s=>({...s,underline:!s.underline})):o==="strikethrough"?n(s=>({...s,strikethrough:!s.strikethrough})):o==="justifyLeft"?n(s=>({...s,alignLeft:!0,alignCenter:!1,alignRight:!1,alignJustify:!1})):o==="justifyCenter"?n(s=>({...s,alignLeft:!1,alignCenter:!0,alignRight:!1,alignJustify:!1})):o==="justifyRight"?n(s=>({...s,alignLeft:!1,alignCenter:!1,alignRight:!0,alignJustify:!1})):o==="justifyFull"&&n(s=>({...s,alignLeft:!1,alignCenter:!1,alignRight:!1,alignJustify:!0}))},[]);return{currentFormat:e,formatText:a}},ee={A4:{width:794,height:1123},Letter:{width:816,height:1056},Legal:{width:816,height:1344}},ke={top:60,bottom:100,left:72,right:72},xe=(e,n)=>{const a=X.useDispatch(),o=g.useRef(null),i=g.useRef(null),s=g.useRef(e),d=g.useRef(!1);g.useEffect(()=>{s.current=e},[e]),g.useEffect(()=>()=>{o.current&&clearTimeout(o.current),i.current&&clearTimeout(i.current)},[]);const h=g.useCallback((c,p)=>{let x=0;for(let l=0;l<c.length;l++){const k=c[l],b=k.getBoundingClientRect().height;if(x+b>p)return{overflowIndex:l,overflowElement:k,accumulatedHeight:x};x+=b}return null},[]),w=g.useCallback((c,p)=>{if(!c||!n?.current)return!1;try{const x=n.current,l=document.createElement("page-break");return l.setAttribute("data-page-break","true"),l.setAttribute("contenteditable","false"),l.setAttribute("data-page-number",p||"2"),c.parentNode.insertBefore(l,c),!0}catch(x){return console.warn("[insertPageBreakBefore] Failed to insert page break:",x),!1}},[n]),m=g.useCallback(()=>{if(!(!n?.current||d.current))try{d.current=!0;const c=n.current,p=s.current||"A4",l=(ee[p]||ee.A4).height-ke.top-ke.bottom,k=Array.from(c.children),b=k.filter(C=>C.tagName==="PAGE-BREAK"||C.getAttribute("data-page-break")==="true"),y=[];let A=[];for(const C of k)C.tagName==="PAGE-BREAK"||C.getAttribute("data-page-break")==="true"?A.length>0&&(y.push(A),A=[]):A.push(C);A.length>0&&y.push(A),y.length===0&&k.length>0&&y.push(k.filter(C=>!(C.tagName==="PAGE-BREAK"||C.getAttribute("data-page-break")==="true")));let z=!1;for(let C=0;C<y.length;C++){const P=y[C],j=h(P,l);if(j&&j.overflowIndex>0){const B=C+2;if(w(j.overflowElement,B)){z=!0;break}}}if(z){const C=c.innerHTML;a($(C)),setTimeout(()=>{S()},50)}}catch(c){console.warn("[checkAndReflow] Reflow failed:",c)}finally{d.current=!1}},[n,h,w,a]),_=g.useCallback((c=500)=>{i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{i.current=null,m()},c)},[m]),E=g.useCallback((c={})=>{if(!n?.current||typeof document>"u")return[];const p=c.pageSize||s.current||"A4",x=ee[p]||ee.A4,l=n.current,k=l.querySelectorAll('page-break, [data-page-break="true"]'),b=[];return b.push({id:"page-0",pageNumber:1,top:0,height:x.height}),k.forEach((y,A)=>{const z=y.getBoundingClientRect(),C=l.getBoundingClientRect(),P=z.top-C.top+l.scrollTop;b.push({id:`page-${A+1}`,pageNumber:A+2,top:P,height:x.height})}),b},[n]),S=g.useCallback((c={})=>{const p=E(c);return a(me(p)),p},[E,a]),D=g.useCallback((c={})=>{o.current&&clearTimeout(o.current);const p=typeof c.delay=="number"?c.delay:300;o.current=setTimeout(()=>{o.current=null,S(c)},Math.max(0,p))},[S]),N=g.useCallback(()=>{if(!n?.current)return 0;const c=window.getSelection();if(!c||c.rangeCount===0)return 0;try{const p=c.getRangeAt(0),x=n.current;let l=p.startContainer;const k=Array.from(x.querySelectorAll('page-break, [data-page-break="true"]'));if(k.length===0)return 0;for(;l&&l!==x;){for(let b=k.length-1;b>=0;b--)if(k[b].compareDocumentPosition(l)&Node.DOCUMENT_POSITION_FOLLOWING)return b+1;l=l.parentNode}return 0}catch(p){return console.warn("[getCurrentPage] Failed to calculate page:",p),0}},[n]),T=g.useCallback((c,p)=>{if(!p?.current||!n?.current)return;n.current;const l=E().find(k=>k.pageNumber===c+1);l&&(p.current.scrollTo({top:l.top-40,behavior:"smooth"}),setTimeout(()=>{L(c)},300))},[n]),L=g.useCallback(c=>{if(!n?.current)return;const p=n.current;p.focus();try{let x=null,l=0;if(c===0)x=p.firstChild,l=0;else{const b=p.querySelectorAll('page-break, [data-page-break="true"]')[c-1];b&&b.nextSibling&&(x=b.nextSibling,l=0)}if(x){const k=document.createRange(),b=window.getSelection();x.nodeType===Node.TEXT_NODE?k.setStart(x,l):k.setStart(x,0),k.collapse(!0),b.removeAllRanges(),b.addRange(k)}}catch(x){console.warn("[positionCursorAtPage] Failed to position cursor:",x)}},[n]),R=g.useCallback(c=>{if(!n?.current)return!1;const p=n.current;if(E().length<=1)return console.warn("[removePageAndContent] Cannot delete the only page"),!1;try{const l=Array.from(p.querySelectorAll('page-break, [data-page-break="true"]'));if(c>l.length)return console.warn("[removePageAndContent] Invalid page index"),!1;const k=window.getSelection();let b=!1,y=[],A=null;if(c===0){const P=l[0];if(!P)return console.warn("[removePageAndContent] No page break found for first page"),!1;let j=p.firstChild;for(;j&&j!==P;)y.push(j),j=j.nextSibling;A=P}else{const P=l[c-1];if(!P)return console.warn("[removePageAndContent] Page break not found"),!1;const j=l[c];let B=P.nextSibling;for(;B&&B!==j;)y.push(B),B=B.nextSibling;A=P}if(k&&k.rangeCount>0){const j=k.getRangeAt(0).startContainer;for(const B of y)if(B.contains(j)||B===j){b=!0;break}}A&&A.parentNode&&A.remove(),y.forEach(P=>{P.parentNode&&P.remove()}),p.querySelectorAll('page-break, [data-page-break="true"]').forEach((P,j)=>{P.setAttribute("data-page-number",String(j+2))}),b&&setTimeout(()=>{L(0)},50);const C=p.innerHTML;return a($(C)),setTimeout(()=>{S()},100),!0}catch(l){return console.error("[removePageAndContent] Failed to remove page:",l),!1}},[n,E,a,S,L]);return{calculatePageBoundaries:E,checkAndUpdateBoundaries:D,updateBoundaries:S,getCurrentPage:N,scrollToPage:T,positionCursorAtPage:L,checkAndReflow:m,triggerAutoReflow:_,removePageAndContent:R,boundaryTimeoutRef:o,reflowTimeoutRef:i}},ve=({editorView:e,isCollapsed:n,onToggle:a,wordCount:o,pageCount:i})=>{const s=X.useSelector(T=>T.document),{pages:d,activePage:h,continuousContent:w,editorMode:m}=s,[_,E]=g.useState(0),[S,D]=g.useState([]);g.useEffect(()=>{if(o!==void 0&&i!==void 0){if(E(o),w){const R=document.createElement("div");R.innerHTML=w;const c=R.querySelectorAll("h1, h2, h3, h4, h5, h6"),p=Array.from(c).map((x,l)=>{const k=parseInt(x.tagName.charAt(1)),b=x.textContent.trim();return b?{id:`heading-${l}`,level:k,text:b,page:1}:null}).filter(Boolean);D(p)}return}let T=0;const L=[];d.forEach((R,c)=>{if(R.content){const p=document.createElement("div");p.innerHTML=R.content;const l=(p.textContent||p.innerText||"").trim().split(/\s+/).filter(b=>b.length>0);T+=l.length,p.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach((b,y)=>{const A=parseInt(b.tagName.charAt(1)),z=b.textContent.trim();z&&L.push({id:`heading-${c}-${y}`,level:A,text:z,page:c+1})})}}),E(T),D(L)},[d,o,i,w]);const N=i!==void 0?i:d.length;return r.jsxs("aside",{className:`sidebar ${n?"collapsed":""}`,role:"complementary","aria-label":"Document information","data-testid":"sidebar",children:[r.jsxs("div",{className:"sidebar-header",children:[r.jsx("h2",{children:"Document Info"}),r.jsx("button",{className:"sidebar-toggle",onClick:a,"aria-label":n?"Expand sidebar":"Collapse sidebar",title:n?"Expand sidebar":"Collapse sidebar",children:n?"▶":"◀"})]}),!n&&r.jsxs("div",{className:"sidebar-content",children:[r.jsxs("div",{className:"sidebar-section",children:[r.jsx("h3",{children:"Statistics"}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Pages:"}),r.jsx("span",{className:"stat-value",children:N})]}),r.jsxs("div",{className:"stat-item","data-testid":"word-count",children:[r.jsx("span",{className:"stat-label",children:"Words:"}),r.jsx("span",{className:"stat-value",children:_.toLocaleString()})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Active Page:"}),r.jsx("span",{className:"stat-value",children:h+1})]})]}),S.length>0&&r.jsxs("div",{className:"sidebar-section",children:[r.jsx("h3",{children:"Document Outline"}),r.jsx("div",{className:"document-outline","data-testid":"outline",children:S.map(T=>r.jsxs("div",{className:`outline-item outline-level-${T.level}`,style:{marginLeft:`${(T.level-1)*12}px`},children:[r.jsx("span",{className:"outline-text",children:T.text}),r.jsxs("span",{className:"outline-page",children:["p.",T.page]})]},T.id))})]}),r.jsxs("div",{className:"sidebar-section",children:[r.jsx("h3",{children:"Document"}),r.jsx("p",{children:"HTML Editor"}),r.jsx("p",{children:"Multi-page support"})]})]})]})};function We(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const n=Math.random()*16|0;return(e==="x"?n:n&3|8).toString(16)})}function Ce(e){return new Promise((n,a)=>{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(e.type)){a(new Error("Invalid image format. Supported formats: png, jpeg, gif, webp"));return}if(e.size>5*1024*1024){a(new Error("Image exceeds maximum size of 5MB"));return}const i=new FileReader;i.onload=s=>{const d=s.target.result;if(d.split(",")[1].length*3/4>5*1024*1024){a(new Error("Image exceeds maximum size of 5MB"));return}try{const m=`editor-image-${We()}`;localStorage.setItem(m,d),n(m)}catch(m){m.name==="QuotaExceededError"?a(new Error("Storage quota exceeded")):a(m)}},i.onerror=()=>{a(new Error("Error reading image file"))},i.readAsDataURL(e)})}function Ye(e){return localStorage.getItem(e)}function Je(e){localStorage.removeItem(e)}function Ve(){Object.keys(localStorage).forEach(e=>{e.startsWith("editor-image-")&&localStorage.removeItem(e)})}function Fe(){return Object.keys(localStorage).filter(e=>e.startsWith("editor-image-"))}class Se{constructor(n="Editor"){this.namespace=n}_format(n,a,o){return`[${new Date().toISOString()}] [${this.namespace}] [${n}] ${a}`}info(n,a){}warn(n,a){}error(n,a){}debug(n,a){}}const Ee=new Se("Editor"),Pe=({currentFormat:e,pageSize:n,onFormatText:a,onPageSizeChange:o,onAddPageBreak:i})=>{const s=async d=>{try{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(d.type)){alert("Invalid image format. Supported: PNG, JPEG, GIF, WEBP");return}if(d.size>5242880){alert("Image exceeds maximum size of 5MB");return}const w=await Ce(d),m=localStorage.getItem(w);m&&(document.execCommand("insertImage",!1,m),Ee.info("Image inserted",{key:w}))}catch(h){Ee.error("Error uploading image",h)}};return r.jsxs("div",{className:"editor-toolbar",children:[r.jsx("button",{onClick:()=>a("bold"),className:e.bold?"active":"",title:"Bold",children:r.jsx("strong",{children:"B"})}),r.jsx("button",{onClick:()=>a("italic"),className:e.italic?"active":"",title:"Italic",children:r.jsx("em",{children:"I"})}),r.jsx("button",{onClick:()=>a("underline"),className:e.underline?"active":"",title:"Underline",children:r.jsx("u",{children:"U"})}),r.jsx("button",{onClick:()=>a("strikethrough"),className:e.strikethrough?"active":"",title:"Strikethrough",children:r.jsx("s",{children:"S"})}),r.jsx("div",{className:"toolbar-separator"}),r.jsx("button",{onClick:()=>a("justifyLeft"),className:e.alignLeft?"active":"",title:"Align Left",children:"⬅️"}),r.jsx("button",{onClick:()=>a("justifyCenter"),className:e.alignCenter?"active":"",title:"Align Center",children:"⬌"}),r.jsx("button",{onClick:()=>a("justifyRight"),className:e.alignRight?"active":"",title:"Align Right",children:"➡️"}),r.jsx("button",{onClick:()=>a("justifyFull"),className:e.alignJustify?"active":"",title:"Justify",children:"⬌"}),r.jsx("div",{className:"toolbar-separator"}),r.jsxs("select",{onChange:d=>a("fontName",d.target.value),defaultValue:"Arial",title:"Font Family",children:[r.jsx("option",{value:"Arial",children:"Arial"}),r.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),r.jsx("option",{value:"Courier New",children:"Courier New"}),r.jsx("option",{value:"Georgia",children:"Georgia"}),r.jsx("option",{value:"Verdana",children:"Verdana"})]}),r.jsxs("select",{onChange:d=>a("fontSize",d.target.value),defaultValue:"16px",title:"Font Size",children:[r.jsx("option",{value:"10px",children:"10"}),r.jsx("option",{value:"12px",children:"12"}),r.jsx("option",{value:"14px",children:"14"}),r.jsx("option",{value:"16px",children:"16"}),r.jsx("option",{value:"18px",children:"18"}),r.jsx("option",{value:"24px",children:"24"}),r.jsx("option",{value:"32px",children:"32"})]}),r.jsx("div",{className:"toolbar-separator"}),r.jsx("button",{onClick:()=>a("insertUnorderedList"),title:"Bullet List",children:"• List"}),r.jsx("button",{onClick:()=>a("insertOrderedList"),title:"Numbered List",children:"1. List"}),r.jsx("button",{onClick:()=>a("insertCheckList"),title:"Checklist",children:"☑️ List"}),r.jsx("div",{className:"toolbar-separator"}),r.jsx("button",{onClick:()=>{const d=prompt("Enter URL:");d&&a("createLink",d)},title:"Insert Link",children:"🔗 Link"}),r.jsx("button",{onClick:()=>a("insertHTML",'<table border="1"><tr><td>Cell 1</td><td>Cell 2</td></tr><tr><td>Cell 3</td><td>Cell 4</td></tr></table>'),title:"Insert Table",children:"📊 Table"}),i&&r.jsx("button",{onClick:i,title:"Insert Page Break",children:"📄 Page Break"}),r.jsx("div",{className:"toolbar-separator"}),r.jsx("button",{onClick:()=>a("undo"),title:"Undo",children:"↶ Undo"}),r.jsx("button",{onClick:()=>a("redo"),title:"Redo",children:"↷ Redo"}),r.jsx("div",{className:"toolbar-separator"}),r.jsx("input",{type:"file",accept:"image/*",onChange:d=>d.target.files[0]&&s(d.target.files[0]),style:{display:"none"},id:"image-upload"}),r.jsx("button",{onClick:()=>document.getElementById("image-upload").click(),title:"Insert Image",children:"🖼️ Image"}),r.jsx("div",{className:"toolbar-separator"}),r.jsxs("select",{value:n,onChange:d=>o(d.target.value),title:"Page Size",children:[r.jsx("option",{value:"A4",children:"A4"}),r.jsx("option",{value:"Letter",children:"Letter"}),r.jsx("option",{value:"Legal",children:"Legal"})]})]})},Ae=({content:e,dimensions:n,pageSize:a,pageBoundaries:o=[],editorRef:i,onInput:s,onKeyDown:d,onClick:h,onScroll:w})=>{const m={top:60,bottom:100,left:72,right:72},_=E=>{const S=window.getSelection();if(!S||S.rangeCount===0)return;const D=S.getRangeAt(0),{startContainer:N,endContainer:T}=D,L=R=>R?R.nodeType===Node.ELEMENT_NODE?R.tagName==="PAGE-BREAK"||R.getAttribute("data-page-break")==="true":R.parentElement&&L(R.parentElement):!1;if((E.key==="Backspace"||E.key==="Delete")&&(L(N)||L(T)))return E.preventDefault(),!1;d&&d(E)};return r.jsx("div",{className:"continuous-page-container",style:{position:"relative",width:"100%",maxWidth:`${n.width}px`,margin:"40px auto",backgroundColor:"transparent",minHeight:"100vh"},children:r.jsx("div",{ref:i,contentEditable:!0,suppressContentEditableWarning:!0,className:"continuous-content",style:{position:"relative",zIndex:1,minHeight:`${n.height}px`,backgroundColor:"white",padding:`${m.top}px ${m.right}px ${m.bottom}px ${m.left}px`,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",outline:"none",cursor:"text",fontFamily:"Arial, sans-serif",fontSize:"16px",lineHeight:"1.6",color:"#333",wordWrap:"break-word",whiteSpace:"pre-wrap",overflowWrap:"break-word",border:"1px solid #e0e0e0"},onInput:s,onKeyDown:_,onClick:h,onScroll:w,"data-testid":"continuous-editor"})})},ye=({pages:e,activePage:n,pageSize:a,onNavigate:o,onAddPage:i,onDeletePage:s,onPageSizeChange:d,continuousMode:h=!1})=>r.jsxs("div",{className:"page-manager",children:[r.jsxs("div",{className:"page-size-controls",children:[r.jsx("label",{htmlFor:"page-size-selector",children:"Page Size:"}),r.jsxs("select",{id:"page-size-selector",role:"combobox","aria-label":"Page size selector",value:a,onChange:w=>d(w.target.value),children:[r.jsx("option",{value:"A4",children:"A4"}),r.jsx("option",{value:"Letter",children:"Letter"}),r.jsx("option",{value:"Legal",children:"Legal"})]})]}),r.jsx("div",{className:"page-list",children:e.map((w,m)=>r.jsxs("div",{className:"page-item",children:[r.jsxs("button",{type:"button",className:`page-button ${m===n?"active":""}`,onClick:()=>o(m),"aria-label":`Go to page ${m+1}`,children:["Page ",m+1]}),!h&&e.length>1&&r.jsx("button",{type:"button",className:"delete-page-button",onClick:_=>{_.stopPropagation(),s(m)},"aria-label":`Delete page ${m+1}`,title:"Delete this page and its content",children:"×"})]},w.id))}),!h&&r.jsx("button",{type:"button",className:"add-page-button",onClick:i,"aria-label":"Add new page",children:"+ Add Page"})]}),je={A4:{width:794,height:1123},Letter:{width:816,height:1056},Legal:{width:816,height:1344}},Ke=({pageManagerComponent:e=null,onNavigatePage:n,onAddPage:a,onDeletePage:o,onPageSizeChange:i,showSidebar:s=!0,showToolbar:d=!0})=>{const h=X.useDispatch(),w=X.useSelector(t=>t.document),{pageSize:m,continuousContent:_,pageBoundaries:E,activePage:S}=w,D=g.useRef(null),N=g.useRef(null),{currentFormat:T,formatText:L}=be(),{checkAndUpdateBoundaries:R,getCurrentPage:c,scrollToPage:p,positionCursorAtPage:x,updateBoundaries:l,triggerAutoReflow:k,removePageAndContent:b}=xe(m,N),y=je[m]||je.A4,[A,z]=g.useState(!1);g.useEffect(()=>{N.current&&N.current.innerHTML!==_&&(N.current.innerHTML=_,setTimeout(()=>{l()},100))},[_,l]),g.useEffect(()=>{const t=setTimeout(()=>{N.current&&N.current.focus()},200);return()=>clearTimeout(t)},[]);const C=g.useCallback(t=>{const u=t.currentTarget.innerHTML;h($(u)),R(),k();const v=c();v!==S&&h(V(v))},[R,h,c,S,k]),P=g.useCallback(t=>{h(fe(t)),l({pageSize:t}),i&&i(t)},[h,l,i]),j=g.useCallback(t=>{h(V(t)),p(t,D),n&&n(t)},[h,p,n]),B=g.useCallback(()=>{h(he({position:"end"})),setTimeout(()=>{l()},100),a&&a()},[h,l,a]),F=g.useCallback(()=>{const t=window.getSelection();if(t&&t.rangeCount>0){if(!N?.current)return;const I=`<page-break data-page-break="true" contenteditable="false" data-page-number="${N.current.querySelectorAll('page-break, [data-page-break="true"]').length+2}"></page-break><p><br></p>`;document.execCommand("insertHTML",!1,I),setTimeout(()=>{l()},100)}},[l,N]),K=g.useCallback(t=>{if(E.length<=1){console.warn("Cannot delete the only page");return}b(t)&&(h(V(0)),o&&o(t))},[E.length,b,h,o]),te=g.useCallback(()=>{if(!D.current||!N.current)return;const t=c();t!==S&&h(V(t))},[c,S,h]),ne=_?(_.replace(/<[^>]*>/g," ").match(/\b\w+\b/g)||[]).length:0,ae=E.length||1;return r.jsxs("div",{className:"multi-page-editor",children:[d&&r.jsx(Pe,{currentFormat:T,pageSize:m,onFormatText:L,onPageSizeChange:P,onAddPageBreak:F}),r.jsxs("div",{className:"editor-container",children:[s&&r.jsx(ve,{editorView:null,isCollapsed:A,onToggle:()=>z(t=>!t),wordCount:ne,pageCount:ae}),r.jsx("div",{className:"editor-viewport continuous-scroll",ref:D,onScroll:te,children:r.jsx(Ae,{content:_,dimensions:y,pageSize:m,pageBoundaries:E,editorRef:N,onInput:C,onClick:()=>N.current?.focus()})}),r.jsx("div",{className:"page-manager-sidebar",children:e?g.cloneElement(e,{pages:E.map((t,u)=>({id:t.id,index:u,size:m})),activePage:S,pageSize:m,onNavigate:j,onAddPage:B,onDeletePage:K,onPageSizeChange:P}):r.jsx(ye,{pages:E.map((t,u)=>({id:t.id,index:u,size:m})),activePage:S,pageSize:m,onNavigate:j,onAddPage:B,onDeletePage:K,onPageSizeChange:P,continuousMode:!1})})]})]})},Xe={A4:{width:794,height:1123},Letter:{width:816,height:1056},Legal:{width:816,height:1344}};f.ContentEditableEditor=Ke,f.ContinuousPageView=Ae,f.EditorToolbar=Pe,f.PAGE_DIMENSIONS=Xe,f.PageManager=ye,f.Sidebar=ve,f.addPage=De,f.addPageBreak=he,f.clearImages=Ve,f.deleteImage=Je,f.deletePage=ze,f.documentReducer=Ge,f.getAllImageKeys=Fe,f.getImage=Ye,f.initializeDocument=_e,f.logger=Se,f.removePageBreak=Ue,f.resetDocument=Me,f.saveImage=Ce,f.setActivePage=V,f.setEditorMode=He,f.updateContinuousContent=$,f.updatePageBoundaries=me,f.updatePageContent=Oe,f.updatePageSize=fe,f.updatePages=Le,f.updateTitle=Be,f.useContinuousReflow=xe,f.useFormatting=be,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=htmleditor.umd.cjs.map
