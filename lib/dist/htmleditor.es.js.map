{"version":3,"file":"htmleditor.es.js","sources":["../../node_modules/react/cjs/react-jsx-runtime.production.js","../../node_modules/react/cjs/react-jsx-runtime.development.js","../../node_modules/react/jsx-runtime.js","../src/lib/editor/zoom-utils.js","../src/lib/editor/margin-utils.js","../src/lib/editor/page-sizes.js","../src/context/DocumentContext.jsx","../../node_modules/prop-types/node_modules/react-is/cjs/react-is.production.min.js","../../node_modules/prop-types/node_modules/react-is/cjs/react-is.development.js","../../node_modules/prop-types/node_modules/react-is/index.js","../../node_modules/object-assign/index.js","../../node_modules/prop-types/lib/ReactPropTypesSecret.js","../../node_modules/prop-types/lib/has.js","../../node_modules/prop-types/checkPropTypes.js","../../node_modules/prop-types/factoryWithTypeCheckers.js","../../node_modules/prop-types/factoryWithThrowingShims.js","../../node_modules/prop-types/index.js","../src/lib/editor/font-sizes.js","../src/hooks/useFormatting.js","../src/lib/editor/page-boundary-utils.js","../src/lib/editor/page-break-utils.js","../src/lib/editor/content-reflow-utils.js","../src/lib/editor/cursor-scroll-utils.js","../src/hooks/useContinuousReflow.js","../src/hooks/useKeyboardShortcuts.js","../src/hooks/useSelectionHandling.js","../src/lib/editor/image-resize-utils.js","../src/lib/storage/index-db.js","../src/lib/editor/content-normalize-utils.js","../../node_modules/lucide-react/dist/esm/shared/src/utils.js","../../node_modules/lucide-react/dist/esm/defaultAttributes.js","../../node_modules/lucide-react/dist/esm/Icon.js","../../node_modules/lucide-react/dist/esm/createLucideIcon.js","../../node_modules/lucide-react/dist/esm/icons/arrow-down.js","../../node_modules/lucide-react/dist/esm/icons/arrow-left.js","../../node_modules/lucide-react/dist/esm/icons/arrow-right.js","../../node_modules/lucide-react/dist/esm/icons/arrow-up.js","../../node_modules/lucide-react/dist/esm/icons/bold.js","../../node_modules/lucide-react/dist/esm/icons/chevron-left.js","../../node_modules/lucide-react/dist/esm/icons/chevron-right.js","../../node_modules/lucide-react/dist/esm/icons/file-check.js","../../node_modules/lucide-react/dist/esm/icons/file-text.js","../../node_modules/lucide-react/dist/esm/icons/hash.js","../../node_modules/lucide-react/dist/esm/icons/heading-1.js","../../node_modules/lucide-react/dist/esm/icons/heading-2.js","../../node_modules/lucide-react/dist/esm/icons/heading-3.js","../../node_modules/lucide-react/dist/esm/icons/image-upscale.js","../../node_modules/lucide-react/dist/esm/icons/image.js","../../node_modules/lucide-react/dist/esm/icons/italic.js","../../node_modules/lucide-react/dist/esm/icons/link.js","../../node_modules/lucide-react/dist/esm/icons/list-indent-decrease.js","../../node_modules/lucide-react/dist/esm/icons/list-indent-increase.js","../../node_modules/lucide-react/dist/esm/icons/list-ordered.js","../../node_modules/lucide-react/dist/esm/icons/list.js","../../node_modules/lucide-react/dist/esm/icons/palette.js","../../node_modules/lucide-react/dist/esm/icons/plus.js","../../node_modules/lucide-react/dist/esm/icons/redo.js","../../node_modules/lucide-react/dist/esm/icons/scaling.js","../../node_modules/lucide-react/dist/esm/icons/settings.js","../../node_modules/lucide-react/dist/esm/icons/strikethrough.js","../../node_modules/lucide-react/dist/esm/icons/table.js","../../node_modules/lucide-react/dist/esm/icons/text-align-center.js","../../node_modules/lucide-react/dist/esm/icons/text-align-end.js","../../node_modules/lucide-react/dist/esm/icons/text-align-justify.js","../../node_modules/lucide-react/dist/esm/icons/text-align-start.js","../../node_modules/lucide-react/dist/esm/icons/trash-2.js","../../node_modules/lucide-react/dist/esm/icons/underline.js","../../node_modules/lucide-react/dist/esm/icons/undo.js","../../node_modules/lucide-react/dist/esm/icons/x.js","../../node_modules/lucide-react/dist/esm/icons/zoom-in.js","../../node_modules/lucide-react/dist/esm/icons/zoom-out.js","../src/components/editor/Sidebar.jsx","../src/lib/editor/utils/logger.js","../src/lib/editor/indentation-utils.js","../src/components/editor/ColorPickerDropdown.jsx","../src/components/editor/EditorToolbar.jsx","../src/lib/editor/paste-utils.js","../src/components/editor/PageView.jsx","../src/components/editor/PageManager.jsx","../src/components/editor/ImageResizeHandlers.jsx","../src/components/editor/ImageTooltipMenu.jsx","../src/lib/editor/dom-utils.js","../src/lib/editor/table-resize-utils.js","../src/components/editor/TableResizeHandlers.jsx","../src/components/editor/TableTooltipMenu.jsx","../src/components/editor/TableCellSelection.jsx","../src/components/editor/HtmlEditor.jsx","../src/components/ErrorBoundary.jsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\nvar REACT_ELEMENT_TYPE = Symbol.for(\"react.transitional.element\"),\n  REACT_FRAGMENT_TYPE = Symbol.for(\"react.fragment\");\nfunction jsxProd(type, config, maybeKey) {\n  var key = null;\n  void 0 !== maybeKey && (key = \"\" + maybeKey);\n  void 0 !== config.key && (key = \"\" + config.key);\n  if (\"key\" in config) {\n    maybeKey = {};\n    for (var propName in config)\n      \"key\" !== propName && (maybeKey[propName] = config[propName]);\n  } else maybeKey = config;\n  config = maybeKey.ref;\n  return {\n    $$typeof: REACT_ELEMENT_TYPE,\n    type: type,\n    key: key,\n    ref: void 0 !== config ? config : null,\n    props: maybeKey\n  };\n}\nexports.Fragment = REACT_FRAGMENT_TYPE;\nexports.jsx = jsxProd;\nexports.jsxs = jsxProd;\n","/**\n * @license React\n * react-jsx-runtime.development.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\n\"production\" !== process.env.NODE_ENV &&\n  (function () {\n    function getComponentNameFromType(type) {\n      if (null == type) return null;\n      if (\"function\" === typeof type)\n        return type.$$typeof === REACT_CLIENT_REFERENCE\n          ? null\n          : type.displayName || type.name || null;\n      if (\"string\" === typeof type) return type;\n      switch (type) {\n        case REACT_FRAGMENT_TYPE:\n          return \"Fragment\";\n        case REACT_PROFILER_TYPE:\n          return \"Profiler\";\n        case REACT_STRICT_MODE_TYPE:\n          return \"StrictMode\";\n        case REACT_SUSPENSE_TYPE:\n          return \"Suspense\";\n        case REACT_SUSPENSE_LIST_TYPE:\n          return \"SuspenseList\";\n        case REACT_ACTIVITY_TYPE:\n          return \"Activity\";\n      }\n      if (\"object\" === typeof type)\n        switch (\n          (\"number\" === typeof type.tag &&\n            console.error(\n              \"Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue.\"\n            ),\n          type.$$typeof)\n        ) {\n          case REACT_PORTAL_TYPE:\n            return \"Portal\";\n          case REACT_CONTEXT_TYPE:\n            return type.displayName || \"Context\";\n          case REACT_CONSUMER_TYPE:\n            return (type._context.displayName || \"Context\") + \".Consumer\";\n          case REACT_FORWARD_REF_TYPE:\n            var innerType = type.render;\n            type = type.displayName;\n            type ||\n              ((type = innerType.displayName || innerType.name || \"\"),\n              (type = \"\" !== type ? \"ForwardRef(\" + type + \")\" : \"ForwardRef\"));\n            return type;\n          case REACT_MEMO_TYPE:\n            return (\n              (innerType = type.displayName || null),\n              null !== innerType\n                ? innerType\n                : getComponentNameFromType(type.type) || \"Memo\"\n            );\n          case REACT_LAZY_TYPE:\n            innerType = type._payload;\n            type = type._init;\n            try {\n              return getComponentNameFromType(type(innerType));\n            } catch (x) {}\n        }\n      return null;\n    }\n    function testStringCoercion(value) {\n      return \"\" + value;\n    }\n    function checkKeyStringCoercion(value) {\n      try {\n        testStringCoercion(value);\n        var JSCompiler_inline_result = !1;\n      } catch (e) {\n        JSCompiler_inline_result = !0;\n      }\n      if (JSCompiler_inline_result) {\n        JSCompiler_inline_result = console;\n        var JSCompiler_temp_const = JSCompiler_inline_result.error;\n        var JSCompiler_inline_result$jscomp$0 =\n          (\"function\" === typeof Symbol &&\n            Symbol.toStringTag &&\n            value[Symbol.toStringTag]) ||\n          value.constructor.name ||\n          \"Object\";\n        JSCompiler_temp_const.call(\n          JSCompiler_inline_result,\n          \"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.\",\n          JSCompiler_inline_result$jscomp$0\n        );\n        return testStringCoercion(value);\n      }\n    }\n    function getTaskName(type) {\n      if (type === REACT_FRAGMENT_TYPE) return \"<>\";\n      if (\n        \"object\" === typeof type &&\n        null !== type &&\n        type.$$typeof === REACT_LAZY_TYPE\n      )\n        return \"<...>\";\n      try {\n        var name = getComponentNameFromType(type);\n        return name ? \"<\" + name + \">\" : \"<...>\";\n      } catch (x) {\n        return \"<...>\";\n      }\n    }\n    function getOwner() {\n      var dispatcher = ReactSharedInternals.A;\n      return null === dispatcher ? null : dispatcher.getOwner();\n    }\n    function UnknownOwner() {\n      return Error(\"react-stack-top-frame\");\n    }\n    function hasValidKey(config) {\n      if (hasOwnProperty.call(config, \"key\")) {\n        var getter = Object.getOwnPropertyDescriptor(config, \"key\").get;\n        if (getter && getter.isReactWarning) return !1;\n      }\n      return void 0 !== config.key;\n    }\n    function defineKeyPropWarningGetter(props, displayName) {\n      function warnAboutAccessingKey() {\n        specialPropKeyWarningShown ||\n          ((specialPropKeyWarningShown = !0),\n          console.error(\n            \"%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)\",\n            displayName\n          ));\n      }\n      warnAboutAccessingKey.isReactWarning = !0;\n      Object.defineProperty(props, \"key\", {\n        get: warnAboutAccessingKey,\n        configurable: !0\n      });\n    }\n    function elementRefGetterWithDeprecationWarning() {\n      var componentName = getComponentNameFromType(this.type);\n      didWarnAboutElementRef[componentName] ||\n        ((didWarnAboutElementRef[componentName] = !0),\n        console.error(\n          \"Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.\"\n        ));\n      componentName = this.props.ref;\n      return void 0 !== componentName ? componentName : null;\n    }\n    function ReactElement(type, key, props, owner, debugStack, debugTask) {\n      var refProp = props.ref;\n      type = {\n        $$typeof: REACT_ELEMENT_TYPE,\n        type: type,\n        key: key,\n        props: props,\n        _owner: owner\n      };\n      null !== (void 0 !== refProp ? refProp : null)\n        ? Object.defineProperty(type, \"ref\", {\n            enumerable: !1,\n            get: elementRefGetterWithDeprecationWarning\n          })\n        : Object.defineProperty(type, \"ref\", { enumerable: !1, value: null });\n      type._store = {};\n      Object.defineProperty(type._store, \"validated\", {\n        configurable: !1,\n        enumerable: !1,\n        writable: !0,\n        value: 0\n      });\n      Object.defineProperty(type, \"_debugInfo\", {\n        configurable: !1,\n        enumerable: !1,\n        writable: !0,\n        value: null\n      });\n      Object.defineProperty(type, \"_debugStack\", {\n        configurable: !1,\n        enumerable: !1,\n        writable: !0,\n        value: debugStack\n      });\n      Object.defineProperty(type, \"_debugTask\", {\n        configurable: !1,\n        enumerable: !1,\n        writable: !0,\n        value: debugTask\n      });\n      Object.freeze && (Object.freeze(type.props), Object.freeze(type));\n      return type;\n    }\n    function jsxDEVImpl(\n      type,\n      config,\n      maybeKey,\n      isStaticChildren,\n      debugStack,\n      debugTask\n    ) {\n      var children = config.children;\n      if (void 0 !== children)\n        if (isStaticChildren)\n          if (isArrayImpl(children)) {\n            for (\n              isStaticChildren = 0;\n              isStaticChildren < children.length;\n              isStaticChildren++\n            )\n              validateChildKeys(children[isStaticChildren]);\n            Object.freeze && Object.freeze(children);\n          } else\n            console.error(\n              \"React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.\"\n            );\n        else validateChildKeys(children);\n      if (hasOwnProperty.call(config, \"key\")) {\n        children = getComponentNameFromType(type);\n        var keys = Object.keys(config).filter(function (k) {\n          return \"key\" !== k;\n        });\n        isStaticChildren =\n          0 < keys.length\n            ? \"{key: someKey, \" + keys.join(\": ..., \") + \": ...}\"\n            : \"{key: someKey}\";\n        didWarnAboutKeySpread[children + isStaticChildren] ||\n          ((keys =\n            0 < keys.length ? \"{\" + keys.join(\": ..., \") + \": ...}\" : \"{}\"),\n          console.error(\n            'A props object containing a \"key\" prop is being spread into JSX:\\n  let props = %s;\\n  <%s {...props} />\\nReact keys must be passed directly to JSX without using spread:\\n  let props = %s;\\n  <%s key={someKey} {...props} />',\n            isStaticChildren,\n            children,\n            keys,\n            children\n          ),\n          (didWarnAboutKeySpread[children + isStaticChildren] = !0));\n      }\n      children = null;\n      void 0 !== maybeKey &&\n        (checkKeyStringCoercion(maybeKey), (children = \"\" + maybeKey));\n      hasValidKey(config) &&\n        (checkKeyStringCoercion(config.key), (children = \"\" + config.key));\n      if (\"key\" in config) {\n        maybeKey = {};\n        for (var propName in config)\n          \"key\" !== propName && (maybeKey[propName] = config[propName]);\n      } else maybeKey = config;\n      children &&\n        defineKeyPropWarningGetter(\n          maybeKey,\n          \"function\" === typeof type\n            ? type.displayName || type.name || \"Unknown\"\n            : type\n        );\n      return ReactElement(\n        type,\n        children,\n        maybeKey,\n        getOwner(),\n        debugStack,\n        debugTask\n      );\n    }\n    function validateChildKeys(node) {\n      isValidElement(node)\n        ? node._store && (node._store.validated = 1)\n        : \"object\" === typeof node &&\n          null !== node &&\n          node.$$typeof === REACT_LAZY_TYPE &&\n          (\"fulfilled\" === node._payload.status\n            ? isValidElement(node._payload.value) &&\n              node._payload.value._store &&\n              (node._payload.value._store.validated = 1)\n            : node._store && (node._store.validated = 1));\n    }\n    function isValidElement(object) {\n      return (\n        \"object\" === typeof object &&\n        null !== object &&\n        object.$$typeof === REACT_ELEMENT_TYPE\n      );\n    }\n    var React = require(\"react\"),\n      REACT_ELEMENT_TYPE = Symbol.for(\"react.transitional.element\"),\n      REACT_PORTAL_TYPE = Symbol.for(\"react.portal\"),\n      REACT_FRAGMENT_TYPE = Symbol.for(\"react.fragment\"),\n      REACT_STRICT_MODE_TYPE = Symbol.for(\"react.strict_mode\"),\n      REACT_PROFILER_TYPE = Symbol.for(\"react.profiler\"),\n      REACT_CONSUMER_TYPE = Symbol.for(\"react.consumer\"),\n      REACT_CONTEXT_TYPE = Symbol.for(\"react.context\"),\n      REACT_FORWARD_REF_TYPE = Symbol.for(\"react.forward_ref\"),\n      REACT_SUSPENSE_TYPE = Symbol.for(\"react.suspense\"),\n      REACT_SUSPENSE_LIST_TYPE = Symbol.for(\"react.suspense_list\"),\n      REACT_MEMO_TYPE = Symbol.for(\"react.memo\"),\n      REACT_LAZY_TYPE = Symbol.for(\"react.lazy\"),\n      REACT_ACTIVITY_TYPE = Symbol.for(\"react.activity\"),\n      REACT_CLIENT_REFERENCE = Symbol.for(\"react.client.reference\"),\n      ReactSharedInternals =\n        React.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,\n      hasOwnProperty = Object.prototype.hasOwnProperty,\n      isArrayImpl = Array.isArray,\n      createTask = console.createTask\n        ? console.createTask\n        : function () {\n            return null;\n          };\n    React = {\n      react_stack_bottom_frame: function (callStackForError) {\n        return callStackForError();\n      }\n    };\n    var specialPropKeyWarningShown;\n    var didWarnAboutElementRef = {};\n    var unknownOwnerDebugStack = React.react_stack_bottom_frame.bind(\n      React,\n      UnknownOwner\n    )();\n    var unknownOwnerDebugTask = createTask(getTaskName(UnknownOwner));\n    var didWarnAboutKeySpread = {};\n    exports.Fragment = REACT_FRAGMENT_TYPE;\n    exports.jsx = function (type, config, maybeKey) {\n      var trackActualOwner =\n        1e4 > ReactSharedInternals.recentlyCreatedOwnerStacks++;\n      return jsxDEVImpl(\n        type,\n        config,\n        maybeKey,\n        !1,\n        trackActualOwner\n          ? Error(\"react-stack-top-frame\")\n          : unknownOwnerDebugStack,\n        trackActualOwner ? createTask(getTaskName(type)) : unknownOwnerDebugTask\n      );\n    };\n    exports.jsxs = function (type, config, maybeKey) {\n      var trackActualOwner =\n        1e4 > ReactSharedInternals.recentlyCreatedOwnerStacks++;\n      return jsxDEVImpl(\n        type,\n        config,\n        maybeKey,\n        !0,\n        trackActualOwner\n          ? Error(\"react-stack-top-frame\")\n          : unknownOwnerDebugStack,\n        trackActualOwner ? createTask(getTaskName(type)) : unknownOwnerDebugTask\n      );\n    };\n  })();\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","/**\r\n * Zoom utilities for the HTML editor\r\n * Provides constants and helper functions for zoom functionality\r\n */\r\n\r\n/**\r\n * Allowed zoom levels in percentage\r\n * Range: 50% to 200% in 5% increments\r\n */\r\nexport const ZOOM_LEVELS = [\r\n  50, 55, 60, 65, 70, 75, 80, 85, 90, 95,\r\n  100, 105, 110, 115, 120, 125, 130, 135, 140, 145,\r\n  150, 155, 160, 165, 170, 175, 180, 185, 190, 195, 200\r\n];\r\n\r\n/**\r\n * Default zoom level\r\n */\r\nexport const DEFAULT_ZOOM = 100;\r\n\r\n/**\r\n * Minimum zoom level\r\n */\r\nexport const MIN_ZOOM = 50;\r\n\r\n/**\r\n * Maximum zoom level\r\n */\r\nexport const MAX_ZOOM = 200;\r\n\r\n/**\r\n * Zoom increment/decrement step\r\n */\r\nexport const ZOOM_STEP = 5;\r\n\r\n/**\r\n * Check if zoom can be increased\r\n * @param {number} currentZoom - Current zoom level\r\n * @returns {boolean} True if zoom can be increased\r\n */\r\nexport const canZoomIn = (currentZoom) => {\r\n  return currentZoom < MAX_ZOOM;\r\n};\r\n\r\n/**\r\n * Check if zoom can be decreased\r\n * @param {number} currentZoom - Current zoom level\r\n * @returns {boolean} True if zoom can be decreased\r\n */\r\nexport const canZoomOut = (currentZoom) => {\r\n  return currentZoom > MIN_ZOOM;\r\n};\r\n\r\n/**\r\n * Get next zoom level (zoom in)\r\n * @param {number} currentZoom - Current zoom level\r\n * @returns {number} Next zoom level or current if at max\r\n */\r\nexport const getNextZoomLevel = (currentZoom) => {\r\n  if (!canZoomIn(currentZoom)) return currentZoom;\r\n  \r\n  const nextLevel = currentZoom + ZOOM_STEP;\r\n  return nextLevel <= MAX_ZOOM ? nextLevel : currentZoom;\r\n};\r\n\r\n/**\r\n * Get previous zoom level (zoom out)\r\n * @param {number} currentZoom - Current zoom level\r\n * @returns {number} Previous zoom level or current if at min\r\n */\r\nexport const getPreviousZoomLevel = (currentZoom) => {\r\n  if (!canZoomOut(currentZoom)) return currentZoom;\r\n  \r\n  const prevLevel = currentZoom - ZOOM_STEP;\r\n  return prevLevel >= MIN_ZOOM ? prevLevel : currentZoom;\r\n};\r\n\r\n/**\r\n * Validate if a zoom level is allowed\r\n * @param {number} zoom - Zoom level to validate\r\n * @returns {boolean} True if zoom level is valid\r\n */\r\nexport const isValidZoomLevel = (zoom) => {\r\n  return zoom >= MIN_ZOOM && zoom <= MAX_ZOOM;\r\n};\r\n\r\n/**\r\n * Get zoom as decimal multiplier\r\n * @param {number} zoom - Zoom percentage\r\n * @returns {number} Decimal multiplier (e.g., 100 -> 1.0, 150 -> 1.5)\r\n */\r\nexport const getZoomMultiplier = (zoom) => {\r\n  return zoom / 100;\r\n};\r\n","/**\r\n * Page Margin Utilities\r\n * \r\n * Provides margin presets and conversion utilities for page margins.\r\n * Margins are defined in inches and converted to pixels at 96 DPI (CSS standard).\r\n * \r\n * DPI Conversion: 1 inch = 96 pixels (CSS/Web standard)\r\n * \r\n * Common margin presets similar to Microsoft Word:\r\n * - Normal: 1\" all sides (most common)\r\n * - Narrow: 0.5\" all sides (minimal margins)\r\n * - Moderate: 1\" top/bottom, 0.75\" left/right\r\n * - Wide: 1\" top/bottom, 2\" left/right\r\n * - Mirrored: For two-sided printing\r\n */\r\n\r\n// DPI constant for CSS/Web (96 DPI is the standard)\r\nexport const CSS_DPI = 96;\r\n\r\n// Convert inches to pixels at 96 DPI\r\nexport const inchesToPixels = (inches) => Math.round(inches * CSS_DPI);\r\n\r\n// Convert pixels to inches\r\nexport const pixelsToInches = (pixels) => pixels / CSS_DPI;\r\n\r\n// Margin preset definitions (in inches)\r\nexport const MARGIN_PRESETS = {\r\n  NORMAL: {\r\n    name: 'Normal',\r\n    label: 'Normal (1\")',\r\n    top: 1,\r\n    bottom: 1,\r\n    left: 1,\r\n    right: 1\r\n  },\r\n  NARROW: {\r\n    name: 'Narrow',\r\n    label: 'Narrow (0.5\")',\r\n    top: 0.5,\r\n    bottom: 0.5,\r\n    left: 0.5,\r\n    right: 0.5\r\n  },\r\n  MODERATE: {\r\n    name: 'Moderate',\r\n    label: 'Moderate (1\" / 0.75\")',\r\n    top: 1,\r\n    bottom: 1,\r\n    left: 0.75,\r\n    right: 0.75\r\n  },\r\n  WIDE: {\r\n    name: 'Wide',\r\n    label: 'Wide (1\" / 2\")',\r\n    top: 1,\r\n    bottom: 1,\r\n    left: 2,\r\n    right: 2\r\n  },\r\n  OFFICE_2003: {\r\n    name: 'Office 2003',\r\n    label: 'Office 2003 (1\" / 1.25\")',\r\n    top: 1,\r\n    bottom: 1,\r\n    left: 1.25,\r\n    right: 1.25\r\n  }\r\n};\r\n\r\n// Default margin preset\r\nexport const DEFAULT_MARGIN_PRESET = 'NORMAL';\r\n\r\n/**\r\n * Convert margin preset to pixel values\r\n * @param {string|Object} marginInput - Name of the preset (e.g., 'NORMAL', 'NARROW') or custom margin object {top, bottom, left, right} in inches\r\n * @returns {Object} Margin object with top, bottom, left, right in pixels\r\n */\r\nexport const getMarginPixels = (marginInput = DEFAULT_MARGIN_PRESET) => {\r\n  // Check if it's a custom margin object\r\n  if (typeof marginInput === 'object' && marginInput !== null && \r\n      typeof marginInput.top === 'number' && \r\n      typeof marginInput.bottom === 'number' && \r\n      typeof marginInput.left === 'number' && \r\n      typeof marginInput.right === 'number') {\r\n    // Custom margins provided in inches\r\n    return {\r\n      top: inchesToPixels(marginInput.top),\r\n      bottom: inchesToPixels(marginInput.bottom),\r\n      left: inchesToPixels(marginInput.left),\r\n      right: inchesToPixels(marginInput.right)\r\n    };\r\n  }\r\n  \r\n  // Otherwise, treat as preset name\r\n  const preset = MARGIN_PRESETS[marginInput] || MARGIN_PRESETS[DEFAULT_MARGIN_PRESET];\r\n  \r\n  return {\r\n    top: inchesToPixels(preset.top),\r\n    bottom: inchesToPixels(preset.bottom),\r\n    left: inchesToPixels(preset.left),\r\n    right: inchesToPixels(preset.right)\r\n  };\r\n};\r\n\r\n/**\r\n * Get total vertical margins (top + bottom)\r\n * @param {string|Object} marginInput - Name of the preset or custom margin object\r\n * @returns {number} Total vertical margins in pixels\r\n */\r\nexport const getTotalVerticalMargins = (marginInput = DEFAULT_MARGIN_PRESET) => {\r\n  const margins = getMarginPixels(marginInput);\r\n  return margins.top + margins.bottom;\r\n};\r\n\r\n/**\r\n * Get total horizontal margins (left + right)\r\n * @param {string|Object} marginInput - Name of the preset or custom margin object\r\n * @returns {number} Total horizontal margins in pixels\r\n */\r\nexport const getTotalHorizontalMargins = (marginInput = DEFAULT_MARGIN_PRESET) => {\r\n  const margins = getMarginPixels(marginInput);\r\n  return margins.left + margins.right;\r\n};\r\n\r\n/**\r\n * Get all available margin preset names\r\n * @returns {Array<string>} Array of preset names\r\n */\r\nexport const getMarginPresetNames = () => {\r\n  return Object.keys(MARGIN_PRESETS);\r\n};\r\n\r\n/**\r\n * Get margin preset label for display\r\n * @param {string|Object} marginInput - Name of the preset or custom margin object\r\n * @returns {string} Display label\r\n */\r\nexport const getMarginPresetLabel = (marginInput) => {\r\n  // Check if it's a custom margin object\r\n  if (typeof marginInput === 'object' && marginInput !== null && \r\n      typeof marginInput.top === 'number' && \r\n      typeof marginInput.bottom === 'number' && \r\n      typeof marginInput.left === 'number' && \r\n      typeof marginInput.right === 'number') {\r\n    // Custom margins - format as \"Custom (top/bottom x left/right)\"\r\n    return `Custom (${marginInput.top}\" / ${marginInput.left}\")`;\r\n  }\r\n  \r\n  // Otherwise, treat as preset name\r\n  const preset = MARGIN_PRESETS[marginInput];\r\n  return preset ? preset.label : 'Unknown';\r\n};\r\n\r\n/**\r\n * Check if margins are custom (not a preset)\r\n * @param {string|Object} marginInput - Margin input to check\r\n * @returns {boolean} True if custom margins\r\n */\r\nexport const isCustomMargins = (marginInput) => {\r\n  return typeof marginInput === 'object' && marginInput !== null && \r\n         typeof marginInput.top === 'number' && \r\n         typeof marginInput.bottom === 'number' && \r\n         typeof marginInput.left === 'number' && \r\n         typeof marginInput.right === 'number';\r\n};\r\n\r\n/**\r\n * Validate if a preset name exists\r\n * @param {string} presetName - Name to validate\r\n * @returns {boolean} True if valid\r\n */\r\nexport const isValidMarginPreset = (presetName) => {\r\n  return presetName in MARGIN_PRESETS;\r\n};\r\n\r\nexport default {\r\n  CSS_DPI,\r\n  inchesToPixels,\r\n  pixelsToInches,\r\n  MARGIN_PRESETS,\r\n  DEFAULT_MARGIN_PRESET,\r\n  getMarginPixels,\r\n  getTotalVerticalMargins,\r\n  getTotalHorizontalMargins,\r\n  getMarginPresetNames,\r\n  getMarginPresetLabel,\r\n  isValidMarginPreset,\r\n  isCustomMargins\r\n};\r\n","/**\r\n * Page size constants with real-world dimensions\r\n * Dimensions calculated at 96 DPI (Microsoft Word standard for screen display)\r\n */\r\n\r\n/**\r\n * Page size configurations\r\n * All dimensions in pixels at 96 DPI (matching Microsoft Word)\r\n * \r\n * Conversion: 1 inch = 96 pixels, 1 mm = 96/25.4 pixels\r\n */\r\nexport const PAGE_SIZES = {\r\n  A4: {\r\n    name: 'A4',\r\n    width: 794,  // 210mm = 210 * 96 / 25.4 ≈ 794px (Word A4 width)\r\n    height: 1123, // 297mm = 297 * 96 / 25.4 ≈ 1123px (Word A4 height)\r\n    widthMm: 210,\r\n    heightMm: 297,\r\n    widthIn: 8.27,\r\n    heightIn: 11.69\r\n  },\r\n  Letter: {\r\n    name: 'Letter',\r\n    width: 816,  // 8.5 inches = 8.5 * 96 = 816px (Word Letter width)\r\n    height: 1056, // 11 inches = 11 * 96 = 1056px (Word Letter height)\r\n    widthMm: 216,\r\n    heightMm: 279,\r\n    widthIn: 8.5,\r\n    heightIn: 11\r\n  },\r\n  Legal: {\r\n    name: 'Legal',\r\n    width: 816,  // 8.5 inches = 8.5 * 96 = 816px (Word Legal width)\r\n    height: 1344, // 14 inches = 14 * 96 = 1344px (Word Legal height)\r\n    widthMm: 216,\r\n    heightMm: 356,\r\n    widthIn: 8.5,\r\n    heightIn: 14\r\n  }\r\n};\r\n\r\n/**\r\n * Default page size\r\n */\r\nexport const DEFAULT_PAGE_SIZE = 'A4';\r\n\r\n/**\r\n * Get page dimensions for a given size\r\n * @param {string} size - Page size ('A4', 'Letter', 'Legal')\r\n * @returns {Object} Dimensions object with width and height\r\n */\r\nexport const getPageDimensions = (size) => {\r\n  const pageSize = PAGE_SIZES[size] || PAGE_SIZES[DEFAULT_PAGE_SIZE];\r\n  return {\r\n    width: pageSize.width,\r\n    height: pageSize.height\r\n  };\r\n};\r\n\r\n/**\r\n * Validate if a page size is supported\r\n * @param {string} size - Page size to validate\r\n * @returns {boolean} True if page size is valid\r\n */\r\nexport const isValidPageSize = (size) => {\r\n  return Object.keys(PAGE_SIZES).includes(size);\r\n};\r\n\r\n/**\r\n * Get all available page sizes\r\n * @returns {string[]} Array of page size names\r\n */\r\nexport const getAvailablePageSizes = () => {\r\n  return Object.keys(PAGE_SIZES);\r\n};\r\n","import React, { createContext, useContext, useReducer, useCallback, useMemo } from 'react';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { DEFAULT_ZOOM, MIN_ZOOM, MAX_ZOOM, ZOOM_STEP, canZoomIn as checkCanZoomIn, canZoomOut as checkCanZoomOut } from '../lib/editor/zoom-utils.js';\r\nimport { DEFAULT_MARGIN_PRESET } from '../lib/editor/margin-utils.js';\r\nimport { getPageDimensions, DEFAULT_PAGE_SIZE as PAGE_SIZE_DEFAULT } from '../lib/editor/page-sizes.js';\r\n\r\n// Constants moved outside for performance\r\nconst DEFAULT_PAGE_SIZE = PAGE_SIZE_DEFAULT;\r\nconst EMPTY_PARAGRAPH = '<p><br></p>';\r\nconst DEFAULT_EDITOR_MODE = 'continuous';\r\n\r\n// Helper functions moved outside reducer for better performance and reusability\r\nconst createEmptyPage = (index, size = DEFAULT_PAGE_SIZE) => ({\r\n  id: uuidv4(),\r\n  index,\r\n  size,\r\n  content: EMPTY_PARAGRAPH,\r\n  images: [],\r\n  isBreakPoint: false\r\n});\r\n\r\nconst sanitizeContent = (html) => {\r\n  if (typeof html !== 'string' || html.trim() === '') {\r\n    return EMPTY_PARAGRAPH;\r\n  }\r\n  return html;\r\n};\r\n\r\nconst withMinimumPage = (pages, pageSize = DEFAULT_PAGE_SIZE) => {\r\n  const nextPages = pages.length > 0 ? pages : [createEmptyPage(0, pageSize)];\r\n  return nextPages.map((page, index) => ({\r\n    id: page.id || uuidv4(),\r\n    index,\r\n    size: page.size || pageSize,\r\n    content: sanitizeContent(page.content),\r\n    images: page.images || [],\r\n    isBreakPoint: Boolean(page.isBreakPoint)\r\n  }));\r\n};\r\n\r\nconst createDefaultBoundary = (pageSize = DEFAULT_PAGE_SIZE) => {\r\n  const dimensions = getPageDimensions(pageSize);\r\n  return [{\r\n    id: 'page-0',\r\n    pageNumber: 1,\r\n    top: 0,\r\n    height: dimensions.height\r\n  }];\r\n};\r\n\r\nconst generatePageBreaks = (pages) => {\r\n  return pages.slice(0, -1).map((_, index) => ({\r\n    id: `auto-break-${index}`,\r\n    pageNumber: index + 1\r\n  }));\r\n};\r\n\r\nconst buildInitialState = (overrides = {}) => {\r\n  const now = new Date().toISOString();\r\n  const pageSize = overrides.pageSize || DEFAULT_PAGE_SIZE;\r\n  const pages = withMinimumPage(overrides.pages || [createEmptyPage(0, pageSize)], pageSize);\r\n\r\n  return {\r\n    id: uuidv4(),\r\n    title: overrides.title || 'Untitled Document',\r\n    createdAt: now,\r\n    updatedAt: now,\r\n    pageSize,\r\n    pages,\r\n    activePage: overrides.activePage && overrides.activePage < pages.length ? overrides.activePage : 0,\r\n    pageBreaks: overrides.pageBreaks || [],\r\n    totalPages: pages.length,\r\n    editorMode: overrides.editorMode || DEFAULT_EDITOR_MODE,\r\n    continuousContent: overrides.continuousContent || EMPTY_PARAGRAPH,\r\n    pageBoundaries: overrides.pageBoundaries || createDefaultBoundary(pageSize),\r\n    zoomLevel: overrides.zoomLevel || DEFAULT_ZOOM,\r\n    pageMargins: overrides.pageMargins || DEFAULT_MARGIN_PRESET,\r\n    // Undo/Redo state\r\n    undoStack: [],\r\n    redoStack: [],\r\n    canUndo: false,\r\n    canRedo: false\r\n  };\r\n};\r\n\r\n// Action types\r\nconst ActionTypes = {\r\n  INITIALIZE_DOCUMENT: 'INITIALIZE_DOCUMENT',\r\n  UPDATE_TITLE: 'UPDATE_TITLE',\r\n  UPDATE_PAGE_CONTENT: 'UPDATE_PAGE_CONTENT',\r\n  UPDATE_PAGES: 'UPDATE_PAGES',\r\n  ADD_PAGE: 'ADD_PAGE',\r\n  DELETE_PAGE: 'DELETE_PAGE',\r\n  SET_ACTIVE_PAGE: 'SET_ACTIVE_PAGE',\r\n  UPDATE_PAGE_SIZE: 'UPDATE_PAGE_SIZE',\r\n  RESET_DOCUMENT: 'RESET_DOCUMENT',\r\n  UPDATE_CONTINUOUS_CONTENT: 'UPDATE_CONTINUOUS_CONTENT',\r\n  UPDATE_PAGE_BOUNDARIES: 'UPDATE_PAGE_BOUNDARIES',\r\n  ADD_PAGE_BREAK: 'ADD_PAGE_BREAK',\r\n  REMOVE_PAGE_BREAK: 'REMOVE_PAGE_BREAK',\r\n  SET_EDITOR_MODE: 'SET_EDITOR_MODE',\r\n  SET_ZOOM_LEVEL: 'SET_ZOOM_LEVEL',\r\n  ZOOM_IN: 'ZOOM_IN',\r\n  ZOOM_OUT: 'ZOOM_OUT',\r\n  RESET_ZOOM: 'RESET_ZOOM',\r\n  UPDATE_PAGE_MARGINS: 'UPDATE_PAGE_MARGINS',\r\n  // Undo/Redo actions\r\n  RECORD_OPERATION: 'RECORD_OPERATION',\r\n  UNDO: 'UNDO',\r\n  REDO: 'REDO',\r\n  CLEAR_UNDO_REDO: 'CLEAR_UNDO_REDO'\r\n};\r\n\r\n// Reducer\r\nconst documentReducer = (state, action) => {\r\n  const now = new Date().toISOString();\r\n\r\n  switch (action.type) {\r\n    case ActionTypes.INITIALIZE_DOCUMENT: {\r\n      const { initialContent = EMPTY_PARAGRAPH, pageSize = DEFAULT_PAGE_SIZE } = action.payload || {};\r\n      const page = { ...createEmptyPage(0, pageSize), content: sanitizeContent(initialContent) };\r\n      return buildInitialState({\r\n        title: state.title,\r\n        pageSize,\r\n        pages: [page]\r\n      });\r\n    }\r\n\r\n    case ActionTypes.UPDATE_TITLE:\r\n      return {\r\n        ...state,\r\n        title: action.payload,\r\n        updatedAt: now\r\n      };\r\n\r\n    case ActionTypes.UPDATE_PAGE_CONTENT: {\r\n      const { pageIndex, content } = action.payload;\r\n      if (pageIndex < 0 || pageIndex >= state.pages.length) {\r\n        return state;\r\n      }\r\n\r\n      const newPages = [...state.pages];\r\n      newPages[pageIndex] = {\r\n        ...newPages[pageIndex],\r\n        content: sanitizeContent(content)\r\n      };\r\n\r\n      return {\r\n        ...state,\r\n        pages: newPages,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.UPDATE_PAGES: {\r\n      const payload = Array.isArray(action.payload)\r\n        ? { pages: action.payload }\r\n        : action.payload || {};\r\n\r\n      const nextPages = withMinimumPage(payload.pages || [], state.pageSize);\r\n      const pageBreaks = Array.isArray(payload.pageBreaks)\r\n        ? payload.pageBreaks\r\n        : generatePageBreaks(nextPages);\r\n\r\n      return {\r\n        ...state,\r\n        pages: nextPages,\r\n        activePage: Math.min(state.activePage, nextPages.length - 1),\r\n        pageBreaks,\r\n        totalPages: nextPages.length,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.ADD_PAGE: {\r\n      const insertIndex = typeof action.payload?.index === 'number'\r\n        ? Math.min(Math.max(action.payload.index, 0), state.pages.length)\r\n        : state.pages.length;\r\n\r\n      const newPages = [...state.pages];\r\n      newPages.splice(insertIndex, 0, createEmptyPage(insertIndex, state.pageSize));\r\n      \r\n      const updatedPages = newPages.map((page, index) => ({\r\n        ...page,\r\n        index,\r\n        size: state.pageSize\r\n      }));\r\n\r\n      const pageBreaks = generatePageBreaks(updatedPages);\r\n\r\n      return {\r\n        ...state,\r\n        pages: updatedPages,\r\n        activePage: insertIndex,\r\n        pageBreaks,\r\n        totalPages: updatedPages.length,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.DELETE_PAGE: {\r\n      const pageIndex = action.payload;\r\n      if (state.pages.length <= 1) {\r\n        return state;\r\n      }\r\n\r\n      const newPages = [...state.pages];\r\n      newPages.splice(pageIndex, 1);\r\n      \r\n      const updatedPages = newPages.map((page, index) => ({\r\n        ...page,\r\n        index,\r\n        size: state.pageSize\r\n      }));\r\n\r\n      let newActivePage = state.activePage;\r\n      if (newActivePage >= updatedPages.length) {\r\n        newActivePage = updatedPages.length - 1;\r\n      } else if (pageIndex <= newActivePage && newActivePage > 0) {\r\n        newActivePage -= 1;\r\n      }\r\n\r\n      const pageBreaks = generatePageBreaks(updatedPages);\r\n\r\n      return {\r\n        ...state,\r\n        pages: updatedPages,\r\n        activePage: newActivePage,\r\n        pageBreaks,\r\n        totalPages: updatedPages.length,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ACTIVE_PAGE: {\r\n      const pageIndex = action.payload;\r\n      \r\n      // Early exit if same page\r\n      if (pageIndex === state.activePage) {\r\n        return state;\r\n      }\r\n      \r\n      const maxPage = state.editorMode === 'continuous' \r\n        ? state.pageBoundaries.length \r\n        : state.pages.length;\r\n      \r\n      // Validate page index\r\n      if (pageIndex < 0 || pageIndex >= maxPage) {\r\n        return state;\r\n      }\r\n      \r\n      return {\r\n        ...state,\r\n        activePage: pageIndex,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.UPDATE_PAGE_SIZE: {\r\n      const newSize = action.payload;\r\n      \r\n      // Early exit if size hasn't changed\r\n      if (newSize === state.pageSize) {\r\n        return state;\r\n      }\r\n      \r\n      // Validate page size using getPageDimensions\r\n      try {\r\n        getPageDimensions(newSize);\r\n      } catch {\r\n        console.warn(`Invalid page size: ${newSize}`);\r\n        return state;\r\n      }\r\n      \r\n      const updatedPages = state.pages.map((page, index) => ({\r\n        ...page,\r\n        index,\r\n        size: newSize\r\n      }));\r\n\r\n      const pageBreaks = generatePageBreaks(updatedPages);\r\n\r\n      return {\r\n        ...state,\r\n        pageSize: newSize,\r\n        pages: updatedPages,\r\n        pageBreaks,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.RESET_DOCUMENT:\r\n      return buildInitialState();\r\n\r\n    case ActionTypes.UPDATE_CONTINUOUS_CONTENT: {\r\n      const newContent = sanitizeContent(action.payload);\r\n      // Early exit if content hasn't changed\r\n      if (newContent === state.continuousContent) {\r\n        return state;\r\n      }\r\n      return {\r\n        ...state,\r\n        continuousContent: newContent,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.UPDATE_PAGE_BOUNDARIES: {\r\n      const boundaries = Array.isArray(action.payload) ? action.payload : [];\r\n      \r\n      // Early exit if boundaries haven't changed (deep comparison on length and first/last)\r\n      if (boundaries.length === state.pageBoundaries.length && \r\n          boundaries.length > 0 &&\r\n          boundaries[0].id === state.pageBoundaries[0]?.id &&\r\n          boundaries[boundaries.length - 1].id === state.pageBoundaries[boundaries.length - 1]?.id) {\r\n        return state;\r\n      }\r\n      \r\n      const newActivePage = state.activePage >= boundaries.length \r\n        ? Math.max(0, boundaries.length - 1)\r\n        : state.activePage;\r\n\r\n      return {\r\n        ...state,\r\n        pageBoundaries: boundaries,\r\n        totalPages: boundaries.length,\r\n        activePage: newActivePage,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.ADD_PAGE_BREAK: {\r\n      const { position = 'end', pageIndex } = action.payload || {};\r\n      const pageBreakTag = '<page-break data-page-break=\"true\" style=\"display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;\"></page-break>';\r\n      \r\n      let newContent = state.continuousContent;\r\n\r\n      if (position === 'end') {\r\n        newContent = newContent + pageBreakTag + '<p><br></p>';\r\n      } else if (typeof position === 'number') {\r\n        const before = newContent.substring(0, position);\r\n        const after = newContent.substring(position);\r\n        newContent = before + pageBreakTag + after;\r\n      } else if (typeof pageIndex === 'number' && typeof document !== 'undefined') {\r\n        const tempDiv = document.createElement('div');\r\n        tempDiv.innerHTML = newContent;\r\n        \r\n        const pageBreaks = tempDiv.querySelectorAll('page-break, [data-page-break=\"true\"]');\r\n        \r\n        if (pageIndex === 0 && pageBreaks.length === 0) {\r\n          newContent = newContent + pageBreakTag + '<p><br></p>';\r\n        } else if (pageIndex < pageBreaks.length) {\r\n          const targetBreak = pageBreaks[pageIndex];\r\n          const newBreak = document.createElement('page-break');\r\n          newBreak.setAttribute('data-page-break', 'true');\r\n          newBreak.setAttribute('style', 'display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;');\r\n          \r\n          const newParagraph = document.createElement('p');\r\n          newParagraph.innerHTML = '<br>';\r\n          \r\n          targetBreak.parentNode.insertBefore(newBreak, targetBreak.nextSibling);\r\n          newBreak.parentNode.insertBefore(newParagraph, newBreak.nextSibling);\r\n          \r\n          newContent = tempDiv.innerHTML;\r\n        } else {\r\n          newContent = newContent + pageBreakTag + '<p><br></p>';\r\n        }\r\n      }\r\n      \r\n      return {\r\n        ...state,\r\n        continuousContent: newContent,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.REMOVE_PAGE_BREAK: {\r\n      const { pageIndex } = action.payload || {};\r\n      \r\n      if (typeof pageIndex !== 'number' || typeof document === 'undefined') {\r\n        return state;\r\n      }\r\n      \r\n      const tempDiv = document.createElement('div');\r\n      tempDiv.innerHTML = state.continuousContent;\r\n      \r\n      const pageBreaks = tempDiv.querySelectorAll('page-break, [data-page-break=\"true\"]');\r\n      \r\n      if (pageBreaks[pageIndex]) {\r\n        pageBreaks[pageIndex].remove();\r\n      }\r\n      \r\n      const remainingBreaks = tempDiv.querySelectorAll('page-break, [data-page-break=\"true\"]');\r\n      remainingBreaks.forEach((breakEl, index) => {\r\n        breakEl.setAttribute('data-page-number', String(index + 2));\r\n      });\r\n      \r\n      return {\r\n        ...state,\r\n        continuousContent: tempDiv.innerHTML,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_EDITOR_MODE: {\r\n      const newMode = action.payload;\r\n      if (newMode === state.editorMode) {\r\n        return state;\r\n      }\r\n\r\n      let newContent = state.continuousContent;\r\n      let newPages = state.pages;\r\n\r\n      if (newMode === 'continuous') {\r\n        const allContent = state.pages\r\n          .map(page => page.content)\r\n          .filter(content => content && content !== EMPTY_PARAGRAPH)\r\n          .join('\\n');\r\n        newContent = allContent || EMPTY_PARAGRAPH;\r\n      } else {\r\n        if (state.continuousContent && state.continuousContent !== EMPTY_PARAGRAPH) {\r\n          newPages = [{ ...createEmptyPage(0, state.pageSize), content: state.continuousContent }];\r\n        }\r\n      }\r\n      \r\n      return {\r\n        ...state,\r\n        editorMode: newMode,\r\n        continuousContent: newContent,\r\n        pages: newPages,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ZOOM_LEVEL: {\r\n      const newZoomLevel = action.payload;\r\n      \r\n      // Validate zoom level is within bounds\r\n      if (newZoomLevel < MIN_ZOOM || newZoomLevel > MAX_ZOOM) {\r\n        console.warn(`Invalid zoom level: ${newZoomLevel}. Must be between ${MIN_ZOOM} and ${MAX_ZOOM}.`);\r\n        return state;\r\n      }\r\n      \r\n      // Early exit if zoom hasn't changed\r\n      if (newZoomLevel === state.zoomLevel) {\r\n        return state;\r\n      }\r\n      \r\n      return {\r\n        ...state,\r\n        zoomLevel: newZoomLevel,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.ZOOM_IN: {\r\n      if (!checkCanZoomIn(state.zoomLevel)) {\r\n        return state;\r\n      }\r\n      \r\n      const newZoomLevel = state.zoomLevel + ZOOM_STEP;\r\n      return {\r\n        ...state,\r\n        zoomLevel: newZoomLevel,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.ZOOM_OUT: {\r\n      if (!checkCanZoomOut(state.zoomLevel)) {\r\n        return state;\r\n      }\r\n      \r\n      const newZoomLevel = state.zoomLevel - ZOOM_STEP;\r\n      return {\r\n        ...state,\r\n        zoomLevel: newZoomLevel,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.RESET_ZOOM: {\r\n      if (state.zoomLevel === DEFAULT_ZOOM) {\r\n        return state;\r\n      }\r\n      \r\n      return {\r\n        ...state,\r\n        zoomLevel: DEFAULT_ZOOM,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.UPDATE_PAGE_MARGINS: {\r\n      const newMargins = action.payload;\r\n      \r\n      // Early exit if margins haven't changed\r\n      if (newMargins === state.pageMargins) {\r\n        return state;\r\n      }\r\n      \r\n      return {\r\n        ...state,\r\n        pageMargins: newMargins,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.RECORD_OPERATION: {\r\n      const { operation, inverseOperation } = action.payload;\r\n      \r\n      return {\r\n        ...state,\r\n        undoStack: [...state.undoStack, { operation, inverseOperation }],\r\n        redoStack: [], // Clear redo stack when new operation is recorded\r\n        canUndo: true,\r\n        canRedo: false,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.UNDO: {\r\n      if (state.undoStack.length === 0) {\r\n        return state;\r\n      }\r\n\r\n      const lastOperation = state.undoStack[state.undoStack.length - 1];\r\n      const newUndoStack = state.undoStack.slice(0, -1);\r\n      \r\n      // Apply the inverse operation\r\n      let newState = state;\r\n      if (lastOperation.inverseOperation) {\r\n        newState = documentReducer(state, lastOperation.inverseOperation);\r\n      }\r\n\r\n      return {\r\n        ...newState,\r\n        undoStack: newUndoStack,\r\n        redoStack: [...state.redoStack, lastOperation],\r\n        canUndo: newUndoStack.length > 0,\r\n        canRedo: true,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.REDO: {\r\n      if (state.redoStack.length === 0) {\r\n        return state;\r\n      }\r\n\r\n      const operationToRedo = state.redoStack[state.redoStack.length - 1];\r\n      const newRedoStack = state.redoStack.slice(0, -1);\r\n      \r\n      // Apply the original operation\r\n      let newState = state;\r\n      if (operationToRedo.operation) {\r\n        newState = documentReducer(state, operationToRedo.operation);\r\n      }\r\n\r\n      return {\r\n        ...newState,\r\n        undoStack: [...state.undoStack, operationToRedo],\r\n        redoStack: newRedoStack,\r\n        canUndo: true,\r\n        canRedo: newRedoStack.length > 0,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.CLEAR_UNDO_REDO: {\r\n      return {\r\n        ...state,\r\n        undoStack: [],\r\n        redoStack: [],\r\n        canUndo: false,\r\n        canRedo: false,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\n// Context\r\nconst DocumentContext = createContext(null);\r\n\r\n// Provider Component\r\nexport const DocumentProvider = ({ children, initialState = {} }) => {\r\n  const [state, dispatch] = useReducer(documentReducer, buildInitialState(initialState));\r\n\r\n  // Action creators wrapped in useCallback for performance\r\n  const actions = useMemo(() => ({\r\n    initializeDocument: (payload) => dispatch({ type: ActionTypes.INITIALIZE_DOCUMENT, payload }),\r\n    updateTitle: (title) => dispatch({ type: ActionTypes.UPDATE_TITLE, payload: title }),\r\n    updatePageContent: (payload) => dispatch({ type: ActionTypes.UPDATE_PAGE_CONTENT, payload }),\r\n    updatePages: (payload) => dispatch({ type: ActionTypes.UPDATE_PAGES, payload }),\r\n    addPage: (payload) => dispatch({ type: ActionTypes.ADD_PAGE, payload }),\r\n    deletePage: (pageIndex) => dispatch({ type: ActionTypes.DELETE_PAGE, payload: pageIndex }),\r\n    setActivePage: (pageIndex) => dispatch({ type: ActionTypes.SET_ACTIVE_PAGE, payload: pageIndex }),\r\n    updatePageSize: (size) => dispatch({ type: ActionTypes.UPDATE_PAGE_SIZE, payload: size }),\r\n    resetDocument: () => dispatch({ type: ActionTypes.RESET_DOCUMENT }),\r\n    updateContinuousContent: (content) => dispatch({ type: ActionTypes.UPDATE_CONTINUOUS_CONTENT, payload: content }),\r\n    updatePageBoundaries: (boundaries) => dispatch({ type: ActionTypes.UPDATE_PAGE_BOUNDARIES, payload: boundaries }),\r\n    addPageBreak: (payload) => dispatch({ type: ActionTypes.ADD_PAGE_BREAK, payload }),\r\n    removePageBreak: (payload) => dispatch({ type: ActionTypes.REMOVE_PAGE_BREAK, payload }),\r\n    setEditorMode: (mode) => dispatch({ type: ActionTypes.SET_EDITOR_MODE, payload: mode }),\r\n    setZoomLevel: (level) => dispatch({ type: ActionTypes.SET_ZOOM_LEVEL, payload: level }),\r\n    zoomIn: () => dispatch({ type: ActionTypes.ZOOM_IN }),\r\n    zoomOut: () => dispatch({ type: ActionTypes.ZOOM_OUT }),\r\n    resetZoom: () => dispatch({ type: ActionTypes.RESET_ZOOM }),\r\n    updatePageMargins: (margins) => dispatch({ type: ActionTypes.UPDATE_PAGE_MARGINS, payload: margins }),\r\n    // Undo/Redo actions\r\n    recordOperation: (operation, inverseOperation) => dispatch({ \r\n      type: ActionTypes.RECORD_OPERATION, \r\n      payload: { operation, inverseOperation } \r\n    }),\r\n    undo: () => dispatch({ type: ActionTypes.UNDO }),\r\n    redo: () => dispatch({ type: ActionTypes.REDO }),\r\n    clearUndoRedo: () => dispatch({ type: ActionTypes.CLEAR_UNDO_REDO })\r\n  }), []);\r\n\r\n  const value = useMemo(() => ({\r\n    state,\r\n    actions,\r\n    dispatch\r\n  }), [state, actions]);\r\n\r\n  return (\r\n    <DocumentContext.Provider value={value}>\r\n      {children}\r\n    </DocumentContext.Provider>\r\n  );\r\n};\r\n\r\n// Custom hook to use document context\r\nexport const useDocument = () => {\r\n  const context = useContext(DocumentContext);\r\n  if (!context) {\r\n    throw new Error('useDocument must be used within a DocumentProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\n// Selector hooks for specific state values\r\nexport const useDocumentState = () => {\r\n  const { state } = useDocument();\r\n  return state;\r\n};\r\n\r\nexport const useDocumentActions = () => {\r\n  const { actions } = useDocument();\r\n  return actions;\r\n};\r\n\r\nexport default DocumentContext;\r\n","/** @license React v16.13.1\n * react-is.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';var b=\"function\"===typeof Symbol&&Symbol.for,c=b?Symbol.for(\"react.element\"):60103,d=b?Symbol.for(\"react.portal\"):60106,e=b?Symbol.for(\"react.fragment\"):60107,f=b?Symbol.for(\"react.strict_mode\"):60108,g=b?Symbol.for(\"react.profiler\"):60114,h=b?Symbol.for(\"react.provider\"):60109,k=b?Symbol.for(\"react.context\"):60110,l=b?Symbol.for(\"react.async_mode\"):60111,m=b?Symbol.for(\"react.concurrent_mode\"):60111,n=b?Symbol.for(\"react.forward_ref\"):60112,p=b?Symbol.for(\"react.suspense\"):60113,q=b?\nSymbol.for(\"react.suspense_list\"):60120,r=b?Symbol.for(\"react.memo\"):60115,t=b?Symbol.for(\"react.lazy\"):60116,v=b?Symbol.for(\"react.block\"):60121,w=b?Symbol.for(\"react.fundamental\"):60117,x=b?Symbol.for(\"react.responder\"):60118,y=b?Symbol.for(\"react.scope\"):60119;\nfunction z(a){if(\"object\"===typeof a&&null!==a){var u=a.$$typeof;switch(u){case c:switch(a=a.type,a){case l:case m:case e:case g:case f:case p:return a;default:switch(a=a&&a.$$typeof,a){case k:case n:case t:case r:case h:return a;default:return u}}case d:return u}}}function A(a){return z(a)===m}exports.AsyncMode=l;exports.ConcurrentMode=m;exports.ContextConsumer=k;exports.ContextProvider=h;exports.Element=c;exports.ForwardRef=n;exports.Fragment=e;exports.Lazy=t;exports.Memo=r;exports.Portal=d;\nexports.Profiler=g;exports.StrictMode=f;exports.Suspense=p;exports.isAsyncMode=function(a){return A(a)||z(a)===l};exports.isConcurrentMode=A;exports.isContextConsumer=function(a){return z(a)===k};exports.isContextProvider=function(a){return z(a)===h};exports.isElement=function(a){return\"object\"===typeof a&&null!==a&&a.$$typeof===c};exports.isForwardRef=function(a){return z(a)===n};exports.isFragment=function(a){return z(a)===e};exports.isLazy=function(a){return z(a)===t};\nexports.isMemo=function(a){return z(a)===r};exports.isPortal=function(a){return z(a)===d};exports.isProfiler=function(a){return z(a)===g};exports.isStrictMode=function(a){return z(a)===f};exports.isSuspense=function(a){return z(a)===p};\nexports.isValidElementType=function(a){return\"string\"===typeof a||\"function\"===typeof a||a===e||a===m||a===g||a===f||a===p||a===q||\"object\"===typeof a&&null!==a&&(a.$$typeof===t||a.$$typeof===r||a.$$typeof===h||a.$$typeof===k||a.$$typeof===n||a.$$typeof===w||a.$$typeof===x||a.$$typeof===y||a.$$typeof===v)};exports.typeOf=z;\n","/** @license React v16.13.1\n * react-is.development.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\n\n\nif (process.env.NODE_ENV !== \"production\") {\n  (function() {\n'use strict';\n\n// The Symbol used to tag the ReactElement-like types. If there is no native Symbol\n// nor polyfill, then a plain number is used for performance.\nvar hasSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = hasSymbol ? Symbol.for('react.element') : 0xeac7;\nvar REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\nvar REACT_FRAGMENT_TYPE = hasSymbol ? Symbol.for('react.fragment') : 0xeacb;\nvar REACT_STRICT_MODE_TYPE = hasSymbol ? Symbol.for('react.strict_mode') : 0xeacc;\nvar REACT_PROFILER_TYPE = hasSymbol ? Symbol.for('react.profiler') : 0xead2;\nvar REACT_PROVIDER_TYPE = hasSymbol ? Symbol.for('react.provider') : 0xeacd;\nvar REACT_CONTEXT_TYPE = hasSymbol ? Symbol.for('react.context') : 0xeace; // TODO: We don't use AsyncMode or ConcurrentMode anymore. They were temporary\n// (unstable) APIs that have been removed. Can we remove the symbols?\n\nvar REACT_ASYNC_MODE_TYPE = hasSymbol ? Symbol.for('react.async_mode') : 0xeacf;\nvar REACT_CONCURRENT_MODE_TYPE = hasSymbol ? Symbol.for('react.concurrent_mode') : 0xeacf;\nvar REACT_FORWARD_REF_TYPE = hasSymbol ? Symbol.for('react.forward_ref') : 0xead0;\nvar REACT_SUSPENSE_TYPE = hasSymbol ? Symbol.for('react.suspense') : 0xead1;\nvar REACT_SUSPENSE_LIST_TYPE = hasSymbol ? Symbol.for('react.suspense_list') : 0xead8;\nvar REACT_MEMO_TYPE = hasSymbol ? Symbol.for('react.memo') : 0xead3;\nvar REACT_LAZY_TYPE = hasSymbol ? Symbol.for('react.lazy') : 0xead4;\nvar REACT_BLOCK_TYPE = hasSymbol ? Symbol.for('react.block') : 0xead9;\nvar REACT_FUNDAMENTAL_TYPE = hasSymbol ? Symbol.for('react.fundamental') : 0xead5;\nvar REACT_RESPONDER_TYPE = hasSymbol ? Symbol.for('react.responder') : 0xead6;\nvar REACT_SCOPE_TYPE = hasSymbol ? Symbol.for('react.scope') : 0xead7;\n\nfunction isValidElementType(type) {\n  return typeof type === 'string' || typeof type === 'function' || // Note: its typeof might be other than 'symbol' or 'number' if it's a polyfill.\n  type === REACT_FRAGMENT_TYPE || type === REACT_CONCURRENT_MODE_TYPE || type === REACT_PROFILER_TYPE || type === REACT_STRICT_MODE_TYPE || type === REACT_SUSPENSE_TYPE || type === REACT_SUSPENSE_LIST_TYPE || typeof type === 'object' && type !== null && (type.$$typeof === REACT_LAZY_TYPE || type.$$typeof === REACT_MEMO_TYPE || type.$$typeof === REACT_PROVIDER_TYPE || type.$$typeof === REACT_CONTEXT_TYPE || type.$$typeof === REACT_FORWARD_REF_TYPE || type.$$typeof === REACT_FUNDAMENTAL_TYPE || type.$$typeof === REACT_RESPONDER_TYPE || type.$$typeof === REACT_SCOPE_TYPE || type.$$typeof === REACT_BLOCK_TYPE);\n}\n\nfunction typeOf(object) {\n  if (typeof object === 'object' && object !== null) {\n    var $$typeof = object.$$typeof;\n\n    switch ($$typeof) {\n      case REACT_ELEMENT_TYPE:\n        var type = object.type;\n\n        switch (type) {\n          case REACT_ASYNC_MODE_TYPE:\n          case REACT_CONCURRENT_MODE_TYPE:\n          case REACT_FRAGMENT_TYPE:\n          case REACT_PROFILER_TYPE:\n          case REACT_STRICT_MODE_TYPE:\n          case REACT_SUSPENSE_TYPE:\n            return type;\n\n          default:\n            var $$typeofType = type && type.$$typeof;\n\n            switch ($$typeofType) {\n              case REACT_CONTEXT_TYPE:\n              case REACT_FORWARD_REF_TYPE:\n              case REACT_LAZY_TYPE:\n              case REACT_MEMO_TYPE:\n              case REACT_PROVIDER_TYPE:\n                return $$typeofType;\n\n              default:\n                return $$typeof;\n            }\n\n        }\n\n      case REACT_PORTAL_TYPE:\n        return $$typeof;\n    }\n  }\n\n  return undefined;\n} // AsyncMode is deprecated along with isAsyncMode\n\nvar AsyncMode = REACT_ASYNC_MODE_TYPE;\nvar ConcurrentMode = REACT_CONCURRENT_MODE_TYPE;\nvar ContextConsumer = REACT_CONTEXT_TYPE;\nvar ContextProvider = REACT_PROVIDER_TYPE;\nvar Element = REACT_ELEMENT_TYPE;\nvar ForwardRef = REACT_FORWARD_REF_TYPE;\nvar Fragment = REACT_FRAGMENT_TYPE;\nvar Lazy = REACT_LAZY_TYPE;\nvar Memo = REACT_MEMO_TYPE;\nvar Portal = REACT_PORTAL_TYPE;\nvar Profiler = REACT_PROFILER_TYPE;\nvar StrictMode = REACT_STRICT_MODE_TYPE;\nvar Suspense = REACT_SUSPENSE_TYPE;\nvar hasWarnedAboutDeprecatedIsAsyncMode = false; // AsyncMode should be deprecated\n\nfunction isAsyncMode(object) {\n  {\n    if (!hasWarnedAboutDeprecatedIsAsyncMode) {\n      hasWarnedAboutDeprecatedIsAsyncMode = true; // Using console['warn'] to evade Babel and ESLint\n\n      console['warn']('The ReactIs.isAsyncMode() alias has been deprecated, ' + 'and will be removed in React 17+. Update your code to use ' + 'ReactIs.isConcurrentMode() instead. It has the exact same API.');\n    }\n  }\n\n  return isConcurrentMode(object) || typeOf(object) === REACT_ASYNC_MODE_TYPE;\n}\nfunction isConcurrentMode(object) {\n  return typeOf(object) === REACT_CONCURRENT_MODE_TYPE;\n}\nfunction isContextConsumer(object) {\n  return typeOf(object) === REACT_CONTEXT_TYPE;\n}\nfunction isContextProvider(object) {\n  return typeOf(object) === REACT_PROVIDER_TYPE;\n}\nfunction isElement(object) {\n  return typeof object === 'object' && object !== null && object.$$typeof === REACT_ELEMENT_TYPE;\n}\nfunction isForwardRef(object) {\n  return typeOf(object) === REACT_FORWARD_REF_TYPE;\n}\nfunction isFragment(object) {\n  return typeOf(object) === REACT_FRAGMENT_TYPE;\n}\nfunction isLazy(object) {\n  return typeOf(object) === REACT_LAZY_TYPE;\n}\nfunction isMemo(object) {\n  return typeOf(object) === REACT_MEMO_TYPE;\n}\nfunction isPortal(object) {\n  return typeOf(object) === REACT_PORTAL_TYPE;\n}\nfunction isProfiler(object) {\n  return typeOf(object) === REACT_PROFILER_TYPE;\n}\nfunction isStrictMode(object) {\n  return typeOf(object) === REACT_STRICT_MODE_TYPE;\n}\nfunction isSuspense(object) {\n  return typeOf(object) === REACT_SUSPENSE_TYPE;\n}\n\nexports.AsyncMode = AsyncMode;\nexports.ConcurrentMode = ConcurrentMode;\nexports.ContextConsumer = ContextConsumer;\nexports.ContextProvider = ContextProvider;\nexports.Element = Element;\nexports.ForwardRef = ForwardRef;\nexports.Fragment = Fragment;\nexports.Lazy = Lazy;\nexports.Memo = Memo;\nexports.Portal = Portal;\nexports.Profiler = Profiler;\nexports.StrictMode = StrictMode;\nexports.Suspense = Suspense;\nexports.isAsyncMode = isAsyncMode;\nexports.isConcurrentMode = isConcurrentMode;\nexports.isContextConsumer = isContextConsumer;\nexports.isContextProvider = isContextProvider;\nexports.isElement = isElement;\nexports.isForwardRef = isForwardRef;\nexports.isFragment = isFragment;\nexports.isLazy = isLazy;\nexports.isMemo = isMemo;\nexports.isPortal = isPortal;\nexports.isProfiler = isProfiler;\nexports.isStrictMode = isStrictMode;\nexports.isSuspense = isSuspense;\nexports.isValidElementType = isValidElementType;\nexports.typeOf = typeOf;\n  })();\n}\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-is.production.min.js');\n} else {\n  module.exports = require('./cjs/react-is.development.js');\n}\n","/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\nvar ReactPropTypesSecret = 'SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED';\n\nmodule.exports = ReactPropTypesSecret;\n","module.exports = Function.call.bind(Object.prototype.hasOwnProperty);\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\nvar printWarning = function() {};\n\nif (process.env.NODE_ENV !== 'production') {\n  var ReactPropTypesSecret = require('./lib/ReactPropTypesSecret');\n  var loggedTypeFailures = {};\n  var has = require('./lib/has');\n\n  printWarning = function(text) {\n    var message = 'Warning: ' + text;\n    if (typeof console !== 'undefined') {\n      console.error(message);\n    }\n    try {\n      // --- Welcome to debugging React ---\n      // This error was thrown as a convenience so that you can use this stack\n      // to find the callsite that caused this warning to fire.\n      throw new Error(message);\n    } catch (x) { /**/ }\n  };\n}\n\n/**\n * Assert that the values match with the type specs.\n * Error messages are memorized and will only be shown once.\n *\n * @param {object} typeSpecs Map of name to a ReactPropType\n * @param {object} values Runtime values that need to be type-checked\n * @param {string} location e.g. \"prop\", \"context\", \"child context\"\n * @param {string} componentName Name of the component for error messages.\n * @param {?Function} getStack Returns the component stack.\n * @private\n */\nfunction checkPropTypes(typeSpecs, values, location, componentName, getStack) {\n  if (process.env.NODE_ENV !== 'production') {\n    for (var typeSpecName in typeSpecs) {\n      if (has(typeSpecs, typeSpecName)) {\n        var error;\n        // Prop type validation may throw. In case they do, we don't want to\n        // fail the render phase where it didn't fail before. So we log it.\n        // After these have been cleaned up, we'll let them throw.\n        try {\n          // This is intentionally an invariant that gets caught. It's the same\n          // behavior as without this statement except with a better message.\n          if (typeof typeSpecs[typeSpecName] !== 'function') {\n            var err = Error(\n              (componentName || 'React class') + ': ' + location + ' type `' + typeSpecName + '` is invalid; ' +\n              'it must be a function, usually from the `prop-types` package, but received `' + typeof typeSpecs[typeSpecName] + '`.' +\n              'This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.'\n            );\n            err.name = 'Invariant Violation';\n            throw err;\n          }\n          error = typeSpecs[typeSpecName](values, typeSpecName, componentName, location, null, ReactPropTypesSecret);\n        } catch (ex) {\n          error = ex;\n        }\n        if (error && !(error instanceof Error)) {\n          printWarning(\n            (componentName || 'React class') + ': type specification of ' +\n            location + ' `' + typeSpecName + '` is invalid; the type checker ' +\n            'function must return `null` or an `Error` but returned a ' + typeof error + '. ' +\n            'You may have forgotten to pass an argument to the type checker ' +\n            'creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and ' +\n            'shape all require an argument).'\n          );\n        }\n        if (error instanceof Error && !(error.message in loggedTypeFailures)) {\n          // Only monitor this failure once because there tends to be a lot of the\n          // same error.\n          loggedTypeFailures[error.message] = true;\n\n          var stack = getStack ? getStack() : '';\n\n          printWarning(\n            'Failed ' + location + ' type: ' + error.message + (stack != null ? stack : '')\n          );\n        }\n      }\n    }\n  }\n}\n\n/**\n * Resets warning cache when testing.\n *\n * @private\n */\ncheckPropTypes.resetWarningCache = function() {\n  if (process.env.NODE_ENV !== 'production') {\n    loggedTypeFailures = {};\n  }\n}\n\nmodule.exports = checkPropTypes;\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\nvar ReactIs = require('react-is');\nvar assign = require('object-assign');\n\nvar ReactPropTypesSecret = require('./lib/ReactPropTypesSecret');\nvar has = require('./lib/has');\nvar checkPropTypes = require('./checkPropTypes');\n\nvar printWarning = function() {};\n\nif (process.env.NODE_ENV !== 'production') {\n  printWarning = function(text) {\n    var message = 'Warning: ' + text;\n    if (typeof console !== 'undefined') {\n      console.error(message);\n    }\n    try {\n      // --- Welcome to debugging React ---\n      // This error was thrown as a convenience so that you can use this stack\n      // to find the callsite that caused this warning to fire.\n      throw new Error(message);\n    } catch (x) {}\n  };\n}\n\nfunction emptyFunctionThatReturnsNull() {\n  return null;\n}\n\nmodule.exports = function(isValidElement, throwOnDirectAccess) {\n  /* global Symbol */\n  var ITERATOR_SYMBOL = typeof Symbol === 'function' && Symbol.iterator;\n  var FAUX_ITERATOR_SYMBOL = '@@iterator'; // Before Symbol spec.\n\n  /**\n   * Returns the iterator method function contained on the iterable object.\n   *\n   * Be sure to invoke the function with the iterable as context:\n   *\n   *     var iteratorFn = getIteratorFn(myIterable);\n   *     if (iteratorFn) {\n   *       var iterator = iteratorFn.call(myIterable);\n   *       ...\n   *     }\n   *\n   * @param {?object} maybeIterable\n   * @return {?function}\n   */\n  function getIteratorFn(maybeIterable) {\n    var iteratorFn = maybeIterable && (ITERATOR_SYMBOL && maybeIterable[ITERATOR_SYMBOL] || maybeIterable[FAUX_ITERATOR_SYMBOL]);\n    if (typeof iteratorFn === 'function') {\n      return iteratorFn;\n    }\n  }\n\n  /**\n   * Collection of methods that allow declaration and validation of props that are\n   * supplied to React components. Example usage:\n   *\n   *   var Props = require('ReactPropTypes');\n   *   var MyArticle = React.createClass({\n   *     propTypes: {\n   *       // An optional string prop named \"description\".\n   *       description: Props.string,\n   *\n   *       // A required enum prop named \"category\".\n   *       category: Props.oneOf(['News','Photos']).isRequired,\n   *\n   *       // A prop named \"dialog\" that requires an instance of Dialog.\n   *       dialog: Props.instanceOf(Dialog).isRequired\n   *     },\n   *     render: function() { ... }\n   *   });\n   *\n   * A more formal specification of how these methods are used:\n   *\n   *   type := array|bool|func|object|number|string|oneOf([...])|instanceOf(...)\n   *   decl := ReactPropTypes.{type}(.isRequired)?\n   *\n   * Each and every declaration produces a function with the same signature. This\n   * allows the creation of custom validation functions. For example:\n   *\n   *  var MyLink = React.createClass({\n   *    propTypes: {\n   *      // An optional string or URI prop named \"href\".\n   *      href: function(props, propName, componentName) {\n   *        var propValue = props[propName];\n   *        if (propValue != null && typeof propValue !== 'string' &&\n   *            !(propValue instanceof URI)) {\n   *          return new Error(\n   *            'Expected a string or an URI for ' + propName + ' in ' +\n   *            componentName\n   *          );\n   *        }\n   *      }\n   *    },\n   *    render: function() {...}\n   *  });\n   *\n   * @internal\n   */\n\n  var ANONYMOUS = '<<anonymous>>';\n\n  // Important!\n  // Keep this list in sync with production version in `./factoryWithThrowingShims.js`.\n  var ReactPropTypes = {\n    array: createPrimitiveTypeChecker('array'),\n    bigint: createPrimitiveTypeChecker('bigint'),\n    bool: createPrimitiveTypeChecker('boolean'),\n    func: createPrimitiveTypeChecker('function'),\n    number: createPrimitiveTypeChecker('number'),\n    object: createPrimitiveTypeChecker('object'),\n    string: createPrimitiveTypeChecker('string'),\n    symbol: createPrimitiveTypeChecker('symbol'),\n\n    any: createAnyTypeChecker(),\n    arrayOf: createArrayOfTypeChecker,\n    element: createElementTypeChecker(),\n    elementType: createElementTypeTypeChecker(),\n    instanceOf: createInstanceTypeChecker,\n    node: createNodeChecker(),\n    objectOf: createObjectOfTypeChecker,\n    oneOf: createEnumTypeChecker,\n    oneOfType: createUnionTypeChecker,\n    shape: createShapeTypeChecker,\n    exact: createStrictShapeTypeChecker,\n  };\n\n  /**\n   * inlined Object.is polyfill to avoid requiring consumers ship their own\n   * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is\n   */\n  /*eslint-disable no-self-compare*/\n  function is(x, y) {\n    // SameValue algorithm\n    if (x === y) {\n      // Steps 1-5, 7-10\n      // Steps 6.b-6.e: +0 != -0\n      return x !== 0 || 1 / x === 1 / y;\n    } else {\n      // Step 6.a: NaN == NaN\n      return x !== x && y !== y;\n    }\n  }\n  /*eslint-enable no-self-compare*/\n\n  /**\n   * We use an Error-like object for backward compatibility as people may call\n   * PropTypes directly and inspect their output. However, we don't use real\n   * Errors anymore. We don't inspect their stack anyway, and creating them\n   * is prohibitively expensive if they are created too often, such as what\n   * happens in oneOfType() for any type before the one that matched.\n   */\n  function PropTypeError(message, data) {\n    this.message = message;\n    this.data = data && typeof data === 'object' ? data: {};\n    this.stack = '';\n  }\n  // Make `instanceof Error` still work for returned errors.\n  PropTypeError.prototype = Error.prototype;\n\n  function createChainableTypeChecker(validate) {\n    if (process.env.NODE_ENV !== 'production') {\n      var manualPropTypeCallCache = {};\n      var manualPropTypeWarningCount = 0;\n    }\n    function checkType(isRequired, props, propName, componentName, location, propFullName, secret) {\n      componentName = componentName || ANONYMOUS;\n      propFullName = propFullName || propName;\n\n      if (secret !== ReactPropTypesSecret) {\n        if (throwOnDirectAccess) {\n          // New behavior only for users of `prop-types` package\n          var err = new Error(\n            'Calling PropTypes validators directly is not supported by the `prop-types` package. ' +\n            'Use `PropTypes.checkPropTypes()` to call them. ' +\n            'Read more at http://fb.me/use-check-prop-types'\n          );\n          err.name = 'Invariant Violation';\n          throw err;\n        } else if (process.env.NODE_ENV !== 'production' && typeof console !== 'undefined') {\n          // Old behavior for people using React.PropTypes\n          var cacheKey = componentName + ':' + propName;\n          if (\n            !manualPropTypeCallCache[cacheKey] &&\n            // Avoid spamming the console because they are often not actionable except for lib authors\n            manualPropTypeWarningCount < 3\n          ) {\n            printWarning(\n              'You are manually calling a React.PropTypes validation ' +\n              'function for the `' + propFullName + '` prop on `' + componentName + '`. This is deprecated ' +\n              'and will throw in the standalone `prop-types` package. ' +\n              'You may be seeing this warning due to a third-party PropTypes ' +\n              'library. See https://fb.me/react-warning-dont-call-proptypes ' + 'for details.'\n            );\n            manualPropTypeCallCache[cacheKey] = true;\n            manualPropTypeWarningCount++;\n          }\n        }\n      }\n      if (props[propName] == null) {\n        if (isRequired) {\n          if (props[propName] === null) {\n            return new PropTypeError('The ' + location + ' `' + propFullName + '` is marked as required ' + ('in `' + componentName + '`, but its value is `null`.'));\n          }\n          return new PropTypeError('The ' + location + ' `' + propFullName + '` is marked as required in ' + ('`' + componentName + '`, but its value is `undefined`.'));\n        }\n        return null;\n      } else {\n        return validate(props, propName, componentName, location, propFullName);\n      }\n    }\n\n    var chainedCheckType = checkType.bind(null, false);\n    chainedCheckType.isRequired = checkType.bind(null, true);\n\n    return chainedCheckType;\n  }\n\n  function createPrimitiveTypeChecker(expectedType) {\n    function validate(props, propName, componentName, location, propFullName, secret) {\n      var propValue = props[propName];\n      var propType = getPropType(propValue);\n      if (propType !== expectedType) {\n        // `propValue` being instance of, say, date/regexp, pass the 'object'\n        // check, but we can offer a more precise error message here rather than\n        // 'of type `object`'.\n        var preciseType = getPreciseType(propValue);\n\n        return new PropTypeError(\n          'Invalid ' + location + ' `' + propFullName + '` of type ' + ('`' + preciseType + '` supplied to `' + componentName + '`, expected ') + ('`' + expectedType + '`.'),\n          {expectedType: expectedType}\n        );\n      }\n      return null;\n    }\n    return createChainableTypeChecker(validate);\n  }\n\n  function createAnyTypeChecker() {\n    return createChainableTypeChecker(emptyFunctionThatReturnsNull);\n  }\n\n  function createArrayOfTypeChecker(typeChecker) {\n    function validate(props, propName, componentName, location, propFullName) {\n      if (typeof typeChecker !== 'function') {\n        return new PropTypeError('Property `' + propFullName + '` of component `' + componentName + '` has invalid PropType notation inside arrayOf.');\n      }\n      var propValue = props[propName];\n      if (!Array.isArray(propValue)) {\n        var propType = getPropType(propValue);\n        return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type ' + ('`' + propType + '` supplied to `' + componentName + '`, expected an array.'));\n      }\n      for (var i = 0; i < propValue.length; i++) {\n        var error = typeChecker(propValue, i, componentName, location, propFullName + '[' + i + ']', ReactPropTypesSecret);\n        if (error instanceof Error) {\n          return error;\n        }\n      }\n      return null;\n    }\n    return createChainableTypeChecker(validate);\n  }\n\n  function createElementTypeChecker() {\n    function validate(props, propName, componentName, location, propFullName) {\n      var propValue = props[propName];\n      if (!isValidElement(propValue)) {\n        var propType = getPropType(propValue);\n        return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type ' + ('`' + propType + '` supplied to `' + componentName + '`, expected a single ReactElement.'));\n      }\n      return null;\n    }\n    return createChainableTypeChecker(validate);\n  }\n\n  function createElementTypeTypeChecker() {\n    function validate(props, propName, componentName, location, propFullName) {\n      var propValue = props[propName];\n      if (!ReactIs.isValidElementType(propValue)) {\n        var propType = getPropType(propValue);\n        return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type ' + ('`' + propType + '` supplied to `' + componentName + '`, expected a single ReactElement type.'));\n      }\n      return null;\n    }\n    return createChainableTypeChecker(validate);\n  }\n\n  function createInstanceTypeChecker(expectedClass) {\n    function validate(props, propName, componentName, location, propFullName) {\n      if (!(props[propName] instanceof expectedClass)) {\n        var expectedClassName = expectedClass.name || ANONYMOUS;\n        var actualClassName = getClassName(props[propName]);\n        return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type ' + ('`' + actualClassName + '` supplied to `' + componentName + '`, expected ') + ('instance of `' + expectedClassName + '`.'));\n      }\n      return null;\n    }\n    return createChainableTypeChecker(validate);\n  }\n\n  function createEnumTypeChecker(expectedValues) {\n    if (!Array.isArray(expectedValues)) {\n      if (process.env.NODE_ENV !== 'production') {\n        if (arguments.length > 1) {\n          printWarning(\n            'Invalid arguments supplied to oneOf, expected an array, got ' + arguments.length + ' arguments. ' +\n            'A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z]).'\n          );\n        } else {\n          printWarning('Invalid argument supplied to oneOf, expected an array.');\n        }\n      }\n      return emptyFunctionThatReturnsNull;\n    }\n\n    function validate(props, propName, componentName, location, propFullName) {\n      var propValue = props[propName];\n      for (var i = 0; i < expectedValues.length; i++) {\n        if (is(propValue, expectedValues[i])) {\n          return null;\n        }\n      }\n\n      var valuesString = JSON.stringify(expectedValues, function replacer(key, value) {\n        var type = getPreciseType(value);\n        if (type === 'symbol') {\n          return String(value);\n        }\n        return value;\n      });\n      return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of value `' + String(propValue) + '` ' + ('supplied to `' + componentName + '`, expected one of ' + valuesString + '.'));\n    }\n    return createChainableTypeChecker(validate);\n  }\n\n  function createObjectOfTypeChecker(typeChecker) {\n    function validate(props, propName, componentName, location, propFullName) {\n      if (typeof typeChecker !== 'function') {\n        return new PropTypeError('Property `' + propFullName + '` of component `' + componentName + '` has invalid PropType notation inside objectOf.');\n      }\n      var propValue = props[propName];\n      var propType = getPropType(propValue);\n      if (propType !== 'object') {\n        return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type ' + ('`' + propType + '` supplied to `' + componentName + '`, expected an object.'));\n      }\n      for (var key in propValue) {\n        if (has(propValue, key)) {\n          var error = typeChecker(propValue, key, componentName, location, propFullName + '.' + key, ReactPropTypesSecret);\n          if (error instanceof Error) {\n            return error;\n          }\n        }\n      }\n      return null;\n    }\n    return createChainableTypeChecker(validate);\n  }\n\n  function createUnionTypeChecker(arrayOfTypeCheckers) {\n    if (!Array.isArray(arrayOfTypeCheckers)) {\n      process.env.NODE_ENV !== 'production' ? printWarning('Invalid argument supplied to oneOfType, expected an instance of array.') : void 0;\n      return emptyFunctionThatReturnsNull;\n    }\n\n    for (var i = 0; i < arrayOfTypeCheckers.length; i++) {\n      var checker = arrayOfTypeCheckers[i];\n      if (typeof checker !== 'function') {\n        printWarning(\n          'Invalid argument supplied to oneOfType. Expected an array of check functions, but ' +\n          'received ' + getPostfixForTypeWarning(checker) + ' at index ' + i + '.'\n        );\n        return emptyFunctionThatReturnsNull;\n      }\n    }\n\n    function validate(props, propName, componentName, location, propFullName) {\n      var expectedTypes = [];\n      for (var i = 0; i < arrayOfTypeCheckers.length; i++) {\n        var checker = arrayOfTypeCheckers[i];\n        var checkerResult = checker(props, propName, componentName, location, propFullName, ReactPropTypesSecret);\n        if (checkerResult == null) {\n          return null;\n        }\n        if (checkerResult.data && has(checkerResult.data, 'expectedType')) {\n          expectedTypes.push(checkerResult.data.expectedType);\n        }\n      }\n      var expectedTypesMessage = (expectedTypes.length > 0) ? ', expected one of type [' + expectedTypes.join(', ') + ']': '';\n      return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` supplied to ' + ('`' + componentName + '`' + expectedTypesMessage + '.'));\n    }\n    return createChainableTypeChecker(validate);\n  }\n\n  function createNodeChecker() {\n    function validate(props, propName, componentName, location, propFullName) {\n      if (!isNode(props[propName])) {\n        return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` supplied to ' + ('`' + componentName + '`, expected a ReactNode.'));\n      }\n      return null;\n    }\n    return createChainableTypeChecker(validate);\n  }\n\n  function invalidValidatorError(componentName, location, propFullName, key, type) {\n    return new PropTypeError(\n      (componentName || 'React class') + ': ' + location + ' type `' + propFullName + '.' + key + '` is invalid; ' +\n      'it must be a function, usually from the `prop-types` package, but received `' + type + '`.'\n    );\n  }\n\n  function createShapeTypeChecker(shapeTypes) {\n    function validate(props, propName, componentName, location, propFullName) {\n      var propValue = props[propName];\n      var propType = getPropType(propValue);\n      if (propType !== 'object') {\n        return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type `' + propType + '` ' + ('supplied to `' + componentName + '`, expected `object`.'));\n      }\n      for (var key in shapeTypes) {\n        var checker = shapeTypes[key];\n        if (typeof checker !== 'function') {\n          return invalidValidatorError(componentName, location, propFullName, key, getPreciseType(checker));\n        }\n        var error = checker(propValue, key, componentName, location, propFullName + '.' + key, ReactPropTypesSecret);\n        if (error) {\n          return error;\n        }\n      }\n      return null;\n    }\n    return createChainableTypeChecker(validate);\n  }\n\n  function createStrictShapeTypeChecker(shapeTypes) {\n    function validate(props, propName, componentName, location, propFullName) {\n      var propValue = props[propName];\n      var propType = getPropType(propValue);\n      if (propType !== 'object') {\n        return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type `' + propType + '` ' + ('supplied to `' + componentName + '`, expected `object`.'));\n      }\n      // We need to check all keys in case some are required but missing from props.\n      var allKeys = assign({}, props[propName], shapeTypes);\n      for (var key in allKeys) {\n        var checker = shapeTypes[key];\n        if (has(shapeTypes, key) && typeof checker !== 'function') {\n          return invalidValidatorError(componentName, location, propFullName, key, getPreciseType(checker));\n        }\n        if (!checker) {\n          return new PropTypeError(\n            'Invalid ' + location + ' `' + propFullName + '` key `' + key + '` supplied to `' + componentName + '`.' +\n            '\\nBad object: ' + JSON.stringify(props[propName], null, '  ') +\n            '\\nValid keys: ' + JSON.stringify(Object.keys(shapeTypes), null, '  ')\n          );\n        }\n        var error = checker(propValue, key, componentName, location, propFullName + '.' + key, ReactPropTypesSecret);\n        if (error) {\n          return error;\n        }\n      }\n      return null;\n    }\n\n    return createChainableTypeChecker(validate);\n  }\n\n  function isNode(propValue) {\n    switch (typeof propValue) {\n      case 'number':\n      case 'string':\n      case 'undefined':\n        return true;\n      case 'boolean':\n        return !propValue;\n      case 'object':\n        if (Array.isArray(propValue)) {\n          return propValue.every(isNode);\n        }\n        if (propValue === null || isValidElement(propValue)) {\n          return true;\n        }\n\n        var iteratorFn = getIteratorFn(propValue);\n        if (iteratorFn) {\n          var iterator = iteratorFn.call(propValue);\n          var step;\n          if (iteratorFn !== propValue.entries) {\n            while (!(step = iterator.next()).done) {\n              if (!isNode(step.value)) {\n                return false;\n              }\n            }\n          } else {\n            // Iterator will provide entry [k,v] tuples rather than values.\n            while (!(step = iterator.next()).done) {\n              var entry = step.value;\n              if (entry) {\n                if (!isNode(entry[1])) {\n                  return false;\n                }\n              }\n            }\n          }\n        } else {\n          return false;\n        }\n\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  function isSymbol(propType, propValue) {\n    // Native Symbol.\n    if (propType === 'symbol') {\n      return true;\n    }\n\n    // falsy value can't be a Symbol\n    if (!propValue) {\n      return false;\n    }\n\n    // 19.4.3.5 Symbol.prototype[@@toStringTag] === 'Symbol'\n    if (propValue['@@toStringTag'] === 'Symbol') {\n      return true;\n    }\n\n    // Fallback for non-spec compliant Symbols which are polyfilled.\n    if (typeof Symbol === 'function' && propValue instanceof Symbol) {\n      return true;\n    }\n\n    return false;\n  }\n\n  // Equivalent of `typeof` but with special handling for array and regexp.\n  function getPropType(propValue) {\n    var propType = typeof propValue;\n    if (Array.isArray(propValue)) {\n      return 'array';\n    }\n    if (propValue instanceof RegExp) {\n      // Old webkits (at least until Android 4.0) return 'function' rather than\n      // 'object' for typeof a RegExp. We'll normalize this here so that /bla/\n      // passes PropTypes.object.\n      return 'object';\n    }\n    if (isSymbol(propType, propValue)) {\n      return 'symbol';\n    }\n    return propType;\n  }\n\n  // This handles more types than `getPropType`. Only used for error messages.\n  // See `createPrimitiveTypeChecker`.\n  function getPreciseType(propValue) {\n    if (typeof propValue === 'undefined' || propValue === null) {\n      return '' + propValue;\n    }\n    var propType = getPropType(propValue);\n    if (propType === 'object') {\n      if (propValue instanceof Date) {\n        return 'date';\n      } else if (propValue instanceof RegExp) {\n        return 'regexp';\n      }\n    }\n    return propType;\n  }\n\n  // Returns a string that is postfixed to a warning about an invalid type.\n  // For example, \"undefined\" or \"of type array\"\n  function getPostfixForTypeWarning(value) {\n    var type = getPreciseType(value);\n    switch (type) {\n      case 'array':\n      case 'object':\n        return 'an ' + type;\n      case 'boolean':\n      case 'date':\n      case 'regexp':\n        return 'a ' + type;\n      default:\n        return type;\n    }\n  }\n\n  // Returns class name of the object, if any.\n  function getClassName(propValue) {\n    if (!propValue.constructor || !propValue.constructor.name) {\n      return ANONYMOUS;\n    }\n    return propValue.constructor.name;\n  }\n\n  ReactPropTypes.checkPropTypes = checkPropTypes;\n  ReactPropTypes.resetWarningCache = checkPropTypes.resetWarningCache;\n  ReactPropTypes.PropTypes = ReactPropTypes;\n\n  return ReactPropTypes;\n};\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\nvar ReactPropTypesSecret = require('./lib/ReactPropTypesSecret');\n\nfunction emptyFunction() {}\nfunction emptyFunctionWithReset() {}\nemptyFunctionWithReset.resetWarningCache = emptyFunction;\n\nmodule.exports = function() {\n  function shim(props, propName, componentName, location, propFullName, secret) {\n    if (secret === ReactPropTypesSecret) {\n      // It is still safe when called from React.\n      return;\n    }\n    var err = new Error(\n      'Calling PropTypes validators directly is not supported by the `prop-types` package. ' +\n      'Use PropTypes.checkPropTypes() to call them. ' +\n      'Read more at http://fb.me/use-check-prop-types'\n    );\n    err.name = 'Invariant Violation';\n    throw err;\n  };\n  shim.isRequired = shim;\n  function getShim() {\n    return shim;\n  };\n  // Important!\n  // Keep this list in sync with production version in `./factoryWithTypeCheckers.js`.\n  var ReactPropTypes = {\n    array: shim,\n    bigint: shim,\n    bool: shim,\n    func: shim,\n    number: shim,\n    object: shim,\n    string: shim,\n    symbol: shim,\n\n    any: shim,\n    arrayOf: getShim,\n    element: shim,\n    elementType: shim,\n    instanceOf: getShim,\n    node: shim,\n    objectOf: getShim,\n    oneOf: getShim,\n    oneOfType: getShim,\n    shape: getShim,\n    exact: getShim,\n\n    checkPropTypes: emptyFunctionWithReset,\n    resetWarningCache: emptyFunction\n  };\n\n  ReactPropTypes.PropTypes = ReactPropTypes;\n\n  return ReactPropTypes;\n};\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nif (process.env.NODE_ENV !== 'production') {\n  var ReactIs = require('react-is');\n\n  // By explicitly using `prop-types` you are opting into new development behavior.\n  // http://fb.me/prop-types-in-prod\n  var throwOnDirectAccess = true;\n  module.exports = require('./factoryWithTypeCheckers')(ReactIs.isElement, throwOnDirectAccess);\n} else {\n  // By explicitly using `prop-types` you are opting into new production behavior.\n  // http://fb.me/prop-types-in-prod\n  module.exports = require('./factoryWithThrowingShims')();\n}\n","/**\r\n * Font size constants and conversions\r\n * Approximate conversions from Points (pt) to Pixels (px) at 96 DPI\r\n * \r\n * Standard conversion: 1 pt = 1.333... px (at 96 DPI)\r\n * These values match Microsoft Word's font size rendering\r\n */\r\n\r\n/**\r\n * Font size mapping from points to pixels\r\n * Based on 96 DPI (Microsoft Word standard)\r\n */\r\nexport const FONT_SIZE_MAP = {\r\n  '7.5pt': { pt: 7.5, px: 10, label: '7.5' },\r\n  '9pt': { pt: 9, px: 12, label: '9' },\r\n  '10pt': { pt: 10, px: 13, label: '10' },\r\n  '11pt': { pt: 11, px: 15, label: '11' },\r\n  '12pt': { pt: 12, px: 16, label: '12' },\r\n  '14pt': { pt: 14, px: 19, label: '14' },\r\n  '16pt': { pt: 16, px: 21, label: '16' },\r\n  '18pt': { pt: 18, px: 24, label: '18' },\r\n  '20pt': { pt: 20, px: 27, label: '20' },\r\n  '22pt': { pt: 22, px: 29, label: '22' },\r\n  '24pt': { pt: 24, px: 32, label: '24' },\r\n  '26pt': { pt: 26, px: 35, label: '26' },\r\n  '28pt': { pt: 28, px: 37, label: '28' },\r\n  '36pt': { pt: 36, px: 48, label: '36' },\r\n  '48pt': { pt: 48, px: 64, label: '48' },\r\n  '72pt': { pt: 72, px: 96, label: '72' }\r\n};\r\n\r\n/**\r\n * Common font sizes for editor dropdown\r\n * Values in pixels matching Word's point sizes\r\n */\r\nexport const COMMON_FONT_SIZES = [\r\n  { value: '10px', label: '7.5', pt: 7.5 },   // 7.5 pt ≈ 10 px\r\n  { value: '12px', label: '9', pt: 9 },       // 9 pt ≈ 12 px\r\n  { value: '13px', label: '10', pt: 10 },     // 10 pt ≈ 13 px\r\n  { value: '15px', label: '11', pt: 11 },     // 11 pt ≈ 15 px (default in Word)\r\n  { value: '16px', label: '12', pt: 12 },     // 12 pt ≈ 16 px\r\n  { value: '19px', label: '14', pt: 14 },     // 14 pt ≈ 19 px\r\n  { value: '21px', label: '16', pt: 16 },     // 16 pt ≈ 21 px\r\n  { value: '24px', label: '18', pt: 18 },     // 18 pt ≈ 24 px\r\n  { value: '27px', label: '20', pt: 20 },     // 20 pt ≈ 27 px\r\n  { value: '32px', label: '24', pt: 24 },     // 24 pt ≈ 32 px\r\n  { value: '37px', label: '28', pt: 28 },     // 28 pt ≈ 37 px\r\n  { value: '48px', label: '36', pt: 36 },     // 36 pt ≈ 48 px\r\n  { value: '64px', label: '48', pt: 48 },     // 48 pt ≈ 64 px\r\n  { value: '96px', label: '72', pt: 72 }      // 72 pt ≈ 96 px\r\n];\r\n\r\n/**\r\n * Default font size (9 pt in Word, which is 12px at 96 DPI)\r\n */\r\nexport const DEFAULT_FONT_SIZE = '16px';\r\n\r\n/**\r\n * Convert points to pixels at 96 DPI\r\n * @param {number} points - Font size in points\r\n * @returns {number} Font size in pixels\r\n */\r\nexport const pointsToPixels = (points) => {\r\n  return Math.round(points * 96 / 72);\r\n};\r\n\r\n/**\r\n * Convert pixels to points at 96 DPI\r\n * @param {number} pixels - Font size in pixels\r\n * @returns {number} Font size in points\r\n */\r\nexport const pixelsToPoints = (pixels) => {\r\n  return Math.round((pixels * 72 / 96) * 2) / 2; // Round to nearest 0.5\r\n};\r\n\r\n/**\r\n * Get pixel value from point size\r\n * @param {number} pt - Point size\r\n * @returns {string} Pixel value with 'px' suffix\r\n */\r\nexport const getPixelValue = (pt) => {\r\n  const fontSize = Object.values(FONT_SIZE_MAP).find(size => size.pt === pt);\r\n  return fontSize ? `${fontSize.px}px` : `${pointsToPixels(pt)}px`;\r\n};\r\n\r\n/**\r\n * Get point value from pixel size\r\n * @param {string} px - Pixel size (e.g., '16px')\r\n * @returns {number} Point value\r\n */\r\nexport const getPointValue = (px) => {\r\n  const pixelValue = parseInt(px);\r\n  const fontSize = Object.values(FONT_SIZE_MAP).find(size => size.px === pixelValue);\r\n  return fontSize ? fontSize.pt : pixelsToPoints(pixelValue);\r\n};\r\n\r\n/**\r\n * Validate if a font size is valid\r\n * @param {string} size - Font size to validate (e.g., '16px' or '12pt')\r\n * @returns {boolean} True if valid\r\n */\r\nexport const isValidFontSize = (size) => {\r\n  if (!size) return false;\r\n  \r\n  if (size.endsWith('px')) {\r\n    const px = parseInt(size);\r\n    return px >= 8 && px <= 144; // Min 6pt, Max 108pt\r\n  }\r\n  \r\n  if (size.endsWith('pt')) {\r\n    const pt = parseFloat(size);\r\n    return pt >= 6 && pt <= 108;\r\n  }\r\n  \r\n  return false;\r\n};\r\n","import { useState, useCallback } from 'react';\r\nimport { DEFAULT_FONT_SIZE } from '../lib/editor/font-sizes';\r\nimport { useDocumentActions } from '../context/DocumentContext';\r\n\r\n// Constants for better maintainability\r\n// Font size mapping for execCommand (legacy HTML font sizes 1-7)\r\nconst FONT_SIZE_MAP = {\r\n  '10px': '1',   // 7.5 pt\r\n  '12px': '2',   // 9 pt\r\n  '13px': '2',   // 10 pt\r\n  '15px': '3',   // 11 pt (Word default)\r\n  '16px': '3',   // 12 pt\r\n  '19px': '4',   // 14 pt\r\n  '21px': '4',   // 16 pt\r\n  '24px': '5',   // 18 pt\r\n  '27px': '5',   // 20 pt\r\n  '32px': '6',   // 24 pt\r\n  '37px': '6',   // 28 pt\r\n  '48px': '6',   // 36 pt\r\n  '64px': '7',   // 48 pt\r\n  '96px': '7'    // 72 pt\r\n};\r\n\r\nconst DEFAULT_FORMAT = {\r\n  bold: false,\r\n  italic: false,\r\n  underline: false,\r\n  strikethrough: false,\r\n  alignLeft: false,\r\n  alignCenter: false,\r\n  alignRight: false,\r\n  alignJustify: false,\r\n  fontFamily: 'Arial',\r\n  fontSize: DEFAULT_FONT_SIZE,\r\n  fontColor: '#000000', // Add font color tracking\r\n  headingLevel: 'p' // Add heading level tracking\r\n};\r\n\r\n/**\r\n * useFormatting - Hook for managing text formatting state and commands\r\n * Handles document.execCommand for rich text formatting\r\n * Optimized with better selection handling and error recovery\r\n */\r\nexport const useFormatting = () => {\r\n  const [currentFormat, setCurrentFormat] = useState(DEFAULT_FORMAT);\r\n  const actions = useDocumentActions();\r\n\r\n  /**\r\n   * Helper function to apply a style to the current selection\r\n   */\r\n  const applyStyleToSelection = useCallback((styleProperty, value, fallbackCommand = null) => {\r\n    try {\r\n      // Save current selection\r\n      const selection = window.getSelection();\r\n      if (!selection || selection.rangeCount === 0) {\r\n        return false;\r\n      }\r\n\r\n      const range = selection.getRangeAt(0);\r\n      const selectedText = range.toString();\r\n\r\n      if (!selectedText) {\r\n        // No text selected - just update state for next input\r\n        setCurrentFormat(prev => ({ ...prev, [styleProperty]: value }));\r\n        return false;\r\n      }\r\n\r\n      // Try modern approach first - wrap in span with style\r\n      try {\r\n        const span = document.createElement('span');\r\n        span.style[styleProperty] = value;\r\n\r\n        // Extract contents and wrap\r\n        const fragment = range.extractContents();\r\n        span.appendChild(fragment);\r\n        range.insertNode(span);\r\n\r\n        // Restore selection\r\n        range.selectNodeContents(span);\r\n        selection.removeAllRanges();\r\n        selection.addRange(range);\r\n\r\n        setCurrentFormat(prev => ({ ...prev, [styleProperty]: value }));\r\n        return true;\r\n      } catch {\r\n        // Fallback to execCommand if provided\r\n        if (fallbackCommand) {\r\n          const mappedValue = styleProperty === 'fontSize' ? (FONT_SIZE_MAP[value] || '3') : value;\r\n          document.execCommand(fallbackCommand, false, mappedValue);\r\n          setCurrentFormat(prev => ({ ...prev, [styleProperty]: value }));\r\n          return true;\r\n        }\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      console.warn(`[useFormatting] Style application failed for ${styleProperty}:`, error);\r\n      return false;\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Handle font family with improved reliability\r\n   */\r\n  const handleFontName = useCallback((value) => {\r\n    return applyStyleToSelection('fontFamily', value, 'fontName');\r\n  }, [applyStyleToSelection]);\r\n\r\n  /**\r\n   * Handle font size with improved reliability\r\n   */\r\n  const handleFontSize = useCallback((value) => {\r\n    return applyStyleToSelection('fontSize', value, 'fontSize');\r\n  }, [applyStyleToSelection]);\r\n\r\n  /**\r\n   * Handle font color with improved reliability\r\n   */\r\n  const handleFontColor = useCallback((value) => {\r\n    return applyStyleToSelection('color', value, 'foreColor');\r\n  }, [applyStyleToSelection]);\r\n\r\n  /**\r\n   * Update alignment state based on text-align value\r\n   */\r\n  const updateAlignmentState = useCallback((textAlign) => {\r\n    setCurrentFormat(prev => ({\r\n      ...prev,\r\n      alignLeft: textAlign === 'left',\r\n      alignCenter: textAlign === 'center',\r\n      alignRight: textAlign === 'right',\r\n      alignJustify: textAlign === 'justify'\r\n    }));\r\n  }, []);\r\n\r\n  /**\r\n   * Handle text alignment by applying styles directly to paragraph elements\r\n   * instead of wrapping content in divs with text-align\r\n   */\r\n  const handleTextAlignment = useCallback((command) => {\r\n    try {\r\n      const selection = window.getSelection();\r\n      if (!selection || selection.rangeCount === 0) {\r\n        return false;\r\n      }\r\n\r\n      const range = selection.getRangeAt(0);\r\n      const selectedText = range.toString();\r\n\r\n      // Map command to CSS text-align value\r\n      const alignMap = {\r\n        justifyLeft: 'left',\r\n        justifyCenter: 'center',\r\n        justifyRight: 'right',\r\n        justifyFull: 'justify'\r\n      };\r\n\r\n      const textAlign = alignMap[command];\r\n      if (!textAlign) {\r\n        return false;\r\n      }\r\n\r\n      if (!selectedText) {\r\n        // No text selected - apply to current paragraph or create new one\r\n        const startContainer = range.startContainer;\r\n        const element = startContainer.nodeType === Node.TEXT_NODE\r\n          ? startContainer.parentElement\r\n          : startContainer;\r\n\r\n        const blockElement = findNearestBlockElement(element) || createParagraphAtCursor();\r\n        if (blockElement) {\r\n          blockElement.style.textAlign = textAlign;\r\n          // Update format state\r\n          updateAlignmentState(textAlign);\r\n        }\r\n        return true;\r\n      }\r\n\r\n      // Text is selected - find all block elements in the selection and apply alignment\r\n      const blockElements = findBlockElementsInRange(range);\r\n      \r\n      if (blockElements.length === 0) {\r\n        // No block elements found, wrap selection in a paragraph with alignment\r\n        const p = document.createElement('p');\r\n        p.style.textAlign = textAlign;\r\n        \r\n        const fragment = range.extractContents();\r\n        p.appendChild(fragment);\r\n        range.insertNode(p);\r\n        \r\n        // Restore selection\r\n        range.selectNodeContents(p);\r\n        selection.removeAllRanges();\r\n        selection.addRange(range);\r\n      } else {\r\n        // Apply alignment to all block elements in the selection\r\n        blockElements.forEach(block => {\r\n          block.style.textAlign = textAlign;\r\n        });\r\n      }\r\n\r\n      // Update format state\r\n      updateAlignmentState(textAlign);\r\n      return true;\r\n    } catch (error) {\r\n      console.warn('[useFormatting] Text alignment failed:', error);\r\n      return false;\r\n    }\r\n  }, [updateAlignmentState]);\r\n\r\n  /**\r\n   * Handle insertHTML command with special handling for block elements like tables\r\n   * Ensures tables and other block elements are not wrapped in paragraphs\r\n   */\r\n  const handleInsertHTML = useCallback((html) => {\r\n    try {\r\n      const selection = window.getSelection();\r\n      if (!selection || selection.rangeCount === 0) {\r\n        return false;\r\n      }\r\n\r\n      const range = selection.getRangeAt(0);\r\n\r\n      // Check if the HTML contains block elements that shouldn't be wrapped in paragraphs\r\n      const tempDiv = document.createElement('div');\r\n      tempDiv.innerHTML = html;\r\n      const hasBlockElements = Array.from(tempDiv.children).some(child =>\r\n        ['TABLE', 'UL', 'OL', 'BLOCKQUOTE', 'PRE', 'DIV', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6'].includes(child.tagName)\r\n      );\r\n\r\n      if (hasBlockElements) {\r\n        // For block elements, we need to ensure they're inserted outside of any paragraph context\r\n        const startContainer = range.startContainer;\r\n        const startElement = startContainer.nodeType === Node.TEXT_NODE\r\n          ? startContainer.parentElement\r\n          : startContainer;\r\n\r\n        // Find the nearest block element (paragraph, heading, etc.)\r\n        const blockElement = findNearestBlockElement(startElement);\r\n\r\n        if (blockElement && ['P', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6'].includes(blockElement.tagName)) {\r\n          // We're inside a paragraph or heading - we need to split it or insert after it\r\n          const blockTagName = blockElement.tagName.toLowerCase();\r\n\r\n          // Check if cursor is at the beginning of the block\r\n          const isAtStart = range.startOffset === 0 &&\r\n            (startContainer === blockElement ||\r\n             (startContainer.nodeType === Node.TEXT_NODE && startContainer === blockElement.firstChild));\r\n\r\n          if (isAtStart) {\r\n            // Insert before the current block element\r\n            blockElement.parentNode.insertBefore(tempDiv, blockElement);\r\n          } else {\r\n            // Check if cursor is at the end of the block\r\n            const isAtEnd = range.startOffset === startContainer.textContent?.length &&\r\n              startContainer === blockElement.lastChild &&\r\n              range.endOffset === startContainer.textContent?.length;\r\n\r\n            if (isAtEnd) {\r\n              // Insert after the current block element\r\n              const nextSibling = blockElement.nextSibling;\r\n              if (nextSibling) {\r\n                blockElement.parentNode.insertBefore(tempDiv, nextSibling);\r\n              } else {\r\n                blockElement.parentNode.appendChild(tempDiv);\r\n              }\r\n            } else {\r\n              // Split the block element at cursor position\r\n              const fragment = range.extractContents();\r\n              const remainingText = document.createTextNode('');\r\n\r\n              // Create new block element for remaining content\r\n              const newBlock = document.createElement(blockTagName);\r\n              newBlock.appendChild(remainingText);\r\n              newBlock.appendChild(fragment);\r\n\r\n              // Insert the HTML and new block after current block\r\n              const parent = blockElement.parentNode;\r\n              parent.insertBefore(tempDiv, blockElement.nextSibling);\r\n              parent.insertBefore(newBlock, tempDiv.nextSibling);\r\n\r\n              // If original block is now empty, remove it\r\n              if (!blockElement.textContent.trim() && blockElement.children.length === 0) {\r\n                parent.removeChild(blockElement);\r\n              }\r\n            }\r\n          }\r\n        } else {\r\n          // Not inside a paragraph/heading, insert normally\r\n          range.insertNode(tempDiv);\r\n        }\r\n\r\n        // Move cursor after the inserted content\r\n        range.setStartAfter(tempDiv);\r\n        range.setEndAfter(tempDiv);\r\n        selection.removeAllRanges();\r\n        selection.addRange(range);\r\n      } else {\r\n        // For inline content, use standard execCommand\r\n        document.execCommand('insertHTML', false, html);\r\n      }\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.warn('[useFormatting] InsertHTML failed:', error);\r\n      // Fallback to standard execCommand\r\n      try {\r\n        document.execCommand('insertHTML', false, html);\r\n        return true;\r\n      } catch (fallbackError) {\r\n        console.warn('[useFormatting] InsertHTML fallback also failed:', fallbackError);\r\n        return false;\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Format text using document.execCommand or custom undo/redo\r\n   * Optimized with better error handling and selection management\r\n   */\r\n  const formatText = useCallback((command, value = null) => {\r\n    try {\r\n      // Handle undo/redo commands using custom system\r\n      if (command === 'undo') {\r\n        actions.undo();\r\n        return;\r\n      }\r\n      \r\n      if (command === 'redo') {\r\n        actions.redo();\r\n        return;\r\n      }\r\n\r\n      // Check if document.execCommand is supported\r\n      if (typeof document.execCommand !== 'function') {\r\n        console.warn('[useFormatting] execCommand not supported');\r\n        return;\r\n      }\r\n\r\n      // Handle insertHTML specially for block elements like tables\r\n      if (command === 'insertHTML' && value) {\r\n        handleInsertHTML(value);\r\n        return;\r\n      }\r\n\r\n      // Handle fontSize separately for better control\r\n      if (command === 'fontSize') {\r\n        handleFontSize(value);\r\n        return;\r\n      }\r\n\r\n      // Handle fontName separately for better control\r\n      if (command === 'fontName') {\r\n        handleFontName(value);\r\n        return;\r\n      }\r\n\r\n      // Handle foreColor separately for better control\r\n      if (command === 'foreColor') {\r\n        handleFontColor(value);\r\n        return;\r\n      }\r\n\r\n      // Handle alignment commands specially to apply to paragraph elements instead of wrapping in divs\r\n      if (['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'].includes(command)) {\r\n        handleTextAlignment(command);\r\n        return;\r\n      }\r\n\r\n      // Execute the command\r\n      const success = document.execCommand(command, false, value);\r\n      \r\n      if (!success) {\r\n        console.warn(`[useFormatting] Command \"${command}\" failed`);\r\n      }\r\n\r\n      // Update format state based on command - but let selection change handle the actual state\r\n      // This is kept for immediate feedback but will be overridden by selection change\r\n      switch (command) {\r\n        case 'bold':\r\n        case 'italic':\r\n        case 'underline':\r\n        case 'strikethrough':\r\n        case 'justifyLeft':\r\n        case 'justifyCenter':\r\n        case 'justifyRight':\r\n        case 'justifyFull':\r\n        case 'fontName':\r\n        case 'foreColor':\r\n          // These will be updated by the selection change listener\r\n          break;\r\n        case 'formatBlock':\r\n          setCurrentFormat(prev => ({ ...prev, headingLevel: value }));\r\n          break;\r\n        default:\r\n          // Commands like insertUnorderedList, createLink, etc. don't need state updates\r\n          break;\r\n      }\r\n    } catch (error) {\r\n      console.warn(`[useFormatting] Error executing command \"${command}\":`, error);\r\n    }\r\n  }, [handleFontSize, handleFontName, handleTextAlignment, handleInsertHTML, actions]);\r\n\r\n  /**\r\n   * Update current format state based on current selection\r\n   */\r\n  const updateCurrentFormatFromSelection = useCallback(() => {\r\n    try {\r\n      const selection = window.getSelection();\r\n      if (!selection || selection.rangeCount === 0) {\r\n        return;\r\n      }\r\n\r\n      // Get the current selection range\r\n      const range = selection.getRangeAt(0);\r\n      const selectedText = range.toString();\r\n\r\n      let fontSize = DEFAULT_FONT_SIZE;\r\n      let fontFamily = 'Arial';\r\n      let fontColor = '#000000'; // Default font color\r\n      let headingLevel = 'p';\r\n      let textAlign = 'left'; // Default alignment\r\n\r\n      if (selectedText) {\r\n        // Try to get font size from computed style of selected element\r\n        const startContainer = range.startContainer;\r\n        const element = startContainer.nodeType === Node.TEXT_NODE\r\n          ? startContainer.parentElement\r\n          : startContainer;\r\n\r\n        if (element) {\r\n          const computedStyle = window.getComputedStyle(element);\r\n          const computedFontSize = computedStyle.fontSize;\r\n          const computedFontFamily = computedStyle.fontFamily;\r\n\r\n          // Convert computed font size to our format (e.g., \"16px\" -> \"16px\")\r\n          if (computedFontSize && computedFontSize.endsWith('px')) {\r\n            fontSize = computedFontSize;\r\n          }\r\n\r\n          if (computedFontFamily && computedFontFamily !== 'serif') {\r\n            fontFamily = computedFontFamily.split(',')[0].replace(/['\"]/g, '').trim();\r\n          }\r\n\r\n          // Get font color from computed style\r\n          const computedFontColor = computedStyle.color;\r\n          if (computedFontColor && computedFontColor !== 'rgb(0, 0, 0)' && computedFontColor !== '#000000') {\r\n            // Convert rgb to hex if needed\r\n            if (computedFontColor.startsWith('rgb')) {\r\n              fontColor = rgbToHex(computedFontColor);\r\n            } else {\r\n              fontColor = computedFontColor;\r\n            }\r\n          }\r\n\r\n          // Find the nearest block-level element (heading or paragraph)\r\n          const blockElement = findNearestBlockElement(element);\r\n          if (blockElement) {\r\n            const tagName = blockElement.tagName?.toLowerCase();\r\n            if (['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p'].includes(tagName)) {\r\n              headingLevel = tagName;\r\n            }\r\n            \r\n            // Get text alignment from the block element's style\r\n            const blockComputedStyle = window.getComputedStyle(blockElement);\r\n            const computedTextAlign = blockComputedStyle.textAlign;\r\n            if (['left', 'center', 'right', 'justify'].includes(computedTextAlign)) {\r\n              textAlign = computedTextAlign;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Fallback to execCommand for other formatting (bold, italic, etc.)\r\n      const formatState = {\r\n        bold: document.queryCommandState('bold'),\r\n        italic: document.queryCommandState('italic'),\r\n        underline: document.queryCommandState('underline'),\r\n        strikethrough: document.queryCommandState('strikethrough'),\r\n        alignLeft: textAlign === 'left',\r\n        alignCenter: textAlign === 'center',\r\n        alignRight: textAlign === 'right',\r\n        alignJustify: textAlign === 'justify',\r\n        fontFamily: fontFamily,\r\n        fontSize: fontSize,\r\n        fontColor: fontColor,\r\n        headingLevel: headingLevel\r\n      };\r\n\r\n      setCurrentFormat(prev => ({\r\n        ...prev,\r\n        ...formatState\r\n      }));\r\n    } catch (error) {\r\n      console.warn('[useFormatting] Error updating format from selection:', error);\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Reset formatting to default\r\n   */\r\n  const resetFormat = useCallback(() => {\r\n    setCurrentFormat(DEFAULT_FORMAT);\r\n  }, []);\r\n\r\n  return {\r\n    currentFormat,\r\n    formatText,\r\n    resetFormat,\r\n    updateCurrentFormatFromSelection\r\n  };\r\n};\r\n\r\n/**\r\n * Helper function to convert RGB color to hex\r\n */\r\nfunction rgbToHex(rgb) {\r\n  const result = rgb.match(/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/);\r\n  if (!result) return '#000000';\r\n  \r\n  const r = parseInt(result[1], 10);\r\n  const g = parseInt(result[2], 10);\r\n  const b = parseInt(result[3], 10);\r\n  \r\n  return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;\r\n}\r\n\r\n/**\r\n * Helper function to find the nearest block-level element (heading or paragraph)\r\n * Walks up the DOM tree from the given element\r\n */\r\nfunction findNearestBlockElement(element) {\r\n  let current = element;\r\n  \r\n  // Walk up the DOM tree until we find a block element or reach the contenteditable root\r\n  while (current && current !== document.body) {\r\n    const tagName = current.tagName?.toLowerCase();\r\n    \r\n    // Check if this is a block-level element we're interested in\r\n    if (['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p'].includes(tagName)) {\r\n      return current;\r\n    }\r\n    \r\n    // Stop if we reach the contenteditable container\r\n    if (current.contentEditable === 'true' || current.contentEditable === '') {\r\n      break;\r\n    }\r\n    \r\n    current = current.parentElement;\r\n  }\r\n  \r\n  return null;\r\n}\r\n\r\n/**\r\n * Helper function to find all block elements within a range\r\n */\r\nfunction findBlockElementsInRange(range) {\r\n  const blockElements = [];\r\n  const startContainer = range.startContainer;\r\n  const endContainer = range.endContainer;\r\n  \r\n  // If range is within a single block element\r\n  const startBlock = findNearestBlockElement(\r\n    startContainer.nodeType === Node.TEXT_NODE ? startContainer.parentElement : startContainer\r\n  );\r\n  const endBlock = findNearestBlockElement(\r\n    endContainer.nodeType === Node.TEXT_NODE ? endContainer.parentElement : endContainer\r\n  );\r\n  \r\n  if (startBlock === endBlock && startBlock) {\r\n    return [startBlock];\r\n  }\r\n  \r\n  // Find all block elements in the range\r\n  const walker = document.createTreeWalker(\r\n    range.commonAncestorContainer,\r\n    NodeFilter.SHOW_ELEMENT,\r\n    {\r\n      acceptNode: (node) => {\r\n        const tagName = node.tagName?.toLowerCase();\r\n        return ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p'].includes(tagName) \r\n          ? NodeFilter.FILTER_ACCEPT \r\n          : NodeFilter.FILTER_SKIP;\r\n      }\r\n    }\r\n  );\r\n  \r\n  let current = walker.nextNode();\r\n  while (current) {\r\n    // Check if this block element intersects with the range\r\n    if (range.intersectsNode(current)) {\r\n      blockElements.push(current);\r\n    }\r\n    current = walker.nextNode();\r\n  }\r\n  \r\n  return blockElements;\r\n}\r\n\r\n/**\r\n * Helper function to create a paragraph element at cursor position\r\n */\r\nfunction createParagraphAtCursor() {\r\n  try {\r\n    const selection = window.getSelection();\r\n    if (!selection || selection.rangeCount === 0) {\r\n      return null;\r\n    }\r\n\r\n    const range = selection.getRangeAt(0);\r\n    const p = document.createElement('p');\r\n    p.innerHTML = '<br>';\r\n    \r\n    // Insert the paragraph\r\n    range.insertNode(p);\r\n    \r\n    // Move cursor into the paragraph\r\n    range.selectNodeContents(p);\r\n    range.collapse(true);\r\n    selection.removeAllRanges();\r\n    selection.addRange(range);\r\n    \r\n    return p;\r\n  } catch (error) {\r\n    console.warn('[useFormatting] Failed to create paragraph at cursor:', error);\r\n    return null;\r\n  }\r\n}\r\n","/**\r\n * Page boundary calculation utilities\r\n * Handles calculating page boundaries based on page breaks and content\r\n */\r\n\r\nimport { getPageDimensions } from './page-sizes.js';\r\nimport { getTotalVerticalMargins, DEFAULT_MARGIN_PRESET } from './margin-utils.js';\r\n\r\n// Content padding constants\r\nexport const CONTENT_PADDING = {\r\n  top: 40,\r\n  bottom: 40,\r\n  left: 40,\r\n  right: 40\r\n};\r\n\r\n// Page break selector\r\nexport const PAGE_BREAK_SELECTOR = 'page-break, [data-page-break=\"true\"]';\r\n\r\n/**\r\n * Calculate visual page boundaries based on <page-break> tags in content\r\n * Returns array of boundary objects with top positions\r\n * @param {HTMLElement} editor - The editor element\r\n * @param {Object} options - Options for boundary calculation\r\n * @param {string} options.pageSize - The page size to use\r\n * @returns {Array} Array of boundary objects\r\n */\r\nexport const calculatePageBoundaries = (editor, options = {}) => {\r\n  if (!editor || typeof document === 'undefined') {\r\n    return [];\r\n  }\r\n\r\n  const targetPageSize = options.pageSize || 'A4';\r\n  const dimensions = getPageDimensions(targetPageSize);\r\n  \r\n  // Find all <page-break> elements\r\n  const pageBreakElements = editor.querySelectorAll(PAGE_BREAK_SELECTOR);\r\n  \r\n  const boundaries = [];\r\n  \r\n  // Always have at least one page (page 1)\r\n  boundaries.push({\r\n    id: 'page-0',\r\n    pageNumber: 1,\r\n    top: 0,\r\n    height: dimensions.height\r\n  });\r\n\r\n  // Add boundaries for each page break\r\n  const editorRect = editor.getBoundingClientRect();\r\n  const editorScrollTop = editor.scrollTop;\r\n  \r\n  pageBreakElements.forEach((breakEl, index) => {\r\n    const rect = breakEl.getBoundingClientRect();\r\n    const relativeTop = rect.top - editorRect.top + editorScrollTop;\r\n    \r\n    boundaries.push({\r\n      id: `page-${index + 1}`,\r\n      pageNumber: index + 2,\r\n      top: relativeTop,\r\n      height: dimensions.height\r\n    });\r\n  });\r\n\r\n  return boundaries;\r\n};\r\n\r\n/**\r\n * Calculate maximum content height for a page accounting for zoom and margins\r\n * This is the height available for actual content INSIDE the contenteditable div\r\n * The contenteditable div itself has padding applied via getMarginPixels\r\n * So we need to subtract both the margins AND the padding from the page height\r\n * @param {string} pageSize - The page size\r\n * @param {number} zoomLevel - Current zoom level percentage\r\n * @param {string} pageMargins - The margin preset name\r\n * @returns {number} Maximum content height in pixels (actual content area inside padding)\r\n */\r\nexport const calculateMaxContentHeight = (pageSize, zoomLevel = 100, pageMargins = DEFAULT_MARGIN_PRESET) => {\r\n  const dimensions = getPageDimensions(pageSize);\r\n  const verticalMargins = getTotalVerticalMargins(pageMargins);\r\n  \r\n  // The page has total height = dimensions.height\r\n  // The contenteditable div has padding applied via getMarginPixels (which are the same as margins)\r\n  // So the actual content area height = page height - (top margin + bottom margin) = dimensions.height - verticalMargins\r\n  // This is already the max height for content inside the padding\r\n  const baseMaxHeight = dimensions.height - verticalMargins;\r\n  const zoomMultiplier = zoomLevel / 100;\r\n  return baseMaxHeight / zoomMultiplier;\r\n};\r\n\r\n/**\r\n * Get current page number based on viewport scroll position\r\n * @param {HTMLElement} container - The scroll container element\r\n * @param {HTMLElement} editor - The editor element\r\n * @returns {number} Current page index (0-based)\r\n */\r\nexport const getCurrentPage = (container, editor) => {\r\n  if (!container || !editor) {\r\n    return 0;\r\n  }\r\n\r\n  try {\r\n    // Get all page breaks\r\n    const pageBreaks = editor.querySelectorAll(PAGE_BREAK_SELECTOR);\r\n    \r\n    if (pageBreaks.length === 0) {\r\n      return 0; // Only one page\r\n    }\r\n    \r\n    // Get viewport center position\r\n    const containerRect = container.getBoundingClientRect();\r\n    const viewportCenter = containerRect.top + (containerRect.height / 2);\r\n    \r\n    // Check each page break to find which page we're on\r\n    // Start from the last break and work backwards\r\n    for (let i = pageBreaks.length - 1; i >= 0; i--) {\r\n      const breakElement = pageBreaks[i];\r\n      const breakRect = breakElement.getBoundingClientRect();\r\n      \r\n      // If the break is above the viewport center, we're on the page after it\r\n      if (breakRect.top < viewportCenter) {\r\n        return i + 1; // Page index (0-based)\r\n      }\r\n    }\r\n    \r\n    // If we're above all breaks, we're on page 0\r\n    return 0;\r\n  } catch (error) {\r\n    console.warn('[getCurrentPage] Failed to calculate page:', error);\r\n    return 0;\r\n  }\r\n};\r\n\r\n/**\r\n * Split content into pages based on existing page breaks\r\n * @param {HTMLElement} editor - The editor element\r\n * @returns {Array} Array of page element arrays\r\n */\r\nexport const splitContentIntoPages = (editor) => {\r\n  if (!editor) {\r\n    return [];\r\n  }\r\n\r\n  const allChildren = Array.from(editor.children);\r\n  \r\n  if (allChildren.length === 0) {\r\n    return [];\r\n  }\r\n  \r\n  // Split content into pages based on existing breaks\r\n  let pages = [];\r\n  let currentPage = [];\r\n  \r\n  for (const child of allChildren) {\r\n    if (child.tagName === 'PAGE-BREAK' || child.getAttribute('data-page-break') === 'true') {\r\n      if (currentPage.length > 0) {\r\n        pages.push(currentPage);\r\n        currentPage = [];\r\n      }\r\n    } else {\r\n      currentPage.push(child);\r\n    }\r\n  }\r\n  \r\n  // Add the last page\r\n  if (currentPage.length > 0) {\r\n    pages.push(currentPage);\r\n  }\r\n  \r\n  // If no pages, all elements are on one page\r\n  if (pages.length === 0 && allChildren.length > 0) {\r\n    pages.push(allChildren.filter(el => \r\n      !(el.tagName === 'PAGE-BREAK' || el.getAttribute('data-page-break') === 'true')\r\n    ));\r\n  }\r\n  \r\n  return pages;\r\n};","/**\r\n * Page break utilities\r\n * Handles creating, inserting, and managing page breaks\r\n */\r\n\r\nimport { PAGE_BREAK_SELECTOR, calculateMaxContentHeight } from './page-boundary-utils.js';\r\n\r\n/**\r\n * Get the total height of an element including its margins\r\n * Optimized to use known CSS margins instead of getComputedStyle\r\n * Based on MultiPageEditor.css: .continuous-content p { margin: 0 0 16px 0; }\r\n * Also handles images within center-aligned paragraphs\r\n * @param {HTMLElement} element - The element to measure\r\n * @returns {number} Total height including margins\r\n */\r\nconst getElementTotalHeight = (element) => {\r\n  if (!element || !element.getBoundingClientRect) {\r\n    return 0;\r\n  }\r\n  \r\n  const rect = element.getBoundingClientRect();\r\n  \r\n  // Check if element contains only an image (center-aligned images)\r\n  // These images may have float: none and their height needs special handling\r\n  if (element.tagName === 'P') {\r\n    const images = element.querySelectorAll('img');\r\n    const textContent = element.textContent.trim();\r\n    \r\n    // If paragraph contains only an image (no text content)\r\n    if (images.length === 1 && !textContent) {\r\n      const img = images[0];\r\n      const imgRect = img.getBoundingClientRect();\r\n      const computedStyle = window.getComputedStyle(element);\r\n      const textAlign = computedStyle.textAlign;\r\n      \r\n      // For center-aligned images, use actual image height plus paragraph margin\r\n      if (textAlign === 'center' || textAlign === '-webkit-center') {\r\n        return imgRect.height + 16; // Image height + paragraph bottom margin\r\n      }\r\n    }\r\n    \r\n    // Regular paragraph with 16px bottom margin\r\n    return rect.height + 16;  // Add known bottom margin\r\n  }\r\n  \r\n  // For other block elements (headings, lists), use a conservative estimate\r\n  if (element.tagName === 'H1' || element.tagName === 'H2' || element.tagName === 'H3' || \r\n      element.tagName === 'H4' || element.tagName === 'H5' || element.tagName === 'H6') {\r\n    return rect.height + 20;  // Headings typically have larger margins\r\n  }\r\n  \r\n  if (element.tagName === 'UL' || element.tagName === 'OL') {\r\n    return rect.height + 16;  // Lists have similar margins to paragraphs\r\n  }\r\n  \r\n  // For other elements, just return the rect height\r\n  return rect.height;\r\n};\r\n\r\n/**\r\n * Insert a page break element before the specified element\r\n * @param {HTMLElement} targetElement - The element to insert the page break before\r\n * @param {number} pageNumber - The page number for this break\r\n * @returns {boolean} Success status\r\n */\r\nexport const insertPageBreakBefore = (targetElement, pageNumber) => {\r\n  if (!targetElement) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const pageBreak = document.createElement('page-break');\r\n    pageBreak.setAttribute('data-page-break', 'true');\r\n    pageBreak.setAttribute('contenteditable', 'false');\r\n    pageBreak.setAttribute('data-page-number', pageNumber || '2');\r\n    \r\n    // Insert before the target element\r\n    targetElement.parentNode.insertBefore(pageBreak, targetElement);\r\n    \r\n    return true;\r\n  } catch (error) {\r\n    console.warn('[insertPageBreakBefore] Failed to insert page break:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Insert a page break at a specific page boundary based on content height\r\n * @param {HTMLElement} editor - The editor element\r\n * @param {number} pageNumber - The page number where the break should be inserted (1-based)\r\n * @param {string} pageSize - The page size\r\n * @param {number} zoomLevel - Current zoom level percentage\r\n * @param {string} pageMargins - The margin preset name\r\n * @param {Function} updateContentCallback - Callback to update content in context\r\n * @param {Function} updateBoundariesCallback - Callback to update boundaries\r\n * @returns {boolean} Success status\r\n */\r\nexport const insertPageBreakAtBoundary = (\r\n  editor,\r\n  pageNumber,\r\n  pageSize,\r\n  zoomLevel,\r\n  pageMargins,\r\n  updateContentCallback,\r\n  updateBoundariesCallback\r\n) => {\r\n  if (!editor) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    // Calculate max content height accounting for zoom, padding, and margins\r\n    const maxHeight = calculateMaxContentHeight(pageSize, zoomLevel, pageMargins);\r\n    \r\n    // Target height for the page break insertion\r\n    const targetHeight = maxHeight * (pageNumber - 1);\r\n    \r\n    // Get all children and find where to insert the break\r\n    const allChildren = Array.from(editor.children);\r\n    let accumulatedHeight = 0;\r\n    let insertBeforeElement = null;\r\n    \r\n    for (let i = 0; i < allChildren.length; i++) {\r\n      const child = allChildren[i];\r\n      \r\n      // Skip existing page breaks\r\n      if (child.tagName === 'PAGE-BREAK' || child.getAttribute('data-page-break') === 'true') {\r\n        continue;\r\n      }\r\n      \r\n      const childHeight = getElementTotalHeight(child);\r\n      \r\n      // Check if adding this element would exceed the target height\r\n      if (accumulatedHeight + childHeight > targetHeight) {\r\n        insertBeforeElement = child;\r\n        break;\r\n      }\r\n      \r\n      accumulatedHeight += childHeight;\r\n    }\r\n    \r\n    // If we found an insertion point, insert the page break\r\n    if (insertBeforeElement) {\r\n      const pageBreak = document.createElement('page-break');\r\n      pageBreak.setAttribute('data-page-break', 'true');\r\n      pageBreak.setAttribute('contenteditable', 'false');\r\n      pageBreak.setAttribute('data-page-number', String(pageNumber));\r\n      \r\n      insertBeforeElement.parentNode.insertBefore(pageBreak, insertBeforeElement);\r\n      \r\n      // Update content in Context\r\n      if (updateContentCallback) {\r\n        const updatedHTML = editor.innerHTML;\r\n        updateContentCallback(updatedHTML);\r\n      }\r\n      \r\n      // Update boundaries\r\n      if (updateBoundariesCallback) {\r\n        setTimeout(() => {\r\n          updateBoundariesCallback();\r\n        }, 50);\r\n      }\r\n      \r\n      return true;\r\n    } else {\r\n      // If no insertion point found, insert at the end\r\n      const pageBreak = document.createElement('page-break');\r\n      pageBreak.setAttribute('data-page-break', 'true');\r\n      pageBreak.setAttribute('contenteditable', 'false');\r\n      pageBreak.setAttribute('data-page-number', String(pageNumber));\r\n      \r\n      editor.appendChild(pageBreak);\r\n      \r\n      // Add an empty paragraph after the break\r\n      const emptyParagraph = document.createElement('p');\r\n      emptyParagraph.innerHTML = '<br>';\r\n      editor.appendChild(emptyParagraph);\r\n      \r\n      // Update content in Context\r\n      if (updateContentCallback) {\r\n        const updatedHTML = editor.innerHTML;\r\n        updateContentCallback(updatedHTML);\r\n      }\r\n      \r\n      // Update boundaries\r\n      if (updateBoundariesCallback) {\r\n        setTimeout(() => {\r\n          updateBoundariesCallback();\r\n        }, 50);\r\n      }\r\n      \r\n      return true;\r\n    }\r\n  } catch (error) {\r\n    console.error('[insertPageBreakAtBoundary] Failed to insert page break:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Remove a page and its content from the continuous editor\r\n * Removes the page break and all content between the page boundaries\r\n * @param {HTMLElement} editor - The editor element\r\n * @param {number} pageIndex - The index of the page to remove (0-based)\r\n * @param {Function} calculateBoundariesCallback - Callback to calculate boundaries\r\n * @param {Function} updateContentCallback - Callback to update content in context\r\n * @param {Function} updateBoundariesCallback - Callback to update boundaries\r\n * @param {Function} positionCursorCallback - Callback to position cursor\r\n * @param {Function} checkReflowCallback - Callback to trigger reflow\r\n * @returns {boolean} Success status\r\n */\r\nexport const removePageAndContent = (\r\n  editor, \r\n  pageIndex, \r\n  calculateBoundariesCallback, \r\n  updateContentCallback, \r\n  updateBoundariesCallback, \r\n  positionCursorCallback, \r\n  checkReflowCallback\r\n) => {\r\n  if (!editor) {\r\n    return false;\r\n  }\r\n\r\n  const boundaries = calculateBoundariesCallback();\r\n\r\n  // Cannot delete if only one page\r\n  if (boundaries.length <= 1) {\r\n    console.warn('[removePageAndContent] Cannot delete the only page');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    // Find all page breaks in the editor\r\n    const pageBreaks = Array.from(editor.querySelectorAll(PAGE_BREAK_SELECTOR));\r\n    \r\n    if (pageIndex > pageBreaks.length) {\r\n      console.warn('[removePageAndContent] Invalid page index');\r\n      return false;\r\n    }\r\n\r\n    // Save cursor position before deletion\r\n    const selection = window.getSelection();\r\n    let cursorWasInDeletedContent = false;\r\n    \r\n    let nodesToRemove = [];\r\n    let pageBreakToRemove = null;\r\n\r\n    // Special handling for first page (pageIndex === 0)\r\n    if (pageIndex === 0) {\r\n      // For the first page, remove all content before the first page break\r\n      const firstPageBreak = pageBreaks[0];\r\n      \r\n      if (!firstPageBreak) {\r\n        console.warn('[removePageAndContent] No page break found for first page');\r\n        return false;\r\n      }\r\n\r\n      // Collect all nodes before the first page break\r\n      let currentNode = editor.firstChild;\r\n      while (currentNode && currentNode !== firstPageBreak) {\r\n        nodesToRemove.push(currentNode);\r\n        currentNode = currentNode.nextSibling;\r\n      }\r\n\r\n      // The first page break itself should also be removed\r\n      pageBreakToRemove = firstPageBreak;\r\n\r\n    } else {\r\n      // For pages 1 and onwards, remove content between page breaks\r\n      // The page break that starts this page is at index (pageIndex - 1)\r\n      // because page 0 has no break, page 1 has break[0], page 2 has break[1], etc.\r\n      const pageBreakElement = pageBreaks[pageIndex - 1];\r\n      \r\n      if (!pageBreakElement) {\r\n        console.warn('[removePageAndContent] Page break not found');\r\n        return false;\r\n      }\r\n\r\n      // Find the next page break (if any) to determine the end of this page\r\n      const nextPageBreakElement = pageBreaks[pageIndex];\r\n\r\n      // Collect all nodes between the current page break and the next one (or end)\r\n      let currentNode = pageBreakElement.nextSibling;\r\n\r\n      while (currentNode) {\r\n        // Stop if we reach the next page break\r\n        if (currentNode === nextPageBreakElement) {\r\n          break;\r\n        }\r\n        \r\n        nodesToRemove.push(currentNode);\r\n        currentNode = currentNode.nextSibling;\r\n      }\r\n\r\n      pageBreakToRemove = pageBreakElement;\r\n    }\r\n\r\n    // Check if cursor is in the content being deleted\r\n    if (selection && selection.rangeCount > 0) {\r\n      const range = selection.getRangeAt(0);\r\n      const cursorNode = range.startContainer;\r\n      \r\n      for (const node of nodesToRemove) {\r\n        if (node.contains(cursorNode) || node === cursorNode) {\r\n          cursorWasInDeletedContent = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Remove the page break element\r\n    if (pageBreakToRemove && pageBreakToRemove.parentNode) {\r\n      pageBreakToRemove.remove();\r\n    }\r\n\r\n    // Remove all content nodes\r\n    nodesToRemove.forEach(node => {\r\n      if (node.parentNode) {\r\n        node.remove();\r\n      }\r\n    });\r\n\r\n    // Renumber remaining page breaks\r\n    const remainingBreaks = editor.querySelectorAll(PAGE_BREAK_SELECTOR);\r\n    remainingBreaks.forEach((breakEl, index) => {\r\n      breakEl.setAttribute('data-page-number', String(index + 2));\r\n    });\r\n\r\n    // Position cursor appropriately after deletion\r\n    if (cursorWasInDeletedContent && positionCursorCallback) {\r\n      // Position cursor at the start of the first remaining page (page 0)\r\n      setTimeout(() => {\r\n        positionCursorCallback(0);\r\n      }, 50);\r\n    }\r\n\r\n    // Update content in Context\r\n    if (updateContentCallback) {\r\n      const updatedHTML = editor.innerHTML;\r\n      updateContentCallback(updatedHTML);\r\n    }\r\n\r\n    // Update boundaries after deletion\r\n    if (updateBoundariesCallback) {\r\n      setTimeout(() => {\r\n        updateBoundariesCallback();\r\n        \r\n        // Trigger auto reflow to handle any overflow from content redistribution\r\n        if (checkReflowCallback) {\r\n          setTimeout(() => {\r\n            checkReflowCallback();\r\n          }, 150);\r\n        }\r\n      }, 100);\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    console.error('[removePageAndContent] Failed to remove page:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Renumber all page breaks in the editor\r\n * @param {HTMLElement} editor - The editor element\r\n */\r\nexport const renumberPageBreaks = (editor) => {\r\n  if (!editor) {\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const pageBreaks = editor.querySelectorAll(PAGE_BREAK_SELECTOR);\r\n    pageBreaks.forEach((breakEl, index) => {\r\n      breakEl.setAttribute('data-page-number', String(index + 2));\r\n    });\r\n  } catch (error) {\r\n    console.error('[renumberPageBreaks] Failed to renumber page breaks:', error);\r\n  }\r\n};\r\n\r\n/**\r\n * Remove a single page break element\r\n * This removes just the page break, allowing content to reflow naturally\r\n * @param {HTMLElement} pageBreakElement - The page break element to remove\r\n * @param {HTMLElement} editor - The editor element\r\n * @param {Function} updateContentCallback - Callback to update content in context\r\n * @param {Function} updateBoundariesCallback - Callback to update boundaries\r\n * @param {Function} checkReflowCallback - Callback to trigger reflow\r\n * @returns {boolean} Success status\r\n */\r\nexport const removePageBreak = (\r\n  pageBreakElement,\r\n  editor,\r\n  updateContentCallback,\r\n  updateBoundariesCallback,\r\n  checkReflowCallback\r\n) => {\r\n  if (!pageBreakElement || !editor) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    // Remove the page break element\r\n    pageBreakElement.remove();\r\n\r\n    // Renumber remaining page breaks\r\n    renumberPageBreaks(editor);\r\n\r\n    // Update content in Context\r\n    if (updateContentCallback) {\r\n      const updatedHTML = editor.innerHTML;\r\n      updateContentCallback(updatedHTML);\r\n    }\r\n\r\n    // Update boundaries after deletion\r\n    if (updateBoundariesCallback) {\r\n      setTimeout(() => {\r\n        updateBoundariesCallback();\r\n        \r\n        // Trigger auto reflow to re-add page breaks in correct positions\r\n        if (checkReflowCallback) {\r\n          setTimeout(() => {\r\n            checkReflowCallback();\r\n          }, 100);\r\n        }\r\n      }, 50);\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    console.error('[removePageBreak] Failed to remove page break:', error);\r\n    return false;\r\n  }\r\n};\r\n","/**\r\n * Content reflow utilities\r\n * Handles detecting content overflow and managing reflow operations\r\n */\r\n\r\nimport { calculateMaxContentHeight, splitContentIntoPages } from './page-boundary-utils.js';\r\nimport { insertPageBreakBefore } from './page-break-utils.js';\r\n\r\n// Performance constants\r\nexport const DEFAULT_REFLOW_DELAY = 200; // Reduced from 500ms for better typing responsiveness\r\nexport const BOUNDARY_UPDATE_DELAY = 50;\r\nexport const MAX_PAGES_PER_REFLOW = 3; // Process up to 3 pages per reflow cycle\r\nexport const MIN_OVERFLOW_THRESHOLD = 20; // Minimum pixels of overflow before breaking\r\n\r\n/**\r\n * Get the total height of an element including its margins\r\n * Optimized to use known CSS margins instead of getComputedStyle\r\n * Based on MultiPageEditor.css: .continuous-content p { margin: 0 0 16px 0; }\r\n * Also handles images within center-aligned paragraphs\r\n * @param {HTMLElement} element - The element to measure\r\n * @returns {number} Total height including margins\r\n */\r\nconst getElementTotalHeight = (element) => {\r\n  if (!element || !element.getBoundingClientRect) {\r\n    return 0;\r\n  }\r\n  \r\n  const rect = element.getBoundingClientRect();\r\n  \r\n  // Check if element contains only an image (center-aligned images)\r\n  // These images may have float: none and their height needs special handling\r\n  if (element.tagName === 'P') {\r\n    const images = element.querySelectorAll('img');\r\n    const textContent = element.textContent.trim();\r\n    \r\n    // If paragraph contains only an image (no text content)\r\n    if (images.length === 1 && !textContent) {\r\n      const img = images[0];\r\n      const imgRect = img.getBoundingClientRect();\r\n      const computedStyle = window.getComputedStyle(element);\r\n      const textAlign = computedStyle.textAlign;\r\n      \r\n      // For center-aligned images, use actual image height plus paragraph margin\r\n      if (textAlign === 'center' || textAlign === '-webkit-center') {\r\n        return imgRect.height + 16; // Image height + paragraph bottom margin\r\n      }\r\n    }\r\n    \r\n    // Regular paragraph with 16px bottom margin\r\n    return rect.height + 16;  // Add known bottom margin\r\n  }\r\n  \r\n  // For other block elements (headings, lists), use a conservative estimate\r\n  if (element.tagName === 'H1' || element.tagName === 'H2' || element.tagName === 'H3' || \r\n      element.tagName === 'H4' || element.tagName === 'H5' || element.tagName === 'H6') {\r\n    return rect.height + 20;  // Headings typically have larger margins\r\n  }\r\n  \r\n  if (element.tagName === 'UL' || element.tagName === 'OL') {\r\n    return rect.height + 16;  // Lists have similar margins to paragraphs\r\n  }\r\n  \r\n  // For other elements, just return the rect height\r\n  return rect.height;\r\n};\r\n\r\n/**\r\n * Check if content in a page section exceeds the maximum height\r\n * Returns the element where overflow occurs\r\n * Optimized for performance with early exit\r\n * @param {Array} pageElements - Array of elements in the page\r\n * @param {number} maxHeight - Maximum height for the page\r\n * @returns {Object|null} Overflow information or null if no overflow\r\n */\r\nexport const findOverflowPoint = (pageElements, maxHeight) => {\r\n  if (!pageElements || pageElements.length === 0) {\r\n    return null;\r\n  }\r\n  \r\n  let currentHeight = 0;\r\n  let lastValidElement = null;\r\n  \r\n  for (let i = 0; i < pageElements.length; i++) {\r\n    const element = pageElements[i];\r\n    if (!element || !element.getBoundingClientRect) {\r\n      continue;\r\n    }\r\n    \r\n    const elementHeight = getElementTotalHeight(element);\r\n    \r\n    // Skip empty elements (like empty <p> tags from Enter key)\r\n    if (elementHeight < 1) {\r\n      continue;\r\n    }\r\n    \r\n    const potentialHeight = currentHeight + elementHeight;\r\n    \r\n    // Check if adding this element would exceed the page height\r\n    if (potentialHeight > maxHeight) {\r\n      // If we haven't added any elements yet (first element is too large)\r\n      if (lastValidElement === null) {\r\n        // Element is larger than page - must break anyway\r\n        // But only if it's not the very first element on the page\r\n        if (i > 0) {\r\n          return { \r\n            overflowIndex: i, \r\n            overflowElement: element, \r\n            accumulatedHeight: currentHeight \r\n          };\r\n        }\r\n        // If it's the first element and it's too large, let it overflow (unbreakable content)\r\n        return null;\r\n      }\r\n      \r\n      // We have overflow - return the current element as the break point\r\n      return { \r\n        overflowIndex: i, \r\n        overflowElement: element, \r\n        accumulatedHeight: currentHeight \r\n      };\r\n    }\r\n    \r\n    // Element fits, add it to current height\r\n    currentHeight += elementHeight;\r\n    lastValidElement = element;\r\n  }\r\n  \r\n  return null; // No overflow\r\n};\r\n\r\n/**\r\n * Automatic reflow: Insert page breaks when content exceeds page height\r\n * Optimized with performance guards and single-page-at-a-time processing\r\n * Accounts for current zoom level and margins when calculating max height\r\n * @param {HTMLElement} editor - The editor element\r\n * @param {string} pageSize - The page size\r\n * @param {number} zoomLevel - Current zoom level percentage\r\n * @param {string} pageMargins - The margin preset name\r\n * @param {Function} updateContentCallback - Callback to update content in context\r\n * @param {Function} updateBoundariesCallback - Callback to update boundaries\r\n * @param {boolean} isReflowingRef - Reference to track if reflow is in progress\r\n * @param {Function} checkAndReflowCallback - Callback to trigger additional reflow if needed\r\n * @returns {boolean} True if reflow was performed, false otherwise\r\n */\r\nexport const checkAndReflow = (\r\n  editor, \r\n  pageSize, \r\n  zoomLevel, \r\n  pageMargins,\r\n  updateContentCallback, \r\n  updateBoundariesCallback, \r\n  isReflowingRef, \r\n  checkAndReflowCallback\r\n) => {\r\n  // Performance guard: prevent concurrent reflows\r\n  if (!editor || isReflowingRef.current) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    isReflowingRef.current = true;\r\n    \r\n    const maxHeight = calculateMaxContentHeight(pageSize, zoomLevel, pageMargins);\r\n    \r\n    // Split content into pages based on existing breaks\r\n    let pages = splitContentIntoPages(editor);\r\n    \r\n    // Check each page for overflow (process ALL pages for better typing support)\r\n    let insertedBreaks = false;\r\n    let pagesProcessed = 0;\r\n    \r\n    for (let pageIndex = 0; pageIndex < pages.length && pagesProcessed < MAX_PAGES_PER_REFLOW; pageIndex++) {\r\n      const pageElements = pages[pageIndex];\r\n      const overflow = findOverflowPoint(pageElements, maxHeight);\r\n      \r\n      // Only insert break if we have actual overflow and not on first element\r\n      // Also check that the overflow is significant (not just a pixel or two)\r\n      if (overflow && overflow.overflowIndex > 0) {\r\n        // Calculate actual overflow amount\r\n        let totalPageHeight = 0;\r\n        for (let i = 0; i < pageElements.length; i++) {\r\n          const el = pageElements[i];\r\n          if (el && el.getBoundingClientRect) {\r\n            totalPageHeight += getElementTotalHeight(el);\r\n          }\r\n        }\r\n        \r\n        // Only break if overflow is significant\r\n        const overflowAmount = totalPageHeight - maxHeight;\r\n        if (overflowAmount < MIN_OVERFLOW_THRESHOLD) {\r\n          continue; // Skip this page, overflow is too small\r\n        }\r\n        \r\n        const pageNumber = pageIndex + 2;\r\n        const inserted = insertPageBreakBefore(overflow.overflowElement, pageNumber);\r\n        \r\n        if (inserted) {\r\n          insertedBreaks = true;\r\n          pagesProcessed++;\r\n          \r\n          // Re-query pages after insertion to continue checking\r\n          const updatedPages = splitContentIntoPages(editor);\r\n          pages = updatedPages;\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Update boundaries if we inserted breaks\r\n    if (insertedBreaks) {\r\n      // Trigger content update to Context\r\n      if (updateContentCallback) {\r\n        const html = editor.innerHTML;\r\n        updateContentCallback(html);\r\n      }\r\n      \r\n      // Recalculate boundaries with slight delay for DOM update\r\n      setTimeout(() => {\r\n        if (updateBoundariesCallback) {\r\n          updateBoundariesCallback();\r\n        }\r\n        \r\n        // If we processed the max number of pages, schedule another reflow check\r\n        // to handle any remaining overflows from typing\r\n        if (pagesProcessed >= MAX_PAGES_PER_REFLOW && checkAndReflowCallback) {\r\n          setTimeout(() => {\r\n            if (!isReflowingRef.current) {\r\n              checkAndReflowCallback();\r\n            }\r\n          }, 100);\r\n        }\r\n      }, BOUNDARY_UPDATE_DELAY);\r\n    }\r\n    \r\n    return insertedBreaks;\r\n  } catch (error) {\r\n    console.warn('[checkAndReflow] Reflow failed:', error);\r\n    return false;\r\n  } finally {\r\n    isReflowingRef.current = false;\r\n  }\r\n};\r\n\r\n/**\r\n * Debounced automatic reflow check\r\n * Optimized to prevent excessive reflow operations\r\n * @param {Function} checkAndReflowCallback - The reflow function to call\r\n * @param {Object} timeoutRef - Reference to store the timeout\r\n * @param {number} delay - Delay in milliseconds\r\n */\r\nexport const triggerAutoReflow = (checkAndReflowCallback, timeoutRef, delay = DEFAULT_REFLOW_DELAY) => {\r\n  if (timeoutRef.current) {\r\n    clearTimeout(timeoutRef.current);\r\n  }\r\n\r\n  timeoutRef.current = setTimeout(() => {\r\n    timeoutRef.current = null;\r\n    checkAndReflowCallback();\r\n  }, delay);\r\n};","/**\r\n * Cursor and scroll utilities\r\n * Handles cursor positioning and scroll operations for page navigation\r\n */\r\n\r\nimport { PAGE_BREAK_SELECTOR } from './page-boundary-utils.js';\r\n\r\n// Performance constants\r\nexport const CURSOR_POSITION_DELAY = 400;\r\nexport const SCROLL_POSITION_DELAY = 50;\r\n\r\n/**\r\n * Position cursor at the start of a specific page\r\n * @param {HTMLElement} editor - The editor element\r\n * @param {number} pageNumber - The page number (0-based)\r\n */\r\nexport const positionCursorAtPage = (editor, pageNumber) => {\r\n  if (!editor) {\r\n    return;\r\n  }\r\n\r\n  editor.focus();\r\n\r\n  try {\r\n    let targetNode = null;\r\n    let targetOffset = 0;\r\n\r\n    if (pageNumber === 0) {\r\n      // First page - position at start\r\n      targetNode = editor.firstChild;\r\n      targetOffset = 0;\r\n    } else {\r\n      // Find the page break element for this page\r\n      const pageBreaks = editor.querySelectorAll(PAGE_BREAK_SELECTOR);\r\n      const breakElement = pageBreaks[pageNumber - 1];\r\n      \r\n      if (breakElement && breakElement.nextSibling) {\r\n        targetNode = breakElement.nextSibling;\r\n        targetOffset = 0;\r\n      }\r\n    }\r\n\r\n    if (targetNode) {\r\n      const range = document.createRange();\r\n      const selection = window.getSelection();\r\n      \r\n      // If target is a text node, use it directly\r\n      if (targetNode.nodeType === Node.TEXT_NODE) {\r\n        range.setStart(targetNode, targetOffset);\r\n      } else {\r\n        // If it's an element, position at its start\r\n        range.setStart(targetNode, 0);\r\n      }\r\n      \r\n      range.collapse(true);\r\n      selection.removeAllRanges();\r\n      selection.addRange(range);\r\n    }\r\n  } catch (error) {\r\n    console.warn('[positionCursorAtPage] Failed to position cursor:', error);\r\n  }\r\n};\r\n\r\n/**\r\n * Scroll to a specific page and position cursor at the start of that page\r\n * @param {HTMLElement} container - The scroll container element\r\n * @param {HTMLElement} editor - The editor element\r\n * @param {number} pageNumber - The page number (0-based)\r\n * @param {Function} positionCursorCallback - Callback to position cursor\r\n */\r\nexport const scrollToPage = (container, editor, pageNumber, positionCursorCallback) => {\r\n  if (!container || !editor) {\r\n    console.warn('[scrollToPage] Missing refs');\r\n    return;\r\n  }\r\n  \r\n  try {\r\n    let targetElement = null;\r\n    \r\n    if (pageNumber === 0) {\r\n      // First page - scroll to top of editor\r\n      targetElement = editor;\r\n    } else {\r\n      // Find the page break for this page\r\n      const pageBreaks = editor.querySelectorAll(PAGE_BREAK_SELECTOR);\r\n      const targetBreak = pageBreaks[pageNumber - 1];\r\n      \r\n      if (targetBreak) {\r\n        targetElement = targetBreak;\r\n      } else {\r\n        console.warn('[scrollToPage] Page break not found for page', pageNumber);\r\n        return;\r\n      }\r\n    }\r\n    \r\n    if (targetElement) {\r\n      // Get the element's position relative to the container\r\n      const elementRect = targetElement.getBoundingClientRect();\r\n      const containerRect = container.getBoundingClientRect();\r\n      \r\n      // Calculate scroll position: current scroll + element position relative to container\r\n      const scrollTop = container.scrollTop + (elementRect.top - containerRect.top);\r\n      \r\n      // Scroll to the page\r\n      container.scrollTo({\r\n        top: scrollTop,\r\n        behavior: 'smooth'\r\n      });\r\n      \r\n      // Position cursor after scroll completes\r\n      setTimeout(() => {\r\n        if (positionCursorCallback) {\r\n          positionCursorCallback(pageNumber);\r\n        } else {\r\n          positionCursorAtPage(editor, pageNumber);\r\n        }\r\n      }, CURSOR_POSITION_DELAY);\r\n    }\r\n  } catch (error) {\r\n    console.error('[scrollToPage] Error:', error);\r\n  }\r\n};\r\n\r\n/**\r\n * Debounced boundary calculation\r\n * Triggers after content changes to recalculate page boundaries\r\n * Optimized with configurable delay\r\n * @param {Function} updateBoundariesCallback - Callback to update boundaries\r\n * @param {Object} timeoutRef - Reference to store the timeout\r\n * @param {Object} options - Options for boundary calculation\r\n * @param {number} delay - Delay in milliseconds\r\n */\r\nexport const checkAndUpdateBoundaries = (\r\n  updateBoundariesCallback, \r\n  timeoutRef, \r\n  options = {}, \r\n  delay = 300\r\n) => {\r\n  if (timeoutRef.current) {\r\n    clearTimeout(timeoutRef.current);\r\n  }\r\n\r\n  timeoutRef.current = setTimeout(() => {\r\n    timeoutRef.current = null;\r\n    updateBoundariesCallback(options);\r\n  }, Math.max(0, delay));\r\n};\r\n\r\n/**\r\n * Get the current cursor position in the editor\r\n * @param {HTMLElement} editor - The editor element\r\n * @returns {Object|null} An object with page number, line number, and character offset, or null if no selection\r\n */\r\nexport const getCursorPosition = (editor) => {\r\n  if (!editor) return null;\r\n  \r\n  const selection = window.getSelection();\r\n  if (selection.rangeCount === 0) return null;\r\n  \r\n  const range = selection.getRangeAt(0);\r\n  if (!editor.contains(range.commonAncestorContainer)) return null; // Ensure range is inside editor\r\n  \r\n  // Calculate page number: Count <page-break> elements before the caret\r\n  let pageNumber = 1; // Default to page 1\r\n  const pageBreaks = editor.querySelectorAll(PAGE_BREAK_SELECTOR);\r\n  for (const breakEl of pageBreaks) {\r\n    if (range.comparePoint(breakEl, 0) > 0) { // Caret is after this break\r\n      pageNumber++;\r\n    } else {\r\n      break; // No need to check further\r\n    }\r\n  }\r\n  \r\n  // Calculate character offset and line number: Get text length and newline count from start of editor to caret\r\n  const tempRange = document.createRange();\r\n  tempRange.setStart(editor, 0);\r\n  tempRange.setEnd(range.startContainer, range.startOffset);\r\n  const htmlBeforeCaret = tempRange.toString(); // HTML fragment as text\r\n  const plainTextBeforeCaret = htmlBeforeCaret\r\n    .replace(/<[^>]*>/g, ' ') // Strip tags\r\n    .replace(/&nbsp;/g, ' ')\r\n    .replace(/&amp;/g, '&')\r\n    .replace(/&lt;/g, '<')\r\n    .replace(/&gt;/g, '>')\r\n    .replace(/&quot;/g, '\"')\r\n    .replace(/&#39;/g, \"'\")\r\n    .replace(/\\s+/g, ' ') // Normalize whitespace\r\n    .trim();\r\n  const charOffset = plainTextBeforeCaret.length;\r\n  const lineNumber = (plainTextBeforeCaret.match(/\\n/g) || []).length + 1; // Count \\n and add 1 for 1-based indexing\r\n  \r\n  return {\r\n    page: pageNumber,\r\n    line: lineNumber,\r\n    charOffset\r\n  };\r\n};","import { useCallback, useRef, useEffect, useMemo } from 'react';\r\nimport { useDocumentActions } from '../context/DocumentContext';\r\nimport { \r\n  calculatePageBoundaries, \r\n  getCurrentPage,\r\n  calculateMaxContentHeight\r\n} from '../lib/editor/page-boundary-utils.js';\r\nimport { \r\n  insertPageBreakAtBoundary, \r\n  removePageAndContent,\r\n  removePageBreak\r\n} from '../lib/editor/page-break-utils.js';\r\nimport { \r\n  checkAndReflow, \r\n  triggerAutoReflow \r\n} from '../lib/editor/content-reflow-utils.js';\r\nimport { \r\n  positionCursorAtPage, \r\n  scrollToPage, \r\n  checkAndUpdateBoundaries \r\n} from '../lib/editor/cursor-scroll-utils.js';\r\n\r\n// Performance constants\r\nconst DEFAULT_BOUNDARY_DELAY = 300;\r\n\r\n/**\r\n * useContinuousReflow - Automatically insert page breaks based on content height\r\n * Monitors content height and inserts <page-break> tags when content exceeds page dimensions\r\n * Content remains in a single continuous contenteditable surface\r\n * @param {string} pageSize - The page size (A4, Letter, Legal)\r\n * @param {React.RefObject} editorRef - Reference to the editor element\r\n * @param {number} zoomLevel - Current zoom level percentage (50-200)\r\n * @param {string} pageMargins - The margin preset name\r\n */\r\nexport const useContinuousReflow = (pageSize, editorRef, zoomLevel = 100, pageMargins = 'NARROW') => {\r\n  const actions = useDocumentActions();\r\n  const boundaryTimeoutRef = useRef(null);\r\n  const reflowTimeoutRef = useRef(null);\r\n  const latestPageSizeRef = useRef(pageSize);\r\n  const latestZoomLevelRef = useRef(zoomLevel);\r\n  const latestPageMarginsRef = useRef(pageMargins);\r\n  const isReflowingRef = useRef(false);\r\n\r\n  useEffect(() => {\r\n    latestPageSizeRef.current = pageSize;\r\n  }, [pageSize]);\r\n\r\n  useEffect(() => {\r\n    latestZoomLevelRef.current = zoomLevel;\r\n  }, [zoomLevel]);\r\n\r\n  useEffect(() => {\r\n    latestPageMarginsRef.current = pageMargins;\r\n  }, [pageMargins]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (boundaryTimeoutRef.current) {\r\n        clearTimeout(boundaryTimeoutRef.current);\r\n      }\r\n      if (reflowTimeoutRef.current) {\r\n        clearTimeout(reflowTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // ============================================================================\r\n  // BOUNDARY MANAGEMENT\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Calculate visual page boundaries based on <page-break> tags in content\r\n   * Returns array of boundary objects with top positions\r\n   * Optimized with cached selectors and better null checks\r\n   */\r\n  const calculatePageBoundariesCallback = useCallback((options = {}) => {\r\n    if (!editorRef?.current) {\r\n      return [];\r\n    }\r\n    return calculatePageBoundaries(editorRef.current, options);\r\n  }, [editorRef]);\r\n\r\n  /**\r\n   * Update page boundaries in Context state\r\n   */\r\n  const updateBoundaries = useCallback((options = {}) => {\r\n    const boundaries = calculatePageBoundariesCallback(options);\r\n    actions.updatePageBoundaries(boundaries);\r\n    return boundaries;\r\n  }, [calculatePageBoundariesCallback, actions]);\r\n\r\n  /**\r\n   * Debounced boundary calculation\r\n   * Triggers after content changes to recalculate page boundaries\r\n   * Optimized with configurable delay\r\n   */\r\n  const checkAndUpdateBoundariesCallback = useCallback((options = {}) => {\r\n    const delay = typeof options.delay === 'number' ? options.delay : DEFAULT_BOUNDARY_DELAY;\r\n    checkAndUpdateBoundaries(updateBoundaries, boundaryTimeoutRef, options, delay);\r\n  }, [updateBoundaries]);\r\n\r\n  // ============================================================================\r\n  // REFLOW MANAGEMENT\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Automatic reflow: Insert page breaks when content exceeds page height\r\n   * Optimized with performance guards and single-page-at-a-time processing\r\n   * Accounts for current zoom level and margins when calculating max height\r\n   */\r\n  const checkAndReflowCallback = useCallback(() => {\r\n    if (!editorRef?.current) {\r\n      return;\r\n    }\r\n\r\n    checkAndReflow(\r\n      editorRef.current,\r\n      latestPageSizeRef.current,\r\n      latestZoomLevelRef.current,\r\n      latestPageMarginsRef.current,\r\n      actions.updateContinuousContent,\r\n      updateBoundaries,\r\n      isReflowingRef,\r\n      checkAndReflowCallback\r\n    );\r\n  }, [editorRef, actions, updateBoundaries]);\r\n\r\n  /**\r\n   * Debounced automatic reflow check\r\n   * Optimized to prevent excessive reflow operations\r\n   */\r\n  const triggerAutoReflowCallback = useCallback((delay) => {\r\n    triggerAutoReflow(checkAndReflowCallback, reflowTimeoutRef, delay);\r\n  }, [checkAndReflowCallback]);\r\n\r\n  // ============================================================================\r\n  // NAVIGATION\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Get current page number based on viewport scroll position\r\n   * @param {React.RefObject} containerRef - The scroll container element\r\n   */\r\n  const getCurrentPageCallback = useCallback((containerRef) => {\r\n    if (!containerRef?.current || !editorRef?.current) {\r\n      return 0;\r\n    }\r\n    return getCurrentPage(containerRef.current, editorRef.current);\r\n  }, [editorRef]);\r\n\r\n  /**\r\n   * Position cursor at the start of a specific page\r\n   */\r\n  const positionCursorAtPageCallback = useCallback((pageNumber) => {\r\n    if (!editorRef?.current) {\r\n      return;\r\n    }\r\n    positionCursorAtPage(editorRef.current, pageNumber);\r\n  }, [editorRef]);\r\n\r\n  /**\r\n   * Scroll to a specific page and position cursor at the start of that page\r\n   */\r\n  const scrollToPageCallback = useCallback((pageNumber, containerRef) => {\r\n    if (!containerRef?.current || !editorRef?.current) {\r\n      console.warn('[scrollToPage] Missing refs');\r\n      return;\r\n    }\r\n    scrollToPage(containerRef.current, editorRef.current, pageNumber, positionCursorAtPageCallback);\r\n  }, [editorRef, positionCursorAtPageCallback]);\r\n\r\n  // ============================================================================\r\n  // PAGE MANAGEMENT\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Insert a page break at a specific page boundary based on content height\r\n   * This is used when manually adding pages to insert them at the correct location\r\n   * @param {number} pageNumber - The page number where the break should be inserted (1-based)\r\n   * @returns {Promise<boolean>} - Success status\r\n   */\r\n  const insertPageBreakAtBoundaryCallback = useCallback(async (pageNumber) => {\r\n    if (!editorRef?.current) {\r\n      return false;\r\n    }\r\n\r\n    return insertPageBreakAtBoundary(\r\n      editorRef.current,\r\n      pageNumber,\r\n      latestPageSizeRef.current,\r\n      latestZoomLevelRef.current,\r\n      latestPageMarginsRef.current,\r\n      actions.updateContinuousContent,\r\n      updateBoundaries\r\n    );\r\n  }, [editorRef, actions, updateBoundaries]);\r\n\r\n  /**\r\n   * Remove a page and its content from the continuous editor\r\n   * Removes the page break and all content between the page boundaries\r\n   * @param {number} pageIndex - The index of the page to remove (0-based)\r\n   */\r\n  const removePageAndContentCallback = useCallback((pageIndex) => {\r\n    if (!editorRef?.current) {\r\n      return false;\r\n    }\r\n\r\n    return removePageAndContent(\r\n      editorRef.current,\r\n      pageIndex,\r\n      calculatePageBoundariesCallback,\r\n      actions.updateContinuousContent,\r\n      updateBoundaries,\r\n      positionCursorAtPageCallback,\r\n      checkAndReflowCallback\r\n    );\r\n  }, [editorRef, calculatePageBoundariesCallback, actions, updateBoundaries, positionCursorAtPageCallback, checkAndReflowCallback]);\r\n\r\n  /**\r\n   * Remove a single page break element\r\n   * This removes just the page break, allowing content to reflow naturally\r\n   * @param {HTMLElement} pageBreakElement - The page break element to remove\r\n   */\r\n  const removePageBreakCallback = useCallback((pageBreakElement) => {\r\n    if (!editorRef?.current) {\r\n      return false;\r\n    }\r\n\r\n    return removePageBreak(\r\n      pageBreakElement,\r\n      editorRef.current,\r\n      actions.updateContinuousContent,\r\n      updateBoundaries,\r\n      checkAndReflowCallback\r\n    );\r\n  }, [editorRef, actions, updateBoundaries, checkAndReflowCallback]);\r\n\r\n  // ============================================================================\r\n  // CLEANUP & PERFORMANCE\r\n  // ============================================================================\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (boundaryTimeoutRef.current) {\r\n        clearTimeout(boundaryTimeoutRef.current);\r\n      }\r\n      if (reflowTimeoutRef.current) {\r\n        clearTimeout(reflowTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Memoize the return object to prevent unnecessary re-renders in consuming components\r\n  return useMemo(() => ({\r\n    calculatePageBoundaries: calculatePageBoundariesCallback,\r\n    checkAndUpdateBoundaries: checkAndUpdateBoundariesCallback,\r\n    updateBoundaries,\r\n    getCurrentPage: getCurrentPageCallback,\r\n    scrollToPage: scrollToPageCallback,\r\n    positionCursorAtPage: positionCursorAtPageCallback,\r\n    checkAndReflow: checkAndReflowCallback,\r\n    triggerAutoReflow: triggerAutoReflowCallback,\r\n    removePageAndContent: removePageAndContentCallback,\r\n    removePageBreak: removePageBreakCallback,\r\n    insertPageBreakAtBoundary: insertPageBreakAtBoundaryCallback,\r\n    boundaryTimeoutRef,\r\n    reflowTimeoutRef\r\n  }), [\r\n    calculatePageBoundariesCallback,\r\n    checkAndUpdateBoundariesCallback,\r\n    updateBoundaries,\r\n    getCurrentPageCallback,\r\n    scrollToPageCallback,\r\n    positionCursorAtPageCallback,\r\n    checkAndReflowCallback,\r\n    triggerAutoReflowCallback,\r\n    removePageAndContentCallback,\r\n    removePageBreakCallback,\r\n    insertPageBreakAtBoundaryCallback\r\n  ]);\r\n};\r\n","import { useEffect } from 'react';\r\n\r\n/**\r\n * Custom hook for handling keyboard shortcuts in the HTML editor\r\n * @param {Object} handlers - Object containing handler functions\r\n * @param {Function} handlers.handleZoomIn - Zoom in handler\r\n * @param {Function} handlers.handleZoomOut - Zoom out handler\r\n * @param {Function} handlers.handleZoomReset - Zoom reset handler\r\n * @param {Function} handlers.handleUndo - Undo handler\r\n * @param {Function} handlers.handleRedo - Redo handler\r\n * @param {Object} refs - Object containing refs\r\n * @param {React.RefObject} refs.editorRef - Editor ref\r\n * @param {React.RefObject} refs.containerRef - Container ref\r\n */\r\nexport const useKeyboardShortcuts = (handlers, refs) => {\r\n  const { handleZoomIn, handleZoomOut, handleZoomReset, handleUndo, handleRedo } = handlers;\r\n  const { editorRef, containerRef } = refs;\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (event) => {\r\n      // Check if Ctrl key (or Cmd on Mac) is pressed\r\n      if (event.ctrlKey || event.metaKey) {\r\n        // Prevent default browser behavior for our shortcuts\r\n        if (['+', '=', '-', '_', '0', 'z', 'y'].includes(event.key)) {\r\n          event.preventDefault();\r\n        }\r\n\r\n        // Only handle shortcuts when editor or its container has focus\r\n        // or when no specific input elements are focused\r\n        const isEditorFocused = document.activeElement === editorRef.current;\r\n        const isContainerFocused = document.activeElement === containerRef.current;\r\n        const isInputFocused = document.activeElement?.tagName === 'INPUT' ||\r\n                               document.activeElement?.tagName === 'TEXTAREA' ||\r\n                               document.activeElement?.isContentEditable === false;\r\n\r\n        if (isEditorFocused || isContainerFocused || !isInputFocused) {\r\n          switch (event.key) {\r\n            case '+':\r\n            case '=':\r\n              handleZoomIn();\r\n              break;\r\n            case '-':\r\n            case '_':\r\n              handleZoomOut();\r\n              break;\r\n            case '0':\r\n              handleZoomReset();\r\n              break;\r\n            case 'z':\r\n              if (!event.shiftKey) {\r\n                handleUndo();\r\n              }\r\n              break;\r\n            case 'y':\r\n              handleRedo();\r\n              break;\r\n            default:\r\n              break;\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyDown);\r\n    };\r\n  }, [handleZoomIn, handleZoomOut, handleZoomReset, handleUndo, handleRedo, editorRef, containerRef]);\r\n};","import { useCallback, useEffect, useRef } from 'react';\r\n\r\n/**\r\n * Custom hook for handling selection changes and cursor position management\r\n * @param {Object} params\r\n * @param {Function} params.updateCurrentFormatFromSelection - Function to update format from selection\r\n * @param {React.RefObject} params.editorRef - Editor ref\r\n * @returns {Object} - Returns cursor management functions\r\n */\r\nexport const useSelectionHandling = ({ updateCurrentFormatFromSelection, editorRef }) => {\r\n  const lastCursorPositionRef = useRef(null);\r\n\r\n  // Helper to restore cursor position or position at editor end\r\n  const restoreCursorPosition = useCallback(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const selection = window.getSelection();\r\n    if (lastCursorPositionRef.current) {\r\n      try {\r\n        selection.removeAllRanges();\r\n        selection.addRange(lastCursorPositionRef.current);\r\n        return;\r\n      } catch (error) {\r\n        console.warn('[restoreCursorPosition] Failed to restore cursor:', error);\r\n      }\r\n    }\r\n\r\n    // Fallback: position at end of editor\r\n    const lastChild = editorRef.current.lastChild;\r\n    if (lastChild) {\r\n      const range = document.createRange();\r\n      if (lastChild.nodeType === Node.TEXT_NODE) {\r\n        range.setStart(lastChild, lastChild.textContent.length);\r\n      } else {\r\n        range.setStartAfter(lastChild);\r\n      }\r\n      range.collapse(true);\r\n      selection.removeAllRanges();\r\n      selection.addRange(range);\r\n    }\r\n  }, [editorRef]);\r\n\r\n  // Helper to check if there's an active selection in the editor\r\n  const hasActiveCursorSelection = useCallback(() => {\r\n    if (!editorRef.current) return false;\r\n\r\n    const selection = window.getSelection();\r\n    if (!selection || selection.rangeCount === 0) return false;\r\n\r\n    const activeRange = selection.getRangeAt(0);\r\n    return editorRef.current.contains(activeRange.commonAncestorContainer);\r\n  }, [editorRef]);\r\n\r\n  // Update format state when selection changes\r\n  useEffect(() => {\r\n    const handleSelectionChange = () => {\r\n      updateCurrentFormatFromSelection();\r\n\r\n      // Update last cursor position (only for caret/collapsed selections)\r\n      if (editorRef.current) {\r\n        const selection = window.getSelection();\r\n        if (selection.rangeCount > 0) {\r\n          const range = selection.getRangeAt(0);\r\n          if (range.collapsed && editorRef.current.contains(range.commonAncestorContainer)) {\r\n            lastCursorPositionRef.current = range.cloneRange(); // Clone to store\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    // Listen for selection changes\r\n    document.addEventListener('selectionchange', handleSelectionChange);\r\n\r\n    // Also update when editor gets focus\r\n    const handleFocus = () => {\r\n      setTimeout(updateCurrentFormatFromSelection, 10);\r\n\r\n      // Restore cursor to last position if available\r\n      if (lastCursorPositionRef.current && editorRef.current) {\r\n        try {\r\n          const selection = window.getSelection();\r\n          selection.removeAllRanges();\r\n          selection.addRange(lastCursorPositionRef.current);\r\n        } catch (error) {\r\n          console.warn('[handleFocus] Failed to restore cursor:', error);\r\n        }\r\n      }\r\n    };\r\n\r\n    if (editorRef.current) {\r\n      editorRef.current.addEventListener('focus', handleFocus);\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener('selectionchange', handleSelectionChange);\r\n      if (editorRef.current) {\r\n        editorRef.current.removeEventListener('focus', handleFocus);\r\n      }\r\n    };\r\n  }, [updateCurrentFormatFromSelection, editorRef]);\r\n\r\n  return {\r\n    restoreCursorPosition,\r\n    hasActiveCursorSelection\r\n  };\r\n};","/**\r\n * Image Resize Utilities for HTML Editor\r\n * Provides functionality for resizing images with handlers\r\n */\r\n\r\n/**\r\n * Default image resize options\r\n */\r\nexport const DEFAULT_IMAGE_RESIZE_OPTIONS = {\r\n  minWidth: 50,\r\n  minHeight: 50,\r\n  maxWidth: 800,\r\n  maxHeight: 600,\r\n  aspectRatio: true,\r\n  preserveAspectRatio: true,\r\n  defaultWidth: 300,\r\n  defaultHeight: 200\r\n};\r\n\r\n/**\r\n * Image resize handler positions\r\n */\r\nexport const RESIZE_HANDLERS = {\r\n  TOP_LEFT: 'top-left',\r\n  TOP_RIGHT: 'top-right',\r\n  BOTTOM_LEFT: 'bottom-left',\r\n  BOTTOM_RIGHT: 'bottom-right',\r\n  TOP: 'top',\r\n  BOTTOM: 'bottom',\r\n  LEFT: 'left',\r\n  RIGHT: 'right'\r\n};\r\n\r\n/**\r\n * Calculate new dimensions based on resize handler and mouse movement\r\n * @param {Object} params - Resize parameters\r\n * @param {string} params.handler - Resize handler position\r\n * @param {number} params.startX - Initial mouse X position\r\n * @param {number} params.startY - Initial mouse Y position\r\n * @param {number} params.currentX - Current mouse X position\r\n * @param {number} params.currentY - Current mouse Y position\r\n * @param {number} params.startWidth - Initial image width\r\n * @param {number} params.startHeight - Initial image height\r\n * @param {Object} params.options - Resize options\r\n * @returns {Object} New width and height\r\n */\r\nexport function calculateResizeDimensions({\r\n  handler,\r\n  startX,\r\n  startY,\r\n  currentX,\r\n  currentY,\r\n  startWidth,\r\n  startHeight,\r\n  options = DEFAULT_IMAGE_RESIZE_OPTIONS\r\n}) {\r\n  const deltaX = currentX - startX;\r\n  const deltaY = currentY - startY;\r\n  \r\n  let newWidth = startWidth;\r\n  let newHeight = startHeight;\r\n  \r\n  // Calculate based on handler position\r\n  switch (handler) {\r\n    case RESIZE_HANDLERS.TOP_LEFT:\r\n      newWidth = Math.max(options.minWidth, startWidth - deltaX);\r\n      newHeight = Math.max(options.minHeight, startHeight - deltaY);\r\n      break;\r\n      \r\n    case RESIZE_HANDLERS.TOP_RIGHT:\r\n      newWidth = Math.max(options.minWidth, startWidth + deltaX);\r\n      newHeight = Math.max(options.minHeight, startHeight - deltaY);\r\n      break;\r\n      \r\n    case RESIZE_HANDLERS.BOTTOM_LEFT:\r\n      newWidth = Math.max(options.minWidth, startWidth - deltaX);\r\n      newHeight = Math.max(options.minHeight, startHeight + deltaY);\r\n      break;\r\n      \r\n    case RESIZE_HANDLERS.BOTTOM_RIGHT:\r\n      newWidth = Math.max(options.minWidth, startWidth + deltaX);\r\n      newHeight = Math.max(options.minHeight, startHeight + deltaY);\r\n      break;\r\n      \r\n    case RESIZE_HANDLERS.TOP:\r\n      newHeight = Math.max(options.minHeight, startHeight - deltaY);\r\n      break;\r\n      \r\n    case RESIZE_HANDLERS.BOTTOM:\r\n      newHeight = Math.max(options.minHeight, startHeight + deltaY);\r\n      break;\r\n      \r\n    case RESIZE_HANDLERS.LEFT:\r\n      newWidth = Math.max(options.minWidth, startWidth - deltaX);\r\n      break;\r\n      \r\n    case RESIZE_HANDLERS.RIGHT:\r\n      newWidth = Math.max(options.minWidth, startWidth + deltaX);\r\n      break;\r\n      \r\n    default:\r\n      return { width: newWidth, height: newHeight };\r\n  }\r\n  \r\n  // Apply aspect ratio if needed\r\n  if (options.preserveAspectRatio && options.aspectRatio) {\r\n    const aspectRatio = startWidth / startHeight;\r\n    \r\n    // For corner handlers, maintain aspect ratio\r\n    if ([RESIZE_HANDLERS.TOP_LEFT, RESIZE_HANDLERS.TOP_RIGHT, \r\n         RESIZE_HANDLERS.BOTTOM_LEFT, RESIZE_HANDLERS.BOTTOM_RIGHT].includes(handler)) {\r\n      // Use the larger dimension to maintain aspect ratio\r\n      if (newWidth / aspectRatio > newHeight) {\r\n        newHeight = Math.max(options.minHeight, newWidth / aspectRatio);\r\n      } else {\r\n        newWidth = Math.max(options.minWidth, newHeight * aspectRatio);\r\n      }\r\n    }\r\n    // For edge handlers, maintain aspect ratio\r\n    else if ([RESIZE_HANDLERS.TOP, RESIZE_HANDLERS.BOTTOM].includes(handler)) {\r\n      newWidth = newHeight * aspectRatio;\r\n    } else if ([RESIZE_HANDLERS.LEFT, RESIZE_HANDLERS.RIGHT].includes(handler)) {\r\n      newHeight = newWidth / aspectRatio;\r\n    }\r\n  }\r\n  \r\n  // Apply max dimensions\r\n  if (options.maxWidth && newWidth > options.maxWidth) {\r\n    newWidth = options.maxWidth;\r\n    if (options.preserveAspectRatio && options.aspectRatio) {\r\n      newHeight = newWidth / (startWidth / startHeight);\r\n    }\r\n  }\r\n  \r\n  if (options.maxHeight && newHeight > options.maxHeight) {\r\n    newHeight = options.maxHeight;\r\n    if (options.preserveAspectRatio && options.aspectRatio) {\r\n      newWidth = newHeight * (startWidth / startHeight);\r\n    }\r\n  }\r\n  \r\n  // Ensure minimum dimensions\r\n  newWidth = Math.max(options.minWidth, newWidth);\r\n  newHeight = Math.max(options.minHeight, newHeight);\r\n  \r\n  return {\r\n    width: Math.round(newWidth),\r\n    height: Math.round(newHeight)\r\n  };\r\n}\r\n\r\n/**\r\n * Check if an element is an image that can be resized\r\n * @param {HTMLElement} element - Element to check\r\n * @returns {boolean} Whether the element is a resizable image\r\n */\r\nexport function isResizableImage(element) {\r\n  if (!element) return false;\r\n  \r\n  // Check if it's an img element\r\n  if (element.tagName === 'IMG') {\r\n    return true;\r\n  }\r\n  \r\n  // Check if it's a div with background image that should be resizable\r\n  if (element.tagName === 'DIV' &&\r\n      element.style.backgroundImage &&\r\n      element.style.backgroundImage !== 'none') {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Get image dimensions from an element\r\n * @param {HTMLElement} element - Image element\r\n * @returns {Object} Width and height\r\n */\r\nexport function getImageDimensions(element) {\r\n  if (!isResizableImage(element)) {\r\n    return { width: 0, height: 0 };\r\n  }\r\n  \r\n  return {\r\n    width: element.offsetWidth,\r\n    height: element.offsetHeight\r\n  };\r\n}\r\n\r\n/**\r\n * Apply image dimensions to an element\r\n * @param {HTMLElement} element - Image element\r\n * @param {Object} dimensions - Width and height\r\n * @param {number} dimensions.width - New width\r\n * @param {number} dimensions.height - New height\r\n */\r\nexport function applyImageDimensions(element, { width, height }) {\r\n  if (!isResizableImage(element)) return;\r\n  \r\n  // For img elements\r\n  if (element.tagName === 'IMG') {\r\n    element.style.width = `${width}px`;\r\n    element.style.height = `${height}px`;\r\n    element.width = width;\r\n    element.height = height;\r\n  }\r\n  // For div elements with background images\r\n  else if (element.tagName === 'DIV') {\r\n    element.style.width = `${width}px`;\r\n    element.style.height = `${height}px`;\r\n  }\r\n}\r\n\r\n/**\r\n * Create resize overlay for an image\r\n * @param {HTMLElement} imageElement - Image element to resize\r\n * @param {Object} options - Resize options\r\n * @returns {HTMLElement} Resize overlay element\r\n */\r\nexport function createResizeOverlay(imageElement, options = DEFAULT_IMAGE_RESIZE_OPTIONS) {\r\n  if (!isResizableImage(imageElement)) return null;\r\n  \r\n  // Create overlay container\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'image-resize-overlay';\r\n  overlay.style.position = 'fixed'; // Changed to fixed for viewport positioning\r\n  overlay.style.zIndex = '1000';\r\n  overlay.style.pointerEvents = 'none';\r\n  \r\n  // Position overlay over the image using viewport coordinates\r\n  const rect = imageElement.getBoundingClientRect();\r\n  \r\n  overlay.style.top = `${rect.top}px`;\r\n  overlay.style.left = `${rect.left}px`;\r\n  overlay.style.width = `${rect.width}px`;\r\n  overlay.style.height = `${rect.height}px`;\r\n  \r\n  // Create resize handlers\r\n  const handlers = Object.values(RESIZE_HANDLERS);\r\n  handlers.forEach(handler => {\r\n    const handlerElement = document.createElement('div');\r\n    handlerElement.className = `resize-handler resize-handler-${handler}`;\r\n    handlerElement.dataset.handler = handler;\r\n    handlerElement.style.position = 'absolute';\r\n    handlerElement.style.width = '10px';\r\n    handlerElement.style.height = '10px';\r\n    handlerElement.style.backgroundColor = '#007bff';\r\n    handlerElement.style.border = '2px solid white';\r\n    handlerElement.style.borderRadius = '50%';\r\n    handlerElement.style.boxShadow = '0 0 3px rgba(0,0,0,0.3)';\r\n    handlerElement.style.cursor = getCursorForHandler(handler);\r\n    handlerElement.style.pointerEvents = 'all';\r\n    \r\n    // Position handler\r\n    positionHandler(handlerElement, handler, rect.width, rect.height);\r\n    \r\n    overlay.appendChild(handlerElement);\r\n  });\r\n  \r\n  return overlay;\r\n}\r\n\r\n/**\r\n * Get cursor style for a resize handler\r\n * @param {string} handler - Handler position\r\n * @returns {string} CSS cursor value\r\n */\r\nfunction getCursorForHandler(handler) {\r\n  switch (handler) {\r\n    case RESIZE_HANDLERS.TOP_LEFT:\r\n    case RESIZE_HANDLERS.BOTTOM_RIGHT:\r\n      return 'nwse-resize';\r\n    case RESIZE_HANDLERS.TOP_RIGHT:\r\n    case RESIZE_HANDLERS.BOTTOM_LEFT:\r\n      return 'nesw-resize';\r\n    case RESIZE_HANDLERS.TOP:\r\n    case RESIZE_HANDLERS.BOTTOM:\r\n      return 'ns-resize';\r\n    case RESIZE_HANDLERS.LEFT:\r\n    case RESIZE_HANDLERS.RIGHT:\r\n      return 'ew-resize';\r\n    default:\r\n      return 'default';\r\n  }\r\n}\r\n\r\n/**\r\n * Position a resize handler\r\n * @param {HTMLElement} handler - Handler element\r\n * @param {string} position - Handler position\r\n * @param {number} width - Container width\r\n * @param {number} height - Container height\r\n */\r\nfunction positionHandler(handler, position, width, height) {\r\n  const offset = -5; // Half of handler size to center it\r\n  \r\n  switch (position) {\r\n    case RESIZE_HANDLERS.TOP_LEFT:\r\n      handler.style.top = `${offset}px`;\r\n      handler.style.left = `${offset}px`;\r\n      break;\r\n    case RESIZE_HANDLERS.TOP_RIGHT:\r\n      handler.style.top = `${offset}px`;\r\n      handler.style.right = `${offset}px`;\r\n      break;\r\n    case RESIZE_HANDLERS.BOTTOM_LEFT:\r\n      handler.style.bottom = `${offset}px`;\r\n      handler.style.left = `${offset}px`;\r\n      break;\r\n    case RESIZE_HANDLERS.BOTTOM_RIGHT:\r\n      handler.style.bottom = `${offset}px`;\r\n      handler.style.right = `${offset}px`;\r\n      break;\r\n    case RESIZE_HANDLERS.TOP:\r\n      handler.style.top = `${offset}px`;\r\n      handler.style.left = `${width / 2 + offset}px`;\r\n      break;\r\n    case RESIZE_HANDLERS.BOTTOM:\r\n      handler.style.bottom = `${offset}px`;\r\n      handler.style.left = `${width / 2 + offset}px`;\r\n      break;\r\n    case RESIZE_HANDLERS.LEFT:\r\n      handler.style.top = `${height / 2 + offset}px`;\r\n      handler.style.left = `${offset}px`;\r\n      break;\r\n    case RESIZE_HANDLERS.RIGHT:\r\n      handler.style.top = `${height / 2 + offset}px`;\r\n      handler.style.right = `${offset}px`;\r\n      break;\r\n  }\r\n}\r\n\r\n/**\r\n * Update resize overlay position and size\r\n * @param {HTMLElement} overlay - Resize overlay\r\n * @param {HTMLElement} imageElement - Image element\r\n */\r\nexport function updateResizeOverlay(overlay, imageElement) {\r\n  if (!overlay || !imageElement) return;\r\n  \r\n  const rect = imageElement.getBoundingClientRect();\r\n  \r\n  overlay.style.top = `${rect.top}px`;\r\n  overlay.style.left = `${rect.left}px`;\r\n  overlay.style.width = `${rect.width}px`;\r\n  overlay.style.height = `${rect.height}px`;\r\n  \r\n  // Update handler positions\r\n  const handlers = overlay.querySelectorAll('.resize-handler');\r\n  handlers.forEach(handler => {\r\n    const position = handler.dataset.handler;\r\n    positionHandler(handler, position, rect.width, rect.height);\r\n  });\r\n}\r\n\r\n/**\r\n * Remove resize overlay\r\n * @param {HTMLElement} overlay - Resize overlay to remove\r\n */\r\nexport function removeResizeOverlay(overlay) {\r\n  if (overlay && overlay.parentNode) {\r\n    overlay.parentNode.removeChild(overlay);\r\n  }\r\n}\r\n","/**\r\n * IndexedDB storage service for handling image persistence in the editor\r\n * Stores images as base64 data URLs with better scalability than localStorage\r\n * Supports storing many large images without quota limitations\r\n */\r\n\r\nconst DB_NAME = 'html-editor-storage';\r\nconst DB_VERSION = 1;\r\nconst STORE_NAME = 'images';\r\n\r\n/**\r\n * Generates a UUID v4 string for unique image keys\r\n * @returns {string} UUID string\r\n */\r\nfunction generateUUID() {\r\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\r\n    const r = Math.random() * 16 | 0;\r\n    const v = c === 'x' ? r : (r & 0x3 | 0x8);\r\n    return v.toString(16);\r\n  });\r\n}\r\n\r\n/**\r\n * Opens the IndexedDB database\r\n * @returns {Promise<IDBDatabase>} Promise resolving to database instance\r\n */\r\nfunction openDatabase() {\r\n  return new Promise((resolve, reject) => {\r\n    const request = indexedDB.open(DB_NAME, DB_VERSION);\r\n\r\n    request.onerror = () => {\r\n      reject(new Error('Failed to open IndexedDB database'));\r\n    };\r\n\r\n    request.onsuccess = () => {\r\n      resolve(request.result);\r\n    };\r\n\r\n    request.onupgradeneeded = (event) => {\r\n      const db = event.target.result;\r\n      \r\n      // Create object store if it doesn't exist\r\n      if (!db.objectStoreNames.contains(STORE_NAME)) {\r\n        const objectStore = db.createObjectStore(STORE_NAME, { keyPath: 'key' });\r\n        objectStore.createIndex('timestamp', 'timestamp', { unique: false });\r\n      }\r\n    };\r\n  });\r\n}\r\n\r\n/**\r\n * Saves an image file to IndexedDB\r\n * @param {File} file - Image file to store\r\n * @returns {Promise<string>} Promise resolving to storage key\r\n * @throws {Error} When image validation fails or storage operation fails\r\n */\r\nexport function saveImage(file) {\r\n  return new Promise((resolve, reject) => {\r\n    // Validate file type\r\n    const validTypes = ['image/png', 'image/jpeg', 'image/gif', 'image/webp'];\r\n    if (!validTypes.includes(file.type)) {\r\n      reject(new Error('Invalid image format. Supported formats: png, jpeg, gif, webp'));\r\n      return;\r\n    }\r\n\r\n    // Check file size (5MB limit per image - can be increased as needed)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      reject(new Error('Image exceeds maximum size of 5MB'));\r\n      return;\r\n    }\r\n\r\n    const reader = new FileReader();\r\n    \r\n    reader.onload = async (event) => {\r\n      const dataUrl = event.target.result;\r\n      \r\n      // Calculate base64 size (3 bytes for every 4 characters)\r\n      const base64String = dataUrl.split(',')[1];\r\n      const sizeInBytes = (base64String.length * 3) / 4;\r\n      \r\n      if (sizeInBytes > 5 * 1024 * 1024) {\r\n        reject(new Error('Image exceeds maximum size of 5MB'));\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const db = await openDatabase();\r\n        const key = `editor-image-${generateUUID()}`;\r\n        \r\n        const transaction = db.transaction([STORE_NAME], 'readwrite');\r\n        const objectStore = transaction.objectStore(STORE_NAME);\r\n        \r\n        const imageData = {\r\n          key,\r\n          dataUrl,\r\n          size: sizeInBytes,\r\n          type: file.type,\r\n          timestamp: Date.now()\r\n        };\r\n        \r\n        const request = objectStore.add(imageData);\r\n        \r\n        request.onsuccess = () => {\r\n          db.close();\r\n          resolve(key);\r\n        };\r\n        \r\n        request.onerror = () => {\r\n          db.close();\r\n          reject(new Error('Failed to save image to IndexedDB'));\r\n        };\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    };\r\n\r\n    reader.onerror = () => {\r\n      reject(new Error('Error reading image file'));\r\n    };\r\n\r\n    reader.readAsDataURL(file);\r\n  });\r\n}\r\n\r\n/**\r\n * Retrieves an image from IndexedDB by key\r\n * @param {string} key - Storage key for the image\r\n * @returns {Promise<string|null>} Promise resolving to data URL of the image or null if not found\r\n */\r\nexport async function getImage(key) {\r\n  try {\r\n    const db = await openDatabase();\r\n    \r\n    return new Promise((resolve, reject) => {\r\n      const transaction = db.transaction([STORE_NAME], 'readonly');\r\n      const objectStore = transaction.objectStore(STORE_NAME);\r\n      const request = objectStore.get(key);\r\n      \r\n      request.onsuccess = () => {\r\n        db.close();\r\n        const result = request.result;\r\n        resolve(result ? result.dataUrl : null);\r\n      };\r\n      \r\n      request.onerror = () => {\r\n        db.close();\r\n        reject(new Error('Failed to retrieve image from IndexedDB'));\r\n      };\r\n    });\r\n  } catch (error) {\r\n    console.error('Error getting image:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Deletes an image from IndexedDB\r\n * @param {string} key - Storage key for the image\r\n * @returns {Promise<void>}\r\n */\r\nexport async function deleteImage(key) {\r\n  try {\r\n    const db = await openDatabase();\r\n    \r\n    return new Promise((resolve, reject) => {\r\n      const transaction = db.transaction([STORE_NAME], 'readwrite');\r\n      const objectStore = transaction.objectStore(STORE_NAME);\r\n      const request = objectStore.delete(key);\r\n      \r\n      request.onsuccess = () => {\r\n        db.close();\r\n        resolve();\r\n      };\r\n      \r\n      request.onerror = () => {\r\n        db.close();\r\n        reject(new Error('Failed to delete image from IndexedDB'));\r\n      };\r\n    });\r\n  } catch (error) {\r\n    console.error('Error deleting image:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clears all editor images from IndexedDB\r\n * @returns {Promise<void>}\r\n */\r\nexport async function clearImages() {\r\n  try {\r\n    const db = await openDatabase();\r\n    \r\n    return new Promise((resolve, reject) => {\r\n      const transaction = db.transaction([STORE_NAME], 'readwrite');\r\n      const objectStore = transaction.objectStore(STORE_NAME);\r\n      const request = objectStore.clear();\r\n      \r\n      request.onsuccess = () => {\r\n        db.close();\r\n        resolve();\r\n      };\r\n      \r\n      request.onerror = () => {\r\n        db.close();\r\n        reject(new Error('Failed to clear images from IndexedDB'));\r\n      };\r\n    });\r\n  } catch (error) {\r\n    console.error('Error clearing images:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Gets all stored image keys\r\n * @returns {Promise<string[]>} Promise resolving to array of image storage keys\r\n */\r\nexport async function getAllImageKeys() {\r\n  try {\r\n    const db = await openDatabase();\r\n    \r\n    return new Promise((resolve, reject) => {\r\n      const transaction = db.transaction([STORE_NAME], 'readonly');\r\n      const objectStore = transaction.objectStore(STORE_NAME);\r\n      const request = objectStore.getAllKeys();\r\n      \r\n      request.onsuccess = () => {\r\n        db.close();\r\n        resolve(request.result || []);\r\n      };\r\n      \r\n      request.onerror = () => {\r\n        db.close();\r\n        reject(new Error('Failed to get image keys from IndexedDB'));\r\n      };\r\n    });\r\n  } catch (error) {\r\n    console.error('Error getting image keys:', error);\r\n    return [];\r\n  }\r\n}\r\n","/**\r\n * Content normalization utilities\r\n * Handles comprehensive HTML content normalization including:\r\n * - Paragraphs, headings, lists, tables\r\n * - Images with alignment\r\n * - Font formatting and sizes\r\n * - Indentation\r\n * - Page breaks\r\n */\r\n\r\n// Block-level elements that should not be wrapped in paragraphs\r\nconst BLOCK_ELEMENTS = [\r\n  'P', 'DIV', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6',\r\n  'UL', 'OL', 'LI', 'TABLE', 'TBODY', 'TR', 'TD', 'TH', 'THEAD', 'TFOOT',\r\n  'BLOCKQUOTE', 'PRE', 'HR', 'FIGURE', 'FIGCAPTION',\r\n  'PAGE-BREAK'\r\n];\r\n\r\n// Inline formatting elements that should be preserved\r\nconst INLINE_FORMATTING_ELEMENTS = [\r\n  'SPAN', 'STRONG', 'EM', 'B', 'I', 'U', 'S', 'STRIKE', 'DEL', 'INS',\r\n  'SUB', 'SUP', 'MARK', 'SMALL', 'CODE', 'KBD', 'SAMP', 'VAR',\r\n  'A', 'ABBR', 'CITE', 'DFN', 'TIME'\r\n];\r\n\r\n// Self-closing elements\r\nconst VOID_ELEMENTS = ['BR', 'HR', 'IMG', 'INPUT', 'PAGE-BREAK'];\r\n\r\n/**\r\n * Escapes HTML special characters\r\n * @param {string} text - Text to escape\r\n * @returns {string} Escaped HTML text\r\n */\r\nfunction escapeHtml(text) {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Gets element attributes as a string\r\n * @param {HTMLElement} element - The element to get attributes from\r\n * @returns {string} Attributes string for HTML\r\n */\r\nfunction getElementAttributes(element) {\r\n  const attributes = [];\r\n  for (let i = 0; i < element.attributes.length; i++) {\r\n    const attr = element.attributes[i];\r\n    // Preserve all attributes including style, class, data-*, align, etc.\r\n    attributes.push(` ${attr.name}=\"${attr.value}\"`);\r\n  }\r\n  return attributes.join('');\r\n}\r\n\r\n/**\r\n * Normalizes HTML content with comprehensive support for all content types\r\n * Handles: paragraphs, headings, images, lists, tables, indentation,\r\n * image alignment, fonts, font sizes, and page breaks\r\n * @param {string} htmlContent - The HTML content to normalize\r\n * @returns {string} Normalized HTML content with proper structure\r\n */\r\nexport function normalizeContent(htmlContent) {\r\n  if (!htmlContent || typeof htmlContent !== 'string') {\r\n    return '<p><br></p>';\r\n  }\r\n\r\n  const trimmed = htmlContent.trim();\r\n  if (!trimmed) {\r\n    return '<p><br></p>';\r\n  }\r\n\r\n  // Create a temporary DOM element to parse the HTML\r\n  const tempDiv = document.createElement('div');\r\n  tempDiv.innerHTML = trimmed;\r\n\r\n  // Process the content to ensure proper structure\r\n  const normalizedContent = normalizeElement(tempDiv);\r\n\r\n  return normalizedContent || '<p><br></p>';\r\n}\r\n\r\n/**\r\n * Removes nested paragraph tags from heading elements\r\n * @param {HTMLElement} headingElement - The heading element to clean\r\n * @returns {string} Cleaned inner HTML without nested paragraphs\r\n */\r\nfunction removeNestedParagraphs(headingElement) {\r\n  const clonedElement = headingElement.cloneNode(true);\r\n  \r\n  // Find all p tags that are direct children of the heading\r\n  const nestedParagraphs = clonedElement.querySelectorAll(':scope > p');\r\n  \r\n  // Remove the p tags and move their content to the heading level\r\n  nestedParagraphs.forEach(p => {\r\n    // Move all child nodes of the p tag to the heading level\r\n    while (p.firstChild) {\r\n      clonedElement.insertBefore(p.firstChild, p);\r\n    }\r\n    // Remove the empty p tag\r\n    p.remove();\r\n  });\r\n  \r\n  return clonedElement.innerHTML;\r\n}\r\n\r\n/**\r\n * Checks if a paragraph element contains only block elements and should be unwrapped\r\n * @param {HTMLElement} paragraphElement - The paragraph element to check\r\n * @returns {boolean} True if the paragraph should be unwrapped\r\n */\r\nfunction shouldUnwrapParagraph(paragraphElement) {\r\n  const childElements = Array.from(paragraphElement.children);\r\n  \r\n  // If paragraph has no child elements, don't unwrap\r\n  if (childElements.length === 0) {\r\n    return false;\r\n  }\r\n  \r\n  // Check if all child elements are block elements\r\n  return childElements.every(child => BLOCK_ELEMENTS.includes(child.tagName));\r\n}\r\n\r\n/**\r\n * Unwraps block elements from inside a paragraph\r\n * @param {HTMLElement} paragraphElement - The paragraph element to unwrap\r\n * @returns {string} HTML string with block elements unwrapped\r\n */\r\nfunction unwrapParagraphBlockElements(paragraphElement) {\r\n  const blockElements = [];\r\n  let hasNonBlockContent = false;\r\n  \r\n  Array.from(paragraphElement.childNodes).forEach(node => {\r\n    if (node.nodeType === Node.TEXT_NODE) {\r\n      const text = node.textContent.trim();\r\n      if (text) {\r\n        hasNonBlockContent = true;\r\n      }\r\n    } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n      const element = node;\r\n      if (BLOCK_ELEMENTS.includes(element.tagName)) {\r\n        blockElements.push(element.outerHTML);\r\n      } else {\r\n        hasNonBlockContent = true;\r\n      }\r\n    }\r\n  });\r\n  \r\n  // If paragraph has non-block content, we shouldn't unwrap\r\n  if (hasNonBlockContent) {\r\n    return paragraphElement.outerHTML;\r\n  }\r\n  \r\n  // Return unwrapped block elements\r\n  return blockElements.join('');\r\n}\r\n\r\n/**\r\n * Normalizes an element and its children\r\n * @param {HTMLElement} container - Container element with content\r\n * @returns {string} HTML string with proper structure\r\n */\r\nfunction normalizeElement(container) {\r\n  const fragments = [];\r\n  const childNodes = Array.from(container.childNodes);\r\n\r\n  for (let i = 0; i < childNodes.length; i++) {\r\n    const node = childNodes[i];\r\n\r\n    if (node.nodeType === Node.TEXT_NODE) {\r\n      // Handle text nodes - wrap in p if not empty\r\n      const text = node.textContent.trim();\r\n      if (text) {\r\n        fragments.push(`<p>${escapeHtml(text)}</p>`);\r\n      }\r\n    } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n      const element = node;\r\n      const tagName = element.tagName;\r\n      const lowerTagName = tagName.toLowerCase();\r\n      const attributes = getElementAttributes(element);\r\n\r\n      // Handle different element types\r\n      if (tagName === 'DIV') {\r\n        // Convert div content to proper structure\r\n        const innerContent = normalizeElement(element);\r\n        if (innerContent.trim()) {\r\n          fragments.push(innerContent);\r\n        } else {\r\n          fragments.push('<p><br></p>');\r\n        }\r\n      } else if (tagName === 'P') {\r\n        // Check if paragraph contains only block elements that should be unwrapped\r\n        if (shouldUnwrapParagraph(element)) {\r\n          fragments.push(unwrapParagraphBlockElements(element));\r\n        } else {\r\n          // Preserve paragraphs with all their attributes (style, class, etc.)\r\n          fragments.push(element.outerHTML);\r\n        }\r\n      } else if (['H1', 'H2', 'H3', 'H4', 'H5', 'H6'].includes(tagName)) {\r\n        // Handle heading elements - remove any nested p tags, preserve attributes\r\n        const headingContent = removeNestedParagraphs(element);\r\n        fragments.push(`<${lowerTagName}${attributes}>${headingContent}</${lowerTagName}>`);\r\n      } else if (tagName === 'BR') {\r\n        // Handle line breaks - convert to paragraph break\r\n        fragments.push('<p><br></p>');\r\n      } else if (tagName === 'IMG') {\r\n        // Preserve images with all attributes (src, alt, style, align, width, height, etc.)\r\n        fragments.push(element.outerHTML);\r\n      } else if (['UL', 'OL'].includes(tagName)) {\r\n        // Preserve lists with proper structure\r\n        fragments.push(normalizeList(element));\r\n      } else if (tagName === 'LI') {\r\n        // Preserve list items with attributes\r\n        fragments.push(element.outerHTML);\r\n      } else if (tagName === 'TABLE') {\r\n        // Preserve tables with all structure and attributes\r\n        fragments.push(normalizeTable(element));\r\n      } else if (['TBODY', 'THEAD', 'TFOOT', 'TR', 'TD', 'TH'].includes(tagName)) {\r\n        // Preserve table elements with attributes\r\n        fragments.push(element.outerHTML);\r\n      } else if (tagName === 'BLOCKQUOTE') {\r\n        // Preserve blockquotes with attributes\r\n        const innerContent = normalizeElement(element);\r\n        fragments.push(`<blockquote${attributes}>${innerContent}</blockquote>`);\r\n      } else if (tagName === 'PRE') {\r\n        // Preserve preformatted text exactly as-is\r\n        fragments.push(element.outerHTML);\r\n      } else if (INLINE_FORMATTING_ELEMENTS.includes(tagName)) {\r\n        // Preserve inline formatting elements with attributes (including font styles)\r\n        fragments.push(element.outerHTML);\r\n      } else if (tagName === 'PAGE-BREAK' || element.getAttribute('data-page-break') === 'true') {\r\n        // Preserve page breaks as-is\r\n        fragments.push(element.outerHTML);\r\n      } else if (tagName === 'HR') {\r\n        // Preserve horizontal rules\r\n        fragments.push(element.outerHTML);\r\n      } else if (tagName === 'FIGURE') {\r\n        // Preserve figure elements (for images with captions)\r\n        fragments.push(element.outerHTML);\r\n      } else {\r\n        // For any other elements, preserve them with their attributes\r\n        if (VOID_ELEMENTS.includes(tagName)) {\r\n          fragments.push(element.outerHTML);\r\n        } else {\r\n          const innerContent = normalizeElement(element);\r\n          fragments.push(`<${lowerTagName}${attributes}>${innerContent}</${lowerTagName}>`);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // If no content was processed, return empty string (let parent decide default)\r\n  if (fragments.length === 0) {\r\n    return '';\r\n  }\r\n\r\n  return fragments.join('');\r\n}\r\n\r\n/**\r\n * Normalizes list elements (UL/OL)\r\n * @param {HTMLElement} listElement - The list element to normalize\r\n * @returns {string} Normalized list HTML\r\n */\r\nfunction normalizeList(listElement) {\r\n  const tagName = listElement.tagName.toLowerCase();\r\n  const attributes = getElementAttributes(listElement);\r\n  const items = [];\r\n\r\n  Array.from(listElement.children).forEach(child => {\r\n    if (child.tagName === 'LI') {\r\n      items.push(child.outerHTML);\r\n    } else {\r\n      // Wrap non-LI content in LI\r\n      const content = normalizeElement(child);\r\n      if (content.trim()) {\r\n        items.push(`<li>${content}</li>`);\r\n      }\r\n    }\r\n  });\r\n\r\n  if (items.length === 0) {\r\n    return `<${tagName}${attributes}><li><br></li></${tagName}>`;\r\n  }\r\n\r\n  return `<${tagName}${attributes}>${items.join('')}</${tagName}>`;\r\n}\r\n\r\n/**\r\n * Normalizes table elements\r\n * @param {HTMLElement} tableElement - The table element to normalize\r\n * @returns {string} Normalized table HTML\r\n */\r\nfunction normalizeTable(tableElement) {\r\n  // Preserve tables exactly as-is with all their attributes and structure\r\n  // Tables are complex and should maintain their exact structure\r\n  return tableElement.outerHTML;\r\n}","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nconst toKebabCase = (string) => string.replace(/([a-z0-9])([A-Z])/g, \"$1-$2\").toLowerCase();\nconst toCamelCase = (string) => string.replace(\n  /^([A-Z])|[\\s-_]+(\\w)/g,\n  (match, p1, p2) => p2 ? p2.toUpperCase() : p1.toLowerCase()\n);\nconst toPascalCase = (string) => {\n  const camelCase = toCamelCase(string);\n  return camelCase.charAt(0).toUpperCase() + camelCase.slice(1);\n};\nconst mergeClasses = (...classes) => classes.filter((className, index, array) => {\n  return Boolean(className) && className.trim() !== \"\" && array.indexOf(className) === index;\n}).join(\" \").trim();\nconst hasA11yProp = (props) => {\n  for (const prop in props) {\n    if (prop.startsWith(\"aria-\") || prop === \"role\" || prop === \"title\") {\n      return true;\n    }\n  }\n};\n\nexport { hasA11yProp, mergeClasses, toCamelCase, toKebabCase, toPascalCase };\n//# sourceMappingURL=utils.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nvar defaultAttributes = {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  width: 24,\n  height: 24,\n  viewBox: \"0 0 24 24\",\n  fill: \"none\",\n  stroke: \"currentColor\",\n  strokeWidth: 2,\n  strokeLinecap: \"round\",\n  strokeLinejoin: \"round\"\n};\n\nexport { defaultAttributes as default };\n//# sourceMappingURL=defaultAttributes.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport { forwardRef, createElement } from 'react';\nimport defaultAttributes from './defaultAttributes.js';\nimport { mergeClasses, hasA11yProp } from './shared/src/utils.js';\n\nconst Icon = forwardRef(\n  ({\n    color = \"currentColor\",\n    size = 24,\n    strokeWidth = 2,\n    absoluteStrokeWidth,\n    className = \"\",\n    children,\n    iconNode,\n    ...rest\n  }, ref) => createElement(\n    \"svg\",\n    {\n      ref,\n      ...defaultAttributes,\n      width: size,\n      height: size,\n      stroke: color,\n      strokeWidth: absoluteStrokeWidth ? Number(strokeWidth) * 24 / Number(size) : strokeWidth,\n      className: mergeClasses(\"lucide\", className),\n      ...!children && !hasA11yProp(rest) && { \"aria-hidden\": \"true\" },\n      ...rest\n    },\n    [\n      ...iconNode.map(([tag, attrs]) => createElement(tag, attrs)),\n      ...Array.isArray(children) ? children : [children]\n    ]\n  )\n);\n\nexport { Icon as default };\n//# sourceMappingURL=Icon.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport { forwardRef, createElement } from 'react';\nimport { mergeClasses, toKebabCase, toPascalCase } from './shared/src/utils.js';\nimport Icon from './Icon.js';\n\nconst createLucideIcon = (iconName, iconNode) => {\n  const Component = forwardRef(\n    ({ className, ...props }, ref) => createElement(Icon, {\n      ref,\n      iconNode,\n      className: mergeClasses(\n        `lucide-${toKebabCase(toPascalCase(iconName))}`,\n        `lucide-${iconName}`,\n        className\n      ),\n      ...props\n    })\n  );\n  Component.displayName = toPascalCase(iconName);\n  return Component;\n};\n\nexport { createLucideIcon as default };\n//# sourceMappingURL=createLucideIcon.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 5v14\", key: \"s699le\" }],\n  [\"path\", { d: \"m19 12-7 7-7-7\", key: \"1idqje\" }]\n];\nconst ArrowDown = createLucideIcon(\"arrow-down\", __iconNode);\n\nexport { __iconNode, ArrowDown as default };\n//# sourceMappingURL=arrow-down.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m12 19-7-7 7-7\", key: \"1l729n\" }],\n  [\"path\", { d: \"M19 12H5\", key: \"x3x0zl\" }]\n];\nconst ArrowLeft = createLucideIcon(\"arrow-left\", __iconNode);\n\nexport { __iconNode, ArrowLeft as default };\n//# sourceMappingURL=arrow-left.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M5 12h14\", key: \"1ays0h\" }],\n  [\"path\", { d: \"m12 5 7 7-7 7\", key: \"xquz4c\" }]\n];\nconst ArrowRight = createLucideIcon(\"arrow-right\", __iconNode);\n\nexport { __iconNode, ArrowRight as default };\n//# sourceMappingURL=arrow-right.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m5 12 7-7 7 7\", key: \"hav0vg\" }],\n  [\"path\", { d: \"M12 19V5\", key: \"x0mq9r\" }]\n];\nconst ArrowUp = createLucideIcon(\"arrow-up\", __iconNode);\n\nexport { __iconNode, ArrowUp as default };\n//# sourceMappingURL=arrow-up.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    { d: \"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8\", key: \"mg9rjx\" }\n  ]\n];\nconst Bold = createLucideIcon(\"bold\", __iconNode);\n\nexport { __iconNode, Bold as default };\n//# sourceMappingURL=bold.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [[\"path\", { d: \"m15 18-6-6 6-6\", key: \"1wnfg3\" }]];\nconst ChevronLeft = createLucideIcon(\"chevron-left\", __iconNode);\n\nexport { __iconNode, ChevronLeft as default };\n//# sourceMappingURL=chevron-left.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [[\"path\", { d: \"m9 18 6-6-6-6\", key: \"mthhwq\" }]];\nconst ChevronRight = createLucideIcon(\"chevron-right\", __iconNode);\n\nexport { __iconNode, ChevronRight as default };\n//# sourceMappingURL=chevron-right.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z\", key: \"1rqfz7\" }],\n  [\"path\", { d: \"M14 2v4a2 2 0 0 0 2 2h4\", key: \"tnqrlb\" }],\n  [\"path\", { d: \"m9 15 2 2 4-4\", key: \"1grp1n\" }]\n];\nconst FileCheck = createLucideIcon(\"file-check\", __iconNode);\n\nexport { __iconNode, FileCheck as default };\n//# sourceMappingURL=file-check.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z\", key: \"1rqfz7\" }],\n  [\"path\", { d: \"M14 2v4a2 2 0 0 0 2 2h4\", key: \"tnqrlb\" }],\n  [\"path\", { d: \"M10 9H8\", key: \"b1mrlr\" }],\n  [\"path\", { d: \"M16 13H8\", key: \"t4e002\" }],\n  [\"path\", { d: \"M16 17H8\", key: \"z1uh3a\" }]\n];\nconst FileText = createLucideIcon(\"file-text\", __iconNode);\n\nexport { __iconNode, FileText as default };\n//# sourceMappingURL=file-text.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"line\", { x1: \"4\", x2: \"20\", y1: \"9\", y2: \"9\", key: \"4lhtct\" }],\n  [\"line\", { x1: \"4\", x2: \"20\", y1: \"15\", y2: \"15\", key: \"vyu0kd\" }],\n  [\"line\", { x1: \"10\", x2: \"8\", y1: \"3\", y2: \"21\", key: \"1ggp8o\" }],\n  [\"line\", { x1: \"16\", x2: \"14\", y1: \"3\", y2: \"21\", key: \"weycgp\" }]\n];\nconst Hash = createLucideIcon(\"hash\", __iconNode);\n\nexport { __iconNode, Hash as default };\n//# sourceMappingURL=hash.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M4 12h8\", key: \"17cfdx\" }],\n  [\"path\", { d: \"M4 18V6\", key: \"1rz3zl\" }],\n  [\"path\", { d: \"M12 18V6\", key: \"zqpxq5\" }],\n  [\"path\", { d: \"m17 12 3-2v8\", key: \"1hhhft\" }]\n];\nconst Heading1 = createLucideIcon(\"heading-1\", __iconNode);\n\nexport { __iconNode, Heading1 as default };\n//# sourceMappingURL=heading-1.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M4 12h8\", key: \"17cfdx\" }],\n  [\"path\", { d: \"M4 18V6\", key: \"1rz3zl\" }],\n  [\"path\", { d: \"M12 18V6\", key: \"zqpxq5\" }],\n  [\"path\", { d: \"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1\", key: \"9jr5yi\" }]\n];\nconst Heading2 = createLucideIcon(\"heading-2\", __iconNode);\n\nexport { __iconNode, Heading2 as default };\n//# sourceMappingURL=heading-2.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M4 12h8\", key: \"17cfdx\" }],\n  [\"path\", { d: \"M4 18V6\", key: \"1rz3zl\" }],\n  [\"path\", { d: \"M12 18V6\", key: \"zqpxq5\" }],\n  [\"path\", { d: \"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2\", key: \"68ncm8\" }],\n  [\"path\", { d: \"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2\", key: \"1ejuhz\" }]\n];\nconst Heading3 = createLucideIcon(\"heading-3\", __iconNode);\n\nexport { __iconNode, Heading3 as default };\n//# sourceMappingURL=heading-3.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 3h5v5\", key: \"1806ms\" }],\n  [\"path\", { d: \"M17 21h2a2 2 0 0 0 2-2\", key: \"130fy9\" }],\n  [\"path\", { d: \"M21 12v3\", key: \"1wzk3p\" }],\n  [\"path\", { d: \"m21 3-5 5\", key: \"1g5oa7\" }],\n  [\"path\", { d: \"M3 7V5a2 2 0 0 1 2-2\", key: \"kk3yz1\" }],\n  [\"path\", { d: \"m5 21 4.144-4.144a1.21 1.21 0 0 1 1.712 0L13 19\", key: \"fyekpt\" }],\n  [\"path\", { d: \"M9 3h3\", key: \"d52fa\" }],\n  [\"rect\", { x: \"3\", y: \"11\", width: \"10\", height: \"10\", rx: \"1\", key: \"1wpmix\" }]\n];\nconst ImageUpscale = createLucideIcon(\"image-upscale\", __iconNode);\n\nexport { __iconNode, ImageUpscale as default };\n//# sourceMappingURL=image-upscale.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"3\", rx: \"2\", ry: \"2\", key: \"1m3agn\" }],\n  [\"circle\", { cx: \"9\", cy: \"9\", r: \"2\", key: \"af1f0g\" }],\n  [\"path\", { d: \"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21\", key: \"1xmnt7\" }]\n];\nconst Image = createLucideIcon(\"image\", __iconNode);\n\nexport { __iconNode, Image as default };\n//# sourceMappingURL=image.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"line\", { x1: \"19\", x2: \"10\", y1: \"4\", y2: \"4\", key: \"15jd3p\" }],\n  [\"line\", { x1: \"14\", x2: \"5\", y1: \"20\", y2: \"20\", key: \"bu0au3\" }],\n  [\"line\", { x1: \"15\", x2: \"9\", y1: \"4\", y2: \"20\", key: \"uljnxc\" }]\n];\nconst Italic = createLucideIcon(\"italic\", __iconNode);\n\nexport { __iconNode, Italic as default };\n//# sourceMappingURL=italic.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\", key: \"1cjeqo\" }],\n  [\"path\", { d: \"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\", key: \"19qd67\" }]\n];\nconst Link = createLucideIcon(\"link\", __iconNode);\n\nexport { __iconNode, Link as default };\n//# sourceMappingURL=link.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M21 5H11\", key: \"us1j55\" }],\n  [\"path\", { d: \"M21 12H11\", key: \"wd7e0v\" }],\n  [\"path\", { d: \"M21 19H11\", key: \"saa85w\" }],\n  [\"path\", { d: \"m7 8-4 4 4 4\", key: \"o5hrat\" }]\n];\nconst ListIndentDecrease = createLucideIcon(\"list-indent-decrease\", __iconNode);\n\nexport { __iconNode, ListIndentDecrease as default };\n//# sourceMappingURL=list-indent-decrease.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M21 5H11\", key: \"us1j55\" }],\n  [\"path\", { d: \"M21 12H11\", key: \"wd7e0v\" }],\n  [\"path\", { d: \"M21 19H11\", key: \"saa85w\" }],\n  [\"path\", { d: \"m3 8 4 4-4 4\", key: \"1a3j6y\" }]\n];\nconst ListIndentIncrease = createLucideIcon(\"list-indent-increase\", __iconNode);\n\nexport { __iconNode, ListIndentIncrease as default };\n//# sourceMappingURL=list-indent-increase.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M11 5h10\", key: \"1cz7ny\" }],\n  [\"path\", { d: \"M11 12h10\", key: \"1438ji\" }],\n  [\"path\", { d: \"M11 19h10\", key: \"11t30w\" }],\n  [\"path\", { d: \"M4 4h1v5\", key: \"10yrso\" }],\n  [\"path\", { d: \"M4 9h2\", key: \"r1h2o0\" }],\n  [\"path\", { d: \"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02\", key: \"xtkcd5\" }]\n];\nconst ListOrdered = createLucideIcon(\"list-ordered\", __iconNode);\n\nexport { __iconNode, ListOrdered as default };\n//# sourceMappingURL=list-ordered.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 5h.01\", key: \"18ugdj\" }],\n  [\"path\", { d: \"M3 12h.01\", key: \"nlz23k\" }],\n  [\"path\", { d: \"M3 19h.01\", key: \"noohij\" }],\n  [\"path\", { d: \"M8 5h13\", key: \"1pao27\" }],\n  [\"path\", { d: \"M8 12h13\", key: \"1za7za\" }],\n  [\"path\", { d: \"M8 19h13\", key: \"m83p4d\" }]\n];\nconst List = createLucideIcon(\"list\", __iconNode);\n\nexport { __iconNode, List as default };\n//# sourceMappingURL=list.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z\",\n      key: \"e79jfc\"\n    }\n  ],\n  [\"circle\", { cx: \"13.5\", cy: \"6.5\", r: \".5\", fill: \"currentColor\", key: \"1okk4w\" }],\n  [\"circle\", { cx: \"17.5\", cy: \"10.5\", r: \".5\", fill: \"currentColor\", key: \"f64h9f\" }],\n  [\"circle\", { cx: \"6.5\", cy: \"12.5\", r: \".5\", fill: \"currentColor\", key: \"qy21gx\" }],\n  [\"circle\", { cx: \"8.5\", cy: \"7.5\", r: \".5\", fill: \"currentColor\", key: \"fotxhn\" }]\n];\nconst Palette = createLucideIcon(\"palette\", __iconNode);\n\nexport { __iconNode, Palette as default };\n//# sourceMappingURL=palette.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M5 12h14\", key: \"1ays0h\" }],\n  [\"path\", { d: \"M12 5v14\", key: \"s699le\" }]\n];\nconst Plus = createLucideIcon(\"plus\", __iconNode);\n\nexport { __iconNode, Plus as default };\n//# sourceMappingURL=plus.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M21 7v6h-6\", key: \"3ptur4\" }],\n  [\"path\", { d: \"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7\", key: \"1kgawr\" }]\n];\nconst Redo = createLucideIcon(\"redo\", __iconNode);\n\nexport { __iconNode, Redo as default };\n//# sourceMappingURL=redo.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\", key: \"1m0v6g\" }],\n  [\"path\", { d: \"M14 15H9v-5\", key: \"pi4jk9\" }],\n  [\"path\", { d: \"M16 3h5v5\", key: \"1806ms\" }],\n  [\"path\", { d: \"M21 3 9 15\", key: \"15kdhq\" }]\n];\nconst Scaling = createLucideIcon(\"scaling\", __iconNode);\n\nexport { __iconNode, Scaling as default };\n//# sourceMappingURL=scaling.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915\",\n      key: \"1i5ecw\"\n    }\n  ],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"3\", key: \"1v7zrd\" }]\n];\nconst Settings = createLucideIcon(\"settings\", __iconNode);\n\nexport { __iconNode, Settings as default };\n//# sourceMappingURL=settings.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 4H9a3 3 0 0 0-2.83 4\", key: \"43sutm\" }],\n  [\"path\", { d: \"M14 12a4 4 0 0 1 0 8H6\", key: \"nlfj13\" }],\n  [\"line\", { x1: \"4\", x2: \"20\", y1: \"12\", y2: \"12\", key: \"1e0a9i\" }]\n];\nconst Strikethrough = createLucideIcon(\"strikethrough\", __iconNode);\n\nexport { __iconNode, Strikethrough as default };\n//# sourceMappingURL=strikethrough.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 3v18\", key: \"108xh3\" }],\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"3\", rx: \"2\", key: \"afitv7\" }],\n  [\"path\", { d: \"M3 9h18\", key: \"1pudct\" }],\n  [\"path\", { d: \"M3 15h18\", key: \"5xshup\" }]\n];\nconst Table = createLucideIcon(\"table\", __iconNode);\n\nexport { __iconNode, Table as default };\n//# sourceMappingURL=table.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M21 5H3\", key: \"1fi0y6\" }],\n  [\"path\", { d: \"M17 12H7\", key: \"16if0g\" }],\n  [\"path\", { d: \"M19 19H5\", key: \"vjpgq2\" }]\n];\nconst TextAlignCenter = createLucideIcon(\"text-align-center\", __iconNode);\n\nexport { __iconNode, TextAlignCenter as default };\n//# sourceMappingURL=text-align-center.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M21 5H3\", key: \"1fi0y6\" }],\n  [\"path\", { d: \"M21 12H9\", key: \"dn1m92\" }],\n  [\"path\", { d: \"M21 19H7\", key: \"4cu937\" }]\n];\nconst TextAlignEnd = createLucideIcon(\"text-align-end\", __iconNode);\n\nexport { __iconNode, TextAlignEnd as default };\n//# sourceMappingURL=text-align-end.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 5h18\", key: \"1u36vt\" }],\n  [\"path\", { d: \"M3 12h18\", key: \"1i2n21\" }],\n  [\"path\", { d: \"M3 19h18\", key: \"awlh7x\" }]\n];\nconst TextAlignJustify = createLucideIcon(\"text-align-justify\", __iconNode);\n\nexport { __iconNode, TextAlignJustify as default };\n//# sourceMappingURL=text-align-justify.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M21 5H3\", key: \"1fi0y6\" }],\n  [\"path\", { d: \"M15 12H3\", key: \"6jk70r\" }],\n  [\"path\", { d: \"M17 19H3\", key: \"z6ezky\" }]\n];\nconst TextAlignStart = createLucideIcon(\"text-align-start\", __iconNode);\n\nexport { __iconNode, TextAlignStart as default };\n//# sourceMappingURL=text-align-start.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M10 11v6\", key: \"nco0om\" }],\n  [\"path\", { d: \"M14 11v6\", key: \"outv1u\" }],\n  [\"path\", { d: \"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6\", key: \"miytrc\" }],\n  [\"path\", { d: \"M3 6h18\", key: \"d0wm0j\" }],\n  [\"path\", { d: \"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\", key: \"e791ji\" }]\n];\nconst Trash2 = createLucideIcon(\"trash-2\", __iconNode);\n\nexport { __iconNode, Trash2 as default };\n//# sourceMappingURL=trash-2.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M6 4v6a6 6 0 0 0 12 0V4\", key: \"9kb039\" }],\n  [\"line\", { x1: \"4\", x2: \"20\", y1: \"20\", y2: \"20\", key: \"nun2al\" }]\n];\nconst Underline = createLucideIcon(\"underline\", __iconNode);\n\nexport { __iconNode, Underline as default };\n//# sourceMappingURL=underline.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 7v6h6\", key: \"1v2h90\" }],\n  [\"path\", { d: \"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13\", key: \"1r6uu6\" }]\n];\nconst Undo = createLucideIcon(\"undo\", __iconNode);\n\nexport { __iconNode, Undo as default };\n//# sourceMappingURL=undo.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M18 6 6 18\", key: \"1bl5f8\" }],\n  [\"path\", { d: \"m6 6 12 12\", key: \"d8bk6v\" }]\n];\nconst X = createLucideIcon(\"x\", __iconNode);\n\nexport { __iconNode, X as default };\n//# sourceMappingURL=x.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"11\", cy: \"11\", r: \"8\", key: \"4ej97u\" }],\n  [\"line\", { x1: \"21\", x2: \"16.65\", y1: \"21\", y2: \"16.65\", key: \"13gj7c\" }],\n  [\"line\", { x1: \"11\", x2: \"11\", y1: \"8\", y2: \"14\", key: \"1vmskp\" }],\n  [\"line\", { x1: \"8\", x2: \"14\", y1: \"11\", y2: \"11\", key: \"durymu\" }]\n];\nconst ZoomIn = createLucideIcon(\"zoom-in\", __iconNode);\n\nexport { __iconNode, ZoomIn as default };\n//# sourceMappingURL=zoom-in.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"11\", cy: \"11\", r: \"8\", key: \"4ej97u\" }],\n  [\"line\", { x1: \"21\", x2: \"16.65\", y1: \"21\", y2: \"16.65\", key: \"13gj7c\" }],\n  [\"line\", { x1: \"8\", x2: \"14\", y1: \"11\", y2: \"11\", key: \"durymu\" }]\n];\nconst ZoomOut = createLucideIcon(\"zoom-out\", __iconNode);\n\nexport { __iconNode, ZoomOut as default };\n//# sourceMappingURL=zoom-out.js.map\n","import React, { useState, useEffect, useMemo } from 'react';\r\nimport { useDocumentState } from '../../context/DocumentContext';\r\nimport { \r\n  FileText, \r\n  Hash, \r\n  FileCheck, \r\n  ChevronLeft, \r\n  ChevronRight,\r\n  Heading1,\r\n  Heading2,\r\n  Heading3,\r\n  List\r\n} from 'lucide-react';\r\nimport './Sidebar.css';\r\n\r\n/**\r\n * Extracts headings from HTML content\r\n * @param {string} htmlContent - The HTML content to parse\r\n * @param {number|null} pageNumber - The page number for headings, or null for continuous mode\r\n * @param {string} prefix - Prefix for heading IDs\r\n * @returns {Array} Array of heading objects\r\n */\r\nconst extractHeadings = (htmlContent, pageNumber, prefix = '') => {\r\n  if (!htmlContent) return [];\r\n  \r\n  const tempDiv = document.createElement('div');\r\n  tempDiv.innerHTML = htmlContent;\r\n  const headingElements = tempDiv.querySelectorAll('h1, h2, h3, h4, h5, h6');\r\n  \r\n  return Array.from(headingElements).map((heading, index) => {\r\n    const level = parseInt(heading.tagName.charAt(1));\r\n    const text = heading.textContent.trim();\r\n    return text ? {\r\n      id: `${prefix}heading-${index}`,\r\n      level,\r\n      text,\r\n      page: pageNumber || 1\r\n    } : null;\r\n  }).filter(Boolean);\r\n};\r\n\r\n/**\r\n * Calculates word count from HTML content\r\n * @param {string} htmlContent - The HTML content to parse\r\n * @returns {number} Word count\r\n */\r\nconst calculateWordCount = (htmlContent) => {\r\n  if (!htmlContent) return 0;\r\n  \r\n  const tempDiv = document.createElement('div');\r\n  tempDiv.innerHTML = htmlContent;\r\n  const text = tempDiv.textContent || tempDiv.innerText || '';\r\n  return text.trim().split(/\\s+/).filter(word => word.length > 0).length;\r\n};\r\n\r\n/**\r\n * Sidebar Component\r\n * Displays document information, outline, and word count\r\n * @param {Object} props\r\n * @param {boolean} props.isCollapsed - Whether sidebar is collapsed\r\n * @param {Function} props.onToggle - Callback for collapse toggle\r\n * @param {number} props.wordCount - Optional word count (for continuous mode)\r\n * @param {number} props.pageCount - Optional page count (for continuous mode)\r\n */\r\nexport const Sidebar = ({ isCollapsed, onToggle, wordCount: propWordCount, pageCount: propPageCount }) => {\r\n  const documentState = useDocumentState();\r\n  const { pages, activePage, continuousContent } = documentState;\r\n\r\n  // Memoize word count and outline calculations for better performance\r\n  const { wordCount, outline } = useMemo(() => {\r\n    // Use prop values if provided (continuous mode)\r\n    if (propWordCount !== undefined && propPageCount !== undefined) {\r\n      return {\r\n        wordCount: propWordCount,\r\n        outline: extractHeadings(continuousContent, 1, 'continuous-')\r\n      };\r\n    }\r\n\r\n    // Paged mode: Calculate from pages array\r\n    let totalWords = 0;\r\n    const headings = [];\r\n\r\n    pages.forEach((page, pageIndex) => {\r\n      totalWords += calculateWordCount(page.content);\r\n      headings.push(...extractHeadings(page.content, pageIndex + 1, `page-${pageIndex}-`));\r\n    });\r\n\r\n    return { wordCount: totalWords, outline: headings };\r\n  }, [pages, propWordCount, propPageCount, continuousContent]);\r\n\r\n  const displayPageCount = propPageCount !== undefined ? propPageCount : pages.length;\r\n\r\n  return (\r\n    <aside \r\n      className={`sidebar ${isCollapsed ? 'collapsed' : ''}`} \r\n      role=\"complementary\"\r\n      aria-label=\"Document information\"\r\n      data-testid=\"sidebar\"\r\n    >\r\n      <div className=\"sidebar-header\">\r\n        <div className=\"sidebar-title\">\r\n          <FileText size={18} />\r\n          <h2>Document Info</h2>\r\n        </div>\r\n        <button\r\n          className=\"sidebar-toggle\"\r\n          onClick={onToggle}\r\n          aria-label={isCollapsed ? \"Expand sidebar\" : \"Collapse sidebar\"}\r\n          title={isCollapsed ? \"Expand sidebar\" : \"Collapse sidebar\"}\r\n        >\r\n          {isCollapsed ? <ChevronRight size={16} /> : <ChevronLeft size={16} />}\r\n        </button>\r\n      </div>\r\n\r\n      {!isCollapsed && (\r\n        <div className=\"sidebar-content\">\r\n          <div className=\"sidebar-section\">\r\n            <h3>Statistics</h3>\r\n            <div className=\"stat-item\">\r\n              <div className=\"stat-label\">\r\n                <FileCheck size={14} />\r\n                <span>Pages:</span>\r\n              </div>\r\n              <span className=\"stat-value\">{displayPageCount}</span>\r\n            </div>\r\n            <div className=\"stat-item\" data-testid=\"word-count\">\r\n              <div className=\"stat-label\">\r\n                <Hash size={14} />\r\n                <span>Words:</span>\r\n              </div>\r\n              <span className=\"stat-value\">{wordCount.toLocaleString()}</span>\r\n            </div>\r\n            <div className=\"stat-item\">\r\n              <div className=\"stat-label\">\r\n                <FileText size={14} />\r\n                <span>Active Page:</span>\r\n              </div>\r\n              <span className=\"stat-value\">{activePage + 1}</span>\r\n            </div>\r\n          </div>\r\n\r\n          {outline.length > 0 && (\r\n            <div className=\"sidebar-section\">\r\n              <h3>\r\n                <List size={14} style={{ display: 'inline-block', marginRight: '6px', verticalAlign: 'middle' }} />\r\n                Document Outline\r\n              </h3>\r\n              <div className=\"document-outline\" data-testid=\"outline\">\r\n                {outline.map((heading) => {\r\n                  const HeadingIcon = heading.level === 1 ? Heading1 : heading.level === 2 ? Heading2 : Heading3;\r\n                  return (\r\n                    <div \r\n                      key={heading.id}\r\n                      className={`outline-item outline-level-${heading.level}`}\r\n                      style={{ marginLeft: `${(heading.level - 1) * 12}px` }}\r\n                    >\r\n                      <HeadingIcon size={12} className=\"outline-icon\" />\r\n                      <span className=\"outline-text\">{heading.text}</span>\r\n                      <span className=\"outline-page\">p.{heading.page}</span>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </aside>\r\n  );\r\n};\r\n\r\nexport default Sidebar;\r\n","/**\r\n * Logger utility for the editor\r\n * Provides consistent logging across the application\r\n * Disabled in production for performance\r\n */\r\n\r\nconst isDevelopment = import.meta.env.MODE === 'development';\r\n\r\n/**\r\n * Logger class for structured logging\r\n */\r\nclass Logger {\r\n  constructor(namespace = 'Editor') {\r\n    this.namespace = namespace;\r\n  }\r\n\r\n  /**\r\n   * Formats log message with namespace\r\n   * @param {string} level - Log level\r\n   * @param {string} message - Log message\r\n   * @param {any} data - Optional data to log\r\n   * @returns {string} Formatted message\r\n   */\r\n  _format(level, message, data) {\r\n    const timestamp = new Date().toISOString();\r\n    return `[${timestamp}] [${this.namespace}] [${level}] ${message}`;\r\n  }\r\n\r\n  /**\r\n   * Info level logging\r\n   * @param {string} message - Info message\r\n   * @param {any} data - Optional data\r\n   */\r\n  info(message, data) {\r\n    if (!isDevelopment) return;\r\n    \r\n    console.log(this._format('INFO', message));\r\n    if (data) console.log(data);\r\n  }\r\n\r\n  /**\r\n   * Warning level logging\r\n   * @param {string} message - Warning message\r\n   * @param {any} data - Optional data\r\n   */\r\n  warn(message, data) {\r\n    if (!isDevelopment) return;\r\n    \r\n    console.warn(this._format('WARN', message));\r\n    if (data) console.warn(data);\r\n  }\r\n\r\n  /**\r\n   * Error level logging\r\n   * @param {string} message - Error message\r\n   * @param {Error|any} error - Error object or data\r\n   */\r\n  error(message, error) {\r\n    if (!isDevelopment) return;\r\n    \r\n    console.error(this._format('ERROR', message));\r\n    if (error) {\r\n      if (error instanceof Error) {\r\n        console.error(error.message);\r\n        console.error(error.stack);\r\n      } else {\r\n        console.error(error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Debug level logging\r\n   * @param {string} message - Debug message\r\n   * @param {any} data - Optional data\r\n   */\r\n  debug(message, data) {\r\n    if (!isDevelopment) return;\r\n    \r\n    console.debug(this._format('DEBUG', message));\r\n    if (data) console.debug(data);\r\n  }\r\n}\r\n\r\n// Create default logger instance\r\nexport const logger = new Logger('Editor');\r\n\r\n// Export Logger class for custom instances\r\nexport default Logger;\r\n","/**\r\n * Indentation utilities for contenteditable editor\r\n * Handles tab indentation for selected text similar to Microsoft Word\r\n */\r\n\r\n/**\r\n * Set of block-level tags we treat as indentation targets.\r\n */\r\nconst BLOCK_TAGS = new Set(['P', 'DIV', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'LI', 'BLOCKQUOTE', 'PRE', 'TABLE']);\r\nconst LIST_INDENT_STEP = 32; // px per indent level for lists\r\n\r\n/**\r\n * Adjusts inline margin for block element indentation, tracking level in data attribute.\r\n * @param {Element} block\r\n * @param {boolean} isOutdent\r\n */\r\nfunction adjustBlockIndentation(block, isOutdent) {\r\n  if (!block) return;\r\n\r\n  if (!block.dataset) {\r\n    block.dataset = {};\r\n  }\r\n  if (!block.style) {\r\n    block.style = {};\r\n  }\r\n\r\n  const currentLevel = parseInt(block.dataset.indentLevel || '0', 10);\r\n  const nextLevel = Math.max(0, isOutdent ? currentLevel - 1 : currentLevel + 1);\r\n\r\n  if (nextLevel === 0) {\r\n    block.style.marginLeft = '';\r\n    delete block.dataset.indentLevel;\r\n  } else {\r\n    block.style.marginLeft = `${nextLevel * LIST_INDENT_STEP}px`;\r\n    block.dataset.indentLevel = String(nextLevel);\r\n  }\r\n}\r\n\r\n/**\r\n * Adjust inline margin for list indentation, tracking level in data attribute.\r\n * @param {Element} listItem\r\n * @param {boolean} isOutdent\r\n */\r\nfunction adjustListIndentation(listItem, isOutdent) {\r\n  adjustBlockIndentation(listItem, isOutdent);\r\n}\r\n\r\n/**\r\n * Walks up the DOM tree to find the closest block element ancestor.\r\n * @param {Node} node\r\n * @returns {Element|null}\r\n */\r\nfunction findClosestBlockElement(node) {\r\n  let current = node;\r\n  while (current) {\r\n    if (current.nodeType === 1 && current.tagName && BLOCK_TAGS.has(current.tagName.toUpperCase())) {\r\n      return current;\r\n    }\r\n    current = current.parentElement || current.parentNode;\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Gets all block elements (paragraphs) that intersect with the current selection\r\n * @returns {Element[]} Array of block elements in the selection\r\n */\r\nfunction getSelectedBlocks() {\r\n  const selection = window.getSelection();\r\n  if (!selection || selection.rangeCount === 0) return [];\r\n\r\n  const range = selection.getRangeAt(0);\r\n  const blocks = new Set();\r\n\r\n  // Find the contenteditable container\r\n  let container = range.commonAncestorContainer;\r\n  if (container.nodeType === Node.TEXT_NODE) {\r\n    container = container.parentElement;\r\n  }\r\n  while (container && container.contentEditable !== 'true') {\r\n    container = container.parentElement;\r\n  }\r\n  if (!container) return [];\r\n\r\n  // Get all block elements in the container\r\n  const allBlocks = container.querySelectorAll('p, div, h1, h2, h3, h4, h5, h6, li, blockquote, pre, table');\r\n\r\n  // Find blocks that intersect with the selection\r\n  allBlocks.forEach(block => {\r\n    const blockRange = document.createRange();\r\n    blockRange.selectNodeContents(block);\r\n\r\n    if (range.intersectsNode(block)) {\r\n      blocks.add(block);\r\n    }\r\n  });\r\n\r\n  // If no blocks found but there are images in the selection, find their containers\r\n  if (blocks.size === 0) {\r\n    const images = container.querySelectorAll('img');\r\n    images.forEach(img => {\r\n      const imgRange = document.createRange();\r\n      imgRange.selectNode(img);\r\n\r\n      if (range.intersectsNode(img)) {\r\n        // Find the containing block element\r\n        let parent = img.parentElement;\r\n        while (parent && parent !== container) {\r\n          if (parent.tagName && BLOCK_TAGS.has(parent.tagName.toUpperCase())) {\r\n            blocks.add(parent);\r\n            break;\r\n          }\r\n          parent = parent.parentElement;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  const uniqueBlocks = Array.from(blocks).filter(block => {\r\n    let parent = block.parentElement;\r\n    while (parent) {\r\n      if (blocks.has(parent)) {\r\n        return false;\r\n      }\r\n      parent = parent.parentElement;\r\n    }\r\n    return true;\r\n  });\r\n\r\n  return uniqueBlocks;\r\n}\r\n\r\n/**\r\n * Removes leading indentation (&nbsp;&nbsp;&nbsp;&nbsp;) from a block element or reduces margin-left\r\n * Handles cases where indentation might be inside formatted text or stored as margin-left\r\n * @param {Element} block - The block element to outdent\r\n */\r\nfunction removeLeadingIndentation(block) {\r\n  // First check if block has margin-left indentation (new approach)\r\n  if (block.style && block.style.marginLeft && block.style.marginLeft !== '') {\r\n    const currentLevel = parseInt(block.dataset.indentLevel || '0', 10);\r\n    const nextLevel = Math.max(0, currentLevel - 1);\r\n    if (nextLevel === 0) {\r\n      block.style.marginLeft = '';\r\n      delete block.dataset.indentLevel;\r\n    } else {\r\n      block.style.marginLeft = `${nextLevel * LIST_INDENT_STEP}px`;\r\n      block.dataset.indentLevel = String(nextLevel);\r\n    }\r\n    return;\r\n  }\r\n\r\n  // Fallback to old &nbsp; approach for backward compatibility\r\n  // First try to remove from innerHTML if it's at the start (for backward compatibility and tests)\r\n  if (block.innerHTML.startsWith('&nbsp;&nbsp;&nbsp;&nbsp;')) {\r\n    block.innerHTML = block.innerHTML.replace(/^(&nbsp;){4}/, '');\r\n    return;\r\n  }\r\n\r\n  // If not at the start of innerHTML, try to find it in text nodes\r\n  try {\r\n    // Walk through all text nodes in the block\r\n    const walker = document.createTreeWalker(\r\n      block,\r\n      NodeFilter.SHOW_TEXT,\r\n      null\r\n    );\r\n\r\n    let node = walker.nextNode();\r\n    while (node) {\r\n      // Check if this text node starts with indentation\r\n      const text = node.textContent;\r\n      if (text.startsWith('\\u00A0\\u00A0\\u00A0\\u00A0')) { // \\u00A0 is non-breaking space\r\n        node.textContent = text.substring(4);\r\n        break; // Only remove from the first text node that has indentation\r\n      }\r\n      node = walker.nextNode();\r\n    }\r\n  } catch (error) {\r\n    // Fallback for environments without createTreeWalker (like tests)\r\n    // Try regex replacement on innerHTML\r\n    block.innerHTML = block.innerHTML.replace(/^(&nbsp;){4}/, '');\r\n  }\r\n}\r\n\r\n/**\r\n * Indents or outdents selected paragraphs\r\n * @param {boolean} isOutdent - Whether to outdent (true) or indent (false)\r\n * @returns {boolean} True if operation was performed, false otherwise\r\n */\r\nexport function indentSelectedBlocks(isOutdent = false) {\r\n  const selection = window.getSelection();\r\n  if (!selection || selection.rangeCount === 0) return false;\r\n\r\n  let blocks = getSelectedBlocks();\r\n  const range = selection.getRangeAt(0);\r\n\r\n  if (blocks.length === 0) {\r\n    const fallbackBlock = findClosestBlockElement(range.startContainer);\r\n    if (!fallbackBlock) return false;\r\n    blocks = [fallbackBlock];\r\n  }\r\n\r\n  // Save the position of the selection relative to the container\r\n  const firstBlock = blocks[0];\r\n  const lastBlock = blocks[blocks.length - 1];\r\n\r\n  // Modify the blocks\r\n  blocks.forEach(block => {\r\n    const tagName = block.tagName ? block.tagName.toUpperCase() : '';\r\n\r\n    if (tagName === 'LI') {\r\n      adjustListIndentation(block, isOutdent);\r\n      return;\r\n    }\r\n\r\n    // For all other block elements, use margin-left approach\r\n    if (isOutdent) {\r\n      // For outdent, remove leading indentation from text content or reduce margin\r\n      removeLeadingIndentation(block);\r\n    } else {\r\n      // For indent, add indentation using margin-left\r\n      adjustBlockIndentation(block, false);\r\n    }\r\n  });\r\n\r\n  // Restore selection by recreating range with the same blocks\r\n  // Since we only modified innerHTML, the block elements themselves are still valid\r\n  try {\r\n    const newRange = document.createRange();\r\n    \r\n    // Helper function to get the deepest first text node\r\n    const getFirstTextNode = (element) => {\r\n      if (element.nodeType === Node.TEXT_NODE) {\r\n        return element;\r\n      }\r\n      \r\n      const walker = document.createTreeWalker(\r\n        element,\r\n        NodeFilter.SHOW_TEXT,\r\n        null\r\n      );\r\n      return walker.nextNode();\r\n    };\r\n    \r\n    // Helper function to get the deepest last text node\r\n    const getLastTextNode = (element) => {\r\n      if (element.nodeType === Node.TEXT_NODE) {\r\n        return element;\r\n      }\r\n      \r\n      const walker = document.createTreeWalker(\r\n        element,\r\n        NodeFilter.SHOW_TEXT,\r\n        null\r\n      );\r\n      \r\n      let lastNode = null;\r\n      let currentNode = walker.nextNode();\r\n      while (currentNode) {\r\n        lastNode = currentNode;\r\n        currentNode = walker.nextNode();\r\n      }\r\n      return lastNode;\r\n    };\r\n    \r\n    // Set start of selection\r\n    const firstTextNode = getFirstTextNode(firstBlock);\r\n    if (firstTextNode) {\r\n      newRange.setStart(firstTextNode, 0);\r\n    } else {\r\n      newRange.setStart(firstBlock, 0);\r\n    }\r\n    \r\n    // Set end of selection\r\n    const lastTextNode = getLastTextNode(lastBlock);\r\n    if (lastTextNode) {\r\n      newRange.setEnd(lastTextNode, lastTextNode.length);\r\n    } else {\r\n      newRange.setEnd(lastBlock, lastBlock.childNodes.length);\r\n    }\r\n    \r\n    selection.removeAllRanges();\r\n    selection.addRange(newRange);\r\n  } catch (error) {\r\n    // Fallback: select the entire range of modified blocks\r\n    try {\r\n      const fallbackRange = document.createRange();\r\n      fallbackRange.setStartBefore(firstBlock);\r\n      fallbackRange.setEndAfter(lastBlock);\r\n      selection.removeAllRanges();\r\n      selection.addRange(fallbackRange);\r\n    } catch (fallbackError) {\r\n      // If even the fallback fails, do nothing\r\n      console.warn('Could not restore selection after indentation:', fallbackError);\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Handles tab key press for indentation\r\n * @param {KeyboardEvent} event - The keydown event\r\n * @returns {boolean} True if event was handled, false otherwise\r\n */\r\nexport function handleTabIndentation(event) {\r\n  if (event.key !== 'Tab') return false;\r\n\r\n  event.preventDefault();\r\n\r\n  const isOutdent = event.shiftKey;\r\n  const selection = window.getSelection();\r\n  const range = selection && selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\r\n\r\n  // If there's a selection, try to indent/outdent the selected blocks\r\n  if (selection && selection.rangeCount > 0 && range && !range.collapsed) {\r\n    const success = indentSelectedBlocks(isOutdent);\r\n    if (success) return true;\r\n    // Fall through to cursor insertion if no blocks were found\r\n  }\r\n\r\n  // No selection or no blocks found - insert indentation at cursor (only for Tab, not Shift+Tab)\r\n  if (!isOutdent) {\r\n    document.execCommand('insertHTML', false, '&nbsp;&nbsp;&nbsp;&nbsp;');\r\n  }\r\n\r\n  return true;\r\n}","import React, { useState, useRef, useEffect } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Palette } from 'lucide-react';\r\n\r\n/**\r\n * ColorPickerDropdown - A dropdown component for selecting font colors\r\n * Provides a palette of basic colors with a custom color picker option\r\n */\r\nconst ColorPickerDropdown = ({ currentColor, onColorSelect, title = \"Font Color\" }) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const dropdownRef = useRef(null);\r\n\r\n  // Basic color palette\r\n  const colorPalette = [\r\n    '#000000', // Black\r\n    '#FF0000', // Red\r\n    '#00FF00', // Green\r\n    '#0000FF', // Blue\r\n    '#FFFF00', // Yellow\r\n    '#FF00FF', // Magenta\r\n    '#00FFFF', // Cyan\r\n    '#FFA500', // Orange\r\n    '#800080', // Purple\r\n    '#FFC0CB', // Pink\r\n    '#A52A2A', // Brown\r\n    '#808080', // Gray\r\n    '#FFFFFF', // White\r\n  ];\r\n\r\n  // Close dropdown when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\r\n        setIsOpen(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, []);\r\n\r\n  const handleColorClick = (color) => {\r\n    onColorSelect(color);\r\n    setIsOpen(false);\r\n  };\r\n\r\n  const handleCustomColorChange = (event) => {\r\n    const color = event.target.value;\r\n    onColorSelect(color);\r\n  };\r\n\r\n  return (\r\n    <div className=\"color-picker-dropdown\" ref={dropdownRef}>\r\n      <button\r\n        onClick={() => setIsOpen(!isOpen)}\r\n        className=\"color-picker-button\"\r\n        title={title}\r\n        style={{\r\n          backgroundColor: currentColor || '#000000',\r\n          border: '1px solid #ccc',\r\n          borderRadius: '3px',\r\n          width: '24px',\r\n          height: '24px',\r\n          cursor: 'pointer',\r\n          position: 'relative'\r\n        }}\r\n      >\r\n        <Palette size={14} style={{ color: currentColor === '#FFFFFF' ? '#000' : '#FFF' }} />\r\n      </button>\r\n\r\n      {isOpen && (\r\n        <div className=\"color-picker-palette\">\r\n          <div className=\"color-grid\">\r\n            {colorPalette.map((color) => (\r\n              <button\r\n                key={color}\r\n                onClick={() => handleColorClick(color)}\r\n                className={`color-option ${currentColor === color ? 'selected' : ''}`}\r\n                style={{\r\n                  backgroundColor: color,\r\n                  border: currentColor === color ? '2px solid #007acc' : '1px solid #ccc',\r\n                  width: '24px',\r\n                  height: '24px',\r\n                  margin: '2px',\r\n                  borderRadius: '3px',\r\n                  cursor: 'pointer'\r\n                }}\r\n                title={color}\r\n              />\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"custom-color-section\">\r\n            <label htmlFor=\"custom-color-input\" style={{ fontSize: '12px', marginBottom: '4px', display: 'block' }}>\r\n              Custom Color:\r\n            </label>\r\n            <input\r\n              id=\"custom-color-input\"\r\n              type=\"color\"\r\n              value={currentColor || '#000000'}\r\n              onChange={handleCustomColorChange}\r\n              style={{\r\n                width: '100%',\r\n                height: '32px',\r\n                border: '1px solid #ccc',\r\n                borderRadius: '3px',\r\n                cursor: 'pointer'\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nColorPickerDropdown.propTypes = {\r\n  currentColor: PropTypes.string,\r\n  onColorSelect: PropTypes.func.isRequired,\r\n  title: PropTypes.string\r\n};\r\n\r\nexport default ColorPickerDropdown;","import PropTypes from 'prop-types';\r\nimport { \r\n  Bold, \r\n  Italic, \r\n  Underline, \r\n  Strikethrough,\r\n  AlignLeft,\r\n  AlignCenter,\r\n  AlignRight,\r\n  AlignJustify,\r\n  List,\r\n  ListOrdered,\r\n  Link,\r\n  Table,\r\n  FileText,\r\n  Undo,\r\n  Redo,\r\n  Image as ImageIcon,\r\n  Indent,\r\n  Outdent\r\n} from 'lucide-react';\r\nimport { deleteImage, saveImage, getImage } from '../../lib/storage/index-db';\r\nimport { logger } from '../../lib/editor/utils/logger';\r\nimport { COMMON_FONT_SIZES, DEFAULT_FONT_SIZE } from '../../lib/editor/font-sizes';\r\nimport { indentSelectedBlocks } from '../../lib/editor/indentation-utils';\r\nimport ColorPickerDropdown from './ColorPickerDropdown';\r\n\r\n// Constants for toolbar options\r\nconst FONT_FAMILIES = [\r\n  // English Fonts\r\n  { value: 'Segoe UI', label: 'Segoe UI' },\r\n  { value: 'Arial', label: 'Arial' },\r\n  { value: 'Times New Roman', label: 'Times New Roman' },\r\n  { value: 'Courier New', label: 'Courier New' },\r\n  { value: 'Georgia', label: 'Georgia' },\r\n  { value: 'Verdana', label: 'Verdana' },\r\n  // Sinhala Fonts\r\n  { value: 'Noto Sans Sinhala', label: 'Noto Sans Sinhala' },\r\n  { value: 'Iskoola Pota', label: 'Iskoola Pota' },\r\n  // Tamil Fonts\r\n  { value: 'Noto Sans Tamil', label: 'Noto Sans Tamil' },\r\n  // Unicode Fonts\r\n  { value: 'Noto Sans', label: 'Noto Sans' }\r\n];\r\n\r\nconst HEADING_LEVELS = [\r\n  { value: 'p', label: 'Normal' },\r\n  { value: 'h1', label: 'Heading 1' },\r\n  { value: 'h2', label: 'Heading 2' },\r\n  { value: 'h3', label: 'Heading 3' },\r\n  { value: 'h4', label: 'Heading 4' },\r\n  { value: 'h5', label: 'Heading 5' },\r\n  { value: 'h6', label: 'Heading 6' }\r\n];\r\n\r\nconst DEFAULT_TABLE_HTML = '<table border=\"1\"><tr><th>Header 1</th><th>Header 2</th></tr><tr><td>Cell 3</td><td>Cell 4</td></tr></table>';\r\n\r\n/**\r\n * EditorToolbar - Formatting toolbar for the multi-page editor\r\n * Provides text formatting, alignment, lists, links, tables, and image insertion\r\n */\r\nconst EditorToolbar = ({ \r\n  currentFormat, \r\n  onFormatText, \r\n  onAddPageBreak,\r\n  onInsertImage,\r\n  canUndo = false,\r\n  canRedo = false\r\n}) => {\r\n  /**\r\n   * Render a button with optional active state\r\n   */\r\n  const renderButton = (onClick, Icon, title, formatKey = null, disabled = false) => (\r\n    <button \r\n      key={title}\r\n      onClick={onClick} \r\n      className={formatKey && currentFormat[formatKey] ? 'active' : ''} \r\n      disabled={disabled}\r\n      title={title}\r\n      style={{ opacity: disabled ? 0.5 : 1 }}\r\n    >\r\n      <Icon size={16} />\r\n    </button>\r\n  );\r\n\r\n  /**\r\n   * Render a separator\r\n   */\r\n  const renderSeparator = () => <div className=\"toolbar-separator\" />;\r\n\r\n  /**\r\n   * Handle image upload\r\n   */\r\n  const handleImageUpload = async (file) => {\r\n    try {\r\n      const validTypes = ['image/png', 'image/jpeg', 'image/gif', 'image/webp'];\r\n      if (!validTypes.includes(file.type)) {\r\n        alert('Invalid image format. Supported: PNG, JPEG, GIF, WEBP');\r\n        return;\r\n      }\r\n\r\n      if (file.size > 5 * 1024 * 1024) {\r\n        alert('Image exceeds maximum size of 5MB');\r\n        return;\r\n      }\r\n\r\n      const key = await saveImage(file);\r\n      const imageUrl = await getImage(key);\r\n      \r\n      if (imageUrl && onInsertImage) {\r\n        const imageHtml = `<img src=\"${imageUrl}\" data-key=\"${key}\" alt=\"Inserted image\" />`;\r\n        onInsertImage(imageHtml);\r\n      } else {\r\n        logger.warn('Failed to insert image: missing URL or callback');\r\n      }\r\n      \r\n      // Reset file input to allow re-uploading the same file\r\n      document.getElementById('image-upload').value = '';\r\n    } catch (error) {\r\n      logger.error('Error uploading image', error);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle indent button click\r\n   */\r\n  const handleIndent = () => {\r\n    const success = indentSelectedBlocks(false);\r\n    if (!success) {\r\n      // If no blocks selected, insert indentation at cursor\r\n      document.execCommand('insertHTML', false, '&nbsp;&nbsp;&nbsp;&nbsp;');\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle outdent button click\r\n   */\r\n  const handleOutdent = () => {\r\n    indentSelectedBlocks(true);\r\n  };\r\n\r\n  /**\r\n   * Handle link insertion\r\n   */\r\n  const handleInsertLink = () => {\r\n    const url = prompt('Enter URL:');\r\n    if (url) onFormatText('createLink', url);\r\n  };\r\n\r\n  /**\r\n   * Handle image button click\r\n   */\r\n  const handleImageButtonClick = () => {\r\n    document.getElementById('image-upload').click();\r\n  };\r\n\r\n  return (\r\n    <div className=\"editor-toolbar\">\r\n      {/* Undo/Redo */}\r\n      {renderButton(() => onFormatText('undo'), Undo, 'Undo', null, !canUndo)}\r\n      {renderButton(() => onFormatText('redo'), Redo, 'Redo', null, !canRedo)}\r\n      \r\n      {renderSeparator()}\r\n      \r\n      {/* Text Formatting */}\r\n      {renderButton(() => onFormatText('bold'), Bold, 'Bold', 'bold')}\r\n      {renderButton(() => onFormatText('italic'), Italic, 'Italic', 'italic')}\r\n      {renderButton(() => onFormatText('underline'), Underline, 'Underline', 'underline')}\r\n      {renderButton(() => onFormatText('strikethrough'), Strikethrough, 'Strikethrough', 'strikethrough')}\r\n      \r\n      {renderSeparator()}\r\n      \r\n      {/* Alignment */}\r\n      {renderButton(() => onFormatText('justifyLeft'), AlignLeft, 'Align Left', 'alignLeft')}\r\n      {renderButton(() => onFormatText('justifyCenter'), AlignCenter, 'Align Center', 'alignCenter')}\r\n      {renderButton(() => onFormatText('justifyRight'), AlignRight, 'Align Right', 'alignRight')}\r\n      {renderButton(() => onFormatText('justifyFull'), AlignJustify, 'Justify', 'alignJustify')}\r\n      \r\n      {renderSeparator()}\r\n      \r\n      {/* Font Controls */}\r\n      <select \r\n        onChange={(e) => onFormatText('fontName', e.target.value)}\r\n        value={currentFormat.fontFamily || 'Segoe UI'}\r\n        title=\"Font Family\"\r\n      >\r\n        {FONT_FAMILIES.map(({ value, label }) => (\r\n          <option key={value} value={value}>\r\n            {label}\r\n          </option>\r\n        ))}\r\n      </select>\r\n      \r\n      <select \r\n        onChange={(e) => onFormatText('fontSize', e.target.value)}\r\n        value={currentFormat.fontSize || DEFAULT_FONT_SIZE}\r\n        title=\"Font Size\"\r\n      >\r\n        {COMMON_FONT_SIZES.map(({ value, label }) => (\r\n          <option key={value} value={value}>\r\n            {label}\r\n          </option>\r\n        ))}\r\n      </select>\r\n      \r\n      <ColorPickerDropdown\r\n        currentColor={currentFormat.fontColor}\r\n        onColorSelect={(color) => onFormatText('foreColor', color)}\r\n        title=\"Font Color\"\r\n      />\r\n      \r\n      <select \r\n        onChange={(e) => onFormatText('formatBlock', e.target.value)}\r\n        value={currentFormat.headingLevel || 'p'}\r\n        title=\"Heading Level\"\r\n      >\r\n        {HEADING_LEVELS.map(({ value, label }) => (\r\n          <option key={value} value={value}>\r\n            {label}\r\n          </option>\r\n        ))}\r\n      </select>\r\n      \r\n      {renderSeparator()}\r\n      \r\n      {/* Lists */}\r\n      {renderButton(() => onFormatText('insertUnorderedList'), List, 'Bullet List')}\r\n      {renderButton(() => onFormatText('insertOrderedList'), ListOrdered, 'Numbered List')}\r\n      \r\n      {renderSeparator()}\r\n      \r\n      {/* Indentation */}\r\n      <button \r\n        onClick={handleIndent} \r\n        title=\"Increase Indent (Tab)\"\r\n      >\r\n        <Indent size={16} />\r\n      </button>\r\n      <button \r\n        onClick={handleOutdent} \r\n        title=\"Decrease Indent (Shift+Tab)\"\r\n      >\r\n        <Outdent size={16} />\r\n      </button>\r\n      \r\n      {renderSeparator()}\r\n      \r\n      {/* Links and Tables */}\r\n      <button \r\n        onClick={handleInsertLink} \r\n        title=\"Insert Link\"\r\n      >\r\n        <Link size={16} />\r\n      </button>\r\n      {renderButton(() => onFormatText('insertHTML', DEFAULT_TABLE_HTML), Table, 'Insert Table')}\r\n      \r\n      {onAddPageBreak && renderButton(onAddPageBreak, FileText, 'Insert Page Break')}\r\n      \r\n      {renderSeparator()}\r\n      \r\n      {/* Images */}\r\n      <input \r\n        type=\"file\" \r\n        accept=\"image/*\" \r\n        onChange={(e) => e.target.files[0] && handleImageUpload(e.target.files[0])}\r\n        style={{ display: 'none' }}\r\n        id=\"image-upload\"\r\n      />\r\n      <button \r\n        onClick={handleImageButtonClick} \r\n        title=\"Insert Image\"\r\n      >\r\n        <ImageIcon size={16} />\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nEditorToolbar.propTypes = {\r\n  currentFormat: PropTypes.shape({\r\n    bold: PropTypes.bool,\r\n    italic: PropTypes.bool,\r\n    underline: PropTypes.bool,\r\n    strikethrough: PropTypes.bool,\r\n    alignLeft: PropTypes.bool,\r\n    alignCenter: PropTypes.bool,\r\n    alignRight: PropTypes.bool,\r\n    alignJustify: PropTypes.bool,\r\n    fontFamily: PropTypes.string,\r\n    fontSize: PropTypes.string,\r\n    fontColor: PropTypes.string,\r\n    headingLevel: PropTypes.string\r\n  }).isRequired,\r\n  onFormatText: PropTypes.func.isRequired,\r\n  onAddPageBreak: PropTypes.func,\r\n  onInsertImage: PropTypes.func,\r\n  canUndo: PropTypes.bool,\r\n  canRedo: PropTypes.bool\r\n};\r\n\r\nEditorToolbar.defaultProps = {\r\n  onAddPageBreak: undefined,\r\n  onInsertImage: undefined,\r\n  canUndo: false,\r\n  canRedo: false\r\n};\r\n\r\nexport default EditorToolbar;\r\n","/**\r\n * Paste utilities for processing pasted content in the HTML editor\r\n * Handles conversion of div tags to p tags and proper paragraph structure\r\n */\r\n\r\nimport { normalizeContent } from './content-normalize-utils.js';\r\n\r\n/**\r\n * Processes pasted HTML content to ensure proper paragraph structure\r\n * Converts div tags to p tags and handles line breaks appropriately\r\n * @param {string} htmlContent - The raw HTML content from clipboard\r\n * @returns {string} Processed HTML content with proper paragraph tags\r\n */\r\nexport function processPastedContent(htmlContent) {\r\n  if (!htmlContent || typeof htmlContent !== 'string') {\r\n    return htmlContent;\r\n  }\r\n\r\n  // Use the comprehensive normalizeContent function for proper HTML structure\r\n  return normalizeContent(htmlContent);\r\n}\r\n\r\n/**\r\n * Handles paste event for contenteditable\r\n * @param {ClipboardEvent} event - The paste event\r\n * @returns {string|null} Processed HTML content to insert, or null to allow default behavior\r\n */\r\nexport function handlePaste(event) {\r\n  // Prevent default paste behavior\r\n  event.preventDefault();\r\n\r\n  // Get pasted content\r\n  const clipboardData = event.clipboardData || window.clipboardData;\r\n  if (!clipboardData) {\r\n    return null;\r\n  }\r\n\r\n  // Try to get HTML content first, fall back to plain text\r\n  let pastedContent = clipboardData.getData('text/html') || clipboardData.getData('text/plain');\r\n\r\n  if (!pastedContent) {\r\n    return null;\r\n  }\r\n\r\n  // If we got plain text, convert it to HTML with proper paragraph structure\r\n  if (!clipboardData.getData('text/html')) {\r\n    pastedContent = convertPlainTextToHtml(pastedContent);\r\n  } else {\r\n    // Process HTML content using comprehensive normalization\r\n    pastedContent = processPastedContent(pastedContent);\r\n  }\r\n\r\n  // Insert the processed content\r\n  document.execCommand('insertHTML', false, pastedContent);\r\n\r\n  return pastedContent;\r\n}\r\n\r\n/**\r\n * Converts plain text to HTML with proper paragraph structure\r\n * @param {string} text - Plain text content\r\n * @returns {string} HTML content with paragraphs\r\n */\r\nfunction convertPlainTextToHtml(text) {\r\n  if (!text) return '';\r\n\r\n  // Split by double newlines (paragraph breaks) and single newlines\r\n  const paragraphs = text.split(/\\n\\s*\\n/).filter(p => p.trim());\r\n\r\n  if (paragraphs.length === 0) {\r\n    return '<p><br></p>';\r\n  }\r\n\r\n  return paragraphs.map(paragraph => {\r\n    // Handle single lines within paragraphs\r\n    const lines = paragraph.split('\\n').filter(line => line.trim());\r\n    if (lines.length === 0) {\r\n      return '<p><br></p>';\r\n    }\r\n\r\n    // Join lines with line breaks, but wrap in paragraph\r\n    const content = lines.map(line => escapeHtml(line.trim())).join('<br>');\r\n    return `<p>${content}</p>`;\r\n  }).join('');\r\n}\r\n\r\n/**\r\n * Escapes HTML special characters\r\n * @param {string} text - Text to escape\r\n * @returns {string} Escaped HTML text\r\n */\r\nfunction escapeHtml(text) {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}","import { useCallback, useMemo, memo } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { DEFAULT_FONT_SIZE } from '../../lib/editor/font-sizes';\r\nimport { getMarginPixels, DEFAULT_MARGIN_PRESET } from '../../lib/editor/margin-utils';\r\nimport { handlePaste as processPasteEvent } from '../../lib/editor/paste-utils';\r\nimport { handleTabIndentation } from '../../lib/editor/indentation-utils';\r\n\r\n// Constants for page break remove button dimensions\r\nconst REMOVE_BUTTON_WIDTH = 20;\r\nconst REMOVE_BUTTON_HEIGHT = 20;\r\nconst REMOVE_BUTTON_OFFSET_RIGHT = 20;\r\nconst REMOVE_BUTTON_OFFSET_TOP = -12;\r\n\r\n// Style constants\r\nconst EDITOR_CONTAINER_STYLE = {\r\n  position: 'relative',\r\n  width: '100%',\r\n  maxWidth: '100%',\r\n  margin: '40px auto',\r\n  backgroundColor: 'transparent',\r\n  minHeight: '100vh'\r\n};\r\n\r\nconst CONTENT_EDITABLE_STYLE = {\r\n  position: 'relative',\r\n  zIndex: 1,\r\n  backgroundColor: 'white',\r\n  outline: 'none',\r\n  cursor: 'text',\r\n  fontFamily: '\"Segoe UI\", \"Noto Sans Sinhala\", \"Noto Sans\", \"Malithi Web\", \"Iskoola Pota\", \"Kaputa Unicode\", \"Helvetica Neue\", Arial, \"Hiragino Sans GB\", \"WenQuanYi Micro Hei\", \"Microsoft YaHei\", sans-serif',\r\n  fontSize: DEFAULT_FONT_SIZE,\r\n  lineHeight: '1.4',\r\n  color: '#333',\r\n  wordWrap: 'break-word',\r\n  whiteSpace: 'pre-wrap',\r\n  overflowWrap: 'break-word',\r\n  border: '1px solid #e0e0e0',\r\n  boxSizing: 'border-box',\r\n  boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)'\r\n};\r\n\r\n/**\r\n * Helper function to set cursor position at the start or end of an element\r\n */\r\nconst setCursorAtElement = (element, atStart = true) => {\r\n  if (!element) return;\r\n  \r\n  const range = document.createRange();\r\n  const sel = window.getSelection();\r\n  \r\n  if (atStart) {\r\n    range.setStart(element, 0);\r\n    range.collapse(true);\r\n  } else {\r\n    range.selectNodeContents(element);\r\n    range.collapse(false);\r\n  }\r\n  \r\n  sel.removeAllRanges();\r\n  sel.addRange(range);\r\n};\r\n\r\n/**\r\n * Check if typing should be prevented on page-break elements\r\n */\r\nconst shouldPreventTypingOnPageBreak = (event, startContainer, endContainer) => {\r\n  if (isPageBreakElement(startContainer) || isPageBreakElement(endContainer)) {\r\n    if (event.key.length === 1 || event.key === 'Enter' || event.key === ' ') {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\n/**\r\n * Check if deletion should be prevented on page-break elements\r\n */\r\nconst shouldPreventDeletionOnPageBreak = (event, startContainer, endContainer) => {\r\n  if (event.key === 'Backspace' || event.key === 'Delete') {\r\n    if (isPageBreakElement(startContainer) || isPageBreakElement(endContainer)) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\n/**\r\n * Helper function to check if element is or contains a page-break\r\n */\r\nconst isPageBreakElement = (node) => {\r\n  if (!node) return false;\r\n  if (node.nodeType === Node.ELEMENT_NODE) {\r\n    return node.tagName === 'PAGE-BREAK' || node.getAttribute('data-page-break') === 'true';\r\n  }\r\n  return node.parentElement && isPageBreakElement(node.parentElement);\r\n};\r\n\r\n/**\r\n * PageView - MS Word-like continuous contenteditable surface\r\n * Single contenteditable div with manual page breaks using <page-break> tags\r\n * Content flows continuously with explicit page boundaries\r\n * Supports zoom scaling via CSS transform\r\n */\r\nconst PageView = ({ \r\n  dimensions, \r\n  editorRef,\r\n  onInput,\r\n  onContentChange,\r\n  onKeyDown,\r\n  onClick,\r\n  onScroll,\r\n  onPaste,\r\n  onRemovePageBreak,\r\n  zoomLevel = 100,\r\n  pageMargins = DEFAULT_MARGIN_PRESET\r\n}) => {\r\n  // Memoize padding calculation\r\n  const padding = useMemo(() => getMarginPixels(pageMargins), [pageMargins]);\r\n\r\n  // Calculate zoom multiplier\r\n  const zoomMultiplier = zoomLevel / 100;\r\n\r\n  // Helper function to check if cursor is in padding area\r\n  const isInPaddingArea = useCallback((element, clientY) => {\r\n    if (!element) return false;\r\n    \r\n    const rect = element.getBoundingClientRect();\r\n    const relativeY = clientY - rect.top;\r\n    \r\n    // Check if in top or bottom padding\r\n    if (relativeY < padding.top || relativeY > (rect.height - padding.bottom)) {\r\n      return true;\r\n    }\r\n    \r\n    return false;\r\n  }, [padding.top, padding.bottom]);\r\n\r\n  // Handle page-break click logic\r\n  const handlePageBreakClick = useCallback((clickedElement, event) => {\r\n    event.preventDefault();\r\n    \r\n    // Check if click is in the remove button area (top-right corner)\r\n    const rect = clickedElement.getBoundingClientRect();\r\n    const relativeX = event.clientX - rect.left;\r\n    const relativeY = event.clientY - rect.top;\r\n    \r\n    // Remove button dimensions and positioning\r\n    const removeButtonLeft = rect.width - REMOVE_BUTTON_OFFSET_RIGHT - REMOVE_BUTTON_WIDTH;\r\n    const removeButtonTop = REMOVE_BUTTON_OFFSET_TOP;\r\n    const removeButtonRight = rect.width - REMOVE_BUTTON_OFFSET_RIGHT;\r\n    const removeButtonBottom = REMOVE_BUTTON_OFFSET_TOP + REMOVE_BUTTON_HEIGHT;\r\n    \r\n    // Check if click is within the remove button area\r\n    if (relativeX >= removeButtonLeft && \r\n        relativeX <= removeButtonRight && \r\n        relativeY >= removeButtonTop && \r\n        relativeY <= removeButtonBottom) {\r\n      // Click is on remove button\r\n      if (onRemovePageBreak) {\r\n        onRemovePageBreak(clickedElement);\r\n      }\r\n    }\r\n  }, [onRemovePageBreak]);\r\n\r\n  // Handle padding click logic\r\n  const handlePaddingClick = useCallback((event) => {\r\n    event.preventDefault();\r\n    \r\n    // Move cursor to the nearest valid content area\r\n    const rect = editorRef.current.getBoundingClientRect();\r\n    const relativeY = event.clientY - rect.top;\r\n    \r\n    if (relativeY < padding.top) {\r\n      // Click was in top padding - move to first content element\r\n      const firstChild = editorRef.current.firstElementChild;\r\n      if (firstChild && firstChild.tagName !== 'PAGE-BREAK') {\r\n        setCursorAtElement(firstChild, true);\r\n      }\r\n    } else {\r\n      // Click was in bottom padding - move to last content element\r\n      const lastChild = editorRef.current.lastElementChild;\r\n      if (lastChild && lastChild.tagName !== 'PAGE-BREAK') {\r\n        setCursorAtElement(lastChild, false);\r\n      }\r\n    }\r\n  }, [editorRef, padding.top]);\r\n\r\n  // Prevent deletion of page-break elements and handle Tab key\r\n  const handleKeyDown = useCallback((event) => {\r\n    const selection = window.getSelection();\r\n    if (!selection || selection.rangeCount === 0) return;\r\n\r\n    const range = selection.getRangeAt(0);\r\n    const { startContainer, endContainer } = range;\r\n\r\n    // Prevent typing on page-break elements\r\n    if (shouldPreventTypingOnPageBreak(event, startContainer, endContainer)) {\r\n      event.preventDefault();\r\n      return false;\r\n    }\r\n\r\n    // Handle Tab key for indentation (multi-line or single line)\r\n    if (handleTabIndentation(event)) {\r\n      // Update content after indentation\r\n      if (onContentChange) {\r\n        onContentChange();\r\n      }\r\n      return false;\r\n    }\r\n\r\n    // Prevent deletion of page-break elements\r\n    if (shouldPreventDeletionOnPageBreak(event, startContainer, endContainer)) {\r\n      event.preventDefault();\r\n      return false;\r\n    }\r\n\r\n    if (onKeyDown) {\r\n      onKeyDown(event);\r\n    }\r\n  }, [onKeyDown, onContentChange]);\r\n\r\n  // Handle click events to prevent cursor placement in padding areas\r\n  const handleClick = useCallback((event) => {\r\n    if (!editorRef.current) return;\r\n\r\n    const clickedElement = event.target;\r\n    \r\n    // Check if click is on a page-break element\r\n    if (isPageBreakElement(clickedElement)) {\r\n      handlePageBreakClick(clickedElement, event);\r\n      return;\r\n    }\r\n\r\n    // Check if click is in padding area\r\n    if (isInPaddingArea(editorRef.current, event.clientY)) {\r\n      handlePaddingClick(event);\r\n      return;\r\n    }\r\n\r\n    if (onClick) {\r\n      onClick(event);\r\n    }\r\n  }, [editorRef, onClick, handlePageBreakClick, handlePaddingClick, isInPaddingArea]);\r\n\r\n  // Prevent input in padding areas and on page breaks\r\n  const handleBeforeInput = useCallback((event) => {\r\n    const selection = window.getSelection();\r\n    if (!selection || selection.rangeCount === 0) return;\r\n\r\n    const range = selection.getRangeAt(0);\r\n    const { startContainer } = range;\r\n\r\n    // Prevent input on page-break elements\r\n    if (isPageBreakElement(startContainer)) {\r\n      event.preventDefault();\r\n      return false;\r\n    }\r\n  }, []);\r\n\r\n  // Handle paste events with custom processing\r\n  const handlePaste = useCallback((event) => {\r\n    // Use the custom paste handler from utils\r\n    const processedContent = processPasteEvent(event);\r\n    \r\n    // Call parent onPaste callback if provided\r\n    if (onPaste) {\r\n      onPaste(event, processedContent);\r\n    }\r\n  }, [onPaste]);\r\n\r\n  return (\r\n    <div \r\n      className=\"continuous-page-container\"\r\n      style={{\r\n        ...EDITOR_CONTAINER_STYLE,\r\n        maxWidth: `${dimensions.width}px`,\r\n        transform: `scale(${zoomMultiplier})`,\r\n        transformOrigin: 'top center',\r\n        transition: 'transform 0.2s ease-out'\r\n      }}\r\n    >\r\n      {/* Continuous contenteditable surface with page styling */}\r\n      <div\r\n        ref={editorRef}\r\n        contentEditable={true}\r\n        suppressContentEditableWarning={true}\r\n        className=\"continuous-content\"\r\n        style={{\r\n          ...CONTENT_EDITABLE_STYLE,\r\n          minHeight: `${dimensions.height}px`,\r\n          width: `${dimensions.width}px`,\r\n          padding: `${padding.top}px ${padding.right}px ${padding.bottom}px ${padding.left}px`\r\n        }}\r\n        onInput={onInput}\r\n        onKeyDown={handleKeyDown}\r\n        onBeforeInput={handleBeforeInput}\r\n        onClick={handleClick}\r\n        onScroll={onScroll}\r\n        onPaste={handlePaste}\r\n        data-testid=\"continuous-editor\"\r\n      >\r\n        {/* Content is set via innerHTML in parent component */}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nPageView.propTypes = {\r\n  dimensions: PropTypes.shape({\r\n    width: PropTypes.number.isRequired,\r\n    height: PropTypes.number.isRequired\r\n  }).isRequired,\r\n  editorRef: PropTypes.shape({\r\n    current: PropTypes.instanceOf(typeof Element !== 'undefined' ? Element : Object)\r\n  }).isRequired,\r\n  onInput: PropTypes.func.isRequired,\r\n  onContentChange: PropTypes.func,\r\n  onKeyDown: PropTypes.func,\r\n  onClick: PropTypes.func,\r\n  onScroll: PropTypes.func,\r\n  onPaste: PropTypes.func,\r\n  onRemovePageBreak: PropTypes.func,\r\n  zoomLevel: PropTypes.number,\r\n  pageMargins: PropTypes.string\r\n};\r\n\r\nPageView.defaultProps = {\r\n  zoomLevel: 100,\r\n  pageMargins: DEFAULT_MARGIN_PRESET\r\n};\r\n\r\nexport default memo(PageView);\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { FileText, Plus, X, Settings, ZoomIn, ZoomOut } from 'lucide-react';\r\nimport { MARGIN_PRESETS, getMarginPresetNames, getMarginPresetLabel, DEFAULT_MARGIN_PRESET } from '../../lib/editor/margin-utils';\r\n\r\n/**\r\n * PageManager Component - Standalone Component\r\n * \r\n * COMPLETELY INDEPENDENT - can be used with or without the editor\r\n * Accepts all state as props, uses callbacks for all actions\r\n * Perfect for external apps that want to provide their own PageManager UI\r\n * \r\n * @param {Object} props - Component props\r\n * @param {Array} props.pageBoundaries - Array of page boundary objects [{id, pageNumber, top, height}, ...]\r\n * @param {number} props.activePage - Current active page index (0-based)\r\n * @param {string} props.pageSize - Current page size ('A4', 'Letter', or 'Legal')\r\n * @param {string} props.pageMargins - Current page margin preset ('NORMAL', 'NARROW', etc.)\r\n * @param {number} props.zoomLevel - Current zoom level (50-200)\r\n * @param {boolean} props.canZoomIn - Whether zoom in is allowed\r\n * @param {boolean} props.canZoomOut - Whether zoom out is allowed\r\n * @param {Function} props.onNavigate - Callback when page changes (pageIndex)\r\n * @param {Function} props.onAddPage - Callback when page is added\r\n * @param {Function} props.onDeletePage - Callback when page is deleted (pageIndex)\r\n * @param {Function} props.onPageSizeChange - Callback when page size changes (newSize)\r\n * @param {Function} props.onPageMarginsChange - Callback when page margins change (newMargins)\r\n * @param {Function} props.onZoomIn - Callback when zoom in is clicked\r\n * @param {Function} props.onZoomOut - Callback when zoom out is clicked\r\n * @param {Function} props.onZoomReset - Callback when zoom reset is clicked\r\n */\r\nexport const PageManager = ({ \r\n  pageBoundaries = [{ id: 'page-0', pageNumber: 1 }],\r\n  activePage = 0,\r\n  pageSize = 'A4',\r\n  pageMargins = DEFAULT_MARGIN_PRESET,\r\n  zoomLevel = 100,\r\n  canZoomIn = true,\r\n  canZoomOut = true,\r\n  onNavigate, \r\n  onAddPage,\r\n  onDeletePage,\r\n  onPageSizeChange,\r\n  onPageMarginsChange,\r\n  onZoomIn,\r\n  onZoomOut,\r\n  onZoomReset\r\n} = {}) => {\r\n  // Ensure we always have at least one page\r\n  const totalPages = Math.max(pageBoundaries?.length || 0, 1);\r\n\r\n  const handleDeletePage = (pageIndex) => {\r\n    if (totalPages <= 1) {\r\n      console.warn('[PageManager] Cannot delete the only page');\r\n      return;\r\n    }\r\n    \r\n    // Delegate to parent callback\r\n    onDeletePage?.(pageIndex);\r\n  };\r\n\r\n  return (\r\n    <div className=\"page-manager\">\r\n      {/* Page Settings Group - Size and Margins together */}\r\n      <div className=\"page-settings-group\">\r\n        <div className=\"page-settings-header\">\r\n          <Settings size={14} style={{ marginRight: '4px', verticalAlign: 'middle' }} />\r\n          Page Settings\r\n        </div>\r\n        <div className=\"page-settings-controls\">\r\n          <div className=\"page-setting-item\">\r\n            <label htmlFor=\"page-size-selector\">Size:</label>\r\n            <select\r\n              id=\"page-size-selector\"\r\n              role=\"combobox\"\r\n              aria-label=\"Page size selector\"\r\n              value={pageSize}\r\n              onChange={(e) => onPageSizeChange?.(e.target.value)}\r\n            >\r\n              <option value=\"A4\">A4</option>\r\n              <option value=\"Letter\">Letter</option>\r\n              <option value=\"Legal\">Legal</option>\r\n            </select>\r\n          </div>\r\n          <div className=\"page-setting-item\">\r\n            <label htmlFor=\"page-margins-selector\">Margins:</label>\r\n            <select\r\n              id=\"page-margins-selector\"\r\n              role=\"combobox\"\r\n              aria-label=\"Page margins selector\"\r\n              value={pageMargins}\r\n              onChange={(e) => onPageMarginsChange?.(e.target.value)}\r\n            >\r\n              {getMarginPresetNames().map((presetName) => (\r\n                <option key={presetName} value={presetName}>\r\n                  {getMarginPresetLabel(presetName)}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Compact Zoom Controls */}\r\n      <div className=\"zoom-controls-compact\">\r\n        <button\r\n          type=\"button\"\r\n          className=\"zoom-button-compact\"\r\n          onClick={onZoomOut}\r\n          disabled={!canZoomOut}\r\n          aria-label=\"Zoom out\"\r\n          title=\"Zoom out (Ctrl + -)\"\r\n        >\r\n          <ZoomOut size={12} />\r\n        </button>\r\n        <span className=\"zoom-level-display\">{zoomLevel}%</span>\r\n        <button\r\n          type=\"button\"\r\n          className=\"zoom-button-compact\"\r\n          onClick={onZoomIn}\r\n          disabled={!canZoomIn}\r\n          aria-label=\"Zoom in\"\r\n          title=\"Zoom in (Ctrl + +)\"\r\n        >\r\n          <ZoomIn size={12} />\r\n        </button>\r\n        <button\r\n          type=\"button\"\r\n          className=\"zoom-reset-compact\"\r\n          onClick={onZoomReset}\r\n          aria-label=\"Reset zoom\"\r\n          title=\"Reset zoom to 100% (Ctrl + 0)\"\r\n        >\r\n          Reset\r\n        </button>\r\n      </div>\r\n\r\n      {/* Page List */}\r\n      <div className=\"page-list\">\r\n        {pageBoundaries.map((boundary, index) => (\r\n          <div key={boundary.id || `page-${index}`} className=\"page-item\">\r\n            <button\r\n              type=\"button\"\r\n              className={`page-button ${index === activePage ? 'active' : ''}`}\r\n              onClick={() => onNavigate?.(index)}\r\n              aria-label={`Go to page ${index + 1}`}\r\n              aria-current={index === activePage ? 'page' : undefined}\r\n            >\r\n              <FileText size={14} />\r\n              <span>Page {index + 1}</span>\r\n            </button>\r\n            {/* Show delete button for all pages when more than 1 page exists */}\r\n            {totalPages > 1 && (\r\n              <button\r\n                type=\"button\"\r\n                className=\"delete-page-button\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  handleDeletePage(index);\r\n                }}\r\n                aria-label={`Delete page ${index + 1}`}\r\n                title=\"Delete this page and its content\"\r\n              >\r\n                <X size={14} />\r\n              </button>\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n      \r\n      {/* Add Page Button */}\r\n      <button\r\n        type=\"button\"\r\n        className=\"add-page-button\"\r\n        onClick={() => onAddPage?.()}\r\n        aria-label=\"Add new page\"\r\n        title=\"Add new page at end\"\r\n      >\r\n        <Plus size={16} />\r\n        <span>Add Page</span>\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nPageManager.propTypes = {\r\n  pageBoundaries: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      id: PropTypes.string.isRequired,\r\n      pageNumber: PropTypes.number.isRequired,\r\n      top: PropTypes.number,\r\n      height: PropTypes.number\r\n    })\r\n  ),\r\n  activePage: PropTypes.number,\r\n  pageSize: PropTypes.oneOf(['A4', 'Letter', 'Legal']),\r\n  pageMargins: PropTypes.string,\r\n  zoomLevel: PropTypes.number,\r\n  canZoomIn: PropTypes.bool,\r\n  canZoomOut: PropTypes.bool,\r\n  onNavigate: PropTypes.func,\r\n  onAddPage: PropTypes.func,\r\n  onDeletePage: PropTypes.func,\r\n  onPageSizeChange: PropTypes.func,\r\n  onPageMarginsChange: PropTypes.func,\r\n  onZoomIn: PropTypes.func,\r\n  onZoomOut: PropTypes.func,\r\n  onZoomReset: PropTypes.func\r\n};\r\n\r\nexport default React.memo(PageManager);","import React, { useEffect, useRef, useCallback } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useDocumentActions } from '../../context/DocumentContext';\r\nimport {\r\n  isResizableImage,\r\n  createResizeOverlay,\r\n  removeResizeOverlay,\r\n  updateResizeOverlay,\r\n  RESIZE_HANDLERS,\r\n  DEFAULT_IMAGE_RESIZE_OPTIONS\r\n} from '../../lib/editor/image-resize-utils';\r\n\r\n// Constants for keyboard shortcuts and defaults\r\nconst KEYBOARD_RESIZE_STEP = 10;\r\nconst DEFAULT_RESET_WIDTH = 300;\r\nconst DEFAULT_RESET_HEIGHT = 200;\r\nconst MUTATION_OBSERVER_DELAY = 50;\r\n\r\n/**\r\n * Helper function to get cursor for handler\r\n */\r\nfunction getCursorForHandler(handler) {\r\n  switch (handler) {\r\n    case RESIZE_HANDLERS.TOP_LEFT:\r\n    case RESIZE_HANDLERS.BOTTOM_RIGHT:\r\n      return 'nwse-resize';\r\n    case RESIZE_HANDLERS.TOP_RIGHT:\r\n    case RESIZE_HANDLERS.BOTTOM_LEFT:\r\n      return 'nesw-resize';\r\n    case RESIZE_HANDLERS.TOP:\r\n    case RESIZE_HANDLERS.BOTTOM:\r\n      return 'ns-resize';\r\n    case RESIZE_HANDLERS.LEFT:\r\n    case RESIZE_HANDLERS.RIGHT:\r\n      return 'ew-resize';\r\n    default:\r\n      return 'default';\r\n  }\r\n}\r\n\r\n/**\r\n * Apply aspect ratio constraints to dimensions\r\n */\r\nfunction applyAspectRatioConstraints(newWidth, newHeight, startWidth, startHeight, handler, options) {\r\n  if (!options.preserveAspectRatio) return { width: newWidth, height: newHeight };\r\n\r\n  const aspectRatio = startWidth / startHeight;\r\n\r\n  // For corner handlers, maintain aspect ratio\r\n  if ([RESIZE_HANDLERS.TOP_LEFT, RESIZE_HANDLERS.TOP_RIGHT,\r\n       RESIZE_HANDLERS.BOTTOM_LEFT, RESIZE_HANDLERS.BOTTOM_RIGHT].includes(handler)) {\r\n    // Use the larger dimension to maintain aspect ratio\r\n    if (newWidth / aspectRatio > newHeight) {\r\n      newHeight = newWidth / aspectRatio;\r\n    } else {\r\n      newWidth = newHeight * aspectRatio;\r\n    }\r\n  }\r\n  // For edge handlers, maintain aspect ratio\r\n  else if ([RESIZE_HANDLERS.TOP, RESIZE_HANDLERS.BOTTOM].includes(handler)) {\r\n    newWidth = newHeight * aspectRatio;\r\n  } else if ([RESIZE_HANDLERS.LEFT, RESIZE_HANDLERS.RIGHT].includes(handler)) {\r\n    newHeight = newWidth / aspectRatio;\r\n  }\r\n\r\n  return { width: newWidth, height: newHeight };\r\n}\r\n\r\n/**\r\n * Helper function to calculate resize dimensions\r\n */\r\nfunction calculateResizeDimensions({\r\n  handler,\r\n  startX,\r\n  startY,\r\n  currentX,\r\n  currentY,\r\n  startWidth,\r\n  startHeight,\r\n  options = DEFAULT_IMAGE_RESIZE_OPTIONS\r\n}) {\r\n  const deltaX = currentX - startX;\r\n  const deltaY = currentY - startY;\r\n\r\n  let newWidth = startWidth;\r\n  let newHeight = startHeight;\r\n\r\n  // Calculate based on handler position\r\n  switch (handler) {\r\n    case RESIZE_HANDLERS.TOP_LEFT:\r\n      newWidth = startWidth - deltaX;\r\n      newHeight = startHeight - deltaY;\r\n      break;\r\n    case RESIZE_HANDLERS.TOP_RIGHT:\r\n      newWidth = startWidth + deltaX;\r\n      newHeight = startHeight - deltaY;\r\n      break;\r\n    case RESIZE_HANDLERS.BOTTOM_LEFT:\r\n      newWidth = startWidth - deltaX;\r\n      newHeight = startHeight + deltaY;\r\n      break;\r\n    case RESIZE_HANDLERS.BOTTOM_RIGHT:\r\n      newWidth = startWidth + deltaX;\r\n      newHeight = startHeight + deltaY;\r\n      break;\r\n    case RESIZE_HANDLERS.TOP:\r\n      newHeight = startHeight - deltaY;\r\n      break;\r\n    case RESIZE_HANDLERS.BOTTOM:\r\n      newHeight = startHeight + deltaY;\r\n      break;\r\n    case RESIZE_HANDLERS.LEFT:\r\n      newWidth = startWidth - deltaX;\r\n      break;\r\n    case RESIZE_HANDLERS.RIGHT:\r\n      newWidth = startWidth + deltaX;\r\n      break;\r\n    default:\r\n      return { width: newWidth, height: newHeight };\r\n  }\r\n\r\n  // Apply aspect ratio constraints\r\n  ({ width: newWidth, height: newHeight } = applyAspectRatioConstraints(\r\n    newWidth, newHeight, startWidth, startHeight, handler, options\r\n  ));\r\n\r\n  // Apply max dimensions\r\n  if (options.maxWidth && newWidth > options.maxWidth) {\r\n    newWidth = options.maxWidth;\r\n    if (options.preserveAspectRatio) {\r\n      newHeight = newWidth / (startWidth / startHeight);\r\n    }\r\n  }\r\n\r\n  if (options.maxHeight && newHeight > options.maxHeight) {\r\n    newHeight = options.maxHeight;\r\n    if (options.preserveAspectRatio) {\r\n      newWidth = newHeight * (startWidth / startHeight);\r\n    }\r\n  }\r\n\r\n  // Ensure minimum and maximum dimensions\r\n  newWidth = Math.max(options.minWidth, Math.min(options.maxWidth || newWidth, newWidth));\r\n  newHeight = Math.max(options.minHeight, Math.min(options.maxHeight || newHeight, newHeight));\r\n\r\n  return {\r\n    width: Math.round(newWidth),\r\n    height: Math.round(newHeight)\r\n  };\r\n}\r\n\r\n/**\r\n * Helper function to apply image dimensions\r\n */\r\nfunction applyImageDimensions(element, { width, height }) {\r\n  if (!isResizableImage(element)) return;\r\n\r\n  // For img elements\r\n  if (element.tagName === 'IMG') {\r\n    element.style.width = `${width}px`;\r\n    element.style.height = `${height}px`;\r\n    element.width = width;\r\n    element.height = height;\r\n  }\r\n  // For div elements with background images\r\n  else if (element.tagName === 'DIV') {\r\n    element.style.width = `${width}px`;\r\n    element.style.height = `${height}px`;\r\n  }\r\n}\r\n\r\n/**\r\n * Helper function to apply dimensions and trigger input event\r\n */\r\nfunction applyDimensionsAndTriggerInput(editorRef, imageElement, dimensions) {\r\n  applyImageDimensions(imageElement, dimensions);\r\n  // Trigger input event to update document state\r\n  const inputEvent = new Event('input', { bubbles: true, cancelable: true });\r\n  editorRef.current.dispatchEvent(inputEvent);\r\n}\r\n\r\n/**\r\n * Helper function to handle keyboard shortcuts for image resizing\r\n */\r\nfunction handleImageKeyboardShortcut(event, editorRef, imageElement, options) {\r\n  const { ctrlKey, metaKey, shiftKey, key } = event;\r\n  const isModifierPressed = ctrlKey || metaKey;\r\n  const currentWidth = imageElement.offsetWidth;\r\n  const currentHeight = imageElement.offsetHeight;\r\n\r\n  const shortcuts = {\r\n    // Increase width\r\n    '>': isModifierPressed && shiftKey ? () => ({\r\n      width: Math.min(options.maxWidth || 800, currentWidth + KEYBOARD_RESIZE_STEP),\r\n      height: currentHeight\r\n    }) : null,\r\n\r\n    // Decrease width\r\n    '<': isModifierPressed && shiftKey ? () => ({\r\n      width: Math.max(options.minWidth || 50, currentWidth - KEYBOARD_RESIZE_STEP),\r\n      height: currentHeight\r\n    }) : null,\r\n\r\n    // Increase height\r\n    '+': isModifierPressed && shiftKey ? () => ({\r\n      width: currentWidth,\r\n      height: Math.min(options.maxHeight || 600, currentHeight + KEYBOARD_RESIZE_STEP)\r\n    }) : null,\r\n\r\n    // Decrease height\r\n    '-': isModifierPressed && shiftKey ? () => ({\r\n      width: currentWidth,\r\n      height: Math.max(options.minHeight || 50, currentHeight - KEYBOARD_RESIZE_STEP)\r\n    }) : null,\r\n\r\n    // Reset to default\r\n    'r': isModifierPressed && !shiftKey ? () => ({ width: DEFAULT_RESET_WIDTH, height: DEFAULT_RESET_HEIGHT }) : null\r\n  };\r\n\r\n  const action = shortcuts[key];\r\n  if (action) {\r\n    event.preventDefault();\r\n    const dimensions = action();\r\n    applyDimensionsAndTriggerInput(editorRef, imageElement, dimensions);\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * ImageResizeHandlers - Component for handling image resize operations\r\n * Provides resize handlers, selection, and resize functionality for images\r\n * \r\n * Features:\r\n * - Visual resize handles around selected images\r\n * - Mouse-based resizing with aspect ratio preservation\r\n * - Keyboard shortcuts for quick resizing\r\n * - Automatic overlay positioning on scroll\r\n * - Undo/redo support for resize operations\r\n * \r\n * @param {Object} props - Component props\r\n * @param {React.RefObject} props.editorRef - Reference to the editor element\r\n * @param {Function} props.onImageResize - Callback when image is resized\r\n * @param {Function} props.onImageSelect - Callback when image is selected\r\n * @param {Function} props.onImageDeselect - Callback when image selection is cleared\r\n * @param {Object} props.resizeOptions - Resize configuration options\r\n */\r\nconst ImageResizeHandlers = ({\r\n  editorRef,\r\n  onImageResize,\r\n  onImageSelect,\r\n  onImageDeselect,\r\n  resizeOptions = DEFAULT_IMAGE_RESIZE_OPTIONS\r\n}) => {\r\n  const resizeStateRef = useRef({\r\n    overlay: null,\r\n    image: null,\r\n    start: null,\r\n    handler: null,\r\n    isResizing: false\r\n  });\r\n  const resizeOptionsRef = useRef(resizeOptions);\r\n  const actions = useDocumentActions();\r\n\r\n  // Update resize options when they change\r\n  useEffect(() => {\r\n    resizeOptionsRef.current = resizeOptions;\r\n  }, [resizeOptions]);\r\n\r\n  /**\r\n   * Handle image selection by creating resize overlay and handlers\r\n   * @param {HTMLElement} imageElement - The image element to select\r\n   */\r\n  const handleImageSelection = useCallback((imageElement) => {\r\n    if (!isResizableImage(imageElement)) return;\r\n\r\n    // Clear any existing resize overlay\r\n    if (resizeStateRef.current.overlay) {\r\n      removeResizeOverlay(resizeStateRef.current.overlay);\r\n      resizeStateRef.current.overlay = null;\r\n    }\r\n\r\n    // Mark image as selected\r\n    imageElement.classList.add('selected');\r\n\r\n    // Create resize overlay\r\n    const overlay = createResizeOverlay(imageElement, resizeOptionsRef.current);\r\n    if (overlay) {\r\n      resizeStateRef.current.overlay = overlay;\r\n      resizeStateRef.current.image = imageElement;\r\n      \r\n      // Add overlay to document body\r\n      document.body.appendChild(overlay);\r\n      \r\n      // Add event listeners to handlers\r\n      const handlers = overlay.querySelectorAll('.resize-handler');\r\n      handlers.forEach(handler => {\r\n        handler.addEventListener('mousedown', handleResizeStart);\r\n      });\r\n      \r\n      // Notify parent\r\n      if (onImageSelect) {\r\n        onImageSelect(imageElement);\r\n      }\r\n    }\r\n  }, [onImageSelect]);\r\n\r\n  /**\r\n   * Clear current image selection and remove resize overlay\r\n   */\r\n  const clearImageSelection = useCallback(() => {\r\n    if (resizeStateRef.current.image) {\r\n      resizeStateRef.current.image.classList.remove('selected');\r\n      resizeStateRef.current.image = null;\r\n    }\r\n\r\n    if (resizeStateRef.current.overlay) {\r\n      removeResizeOverlay(resizeStateRef.current.overlay);\r\n      resizeStateRef.current.overlay = null;\r\n    }\r\n\r\n    resizeStateRef.current.start = null;\r\n    resizeStateRef.current.handler = null;\r\n    resizeStateRef.current.isResizing = false;\r\n\r\n    // Notify parent\r\n    if (onImageDeselect) {\r\n      onImageDeselect();\r\n    }\r\n  }, [onImageDeselect]);\r\n\r\n  /**\r\n   * Start image resize operation when user clicks on a resize handler\r\n   * @param {MouseEvent} event - The mousedown event\r\n   */\r\n  const handleResizeStart = useCallback((event) => {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    \r\n    if (!resizeStateRef.current.image) return;\r\n\r\n    const handler = event.currentTarget.dataset.handler;\r\n    const rect = resizeStateRef.current.image.getBoundingClientRect();\r\n    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\r\n    const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;\r\n\r\n    // Store the original dimensions for undo\r\n    resizeStateRef.current.start = {\r\n      x: event.clientX,\r\n      y: event.clientY,\r\n      width: resizeStateRef.current.image.offsetWidth,\r\n      height: resizeStateRef.current.image.offsetHeight,\r\n      originalWidth: resizeStateRef.current.image.offsetWidth,\r\n      originalHeight: resizeStateRef.current.image.offsetHeight,\r\n      offsetX: event.clientX - rect.left - scrollLeft,\r\n      offsetY: event.clientY - rect.top - scrollTop\r\n    };\r\n\r\n    resizeStateRef.current.handler = handler;\r\n    resizeStateRef.current.isResizing = true;\r\n\r\n    // Add resize class to prevent text selection\r\n    document.body.classList.add('resize-in-progress');\r\n\r\n    // Update cursor based on handler\r\n    document.body.style.cursor = getCursorForHandler(handler);\r\n\r\n    // Add global event listeners\r\n    document.addEventListener('mousemove', handleResizeMove);\r\n    document.addEventListener('mouseup', handleResizeEnd);\r\n  }, []);\r\n\r\n  /**\r\n   * Perform image resize operation during mouse move\r\n   * @param {MouseEvent} event - The mousemove event\r\n   */\r\n  const handleResizeMove = useCallback((event) => {\r\n    if (!resizeStateRef.current.isResizing || !resizeStateRef.current.image || !resizeStateRef.current.start || !resizeStateRef.current.handler) return;\r\n\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n\r\n    const { x: startX, y: startY, width: startWidth, height: startHeight } = resizeStateRef.current.start;\r\n    const handler = resizeStateRef.current.handler;\r\n    const currentX = event.clientX;\r\n    const currentY = event.clientY;\r\n\r\n    // Calculate new dimensions\r\n    const newDimensions = calculateResizeDimensions({\r\n      handler,\r\n      startX,\r\n      startY,\r\n      currentX,\r\n      currentY,\r\n      startWidth,\r\n      startHeight,\r\n      options: resizeOptionsRef.current\r\n    });\r\n\r\n    // Apply new dimensions to the image\r\n    applyImageDimensions(resizeStateRef.current.image, newDimensions);\r\n\r\n    // Update resize overlay\r\n    if (resizeStateRef.current.overlay) {\r\n      updateResizeOverlay(resizeStateRef.current.overlay, resizeStateRef.current.image);\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * End image resize operation and record for undo/redo\r\n   * @param {MouseEvent} event - The mouseup event\r\n   */\r\n  const handleResizeEnd = useCallback((event) => {\r\n    if (!resizeStateRef.current.isResizing) return;\r\n\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n\r\n    // Record the resize operation for undo before clearing refs\r\n    if (resizeStateRef.current.image && resizeStateRef.current.start) {\r\n      const beforeState = {\r\n        width: resizeStateRef.current.start.originalWidth,\r\n        height: resizeStateRef.current.start.originalHeight\r\n      };\r\n      const afterState = {\r\n        width: resizeStateRef.current.image.offsetWidth,\r\n        height: resizeStateRef.current.image.offsetHeight\r\n      };\r\n\r\n      // Only record if dimensions actually changed\r\n      if (beforeState.width !== afterState.width || beforeState.height !== afterState.height) {\r\n        actions.recordOperation(\r\n          { type: 'IMAGE_RESIZE', payload: { element: resizeStateRef.current.image, state: afterState } },\r\n          { type: 'IMAGE_RESIZE', payload: { element: resizeStateRef.current.image, state: beforeState } }\r\n        );\r\n      }\r\n    }\r\n\r\n    resizeStateRef.current.start = null;\r\n    resizeStateRef.current.handler = null;\r\n    resizeStateRef.current.isResizing = false;\r\n\r\n    // Remove global event listeners\r\n    document.removeEventListener('mousemove', handleResizeMove);\r\n    document.removeEventListener('mouseup', handleResizeEnd);\r\n\r\n    // Remove resize classes\r\n    document.body.classList.remove('resize-in-progress');\r\n    document.body.style.cursor = '';\r\n\r\n    // Update content in document context\r\n    if (resizeStateRef.current.image) {\r\n      // Trigger input event to update document state\r\n      const inputEvent = new Event('input', { bubbles: true, cancelable: true });\r\n      resizeStateRef.current.image.dispatchEvent(inputEvent);\r\n\r\n      // Notify parent about resize\r\n      if (onImageResize) {\r\n        onImageResize(resizeStateRef.current.image, {\r\n          width: resizeStateRef.current.image.offsetWidth,\r\n          height: resizeStateRef.current.image.offsetHeight\r\n        });\r\n      }\r\n    }\r\n  }, [onImageResize, actions]);\r\n\r\n  /**\r\n   * Handle click on editor to select images\r\n   */\r\n  const handleEditorClick = useCallback((event) => {\r\n    \r\n    // Clear selection if clicking outside an image\r\n    if (resizeStateRef.current.overlay && !resizeStateRef.current.overlay.contains(event.target)) {\r\n      clearImageSelection();\r\n    }\r\n\r\n    // Check if clicked on an image\r\n    const target = event.target;\r\n    if (isResizableImage(target)) {\r\n      // If already selected, don't reselect\r\n      if (target === resizeStateRef.current.image) {\r\n        return;\r\n      }\r\n      \r\n      // Select the new image\r\n      handleImageSelection(target);\r\n    }\r\n  }, [handleImageSelection, clearImageSelection]);\r\n\r\n  /**\r\n   * Handle keydown events (for deleting selected images, etc.)\r\n   */\r\n  const handleKeyDown = useCallback((event) => {\r\n    // Delete selected image with Delete or Backspace key\r\n    if ((event.key === 'Delete' || event.key === 'Backspace') && \r\n        resizeStateRef.current.image && \r\n        !resizeStateRef.current.isResizing) {\r\n      \r\n      // Prevent default behavior\r\n      event.preventDefault();\r\n      \r\n      // Remove the image\r\n      const imageToRemove = resizeStateRef.current.image;\r\n      if (imageToRemove.parentNode) {\r\n        imageToRemove.parentNode.removeChild(imageToRemove);\r\n        \r\n        // Clear selection\r\n        clearImageSelection();\r\n        \r\n        // Trigger input event to update document state\r\n        const inputEvent = new Event('input', { bubbles: true, cancelable: true });\r\n        editorRef.current.dispatchEvent(inputEvent);\r\n      }\r\n    }\r\n    \r\n    // Escape key to clear selection\r\n    if (event.key === 'Escape' && resizeStateRef.current.image) {\r\n      clearImageSelection();\r\n    }\r\n    \r\n    // Add keyboard shortcuts for image operations\r\n    if (resizeStateRef.current.image && !resizeStateRef.current.isResizing) {\r\n      handleImageKeyboardShortcut(event, editorRef, resizeStateRef.current.image, resizeOptionsRef.current);\r\n    }\r\n  }, [editorRef, clearImageSelection]);\r\n\r\n  /**\r\n   * Handle scroll events to update overlay position\r\n   */\r\n  const handleScroll = useCallback(() => {\r\n    if (resizeStateRef.current.overlay && resizeStateRef.current.image) {\r\n      updateResizeOverlay(resizeStateRef.current.overlay, resizeStateRef.current.image);\r\n    }\r\n  }, []);\r\n\r\n  // Add scroll listener to editor viewport\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const editor = editorRef.current;\r\n    const viewport = editor.closest('.editor-viewport');\r\n    \r\n    if (viewport) {\r\n      // Add scroll listener to viewport\r\n      viewport.addEventListener('scroll', handleScroll);\r\n      \r\n      // Also listen to window scroll in case of nested scrolling\r\n      window.addEventListener('scroll', handleScroll);\r\n    }\r\n\r\n    // Cleanup\r\n    return () => {\r\n      if (viewport) {\r\n        viewport.removeEventListener('scroll', handleScroll);\r\n      }\r\n      window.removeEventListener('scroll', handleScroll);\r\n    };\r\n  }, [editorRef, handleScroll]);\r\n\r\n  // Add event listeners when editor is available\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const editor = editorRef.current;\r\n    \r\n    // Add event listeners\r\n    editor.addEventListener('click', handleEditorClick);\r\n    editor.addEventListener('keydown', handleKeyDown);\r\n    \r\n    // Add window resize listener\r\n    window.addEventListener('resize', handleScroll);\r\n\r\n    // Cleanup\r\n    return () => {\r\n      editor.removeEventListener('click', handleEditorClick);\r\n      editor.removeEventListener('keydown', handleKeyDown);\r\n      \r\n      window.removeEventListener('resize', handleScroll);\r\n      \r\n      // Clean up any active resize operations\r\n      if (resizeStateRef.current.isResizing) {\r\n        document.removeEventListener('mousemove', handleResizeMove);\r\n        document.removeEventListener('mouseup', handleResizeEnd);\r\n        document.body.classList.remove('resize-in-progress');\r\n        document.body.style.cursor = '';\r\n      }\r\n      \r\n      // Remove overlay\r\n      if (resizeStateRef.current.overlay) {\r\n        removeResizeOverlay(resizeStateRef.current.overlay);\r\n      }\r\n    };\r\n  }, [editorRef, handleEditorClick, handleKeyDown, handleScroll, handleResizeMove, handleResizeEnd]);\r\n\r\n  // Add a mutation observer to detect when images are added/removed\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const observer = new MutationObserver((mutations) => {\r\n      mutations.forEach((mutation) => {\r\n        if (mutation.type !== 'childList') return;\r\n\r\n        // Handle removed images\r\n        mutation.removedNodes.forEach(node => {\r\n          if (node.nodeType === Node.ELEMENT_NODE && isResizableImage(node) && node === resizeStateRef.current.image) {\r\n            clearImageSelection();\r\n          }\r\n        });\r\n      });\r\n    });\r\n\r\n    observer.observe(editorRef.current, {\r\n      childList: true,\r\n      subtree: true\r\n    });\r\n\r\n    return () => observer.disconnect();\r\n  }, [editorRef, clearImageSelection, handleImageSelection]);\r\n\r\n  // This component doesn't render anything visible - it just manages the resize functionality\r\n  return null;\r\n};\r\n\r\nImageResizeHandlers.propTypes = {\r\n  editorRef: PropTypes.shape({\r\n    current: PropTypes.instanceOf(typeof Element !== 'undefined' ? Element : Object)\r\n  }).isRequired,\r\n  onImageResize: PropTypes.func,\r\n  onImageSelect: PropTypes.func,\r\n  onImageDeselect: PropTypes.func,\r\n  resizeOptions: PropTypes.shape({\r\n    minWidth: PropTypes.number,\r\n    minHeight: PropTypes.number,\r\n    maxWidth: PropTypes.number,\r\n    maxHeight: PropTypes.number,\r\n    aspectRatio: PropTypes.bool,\r\n    preserveAspectRatio: PropTypes.bool,\r\n    defaultWidth: PropTypes.number,\r\n    defaultHeight: PropTypes.number\r\n  })\r\n};\r\n\r\nImageResizeHandlers.defaultProps = {\r\n  onImageResize: undefined,\r\n  onImageSelect: undefined,\r\n  onImageDeselect: undefined,\r\n  resizeOptions: DEFAULT_IMAGE_RESIZE_OPTIONS\r\n};\r\n\r\nexport default ImageResizeHandlers;\r\n","import React, { useState, useEffect, useRef, useLayoutEffect, useCallback } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { AlignLeft, AlignCenter, AlignRight, Trash2, Scaling, ImageUpscale } from 'lucide-react';\r\nimport PropTypes from 'prop-types';\r\nimport { useDocumentActions } from '../../context/DocumentContext';\r\nimport { updateResizeOverlay } from '../../lib/editor/image-resize-utils';\r\n\r\n// Button style constants\r\nconst buttonBaseStyle = {\r\n  border: '1px solid #ccc',\r\n  borderRadius: '4px',\r\n  padding: '4px',\r\n  cursor: 'pointer',\r\n  display: 'flex',\r\n  alignItems: 'center',\r\n  justifyContent: 'center',\r\n  minWidth: '28px',\r\n  height: '28px'\r\n};\r\n\r\nconst deleteButtonStyle = {\r\n  ...buttonBaseStyle,\r\n  background: 'transparent',\r\n  color: '#dc3545',\r\n  borderColor: '#dc3545'\r\n};\r\n\r\nconst getAlignmentButtonStyle = (isActive) => ({\r\n  ...buttonBaseStyle,\r\n  background: isActive ? '#007bff' : 'transparent',\r\n  color: isActive ? '#fff' : '#333'\r\n});\r\n\r\n/**\r\n * ImageTooltipMenu - Component for image tooltip menu with alignment, aspect ratio, and delete options\r\n */\r\nconst ImageTooltipMenu = ({\r\n  imageElement,\r\n  onAlignChange,\r\n  onAspectRatioToggle,\r\n  onDelete,\r\n  onClose,\r\n  initialPreserveAspectRatio = true\r\n}) => {\r\n  const [position, setPosition] = useState({ top: 0, left: 0 });\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const [menuPosition, setMenuPosition] = useState('top'); // 'top' or 'bottom'\r\n  const [preserveAspectRatio, setPreserveAspectRatio] = useState(initialPreserveAspectRatio);\r\n  const menuRef = useRef(null);\r\n  const actions = useDocumentActions();\r\n\r\n  const syncResizeOverlayPosition = (element) => {\r\n    if (!element) {\r\n      return;\r\n    }\r\n\r\n    requestAnimationFrame(() => {\r\n      const overlay = document.querySelector('.image-resize-overlay');\r\n      if (overlay) {\r\n        updateResizeOverlay(overlay, element);\r\n      }\r\n    });\r\n  };\r\n\r\n  // Helper function to get current image state for undo operations\r\n  const getImageState = (element) => {\r\n    if (!element) return null;\r\n    const style = window.getComputedStyle(element);\r\n    return {\r\n      float: style.float || 'none',\r\n      margin: element.style.margin || '',\r\n      display: style.display || 'inline',\r\n      width: element.style.width || element.width || '',\r\n      height: element.style.height || element.height || '',\r\n      aspectRatio: preserveAspectRatio\r\n    };\r\n  };\r\n\r\n  // Get current alignment of the image\r\n  const getCurrentAlignment = useCallback(() => {\r\n    if (!imageElement) return 'left';\r\n    const style = window.getComputedStyle(imageElement);\r\n    if (style.float === 'right') return 'right';\r\n    if (style.float === 'left') return 'left';\r\n    if (style.display === 'block' && style.margin.includes('auto')) return 'center';\r\n    return 'left';\r\n  }, [imageElement]);\r\n\r\n  const [currentAlignment, setCurrentAlignment] = useState('left');\r\n\r\n  // Update current alignment when image element changes\r\n  useEffect(() => {\r\n    if (imageElement) {\r\n      setCurrentAlignment(getCurrentAlignment());\r\n    }\r\n  }, [imageElement, getCurrentAlignment]);\r\n\r\n  const calculateMenuPosition = useCallback(() => {\r\n    if (!imageElement || !menuRef.current) return;\r\n\r\n    const imageRect = imageElement.getBoundingClientRect();\r\n    const menuRect = menuRef.current.getBoundingClientRect();\r\n\r\n    const viewportWidth = window.innerWidth;\r\n    const viewportHeight = window.innerHeight;\r\n\r\n    // Check if image is visible in viewport\r\n    const isImageInViewport = (\r\n      imageRect.bottom >= 0 &&\r\n      imageRect.top <= viewportHeight &&\r\n      imageRect.right >= 0 &&\r\n      imageRect.left <= viewportWidth\r\n    );\r\n\r\n    let menuPosition = 'top';\r\n    let top = 0;\r\n    let left = 0;\r\n\r\n    if (isImageInViewport) {\r\n      const spaceAbove = imageRect.top - menuRect.height - 10;\r\n      const spaceBelow = viewportHeight - imageRect.bottom - menuRect.height - 10;\r\n\r\n      if (spaceBelow > spaceAbove && spaceBelow > 0) {\r\n        menuPosition = 'bottom';\r\n        top = imageRect.bottom + 10;\r\n      } else {\r\n        menuPosition = 'top';\r\n        top = imageRect.top - menuRect.height - 10;\r\n      }\r\n    } else {\r\n      menuPosition = 'top';\r\n      top = 10;\r\n    }\r\n\r\n    left = imageRect.left + (imageRect.width / 2) - (menuRect.width / 2);\r\n\r\n    // Ensure the menu stays within viewport\r\n    let adjustedLeft = Math.max(10, Math.min(left, viewportWidth - menuRect.width - 10));\r\n    let adjustedTop = Math.max(10, Math.min(top, viewportHeight - menuRect.height - 10));\r\n\r\n    setPosition({ top: adjustedTop, left: adjustedLeft });\r\n    setMenuPosition(menuPosition);\r\n    setIsVisible(true);\r\n  }, [imageElement]);\r\n\r\n  // Position the tooltip menu\r\n  useLayoutEffect(() => {\r\n    // Initial positioning\r\n    calculateMenuPosition();\r\n\r\n    // Add scroll listener to update position on scroll\r\n    const handleScroll = () => {\r\n      calculateMenuPosition();\r\n    };\r\n\r\n    // Also add window scroll listener for safety\r\n    window.addEventListener('scroll', handleScroll);\r\n    window.addEventListener('resize', handleScroll);\r\n\r\n    return () => {\r\n      window.removeEventListener('scroll', handleScroll);\r\n      window.removeEventListener('resize', handleScroll);\r\n      setIsVisible(false);\r\n    };\r\n  }, [imageElement, calculateMenuPosition]);\r\n\r\n  // Close menu when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (menuRef.current && !menuRef.current.contains(event.target) &&\r\n          event.target !== imageElement) {\r\n        onClose();\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, [imageElement, onClose]);\r\n\r\n  const alignmentStyles = {\r\n    left: { float: 'left', margin: '0 10px 10px 0', display: 'block' },\r\n    center: { float: 'none', margin: '10px auto', display: 'block' },\r\n    right: { float: 'right', margin: '0 0 10px 10px', display: 'block' }\r\n  };\r\n\r\n  const handleAlign = (alignment) => {\r\n    if (imageElement && alignmentStyles[alignment]) {\r\n      const beforeState = getImageState(imageElement);\r\n      const oldAlignment = currentAlignment;\r\n\r\n      const styles = alignmentStyles[alignment];\r\n      imageElement.style.float = styles.float;\r\n      imageElement.style.margin = styles.margin;\r\n      imageElement.style.display = styles.display;\r\n      setCurrentAlignment(alignment);\r\n      syncResizeOverlayPosition(imageElement);\r\n\r\n      const afterState = getImageState(imageElement);\r\n\r\n      // Record operation for undo\r\n      actions.recordOperation(\r\n        { type: 'IMAGE_ALIGN', payload: { element: imageElement, alignment, state: afterState } },\r\n        { type: 'IMAGE_ALIGN', payload: { element: imageElement, alignment: oldAlignment, state: beforeState } }\r\n      );\r\n\r\n      onAlignChange && onAlignChange(alignment);\r\n    }\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    if (imageElement && imageElement.parentNode) {\r\n      const beforeState = {\r\n        element: imageElement,\r\n        parent: imageElement.parentNode,\r\n        nextSibling: imageElement.nextSibling\r\n      };\r\n      \r\n      // Record operation for undo (re-insert the image)\r\n      actions.recordOperation(\r\n        { type: 'IMAGE_DELETE', payload: { element: imageElement } },\r\n        { type: 'IMAGE_REINSERT', payload: { state: beforeState } }\r\n      );\r\n      \r\n      imageElement.parentNode.removeChild(imageElement);\r\n      onDelete && onDelete();\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  const handleAspectRatioToggle = () => {\r\n    const oldPreserveRatio = preserveAspectRatio;\r\n    const newPreserveRatio = !preserveAspectRatio;\r\n    setPreserveAspectRatio(newPreserveRatio);\r\n\r\n    // Record operation for undo\r\n    actions.recordOperation(\r\n      { type: 'IMAGE_ASPECT_RATIO', payload: { element: imageElement, preserveAspectRatio: newPreserveRatio } },\r\n      { type: 'IMAGE_ASPECT_RATIO', payload: { element: imageElement, preserveAspectRatio: oldPreserveRatio } }\r\n    );\r\n\r\n    // Call the parent callback if provided\r\n    if (onAspectRatioToggle) {\r\n      onAspectRatioToggle(newPreserveRatio);\r\n    }\r\n  };\r\n\r\n  if (!imageElement) return null;\r\n\r\n  if (typeof document === 'undefined') {\r\n    return null;\r\n  }\r\n\r\n  return createPortal(\r\n    <div\r\n      ref={menuRef}\r\n      className=\"image-tooltip-menu\"\r\n      data-menu-position={menuPosition}\r\n      aria-hidden={!isVisible}\r\n      style={{\r\n        position: 'fixed',\r\n        top: `${position.top}px`,\r\n        left: `${position.left}px`,\r\n        zIndex: 999,\r\n        background: '#fff',\r\n        border: '1px solid #ddd',\r\n        borderRadius: '6px',\r\n        boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\r\n        padding: '8px',\r\n        display: 'flex',\r\n        gap: '2px',\r\n        alignItems: 'center',\r\n        pointerEvents: isVisible ? 'auto' : 'none',\r\n        minWidth: '140px',\r\n        minHeight: '32px',\r\n        opacity: isVisible ? 1 : 0,\r\n        visibility: isVisible ? 'visible' : 'hidden',\r\n        transition: 'opacity 0.15s ease, visibility 0.15s ease'\r\n      }}\r\n    >\r\n      {/* Aspect Ratio Toggle */}\r\n      <button\r\n        className={`tooltip-button aspect-ratio-toggle ${!preserveAspectRatio ? 'active' : ''}`}\r\n        onClick={handleAspectRatioToggle}\r\n        title={`Toggle aspect ratio preservation (currently ${preserveAspectRatio ? 'ON' : 'OFF'})`}\r\n      >\r\n        {preserveAspectRatio ? <Scaling size={14} /> : <ImageUpscale size={14} />}\r\n      </button>\r\n\r\n      {/* Alignment buttons */}\r\n      <button\r\n        className={`tooltip-button ${currentAlignment === 'left' ? 'active' : ''}`}\r\n        onClick={() => handleAlign('left')}\r\n        title=\"Align Left\"\r\n        style={getAlignmentButtonStyle(currentAlignment === 'left')}\r\n      >\r\n        <AlignLeft size={14} />\r\n      </button>\r\n      \r\n      <button\r\n        className={`tooltip-button ${currentAlignment === 'center' ? 'active' : ''}`}\r\n        onClick={() => handleAlign('center')}\r\n        title=\"Align Center\"\r\n        style={getAlignmentButtonStyle(currentAlignment === 'center')}\r\n      >\r\n        <AlignCenter size={14} />\r\n      </button>\r\n      \r\n      <button\r\n        className={`tooltip-button ${currentAlignment === 'right' ? 'active' : ''}`}\r\n        onClick={() => handleAlign('right')}\r\n        title=\"Align Right\"\r\n        style={getAlignmentButtonStyle(currentAlignment === 'right')}\r\n      >\r\n        <AlignRight size={14} />\r\n      </button>\r\n\r\n      {/* Delete button */}\r\n      <button\r\n        className=\"tooltip-button delete-button\"\r\n        onClick={handleDelete}\r\n        title=\"Delete Image\"\r\n        style={deleteButtonStyle}\r\n      >\r\n        <Trash2 size={14} />\r\n      </button>\r\n    </div>,\r\n    document.body\r\n  );\r\n};\r\n\r\nImageTooltipMenu.propTypes = {\r\n  imageElement: PropTypes.instanceOf(typeof Element !== 'undefined' ? Element : Object),\r\n  onAlignChange: PropTypes.func,\r\n  onAspectRatioToggle: PropTypes.func,\r\n  onDelete: PropTypes.func,\r\n  onClose: PropTypes.func.isRequired,\r\n  initialPreserveAspectRatio: PropTypes.bool\r\n};\r\n\r\nImageTooltipMenu.defaultProps = {\r\n  imageElement: null,\r\n  onAlignChange: undefined,\r\n  onAspectRatioToggle: undefined,\r\n  onDelete: undefined,\r\n  initialPreserveAspectRatio: true\r\n};\r\n\r\nexport default ImageTooltipMenu;","/**\r\n * DOM manipulation utilities for common patterns across components\r\n * Reduces code duplication and improves maintainability\r\n * Optimized to export only actively used functions\r\n */\r\n\r\n/**\r\n * Prevent default event behavior and stop propagation\r\n * Common pattern in resize handlers and event listeners\r\n * @param {Event} event - The event to suppress\r\n */\r\nexport const suppressEvent = (event) => {\r\n  event.preventDefault();\r\n  event.stopPropagation();\r\n};\r\n\r\n/**\r\n * Clear multiple classes from elements matching a selector\r\n * Efficiently removes one or more classes from all matching elements\r\n * @param {string} selector - CSS selector for elements\r\n * @param {string|string[]} classes - Class or classes to remove\r\n */\r\nexport const clearClasses = (selector, classes) => {\r\n  const classArray = Array.isArray(classes) ? classes : [classes];\r\n  document.querySelectorAll(selector).forEach(el => {\r\n    classArray.forEach(className => {\r\n      el.classList.remove(className);\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * Check if element is within another element\r\n * @param {Element} parent - Potential parent element\r\n * @param {Element} child - Potential child element\r\n * @returns {boolean} True if child is within parent\r\n */\r\nexport const isWithin = (parent, child) => {\r\n  if (!parent || !child) return false;\r\n  return parent.contains(child);\r\n};\r\n\r\n/**\r\n * Clear text selection\r\n * Cross-browser compatible method to deselect all selected text\r\n */\r\nexport const clearTextSelection = () => {\r\n  if (window.getSelection) {\r\n    window.getSelection().removeAllRanges();\r\n  } else if (document.selection) {\r\n    document.selection.empty();\r\n  }\r\n};\r\n","/**\r\n * Table Resize Utilities for HTML Editor\r\n * Provides functionality for resizing table columns, rows, and overall table size\r\n */\r\n\r\n/**\r\n * Default table resize options\r\n */\r\nexport const DEFAULT_TABLE_RESIZE_OPTIONS = {\r\n  minColumnWidth: 10,\r\n  minRowHeight: 8,\r\n  maxColumnWidth: 800,\r\n  maxRowHeight: 600,\r\n  tableMinWidth: 100,\r\n  tableMinHeight: 50,\r\n  tableMaxWidth: 1200,\r\n  tableMaxHeight: 800\r\n};\r\n\r\n/**\r\n * Table resize handler types\r\n */\r\nexport const TABLE_RESIZE_HANDLERS = {\r\n  COLUMN: 'column',\r\n  ROW: 'row',\r\n  TABLE_BOTTOM: 'table-bottom',\r\n  TABLE_RIGHT: 'table-right'\r\n};\r\n\r\n/**\r\n * Check if an element is a table that can be resized\r\n * @param {HTMLElement} element - Element to check\r\n * @returns {boolean} Whether the element is a resizable table\r\n */\r\nexport function isResizableTable(element) {\r\n  if (!element) return false;\r\n  return element.tagName === 'TABLE';\r\n}\r\n\r\n/**\r\n * Get table dimensions and structure\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @returns {Object} Table structure information\r\n */\r\nexport function getTableStructure(tableElement) {\r\n  if (!isResizableTable(tableElement)) {\r\n    return null;\r\n  }\r\n\r\n  const rect = tableElement.getBoundingClientRect();\r\n  const rows = Array.from(tableElement.rows);\r\n  const columns = rows.length > 0 ? rows[0].cells.length : 0;\r\n\r\n  // Get column widths - first try colgroup, then fall back to measuring cells\r\n  const columnWidths = [];\r\n  const colgroup = tableElement.querySelector('colgroup');\r\n  const cols = colgroup ? colgroup.querySelectorAll('col') : [];\r\n\r\n  if (cols.length >= columns) {\r\n    // Use colgroup widths if available and sufficient\r\n    for (let i = 0; i < columns; i++) {\r\n      const col = cols[i];\r\n      const width = col.style.width ? parseInt(col.style.width, 10) : col.offsetWidth;\r\n      columnWidths.push(width || 100); // Default width if not set\r\n    }\r\n  } else {\r\n    // Fall back to measuring first row cells\r\n    if (rows.length > 0) {\r\n      const firstRow = rows[0];\r\n      for (let i = 0; i < firstRow.cells.length; i++) {\r\n        const cell = firstRow.cells[i];\r\n        columnWidths.push(cell.offsetWidth);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Get row heights\r\n  const rowHeights = rows.map(row => {\r\n    // Use explicit height if set, otherwise measure\r\n    const explicitHeight = row.style.height ? parseInt(row.style.height, 10) : null;\r\n    return explicitHeight || row.offsetHeight;\r\n  });\r\n\r\n  return {\r\n    width: rect.width,\r\n    height: rect.height,\r\n    columns,\r\n    rows: rows.length,\r\n    columnWidths,\r\n    rowHeights,\r\n    rect\r\n  };\r\n}\r\n\r\n/**\r\n * Calculate new dimensions for table resize operations\r\n * @param {Object} params - Resize parameters\r\n * @param {string} params.type - Type of resize (column, row, table)\r\n * @param {number} params.index - Index of column/row being resized\r\n * @param {number} params.delta - Change in size\r\n * @param {Object} params.currentStructure - Current table structure\r\n * @param {Object} params.options - Resize options\r\n * @returns {Object} New dimensions\r\n */\r\nexport function calculateTableResizeDimensions({\r\n  type,\r\n  index,\r\n  delta,\r\n  currentStructure,\r\n  options = DEFAULT_TABLE_RESIZE_OPTIONS\r\n}) {\r\n  const result = {\r\n    columnWidths: [...currentStructure.columnWidths],\r\n    rowHeights: [...currentStructure.rowHeights],\r\n    tableWidth: currentStructure.width,\r\n    tableHeight: currentStructure.height\r\n  };\r\n\r\n  // Helper function to apply resize with bounds checking\r\n  const applyResize = (array, arrayIndex, delta, min, max) => {\r\n    if (arrayIndex >= 0 && arrayIndex < array.length) {\r\n      array[arrayIndex] = Math.max(min, Math.min(max, array[arrayIndex] + delta));\r\n    }\r\n  };\r\n\r\n  switch (type) {\r\n    case TABLE_RESIZE_HANDLERS.COLUMN:\r\n      applyResize(result.columnWidths, index, delta, options.minColumnWidth, options.maxColumnWidth);\r\n      result.tableWidth = currentStructure.width;\r\n      break;\r\n\r\n    case TABLE_RESIZE_HANDLERS.ROW:\r\n      applyResize(result.rowHeights, index, delta, options.minRowHeight, options.maxRowHeight);\r\n      result.tableHeight = currentStructure.height;\r\n      break;\r\n\r\n    case TABLE_RESIZE_HANDLERS.TABLE_BOTTOM:\r\n      applyResize(result.rowHeights, currentStructure.rows - 1, delta, options.minRowHeight, options.maxRowHeight);\r\n      break;\r\n\r\n    case TABLE_RESIZE_HANDLERS.TABLE_RIGHT:\r\n      applyResize(result.columnWidths, currentStructure.columns - 1, delta, options.minColumnWidth, options.maxColumnWidth);\r\n      break;\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Synchronize colgroup with actual table structure\r\n * @param {HTMLTableElement} tableElement - Table element\r\n */\r\nexport function synchronizeTableColgroup(tableElement) {\r\n  if (!isResizableTable(tableElement)) return;\r\n\r\n  const rows = Array.from(tableElement.rows);\r\n  if (rows.length === 0) return;\r\n\r\n  const columnCount = rows[0].cells.length;\r\n\r\n  // Get or create colgroup\r\n  let colgroup = tableElement.querySelector('colgroup');\r\n  if (!colgroup) {\r\n    colgroup = document.createElement('colgroup');\r\n    tableElement.insertBefore(colgroup, tableElement.firstChild);\r\n  }\r\n\r\n  // Ensure colgroup has the right number of col elements\r\n  const existingCols = colgroup.querySelectorAll('col');\r\n  const currentColCount = existingCols.length;\r\n\r\n  if (currentColCount < columnCount) {\r\n    // Add missing col elements\r\n    for (let i = currentColCount; i < columnCount; i++) {\r\n      const col = document.createElement('col');\r\n      colgroup.appendChild(col);\r\n    }\r\n  } else if (currentColCount > columnCount) {\r\n    // Remove extra col elements\r\n    for (let i = currentColCount - 1; i >= columnCount; i--) {\r\n      colgroup.removeChild(existingCols[i]);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Apply table dimensions to table element\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {Object} dimensions - New dimensions\r\n * @param {string} resizeType - Type of resize operation (optional)\r\n */\r\nexport function applyTableDimensions(tableElement, dimensions) {\r\n  if (!isResizableTable(tableElement)) return;\r\n\r\n  // First synchronize colgroup with table structure\r\n  synchronizeTableColgroup(tableElement);\r\n\r\n  const { columnWidths, rowHeights, tableWidth, tableHeight } = dimensions;\r\n\r\n  // Calculate sums once\r\n  const sumWidth = columnWidths ? columnWidths.reduce((sum, w) => sum + w, 0) : 0;\r\n  const sumHeight = rowHeights ? rowHeights.reduce((sum, h) => sum + h, 0) : 0;\r\n\r\n  // Apply table size\r\n  if (tableWidth !== undefined) {\r\n    tableElement.style.width = `${tableWidth}px`;\r\n  } else if (sumWidth > 0) {\r\n    tableElement.style.width = `${sumWidth}px`;\r\n  }\r\n\r\n  if (tableHeight !== undefined) {\r\n    tableElement.style.height = `${tableHeight}px`;\r\n  } else if (sumHeight > 0) {\r\n    tableElement.style.height = `${sumHeight}px`;\r\n  }\r\n\r\n  // Apply column widths\r\n  if (columnWidths && columnWidths.length > 0) {\r\n    // Set table-layout to fixed to ensure colgroup widths are respected\r\n    tableElement.style.tableLayout = 'fixed';\r\n\r\n    const colgroup = tableElement.querySelector('colgroup');\r\n    if (colgroup) {\r\n      const cols = colgroup.querySelectorAll('col');\r\n      cols.forEach((col, index) => {\r\n        if (index < columnWidths.length) {\r\n          col.style.width = `${columnWidths[index]}px`;\r\n        }\r\n      });\r\n    }\r\n\r\n    // Ensure table width is set to sum of column widths\r\n    tableElement.style.width = `${sumWidth}px`;\r\n  }\r\n\r\n  // Apply row heights\r\n  if (rowHeights && rowHeights.length > 0) {\r\n    const rows = Array.from(tableElement.rows);\r\n    rows.forEach((row, index) => {\r\n      if (index < rowHeights.length) {\r\n        row.style.height = `${rowHeights[index]}px`;\r\n      }\r\n    });\r\n\r\n    // Ensure table height is set to sum of row heights\r\n    tableElement.style.height = `${sumHeight}px`;\r\n  }\r\n\r\n  // Force a reflow to ensure dimensions are applied immediately\r\n  tableElement.offsetHeight;\r\n}\r\n\r\n/**\r\n * Create resize overlay for a table\r\n * @param {HTMLTableElement} tableElement - Table element to resize\r\n * @param {Object} options - Resize options\r\n * @returns {HTMLElement} Resize overlay element\r\n */\r\nexport function createTableResizeOverlay(tableElement) {\r\n  if (!isResizableTable(tableElement)) return null;\r\n\r\n  // Ensure colgroup is synchronized before creating overlay\r\n  synchronizeTableColgroup(tableElement);\r\n\r\n  const structure = getTableStructure(tableElement);\r\n  if (!structure) return null;\r\n\r\n  // Create overlay container\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'table-resize-overlay';\r\n  overlay.style.position = 'fixed';\r\n  overlay.style.zIndex = '1000';\r\n  overlay.style.pointerEvents = 'none';\r\n\r\n  // Position overlay over the table\r\n  const rect = tableElement.getBoundingClientRect();\r\n  overlay.style.top = `${rect.top}px`;\r\n  overlay.style.left = `${rect.left}px`;\r\n  overlay.style.width = `${rect.width}px`;\r\n  overlay.style.height = `${rect.height}px`;\r\n\r\n  // Create column resize handlers (one less than column count)\r\n  for (let i = 0; i < structure.columns - 1; i++) {\r\n    const handler = createIndexedResizeHandler(TABLE_RESIZE_HANDLERS.COLUMN, i, structure, rect, tableElement);\r\n    overlay.appendChild(handler);\r\n  }\r\n\r\n  // Create row resize handlers (one less than row count)\r\n  for (let i = 0; i < structure.rows - 1; i++) {\r\n    const handler = createIndexedResizeHandler(TABLE_RESIZE_HANDLERS.ROW, i, structure, rect, tableElement);\r\n    overlay.appendChild(handler);\r\n  }\r\n\r\n  // Create table bottom and right resize handlers\r\n  const bottomHandler = createBoundaryResizeHandler(TABLE_RESIZE_HANDLERS.TABLE_BOTTOM, structure, rect);\r\n  overlay.appendChild(bottomHandler);\r\n\r\n  const rightHandler = createBoundaryResizeHandler(TABLE_RESIZE_HANDLERS.TABLE_RIGHT, structure, rect);\r\n  overlay.appendChild(rightHandler);\r\n\r\n  return overlay;\r\n}\r\n\r\n/**\r\n * Handler configuration mapping for different resize types\r\n */\r\nconst HANDLER_CONFIG = {\r\n  [TABLE_RESIZE_HANDLERS.COLUMN]: {\r\n    className: 'table-resize-handler table-column-resize-handler',\r\n    cursor: 'col-resize',\r\n    isVertical: true\r\n  },\r\n  [TABLE_RESIZE_HANDLERS.ROW]: {\r\n    className: 'table-resize-handler table-row-resize-handler',\r\n    cursor: 'row-resize',\r\n    isVertical: false\r\n  },\r\n  [TABLE_RESIZE_HANDLERS.TABLE_BOTTOM]: {\r\n    className: 'table-resize-handler table-bottom-resize-handler',\r\n    cursor: 'ns-resize',\r\n    isVertical: false\r\n  },\r\n  [TABLE_RESIZE_HANDLERS.TABLE_RIGHT]: {\r\n    className: 'table-resize-handler table-right-resize-handler',\r\n    cursor: 'ew-resize',\r\n    isVertical: true\r\n  }\r\n};\r\n\r\n/**\r\n * Create a resize handler with optimized factory pattern\r\n * @param {string} type - Handler type from TABLE_RESIZE_HANDLERS\r\n * @param {number} primarySize - Width or height depending on type\r\n * @param {number} index - Index for column/row handlers (optional)\r\n * @returns {HTMLElement} Handler element\r\n */\r\nfunction createResizeHandler(type, primarySize, index) {\r\n  const config = HANDLER_CONFIG[type];\r\n  if (!config) {\r\n    console.warn(`createResizeHandler: Unknown handler type ${type}`);\r\n    return null;\r\n  }\r\n\r\n  const handler = document.createElement('div');\r\n  handler.className = config.className;\r\n  handler.dataset.type = type;\r\n  handler.style.position = 'absolute';\r\n  handler.style.cursor = config.cursor;\r\n  handler.style.pointerEvents = 'all';\r\n\r\n  if (config.isVertical) {\r\n    handler.style.width = '4px';\r\n    handler.style.height = `${primarySize}px`;\r\n  } else {\r\n    handler.style.width = `${primarySize}px`;\r\n    handler.style.height = '4px';\r\n  }\r\n\r\n  if (index !== undefined && index !== null) {\r\n    handler.dataset.index = index;\r\n  }\r\n\r\n  return handler;\r\n}\r\n\r\n/**\r\n * Factory function to create column and row handlers\r\n * @param {string} type - Handler type (column or row)\r\n * @param {number} index - Index of the column/row\r\n * @param {Object} structure - Table structure\r\n * @param {DOMRect} rect - Table bounding rect\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @returns {HTMLElement} Resize handler\r\n */\r\nfunction createIndexedResizeHandler(type, index, structure, rect, tableElement) {\r\n  const primarySize = type === TABLE_RESIZE_HANDLERS.COLUMN ? rect.height : rect.width;\r\n  const handler = createResizeHandler(type, primarySize, index);\r\n  positionResizeHandler(handler, type, index, structure, rect, tableElement);\r\n  return handler;\r\n}\r\n\r\n/**\r\n * Factory function to create table boundary handlers\r\n * @param {string} type - Handler type (table-bottom or table-right)\r\n * @param {Object} structure - Table structure\r\n * @param {DOMRect} rect - Table bounding rect\r\n * @returns {HTMLElement} Resize handler\r\n */\r\nfunction createBoundaryResizeHandler(type, structure, rect) {\r\n  const primarySize = type === TABLE_RESIZE_HANDLERS.TABLE_RIGHT ? rect.height : rect.width;\r\n  const handler = createResizeHandler(type, primarySize);\r\n  positionResizeHandler(handler, type, null, structure, rect, null);\r\n  return handler;\r\n}\r\n\r\n/**\r\n * Update table resize overlay position and size\r\n * @param {HTMLElement} overlay - Resize overlay\r\n * @param {HTMLTableElement} tableElement - Table element\r\n */\r\nexport function updateTableResizeOverlay(overlay, tableElement) {\r\n  if (!overlay || !tableElement) return;\r\n\r\n  // Ensure colgroup is synchronized\r\n  synchronizeTableColgroup(tableElement);\r\n\r\n  const structure = getTableStructure(tableElement);\r\n  if (!structure) return;\r\n\r\n  const rect = tableElement.getBoundingClientRect();\r\n\r\n  overlay.style.top = `${rect.top}px`;\r\n  overlay.style.left = `${rect.left}px`;\r\n  overlay.style.width = `${rect.width}px`;\r\n  overlay.style.height = `${rect.height}px`;\r\n\r\n  // Check if handler counts match current structure\r\n  const columnHandlers = overlay.querySelectorAll('.table-column-resize-handler');\r\n  const rowHandlers = overlay.querySelectorAll('.table-row-resize-handler');\r\n  const bottomHandler = overlay.querySelector('.table-bottom-resize-handler');\r\n  const rightHandler = overlay.querySelector('.table-right-resize-handler');\r\n\r\n  const needsRecreate = columnHandlers.length !== structure.columns - 1 ||\r\n                       rowHandlers.length !== structure.rows - 1 ||\r\n                       !bottomHandler ||\r\n                       !rightHandler;\r\n\r\n  if (needsRecreate) {\r\n    // Remove existing handlers\r\n    overlay.innerHTML = '';\r\n\r\n    // Recreate all handlers using new factory functions\r\n    for (let i = 0; i < structure.columns - 1; i++) {\r\n      const handler = createIndexedResizeHandler(TABLE_RESIZE_HANDLERS.COLUMN, i, structure, rect, tableElement);\r\n      overlay.appendChild(handler);\r\n    }\r\n\r\n    for (let i = 0; i < structure.rows - 1; i++) {\r\n      const handler = createIndexedResizeHandler(TABLE_RESIZE_HANDLERS.ROW, i, structure, rect, tableElement);\r\n      overlay.appendChild(handler);\r\n    }\r\n\r\n    const newBottomHandler = createBoundaryResizeHandler(TABLE_RESIZE_HANDLERS.TABLE_BOTTOM, structure, rect);\r\n    overlay.appendChild(newBottomHandler);\r\n\r\n    const newRightHandler = createBoundaryResizeHandler(TABLE_RESIZE_HANDLERS.TABLE_RIGHT, structure, rect);\r\n    overlay.appendChild(newRightHandler);\r\n  } else {\r\n    // Just update positions\r\n    columnHandlers.forEach((handler, index) => {\r\n      positionResizeHandler(handler, TABLE_RESIZE_HANDLERS.COLUMN, index, structure, rect, tableElement);\r\n    });\r\n\r\n    rowHandlers.forEach((handler, index) => {\r\n      positionResizeHandler(handler, TABLE_RESIZE_HANDLERS.ROW, index, structure, rect, tableElement);\r\n    });\r\n\r\n    if (bottomHandler) {\r\n      positionResizeHandler(bottomHandler, TABLE_RESIZE_HANDLERS.TABLE_BOTTOM, null, structure, rect, null);\r\n    }\r\n\r\n    if (rightHandler) {\r\n      positionResizeHandler(rightHandler, TABLE_RESIZE_HANDLERS.TABLE_RIGHT, null, structure, rect, null);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Remove table resize overlay\r\n * @param {HTMLElement} overlay - Resize overlay to remove\r\n */\r\nexport function removeTableResizeOverlay(overlay) {\r\n  if (overlay && overlay.parentNode) {\r\n    overlay.parentNode.removeChild(overlay);\r\n  }\r\n}\r\n\r\n/**\r\n * Validate table element\r\n * @param {HTMLTableElement} tableElement - Table element to validate\r\n * @param {string} operationName - Name of the operation (for error messages)\r\n * @returns {boolean} Whether validation passed\r\n */\r\nfunction validateTable(tableElement, operationName = 'Operation') {\r\n  if (!isResizableTable(tableElement)) {\r\n    console.warn(`${operationName}: Invalid table element`);\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\n/**\r\n * Create new row with cells matching a reference row\r\n * @param {HTMLTableRowElement} referenceRow - Row to match cell count\r\n * @returns {HTMLTableRowElement} New row\r\n */\r\nfunction createRowWithCells(referenceRow) {\r\n  const newRow = document.createElement('tr');\r\n  const cellCount = referenceRow.cells.length;\r\n  \r\n  for (let i = 0; i < cellCount; i++) {\r\n    const newCell = document.createElement('td');\r\n    newCell.innerHTML = '&nbsp;';\r\n    newRow.appendChild(newCell);\r\n  }\r\n  \r\n  return newRow;\r\n}\r\n\r\n/**\r\n * Insert a new row at specified position\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} rowIndex - Index of the row\r\n * @param {number} offset - Offset from rowIndex (-1 for above, 1 for below)\r\n * @returns {HTMLTableRowElement} The newly created row, or null if failed\r\n */\r\nfunction insertRowAtPosition(tableElement, rowIndex, offset = 0) {\r\n  if (!validateTable(tableElement, 'insertRowAtPosition')) {\r\n    return null;\r\n  }\r\n\r\n  const targetIndex = offset === -1 ? rowIndex : rowIndex + 1;\r\n\r\n  if (targetIndex < 0 || targetIndex > tableElement.rows.length) {\r\n    console.warn(`insertRowAtPosition: Invalid row index ${targetIndex}, table has ${tableElement.rows.length} rows`);\r\n    return null;\r\n  }\r\n\r\n  const referenceRow = tableElement.rows[offset === -1 ? rowIndex : rowIndex];\r\n  if (!referenceRow) {\r\n    console.warn(`insertRowAtPosition: Could not find reference row at index ${rowIndex}`);\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    const newRow = createRowWithCells(referenceRow);\r\n    \r\n    if (targetIndex < tableElement.rows.length) {\r\n      tableElement.rows[targetIndex].parentNode.insertBefore(newRow, tableElement.rows[targetIndex]);\r\n    } else {\r\n      tableElement.rows[tableElement.rows.length - 1].parentNode.appendChild(newRow);\r\n    }\r\n\r\n    synchronizeTableColgroup(tableElement);\r\n    const structure = getTableStructure(tableElement);\r\n    if (structure) {\r\n      applyTableDimensions(tableElement, {\r\n        columnWidths: structure.columnWidths,\r\n        rowHeights: structure.rowHeights\r\n      });\r\n    }\r\n\r\n    return newRow;\r\n  } catch (error) {\r\n    console.error('insertRowAtPosition: Failed to insert row', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Insert a new row above the specified row index\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} rowIndex - Index of the row to insert above\r\n * @returns {HTMLTableRowElement} The newly created row, or null if failed\r\n */\r\nexport function insertRowAbove(tableElement, rowIndex) {\r\n  return insertRowAtPosition(tableElement, rowIndex, -1);\r\n}\r\n\r\n/**\r\n * Insert a new row below the specified row index\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} rowIndex - Index of the row to insert below\r\n * @returns {HTMLTableRowElement} The newly created row, or null if failed\r\n */\r\nexport function insertRowBelow(tableElement, rowIndex) {\r\n  return insertRowAtPosition(tableElement, rowIndex, 1);\r\n}\r\n\r\n/**\r\n * Create new column cell for table row\r\n * @returns {HTMLTableCellElement} New cell\r\n */\r\nfunction createColumnCell() {\r\n  const newCell = document.createElement('td');\r\n  newCell.innerHTML = '&nbsp;';\r\n  return newCell;\r\n}\r\n\r\n/**\r\n * Insert a new column at specified position\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} columnIndex - Index of the column\r\n * @param {number} offset - Offset from columnIndex (-1 for left, 1 for right)\r\n * @returns {boolean} Whether the operation was successful\r\n */\r\nfunction insertColumnAtPosition(tableElement, columnIndex, offset = 0) {\r\n  if (!validateTable(tableElement, 'insertColumnAtPosition')) {\r\n    return false;\r\n  }\r\n\r\n  if (columnIndex < 0) {\r\n    console.warn(`insertColumnAtPosition: Invalid column index ${columnIndex}`);\r\n    return false;\r\n  }\r\n\r\n  const rows = Array.from(tableElement.rows);\r\n  if (rows.length === 0) {\r\n    console.warn('insertColumnAtPosition: Table has no rows');\r\n    return false;\r\n  }\r\n\r\n  const targetIndex = offset === -1 ? columnIndex : columnIndex + 1;\r\n\r\n  // Check if column index is valid\r\n  if (targetIndex > rows[0].cells.length) {\r\n    console.warn(`insertColumnAtPosition: Column index ${targetIndex} out of bounds`);\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    // Insert a cell in each row at the specified column index\r\n    for (const row of rows) {\r\n      const newCell = createColumnCell();\r\n\r\n      if (targetIndex < row.cells.length) {\r\n        row.insertBefore(newCell, row.cells[targetIndex]);\r\n      } else {\r\n        row.appendChild(newCell);\r\n      }\r\n    }\r\n\r\n    synchronizeTableColgroup(tableElement);\r\n    const structure = getTableStructure(tableElement);\r\n    if (structure) {\r\n      applyTableDimensions(tableElement, {\r\n        columnWidths: structure.columnWidths,\r\n        rowHeights: structure.rowHeights\r\n      });\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    console.error('insertColumnAtPosition: Failed to insert column', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Insert a new column to the left of the specified column index\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} columnIndex - Index of the column to insert to the left of\r\n * @returns {boolean} Whether the operation was successful\r\n */\r\nexport function insertColumnLeft(tableElement, columnIndex) {\r\n  return insertColumnAtPosition(tableElement, columnIndex, -1);\r\n}\r\n\r\n/**\r\n * Insert a new column to the right of the specified column index\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} columnIndex - Index of the column to insert to the right of\r\n * @returns {boolean} Whether the operation was successful\r\n */\r\nexport function insertColumnRight(tableElement, columnIndex) {\r\n  return insertColumnAtPosition(tableElement, columnIndex, 1);\r\n}\r\n\r\n/**\r\n * Unified positioning function for all resize handlers\r\n * @param {HTMLElement} handler - Handler element to position\r\n * @param {string} type - Handler type\r\n * @param {number} index - Index for indexed handlers (column/row)\r\n * @param {Object} structure - Table structure\r\n * @param {DOMRect} rect - Table bounding rect\r\n * @param {HTMLTableElement} tableElement - Table element\r\n */\r\nfunction positionResizeHandler(handler, type, index, structure, rect, tableElement) {\r\n  switch (type) {\r\n    case TABLE_RESIZE_HANDLERS.COLUMN:\r\n      positionColumnHandler(handler, index, structure, rect, tableElement);\r\n      break;\r\n    case TABLE_RESIZE_HANDLERS.ROW:\r\n      positionRowHandler(handler, index, structure, rect, tableElement);\r\n      break;\r\n    case TABLE_RESIZE_HANDLERS.TABLE_BOTTOM:\r\n      positionBottomHandler(handler, structure, rect);\r\n      break;\r\n    case TABLE_RESIZE_HANDLERS.TABLE_RIGHT:\r\n      positionRightHandler(handler, structure, rect);\r\n      break;\r\n  }\r\n}\r\n\r\n/**\r\n * Position a column resize handler\r\n * @param {HTMLElement} handler - Handler element\r\n * @param {number} columnIndex - Index of the column\r\n * @param {Object} structure - Table structure\r\n * @param {DOMRect} rect - Table bounding rect\r\n * @param {HTMLTableElement} tableElement - Table element\r\n */\r\nfunction positionColumnHandler(handler, columnIndex, structure, rect, tableElement) {\r\n  // Get the actual position of the column border by measuring cells\r\n  if (tableElement?.rows.length > 0 && tableElement.rows[0].cells.length > columnIndex) {\r\n    const cellRect = tableElement.rows[0].cells[columnIndex].getBoundingClientRect();\r\n    const tableRect = tableElement.getBoundingClientRect();\r\n    handler.style.left = `${cellRect.right - tableRect.left - 2}px`;\r\n    handler.style.height = `${rect.height}px`;\r\n    return;\r\n  }\r\n\r\n  // Fallback to cumulative width calculation\r\n  let left = 0;\r\n  for (let i = 0; i <= columnIndex; i++) {\r\n    left += structure.columnWidths[i];\r\n  }\r\n  handler.style.left = `${left - 2}px`;\r\n  handler.style.height = `${rect.height}px`;\r\n}\r\n\r\n/**\r\n * Position a row resize handler\r\n * @param {HTMLElement} handler - Handler element\r\n * @param {number} rowIndex - Index of the row\r\n * @param {Object} structure - Table structure\r\n * @param {DOMRect} rect - Table bounding rect\r\n * @param {HTMLTableElement} tableElement - Table element\r\n */\r\nfunction positionRowHandler(handler, rowIndex, structure, rect, tableElement) {\r\n  // Get the actual position of the row border by measuring cells\r\n  if (tableElement?.rows.length > rowIndex && tableElement.rows[rowIndex].cells.length > 0) {\r\n    const cellRect = tableElement.rows[rowIndex].cells[0].getBoundingClientRect();\r\n    const tableRect = tableElement.getBoundingClientRect();\r\n    handler.style.top = `${cellRect.bottom - tableRect.top - 2}px`;\r\n    handler.style.width = `${rect.width}px`;\r\n    return;\r\n  }\r\n\r\n  // Fallback to cumulative height calculation\r\n  let top = 0;\r\n  for (let i = 0; i <= rowIndex; i++) {\r\n    top += structure.rowHeights[i];\r\n  }\r\n  handler.style.top = `${top - 2}px`;\r\n  handler.style.width = `${rect.width}px`;\r\n}\r\n\r\n/**\r\n * Position the bottom resize handler\r\n * @param {HTMLElement} handler - Handler element\r\n * @param {Object} structure - Table structure\r\n * @param {DOMRect} rect - Table bounding rect\r\n */\r\nfunction positionBottomHandler(handler, structure, rect) {\r\n  handler.style.bottom = '-2px';\r\n  handler.style.left = '0px';\r\n  handler.style.width = `${rect.width}px`;\r\n}\r\n\r\n/**\r\n * Position the right resize handler\r\n * @param {HTMLElement} handler - Handler element\r\n * @param {Object} structure - Table structure\r\n * @param {DOMRect} rect - Table bounding rect\r\n */\r\nfunction positionRightHandler(handler, structure, rect) {\r\n  handler.style.right = '-2px';\r\n  handler.style.top = '0px';\r\n  handler.style.height = `${rect.height}px`;\r\n}\r\n\r\n\r\n\r\n/**\r\n * Delete a row or column at specified index\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} index - Index of row/column to delete\r\n * @param {string} type - Type of deletion ('row' or 'column')\r\n * @returns {boolean} Whether the operation was successful\r\n */\r\nfunction deleteTableElement(tableElement, index, type) {\r\n  if (!validateTable(tableElement, `delete${type.charAt(0).toUpperCase() + type.slice(1)}`)) {\r\n    return false;\r\n  }\r\n\r\n  if (type === 'row') {\r\n    return deleteRowInternal(tableElement, index);\r\n  } else if (type === 'column') {\r\n    return deleteColumnInternal(tableElement, index);\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Internal row deletion logic\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} rowIndex - Index of the row to delete\r\n * @returns {boolean} Whether the operation was successful\r\n */\r\nfunction deleteRowInternal(tableElement, rowIndex) {\r\n  if (rowIndex < 0 || rowIndex >= tableElement.rows.length) {\r\n    console.warn(`deleteRow: Invalid row index ${rowIndex}, table has ${tableElement.rows.length} rows`);\r\n    return false;\r\n  }\r\n\r\n  // Don't allow deleting the last row\r\n  if (tableElement.rows.length <= 1) {\r\n    console.warn('deleteRow: Cannot delete the last row in the table');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const row = tableElement.rows[rowIndex];\r\n    row.parentNode.removeChild(row);\r\n\r\n    synchronizeTableColgroup(tableElement);\r\n    const structure = getTableStructure(tableElement);\r\n    if (structure) {\r\n      applyTableDimensions(tableElement, {\r\n        columnWidths: structure.columnWidths,\r\n        rowHeights: structure.rowHeights\r\n      });\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    console.error('deleteRow: Failed to delete row', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Internal column deletion logic\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} columnIndex - Index of the column to delete\r\n * @returns {boolean} Whether the operation was successful\r\n */\r\nfunction deleteColumnInternal(tableElement, columnIndex) {\r\n  if (columnIndex < 0) {\r\n    console.warn(`deleteColumn: Invalid column index ${columnIndex}`);\r\n    return false;\r\n  }\r\n\r\n  const rows = Array.from(tableElement.rows);\r\n  if (rows.length === 0) {\r\n    console.warn('deleteColumn: Table has no rows');\r\n    return false;\r\n  }\r\n\r\n  // Check if column index is valid\r\n  if (columnIndex >= rows[0].cells.length) {\r\n    console.warn(`deleteColumn: Column index ${columnIndex} out of bounds`);\r\n    return false;\r\n  }\r\n\r\n  // Don't allow deleting if it's the last column\r\n  if (rows[0].cells.length <= 1) {\r\n    console.warn('deleteColumn: Cannot delete the last column in the table');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    // Delete the cell at the specified column index from each row\r\n    for (const row of rows) {\r\n      if (row.cells.length > columnIndex) {\r\n        row.removeChild(row.cells[columnIndex]);\r\n      }\r\n    }\r\n\r\n    synchronizeTableColgroup(tableElement);\r\n    const structure = getTableStructure(tableElement);\r\n    if (structure) {\r\n      applyTableDimensions(tableElement, {\r\n        columnWidths: structure.columnWidths,\r\n        rowHeights: structure.rowHeights\r\n      });\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    console.error('deleteColumn: Failed to delete column', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete a row at the specified row index\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} rowIndex - Index of the row to delete\r\n * @returns {boolean} Whether the operation was successful\r\n */\r\nexport function deleteRow(tableElement, rowIndex) {\r\n  return deleteTableElement(tableElement, rowIndex, 'row');\r\n}\r\n\r\n/**\r\n * Delete a column at the specified column index\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} columnIndex - Index of the column to delete\r\n * @returns {boolean} Whether the operation was successful\r\n */\r\nexport function deleteColumn(tableElement, columnIndex) {\r\n  return deleteTableElement(tableElement, columnIndex, 'column');\r\n}","import React, { useEffect, useRef, useCallback, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useDocumentActions } from '../../context/DocumentContext';\r\nimport { suppressEvent } from '../../lib/editor/dom-utils';\r\nimport {\r\n  isResizableTable,\r\n  createTableResizeOverlay,\r\n  removeTableResizeOverlay,\r\n  updateTableResizeOverlay,\r\n  calculateTableResizeDimensions,\r\n  getTableStructure,\r\n  applyTableDimensions,\r\n  TABLE_RESIZE_HANDLERS,\r\n  DEFAULT_TABLE_RESIZE_OPTIONS\r\n} from '../../lib/editor/table-resize-utils';\r\n\r\n/**\r\n * TableResizeHandlers - Component for handling table resize operations\r\n * Provides resize handlers for table columns, rows, and overall table size\r\n */\r\nconst TableResizeHandlers = ({\r\n  editorRef,\r\n  onTableResize,\r\n  onTableSelect,\r\n  onTableDeselect,\r\n  resizeOptions = DEFAULT_TABLE_RESIZE_OPTIONS\r\n}) => {\r\n  const resizeOverlayRef = useRef(null);\r\n  const resizeTableRef = useRef(null);\r\n  const resizeStartRef = useRef(null);\r\n  const resizeTypeRef = useRef(null);\r\n  const resizeIndexRef = useRef(null);\r\n  const resizeOptionsRef = useRef(resizeOptions);\r\n  const isResizingRef = useRef(false);\r\n  const [selectedTable, setSelectedTable] = useState(null);\r\n  const actions = useDocumentActions();\r\n\r\n  // Update resize options when they change\r\n  useEffect(() => {\r\n    resizeOptionsRef.current = resizeOptions;\r\n  }, [resizeOptions]);\r\n\r\n  /**\r\n   * Clear table selection\r\n   */\r\n  const clearTableSelection = useCallback(() => {\r\n    if (resizeTableRef.current) {\r\n      resizeTableRef.current.classList.remove('selected');\r\n      resizeTableRef.current = null;\r\n    }\r\n\r\n    if (resizeOverlayRef.current) {\r\n      removeTableResizeOverlay(resizeOverlayRef.current);\r\n      resizeOverlayRef.current = null;\r\n    }\r\n\r\n    setSelectedTable(null);\r\n    resizeStartRef.current = null;\r\n    resizeTypeRef.current = null;\r\n    resizeIndexRef.current = null;\r\n    isResizingRef.current = false;\r\n\r\n    // Notify parent\r\n    if (onTableDeselect) {\r\n      onTableDeselect();\r\n    }\r\n  }, [onTableDeselect]);\r\n\r\n  /**\r\n   * Start table resize operation\r\n   */\r\n  const handleResizeStart = useCallback((event) => {\r\n    suppressEvent(event);\r\n\r\n    if (!resizeTableRef.current) return;\r\n\r\n    const handler = event.currentTarget;\r\n    const type = handler.dataset.type;\r\n    const index = parseInt(handler.dataset.index, 10);\r\n\r\n    const tableRect = resizeTableRef.current.getBoundingClientRect();\r\n    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\r\n    const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;\r\n\r\n    // Store the original state for undo\r\n    const structure = getTableStructure(resizeTableRef.current);\r\n    resizeStartRef.current = {\r\n      x: event.clientX,\r\n      y: event.clientY,\r\n      structure: { ...structure }\r\n    };\r\n\r\n    resizeTypeRef.current = type;\r\n    resizeIndexRef.current = index;\r\n    isResizingRef.current = true;\r\n\r\n    // Add resize class to prevent text selection\r\n    document.body.classList.add('table-resize-in-progress');\r\n\r\n    // Update cursor based on resize type\r\n    const cursorMap = {\r\n      [TABLE_RESIZE_HANDLERS.COLUMN]: 'col-resize',\r\n      [TABLE_RESIZE_HANDLERS.ROW]: 'row-resize',\r\n      [TABLE_RESIZE_HANDLERS.TABLE_BOTTOM]: 'ns-resize',\r\n      [TABLE_RESIZE_HANDLERS.TABLE_RIGHT]: 'ew-resize'\r\n    };\r\n    const cursor = cursorMap[type] || 'default';\r\n    document.body.style.cursor = cursor;\r\n\r\n    // Add global event listeners\r\n    document.addEventListener('mousemove', handleResizeMove);\r\n    document.addEventListener('mouseup', handleResizeEnd);\r\n  }, []);\r\n\r\n  /**\r\n   * Create and attach resize overlay for a table\r\n   */\r\n  const createAndAttachOverlay = useCallback((tableElement) => {\r\n    const overlay = createTableResizeOverlay(tableElement, resizeOptionsRef.current);\r\n    if (overlay) {\r\n      resizeOverlayRef.current = overlay;\r\n      resizeTableRef.current = tableElement;\r\n\r\n      // Add overlay to document body\r\n      document.body.appendChild(overlay);\r\n\r\n      // Add event listeners to handlers\r\n      const handlers = overlay.querySelectorAll('.table-resize-handler');\r\n      handlers.forEach(handler => {\r\n        handler.addEventListener('mousedown', handleResizeStart);\r\n      });\r\n    }\r\n    return overlay;\r\n  }, [handleResizeStart]);\r\n\r\n  /**\r\n   * Handle table selection\r\n   */\r\n  const handleTableSelection = useCallback((tableElement) => {\r\n    if (!isResizableTable(tableElement)) return;\r\n\r\n    // Clear any existing resize overlay\r\n    if (resizeOverlayRef.current) {\r\n      removeTableResizeOverlay(resizeOverlayRef.current);\r\n      resizeOverlayRef.current = null;\r\n    }\r\n\r\n    // Mark table as selected\r\n    tableElement.classList.add('selected');\r\n\r\n    // Create resize overlay\r\n    const overlay = createAndAttachOverlay(tableElement);\r\n    if (overlay) {\r\n      setSelectedTable(tableElement);\r\n      // Notify parent\r\n      if (onTableSelect) {\r\n        onTableSelect(tableElement);\r\n      }\r\n    }\r\n  }, [onTableSelect, createAndAttachOverlay]);\r\n\r\n  /**\r\n   * Perform table resize operation\r\n   */\r\n  const handleResizeMove = useCallback((event) => {\r\n    if (!isResizingRef.current || !resizeTableRef.current || !resizeStartRef.current || !resizeTypeRef.current) return;\r\n\r\n    suppressEvent(event);\r\n\r\n    const { x: startX, y: startY, structure: startStructure } = resizeStartRef.current;\r\n    const type = resizeTypeRef.current;\r\n    const index = resizeIndexRef.current;\r\n    const currentX = event.clientX;\r\n    const currentY = event.clientY;\r\n\r\n    // Calculate delta based on resize type\r\n    let delta = 0;\r\n    switch (type) {\r\n      case TABLE_RESIZE_HANDLERS.COLUMN:\r\n        delta = currentX - startX;\r\n        break;\r\n      case TABLE_RESIZE_HANDLERS.ROW:\r\n        delta = currentY - startY;\r\n        break;\r\n      case TABLE_RESIZE_HANDLERS.TABLE_BOTTOM:\r\n        delta = currentY - startY;\r\n        break;\r\n      case TABLE_RESIZE_HANDLERS.TABLE_RIGHT:\r\n        delta = currentX - startX;\r\n        break;\r\n    }\r\n\r\n    // Calculate new dimensions\r\n    const newDimensions = calculateTableResizeDimensions({\r\n      type,\r\n      index,\r\n      delta,\r\n      currentStructure: startStructure,\r\n      options: resizeOptionsRef.current\r\n    });\r\n\r\n    // Apply new dimensions to the table\r\n    applyTableDimensions(resizeTableRef.current, newDimensions, type);\r\n\r\n    // Update resize overlay\r\n    if (resizeOverlayRef.current) {\r\n      updateTableResizeOverlay(resizeOverlayRef.current, resizeTableRef.current);\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * End table resize operation\r\n   */\r\n  const handleResizeEnd = useCallback((event) => {\r\n    if (!isResizingRef.current) return;\r\n\r\n    suppressEvent(event);\r\n\r\n    // Record the resize operation for undo before clearing refs\r\n    if (resizeTableRef.current && resizeStartRef.current) {\r\n      const beforeState = {\r\n        structure: resizeStartRef.current.structure\r\n      };\r\n      const afterState = {\r\n        structure: getTableStructure(resizeTableRef.current)\r\n      };\r\n\r\n      // Only record if dimensions actually changed\r\n      const hasChanged =\r\n        beforeState.structure.width !== afterState.structure.width ||\r\n        beforeState.structure.height !== afterState.structure.height ||\r\n        JSON.stringify(beforeState.structure.columnWidths) !== JSON.stringify(afterState.structure.columnWidths) ||\r\n        JSON.stringify(beforeState.structure.rowHeights) !== JSON.stringify(afterState.structure.rowHeights);\r\n\r\n      if (hasChanged) {\r\n        actions.recordOperation(\r\n          { type: 'TABLE_RESIZE', payload: { element: resizeTableRef.current, state: afterState } },\r\n          { type: 'TABLE_RESIZE', payload: { element: resizeTableRef.current, state: beforeState } }\r\n        );\r\n      }\r\n    }\r\n\r\n    resizeStartRef.current = null;\r\n    resizeTypeRef.current = null;\r\n    resizeIndexRef.current = null;\r\n    isResizingRef.current = false;\r\n\r\n    // Remove global event listeners\r\n    document.removeEventListener('mousemove', handleResizeMove);\r\n    document.removeEventListener('mouseup', handleResizeEnd);\r\n\r\n    // Remove resize classes\r\n    document.body.classList.remove('table-resize-in-progress');\r\n    document.body.style.cursor = '';\r\n\r\n    // Update content in document context\r\n    if (resizeTableRef.current) {\r\n      // Trigger input event to update document state\r\n      const inputEvent = new Event('input', { bubbles: true, cancelable: true });\r\n      resizeTableRef.current.dispatchEvent(inputEvent);\r\n\r\n      // Notify parent about resize\r\n      if (onTableResize) {\r\n        onTableResize(resizeTableRef.current, getTableStructure(resizeTableRef.current));\r\n      }\r\n    }\r\n  }, [onTableResize, actions]);\r\n\r\n  /**\r\n   * Handle click on editor to select tables\r\n   */\r\n  const handleEditorClick = useCallback((event) => {\r\n    // Clear selection if clicking outside a table\r\n    if (resizeOverlayRef.current && !resizeOverlayRef.current.contains(event.target)) {\r\n      clearTableSelection();\r\n    }\r\n\r\n    // Check if clicked on a table\r\n    const target = event.target;\r\n    const tableElement = target.closest('table');\r\n\r\n    if (tableElement && isResizableTable(tableElement)) {\r\n      // If already selected, don't reselect\r\n      if (tableElement === resizeTableRef.current) {\r\n        return;\r\n      }\r\n\r\n      // Select the new table\r\n      handleTableSelection(tableElement);\r\n    }\r\n  }, [handleTableSelection, clearTableSelection]);\r\n\r\n  /**\r\n   * Handle keydown events (for deleting selected tables, etc.)\r\n   */\r\n  const handleKeyDown = useCallback((event) => {\r\n    // Delete selected table with Delete key only\r\n    if (event.key === 'Delete' &&\r\n        resizeTableRef.current &&\r\n        !isResizingRef.current) {\r\n\r\n      // Prevent default behavior\r\n      event.preventDefault();\r\n\r\n      // Remove the table\r\n      const tableToRemove = resizeTableRef.current;\r\n      if (tableToRemove.parentNode) {\r\n        tableToRemove.parentNode.removeChild(tableToRemove);\r\n\r\n        // Clear selection\r\n        clearTableSelection();\r\n\r\n        // Trigger input event to update document state\r\n        const inputEvent = new Event('input', { bubbles: true, cancelable: true });\r\n        editorRef.current.dispatchEvent(inputEvent);\r\n      }\r\n    }\r\n\r\n    // For Backspace key, allow normal text editing behavior in cells\r\n    // Don't prevent default - let the browser handle text deletion in cells\r\n\r\n    // Escape key to clear selection\r\n    if (event.key === 'Escape' && resizeTableRef.current) {\r\n      clearTableSelection();\r\n    }\r\n  }, [editorRef, clearTableSelection]);\r\n\r\n  /**\r\n   * Handle scroll events to update overlay position\r\n   */\r\n  const handleScroll = useCallback(() => {\r\n    if (resizeOverlayRef.current && resizeTableRef.current) {\r\n      updateTableResizeOverlay(resizeOverlayRef.current, resizeTableRef.current);\r\n    }\r\n  }, []);\r\n\r\n  // Add scroll listener to editor viewport\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const editor = editorRef.current;\r\n    const viewport = editor.closest('.editor-viewport');\r\n\r\n    if (viewport) {\r\n      // Add scroll listener to viewport\r\n      viewport.addEventListener('scroll', handleScroll);\r\n\r\n      // Also listen to window scroll in case of nested scrolling\r\n      window.addEventListener('scroll', handleScroll);\r\n    }\r\n\r\n    // Cleanup\r\n    return () => {\r\n      if (viewport) {\r\n        viewport.removeEventListener('scroll', handleScroll);\r\n      }\r\n      window.removeEventListener('scroll', handleScroll);\r\n    };\r\n  }, [editorRef, handleScroll]);\r\n\r\n  // Add event listeners when editor is available\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const editor = editorRef.current;\r\n\r\n    // Add event listeners\r\n    editor.addEventListener('click', handleEditorClick);\r\n    editor.addEventListener('keydown', handleKeyDown);\r\n\r\n    // Add window resize listener\r\n    window.addEventListener('resize', handleScroll);\r\n\r\n    // Cleanup\r\n    return () => {\r\n      editor.removeEventListener('click', handleEditorClick);\r\n      editor.removeEventListener('keydown', handleKeyDown);\r\n\r\n      window.removeEventListener('resize', handleScroll);\r\n\r\n      // Clean up any active resize operations\r\n      if (isResizingRef.current) {\r\n        document.removeEventListener('mousemove', handleResizeMove);\r\n        document.removeEventListener('mouseup', handleResizeEnd);\r\n        document.body.classList.remove('table-resize-in-progress');\r\n        document.body.style.cursor = '';\r\n      }\r\n\r\n      // Remove overlay\r\n      if (resizeOverlayRef.current) {\r\n        removeTableResizeOverlay(resizeOverlayRef.current);\r\n      }\r\n    };\r\n  }, [editorRef, handleEditorClick, handleKeyDown, handleScroll, handleResizeMove, handleResizeEnd]);\r\n\r\n  // Add a mutation observer to detect when tables are added/removed or structure changes\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const observer = new MutationObserver((mutations) => {\r\n      mutations.forEach((mutation) => {\r\n        if (mutation.type === 'childList') {\r\n          // Handle removed tables\r\n          mutation.removedNodes.forEach(node => {\r\n            if (node.nodeType === Node.ELEMENT_NODE && isResizableTable(node) && node === selectedTable) {\r\n              clearTableSelection();\r\n            }\r\n          });\r\n\r\n          // Handle added tables - auto-select the first one\r\n          mutation.addedNodes.forEach(node => {\r\n            if (node.nodeType !== Node.ELEMENT_NODE) return;\r\n\r\n            // Check if node itself is a table\r\n            if (isResizableTable(node)) {\r\n              setTimeout(() => handleTableSelection(node), 50);\r\n              return;\r\n            }\r\n\r\n            // Check if node contains tables\r\n            const tables = node.querySelectorAll?.('table') || [];\r\n            if (tables.length > 0) {\r\n              setTimeout(() => handleTableSelection(tables[0]), 50);\r\n            }\r\n          });\r\n\r\n          // Check for row changes in selected table\r\n          if (selectedTable) {\r\n            const hasRowChanges = [...mutation.addedNodes, ...mutation.removedNodes].some(node =>\r\n              node.nodeType === Node.ELEMENT_NODE && node.tagName === 'TR'\r\n            );\r\n            if (hasRowChanges && resizeOverlayRef.current && resizeTableRef.current) {\r\n              removeTableResizeOverlay(resizeOverlayRef.current);\r\n              resizeOverlayRef.current = null;\r\n              createAndAttachOverlay(resizeTableRef.current);\r\n            }\r\n          }\r\n        } else if (mutation.type === 'attributes' && ['colspan', 'rowspan'].includes(mutation.attributeName)) {\r\n          // Handle colspan/rowspan changes on selected table\r\n          if (selectedTable && resizeOverlayRef.current && resizeTableRef.current) {\r\n            removeTableResizeOverlay(resizeOverlayRef.current);\r\n            resizeOverlayRef.current = null;\r\n            createAndAttachOverlay(resizeTableRef.current);\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    observer.observe(editorRef.current, {\r\n      childList: true,\r\n      subtree: true,\r\n      attributes: true,\r\n      attributeFilter: ['colspan', 'rowspan']\r\n    });\r\n\r\n    return () => observer.disconnect();\r\n  }, [editorRef, selectedTable, clearTableSelection, handleTableSelection, createAndAttachOverlay]);\r\n\r\n  // This component doesn't render anything visible - it just manages the resize functionality\r\n  return null;\r\n};\r\n\r\nTableResizeHandlers.propTypes = {\r\n  editorRef: PropTypes.shape({\r\n    current: PropTypes.instanceOf(typeof Element !== 'undefined' ? Element : Object)\r\n  }).isRequired,\r\n  onTableResize: PropTypes.func,\r\n  onTableSelect: PropTypes.func,\r\n  onTableDeselect: PropTypes.func,\r\n  resizeOptions: PropTypes.shape({\r\n    minColumnWidth: PropTypes.number,\r\n    minRowHeight: PropTypes.number,\r\n    maxColumnWidth: PropTypes.number,\r\n    maxRowHeight: PropTypes.number,\r\n    tableMinWidth: PropTypes.number,\r\n    tableMinHeight: PropTypes.number,\r\n    tableMaxWidth: PropTypes.number,\r\n    tableMaxHeight: PropTypes.number\r\n  })\r\n};\r\n\r\nTableResizeHandlers.defaultProps = {\r\n  onTableResize: undefined,\r\n  onTableSelect: undefined,\r\n  onTableDeselect: undefined,\r\n  resizeOptions: DEFAULT_TABLE_RESIZE_OPTIONS\r\n};\r\n\r\nexport default TableResizeHandlers;","import React, { useState, useEffect, useRef, useLayoutEffect, useCallback, useMemo } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { AlignLeft, AlignCenter, AlignRight, ArrowUp, ArrowDown, ArrowLeft, ArrowRight, Trash2 } from 'lucide-react';\r\nimport PropTypes from 'prop-types';\r\nimport { useDocumentActions } from '../../context/DocumentContext';\r\nimport { \r\n  updateTableResizeOverlay, \r\n  insertRowAbove, \r\n  insertRowBelow, \r\n  insertColumnLeft, \r\n  insertColumnRight, \r\n  deleteRow, \r\n  deleteColumn \r\n} from '../../lib/editor/table-resize-utils';\r\n\r\n// Constants for button styling and operation types\r\nconst BUTTON_BASE_STYLE = {\r\n  border: '1px solid #ccc',\r\n  borderRadius: '4px',\r\n  padding: '4px',\r\n  cursor: 'pointer',\r\n  display: 'flex',\r\n  alignItems: 'center',\r\n  justifyContent: 'center',\r\n  minWidth: '28px',\r\n  height: '28px'\r\n};\r\n\r\nconst ALIGNMENT_STYLES = {\r\n  left: { float: 'left', margin: '10px 10px 10px 0', marginLeft: '', marginRight: '' },\r\n  center: { float: 'none', margin: '10px auto', marginLeft: 'auto', marginRight: 'auto' },\r\n  right: { float: 'right', margin: '10px 0 10px 10px', marginLeft: '', marginRight: '' }\r\n};\r\n\r\nconst OPERATION_TYPES = {\r\n  INSERT_ROW_ABOVE: 'INSERT_ROW_ABOVE',\r\n  INSERT_ROW_BELOW: 'INSERT_ROW_BELOW',\r\n  INSERT_COL_LEFT: 'INSERT_COL_LEFT',\r\n  INSERT_COL_RIGHT: 'INSERT_COL_RIGHT',\r\n  DELETE_ROW: 'DELETE_ROW',\r\n  DELETE_COL: 'DELETE_COL'\r\n};\r\n\r\n/**\r\n * Helper utility to sync resize overlay position\r\n */\r\nconst syncResizeOverlay = (element) => {\r\n  if (!element) return;\r\n  \r\n  const callback = (el) => {\r\n    const overlay = document.querySelector('.table-resize-overlay');\r\n    if (overlay) {\r\n      updateTableResizeOverlay(overlay, el);\r\n    }\r\n  };\r\n\r\n  if (typeof window !== 'undefined' && window.requestAnimationFrame) {\r\n    window.requestAnimationFrame(() => callback(element));\r\n  } else {\r\n    setTimeout(() => callback(element), 16);\r\n  }\r\n};\r\n\r\n/**\r\n * Helper utility to get current table alignment state\r\n */\r\nconst getTableAlignmentState = (element) => {\r\n  if (!element) return null;\r\n  const style = window.getComputedStyle(element);\r\n  return {\r\n    float: style.float || 'none',\r\n    margin: element.style.margin || '',\r\n    marginLeft: element.style.marginLeft || '',\r\n    marginRight: element.style.marginRight || '',\r\n    display: style.display || 'table'\r\n  };\r\n};\r\n\r\n/**\r\n * TableTooltipMenu - Component for table tooltip menu with alignment options and row/column manipulation\r\n */\r\nconst TableTooltipMenu = ({\r\n  tableElement,\r\n  onAlignChange,\r\n  onClose,\r\n  selectedRowIndex,\r\n  selectedColIndex,\r\n  editorRef\r\n}) => {\r\n  const [position, setPosition] = useState({ top: 0, left: 0 });\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const [menuPosition, setMenuPosition] = useState('top'); // 'top' or 'bottom'\r\n  const [currentAlignment, setCurrentAlignment] = useState('left');\r\n  const menuRef = useRef(null);\r\n  const actions = useDocumentActions();\r\n\r\n  // Determine current alignment of the table\r\n  const getCurrentAlignment = useCallback(() => {\r\n    if (!tableElement) return 'left';\r\n    const style = window.getComputedStyle(tableElement);\r\n\r\n    // Check for center alignment (margin auto)\r\n    if (style.marginLeft === 'auto' && style.marginRight === 'auto') return 'center';\r\n\r\n    // Check for float alignment\r\n    if (style.float === 'right') return 'right';\r\n    if (style.float === 'left') return 'left';\r\n\r\n    return 'left';\r\n  }, [tableElement]);\r\n\r\n  // Update current alignment when table element changes\r\n  useEffect(() => {\r\n    if (tableElement) {\r\n      setCurrentAlignment(getCurrentAlignment());\r\n    }\r\n  }, [tableElement, getCurrentAlignment]);\r\n\r\n  const calculateMenuPosition = useCallback(() => {\r\n    if (!tableElement || !menuRef.current) return;\r\n\r\n    const tableRect = tableElement.getBoundingClientRect();\r\n    const menuRect = menuRef.current.getBoundingClientRect();\r\n\r\n    const viewportRect = window.visualViewport ? window.visualViewport : {\r\n      width: window.innerWidth,\r\n      height: window.innerHeight,\r\n      offsetTop: 0,\r\n      offsetLeft: 0\r\n    };\r\n\r\n    // Check if table is visible in viewport\r\n    const isTableInViewport = (\r\n      tableRect.bottom >= 0 &&\r\n      tableRect.top <= viewportRect.height &&\r\n      tableRect.right >= 0 &&\r\n      tableRect.left <= viewportRect.width\r\n    );\r\n\r\n    let menuPosition = 'top';\r\n    let top = 0;\r\n    let left = 0;\r\n\r\n    if (isTableInViewport) {\r\n      const spaceAbove = tableRect.top - menuRect.height - 10;\r\n      const spaceBelow = viewportRect.height - tableRect.bottom - menuRect.height - 10;\r\n\r\n      if (spaceBelow > spaceAbove && spaceBelow > 0) {\r\n        menuPosition = 'bottom';\r\n        top = tableRect.bottom + 10;\r\n      } else {\r\n        menuPosition = 'top';\r\n        top = tableRect.top - menuRect.height - 10;\r\n      }\r\n    } else {\r\n      menuPosition = 'top';\r\n      top = 10;\r\n    }\r\n\r\n    left = tableRect.left + (tableRect.width / 2) - (menuRect.width / 2);\r\n\r\n    // Ensure the menu stays within viewport\r\n    const viewportWidth = window.innerWidth;\r\n    const viewportHeight = window.innerHeight;\r\n\r\n    let adjustedLeft = Math.max(10, Math.min(left, viewportWidth - menuRect.width - 10));\r\n    let adjustedTop = Math.max(10, Math.min(top, viewportHeight - menuRect.height - 10));\r\n\r\n    setPosition({ top: adjustedTop, left: adjustedLeft });\r\n    setMenuPosition(menuPosition);\r\n    setIsVisible(true);\r\n  }, [tableElement]);\r\n\r\n  // Position the tooltip menu\r\n  useLayoutEffect(() => {\r\n    // Initial positioning\r\n    calculateMenuPosition();\r\n\r\n    // Add scroll listener to update position on scroll\r\n    const handleScroll = () => {\r\n      calculateMenuPosition();\r\n    };\r\n\r\n    // Add window scroll listener for safety\r\n    window.addEventListener('scroll', handleScroll);\r\n    window.addEventListener('resize', handleScroll);\r\n\r\n    return () => {\r\n      window.removeEventListener('scroll', handleScroll);\r\n      window.removeEventListener('resize', handleScroll);\r\n      setIsVisible(false);\r\n    };\r\n  }, [tableElement, calculateMenuPosition]);\r\n\r\n  // Close menu when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (menuRef.current && !menuRef.current.contains(event.target) &&\r\n          event.target !== tableElement && !tableElement.contains(event.target)) {\r\n        onClose();\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, [tableElement, onClose]);\r\n\r\n  // Handle table alignment\r\n  const handleAlign = useCallback((alignment) => {\r\n    if (!tableElement || !ALIGNMENT_STYLES[alignment]) return;\r\n\r\n    const beforeState = getTableAlignmentState(tableElement);\r\n    const oldAlignment = currentAlignment;\r\n    const styles = ALIGNMENT_STYLES[alignment];\r\n\r\n    tableElement.style.float = styles.float;\r\n    tableElement.style.margin = styles.margin;\r\n    tableElement.style.marginLeft = styles.marginLeft;\r\n    tableElement.style.marginRight = styles.marginRight;\r\n\r\n    setCurrentAlignment(alignment);\r\n    syncResizeOverlay(tableElement);\r\n\r\n    const afterState = getTableAlignmentState(tableElement);\r\n\r\n    // Record operation for undo\r\n    actions.recordOperation(\r\n      { type: 'TABLE_ALIGN', payload: { element: tableElement, alignment, state: afterState } },\r\n      { type: 'TABLE_ALIGN', payload: { element: tableElement, alignment: oldAlignment, state: beforeState } }\r\n    );\r\n\r\n    onAlignChange?.(alignment);\r\n  }, [tableElement, currentAlignment, actions, onAlignChange]);\r\n\r\n  // Factory function to create table operation handlers\r\n  const createTableOperationHandler = useCallback((operationType, operationFn) => {\r\n    return () => {\r\n      if (!tableElement) return;\r\n\r\n      const isRowOperation = operationType.includes('ROW');\r\n      const selectedIndex = isRowOperation ? selectedRowIndex : selectedColIndex;\r\n\r\n      if (selectedIndex === null || selectedIndex === undefined) return;\r\n\r\n      const result = operationFn(tableElement, selectedIndex);\r\n      if (!result) return;\r\n\r\n      // Update editor content\r\n      if (editorRef?.current) {\r\n        actions.updateContinuousContent(editorRef.current.innerHTML);\r\n      }\r\n\r\n      // Record for undo\r\n      const payload = isRowOperation \r\n        ? { element: tableElement, index: selectedIndex }\r\n        : { element: tableElement, index: selectedIndex };\r\n\r\n      actions.recordOperation(\r\n        { type: operationType, payload },\r\n        { type: operationType, payload } // Reverse operation would be same type\r\n      );\r\n\r\n      syncResizeOverlay(tableElement);\r\n      requestAnimationFrame(() => calculateMenuPosition());\r\n    };\r\n  }, [tableElement, selectedRowIndex, selectedColIndex, editorRef, actions, calculateMenuPosition]);\r\n\r\n  // Create handlers using the factory pattern\r\n  const handleInsertRowAbove = useMemo(\r\n    () => createTableOperationHandler(OPERATION_TYPES.INSERT_ROW_ABOVE, insertRowAbove),\r\n    [createTableOperationHandler]\r\n  );\r\n\r\n  const handleInsertRowBelow = useMemo(\r\n    () => createTableOperationHandler(OPERATION_TYPES.INSERT_ROW_BELOW, insertRowBelow),\r\n    [createTableOperationHandler]\r\n  );\r\n\r\n  const handleInsertColumnLeft = useMemo(\r\n    () => createTableOperationHandler(OPERATION_TYPES.INSERT_COL_LEFT, insertColumnLeft),\r\n    [createTableOperationHandler]\r\n  );\r\n\r\n  const handleInsertColumnRight = useMemo(\r\n    () => createTableOperationHandler(OPERATION_TYPES.INSERT_COL_RIGHT, insertColumnRight),\r\n    [createTableOperationHandler]\r\n  );\r\n\r\n  const handleDeleteRow = useMemo(\r\n    () => createTableOperationHandler(OPERATION_TYPES.DELETE_ROW, deleteRow),\r\n    [createTableOperationHandler]\r\n  );\r\n\r\n  const handleDeleteColumn = useMemo(\r\n    () => createTableOperationHandler(OPERATION_TYPES.DELETE_COL, deleteColumn),\r\n    [createTableOperationHandler]\r\n  );\r\n\r\n  // Reusable button style helper\r\n  const getAlignmentButtonStyle = (isActive) => ({\r\n    ...BUTTON_BASE_STYLE,\r\n    background: isActive ? '#007bff' : 'transparent',\r\n    color: isActive ? '#fff' : '#333'\r\n  });\r\n\r\n  // Action button styles\r\n  const ACTION_BUTTON_STYLES = useMemo(() => ({\r\n    rowAction: { ...BUTTON_BASE_STYLE, background: '#28a745', color: '#fff' },\r\n    colAction: { ...BUTTON_BASE_STYLE, background: '#0056b3', color: '#fff' },\r\n    delete: { ...BUTTON_BASE_STYLE, background: '#dc3545', color: '#fff' },\r\n    divider: { width: '1px', height: '24px', background: '#ddd', margin: '0 4px' }\r\n  }), []);\r\n\r\n  // Menu container styles\r\n  const MENU_CONTAINER_STYLE = useMemo(() => ({\r\n    position: 'fixed',\r\n    top: `${position.top}px`,\r\n    left: `${position.left}px`,\r\n    zIndex: 999,\r\n    background: '#fff',\r\n    border: '1px solid #ddd',\r\n    borderRadius: '6px',\r\n    boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\r\n    padding: '8px',\r\n    display: 'flex',\r\n    gap: '2px',\r\n    alignItems: 'center',\r\n    pointerEvents: isVisible ? 'auto' : 'none',\r\n    minWidth: '100px',\r\n    minHeight: '32px',\r\n    opacity: isVisible ? 1 : 0,\r\n    visibility: isVisible ? 'visible' : 'hidden',\r\n    transition: 'opacity 0.15s ease, visibility 0.15s ease'\r\n  }), [position, isVisible]);\r\n\r\n  if (!tableElement) return null;\r\n\r\n  if (typeof document === 'undefined') {\r\n    return null;\r\n  }\r\n\r\n  return createPortal(\r\n    <div\r\n      ref={menuRef}\r\n      className=\"table-tooltip-menu\"\r\n      data-menu-position={menuPosition}\r\n      aria-hidden={!isVisible}\r\n      style={MENU_CONTAINER_STYLE}\r\n    >\r\n      {/* Alignment buttons */}\r\n      <button\r\n        className={`tooltip-button ${currentAlignment === 'left' ? 'active' : ''}`}\r\n        onClick={() => handleAlign('left')}\r\n        title=\"Align Left\"\r\n        style={getAlignmentButtonStyle(currentAlignment === 'left')}\r\n      >\r\n        <AlignLeft size={14} />\r\n      </button>\r\n\r\n      <button\r\n        className={`tooltip-button ${currentAlignment === 'center' ? 'active' : ''}`}\r\n        onClick={() => handleAlign('center')}\r\n        title=\"Align Center\"\r\n        style={getAlignmentButtonStyle(currentAlignment === 'center')}\r\n      >\r\n        <AlignCenter size={14} />\r\n      </button>\r\n\r\n      <button\r\n        className={`tooltip-button ${currentAlignment === 'right' ? 'active' : ''}`}\r\n        onClick={() => handleAlign('right')}\r\n        title=\"Align Right\"\r\n        style={getAlignmentButtonStyle(currentAlignment === 'right')}\r\n      >\r\n        <AlignRight size={14} />\r\n      </button>\r\n\r\n      {/* Row operations section */}\r\n      {selectedRowIndex !== null && selectedRowIndex !== undefined && (\r\n        <>\r\n          <div style={ACTION_BUTTON_STYLES.divider} />\r\n\r\n          <button\r\n            className=\"tooltip-button insert-row-above\"\r\n            onClick={handleInsertRowAbove}\r\n            title=\"Insert Row Above\"\r\n            style={ACTION_BUTTON_STYLES.rowAction}\r\n          >\r\n            <ArrowUp size={14} />\r\n          </button>\r\n\r\n          <button\r\n            className=\"tooltip-button insert-row-below\"\r\n            onClick={handleInsertRowBelow}\r\n            title=\"Insert Row Below\"\r\n            style={ACTION_BUTTON_STYLES.rowAction}\r\n          >\r\n            <ArrowDown size={14} />\r\n          </button>\r\n\r\n          <button\r\n            className=\"tooltip-button delete-row\"\r\n            onClick={handleDeleteRow}\r\n            title=\"Delete Row\"\r\n            style={ACTION_BUTTON_STYLES.delete}\r\n          >\r\n            <Trash2 size={14} />\r\n          </button>\r\n        </>\r\n      )}\r\n\r\n      {/* Column operations section */}\r\n      {selectedColIndex !== null && selectedColIndex !== undefined && (\r\n        <>\r\n          <div style={ACTION_BUTTON_STYLES.divider} />\r\n\r\n          <button\r\n            className=\"tooltip-button insert-column-left\"\r\n            onClick={handleInsertColumnLeft}\r\n            title=\"Insert Column Left\"\r\n            style={ACTION_BUTTON_STYLES.colAction}\r\n          >\r\n            <ArrowLeft size={14} />\r\n          </button>\r\n\r\n          <button\r\n            className=\"tooltip-button insert-column-right\"\r\n            onClick={handleInsertColumnRight}\r\n            title=\"Insert Column Right\"\r\n            style={ACTION_BUTTON_STYLES.colAction}\r\n          >\r\n            <ArrowRight size={14} />\r\n          </button>\r\n\r\n          <button\r\n            className=\"tooltip-button delete-column\"\r\n            onClick={handleDeleteColumn}\r\n            title=\"Delete Column\"\r\n            style={ACTION_BUTTON_STYLES.delete}\r\n          >\r\n            <Trash2 size={14} />\r\n          </button>\r\n        </>\r\n      )}\r\n    </div>,\r\n    document.body\r\n  );\r\n};\r\n\r\nTableTooltipMenu.propTypes = {\r\n  tableElement: PropTypes.instanceOf(typeof Element !== 'undefined' ? Element : Object),\r\n  onAlignChange: PropTypes.func,\r\n  onClose: PropTypes.func.isRequired,\r\n  selectedRowIndex: PropTypes.number,\r\n  selectedColIndex: PropTypes.number,\r\n  editorRef: PropTypes.shape({\r\n    current: PropTypes.instanceOf(typeof Element !== 'undefined' ? Element : Object)\r\n  })\r\n};\r\n\r\nTableTooltipMenu.defaultProps = {\r\n  tableElement: null,\r\n  onAlignChange: undefined,\r\n  selectedRowIndex: null,\r\n  selectedColIndex: null,\r\n  editorRef: null\r\n};\r\n\r\nexport default TableTooltipMenu;","import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { clearClasses, clearTextSelection, suppressEvent, isWithin } from '../../lib/editor/dom-utils';\r\n\r\n/**\r\n * TableCellSelection - Component for handling table cell selection with automatic row/column expansion\r\n * Features:\r\n * - Cell selection with mouse drag\r\n * - Auto-select entire row when >2 cells selected horizontally\r\n * - Auto-select entire column when 2 cells selected vertically\r\n * - Visual feedback for selections\r\n */\r\n\r\n// Selection class constants\r\nconst SELECTION_CLASSES = '.table-cell-selected, .table-row-selected, .table-col-selected';\r\n\r\n/**\r\n * Clear visual selection from all cells\r\n * Extracted as a helper to avoid duplicate code\r\n */\r\nconst clearVisualSelection = () => {\r\n  clearClasses(SELECTION_CLASSES, ['table-cell-selected', 'table-row-selected', 'table-col-selected']);\r\n};\r\n\r\nconst TableCellSelection = ({\r\n  editorRef,\r\n  onCellSelectionChange\r\n}) => {\r\n  // Selection state - consolidated into a ref since this is a headless component (renders null)\r\n  // and these values don't affect rendering, only internal logic\r\n  const selectionStateRef = useRef({\r\n    selectedCells: new Set(),\r\n    selectionMode: null,\r\n    selectedRowIndex: null,\r\n    selectedColIndex: null,\r\n    currentTable: null,\r\n    isSelecting: false,\r\n    hasDragged: false,\r\n    startCell: null\r\n  });\r\n\r\n  const [isSelecting, setIsSelecting] = useState(false);\r\n  const [hasDragged, setHasDragged] = useState(false);\r\n  const [startCell, setStartCell] = useState(null);\r\n  const [currentTable, setCurrentTable] = useState(null);\r\n\r\n  const lastSelectionRef = useRef(null); // Track last selection to avoid unnecessary callbacks\r\n\r\n  /**\r\n   * Reset all selection state\r\n   */\r\n  const resetSelectionState = useCallback(() => {\r\n    selectionStateRef.current = {\r\n      selectedCells: new Set(),\r\n      selectionMode: null,\r\n      selectedRowIndex: null,\r\n      selectedColIndex: null,\r\n      currentTable: null,\r\n      isSelecting: false,\r\n      hasDragged: false,\r\n      startCell: null\r\n    };\r\n    setIsSelecting(false);\r\n    setHasDragged(false);\r\n    setStartCell(null);\r\n    setCurrentTable(null);\r\n  }, []);\r\n\r\n  // Clear all selections\r\n  const clearSelection = useCallback(() => {\r\n    resetSelectionState();\r\n    clearVisualSelection();\r\n\r\n    // Only call callback if selection actually changed\r\n    if (lastSelectionRef.current !== null) {\r\n      lastSelectionRef.current = null;\r\n      if (onCellSelectionChange) {\r\n        onCellSelectionChange(null);\r\n      }\r\n    }\r\n  }, [onCellSelectionChange, resetSelectionState]);\r\n\r\n  // Get cell coordinates within table\r\n  const getCellCoordinates = useCallback((cell) => {\r\n    const row = cell.closest('tr');\r\n    const table = cell.closest('table');\r\n\r\n    if (!row || !table) return null;\r\n\r\n    const rowIndex = Array.from(table.rows).indexOf(row);\r\n    const cellIndex = Array.from(row.cells).indexOf(cell);\r\n\r\n    return { rowIndex, cellIndex, table };\r\n  }, []);\r\n\r\n  // Check if selection should expand to row or column\r\n  const checkSelectionExpansion = useCallback((cells) => {\r\n    if (cells.size === 0) return { mode: null, rowIndex: null, colIndex: null };\r\n\r\n    const cellArray = Array.from(cells);\r\n    const firstCell = cellArray[0];\r\n    const coords = getCellCoordinates(firstCell);\r\n\r\n    if (!coords) return { mode: null, rowIndex: null, colIndex: null };\r\n\r\n    const { table } = coords;\r\n\r\n    // Check for horizontal selection (same row, multiple cells)\r\n    const sameRowCells = cellArray.filter(cell => {\r\n      const cellCoords = getCellCoordinates(cell);\r\n      return cellCoords && cellCoords.table === table && cellCoords.rowIndex === coords.rowIndex;\r\n    });\r\n\r\n    if (sameRowCells.length >= 2) {\r\n      // 2 or more cells in same row - select entire row\r\n      return { mode: 'row', rowIndex: coords.rowIndex, colIndex: null };\r\n    }\r\n\r\n    // Check for vertical selection (same column, 2 or more cells)\r\n    const sameColCells = cellArray.filter(cell => {\r\n      const cellCoords = getCellCoordinates(cell);\r\n      return cellCoords && cellCoords.table === table && cellCoords.cellIndex === coords.cellIndex;\r\n    });\r\n\r\n    if (sameColCells.length >= 2) {\r\n      // 2 or more cells in same column - select entire column\r\n      return { mode: 'column', rowIndex: null, colIndex: coords.cellIndex };\r\n    }\r\n\r\n    // Single cell - no selection (allow editing)\r\n    return { mode: null, rowIndex: null, colIndex: null };\r\n  }, [getCellCoordinates]);\r\n\r\n  /**\r\n   * Apply visual selection based on selection mode\r\n   */\r\n  const applyVisualSelection = useCallback((mode, rowIndex, colIndex, cells, table) => {\r\n    clearVisualSelection();\r\n\r\n    if (!table || !mode) return;\r\n\r\n    if (mode === 'row' && rowIndex !== null) {\r\n      // Select entire row\r\n      const row = table.rows[rowIndex];\r\n      if (row) {\r\n        Array.from(row.cells).forEach(cell => {\r\n          cell.classList.add('table-row-selected');\r\n        });\r\n      }\r\n    } else if (mode === 'column' && colIndex !== null) {\r\n      // Select entire column\r\n      Array.from(table.rows).forEach(row => {\r\n        const cell = row.cells[colIndex];\r\n        if (cell) {\r\n          cell.classList.add('table-col-selected');\r\n        }\r\n      });\r\n    } else if (mode === 'cells') {\r\n      // Select individual cells\r\n      cells.forEach(cell => {\r\n        cell.classList.add('table-cell-selected');\r\n      });\r\n    }\r\n\r\n    // Clear any text selection when applying visual selection\r\n    clearTextSelection();\r\n  }, []);\r\n\r\n  // Update selection based on current state\r\n  const updateSelection = useCallback((newCells, table) => {\r\n    const expansion = checkSelectionExpansion(newCells);\r\n\r\n    // Update ref cache\r\n    selectionStateRef.current.selectedCells = newCells;\r\n    selectionStateRef.current.selectionMode = expansion.mode;\r\n    selectionStateRef.current.selectedRowIndex = expansion.rowIndex;\r\n    selectionStateRef.current.selectedColIndex = expansion.colIndex;\r\n    selectionStateRef.current.currentTable = table;\r\n\r\n    // Only update component state if needed for event listeners\r\n    setCurrentTable(table);\r\n\r\n    applyVisualSelection(expansion.mode, expansion.rowIndex, expansion.colIndex, newCells, table);\r\n\r\n    // Only call callback if selection actually changed\r\n    const newSelection = expansion.mode ? {\r\n      mode: expansion.mode,\r\n      cells: newCells,\r\n      rowIndex: expansion.rowIndex,\r\n      colIndex: expansion.colIndex,\r\n      table\r\n    } : null;\r\n\r\n    const hasChanged = JSON.stringify(lastSelectionRef.current) !== JSON.stringify(newSelection);\r\n    if (hasChanged) {\r\n      lastSelectionRef.current = newSelection;\r\n      if (onCellSelectionChange) {\r\n        onCellSelectionChange(newSelection);\r\n      }\r\n    }\r\n  }, [checkSelectionExpansion, applyVisualSelection, onCellSelectionChange]);\r\n\r\n  // Handle mouse down on table cell\r\n  const handleMouseDown = useCallback((event) => {\r\n    const cell = event.target.closest('td, th');\r\n    if (!cell) return;\r\n\r\n    const coords = getCellCoordinates(cell);\r\n    if (!coords) return;\r\n\r\n    setIsSelecting(true);\r\n    setStartCell(cell);\r\n    setCurrentTable(coords.table);\r\n    setHasDragged(false);\r\n  }, [getCellCoordinates]);\r\n\r\n  // Handle mouse enter on table cell (for drag selection)\r\n  const handleMouseEnter = useCallback((event) => {\r\n    if (!isSelecting || !startCell) return;\r\n\r\n    const cell = event.target.closest('td, th');\r\n    if (!cell || !currentTable || !isWithin(currentTable, cell)) return;\r\n\r\n    // Mark that we've started dragging\r\n    setHasDragged(true);\r\n\r\n    // Prevent default to avoid text selection during drag\r\n    suppressEvent(event);\r\n\r\n    const startCoords = getCellCoordinates(startCell);\r\n    const currentCoords = getCellCoordinates(cell);\r\n\r\n    if (!startCoords || !currentCoords || startCoords.table !== currentCoords.table) return;\r\n\r\n    // Create rectangular selection from start to current cell\r\n    const minRow = Math.min(startCoords.rowIndex, currentCoords.rowIndex);\r\n    const maxRow = Math.max(startCoords.rowIndex, currentCoords.rowIndex);\r\n    const minCol = Math.min(startCoords.cellIndex, currentCoords.cellIndex);\r\n    const maxCol = Math.max(startCoords.cellIndex, currentCoords.cellIndex);\r\n\r\n    const newCells = new Set();\r\n\r\n    for (let row = minRow; row <= maxRow; row++) {\r\n      const tableRow = currentTable.rows[row];\r\n      if (tableRow) {\r\n        for (let col = minCol; col <= maxCol; col++) {\r\n          const tableCell = tableRow.cells[col];\r\n          if (tableCell) {\r\n            newCells.add(tableCell);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    updateSelection(newCells, currentTable);\r\n  }, [isSelecting, startCell, currentTable, getCellCoordinates, updateSelection]);\r\n\r\n  // Handle mouse up\r\n  const handleMouseUp = useCallback(() => {\r\n    // If dragging occurred, keep the selection\r\n    // If no dragging occurred, it was a single click - don't apply any selection\r\n    if (!hasDragged) {\r\n      clearSelection();\r\n    }\r\n\r\n    setIsSelecting(false);\r\n    setStartCell(null);\r\n  }, [hasDragged, clearSelection]);\r\n\r\n  // Handle click outside to clear selection\r\n  const handleClickOutside = useCallback((event) => {\r\n    const cell = event.target.closest('td, th');\r\n    const table = event.target.closest('table');\r\n\r\n    // If clicking on a cell in the same table, don't clear\r\n    if (cell && currentTable && isWithin(currentTable, cell)) return;\r\n\r\n    // If clicking on a different table, clear selection\r\n    if (table && table !== currentTable) {\r\n      clearSelection();\r\n      return;\r\n    }\r\n\r\n    // If clicking outside any table, clear selection\r\n    if (!table) {\r\n      clearSelection();\r\n    }\r\n  }, [clearSelection, currentTable]);\r\n\r\n  // Add event listeners\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const editor = editorRef.current;\r\n\r\n    // Add cell selection event listeners\r\n    const handleMouseDownCapture = (event) => {\r\n      const cell = event.target.closest('td, th');\r\n      if (cell) {\r\n        handleMouseDown(event);\r\n      }\r\n    };\r\n\r\n    const handleMouseEnterCapture = (event) => {\r\n      const cell = event.target.closest('td, th');\r\n      if (cell) {\r\n        handleMouseEnter(event);\r\n      }\r\n    };\r\n\r\n    editor.addEventListener('mousedown', handleMouseDownCapture, true);\r\n    editor.addEventListener('mouseenter', handleMouseEnterCapture, true);\r\n    document.addEventListener('mouseup', handleMouseUp);\r\n    document.addEventListener('click', handleClickOutside);\r\n\r\n    return () => {\r\n      editor.removeEventListener('mousedown', handleMouseDownCapture, true);\r\n      editor.removeEventListener('mouseenter', handleMouseEnterCapture, true);\r\n      document.removeEventListener('mouseup', handleMouseUp);\r\n      document.removeEventListener('click', handleClickOutside);\r\n    };\r\n  }, [editorRef, handleMouseDown, handleMouseEnter, handleMouseUp, handleClickOutside]);\r\n\r\n  // Clear selection when table is deleted or changed\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const observer = new MutationObserver((mutations) => {\r\n      mutations.forEach((mutation) => {\r\n        if (mutation.type === 'childList') {\r\n          // Check if our selected table was removed\r\n          if (currentTable && !editorRef.current.contains(currentTable)) {\r\n            clearSelection();\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    observer.observe(editorRef.current, {\r\n      childList: true,\r\n      subtree: true\r\n    });\r\n\r\n    return () => observer.disconnect();\r\n  }, [editorRef, clearSelection, currentTable]);\r\n\r\n  // This component doesn't render anything visible - it just manages cell selection\r\n  return null;\r\n};\r\n\r\nTableCellSelection.propTypes = {\r\n  editorRef: PropTypes.shape({\r\n    current: PropTypes.instanceOf(typeof Element !== 'undefined' ? Element : Object)\r\n  }).isRequired,\r\n  onCellSelectionChange: PropTypes.func\r\n};\r\n\r\nTableCellSelection.defaultProps = {\r\n  onCellSelectionChange: undefined\r\n};\r\n\r\nexport default TableCellSelection;","import React, { useCallback, useEffect, useRef, useState, useMemo, forwardRef, useImperativeHandle } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useDocumentState, useDocumentActions } from '../../context/DocumentContext';\r\nimport { useFormatting, useContinuousReflow, useKeyboardShortcuts, useSelectionHandling } from '../../hooks';\r\nimport { canZoomIn, canZoomOut } from '../../lib/editor/zoom-utils';\r\nimport { getPageDimensions } from '../../lib/editor/page-sizes';\r\nimport { DEFAULT_IMAGE_RESIZE_OPTIONS } from '../../lib/editor/image-resize-utils';\r\nimport { deleteImage } from '../../lib/storage/index-db';\r\nimport { normalizeContent } from '../../lib/editor/content-normalize-utils';\r\nimport { getCursorPosition } from '../../lib/editor/cursor-scroll-utils';\r\nimport Sidebar from './Sidebar';\r\nimport EditorToolbar from './EditorToolbar';\r\nimport PageView from './PageView';\r\nimport PageManager from './PageManager';\r\nimport ImageResizeHandlers from './ImageResizeHandlers';\r\nimport ImageTooltipMenu from './ImageTooltipMenu';\r\nimport TableResizeHandlers from './TableResizeHandlers';\r\nimport TableTooltipMenu from './TableTooltipMenu';\r\nimport TableCellSelection from './TableCellSelection';\r\nimport './MultiPageEditor.css';\r\n\r\nconst INITIAL_BOUNDARY_DELAY = 50;\r\nconst BOUNDARY_UPDATE_DELAY = 50;\r\nconst NAVIGATION_DELAY = 50;\r\nconst SCROLL_DEBOUNCE = 100;\r\nconst NAVIGATION_LOCK_TIMEOUT = 300;\r\n\r\n/**\r\n * HtmlEditor - Main WYSIWYG HTML Editor Component\r\n * \r\n * Exposed methods via ref:\r\n * - getHTMLContent() - Returns the current HTML content as a string\r\n * - getPlainText() - Returns the plain text content (HTML stripped)\r\n * - setContent(html) - Sets the editor content programmatically\r\n * - setPageSize(size) - Sets the page size ('A4', 'Letter', 'Legal')\r\n * - setPageMargins(margins) - Sets the page margins ('NORMAL', 'NARROW', 'MODERATE', 'WIDE', 'OFFICE_2003') or custom {top, bottom, left, right} in inches\r\n * - insertContent(html) - Inserts content at the current cursor position without replacing existing content\r\n * \r\n * @param {Object} props\r\n * @param {React.ReactNode} props.pageManagerComponent - Optional custom PageManager component from parent app\r\n * @param {Function} props.onNavigatePage - Optional callback when navigating to a page (pageIndex)\r\n * @param {Function} props.onAddPage - Optional callback when adding a page\r\n * @param {Function} props.onDeletePage - Optional callback when deleting a page (pageIndex)\r\n * @param {Function} props.onPageSizeChange - Optional callback when page size changes (newSize)\r\n * @param {Function} props.onPageMarginsChange - Optional callback when page margins change (newMargins)\r\n * @param {Function} props.onChange - Optional callback when content changes (htmlContent)\r\n * @param {boolean} props.showSidebar - Whether to show the sidebar (default: true)\r\n * @param {boolean} props.showToolbar - Whether to show the toolbar (default: true)\r\n * @param {boolean} props.showPageManager - Whether to show the PageManager component (default: true)\r\n * @param {React.Ref} ref - Forwarded ref to access editor methods\r\n */\r\nconst HtmlEditor = forwardRef(({\r\n  pageManagerComponent = null,\r\n  onNavigatePage,\r\n  onAddPage,\r\n  onDeletePage,\r\n  onPageSizeChange: onPageSizeChangeCallback,\r\n  onPageMarginsChange: onPageMarginsChangeCallback,\r\n  onChange,\r\n  showSidebar = true,\r\n  showToolbar = true,\r\n  showPageManager = true\r\n}, ref) => {\r\n  const documentState = useDocumentState();\r\n  const actions = useDocumentActions();\r\n  const { pageSize, pageMargins, continuousContent, pageBoundaries, activePage, zoomLevel, canUndo, canRedo } = documentState;\r\n\r\n  const containerRef = useRef(null);\r\n  const editorRef = useRef(null);\r\n\r\n  const { currentFormat, formatText, updateCurrentFormatFromSelection } = useFormatting();\r\n  const [imageSelected, setImageSelected] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState(null);\r\n  const [preserveAspectRatio, setPreserveAspectRatio] = useState(true);\r\n  const [tableSelected, setTableSelected] = useState(false);\r\n  const [selectedTable, setSelectedTable] = useState(null);\r\n  const [selectedRowIndex, setSelectedRowIndex] = useState(null);\r\n  const [selectedColIndex, setSelectedColIndex] = useState(null);\r\n  const {\r\n    checkAndUpdateBoundaries,\r\n    getCurrentPage,\r\n    scrollToPage,\r\n    updateBoundaries,\r\n    triggerAutoReflow,\r\n    removePageAndContent,\r\n    removePageBreak,\r\n    insertPageBreakAtBoundary\r\n  } = useContinuousReflow(pageSize, editorRef, zoomLevel, pageMargins);\r\n\r\n  const dimensions = useMemo(() => getPageDimensions(pageSize), [pageSize]);\r\n  const [sidebarCollapsed, setSidebarCollapsed] = useState(false);\r\n  const scrollTimeoutRef = useRef(null);\r\n  const addingPageRef = useRef(false);\r\n  const isNavigatingRef = useRef(false);\r\n\r\n  // Initialize editor content and sync programmatic updates\r\n  const contentSetRef = useRef(false);\r\n  const lastContentRef = useRef(continuousContent);\r\n\r\n  const navigateToNewPage = useCallback(() => {\r\n    addingPageRef.current = false;\r\n    const newPageIndex = Math.max(0, pageBoundaries.length - 1);\r\n    actions.setActivePage(newPageIndex);\r\n    setTimeout(() => {\r\n      scrollToPage(newPageIndex, containerRef);\r\n    }, NAVIGATION_DELAY);\r\n  }, [pageBoundaries.length, actions, scrollToPage]);\r\n\r\n  // Initialize editor content on mount\r\n  useEffect(() => {\r\n    if (!editorRef.current || contentSetRef.current) return;\r\n\r\n    editorRef.current.innerHTML = continuousContent;\r\n    contentSetRef.current = true;\r\n    lastContentRef.current = continuousContent;\r\n\r\n    const timer = setTimeout(() => {\r\n      updateBoundaries();\r\n    }, INITIAL_BOUNDARY_DELAY);\r\n    return () => clearTimeout(timer);\r\n  }, []); // Empty dependency array - only run once on mount\r\n\r\n  // Sync programmatic content changes to DOM\r\n  useEffect(() => {\r\n    if (!editorRef.current || !contentSetRef.current) return;\r\n\r\n    const currentDOMContent = editorRef.current.innerHTML;\r\n\r\n    // Only update if DOM is out of sync (prevents user input loops)\r\n    if (currentDOMContent !== continuousContent) {\r\n      editorRef.current.innerHTML = continuousContent;\r\n\r\n      const timer = setTimeout(() => {\r\n        updateBoundaries();\r\n\r\n        if (addingPageRef.current) {\r\n          navigateToNewPage();\r\n        }\r\n      }, BOUNDARY_UPDATE_DELAY);\r\n\r\n      lastContentRef.current = continuousContent;\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [continuousContent, updateBoundaries, navigateToNewPage]);\r\n\r\n  // Notify parent app when content changes\r\n  useEffect(() => {\r\n    if (onChange && contentSetRef.current) {\r\n      onChange(continuousContent);\r\n    }\r\n  }, [continuousContent, onChange]);\r\n\r\n  const { restoreCursorPosition, hasActiveCursorSelection } = useSelectionHandling({\r\n    updateCurrentFormatFromSelection,\r\n    editorRef\r\n  });\r\n\r\n  // Helper function to update content and trigger boundary updates\r\n  const updateContentAndBoundaries = useCallback((html) => {\r\n    // Sync state only when the new content differs to avoid redundant updates\r\n    if (html !== continuousContent) {\r\n      actions.updateContinuousContent(html);\r\n    }\r\n\r\n    if (editorRef.current && editorRef.current.innerHTML !== html) {\r\n      editorRef.current.innerHTML = html;\r\n    }\r\n\r\n    lastContentRef.current = html;\r\n\r\n    // Update boundaries after a delay\r\n    setTimeout(() => {\r\n      updateBoundaries();\r\n    }, BOUNDARY_UPDATE_DELAY);\r\n  }, [continuousContent, actions, updateBoundaries]);\r\n\r\n  // Helper function for inserting HTML content with cursor restoration\r\n  const insertHtmlWithCursorRestore = useCallback((html) => {\r\n    if (!editorRef.current || !html) return;\r\n\r\n    // If no active selection, restore the last cursor position\r\n    if (!hasActiveCursorSelection()) {\r\n      restoreCursorPosition();\r\n    }\r\n\r\n    // Insert using execCommand for proper cursor handling\r\n    document.execCommand('insertHTML', false, html);\r\n\r\n    // Update content state with the new content\r\n    const updatedContent = editorRef.current.innerHTML;\r\n    actions.updateContinuousContent(updatedContent);\r\n    lastContentRef.current = updatedContent;\r\n\r\n    // Update boundaries and trigger reflow\r\n    setTimeout(() => {\r\n      updateBoundaries();\r\n      triggerAutoReflow(200);\r\n    }, BOUNDARY_UPDATE_DELAY);\r\n  }, [hasActiveCursorSelection, restoreCursorPosition, actions, updateBoundaries, triggerAutoReflow]);\r\n\r\n  // Exposed methods for parent component via ref\r\n  const exposedMethods = useMemo(() => ({\r\n    /**\r\n     * Get the current HTML content from the editor\r\n     * Returns the actual DOM content to ensure latest changes (like indentation) are captured\r\n     * @returns {string} The HTML content with page breaks\r\n     */\r\n    getHTMLContent: () => {\r\n      // Return current DOM content if available (ensures we get the latest changes)\r\n      if (editorRef.current) {\r\n        return editorRef.current.innerHTML;\r\n      }\r\n      // Fallback to state if DOM not available\r\n      return continuousContent;\r\n    },\r\n    /**\r\n     * Get the plain text content (HTML stripped)\r\n     * @returns {string} Plain text content\r\n     */\r\n    getPlainText: () => {\r\n      // Get the most current content from DOM or state\r\n      const htmlContent = editorRef.current ? editorRef.current.innerHTML : continuousContent;\r\n      \r\n      // Strip HTML tags and normalize whitespace, preserving Unicode characters\r\n      return htmlContent\r\n        .replace(/<[^>]*>/g, ' ')\r\n        .replace(/&nbsp;/g, ' ')\r\n        .replace(/&amp;/g, '&')\r\n        .replace(/&lt;/g, '<')\r\n        .replace(/&gt;/g, '>')\r\n        .replace(/&quot;/g, '\"')\r\n        .replace(/&#39;/g, \"'\")\r\n        .replace(/\\s+/g, ' ')\r\n        .trim();\r\n    },\r\n    /**\r\n     * Get the current cursor position in the editor\r\n     * @returns {Object|null} An object with page number, line number, and character offset, or null if no selection\r\n     */\r\n    getCursorPosition: () => {\r\n      if (!editorRef.current) return null;\r\n      return getCursorPosition(editorRef.current);\r\n    },\r\n    /**\r\n     * Set the editor content programmatically\r\n     * @param {string} html - HTML content to set\r\n     */\r\n    setContent: (html) => {\r\n      const normalizedHtml = normalizeContent(html);\r\n      updateContentAndBoundaries(normalizedHtml);\r\n    },\r\n    /**\r\n     * Set the page size programmatically\r\n     * @param {string} size - Page size ('A4', 'Letter', 'Legal')\r\n     */\r\n    setPageSize: (size) => {\r\n      actions.updatePageSize(size);\r\n      // Recalculate boundaries with new page size (debounced in hook)\r\n      updateBoundaries({ pageSize: size });\r\n    },\r\n    /**\r\n     * Set the page margins programmatically\r\n     * @param {string|Object} margins - Margin preset name ('NORMAL', 'NARROW', 'MODERATE', 'WIDE', 'OFFICE_2003') or custom margin object {top, bottom, left, right} in inches\r\n     */\r\n    setPageMargins: (margins) => {\r\n      actions.updatePageMargins(margins);\r\n      // Recalculate boundaries with new margins (debounced in hook)\r\n      updateBoundaries({ pageMargins: margins });\r\n    },\r\n    /**\r\n     * Insert content at the current cursor position without replacing existing content\r\n     * Falls back to the last cursor position if no active selection in the editor\r\n     * @param {string} html - HTML content to insert\r\n     */\r\n    insertContent: (html) => {\r\n      const normalizedHtml = normalizeContent(html);\r\n      insertHtmlWithCursorRestore(normalizedHtml);\r\n    }\r\n  }), [continuousContent, actions, updateBoundaries, triggerAutoReflow, hasActiveCursorSelection, restoreCursorPosition]);\r\n\r\n  // Expose methods to parent component via ref\r\n  useImperativeHandle(ref, () => exposedMethods, [exposedMethods]);\r\n\r\n  // Extract content update logic for reuse\r\n  const updateContent = useCallback(() => {\r\n    if (!editorRef.current) return;\r\n    \r\n    let html = editorRef.current.innerHTML;\r\n    \r\n    // Normalize paragraph structure to ensure proper <p> tags\r\n    html = normalizeContent(html);\r\n    \r\n    // Update the DOM with normalized content if it changed\r\n    if (html !== editorRef.current.innerHTML) {\r\n      editorRef.current.innerHTML = html;\r\n    }\r\n    \r\n    // Record the content change for undo/redo\r\n    const previousContent = continuousContent;\r\n    if (previousContent !== html) {\r\n      // Create the operation to update content\r\n      const updateOperation = {\r\n        type: 'UPDATE_CONTINUOUS_CONTENT',\r\n        payload: html\r\n      };\r\n      \r\n      // Create the inverse operation to restore previous content\r\n      const inverseOperation = {\r\n        type: 'UPDATE_CONTINUOUS_CONTENT',\r\n        payload: previousContent\r\n      };\r\n      \r\n      // Record the operation\r\n      actions.recordOperation(updateOperation, inverseOperation);\r\n    }\r\n    \r\n    actions.updateContinuousContent(html);\r\n    \r\n    // Update page boundaries after content change (already debounced in hook)\r\n    checkAndUpdateBoundaries();\r\n    \r\n    // Trigger automatic reflow with shorter delay for typing (200ms instead of default 500ms)\r\n    triggerAutoReflow(200);\r\n    \r\n    // Update active page based on viewport scroll position\r\n    const currentPage = getCurrentPage(containerRef);\r\n    if (currentPage !== activePage) {\r\n      actions.setActivePage(currentPage);\r\n    }\r\n  }, [actions, checkAndUpdateBoundaries, getCurrentPage, activePage, triggerAutoReflow, containerRef, editorRef, continuousContent]);\r\n\r\n  const handleInput = useCallback((_event) => {\r\n    updateContent();\r\n  }, [updateContent]);\r\n\r\n  const handlePageSizeChange = useCallback((newSize) => {\r\n    actions.updatePageSize(newSize);\r\n    // Recalculate boundaries with new page size (debounced in hook)\r\n    updateBoundaries({ pageSize: newSize });\r\n    \r\n    // Call parent callback if provided\r\n    if (onPageSizeChangeCallback) {\r\n      onPageSizeChangeCallback(newSize);\r\n    }\r\n  }, [actions, updateBoundaries, onPageSizeChangeCallback]);\r\n\r\n  const handlePageMarginsChange = useCallback((newMargins) => {\r\n    actions.updatePageMargins(newMargins);\r\n    // Recalculate boundaries with new margins (debounced in hook)\r\n    updateBoundaries({ pageMargins: newMargins });\r\n    \r\n    // Call parent callback if provided\r\n    if (onPageMarginsChangeCallback) {\r\n      onPageMarginsChangeCallback(newMargins);\r\n    }\r\n  }, [actions, updateBoundaries, onPageMarginsChangeCallback]);\r\n\r\n  const handleNavigatePage = useCallback((pageIndex) => {\r\n    // Validate page index\r\n    if (pageIndex < 0 || pageIndex >= pageBoundaries.length) {\r\n      return;\r\n    }\r\n    \r\n    // Set flag to prevent handleScroll from interfering during navigation\r\n    isNavigatingRef.current = true;\r\n    \r\n    // Set active page immediately\r\n    actions.setActivePage(pageIndex);\r\n    \r\n    // Scroll to the page\r\n    scrollToPage(pageIndex, containerRef);\r\n    \r\n    // Clear the navigation flag after scroll completes\r\n    setTimeout(() => {\r\n      isNavigatingRef.current = false;\r\n    }, NAVIGATION_LOCK_TIMEOUT);\r\n    \r\n    // Call parent callback if provided\r\n    if (onNavigatePage) {\r\n      onNavigatePage(pageIndex);\r\n    }\r\n  }, [actions, scrollToPage, onNavigatePage, pageBoundaries.length]);\r\n\r\n  const handleAddPage = useCallback(() => {\r\n    // Calculate which page number we're adding (next page after current boundaries)\r\n    const nextPageNumber = pageBoundaries.length + 1;\r\n    \r\n    // Use the smart insertion function to insert at the correct boundary\r\n    const success = insertPageBreakAtBoundary(nextPageNumber);\r\n    \r\n    if (success) {\r\n      // Set flag to indicate we're adding a page for navigation\r\n      addingPageRef.current = true;\r\n      \r\n      // The insertPageBreakAtBoundary already updates content and boundaries\r\n      // We just need to handle navigation after a delay\r\n      setTimeout(() => {\r\n        if (addingPageRef.current) {\r\n          navigateToNewPage();\r\n        }\r\n      }, 100);\r\n    }\r\n    \r\n    // Call parent callback if provided\r\n    if (onAddPage) {\r\n      onAddPage();\r\n    }\r\n  }, [pageBoundaries.length, insertPageBreakAtBoundary, actions, scrollToPage, onAddPage]);\r\n\r\n  const handleAddPageBreak = useCallback(() => {\r\n    // Insert page break at current cursor position\r\n    const selection = window.getSelection();\r\n    if (selection && selection.rangeCount > 0) {\r\n      if (!editorRef?.current) return;\r\n      \r\n      // Count existing page breaks to determine the page number\r\n      const existingBreaks = editorRef.current.querySelectorAll('page-break, [data-page-break=\"true\"]');\r\n      const pageNumber = existingBreaks.length + 2; // +2 because we're creating a break for the next page\r\n      \r\n      const pageBreakHTML = `<page-break data-page-break=\"true\" contenteditable=\"false\" data-page-number=\"${pageNumber}\"></page-break><p><br></p>`;\r\n      \r\n      // Insert the page break\r\n      document.execCommand('insertHTML', false, pageBreakHTML);\r\n      \r\n      // Update boundaries after a short delay and ensure PageManager updates\r\n      setTimeout(() => {\r\n        updateBoundaries();\r\n        // Get current page based on scroll position and stay on it\r\n        const currentPage = getCurrentPage(containerRef);\r\n        actions.setActivePage(currentPage);\r\n      }, 150);\r\n    }\r\n  }, [updateBoundaries, getCurrentPage, actions, containerRef]);\r\n\r\n  const handleInsertImage = useCallback((imageHtml) => {\r\n    insertHtmlWithCursorRestore(imageHtml);\r\n  }, [insertHtmlWithCursorRestore]);\r\n\r\n  const handleRemovePageBreak = useCallback((pageBreakElement) => {\r\n    if (!pageBreakElement) return;\r\n    \r\n    // Use the removePageBreak function from the hook\r\n    // This will remove the page break and trigger reflow to re-add breaks in correct positions\r\n    const success = removePageBreak(pageBreakElement);\r\n    \r\n    if (success) {\r\n      // Update active page based on current scroll position\r\n      setTimeout(() => {\r\n        const currentPage = getCurrentPage(containerRef);\r\n        actions.setActivePage(currentPage);\r\n      }, 200);\r\n    }\r\n  }, [removePageBreak, getCurrentPage, actions, containerRef]);\r\n\r\n  const handleDeletePage = useCallback((pageIndex) => {\r\n    if (pageBoundaries.length <= 1) {\r\n      console.warn('Cannot delete the only page');\r\n      return;\r\n    }\r\n    \r\n    // Use the new removePageAndContent function from the hook\r\n    // This will remove both the page break and all content within that page\r\n    const success = removePageAndContent(pageIndex);\r\n    \r\n    if (success) {\r\n      // Set active page to the first page after deletion\r\n      actions.setActivePage(0);\r\n      \r\n      // Call parent callback if provided\r\n      if (onDeletePage) {\r\n        onDeletePage(pageIndex);\r\n      }\r\n    }\r\n  }, [pageBoundaries.length, removePageAndContent, actions, onDeletePage]);\r\n\r\n  // Action handlers object for zoom and undo/redo operations\r\n  const actionHandlers = useMemo(() => ({\r\n    handleZoomIn: () => actions.zoomIn(),\r\n    handleZoomOut: () => actions.zoomOut(),\r\n    handleZoomReset: () => actions.resetZoom(),\r\n    handleUndo: () => actions.undo(),\r\n    handleRedo: () => actions.redo()\r\n  }), [actions]);\r\n\r\n  // Extract individual handlers for use in components\r\n  const { handleZoomIn, handleZoomOut, handleZoomReset, handleUndo, handleRedo } = actionHandlers;\r\n\r\n  // Keyboard shortcuts for zoom, undo, redo\r\n  useKeyboardShortcuts(\r\n    { handleZoomIn, handleZoomOut, handleZoomReset, handleUndo, handleRedo },\r\n    { editorRef, containerRef }\r\n  );\r\n\r\n  const handleScroll = useCallback(() => {\r\n    // Early exit if refs not ready or navigating\r\n    if (!containerRef.current || !editorRef.current || isNavigatingRef.current) {\r\n      return;\r\n    }\r\n\r\n    // Clear existing timeout for debouncing\r\n    if (scrollTimeoutRef.current) {\r\n      clearTimeout(scrollTimeoutRef.current);\r\n    }\r\n\r\n    scrollTimeoutRef.current = setTimeout(() => {\r\n      // Double-check navigation state after debounce\r\n      if (isNavigatingRef.current) {\r\n        scrollTimeoutRef.current = null;\r\n        return;\r\n      }\r\n      \r\n      const currentPage = getCurrentPage(containerRef);\r\n      \r\n      // Only update if page actually changed\r\n      if (currentPage !== activePage && currentPage >= 0) {\r\n        actions.setActivePage(currentPage);\r\n      }\r\n      \r\n      scrollTimeoutRef.current = null;\r\n    }, SCROLL_DEBOUNCE);\r\n  }, [getCurrentPage, activePage, actions]);\r\n\r\n  // Word count for sidebar - memoized to prevent expensive regex on every render\r\n  const wordCount = useMemo(() => {\r\n    if (!continuousContent) return 0;\r\n    const text = continuousContent.replace(/<[^>]*>/g, ' ');\r\n    // Use Unicode-aware word matching that supports various scripts\r\n    const words = text.match(/\\p{L}+/gu);\r\n    return words ? words.length : 0;\r\n  }, [continuousContent]);\r\n\r\n  const totalPages = pageBoundaries.length || 1;\r\n\r\n  // Image resize handlers callbacks\r\n  const handleImageSelect = useCallback((imageElement) => {\r\n    setImageSelected(true);\r\n    setSelectedImage(imageElement);\r\n  }, []);\r\n\r\n  const handleImageDeselect = useCallback(() => {\r\n    setImageSelected(false);\r\n    setSelectedImage(null);\r\n  }, []);\r\n\r\n  const handleImageResize = useCallback((_, __) => {\r\n    // Image resize completed - content will be updated by the ImageResizeHandlers component\r\n    // We can add any additional handling here if needed\r\n  }, []);\r\n\r\n  // Table cell selection callback - memoized to prevent unnecessary re-renders\r\n  const handleCellSelectionChange = useCallback((selection) => {\r\n    if (selection && selection.mode === 'row') {\r\n      // Row is selected\r\n      setSelectedRowIndex(selection.rowIndex);\r\n      setSelectedColIndex(null);\r\n    } else if (selection && selection.mode === 'column') {\r\n      // Column is selected\r\n      setSelectedColIndex(selection.colIndex);\r\n      setSelectedRowIndex(null);\r\n    } else {\r\n      // No row or column selected\r\n      setSelectedRowIndex(null);\r\n      setSelectedColIndex(null);\r\n    }\r\n  }, []);\r\n\r\n  // Table resize handlers callbacks\r\n  const handleTableSelect = useCallback((tableElement) => {\r\n    setTableSelected(true);\r\n    setSelectedTable(tableElement);\r\n  }, []);\r\n\r\n  const handleTableDeselect = useCallback(() => {\r\n    setTableSelected(false);\r\n    setSelectedTable(null);\r\n  }, []);\r\n\r\n  const handleTableResize = useCallback((_, __) => {\r\n    // Table resize completed - content will be updated by the TableResizeHandlers component\r\n    // We can add any additional handling here if needed\r\n  }, []);\r\n\r\n  // Cleanup scroll timeout on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (scrollTimeoutRef.current) {\r\n        clearTimeout(scrollTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"multi-page-editor\">\r\n      {showToolbar && (\r\n        <EditorToolbar\r\n          currentFormat={{\r\n            ...currentFormat,\r\n            imageSelected\r\n          }}\r\n          onFormatText={formatText}\r\n          onAddPageBreak={handleAddPageBreak}\r\n          onInsertImage={handleInsertImage}\r\n          canUndo={canUndo}\r\n          canRedo={canRedo}\r\n        />\r\n      )}\r\n\r\n      <div className=\"editor-container\">\r\n        {showSidebar && (\r\n          <Sidebar\r\n            editorView={null}\r\n            isCollapsed={sidebarCollapsed}\r\n            onToggle={() => setSidebarCollapsed((prev) => !prev)}\r\n            wordCount={wordCount}\r\n            pageCount={totalPages}\r\n          />\r\n        )}\r\n\r\n        <div\r\n          className=\"editor-viewport continuous-scroll\"\r\n          ref={containerRef}\r\n          onScroll={handleScroll}\r\n        >\r\n          <PageView\r\n            content={continuousContent}\r\n            dimensions={dimensions}\r\n            pageSize={pageSize}\r\n            pageMargins={pageMargins}\r\n            pageBoundaries={pageBoundaries}\r\n            editorRef={editorRef}\r\n            onInput={handleInput}\r\n            onContentChange={updateContent}\r\n            onClick={() => editorRef.current?.focus()}\r\n            onRemovePageBreak={handleRemovePageBreak}\r\n            zoomLevel={zoomLevel}\r\n          />\r\n        </div>\r\n\r\n        {/* Image Resize Handlers - manages image selection and resizing */}\r\n        <ImageResizeHandlers\r\n          editorRef={editorRef}\r\n          onImageSelect={handleImageSelect}\r\n          onImageDeselect={handleImageDeselect}\r\n          onImageResize={handleImageResize}\r\n          resizeOptions={{\r\n            ...DEFAULT_IMAGE_RESIZE_OPTIONS,\r\n            preserveAspectRatio,\r\n            aspectRatio: preserveAspectRatio\r\n          }}\r\n        />\r\n\r\n        {/* Table Resize Handlers - manages table selection and resizing */}\r\n        <TableResizeHandlers\r\n          editorRef={editorRef}\r\n          onTableSelect={handleTableSelect}\r\n          onTableDeselect={handleTableDeselect}\r\n          onTableResize={handleTableResize}\r\n        />\r\n\r\n        {/* Table Cell Selection - manages cell selection within tables */}\r\n        <TableCellSelection\r\n          editorRef={editorRef}\r\n          onCellSelectionChange={handleCellSelectionChange}\r\n        />\r\n\r\n        {/* Image Tooltip Menu - shows when an image is selected */}\r\n        {imageSelected && selectedImage && (\r\n          <ImageTooltipMenu\r\n            imageElement={selectedImage}\r\n            initialPreserveAspectRatio={preserveAspectRatio}\r\n            onAlignChange={(_alignment) => {\r\n              // Handle alignment change if needed\r\n            }}\r\n            onAspectRatioToggle={(newPreserveRatio) => {\r\n              setPreserveAspectRatio(newPreserveRatio);\r\n            }}\r\n            onDelete={() => {\r\n              // Handle image deletion from IndexedDB and DOM\r\n              if (selectedImage) {\r\n                const imageKey = selectedImage.getAttribute('data-key');\r\n                if (imageKey) {\r\n                  // Delete from IndexedDB\r\n                  deleteImage(imageKey).catch(error => {\r\n                    console.error('Failed to delete image from IndexedDB:', error);\r\n                  });\r\n                }\r\n                // Remove from DOM (handled by ImageTooltipMenu)\r\n              }\r\n            }}\r\n            onClose={handleImageDeselect}\r\n          />\r\n        )}\r\n\r\n        {/* Table Tooltip Menu - shows when a table is selected */}\r\n        {tableSelected && selectedTable && (\r\n          <TableTooltipMenu\r\n            tableElement={selectedTable}\r\n            onAlignChange={(_alignment) => {\r\n              // Handle alignment change if needed\r\n            }}\r\n            onClose={handleTableDeselect}\r\n            selectedRowIndex={selectedRowIndex}\r\n            selectedColIndex={selectedColIndex}\r\n            editorRef={editorRef}\r\n          />\r\n        )}\r\n\r\n        {/* Render PageManager only if showPageManager is true */}\r\n        {showPageManager && (\r\n          <div className=\"page-manager-sidebar\">\r\n            {pageManagerComponent ? (\r\n              React.cloneElement(pageManagerComponent, {\r\n                onNavigate: handleNavigatePage,\r\n                onAddPage: handleAddPage,\r\n                onDeletePage: handleDeletePage,\r\n                onPageSizeChange: handlePageSizeChange,\r\n                onPageMarginsChange: handlePageMarginsChange,\r\n                zoomLevel,\r\n                canZoomIn: canZoomIn(zoomLevel),\r\n                canZoomOut: canZoomOut(zoomLevel),\r\n                onZoomIn: handleZoomIn,\r\n                onZoomOut: handleZoomOut,\r\n                onZoomReset: handleZoomReset\r\n              })\r\n            ) : (\r\n              <PageManager\r\n                pageBoundaries={pageBoundaries}\r\n                activePage={activePage}\r\n                pageSize={pageSize}\r\n                pageMargins={pageMargins}\r\n                zoomLevel={zoomLevel}\r\n                canZoomIn={canZoomIn(zoomLevel)}\r\n                canZoomOut={canZoomOut(zoomLevel)}\r\n                onNavigate={handleNavigatePage}\r\n                onAddPage={handleAddPage}\r\n                onDeletePage={handleDeletePage}\r\n                onPageSizeChange={handlePageSizeChange}\r\n                onPageMarginsChange={handlePageMarginsChange}\r\n                onZoomIn={handleZoomIn}\r\n                onZoomOut={handleZoomOut}\r\n                onZoomReset={handleZoomReset}\r\n              />\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nHtmlEditor.displayName = 'HtmlEditor';\r\n\r\nHtmlEditor.propTypes = {\r\n  pageManagerComponent: PropTypes.element,\r\n  onNavigatePage: PropTypes.func,\r\n  onAddPage: PropTypes.func,\r\n  onDeletePage: PropTypes.func,\r\n  onPageSizeChange: PropTypes.func,\r\n  onPageMarginsChange: PropTypes.func,\r\n  onChange: PropTypes.func,\r\n  showSidebar: PropTypes.bool,\r\n  showToolbar: PropTypes.bool,\r\n  showPageManager: PropTypes.bool\r\n};\r\n\r\nHtmlEditor.defaultProps = {\r\n  pageManagerComponent: null,\r\n  onNavigatePage: undefined,\r\n  onAddPage: undefined,\r\n  onDeletePage: undefined,\r\n  onPageSizeChange: undefined,\r\n  onPageMarginsChange: undefined,\r\n  onChange: undefined,\r\n  showSidebar: true,\r\n  showToolbar: true,\r\n  showPageManager: true\r\n};\r\n\r\nexport default HtmlEditor;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\n/**\r\n * ErrorBoundary - Catches React errors and displays a fallback UI\r\n * Prevents the entire app from crashing due to component errors\r\n * \r\n * Usage:\r\n * <ErrorBoundary fallback={<div>Something went wrong</div>}>\r\n *   <YourComponent />\r\n * </ErrorBoundary>\r\n */\r\nclass ErrorBoundary extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      hasError: false,\r\n      error: null,\r\n      errorInfo: null\r\n    };\r\n  }\r\n\r\n  static getDerivedStateFromError(error) {\r\n    // Update state so the next render will show the fallback UI\r\n    return { hasError: true };\r\n  }\r\n\r\n  componentDidCatch(error, errorInfo) {\r\n    // Log error details for debugging\r\n    console.error('[ErrorBoundary] Caught error:', error);\r\n    console.error('[ErrorBoundary] Error info:', errorInfo);\r\n\r\n    this.setState({\r\n      error,\r\n      errorInfo\r\n    });\r\n\r\n    // Call optional error callback\r\n    if (this.props.onError) {\r\n      this.props.onError(error, errorInfo);\r\n    }\r\n  }\r\n\r\n  handleReset = () => {\r\n    this.setState({\r\n      hasError: false,\r\n      error: null,\r\n      errorInfo: null\r\n    });\r\n\r\n    if (this.props.onReset) {\r\n      this.props.onReset();\r\n    }\r\n  };\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      // Custom fallback UI\r\n      if (this.props.fallback) {\r\n        return this.props.fallback;\r\n      }\r\n\r\n      // Default fallback UI\r\n      return (\r\n        <div style={{\r\n          padding: '20px',\r\n          margin: '20px',\r\n          border: '2px solid #f44336',\r\n          borderRadius: '4px',\r\n          backgroundColor: '#ffebee',\r\n          color: '#c62828'\r\n        }}>\r\n          <h2 style={{ marginTop: 0 }}>⚠️ Something went wrong</h2>\r\n          <p>The editor encountered an unexpected error and couldn't continue.</p>\r\n          \r\n          {this.props.showDetails && this.state.error && (\r\n            <details style={{ \r\n              marginTop: '10px', \r\n              padding: '10px', \r\n              backgroundColor: 'white',\r\n              borderRadius: '4px',\r\n              fontSize: '12px',\r\n              fontFamily: 'monospace'\r\n            }}>\r\n              <summary style={{ cursor: 'pointer', fontWeight: 'bold' }}>\r\n                Error Details\r\n              </summary>\r\n              <pre style={{ \r\n                marginTop: '10px', \r\n                overflow: 'auto',\r\n                maxHeight: '200px'\r\n              }}>\r\n                {this.state.error.toString()}\r\n                {this.state.errorInfo && this.state.errorInfo.componentStack}\r\n              </pre>\r\n            </details>\r\n          )}\r\n          \r\n          <button\r\n            onClick={this.handleReset}\r\n            style={{\r\n              marginTop: '15px',\r\n              padding: '8px 16px',\r\n              backgroundColor: '#f44336',\r\n              color: 'white',\r\n              border: 'none',\r\n              borderRadius: '4px',\r\n              cursor: 'pointer',\r\n              fontWeight: 'bold'\r\n            }}\r\n          >\r\n            Try Again\r\n          </button>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\nErrorBoundary.propTypes = {\r\n  children: PropTypes.node.isRequired,\r\n  fallback: PropTypes.node,\r\n  onError: PropTypes.func,\r\n  onReset: PropTypes.func,\r\n  showDetails: PropTypes.bool\r\n};\r\n\r\nErrorBoundary.defaultProps = {\r\n  fallback: null,\r\n  onError: undefined,\r\n  onReset: undefined,\r\n  showDetails: process.env.NODE_ENV === 'development'\r\n};\r\n\r\nexport default ErrorBoundary;\r\n"],"names":["REACT_ELEMENT_TYPE","REACT_FRAGMENT_TYPE","jsxProd","type","config","maybeKey","key","propName","reactJsxRuntime_production","getComponentNameFromType","REACT_CLIENT_REFERENCE","REACT_PROFILER_TYPE","REACT_STRICT_MODE_TYPE","REACT_SUSPENSE_TYPE","REACT_SUSPENSE_LIST_TYPE","REACT_ACTIVITY_TYPE","REACT_PORTAL_TYPE","REACT_CONTEXT_TYPE","REACT_CONSUMER_TYPE","REACT_FORWARD_REF_TYPE","innerType","REACT_MEMO_TYPE","REACT_LAZY_TYPE","testStringCoercion","value","checkKeyStringCoercion","JSCompiler_inline_result","JSCompiler_temp_const","JSCompiler_inline_result$jscomp$0","getTaskName","name","getOwner","dispatcher","ReactSharedInternals","UnknownOwner","hasValidKey","hasOwnProperty","getter","defineKeyPropWarningGetter","props","displayName","warnAboutAccessingKey","specialPropKeyWarningShown","elementRefGetterWithDeprecationWarning","componentName","didWarnAboutElementRef","ReactElement","owner","debugStack","debugTask","refProp","jsxDEVImpl","isStaticChildren","children","isArrayImpl","validateChildKeys","keys","k","didWarnAboutKeySpread","node","isValidElement","object","React","require$$0","createTask","callStackForError","unknownOwnerDebugStack","unknownOwnerDebugTask","reactJsxRuntime_development","trackActualOwner","jsxRuntimeModule","require$$1","DEFAULT_ZOOM","MIN_ZOOM","MAX_ZOOM","ZOOM_STEP","canZoomIn","currentZoom","canZoomOut","CSS_DPI","inchesToPixels","inches","MARGIN_PRESETS","DEFAULT_MARGIN_PRESET","getMarginPixels","marginInput","preset","getTotalVerticalMargins","margins","getMarginPresetNames","getMarginPresetLabel","PAGE_SIZES","DEFAULT_PAGE_SIZE","getPageDimensions","size","pageSize","isValidPageSize","getAvailablePageSizes","PAGE_SIZE_DEFAULT","EMPTY_PARAGRAPH","DEFAULT_EDITOR_MODE","createEmptyPage","index","uuidv4","sanitizeContent","html","withMinimumPage","pages","page","createDefaultBoundary","generatePageBreaks","_","buildInitialState","overrides","now","ActionTypes","documentReducer","state","action","initialContent","pageIndex","content","newPages","payload","nextPages","pageBreaks","insertIndex","updatedPages","newActivePage","maxPage","newSize","newContent","boundaries","position","pageBreakTag","before","after","tempDiv","targetBreak","newBreak","newParagraph","breakEl","newMode","newZoomLevel","checkCanZoomIn","checkCanZoomOut","newMargins","operation","inverseOperation","lastOperation","newUndoStack","newState","operationToRedo","newRedoStack","DocumentContext","createContext","DocumentProvider","initialState","dispatch","useReducer","actions","useMemo","title","mode","level","jsx","useDocument","context","useContext","useDocumentState","useDocumentActions","b","c","d","e","f","g","h","l","m","n","p","q","r","t","v","w","x","y","z","a","u","A","reactIs_production_min","hasSymbol","REACT_PROVIDER_TYPE","REACT_ASYNC_MODE_TYPE","REACT_CONCURRENT_MODE_TYPE","REACT_BLOCK_TYPE","REACT_FUNDAMENTAL_TYPE","REACT_RESPONDER_TYPE","REACT_SCOPE_TYPE","isValidElementType","typeOf","$$typeof","$$typeofType","AsyncMode","ConcurrentMode","ContextConsumer","ContextProvider","Element","ForwardRef","Fragment","Lazy","Memo","Portal","Profiler","StrictMode","Suspense","hasWarnedAboutDeprecatedIsAsyncMode","isAsyncMode","isConcurrentMode","isContextConsumer","isContextProvider","isElement","isForwardRef","isFragment","isLazy","isMemo","isPortal","isProfiler","isStrictMode","isSuspense","reactIs_development","reactIsModule","getOwnPropertySymbols","propIsEnumerable","toObject","val","shouldUseNative","test1","test2","order2","test3","letter","objectAssign","target","source","from","to","symbols","s","i","ReactPropTypesSecret","ReactPropTypesSecret_1","has","printWarning","loggedTypeFailures","text","message","checkPropTypes","typeSpecs","values","location","getStack","typeSpecName","error","err","ex","stack","checkPropTypes_1","ReactIs","assign","require$$2","require$$3","require$$4","emptyFunctionThatReturnsNull","factoryWithTypeCheckers","throwOnDirectAccess","ITERATOR_SYMBOL","FAUX_ITERATOR_SYMBOL","getIteratorFn","maybeIterable","iteratorFn","ANONYMOUS","ReactPropTypes","createPrimitiveTypeChecker","createAnyTypeChecker","createArrayOfTypeChecker","createElementTypeChecker","createElementTypeTypeChecker","createInstanceTypeChecker","createNodeChecker","createObjectOfTypeChecker","createEnumTypeChecker","createUnionTypeChecker","createShapeTypeChecker","createStrictShapeTypeChecker","is","PropTypeError","data","createChainableTypeChecker","validate","manualPropTypeCallCache","manualPropTypeWarningCount","checkType","isRequired","propFullName","secret","cacheKey","chainedCheckType","expectedType","propValue","propType","getPropType","preciseType","getPreciseType","typeChecker","expectedClass","expectedClassName","actualClassName","getClassName","expectedValues","valuesString","arrayOfTypeCheckers","checker","getPostfixForTypeWarning","expectedTypes","checkerResult","expectedTypesMessage","isNode","invalidValidatorError","shapeTypes","allKeys","iterator","step","entry","isSymbol","emptyFunction","emptyFunctionWithReset","factoryWithThrowingShims","shim","getShim","propTypesModule","FONT_SIZE_MAP","COMMON_FONT_SIZES","DEFAULT_FONT_SIZE","pointsToPixels","points","pixelsToPoints","pixels","getPixelValue","pt","fontSize","getPointValue","px","pixelValue","isValidFontSize","DEFAULT_FORMAT","useFormatting","currentFormat","setCurrentFormat","useState","applyStyleToSelection","useCallback","styleProperty","fallbackCommand","selection","range","prev","span","fragment","mappedValue","handleFontName","handleFontSize","handleFontColor","updateAlignmentState","textAlign","handleTextAlignment","command","selectedText","startContainer","element","blockElement","findNearestBlockElement","createParagraphAtCursor","blockElements","findBlockElementsInRange","block","handleInsertHTML","child","startElement","blockTagName","nextSibling","remainingText","newBlock","parent","fallbackError","formatText","updateCurrentFormatFromSelection","fontFamily","fontColor","headingLevel","computedStyle","computedFontSize","computedFontFamily","computedFontColor","rgbToHex","tagName","computedTextAlign","formatState","resetFormat","rgb","result","current","endContainer","startBlock","endBlock","walker","PAGE_BREAK_SELECTOR","calculatePageBoundaries","editor","options","targetPageSize","dimensions","pageBreakElements","editorRect","editorScrollTop","relativeTop","calculateMaxContentHeight","zoomLevel","pageMargins","verticalMargins","baseMaxHeight","zoomMultiplier","getCurrentPage","container","containerRect","viewportCenter","splitContentIntoPages","allChildren","currentPage","el","getElementTotalHeight","rect","images","textContent","imgRect","insertPageBreakBefore","targetElement","pageNumber","pageBreak","insertPageBreakAtBoundary","updateContentCallback","updateBoundariesCallback","targetHeight","accumulatedHeight","insertBeforeElement","childHeight","updatedHTML","emptyParagraph","removePageAndContent","calculateBoundariesCallback","positionCursorCallback","checkReflowCallback","cursorWasInDeletedContent","nodesToRemove","pageBreakToRemove","firstPageBreak","currentNode","pageBreakElement","nextPageBreakElement","cursorNode","renumberPageBreaks","removePageBreak","DEFAULT_REFLOW_DELAY","BOUNDARY_UPDATE_DELAY","MAX_PAGES_PER_REFLOW","MIN_OVERFLOW_THRESHOLD","findOverflowPoint","pageElements","maxHeight","currentHeight","lastValidElement","elementHeight","checkAndReflow","isReflowingRef","checkAndReflowCallback","insertedBreaks","pagesProcessed","overflow","totalPageHeight","triggerAutoReflow","timeoutRef","delay","CURSOR_POSITION_DELAY","positionCursorAtPage","targetNode","targetOffset","breakElement","scrollToPage","elementRect","scrollTop","checkAndUpdateBoundaries","getCursorPosition","tempRange","plainTextBeforeCaret","charOffset","lineNumber","DEFAULT_BOUNDARY_DELAY","useContinuousReflow","editorRef","boundaryTimeoutRef","useRef","reflowTimeoutRef","latestPageSizeRef","latestZoomLevelRef","latestPageMarginsRef","useEffect","calculatePageBoundariesCallback","updateBoundaries","checkAndUpdateBoundariesCallback","triggerAutoReflowCallback","getCurrentPageCallback","containerRef","positionCursorAtPageCallback","scrollToPageCallback","insertPageBreakAtBoundaryCallback","removePageAndContentCallback","removePageBreakCallback","useKeyboardShortcuts","handlers","refs","handleZoomIn","handleZoomOut","handleZoomReset","handleUndo","handleRedo","handleKeyDown","event","isEditorFocused","isContainerFocused","isInputFocused","useSelectionHandling","lastCursorPositionRef","restoreCursorPosition","lastChild","hasActiveCursorSelection","activeRange","handleSelectionChange","handleFocus","DEFAULT_IMAGE_RESIZE_OPTIONS","RESIZE_HANDLERS","calculateResizeDimensions","handler","startX","startY","currentX","currentY","startWidth","startHeight","deltaX","deltaY","newWidth","newHeight","aspectRatio","isResizableImage","getImageDimensions","applyImageDimensions","width","height","createResizeOverlay","imageElement","overlay","handlerElement","getCursorForHandler","positionHandler","updateResizeOverlay","removeResizeOverlay","DB_NAME","DB_VERSION","STORE_NAME","generateUUID","openDatabase","resolve","reject","request","db","saveImage","file","reader","dataUrl","sizeInBytes","objectStore","imageData","getImage","deleteImage","clearImages","getAllImageKeys","BLOCK_ELEMENTS","INLINE_FORMATTING_ELEMENTS","VOID_ELEMENTS","escapeHtml","div","getElementAttributes","attributes","attr","normalizeContent","htmlContent","trimmed","normalizeElement","removeNestedParagraphs","headingElement","clonedElement","shouldUnwrapParagraph","paragraphElement","childElements","unwrapParagraphBlockElements","hasNonBlockContent","fragments","childNodes","lowerTagName","innerContent","headingContent","normalizeList","normalizeTable","listElement","items","tableElement","toKebabCase","string","toCamelCase","match","p1","p2","toPascalCase","camelCase","mergeClasses","classes","className","array","hasA11yProp","prop","defaultAttributes","Icon","forwardRef","color","strokeWidth","absoluteStrokeWidth","iconNode","rest","ref","createElement","tag","attrs","createLucideIcon","iconName","Component","__iconNode","ArrowDown","ArrowLeft","ArrowRight","ArrowUp","Bold","ChevronLeft","ChevronRight","FileCheck","FileText","Hash","Heading1","Heading2","Heading3","ImageUpscale","Image","Italic","Link","ListIndentDecrease","ListIndentIncrease","ListOrdered","List","Palette","Plus","Redo","Scaling","Settings","Strikethrough","Table","TextAlignCenter","TextAlignEnd","TextAlignJustify","TextAlignStart","Trash2","Underline","Undo","X","ZoomIn","ZoomOut","extractHeadings","prefix","headingElements","heading","calculateWordCount","word","Sidebar","isCollapsed","onToggle","propWordCount","propPageCount","documentState","activePage","continuousContent","wordCount","outline","totalWords","headings","displayPageCount","jsxs","HeadingIcon","Logger","namespace","logger","BLOCK_TAGS","LIST_INDENT_STEP","adjustBlockIndentation","isOutdent","currentLevel","nextLevel","adjustListIndentation","listItem","findClosestBlockElement","getSelectedBlocks","blocks","img","removeLeadingIndentation","indentSelectedBlocks","fallbackBlock","firstBlock","lastBlock","newRange","getFirstTextNode","getLastTextNode","lastNode","firstTextNode","lastTextNode","fallbackRange","handleTabIndentation","ColorPickerDropdown","currentColor","onColorSelect","isOpen","setIsOpen","dropdownRef","colorPalette","handleClickOutside","handleColorClick","handleCustomColorChange","PropTypes","FONT_FAMILIES","HEADING_LEVELS","DEFAULT_TABLE_HTML","EditorToolbar","onFormatText","onAddPageBreak","onInsertImage","canUndo","canRedo","renderButton","onClick","formatKey","disabled","renderSeparator","handleImageUpload","imageUrl","imageHtml","handleIndent","handleOutdent","handleInsertLink","url","handleImageButtonClick","AlignLeft","AlignCenter","AlignRight","AlignJustify","label","Indent","Outdent","ImageIcon","processPastedContent","handlePaste","clipboardData","pastedContent","convertPlainTextToHtml","paragraphs","paragraph","lines","line","REMOVE_BUTTON_WIDTH","REMOVE_BUTTON_HEIGHT","REMOVE_BUTTON_OFFSET_RIGHT","REMOVE_BUTTON_OFFSET_TOP","EDITOR_CONTAINER_STYLE","CONTENT_EDITABLE_STYLE","setCursorAtElement","atStart","sel","shouldPreventTypingOnPageBreak","isPageBreakElement","shouldPreventDeletionOnPageBreak","PageView","onInput","onContentChange","onKeyDown","onScroll","onPaste","onRemovePageBreak","padding","isInPaddingArea","clientY","relativeY","handlePageBreakClick","clickedElement","relativeX","removeButtonLeft","removeButtonTop","removeButtonRight","removeButtonBottom","handlePaddingClick","firstChild","handleClick","handleBeforeInput","processedContent","processPasteEvent","PageView$1","memo","PageManager","pageBoundaries","onNavigate","onAddPage","onDeletePage","onPageSizeChange","onPageMarginsChange","onZoomIn","onZoomOut","onZoomReset","totalPages","handleDeletePage","presetName","boundary","PageManager$1","KEYBOARD_RESIZE_STEP","DEFAULT_RESET_WIDTH","DEFAULT_RESET_HEIGHT","applyAspectRatioConstraints","applyDimensionsAndTriggerInput","inputEvent","handleImageKeyboardShortcut","ctrlKey","metaKey","shiftKey","isModifierPressed","currentWidth","ImageResizeHandlers","onImageResize","onImageSelect","onImageDeselect","resizeOptions","resizeStateRef","resizeOptionsRef","handleImageSelection","handleResizeStart","clearImageSelection","scrollLeft","handleResizeMove","handleResizeEnd","newDimensions","beforeState","afterState","handleEditorClick","imageToRemove","handleScroll","viewport","observer","mutations","mutation","buttonBaseStyle","deleteButtonStyle","getAlignmentButtonStyle","isActive","ImageTooltipMenu","onAlignChange","onAspectRatioToggle","onDelete","onClose","initialPreserveAspectRatio","setPosition","isVisible","setIsVisible","menuPosition","setMenuPosition","preserveAspectRatio","setPreserveAspectRatio","menuRef","syncResizeOverlayPosition","getImageState","style","getCurrentAlignment","currentAlignment","setCurrentAlignment","calculateMenuPosition","imageRect","menuRect","viewportWidth","viewportHeight","isImageInViewport","top","left","spaceAbove","spaceBelow","adjustedLeft","adjustedTop","useLayoutEffect","alignmentStyles","handleAlign","alignment","oldAlignment","styles","handleDelete","handleAspectRatioToggle","oldPreserveRatio","newPreserveRatio","createPortal","suppressEvent","clearClasses","selector","classArray","isWithin","clearTextSelection","DEFAULT_TABLE_RESIZE_OPTIONS","TABLE_RESIZE_HANDLERS","isResizableTable","getTableStructure","rows","columns","columnWidths","colgroup","cols","col","firstRow","cell","rowHeights","row","calculateTableResizeDimensions","delta","currentStructure","applyResize","arrayIndex","min","max","synchronizeTableColgroup","columnCount","existingCols","currentColCount","applyTableDimensions","tableWidth","tableHeight","sumWidth","sum","sumHeight","createTableResizeOverlay","structure","createIndexedResizeHandler","bottomHandler","createBoundaryResizeHandler","rightHandler","HANDLER_CONFIG","createResizeHandler","primarySize","positionResizeHandler","updateTableResizeOverlay","columnHandlers","rowHandlers","newBottomHandler","newRightHandler","removeTableResizeOverlay","validateTable","operationName","createRowWithCells","referenceRow","newRow","cellCount","newCell","insertRowAtPosition","rowIndex","offset","targetIndex","insertRowAbove","insertRowBelow","createColumnCell","insertColumnAtPosition","columnIndex","insertColumnLeft","insertColumnRight","positionColumnHandler","positionRowHandler","positionBottomHandler","positionRightHandler","cellRect","tableRect","deleteTableElement","deleteRowInternal","deleteColumnInternal","deleteRow","deleteColumn","TableResizeHandlers","onTableResize","onTableSelect","onTableDeselect","resizeOverlayRef","resizeTableRef","resizeStartRef","resizeTypeRef","resizeIndexRef","isResizingRef","selectedTable","setSelectedTable","clearTableSelection","cursor","createAndAttachOverlay","handleTableSelection","startStructure","tableToRemove","tables","BUTTON_BASE_STYLE","ALIGNMENT_STYLES","OPERATION_TYPES","syncResizeOverlay","callback","getTableAlignmentState","TableTooltipMenu","selectedRowIndex","selectedColIndex","viewportRect","isTableInViewport","createTableOperationHandler","operationType","operationFn","isRowOperation","selectedIndex","handleInsertRowAbove","handleInsertRowBelow","handleInsertColumnLeft","handleInsertColumnRight","handleDeleteRow","handleDeleteColumn","ACTION_BUTTON_STYLES","MENU_CONTAINER_STYLE","SELECTION_CLASSES","clearVisualSelection","TableCellSelection","onCellSelectionChange","selectionStateRef","isSelecting","setIsSelecting","hasDragged","setHasDragged","startCell","setStartCell","currentTable","setCurrentTable","lastSelectionRef","resetSelectionState","clearSelection","getCellCoordinates","table","cellIndex","checkSelectionExpansion","cells","cellArray","firstCell","coords","cellCoords","applyVisualSelection","colIndex","updateSelection","newCells","expansion","newSelection","handleMouseDown","handleMouseEnter","startCoords","currentCoords","minRow","maxRow","minCol","maxCol","tableRow","tableCell","handleMouseUp","handleMouseDownCapture","handleMouseEnterCapture","INITIAL_BOUNDARY_DELAY","NAVIGATION_DELAY","SCROLL_DEBOUNCE","NAVIGATION_LOCK_TIMEOUT","HtmlEditor","pageManagerComponent","onNavigatePage","onPageSizeChangeCallback","onPageMarginsChangeCallback","onChange","showSidebar","showToolbar","showPageManager","imageSelected","setImageSelected","selectedImage","setSelectedImage","tableSelected","setTableSelected","setSelectedRowIndex","setSelectedColIndex","sidebarCollapsed","setSidebarCollapsed","scrollTimeoutRef","addingPageRef","isNavigatingRef","contentSetRef","lastContentRef","navigateToNewPage","newPageIndex","timer","updateContentAndBoundaries","insertHtmlWithCursorRestore","updatedContent","exposedMethods","normalizedHtml","useImperativeHandle","updateContent","previousContent","updateOperation","handleInput","_event","handlePageSizeChange","handlePageMarginsChange","handleNavigatePage","handleAddPage","nextPageNumber","handleAddPageBreak","pageBreakHTML","handleInsertImage","handleRemovePageBreak","actionHandlers","words","handleImageSelect","handleImageDeselect","handleImageResize","__","handleCellSelectionChange","handleTableSelect","handleTableDeselect","handleTableResize","_alignment","imageKey","ErrorBoundary","errorInfo"],"mappings":"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","x_google_ignoreList":[0,1,2,7,8,9,10,11,12,13,14,15,16,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70]}