(function(D,p){typeof exports=="object"&&typeof module<"u"?p(exports,require("react"),require("uuid"),require("react-dom")):typeof define=="function"&&define.amd?define(["exports","react","uuid","react-dom"],p):(D=typeof globalThis<"u"?globalThis:D||self,p(D.HTMLEditor={},D.React,D.uuid,D.ReactDOM))})(this,(function(D,p,rt,It){"use strict";function nr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ie={exports:{}},_e={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dt;function rr(){if(Dt)return _e;Dt=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(r,s,a){var o=null;if(a!==void 0&&(o=""+a),s.key!==void 0&&(o=""+s.key),"key"in s){a={};for(var i in s)i!=="key"&&(a[i]=s[i])}else a=s;return s=a.ref,{$$typeof:e,type:r,key:o,ref:s!==void 0?s:null,props:a}}return _e.Fragment=t,_e.jsx=n,_e.jsxs=n,_e}var Ce={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ht;function or(){return Ht||(Ht=1,process.env.NODE_ENV!=="production"&&(function(){function e(f){if(f==null)return null;if(typeof f=="function")return f.$$typeof===U?null:f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case k:return"Fragment";case j:return"Profiler";case L:return"StrictMode";case h:return"Suspense";case _:return"SuspenseList";case z:return"Activity"}if(typeof f=="object")switch(typeof f.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),f.$$typeof){case E:return"Portal";case b:return f.displayName||"Context";case I:return(f._context.displayName||"Context")+".Consumer";case g:var C=f.render;return f=f.displayName,f||(f=C.displayName||C.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case A:return C=f.displayName||null,C!==null?C:e(f.type)||"Memo";case N:C=f._payload,f=f._init;try{return e(f(C))}catch{}}return null}function t(f){return""+f}function n(f){try{t(f);var C=!1}catch{C=!0}if(C){C=console;var R=C.error,P=typeof Symbol=="function"&&Symbol.toStringTag&&f[Symbol.toStringTag]||f.constructor.name||"Object";return R.call(C,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",P),t(f)}}function r(f){if(f===k)return"<>";if(typeof f=="object"&&f!==null&&f.$$typeof===N)return"<...>";try{var C=e(f);return C?"<"+C+">":"<...>"}catch{return"<...>"}}function s(){var f=X.A;return f===null?null:f.getOwner()}function a(){return Error("react-stack-top-frame")}function o(f){if(M.call(f,"key")){var C=Object.getOwnPropertyDescriptor(f,"key").get;if(C&&C.isReactWarning)return!1}return f.key!==void 0}function i(f,C){function R(){ee||(ee=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",C))}R.isReactWarning=!0,Object.defineProperty(f,"key",{get:R,configurable:!0})}function m(){var f=e(this.type);return ne[f]||(ne[f]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),f=this.props.ref,f!==void 0?f:null}function l(f,C,R,P,F,G){var H=R.ref;return f={$$typeof:v,type:f,key:C,props:R,_owner:P},(H!==void 0?H:null)!==null?Object.defineProperty(f,"ref",{enumerable:!1,get:m}):Object.defineProperty(f,"ref",{enumerable:!1,value:null}),f._store={},Object.defineProperty(f._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(f,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(f,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:F}),Object.defineProperty(f,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:G}),Object.freeze&&(Object.freeze(f.props),Object.freeze(f)),f}function d(f,C,R,P,F,G){var H=C.children;if(H!==void 0)if(P)if(W(H)){for(P=0;P<H.length;P++)c(H[P]);Object.freeze&&Object.freeze(H)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else c(H);if(M.call(C,"key")){H=e(f);var q=Object.keys(C).filter(function(Z){return Z!=="key"});P=0<q.length?"{key: someKey, "+q.join(": ..., ")+": ...}":"{key: someKey}",x[H+P]||(q=0<q.length?"{"+q.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,P,H,q,H),x[H+P]=!0)}if(H=null,R!==void 0&&(n(R),H=""+R),o(C)&&(n(C.key),H=""+C.key),"key"in C){R={};for(var Y in C)Y!=="key"&&(R[Y]=C[Y])}else R=C;return H&&i(R,typeof f=="function"?f.displayName||f.name||"Unknown":f),l(f,H,R,s(),F,G)}function c(f){u(f)?f._store&&(f._store.validated=1):typeof f=="object"&&f!==null&&f.$$typeof===N&&(f._payload.status==="fulfilled"?u(f._payload.value)&&f._payload.value._store&&(f._payload.value._store.validated=1):f._store&&(f._store.validated=1))}function u(f){return typeof f=="object"&&f!==null&&f.$$typeof===v}var w=p,v=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),L=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),I=Symbol.for("react.consumer"),b=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),z=Symbol.for("react.activity"),U=Symbol.for("react.client.reference"),X=w.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M=Object.prototype.hasOwnProperty,W=Array.isArray,te=console.createTask?console.createTask:function(){return null};w={react_stack_bottom_frame:function(f){return f()}};var ee,ne={},oe=w.react_stack_bottom_frame.bind(w,a)(),le=te(r(a)),x={};Ce.Fragment=k,Ce.jsx=function(f,C,R){var P=1e4>X.recentlyCreatedOwnerStacks++;return d(f,C,R,!1,P?Error("react-stack-top-frame"):oe,P?te(r(f)):le)},Ce.jsxs=function(f,C,R){var P=1e4>X.recentlyCreatedOwnerStacks++;return d(f,C,R,!0,P?Error("react-stack-top-frame"):oe,P?te(r(f)):le)}})()),Ce}var Bt;function ar(){return Bt||(Bt=1,process.env.NODE_ENV==="production"?Ie.exports=rr():Ie.exports=or()),Ie.exports}var y=ar();const ot=100,at=50,st=200,jt=5,it=e=>e<st,ct=e=>e>at,sr=96,De=e=>Math.round(e*sr),He={NORMAL:{name:"Normal",label:'Normal (1")',top:1,bottom:1,left:1,right:1},NARROW:{name:"Narrow",label:'Narrow (0.5")',top:.5,bottom:.5,left:.5,right:.5},MODERATE:{name:"Moderate",label:'Moderate (1" / 0.75")',top:1,bottom:1,left:.75,right:.75},WIDE:{name:"Wide",label:'Wide (1" / 2")',top:1,bottom:1,left:2,right:2},OFFICE_2003:{name:"Office 2003",label:'Office 2003 (1" / 1.25")',top:1,bottom:1,left:1.25,right:1.25}},de="NORMAL",zt=(e=de)=>{const t=He[e]||He[de];return{top:De(t.top),bottom:De(t.bottom),left:De(t.left),right:De(t.right)}},ir=(e=de)=>{const t=zt(e);return t.top+t.bottom},cr=()=>Object.keys(He),lr=e=>{const t=He[e];return t?t.label:"Unknown"},be={A4:{name:"A4",width:794,height:1123,widthMm:210,heightMm:297,widthIn:8.27,heightIn:11.69},Letter:{name:"Letter",width:816,height:1056,widthMm:216,heightMm:279,widthIn:8.5,heightIn:11},Legal:{name:"Legal",width:816,height:1344,widthMm:216,heightMm:356,widthIn:8.5,heightIn:14}},lt="A4",Be=e=>{const t=be[e]||be[lt];return{width:t.width,height:t.height}},ur=e=>Object.keys(be).includes(e),dr=()=>Object.keys(be),ke=lt,Ee="<p><br></p>",fr="continuous",Se=(e,t=ke)=>({id:rt.v4(),index:e,size:t,content:Ee,images:[],isBreakPoint:!1}),je=e=>typeof e!="string"||e.trim()===""?Ee:e,$t=(e,t=ke)=>(e.length>0?e:[Se(0,t)]).map((r,s)=>({id:r.id||rt.v4(),index:s,size:r.size||t,content:je(r.content),images:r.images||[],isBreakPoint:!!r.isBreakPoint})),pr=(e=ke)=>[{id:"page-0",pageNumber:1,top:0,height:Be(e).height}],ze=e=>e.slice(0,-1).map((t,n)=>({id:`auto-break-${n}`,pageNumber:n+1})),ut=(e={})=>{const t=new Date().toISOString(),n=e.pageSize||ke,r=$t(e.pages||[Se(0,n)],n);return{id:rt.v4(),title:e.title||"Untitled Document",createdAt:t,updatedAt:t,pageSize:n,pages:r,activePage:e.activePage&&e.activePage<r.length?e.activePage:0,pageBreaks:e.pageBreaks||[],totalPages:r.length,editorMode:e.editorMode||fr,continuousContent:e.continuousContent||Ee,pageBoundaries:e.pageBoundaries||pr(n),zoomLevel:e.zoomLevel||ot,pageMargins:e.pageMargins||de,undoStack:[],redoStack:[],canUndo:!1,canRedo:!1}},$={INITIALIZE_DOCUMENT:"INITIALIZE_DOCUMENT",UPDATE_TITLE:"UPDATE_TITLE",UPDATE_PAGE_CONTENT:"UPDATE_PAGE_CONTENT",UPDATE_PAGES:"UPDATE_PAGES",ADD_PAGE:"ADD_PAGE",DELETE_PAGE:"DELETE_PAGE",SET_ACTIVE_PAGE:"SET_ACTIVE_PAGE",UPDATE_PAGE_SIZE:"UPDATE_PAGE_SIZE",RESET_DOCUMENT:"RESET_DOCUMENT",UPDATE_CONTINUOUS_CONTENT:"UPDATE_CONTINUOUS_CONTENT",UPDATE_PAGE_BOUNDARIES:"UPDATE_PAGE_BOUNDARIES",ADD_PAGE_BREAK:"ADD_PAGE_BREAK",REMOVE_PAGE_BREAK:"REMOVE_PAGE_BREAK",SET_EDITOR_MODE:"SET_EDITOR_MODE",SET_ZOOM_LEVEL:"SET_ZOOM_LEVEL",ZOOM_IN:"ZOOM_IN",ZOOM_OUT:"ZOOM_OUT",RESET_ZOOM:"RESET_ZOOM",UPDATE_PAGE_MARGINS:"UPDATE_PAGE_MARGINS",RECORD_OPERATION:"RECORD_OPERATION",UNDO:"UNDO",REDO:"REDO",CLEAR_UNDO_REDO:"CLEAR_UNDO_REDO"},dt=(e,t)=>{const n=new Date().toISOString();switch(t.type){case $.INITIALIZE_DOCUMENT:{const{initialContent:r=Ee,pageSize:s=ke}=t.payload||{},a={...Se(0,s),content:je(r)};return ut({title:e.title,pageSize:s,pages:[a]})}case $.UPDATE_TITLE:return{...e,title:t.payload,updatedAt:n};case $.UPDATE_PAGE_CONTENT:{const{pageIndex:r,content:s}=t.payload;if(r<0||r>=e.pages.length)return e;const a=[...e.pages];return a[r]={...a[r],content:je(s)},{...e,pages:a,updatedAt:n}}case $.UPDATE_PAGES:{const r=Array.isArray(t.payload)?{pages:t.payload}:t.payload||{},s=$t(r.pages||[],e.pageSize),a=Array.isArray(r.pageBreaks)?r.pageBreaks:ze(s);return{...e,pages:s,activePage:Math.min(e.activePage,s.length-1),pageBreaks:a,totalPages:s.length,updatedAt:n}}case $.ADD_PAGE:{const r=typeof t.payload?.index=="number"?Math.min(Math.max(t.payload.index,0),e.pages.length):e.pages.length,s=[...e.pages];s.splice(r,0,Se(r,e.pageSize));const a=s.map((i,m)=>({...i,index:m,size:e.pageSize})),o=ze(a);return{...e,pages:a,activePage:r,pageBreaks:o,totalPages:a.length,updatedAt:n}}case $.DELETE_PAGE:{const r=t.payload;if(e.pages.length<=1)return e;const s=[...e.pages];s.splice(r,1);const a=s.map((m,l)=>({...m,index:l,size:e.pageSize}));let o=e.activePage;o>=a.length?o=a.length-1:r<=o&&o>0&&(o-=1);const i=ze(a);return{...e,pages:a,activePage:o,pageBreaks:i,totalPages:a.length,updatedAt:n}}case $.SET_ACTIVE_PAGE:{const r=t.payload;if(r===e.activePage)return e;const s=e.editorMode==="continuous"?e.pageBoundaries.length:e.pages.length;return r<0||r>=s?e:{...e,activePage:r,updatedAt:n}}case $.UPDATE_PAGE_SIZE:{const r=t.payload;if(r===e.pageSize)return e;try{Be(r)}catch{return console.warn(`Invalid page size: ${r}`),e}const s=e.pages.map((o,i)=>({...o,index:i,size:r})),a=ze(s);return{...e,pageSize:r,pages:s,pageBreaks:a,updatedAt:n}}case $.RESET_DOCUMENT:return ut();case $.UPDATE_CONTINUOUS_CONTENT:{const r=je(t.payload);return r===e.continuousContent?e:{...e,continuousContent:r,updatedAt:n}}case $.UPDATE_PAGE_BOUNDARIES:{const r=Array.isArray(t.payload)?t.payload:[];if(r.length===e.pageBoundaries.length&&r.length>0&&r[0].id===e.pageBoundaries[0]?.id&&r[r.length-1].id===e.pageBoundaries[r.length-1]?.id)return e;const s=e.activePage>=r.length?Math.max(0,r.length-1):e.activePage;return{...e,pageBoundaries:r,totalPages:r.length,activePage:s,updatedAt:n}}case $.ADD_PAGE_BREAK:{const{position:r="end",pageIndex:s}=t.payload||{},a='<page-break data-page-break="true" style="display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;"></page-break>';let o=e.continuousContent;if(r==="end")o=o+a+"<p><br></p>";else if(typeof r=="number"){const i=o.substring(0,r),m=o.substring(r);o=i+a+m}else if(typeof s=="number"&&typeof document<"u"){const i=document.createElement("div");i.innerHTML=o;const m=i.querySelectorAll('page-break, [data-page-break="true"]');if(s===0&&m.length===0)o=o+a+"<p><br></p>";else if(s<m.length){const l=m[s],d=document.createElement("page-break");d.setAttribute("data-page-break","true"),d.setAttribute("style","display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;");const c=document.createElement("p");c.innerHTML="<br>",l.parentNode.insertBefore(d,l.nextSibling),d.parentNode.insertBefore(c,d.nextSibling),o=i.innerHTML}else o=o+a+"<p><br></p>"}return{...e,continuousContent:o,updatedAt:n}}case $.REMOVE_PAGE_BREAK:{const{pageIndex:r}=t.payload||{};if(typeof r!="number"||typeof document>"u")return e;const s=document.createElement("div");s.innerHTML=e.continuousContent;const a=s.querySelectorAll('page-break, [data-page-break="true"]');return a[r]&&a[r].remove(),s.querySelectorAll('page-break, [data-page-break="true"]').forEach((i,m)=>{i.setAttribute("data-page-number",String(m+2))}),{...e,continuousContent:s.innerHTML,updatedAt:n}}case $.SET_EDITOR_MODE:{const r=t.payload;if(r===e.editorMode)return e;let s=e.continuousContent,a=e.pages;return r==="continuous"?s=e.pages.map(i=>i.content).filter(i=>i&&i!==Ee).join(`
`)||Ee:e.continuousContent&&e.continuousContent!==Ee&&(a=[{...Se(0,e.pageSize),content:e.continuousContent}]),{...e,editorMode:r,continuousContent:s,pages:a,updatedAt:n}}case $.SET_ZOOM_LEVEL:{const r=t.payload;return r<at||r>st?(console.warn(`Invalid zoom level: ${r}. Must be between ${at} and ${st}.`),e):r===e.zoomLevel?e:{...e,zoomLevel:r,updatedAt:n}}case $.ZOOM_IN:{if(!it(e.zoomLevel))return e;const r=e.zoomLevel+jt;return{...e,zoomLevel:r,updatedAt:n}}case $.ZOOM_OUT:{if(!ct(e.zoomLevel))return e;const r=e.zoomLevel-jt;return{...e,zoomLevel:r,updatedAt:n}}case $.RESET_ZOOM:return e.zoomLevel===ot?e:{...e,zoomLevel:ot,updatedAt:n};case $.UPDATE_PAGE_MARGINS:{const r=t.payload;return r===e.pageMargins?e:{...e,pageMargins:r,updatedAt:n}}case $.RECORD_OPERATION:{const{operation:r,inverseOperation:s}=t.payload;return{...e,undoStack:[...e.undoStack,{operation:r,inverseOperation:s}],redoStack:[],canUndo:!0,canRedo:!1,updatedAt:n}}case $.UNDO:{if(e.undoStack.length===0)return e;const r=e.undoStack[e.undoStack.length-1],s=e.undoStack.slice(0,-1);let a=e;return r.inverseOperation&&(a=dt(e,r.inverseOperation)),{...a,undoStack:s,redoStack:[...e.redoStack,r],canUndo:s.length>0,canRedo:!0,updatedAt:n}}case $.REDO:{if(e.redoStack.length===0)return e;const r=e.redoStack[e.redoStack.length-1],s=e.redoStack.slice(0,-1);let a=e;return r.operation&&(a=dt(e,r.operation)),{...a,undoStack:[...e.undoStack,r],redoStack:s,canUndo:!0,canRedo:s.length>0,updatedAt:n}}case $.CLEAR_UNDO_REDO:return{...e,undoStack:[],redoStack:[],canUndo:!1,canRedo:!1,updatedAt:n};default:return e}},Ut=p.createContext(null),gr=({children:e,initialState:t={}})=>{const[n,r]=p.useReducer(dt,ut(t)),s=p.useMemo(()=>({initializeDocument:o=>r({type:$.INITIALIZE_DOCUMENT,payload:o}),updateTitle:o=>r({type:$.UPDATE_TITLE,payload:o}),updatePageContent:o=>r({type:$.UPDATE_PAGE_CONTENT,payload:o}),updatePages:o=>r({type:$.UPDATE_PAGES,payload:o}),addPage:o=>r({type:$.ADD_PAGE,payload:o}),deletePage:o=>r({type:$.DELETE_PAGE,payload:o}),setActivePage:o=>r({type:$.SET_ACTIVE_PAGE,payload:o}),updatePageSize:o=>r({type:$.UPDATE_PAGE_SIZE,payload:o}),resetDocument:()=>r({type:$.RESET_DOCUMENT}),updateContinuousContent:o=>r({type:$.UPDATE_CONTINUOUS_CONTENT,payload:o}),updatePageBoundaries:o=>r({type:$.UPDATE_PAGE_BOUNDARIES,payload:o}),addPageBreak:o=>r({type:$.ADD_PAGE_BREAK,payload:o}),removePageBreak:o=>r({type:$.REMOVE_PAGE_BREAK,payload:o}),setEditorMode:o=>r({type:$.SET_EDITOR_MODE,payload:o}),setZoomLevel:o=>r({type:$.SET_ZOOM_LEVEL,payload:o}),zoomIn:()=>r({type:$.ZOOM_IN}),zoomOut:()=>r({type:$.ZOOM_OUT}),resetZoom:()=>r({type:$.RESET_ZOOM}),updatePageMargins:o=>r({type:$.UPDATE_PAGE_MARGINS,payload:o}),recordOperation:(o,i)=>r({type:$.RECORD_OPERATION,payload:{operation:o,inverseOperation:i}}),undo:()=>r({type:$.UNDO}),redo:()=>r({type:$.REDO}),clearUndoRedo:()=>r({type:$.CLEAR_UNDO_REDO})}),[]),a=p.useMemo(()=>({state:n,actions:s,dispatch:r}),[n,s]);return y.jsx(Ut.Provider,{value:a,children:e})},ft=()=>{const e=p.useContext(Ut);if(!e)throw new Error("useDocument must be used within a DocumentProvider");return e},pt=()=>{const{state:e}=ft();return e},he=()=>{const{actions:e}=ft();return e};var $e={exports:{}},Ue={exports:{}},J={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ft;function hr(){if(Ft)return J;Ft=1;var e=typeof Symbol=="function"&&Symbol.for,t=e?Symbol.for("react.element"):60103,n=e?Symbol.for("react.portal"):60106,r=e?Symbol.for("react.fragment"):60107,s=e?Symbol.for("react.strict_mode"):60108,a=e?Symbol.for("react.profiler"):60114,o=e?Symbol.for("react.provider"):60109,i=e?Symbol.for("react.context"):60110,m=e?Symbol.for("react.async_mode"):60111,l=e?Symbol.for("react.concurrent_mode"):60111,d=e?Symbol.for("react.forward_ref"):60112,c=e?Symbol.for("react.suspense"):60113,u=e?Symbol.for("react.suspense_list"):60120,w=e?Symbol.for("react.memo"):60115,v=e?Symbol.for("react.lazy"):60116,E=e?Symbol.for("react.block"):60121,k=e?Symbol.for("react.fundamental"):60117,L=e?Symbol.for("react.responder"):60118,j=e?Symbol.for("react.scope"):60119;function I(g){if(typeof g=="object"&&g!==null){var h=g.$$typeof;switch(h){case t:switch(g=g.type,g){case m:case l:case r:case a:case s:case c:return g;default:switch(g=g&&g.$$typeof,g){case i:case d:case v:case w:case o:return g;default:return h}}case n:return h}}}function b(g){return I(g)===l}return J.AsyncMode=m,J.ConcurrentMode=l,J.ContextConsumer=i,J.ContextProvider=o,J.Element=t,J.ForwardRef=d,J.Fragment=r,J.Lazy=v,J.Memo=w,J.Portal=n,J.Profiler=a,J.StrictMode=s,J.Suspense=c,J.isAsyncMode=function(g){return b(g)||I(g)===m},J.isConcurrentMode=b,J.isContextConsumer=function(g){return I(g)===i},J.isContextProvider=function(g){return I(g)===o},J.isElement=function(g){return typeof g=="object"&&g!==null&&g.$$typeof===t},J.isForwardRef=function(g){return I(g)===d},J.isFragment=function(g){return I(g)===r},J.isLazy=function(g){return I(g)===v},J.isMemo=function(g){return I(g)===w},J.isPortal=function(g){return I(g)===n},J.isProfiler=function(g){return I(g)===a},J.isStrictMode=function(g){return I(g)===s},J.isSuspense=function(g){return I(g)===c},J.isValidElementType=function(g){return typeof g=="string"||typeof g=="function"||g===r||g===l||g===a||g===s||g===c||g===u||typeof g=="object"&&g!==null&&(g.$$typeof===v||g.$$typeof===w||g.$$typeof===o||g.$$typeof===i||g.$$typeof===d||g.$$typeof===k||g.$$typeof===L||g.$$typeof===j||g.$$typeof===E)},J.typeOf=I,J}var Q={};/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gt;function mr(){return Gt||(Gt=1,process.env.NODE_ENV!=="production"&&(function(){var e=typeof Symbol=="function"&&Symbol.for,t=e?Symbol.for("react.element"):60103,n=e?Symbol.for("react.portal"):60106,r=e?Symbol.for("react.fragment"):60107,s=e?Symbol.for("react.strict_mode"):60108,a=e?Symbol.for("react.profiler"):60114,o=e?Symbol.for("react.provider"):60109,i=e?Symbol.for("react.context"):60110,m=e?Symbol.for("react.async_mode"):60111,l=e?Symbol.for("react.concurrent_mode"):60111,d=e?Symbol.for("react.forward_ref"):60112,c=e?Symbol.for("react.suspense"):60113,u=e?Symbol.for("react.suspense_list"):60120,w=e?Symbol.for("react.memo"):60115,v=e?Symbol.for("react.lazy"):60116,E=e?Symbol.for("react.block"):60121,k=e?Symbol.for("react.fundamental"):60117,L=e?Symbol.for("react.responder"):60118,j=e?Symbol.for("react.scope"):60119;function I(S){return typeof S=="string"||typeof S=="function"||S===r||S===l||S===a||S===s||S===c||S===u||typeof S=="object"&&S!==null&&(S.$$typeof===v||S.$$typeof===w||S.$$typeof===o||S.$$typeof===i||S.$$typeof===d||S.$$typeof===k||S.$$typeof===L||S.$$typeof===j||S.$$typeof===E)}function b(S){if(typeof S=="object"&&S!==null){var ie=S.$$typeof;switch(ie){case t:var ge=S.type;switch(ge){case m:case l:case r:case a:case s:case c:return ge;default:var we=ge&&ge.$$typeof;switch(we){case i:case d:case v:case w:case o:return we;default:return ie}}case n:return ie}}}var g=m,h=l,_=i,A=o,N=t,z=d,U=r,X=v,M=w,W=n,te=a,ee=s,ne=c,oe=!1;function le(S){return oe||(oe=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),x(S)||b(S)===m}function x(S){return b(S)===l}function f(S){return b(S)===i}function C(S){return b(S)===o}function R(S){return typeof S=="object"&&S!==null&&S.$$typeof===t}function P(S){return b(S)===d}function F(S){return b(S)===r}function G(S){return b(S)===v}function H(S){return b(S)===w}function q(S){return b(S)===n}function Y(S){return b(S)===a}function Z(S){return b(S)===s}function se(S){return b(S)===c}Q.AsyncMode=g,Q.ConcurrentMode=h,Q.ContextConsumer=_,Q.ContextProvider=A,Q.Element=N,Q.ForwardRef=z,Q.Fragment=U,Q.Lazy=X,Q.Memo=M,Q.Portal=W,Q.Profiler=te,Q.StrictMode=ee,Q.Suspense=ne,Q.isAsyncMode=le,Q.isConcurrentMode=x,Q.isContextConsumer=f,Q.isContextProvider=C,Q.isElement=R,Q.isForwardRef=P,Q.isFragment=F,Q.isLazy=G,Q.isMemo=H,Q.isPortal=q,Q.isProfiler=Y,Q.isStrictMode=Z,Q.isSuspense=se,Q.isValidElementType=I,Q.typeOf=b})()),Q}var Wt;function qt(){return Wt||(Wt=1,process.env.NODE_ENV==="production"?Ue.exports=hr():Ue.exports=mr()),Ue.exports}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var gt,Zt;function yr(){if(Zt)return gt;Zt=1;var e=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;function r(a){if(a==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(a)}function s(){try{if(!Object.assign)return!1;var a=new String("abc");if(a[5]="de",Object.getOwnPropertyNames(a)[0]==="5")return!1;for(var o={},i=0;i<10;i++)o["_"+String.fromCharCode(i)]=i;var m=Object.getOwnPropertyNames(o).map(function(d){return o[d]});if(m.join("")!=="0123456789")return!1;var l={};return"abcdefghijklmnopqrst".split("").forEach(function(d){l[d]=d}),Object.keys(Object.assign({},l)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return gt=s()?Object.assign:function(a,o){for(var i,m=r(a),l,d=1;d<arguments.length;d++){i=Object(arguments[d]);for(var c in i)t.call(i,c)&&(m[c]=i[c]);if(e){l=e(i);for(var u=0;u<l.length;u++)n.call(i,l[u])&&(m[l[u]]=i[l[u]])}}return m},gt}var ht,Yt;function mt(){if(Yt)return ht;Yt=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return ht=e,ht}var yt,Vt;function Kt(){return Vt||(Vt=1,yt=Function.call.bind(Object.prototype.hasOwnProperty)),yt}var bt,Xt;function br(){if(Xt)return bt;Xt=1;var e=function(){};if(process.env.NODE_ENV!=="production"){var t=mt(),n={},r=Kt();e=function(a){var o="Warning: "+a;typeof console<"u"&&console.error(o);try{throw new Error(o)}catch{}}}function s(a,o,i,m,l){if(process.env.NODE_ENV!=="production"){for(var d in a)if(r(a,d)){var c;try{if(typeof a[d]!="function"){var u=Error((m||"React class")+": "+i+" type `"+d+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof a[d]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw u.name="Invariant Violation",u}c=a[d](o,d,m,i,null,t)}catch(v){c=v}if(c&&!(c instanceof Error)&&e((m||"React class")+": type specification of "+i+" `"+d+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof c+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),c instanceof Error&&!(c.message in n)){n[c.message]=!0;var w=l?l():"";e("Failed "+i+" type: "+c.message+(w??""))}}}}return s.resetWarningCache=function(){process.env.NODE_ENV!=="production"&&(n={})},bt=s,bt}var Et,Jt;function Er(){if(Jt)return Et;Jt=1;var e=qt(),t=yr(),n=mt(),r=Kt(),s=br(),a=function(){};process.env.NODE_ENV!=="production"&&(a=function(i){var m="Warning: "+i;typeof console<"u"&&console.error(m);try{throw new Error(m)}catch{}});function o(){return null}return Et=function(i,m){var l=typeof Symbol=="function"&&Symbol.iterator,d="@@iterator";function c(x){var f=x&&(l&&x[l]||x[d]);if(typeof f=="function")return f}var u="<<anonymous>>",w={array:L("array"),bigint:L("bigint"),bool:L("boolean"),func:L("function"),number:L("number"),object:L("object"),string:L("string"),symbol:L("symbol"),any:j(),arrayOf:I,element:b(),elementType:g(),instanceOf:h,node:z(),objectOf:A,oneOf:_,oneOfType:N,shape:X,exact:M};function v(x,f){return x===f?x!==0||1/x===1/f:x!==x&&f!==f}function E(x,f){this.message=x,this.data=f&&typeof f=="object"?f:{},this.stack=""}E.prototype=Error.prototype;function k(x){if(process.env.NODE_ENV!=="production")var f={},C=0;function R(F,G,H,q,Y,Z,se){if(q=q||u,Z=Z||H,se!==n){if(m){var S=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw S.name="Invariant Violation",S}else if(process.env.NODE_ENV!=="production"&&typeof console<"u"){var ie=q+":"+H;!f[ie]&&C<3&&(a("You are manually calling a React.PropTypes validation function for the `"+Z+"` prop on `"+q+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),f[ie]=!0,C++)}}return G[H]==null?F?G[H]===null?new E("The "+Y+" `"+Z+"` is marked as required "+("in `"+q+"`, but its value is `null`.")):new E("The "+Y+" `"+Z+"` is marked as required in "+("`"+q+"`, but its value is `undefined`.")):null:x(G,H,q,Y,Z)}var P=R.bind(null,!1);return P.isRequired=R.bind(null,!0),P}function L(x){function f(C,R,P,F,G,H){var q=C[R],Y=ee(q);if(Y!==x){var Z=ne(q);return new E("Invalid "+F+" `"+G+"` of type "+("`"+Z+"` supplied to `"+P+"`, expected ")+("`"+x+"`."),{expectedType:x})}return null}return k(f)}function j(){return k(o)}function I(x){function f(C,R,P,F,G){if(typeof x!="function")return new E("Property `"+G+"` of component `"+P+"` has invalid PropType notation inside arrayOf.");var H=C[R];if(!Array.isArray(H)){var q=ee(H);return new E("Invalid "+F+" `"+G+"` of type "+("`"+q+"` supplied to `"+P+"`, expected an array."))}for(var Y=0;Y<H.length;Y++){var Z=x(H,Y,P,F,G+"["+Y+"]",n);if(Z instanceof Error)return Z}return null}return k(f)}function b(){function x(f,C,R,P,F){var G=f[C];if(!i(G)){var H=ee(G);return new E("Invalid "+P+" `"+F+"` of type "+("`"+H+"` supplied to `"+R+"`, expected a single ReactElement."))}return null}return k(x)}function g(){function x(f,C,R,P,F){var G=f[C];if(!e.isValidElementType(G)){var H=ee(G);return new E("Invalid "+P+" `"+F+"` of type "+("`"+H+"` supplied to `"+R+"`, expected a single ReactElement type."))}return null}return k(x)}function h(x){function f(C,R,P,F,G){if(!(C[R]instanceof x)){var H=x.name||u,q=le(C[R]);return new E("Invalid "+F+" `"+G+"` of type "+("`"+q+"` supplied to `"+P+"`, expected ")+("instance of `"+H+"`."))}return null}return k(f)}function _(x){if(!Array.isArray(x))return process.env.NODE_ENV!=="production"&&(arguments.length>1?a("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):a("Invalid argument supplied to oneOf, expected an array.")),o;function f(C,R,P,F,G){for(var H=C[R],q=0;q<x.length;q++)if(v(H,x[q]))return null;var Y=JSON.stringify(x,function(se,S){var ie=ne(S);return ie==="symbol"?String(S):S});return new E("Invalid "+F+" `"+G+"` of value `"+String(H)+"` "+("supplied to `"+P+"`, expected one of "+Y+"."))}return k(f)}function A(x){function f(C,R,P,F,G){if(typeof x!="function")return new E("Property `"+G+"` of component `"+P+"` has invalid PropType notation inside objectOf.");var H=C[R],q=ee(H);if(q!=="object")return new E("Invalid "+F+" `"+G+"` of type "+("`"+q+"` supplied to `"+P+"`, expected an object."));for(var Y in H)if(r(H,Y)){var Z=x(H,Y,P,F,G+"."+Y,n);if(Z instanceof Error)return Z}return null}return k(f)}function N(x){if(!Array.isArray(x))return process.env.NODE_ENV!=="production"&&a("Invalid argument supplied to oneOfType, expected an instance of array."),o;for(var f=0;f<x.length;f++){var C=x[f];if(typeof C!="function")return a("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+oe(C)+" at index "+f+"."),o}function R(P,F,G,H,q){for(var Y=[],Z=0;Z<x.length;Z++){var se=x[Z],S=se(P,F,G,H,q,n);if(S==null)return null;S.data&&r(S.data,"expectedType")&&Y.push(S.data.expectedType)}var ie=Y.length>0?", expected one of type ["+Y.join(", ")+"]":"";return new E("Invalid "+H+" `"+q+"` supplied to "+("`"+G+"`"+ie+"."))}return k(R)}function z(){function x(f,C,R,P,F){return W(f[C])?null:new E("Invalid "+P+" `"+F+"` supplied to "+("`"+R+"`, expected a ReactNode."))}return k(x)}function U(x,f,C,R,P){return new E((x||"React class")+": "+f+" type `"+C+"."+R+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+P+"`.")}function X(x){function f(C,R,P,F,G){var H=C[R],q=ee(H);if(q!=="object")return new E("Invalid "+F+" `"+G+"` of type `"+q+"` "+("supplied to `"+P+"`, expected `object`."));for(var Y in x){var Z=x[Y];if(typeof Z!="function")return U(P,F,G,Y,ne(Z));var se=Z(H,Y,P,F,G+"."+Y,n);if(se)return se}return null}return k(f)}function M(x){function f(C,R,P,F,G){var H=C[R],q=ee(H);if(q!=="object")return new E("Invalid "+F+" `"+G+"` of type `"+q+"` "+("supplied to `"+P+"`, expected `object`."));var Y=t({},C[R],x);for(var Z in Y){var se=x[Z];if(r(x,Z)&&typeof se!="function")return U(P,F,G,Z,ne(se));if(!se)return new E("Invalid "+F+" `"+G+"` key `"+Z+"` supplied to `"+P+"`.\nBad object: "+JSON.stringify(C[R],null,"  ")+`
Valid keys: `+JSON.stringify(Object.keys(x),null,"  "));var S=se(H,Z,P,F,G+"."+Z,n);if(S)return S}return null}return k(f)}function W(x){switch(typeof x){case"number":case"string":case"undefined":return!0;case"boolean":return!x;case"object":if(Array.isArray(x))return x.every(W);if(x===null||i(x))return!0;var f=c(x);if(f){var C=f.call(x),R;if(f!==x.entries){for(;!(R=C.next()).done;)if(!W(R.value))return!1}else for(;!(R=C.next()).done;){var P=R.value;if(P&&!W(P[1]))return!1}}else return!1;return!0;default:return!1}}function te(x,f){return x==="symbol"?!0:f?f["@@toStringTag"]==="Symbol"||typeof Symbol=="function"&&f instanceof Symbol:!1}function ee(x){var f=typeof x;return Array.isArray(x)?"array":x instanceof RegExp?"object":te(f,x)?"symbol":f}function ne(x){if(typeof x>"u"||x===null)return""+x;var f=ee(x);if(f==="object"){if(x instanceof Date)return"date";if(x instanceof RegExp)return"regexp"}return f}function oe(x){var f=ne(x);switch(f){case"array":case"object":return"an "+f;case"boolean":case"date":case"regexp":return"a "+f;default:return f}}function le(x){return!x.constructor||!x.constructor.name?u:x.constructor.name}return w.checkPropTypes=s,w.resetWarningCache=s.resetWarningCache,w.PropTypes=w,w},Et}var Tt,Qt;function Tr(){if(Qt)return Tt;Qt=1;var e=mt();function t(){}function n(){}return n.resetWarningCache=t,Tt=function(){function r(o,i,m,l,d,c){if(c!==e){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}r.isRequired=r;function s(){return r}var a={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:s,element:r,elementType:r,instanceOf:s,node:r,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:n,resetWarningCache:t};return a.PropTypes=a,a},Tt}var en;function vr(){if(en)return $e.exports;if(en=1,process.env.NODE_ENV!=="production"){var e=qt(),t=!0;$e.exports=Er()(e.isElement,t)}else $e.exports=Tr()();return $e.exports}var xr=vr();const T=nr(xr),vt={"7.5pt":{pt:7.5,px:10,label:"7.5"},"9pt":{pt:9,px:12,label:"9"},"10pt":{pt:10,px:13,label:"10"},"11pt":{pt:11,px:15,label:"11"},"12pt":{pt:12,px:16,label:"12"},"14pt":{pt:14,px:19,label:"14"},"16pt":{pt:16,px:21,label:"16"},"18pt":{pt:18,px:24,label:"18"},"20pt":{pt:20,px:27,label:"20"},"22pt":{pt:22,px:29,label:"22"},"24pt":{pt:24,px:32,label:"24"},"26pt":{pt:26,px:35,label:"26"},"28pt":{pt:28,px:37,label:"28"},"36pt":{pt:36,px:48,label:"36"},"48pt":{pt:48,px:64,label:"48"},"72pt":{pt:72,px:96,label:"72"}},tn=[{value:"10px",label:"7.5",pt:7.5},{value:"12px",label:"9",pt:9},{value:"13px",label:"10",pt:10},{value:"15px",label:"11",pt:11},{value:"16px",label:"12",pt:12},{value:"19px",label:"14",pt:14},{value:"21px",label:"16",pt:16},{value:"24px",label:"18",pt:18},{value:"27px",label:"20",pt:20},{value:"32px",label:"24",pt:24},{value:"37px",label:"28",pt:28},{value:"48px",label:"36",pt:36},{value:"64px",label:"48",pt:48},{value:"96px",label:"72",pt:72}],Pe="16px",nn=e=>Math.round(e*96/72),rn=e=>Math.round(e*72/96*2)/2,wr=e=>{const t=Object.values(vt).find(n=>n.pt===e);return t?`${t.px}px`:`${nn(e)}px`},Ar=e=>{const t=parseInt(e),n=Object.values(vt).find(r=>r.px===t);return n?n.pt:rn(t)},_r=e=>{if(!e)return!1;if(e.endsWith("px")){const t=parseInt(e);return t>=8&&t<=144}if(e.endsWith("pt")){const t=parseFloat(e);return t>=6&&t<=108}return!1},Cr={"10px":"1","12px":"2","13px":"2","15px":"3","16px":"3","19px":"4","21px":"4","24px":"5","27px":"5","32px":"6","37px":"6","48px":"6","64px":"7","96px":"7"},on={bold:!1,italic:!1,underline:!1,strikethrough:!1,alignLeft:!1,alignCenter:!1,alignRight:!1,alignJustify:!1,fontFamily:"Arial",fontSize:Pe,headingLevel:"p"},an=()=>{const[e,t]=p.useState(on),n=he(),r=p.useCallback((c,u,w=null)=>{try{const v=window.getSelection();if(!v||v.rangeCount===0)return!1;const E=v.getRangeAt(0);if(!E.toString())return t(L=>({...L,[c]:u})),!1;try{const L=document.createElement("span");L.style[c]=u;const j=E.extractContents();return L.appendChild(j),E.insertNode(L),E.selectNodeContents(L),v.removeAllRanges(),v.addRange(E),t(I=>({...I,[c]:u})),!0}catch{if(w){const L=c==="fontSize"?Cr[u]||"3":u;return document.execCommand(w,!1,L),t(j=>({...j,[c]:u})),!0}return!1}}catch(v){return console.warn(`[useFormatting] Style application failed for ${c}:`,v),!1}},[]),s=p.useCallback(c=>r("fontFamily",c,"fontName"),[r]),a=p.useCallback(c=>r("fontSize",c,"fontSize"),[r]),o=p.useCallback(c=>{t(u=>({...u,alignLeft:c==="left",alignCenter:c==="center",alignRight:c==="right",alignJustify:c==="justify"}))},[]),i=p.useCallback(c=>{try{const u=window.getSelection();if(!u||u.rangeCount===0)return!1;const w=u.getRangeAt(0),v=w.toString(),k={justifyLeft:"left",justifyCenter:"center",justifyRight:"right",justifyFull:"justify"}[c];if(!k)return!1;if(!v){const j=w.startContainer,I=j.nodeType===Node.TEXT_NODE?j.parentElement:j,b=Fe(I)||Sr();return b&&(b.style.textAlign=k,o(k)),!0}const L=kr(w);if(L.length===0){const j=document.createElement("p");j.style.textAlign=k;const I=w.extractContents();j.appendChild(I),w.insertNode(j),w.selectNodeContents(j),u.removeAllRanges(),u.addRange(w)}else L.forEach(j=>{j.style.textAlign=k});return o(k),!0}catch(u){return console.warn("[useFormatting] Text alignment failed:",u),!1}},[o]),m=p.useCallback((c,u=null)=>{try{if(c==="undo"){n.undo();return}if(c==="redo"){n.redo();return}if(typeof document.execCommand!="function"){console.warn("[useFormatting] execCommand not supported");return}if(c==="fontSize"){a(u);return}if(c==="fontName"){s(u);return}if(["justifyLeft","justifyCenter","justifyRight","justifyFull"].includes(c)){i(c);return}switch(document.execCommand(c,!1,u)||console.warn(`[useFormatting] Command "${c}" failed`),c){case"bold":case"italic":case"underline":case"strikethrough":case"justifyLeft":case"justifyCenter":case"justifyRight":case"justifyFull":case"fontName":break;case"formatBlock":t(v=>({...v,headingLevel:u}));break;default:break}}catch(w){console.warn(`[useFormatting] Error executing command "${c}":`,w)}},[a,s,i,n]),l=p.useCallback(()=>{try{const c=window.getSelection();if(!c||c.rangeCount===0)return;const u=c.getRangeAt(0),w=u.toString();let v=Pe,E="Arial",k="p",L="left";if(w){const I=u.startContainer,b=I.nodeType===Node.TEXT_NODE?I.parentElement:I;if(b){const g=window.getComputedStyle(b),h=g.fontSize,_=g.fontFamily;h&&h.endsWith("px")&&(v=h),_&&_!=="serif"&&(E=_.split(",")[0].replace(/['"]/g,"").trim());const A=Fe(b);if(A){const N=A.tagName?.toLowerCase();["h1","h2","h3","h4","h5","h6","p"].includes(N)&&(k=N);const U=window.getComputedStyle(A).textAlign;["left","center","right","justify"].includes(U)&&(L=U)}}}const j={bold:document.queryCommandState("bold"),italic:document.queryCommandState("italic"),underline:document.queryCommandState("underline"),strikethrough:document.queryCommandState("strikethrough"),alignLeft:L==="left",alignCenter:L==="center",alignRight:L==="right",alignJustify:L==="justify",fontFamily:E,fontSize:v,headingLevel:k};t(I=>({...I,...j}))}catch(c){console.warn("[useFormatting] Error updating format from selection:",c)}},[]),d=p.useCallback(()=>{t(on)},[]);return{currentFormat:e,formatText:m,resetFormat:d,updateCurrentFormatFromSelection:l}};function Fe(e){let t=e;for(;t&&t!==document.body;){const n=t.tagName?.toLowerCase();if(["h1","h2","h3","h4","h5","h6","p"].includes(n))return t;if(t.contentEditable==="true"||t.contentEditable==="")break;t=t.parentElement}return null}function kr(e){const t=[],n=e.startContainer,r=e.endContainer,s=Fe(n.nodeType===Node.TEXT_NODE?n.parentElement:n),a=Fe(r.nodeType===Node.TEXT_NODE?r.parentElement:r);if(s===a&&s)return[s];const o=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_ELEMENT,{acceptNode:m=>{const l=m.tagName?.toLowerCase();return["h1","h2","h3","h4","h5","h6","p"].includes(l)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});let i=o.nextNode();for(;i;)e.intersectsNode(i)&&t.push(i),i=o.nextNode();return t}function Sr(){try{const e=window.getSelection();if(!e||e.rangeCount===0)return null;const t=e.getRangeAt(0),n=document.createElement("p");return n.innerHTML="<br>",t.insertNode(n),t.selectNodeContents(n),t.collapse(!0),e.removeAllRanges(),e.addRange(t),n}catch(e){return console.warn("[useFormatting] Failed to create paragraph at cursor:",e),null}}const me='page-break, [data-page-break="true"]',sn=e=>be[e]||be.A4,Pr=(e,t={})=>{if(!e||typeof document>"u")return[];const n=t.pageSize||"A4",r=sn(n),s=e.querySelectorAll(me),a=[];a.push({id:"page-0",pageNumber:1,top:0,height:r.height});const o=e.getBoundingClientRect(),i=e.scrollTop;return s.forEach((m,l)=>{const c=m.getBoundingClientRect().top-o.top+i;a.push({id:`page-${l+1}`,pageNumber:l+2,top:c,height:r.height})}),a},cn=(e,t=100,n=de)=>{const r=sn(e),s=ir(n),a=r.height-s,o=t/100;return a/o},Or=(e,t)=>{if(!e||!t)return 0;try{const n=t.querySelectorAll(me);if(n.length===0)return 0;const r=e.getBoundingClientRect(),s=r.top+r.height/2;for(let a=n.length-1;a>=0;a--)if(n[a].getBoundingClientRect().top<s)return a+1;return 0}catch(n){return console.warn("[getCurrentPage] Failed to calculate page:",n),0}},ln=e=>{if(!e)return[];const t=Array.from(e.children);if(t.length===0)return[];let n=[],r=[];for(const s of t)s.tagName==="PAGE-BREAK"||s.getAttribute("data-page-break")==="true"?r.length>0&&(n.push(r),r=[]):r.push(s);return r.length>0&&n.push(r),n.length===0&&t.length>0&&n.push(t.filter(s=>!(s.tagName==="PAGE-BREAK"||s.getAttribute("data-page-break")==="true"))),n},Nr=e=>{if(!e||!e.getBoundingClientRect)return 0;const t=e.getBoundingClientRect();if(e.tagName==="P"){const n=e.querySelectorAll("img"),r=e.textContent.trim();if(n.length===1&&!r){const a=n[0].getBoundingClientRect(),i=window.getComputedStyle(e).textAlign;if(i==="center"||i==="-webkit-center")return a.height+16}return t.height+16}return e.tagName==="H1"||e.tagName==="H2"||e.tagName==="H3"||e.tagName==="H4"||e.tagName==="H5"||e.tagName==="H6"?t.height+20:e.tagName==="UL"||e.tagName==="OL"?t.height+16:t.height},Mr=(e,t)=>{if(!e)return!1;try{const n=document.createElement("page-break");return n.setAttribute("data-page-break","true"),n.setAttribute("contenteditable","false"),n.setAttribute("data-page-number",t||"2"),e.parentNode.insertBefore(n,e),!0}catch(n){return console.warn("[insertPageBreakBefore] Failed to insert page break:",n),!1}},Rr=(e,t,n,r,s,a,o)=>{if(!e)return!1;try{const m=cn(n,r,s)*(t-1),l=Array.from(e.children);let d=0,c=null;for(let u=0;u<l.length;u++){const w=l[u];if(w.tagName==="PAGE-BREAK"||w.getAttribute("data-page-break")==="true")continue;const v=Nr(w);if(d+v>m){c=w;break}d+=v}if(c){const u=document.createElement("page-break");if(u.setAttribute("data-page-break","true"),u.setAttribute("contenteditable","false"),u.setAttribute("data-page-number",String(t)),c.parentNode.insertBefore(u,c),a){const w=e.innerHTML;a(w)}return o&&setTimeout(()=>{o()},50),!0}else{const u=document.createElement("page-break");u.setAttribute("data-page-break","true"),u.setAttribute("contenteditable","false"),u.setAttribute("data-page-number",String(t)),e.appendChild(u);const w=document.createElement("p");if(w.innerHTML="<br>",e.appendChild(w),a){const v=e.innerHTML;a(v)}return o&&setTimeout(()=>{o()},50),!0}}catch(i){return console.error("[insertPageBreakAtBoundary] Failed to insert page break:",i),!1}},Lr=(e,t,n,r,s,a,o)=>{if(!e)return!1;if(n().length<=1)return console.warn("[removePageAndContent] Cannot delete the only page"),!1;try{const m=Array.from(e.querySelectorAll(me));if(t>m.length)return console.warn("[removePageAndContent] Invalid page index"),!1;const l=window.getSelection();let d=!1,c=[],u=null;if(t===0){const v=m[0];if(!v)return console.warn("[removePageAndContent] No page break found for first page"),!1;let E=e.firstChild;for(;E&&E!==v;)c.push(E),E=E.nextSibling;u=v}else{const v=m[t-1];if(!v)return console.warn("[removePageAndContent] Page break not found"),!1;const E=m[t];let k=v.nextSibling;for(;k&&k!==E;)c.push(k),k=k.nextSibling;u=v}if(l&&l.rangeCount>0){const E=l.getRangeAt(0).startContainer;for(const k of c)if(k.contains(E)||k===E){d=!0;break}}if(u&&u.parentNode&&u.remove(),c.forEach(v=>{v.parentNode&&v.remove()}),e.querySelectorAll(me).forEach((v,E)=>{v.setAttribute("data-page-number",String(E+2))}),d&&a&&setTimeout(()=>{a(0)},50),r){const v=e.innerHTML;r(v)}return s&&setTimeout(()=>{s(),o&&setTimeout(()=>{o()},150)},100),!0}catch(m){return console.error("[removePageAndContent] Failed to remove page:",m),!1}},Ir=e=>{if(e)try{e.querySelectorAll(me).forEach((n,r)=>{n.setAttribute("data-page-number",String(r+2))})}catch(t){console.error("[renumberPageBreaks] Failed to renumber page breaks:",t)}},Dr=(e,t,n,r,s)=>{if(!e||!t)return!1;try{if(e.remove(),Ir(t),n){const a=t.innerHTML;n(a)}return r&&setTimeout(()=>{r(),s&&setTimeout(()=>{s()},100)},50),!0}catch(a){return console.error("[removePageBreak] Failed to remove page break:",a),!1}},Hr=200,Br=50,un=3,jr=20,dn=e=>{if(!e||!e.getBoundingClientRect)return 0;const t=e.getBoundingClientRect();if(e.tagName==="P"){const n=e.querySelectorAll("img"),r=e.textContent.trim();if(n.length===1&&!r){const a=n[0].getBoundingClientRect(),i=window.getComputedStyle(e).textAlign;if(i==="center"||i==="-webkit-center")return a.height+16}return t.height+16}return e.tagName==="H1"||e.tagName==="H2"||e.tagName==="H3"||e.tagName==="H4"||e.tagName==="H5"||e.tagName==="H6"?t.height+20:e.tagName==="UL"||e.tagName==="OL"?t.height+16:t.height},zr=(e,t)=>{if(!e||e.length===0)return null;let n=0,r=null;for(let s=0;s<e.length;s++){const a=e[s];if(!a||!a.getBoundingClientRect)continue;const o=dn(a);if(o<1)continue;if(n+o>t)return r===null?s>0?{overflowIndex:s,overflowElement:a,accumulatedHeight:n}:null:{overflowIndex:s,overflowElement:a,accumulatedHeight:n};n+=o,r=a}return null},$r=(e,t,n,r,s,a,o,i)=>{if(!e||o.current)return!1;try{o.current=!0;const m=cn(t,n,r);let l=ln(e),d=!1,c=0;for(let u=0;u<l.length&&c<un;u++){const w=l[u],v=zr(w,m);if(v&&v.overflowIndex>0){let E=0;for(let I=0;I<w.length;I++){const b=w[I];b&&b.getBoundingClientRect&&(E+=dn(b))}if(E-m<jr)continue;const L=u+2;Mr(v.overflowElement,L)&&(d=!0,c++,l=ln(e))}}if(d){if(s){const u=e.innerHTML;s(u)}setTimeout(()=>{a&&a(),c>=un&&i&&setTimeout(()=>{o.current||i()},100)},Br)}return d}catch(m){return console.warn("[checkAndReflow] Reflow failed:",m),!1}finally{o.current=!1}},Ur=(e,t,n=Hr)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{t.current=null,e()},n)},Fr=400,fn=(e,t)=>{if(e){e.focus();try{let n=null,r=0;if(t===0)n=e.firstChild,r=0;else{const a=e.querySelectorAll(me)[t-1];a&&a.nextSibling&&(n=a.nextSibling,r=0)}if(n){const s=document.createRange(),a=window.getSelection();n.nodeType===Node.TEXT_NODE?s.setStart(n,r):s.setStart(n,0),s.collapse(!0),a.removeAllRanges(),a.addRange(s)}}catch(n){console.warn("[positionCursorAtPage] Failed to position cursor:",n)}}},Gr=(e,t,n,r)=>{if(!e||!t){console.warn("[scrollToPage] Missing refs");return}try{let s=null;if(n===0)s=t;else{const o=t.querySelectorAll(me)[n-1];if(o)s=o;else{console.warn("[scrollToPage] Page break not found for page",n);return}}if(s){const a=s.getBoundingClientRect(),o=e.getBoundingClientRect(),i=e.scrollTop+(a.top-o.top);e.scrollTo({top:i,behavior:"smooth"}),setTimeout(()=>{r?r(n):fn(t,n)},Fr)}}catch(s){console.error("[scrollToPage] Error:",s)}},Wr=(e,t,n={},r=300)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{t.current=null,e(n)},Math.max(0,r))},qr=e=>{if(!e)return null;const t=window.getSelection();if(t.rangeCount===0)return null;const n=t.getRangeAt(0);if(!e.contains(n.commonAncestorContainer))return null;let r=1;const s=e.querySelectorAll(me);for(const d of s)if(n.comparePoint(d,0)>0)r++;else break;const a=document.createRange();a.setStart(e,0),a.setEnd(n.startContainer,n.startOffset);const i=a.toString().replace(/<[^>]*>/g," ").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\s+/g," ").trim(),m=i.length,l=(i.match(/\n/g)||[]).length+1;return{page:r,line:l,charOffset:m}},Zr=300,pn=(e,t,n=100,r="NARROW")=>{const s=he(),a=p.useRef(null),o=p.useRef(null),i=p.useRef(e),m=p.useRef(n),l=p.useRef(r),d=p.useRef(!1);p.useEffect(()=>{i.current=e},[e]),p.useEffect(()=>{m.current=n},[n]),p.useEffect(()=>{l.current=r},[r]),p.useEffect(()=>()=>{a.current&&clearTimeout(a.current),o.current&&clearTimeout(o.current)},[]);const c=p.useCallback((h={})=>t?.current?Pr(t.current,h):[],[t]),u=p.useCallback((h={})=>{const _=c(h);return s.updatePageBoundaries(_),_},[c,s]),w=p.useCallback((h={})=>{const _=typeof h.delay=="number"?h.delay:Zr;Wr(u,a,h,_)},[u]),v=p.useCallback(()=>{t?.current&&$r(t.current,i.current,m.current,l.current,s.updateContinuousContent,u,d,v)},[t,s,u]),E=p.useCallback(h=>{Ur(v,o,h)},[v]),k=p.useCallback(h=>!h?.current||!t?.current?0:Or(h.current,t.current),[t]),L=p.useCallback(h=>{t?.current&&fn(t.current,h)},[t]),j=p.useCallback((h,_)=>{if(!_?.current||!t?.current){console.warn("[scrollToPage] Missing refs");return}Gr(_.current,t.current,h,L)},[t,L]),I=p.useCallback(async h=>t?.current?Rr(t.current,h,i.current,m.current,l.current,s.updateContinuousContent,u):!1,[t,s,u]),b=p.useCallback(h=>t?.current?Lr(t.current,h,c,s.updateContinuousContent,u,L,v):!1,[t,c,s,u,L,v]),g=p.useCallback(h=>t?.current?Dr(h,t.current,s.updateContinuousContent,u,v):!1,[t,s,u,v]);return p.useEffect(()=>()=>{a.current&&clearTimeout(a.current),o.current&&clearTimeout(o.current)},[]),p.useMemo(()=>({calculatePageBoundaries:c,checkAndUpdateBoundaries:w,updateBoundaries:u,getCurrentPage:k,scrollToPage:j,positionCursorAtPage:L,checkAndReflow:v,triggerAutoReflow:E,removePageAndContent:b,removePageBreak:g,insertPageBreakAtBoundary:I,boundaryTimeoutRef:a,reflowTimeoutRef:o}),[c,w,u,k,j,L,v,E,b,g,I])},Te={minWidth:50,minHeight:50,maxWidth:800,maxHeight:600,aspectRatio:!0,preserveAspectRatio:!0,defaultWidth:300,defaultHeight:200},B={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right"};function Yr({handler:e,startX:t,startY:n,currentX:r,currentY:s,startWidth:a,startHeight:o,options:i=Te}){const m=r-t,l=s-n;let d=a,c=o;switch(e){case B.TOP_LEFT:d=Math.max(i.minWidth,a-m),c=Math.max(i.minHeight,o-l);break;case B.TOP_RIGHT:d=Math.max(i.minWidth,a+m),c=Math.max(i.minHeight,o-l);break;case B.BOTTOM_LEFT:d=Math.max(i.minWidth,a-m),c=Math.max(i.minHeight,o+l);break;case B.BOTTOM_RIGHT:d=Math.max(i.minWidth,a+m),c=Math.max(i.minHeight,o+l);break;case B.TOP:c=Math.max(i.minHeight,o-l);break;case B.BOTTOM:c=Math.max(i.minHeight,o+l);break;case B.LEFT:d=Math.max(i.minWidth,a-m);break;case B.RIGHT:d=Math.max(i.minWidth,a+m);break;default:return{width:d,height:c}}if(i.preserveAspectRatio&&i.aspectRatio){const u=a/o;[B.TOP_LEFT,B.TOP_RIGHT,B.BOTTOM_LEFT,B.BOTTOM_RIGHT].includes(e)?d/u>c?c=Math.max(i.minHeight,d/u):d=Math.max(i.minWidth,c*u):[B.TOP,B.BOTTOM].includes(e)?d=c*u:[B.LEFT,B.RIGHT].includes(e)&&(c=d/u)}return i.maxWidth&&d>i.maxWidth&&(d=i.maxWidth,i.preserveAspectRatio&&i.aspectRatio&&(c=d/(a/o))),i.maxHeight&&c>i.maxHeight&&(c=i.maxHeight,i.preserveAspectRatio&&i.aspectRatio&&(d=c*(a/o))),d=Math.max(i.minWidth,d),c=Math.max(i.minHeight,c),{width:Math.round(d),height:Math.round(c)}}function fe(e){return e?!!(e.tagName==="IMG"||e.tagName==="DIV"&&e.style.backgroundImage&&e.style.backgroundImage!=="none"):!1}function Vr(e){return fe(e)?{width:e.offsetWidth,height:e.offsetHeight}:{width:0,height:0}}function Kr(e,{width:t,height:n}){fe(e)&&(e.tagName==="IMG"?(e.style.width=`${t}px`,e.style.height=`${n}px`,e.width=t,e.height=n):e.tagName==="DIV"&&(e.style.width=`${t}px`,e.style.height=`${n}px`))}function gn(e,t=Te){if(!fe(e))return null;const n=document.createElement("div");n.className="image-resize-overlay",n.style.position="fixed",n.style.zIndex="1000",n.style.pointerEvents="none";const r=e.getBoundingClientRect();return n.style.top=`${r.top}px`,n.style.left=`${r.left}px`,n.style.width=`${r.width}px`,n.style.height=`${r.height}px`,Object.values(B).forEach(a=>{const o=document.createElement("div");o.className=`resize-handler resize-handler-${a}`,o.dataset.handler=a,o.style.position="absolute",o.style.width="10px",o.style.height="10px",o.style.backgroundColor="#007bff",o.style.border="2px solid white",o.style.borderRadius="50%",o.style.boxShadow="0 0 3px rgba(0,0,0,0.3)",o.style.cursor=Xr(a),o.style.pointerEvents="all",hn(o,a,r.width,r.height),n.appendChild(o)}),n}function Xr(e){switch(e){case B.TOP_LEFT:case B.BOTTOM_RIGHT:return"nwse-resize";case B.TOP_RIGHT:case B.BOTTOM_LEFT:return"nesw-resize";case B.TOP:case B.BOTTOM:return"ns-resize";case B.LEFT:case B.RIGHT:return"ew-resize";default:return"default"}}function hn(e,t,n,r){switch(t){case B.TOP_LEFT:e.style.top="-5px",e.style.left="-5px";break;case B.TOP_RIGHT:e.style.top="-5px",e.style.right="-5px";break;case B.BOTTOM_LEFT:e.style.bottom="-5px",e.style.left="-5px";break;case B.BOTTOM_RIGHT:e.style.bottom="-5px",e.style.right="-5px";break;case B.TOP:e.style.top="-5px",e.style.left=`${n/2+-5}px`;break;case B.BOTTOM:e.style.bottom="-5px",e.style.left=`${n/2+-5}px`;break;case B.LEFT:e.style.top=`${r/2+-5}px`,e.style.left="-5px";break;case B.RIGHT:e.style.top=`${r/2+-5}px`,e.style.right="-5px";break}}function Ge(e,t){if(!e||!t)return;const n=t.getBoundingClientRect();e.style.top=`${n.top}px`,e.style.left=`${n.left}px`,e.style.width=`${n.width}px`,e.style.height=`${n.height}px`,e.querySelectorAll(".resize-handler").forEach(s=>{const a=s.dataset.handler;hn(s,a,n.width,n.height)})}function We(e){e&&e.parentNode&&e.parentNode.removeChild(e)}const Jr="html-editor-storage",Qr=1,ce="images";function eo(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function Oe(){return new Promise((e,t)=>{const n=indexedDB.open(Jr,Qr);n.onerror=()=>{t(new Error("Failed to open IndexedDB database"))},n.onsuccess=()=>{e(n.result)},n.onupgradeneeded=r=>{const s=r.target.result;s.objectStoreNames.contains(ce)||s.createObjectStore(ce,{keyPath:"key"}).createIndex("timestamp","timestamp",{unique:!1})}})}function mn(e){return new Promise((t,n)=>{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(e.type)){n(new Error("Invalid image format. Supported formats: png, jpeg, gif, webp"));return}if(e.size>5*1024*1024){n(new Error("Image exceeds maximum size of 5MB"));return}const s=new FileReader;s.onload=async a=>{const o=a.target.result,m=o.split(",")[1].length*3/4;if(m>5*1024*1024){n(new Error("Image exceeds maximum size of 5MB"));return}try{const l=await Oe(),d=`editor-image-${eo()}`,u=l.transaction([ce],"readwrite").objectStore(ce),w={key:d,dataUrl:o,size:m,type:e.type,timestamp:Date.now()},v=u.add(w);v.onsuccess=()=>{l.close(),t(d)},v.onerror=()=>{l.close(),n(new Error("Failed to save image to IndexedDB"))}}catch(l){n(l)}},s.onerror=()=>{n(new Error("Error reading image file"))},s.readAsDataURL(e)})}async function yn(e){try{const t=await Oe();return new Promise((n,r)=>{const o=t.transaction([ce],"readonly").objectStore(ce).get(e);o.onsuccess=()=>{t.close();const i=o.result;n(i?i.dataUrl:null)},o.onerror=()=>{t.close(),r(new Error("Failed to retrieve image from IndexedDB"))}})}catch(t){return console.error("Error getting image:",t),null}}async function bn(e){try{const t=await Oe();return new Promise((n,r)=>{const o=t.transaction([ce],"readwrite").objectStore(ce).delete(e);o.onsuccess=()=>{t.close(),n()},o.onerror=()=>{t.close(),r(new Error("Failed to delete image from IndexedDB"))}})}catch(t){console.error("Error deleting image:",t)}}async function to(){try{const e=await Oe();return new Promise((t,n)=>{const a=e.transaction([ce],"readwrite").objectStore(ce).clear();a.onsuccess=()=>{e.close(),t()},a.onerror=()=>{e.close(),n(new Error("Failed to clear images from IndexedDB"))}})}catch(e){console.error("Error clearing images:",e)}}async function no(){try{const e=await Oe();return new Promise((t,n)=>{const a=e.transaction([ce],"readonly").objectStore(ce).getAllKeys();a.onsuccess=()=>{e.close(),t(a.result||[])},a.onerror=()=>{e.close(),n(new Error("Failed to get image keys from IndexedDB"))}})}catch(e){return console.error("Error getting image keys:",e),[]}}const En=["P","DIV","H1","H2","H3","H4","H5","H6","UL","OL","LI","TABLE","TBODY","TR","TD","TH","THEAD","TFOOT","BLOCKQUOTE","PRE","HR","FIGURE","FIGCAPTION","PAGE-BREAK"],ro=["SPAN","STRONG","EM","B","I","U","S","STRIKE","DEL","INS","SUB","SUP","MARK","SMALL","CODE","KBD","SAMP","VAR","A","ABBR","CITE","DFN","TIME"],oo=["BR","HR","IMG","INPUT","PAGE-BREAK"];function ao(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function Tn(e){const t=[];for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n];t.push(` ${r.name}="${r.value}"`)}return t.join("")}function qe(e){if(!e||typeof e!="string")return"<p><br></p>";const t=e.trim();if(!t)return"<p><br></p>";const n=document.createElement("div");return n.innerHTML=t,Ne(n)||"<p><br></p>"}function so(e){const t=e.cloneNode(!0);return t.querySelectorAll(":scope > p").forEach(r=>{for(;r.firstChild;)t.insertBefore(r.firstChild,r);r.remove()}),t.innerHTML}function io(e){const t=Array.from(e.children);return t.length===0?!1:t.every(n=>En.includes(n.tagName))}function co(e){const t=[];let n=!1;return Array.from(e.childNodes).forEach(r=>{if(r.nodeType===Node.TEXT_NODE)r.textContent.trim()&&(n=!0);else if(r.nodeType===Node.ELEMENT_NODE){const s=r;En.includes(s.tagName)?t.push(s.outerHTML):n=!0}}),n?e.outerHTML:t.join("")}function Ne(e){const t=[],n=Array.from(e.childNodes);for(let r=0;r<n.length;r++){const s=n[r];if(s.nodeType===Node.TEXT_NODE){const a=s.textContent.trim();a&&t.push(`<p>${ao(a)}</p>`)}else if(s.nodeType===Node.ELEMENT_NODE){const a=s,o=a.tagName,i=o.toLowerCase(),m=Tn(a);if(o==="DIV"){const l=Ne(a);l.trim()?t.push(l):t.push("<p><br></p>")}else if(o==="P")io(a)?t.push(co(a)):t.push(a.outerHTML);else if(["H1","H2","H3","H4","H5","H6"].includes(o)){const l=so(a);t.push(`<${i}${m}>${l}</${i}>`)}else if(o==="BR")t.push("<p><br></p>");else if(o==="IMG")t.push(a.outerHTML);else if(["UL","OL"].includes(o))t.push(lo(a));else if(o==="LI")t.push(a.outerHTML);else if(o==="TABLE")t.push(uo(a));else if(["TBODY","THEAD","TFOOT","TR","TD","TH"].includes(o))t.push(a.outerHTML);else if(o==="BLOCKQUOTE"){const l=Ne(a);t.push(`<blockquote${m}>${l}</blockquote>`)}else if(o==="PRE")t.push(a.outerHTML);else if(ro.includes(o))t.push(a.outerHTML);else if(o==="PAGE-BREAK"||a.getAttribute("data-page-break")==="true")t.push(a.outerHTML);else if(o==="HR")t.push(a.outerHTML);else if(o==="FIGURE")t.push(a.outerHTML);else if(oo.includes(o))t.push(a.outerHTML);else{const l=Ne(a);t.push(`<${i}${m}>${l}</${i}>`)}}}return t.length===0?"":t.join("")}function lo(e){const t=e.tagName.toLowerCase(),n=Tn(e),r=[];return Array.from(e.children).forEach(s=>{if(s.tagName==="LI")r.push(s.outerHTML);else{const a=Ne(s);a.trim()&&r.push(`<li>${a}</li>`)}}),r.length===0?`<${t}${n}><li><br></li></${t}>`:`<${t}${n}>${r.join("")}</${t}>`}function uo(e){return e.outerHTML}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fo=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),po=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,r)=>r?r.toUpperCase():n.toLowerCase()),vn=e=>{const t=po(e);return t.charAt(0).toUpperCase()+t.slice(1)},xn=(...e)=>e.filter((t,n,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===n).join(" ").trim(),go=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ho={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mo=p.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:s="",children:a,iconNode:o,...i},m)=>p.createElement("svg",{ref:m,...ho,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:xn("lucide",s),...!a&&!go(i)&&{"aria-hidden":"true"},...i},[...o.map(([l,d])=>p.createElement(l,d)),...Array.isArray(a)?a:[a]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=(e,t)=>{const n=p.forwardRef(({className:r,...s},a)=>p.createElement(mo,{ref:a,iconNode:t,className:xn(`lucide-${fo(vn(e))}`,`lucide-${e}`,r),...s}));return n.displayName=vn(e),n};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yo=V("bold",[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bo=V("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eo=V("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const To=V("file-check",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=V("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vo=V("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xo=V("heading-1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wo=V("heading-2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ao=V("heading-3",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _o=V("image-upscale",[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M17 21h2a2 2 0 0 0 2-2",key:"130fy9"}],["path",{d:"M21 12v3",key:"1wzk3p"}],["path",{d:"m21 3-5 5",key:"1g5oa7"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2",key:"kk3yz1"}],["path",{d:"m5 21 4.144-4.144a1.21 1.21 0 0 1 1.712 0L13 19",key:"fyekpt"}],["path",{d:"M9 3h3",key:"d52fa"}],["rect",{x:"3",y:"11",width:"10",height:"10",rx:"1",key:"1wpmix"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Co=V("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ko=V("italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const So=V("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Po=V("list-indent-decrease",[["path",{d:"M21 5H11",key:"us1j55"}],["path",{d:"M21 12H11",key:"wd7e0v"}],["path",{d:"M21 19H11",key:"saa85w"}],["path",{d:"m7 8-4 4 4 4",key:"o5hrat"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oo=V("list-indent-increase",[["path",{d:"M21 5H11",key:"us1j55"}],["path",{d:"M21 12H11",key:"wd7e0v"}],["path",{d:"M21 19H11",key:"saa85w"}],["path",{d:"m3 8 4 4-4 4",key:"1a3j6y"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const No=V("list-ordered",[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wn=V("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mo=V("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ro=V("redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lo=V("scaling",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M14 15H9v-5",key:"pi4jk9"}],["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M21 3 9 15",key:"15kdhq"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Io=V("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Do=V("strikethrough",[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ho=V("table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=V("text-align-center",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M17 12H7",key:"16if0g"}],["path",{d:"M19 19H5",key:"vjpgq2"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=V("text-align-end",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M21 19H7",key:"4cu937"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bo=V("text-align-justify",[["path",{d:"M3 5h18",key:"1u36vt"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 19h18",key:"awlh7x"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=V("text-align-start",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jo=V("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zo=V("underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $o=V("undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uo=V("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fo=V("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Go=V("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),An=(e,t,n="")=>{if(!e)return[];const r=document.createElement("div");r.innerHTML=e;const s=r.querySelectorAll("h1, h2, h3, h4, h5, h6");return Array.from(s).map((a,o)=>{const i=parseInt(a.tagName.charAt(1)),m=a.textContent.trim();return m?{id:`${n}heading-${o}`,level:i,text:m,page:t||1}:null}).filter(Boolean)},Wo=e=>{if(!e)return 0;const t=document.createElement("div");return t.innerHTML=e,(t.textContent||t.innerText||"").trim().split(/\s+/).filter(r=>r.length>0).length},_n=({isCollapsed:e,onToggle:t,wordCount:n,pageCount:r})=>{const s=pt(),{pages:a,activePage:o,continuousContent:i}=s,{wordCount:m,outline:l}=p.useMemo(()=>{if(n!==void 0&&r!==void 0)return{wordCount:n,outline:An(i,1,"continuous-")};let c=0;const u=[];return a.forEach((w,v)=>{c+=Wo(w.content),u.push(...An(w.content,v+1,`page-${v}-`))}),{wordCount:c,outline:u}},[a,n,r,i]),d=r!==void 0?r:a.length;return y.jsxs("aside",{className:`sidebar ${e?"collapsed":""}`,role:"complementary","aria-label":"Document information","data-testid":"sidebar",children:[y.jsxs("div",{className:"sidebar-header",children:[y.jsxs("div",{className:"sidebar-title",children:[y.jsx(Ze,{size:18}),y.jsx("h2",{children:"Document Info"})]}),y.jsx("button",{className:"sidebar-toggle",onClick:t,"aria-label":e?"Expand sidebar":"Collapse sidebar",title:e?"Expand sidebar":"Collapse sidebar",children:e?y.jsx(Eo,{size:16}):y.jsx(bo,{size:16})})]}),!e&&y.jsxs("div",{className:"sidebar-content",children:[y.jsxs("div",{className:"sidebar-section",children:[y.jsx("h3",{children:"Statistics"}),y.jsxs("div",{className:"stat-item",children:[y.jsxs("div",{className:"stat-label",children:[y.jsx(To,{size:14}),y.jsx("span",{children:"Pages:"})]}),y.jsx("span",{className:"stat-value",children:d})]}),y.jsxs("div",{className:"stat-item","data-testid":"word-count",children:[y.jsxs("div",{className:"stat-label",children:[y.jsx(vo,{size:14}),y.jsx("span",{children:"Words:"})]}),y.jsx("span",{className:"stat-value",children:m.toLocaleString()})]}),y.jsxs("div",{className:"stat-item",children:[y.jsxs("div",{className:"stat-label",children:[y.jsx(Ze,{size:14}),y.jsx("span",{children:"Active Page:"})]}),y.jsx("span",{className:"stat-value",children:o+1})]})]}),l.length>0&&y.jsxs("div",{className:"sidebar-section",children:[y.jsxs("h3",{children:[y.jsx(wn,{size:14,style:{display:"inline-block",marginRight:"6px",verticalAlign:"middle"}}),"Document Outline"]}),y.jsx("div",{className:"document-outline","data-testid":"outline",children:l.map(c=>{const u=c.level===1?xo:c.level===2?wo:Ao;return y.jsxs("div",{className:`outline-item outline-level-${c.level}`,style:{marginLeft:`${(c.level-1)*12}px`},children:[y.jsx(u,{size:12,className:"outline-icon"}),y.jsx("span",{className:"outline-text",children:c.text}),y.jsxs("span",{className:"outline-page",children:["p.",c.page]})]},c.id)})})]})]})]})};class Cn{constructor(t="Editor"){this.namespace=t}_format(t,n,r){return`[${new Date().toISOString()}] [${this.namespace}] [${t}] ${n}`}info(t,n){}warn(t,n){}error(t,n){}debug(t,n){}}const kn=new Cn("Editor"),Sn=new Set(["P","DIV","H1","H2","H3","H4","H5","H6","LI","BLOCKQUOTE","PRE","TABLE"]),Pn=32;function On(e,t){if(!e)return;e.dataset||(e.dataset={}),e.style||(e.style={});const n=parseInt(e.dataset.indentLevel||"0",10),r=Math.max(0,t?n-1:n+1);r===0?(e.style.marginLeft="",delete e.dataset.indentLevel):(e.style.marginLeft=`${r*Pn}px`,e.dataset.indentLevel=String(r))}function qo(e,t){On(e,t)}function Zo(e){let t=e;for(;t;){if(t.nodeType===1&&t.tagName&&Sn.has(t.tagName.toUpperCase()))return t;t=t.parentElement||t.parentNode}return null}function Yo(){const e=window.getSelection();if(!e||e.rangeCount===0)return[];const t=e.getRangeAt(0),n=new Set;let r=t.commonAncestorContainer;for(r.nodeType===Node.TEXT_NODE&&(r=r.parentElement);r&&r.contentEditable!=="true";)r=r.parentElement;return r?(r.querySelectorAll("p, div, h1, h2, h3, h4, h5, h6, li, blockquote, pre, table").forEach(o=>{document.createRange().selectNodeContents(o),t.intersectsNode(o)&&n.add(o)}),n.size===0&&r.querySelectorAll("img").forEach(i=>{if(document.createRange().selectNode(i),t.intersectsNode(i)){let l=i.parentElement;for(;l&&l!==r;){if(l.tagName&&Sn.has(l.tagName.toUpperCase())){n.add(l);break}l=l.parentElement}}}),Array.from(n).filter(o=>{let i=o.parentElement;for(;i;){if(n.has(i))return!1;i=i.parentElement}return!0})):[]}function Vo(e){if(e.style&&e.style.marginLeft&&e.style.marginLeft!==""){const t=parseInt(e.dataset.indentLevel||"0",10),n=Math.max(0,t-1);n===0?(e.style.marginLeft="",delete e.dataset.indentLevel):(e.style.marginLeft=`${n*Pn}px`,e.dataset.indentLevel=String(n));return}if(e.innerHTML.startsWith("&nbsp;&nbsp;&nbsp;&nbsp;")){e.innerHTML=e.innerHTML.replace(/^(&nbsp;){4}/,"");return}try{const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let n=t.nextNode();for(;n;){const r=n.textContent;if(r.startsWith("    ")){n.textContent=r.substring(4);break}n=t.nextNode()}}catch{e.innerHTML=e.innerHTML.replace(/^(&nbsp;){4}/,"")}}function _t(e=!1){const t=window.getSelection();if(!t||t.rangeCount===0)return!1;let n=Yo();const r=t.getRangeAt(0);if(n.length===0){const o=Zo(r.startContainer);if(!o)return!1;n=[o]}const s=n[0],a=n[n.length-1];n.forEach(o=>{if((o.tagName?o.tagName.toUpperCase():"")==="LI"){qo(o,e);return}e?Vo(o):On(o,!1)});try{const o=document.createRange(),i=c=>c.nodeType===Node.TEXT_NODE?c:document.createTreeWalker(c,NodeFilter.SHOW_TEXT,null).nextNode(),m=c=>{if(c.nodeType===Node.TEXT_NODE)return c;const u=document.createTreeWalker(c,NodeFilter.SHOW_TEXT,null);let w=null,v=u.nextNode();for(;v;)w=v,v=u.nextNode();return w},l=i(s);l?o.setStart(l,0):o.setStart(s,0);const d=m(a);d?o.setEnd(d,d.length):o.setEnd(a,a.childNodes.length),t.removeAllRanges(),t.addRange(o)}catch{try{const i=document.createRange();i.setStartBefore(s),i.setEndAfter(a),t.removeAllRanges(),t.addRange(i)}catch(i){console.warn("Could not restore selection after indentation:",i)}}return!0}function Ko(e){if(e.key!=="Tab")return!1;e.preventDefault();const t=e.shiftKey,n=window.getSelection(),r=n&&n.rangeCount>0?n.getRangeAt(0):null;return n&&n.rangeCount>0&&r&&!r.collapsed&&_t(t)||t||document.execCommand("insertHTML",!1,"&nbsp;&nbsp;&nbsp;&nbsp;"),!0}const Xo=[{value:"Segoe UI",label:"Segoe UI"},{value:"Arial",label:"Arial"},{value:"Times New Roman",label:"Times New Roman"},{value:"Courier New",label:"Courier New"},{value:"Georgia",label:"Georgia"},{value:"Verdana",label:"Verdana"},{value:"Noto Sans Sinhala",label:"Noto Sans Sinhala"},{value:"Iskoola Pota",label:"Iskoola Pota"},{value:"Noto Sans Tamil",label:"Noto Sans Tamil"},{value:"Noto Sans",label:"Noto Sans"}],Jo=[{value:"p",label:"Normal"},{value:"h1",label:"Heading 1"},{value:"h2",label:"Heading 2"},{value:"h3",label:"Heading 3"},{value:"h4",label:"Heading 4"},{value:"h5",label:"Heading 5"},{value:"h6",label:"Heading 6"}],Qo='<table border="1"><tr><td>Cell 1</td><td>Cell 2</td></tr><tr><td>Cell 3</td><td>Cell 4</td></tr></table>',Ye=({currentFormat:e,onFormatText:t,onAddPageBreak:n,canUndo:r=!1,canRedo:s=!1})=>{const a=async l=>{try{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(l.type)){alert("Invalid image format. Supported: PNG, JPEG, GIF, WEBP");return}if(l.size>5242880){alert("Image exceeds maximum size of 5MB");return}const c=await mn(l),u=await yn(c);if(u){const v=`<img src="${u}" data-key="${c}" alt="Inserted image" />`;document.execCommand("insertHTML",!1,v),kn.info("Image inserted",{key:c})}const w=document.getElementById("image-upload");w&&(w.value="")}catch(d){kn.error("Error uploading image",d)}},o=(l,d,c,u)=>y.jsx("button",{onClick:()=>t(l),className:e[d]?"active":"",title:u,children:y.jsx(c,{size:16})},l),i=(l,d,c,u=!1)=>y.jsx("button",{onClick:l,disabled:u,title:c,style:{opacity:u?.5:1},children:y.jsx(d,{size:16})},c),m=()=>y.jsx("div",{className:"toolbar-separator"});return y.jsxs("div",{className:"editor-toolbar",children:[i(()=>t("undo"),$o,"Undo",!r),i(()=>t("redo"),Ro,"Redo",!s),m(),o("bold","bold",yo,"Bold"),o("italic","italic",ko,"Italic"),o("underline","underline",zo,"Underline"),o("strikethrough","strikethrough",Do,"Strikethrough"),m(),o("justifyLeft","alignLeft",At,"Align Left"),o("justifyCenter","alignCenter",xt,"Align Center"),o("justifyRight","alignRight",wt,"Align Right"),o("justifyFull","alignJustify",Bo,"Justify"),m(),y.jsx("select",{onChange:l=>t("fontName",l.target.value),value:e.fontFamily||"Segoe UI",title:"Font Family",children:Xo.map(({value:l,label:d})=>y.jsx("option",{value:l,children:d},l))}),y.jsx("select",{onChange:l=>t("fontSize",l.target.value),value:e.fontSize||Pe,title:"Font Size",children:tn.map(({value:l,label:d})=>y.jsx("option",{value:l,children:d},l))}),y.jsx("select",{onChange:l=>t("formatBlock",l.target.value),value:e.headingLevel||"p",title:"Heading Level",children:Jo.map(({value:l,label:d})=>y.jsx("option",{value:l,children:d},l))}),m(),i(()=>t("insertUnorderedList"),wn,"Bullet List"),i(()=>t("insertOrderedList"),No,"Numbered List"),m(),y.jsx("button",{onClick:()=>{_t(!1)||document.execCommand("insertHTML",!1,"&nbsp;&nbsp;&nbsp;&nbsp;")},title:"Increase Indent (Tab)",children:y.jsx(Oo,{size:16})}),y.jsx("button",{onClick:()=>{_t(!0)},title:"Decrease Indent (Shift+Tab)",children:y.jsx(Po,{size:16})}),m(),y.jsx("button",{onClick:()=>{const l=prompt("Enter URL:");l&&t("createLink",l)},title:"Insert Link",children:y.jsx(So,{size:16})}),i(()=>t("insertHTML",Qo),Ho,"Insert Table"),n&&i(n,Ze,"Insert Page Break"),m(),y.jsx("input",{type:"file",accept:"image/*",onChange:l=>l.target.files[0]&&a(l.target.files[0]),style:{display:"none"},id:"image-upload"}),y.jsx("button",{onClick:()=>document.getElementById("image-upload").click(),title:"Insert Image",children:y.jsx(Co,{size:16})})]})};Ye.propTypes={currentFormat:T.shape({bold:T.bool,italic:T.bool,underline:T.bool,strikethrough:T.bool,alignLeft:T.bool,alignCenter:T.bool,alignRight:T.bool,alignJustify:T.bool,fontFamily:T.string,fontSize:T.string,headingLevel:T.string}).isRequired,onFormatText:T.func.isRequired,onAddPageBreak:T.func,canUndo:T.bool,canRedo:T.bool},Ye.defaultProps={onAddPageBreak:void 0,canUndo:!1,canRedo:!1};function ea(e){return!e||typeof e!="string"?e:qe(e)}function ta(e){e.preventDefault();const t=e.clipboardData||window.clipboardData;if(!t)return null;let n=t.getData("text/html")||t.getData("text/plain");return n?(t.getData("text/html")?n=ea(n):n=na(n),document.execCommand("insertHTML",!1,n),n):null}function na(e){if(!e)return"";const t=e.split(/\n\s*\n/).filter(n=>n.trim());return t.length===0?"<p><br></p>":t.map(n=>{const r=n.split(`
`).filter(a=>a.trim());return r.length===0?"<p><br></p>":`<p>${r.map(a=>ra(a.trim())).join("<br>")}</p>`}).join("")}function ra(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}const ve=e=>e?e.nodeType===Node.ELEMENT_NODE?e.tagName==="PAGE-BREAK"||e.getAttribute("data-page-break")==="true":e.parentElement&&ve(e.parentElement):!1,Ct=({dimensions:e,editorRef:t,onInput:n,onContentChange:r,onKeyDown:s,onClick:a,onScroll:o,onPaste:i,onRemovePageBreak:m,zoomLevel:l=100,pageMargins:d=de})=>{const c=p.useMemo(()=>zt(d),[d]),u=l/100,w=p.useCallback((b,g)=>{if(!b)return!1;const h=b.getBoundingClientRect(),_=g-h.top;return _<c.top||_>h.height-c.bottom},[c.top,c.bottom]),v=p.useCallback((b,g)=>{g.preventDefault();const h=b.getBoundingClientRect(),_=g.clientX-h.left,A=g.clientY-h.top,N=h.width-40,z=-12,U=h.width-20;_>=N&&_<=U&&A>=z&&A<=8&&m&&m(b)},[m]),E=p.useCallback(b=>{b.preventDefault();const g=t.current.getBoundingClientRect();if(b.clientY-g.top<c.top){const _=t.current.firstElementChild;if(_&&_.tagName!=="PAGE-BREAK"){const A=document.createRange(),N=window.getSelection();A.setStart(_,0),A.collapse(!0),N.removeAllRanges(),N.addRange(A)}}else{const _=t.current.lastElementChild;if(_&&_.tagName!=="PAGE-BREAK"){const A=document.createRange(),N=window.getSelection();A.selectNodeContents(_),A.collapse(!1),N.removeAllRanges(),N.addRange(A)}}},[t,c.top]),k=p.useCallback(b=>{const g=window.getSelection();if(!g||g.rangeCount===0)return;const h=g.getRangeAt(0),{startContainer:_,endContainer:A}=h;if((ve(_)||ve(A))&&(b.key.length===1||b.key==="Enter"||b.key===" "))return b.preventDefault(),!1;if(Ko(b))return r&&r(),!1;if((b.key==="Backspace"||b.key==="Delete")&&(ve(_)||ve(A)))return b.preventDefault(),!1;s&&s(b)},[s,r]),L=p.useCallback(b=>{if(!t.current)return;const g=b.target;if(ve(g)){v(g,b);return}if(w(t.current,b.clientY)){E(b);return}a&&a(b)},[t,a,v,E,w]),j=p.useCallback(b=>{const g=window.getSelection();if(!g||g.rangeCount===0)return;const h=g.getRangeAt(0),{startContainer:_}=h;if(ve(_))return b.preventDefault(),!1},[]),I=p.useCallback(b=>{const g=ta(b);i&&i(b,g)},[i]);return y.jsx("div",{className:"continuous-page-container",style:{position:"relative",width:"100%",maxWidth:`${e.width}px`,margin:"40px auto",backgroundColor:"transparent",minHeight:"100vh",transform:`scale(${u})`,transformOrigin:"top center",transition:"transform 0.2s ease-out"},children:y.jsx("div",{ref:t,contentEditable:!0,suppressContentEditableWarning:!0,className:"continuous-content",style:{position:"relative",zIndex:1,minHeight:`${e.height}px`,width:`${e.width}px`,backgroundColor:"white",padding:`${c.top}px ${c.right}px ${c.bottom}px ${c.left}px`,boxSizing:"border-box",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",outline:"none",cursor:"text",fontFamily:'"Segoe UI", "Noto Sans Sinhala", "Noto Sans", "Malithi Web", "Iskoola Pota", "Kaputa Unicode", "Helvetica Neue", Arial, "Hiragino Sans GB", "WenQuanYi Micro Hei", "Microsoft YaHei", sans-serif',fontSize:Pe,lineHeight:"1.4",color:"#333",wordWrap:"break-word",whiteSpace:"pre-wrap",overflowWrap:"break-word",border:"1px solid #e0e0e0"},onInput:n,onKeyDown:k,onBeforeInput:j,onClick:L,onScroll:o,onPaste:I,"data-testid":"continuous-editor"})})};Ct.propTypes={dimensions:T.shape({width:T.number.isRequired,height:T.number.isRequired}).isRequired,editorRef:T.shape({current:T.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onInput:T.func.isRequired,onContentChange:T.func,onKeyDown:T.func,onClick:T.func,onScroll:T.func,onPaste:T.func,onRemovePageBreak:T.func,zoomLevel:T.number,pageMargins:T.string},Ct.defaultProps={onContentChange:void 0,onKeyDown:void 0,onClick:void 0,onScroll:void 0,onPaste:void 0,onRemovePageBreak:void 0,zoomLevel:100,pageMargins:de};const Nn=p.memo(Ct),kt=({pageBoundaries:e=[{id:"page-0",pageNumber:1}],activePage:t=0,pageSize:n="A4",pageMargins:r=de,zoomLevel:s=100,canZoomIn:a=!0,canZoomOut:o=!0,onNavigate:i,onAddPage:m,onDeletePage:l,onPageSizeChange:d,onPageMarginsChange:c,onZoomIn:u,onZoomOut:w,onZoomReset:v}={})=>{const E=Math.max(e?.length||0,1),k=g=>{i&&i(g)},L=()=>{m&&m()},j=g=>{if(E<=1){console.warn("[PageManager] Cannot delete the only page");return}l&&l(g)},I=g=>{d&&d(g)},b=g=>{c&&c(g)};return y.jsxs("div",{className:"page-manager",children:[y.jsxs("div",{className:"page-settings-group",children:[y.jsxs("div",{className:"page-settings-header",children:[y.jsx(Io,{size:14,style:{marginRight:"4px",verticalAlign:"middle"}}),"Page Settings"]}),y.jsxs("div",{className:"page-settings-controls",children:[y.jsxs("div",{className:"page-setting-item",children:[y.jsx("label",{htmlFor:"page-size-selector",children:"Size:"}),y.jsxs("select",{id:"page-size-selector",role:"combobox","aria-label":"Page size selector",value:n,onChange:g=>I(g.target.value),children:[y.jsx("option",{value:"A4",children:"A4"}),y.jsx("option",{value:"Letter",children:"Letter"}),y.jsx("option",{value:"Legal",children:"Legal"})]})]}),y.jsxs("div",{className:"page-setting-item",children:[y.jsx("label",{htmlFor:"page-margins-selector",children:"Margins:"}),y.jsx("select",{id:"page-margins-selector",role:"combobox","aria-label":"Page margins selector",value:r,onChange:g=>b(g.target.value),children:cr().map(g=>y.jsx("option",{value:g,children:lr(g)},g))})]})]})]}),y.jsxs("div",{className:"zoom-controls-compact",children:[y.jsx("button",{type:"button",className:"zoom-button-compact",onClick:w,disabled:!o,"aria-label":"Zoom out",title:"Zoom out (Ctrl + -)",children:y.jsx(Go,{size:12})}),y.jsxs("span",{className:"zoom-level-display",children:[s,"%"]}),y.jsx("button",{type:"button",className:"zoom-button-compact",onClick:u,disabled:!a,"aria-label":"Zoom in",title:"Zoom in (Ctrl + +)",children:y.jsx(Fo,{size:12})}),y.jsx("button",{type:"button",className:"zoom-reset-compact",onClick:v,"aria-label":"Reset zoom",title:"Reset zoom to 100% (Ctrl + 0)",children:"Reset"})]}),y.jsx("div",{className:"page-list",children:e.map((g,h)=>y.jsxs("div",{className:"page-item",children:[y.jsxs("button",{type:"button",className:`page-button ${h===t?"active":""}`,onClick:()=>k(h),"aria-label":`Go to page ${h+1}`,"aria-current":h===t?"page":void 0,children:[y.jsx(Ze,{size:14}),y.jsxs("span",{children:["Page ",h+1]})]}),E>1&&y.jsx("button",{type:"button",className:"delete-page-button",onClick:_=>{_.stopPropagation(),j(h)},"aria-label":`Delete page ${h+1}`,title:"Delete this page and its content",children:y.jsx(Uo,{size:14})})]},g.id||`page-${h}`))}),y.jsxs("button",{type:"button",className:"add-page-button",onClick:L,"aria-label":"Add new page",title:"Add new page at end",children:[y.jsx(Mo,{size:16}),y.jsx("span",{children:"Add Page"})]})]})};kt.propTypes={pageBoundaries:T.arrayOf(T.shape({id:T.string.isRequired,pageNumber:T.number.isRequired,top:T.number,height:T.number})),activePage:T.number,pageSize:T.oneOf(["A4","Letter","Legal"]),pageMargins:T.string,zoomLevel:T.number,canZoomIn:T.bool,canZoomOut:T.bool,onNavigate:T.func,onAddPage:T.func,onDeletePage:T.func,onPageSizeChange:T.func,onPageMarginsChange:T.func,onZoomIn:T.func,onZoomOut:T.func,onZoomReset:T.func},kt.defaultProps={pageBoundaries:[{id:"page-0",pageNumber:1}],activePage:0,pageSize:"A4",pageMargins:de,zoomLevel:100,canZoomIn:!0,canZoomOut:!0,onNavigate:void 0,onAddPage:void 0,onDeletePage:void 0,onPageSizeChange:void 0,onPageMarginsChange:void 0,onZoomIn:void 0,onZoomOut:void 0,onZoomReset:void 0};const Mn=p.memo(kt);function oa(e){switch(e){case B.TOP_LEFT:case B.BOTTOM_RIGHT:return"nwse-resize";case B.TOP_RIGHT:case B.BOTTOM_LEFT:return"nesw-resize";case B.TOP:case B.BOTTOM:return"ns-resize";case B.LEFT:case B.RIGHT:return"ew-resize";default:return"default"}}function aa({handler:e,startX:t,startY:n,currentX:r,currentY:s,startWidth:a,startHeight:o,options:i=Te}){const m=r-t,l=s-n;let d=a,c=o;switch(e){case B.TOP_LEFT:d=Math.max(i.minWidth,a-m),c=Math.max(i.minHeight,o-l);break;case B.TOP_RIGHT:d=Math.max(i.minWidth,a+m),c=Math.max(i.minHeight,o-l);break;case B.BOTTOM_LEFT:d=Math.max(i.minWidth,a-m),c=Math.max(i.minHeight,o+l);break;case B.BOTTOM_RIGHT:d=Math.max(i.minWidth,a+m),c=Math.max(i.minHeight,o+l);break;case B.TOP:c=Math.max(i.minHeight,o-l);break;case B.BOTTOM:c=Math.max(i.minHeight,o+l);break;case B.LEFT:d=Math.max(i.minWidth,a-m);break;case B.RIGHT:d=Math.max(i.minWidth,a+m);break;default:return{width:d,height:c}}if(i.preserveAspectRatio&&i.aspectRatio){const u=a/o;[B.TOP_LEFT,B.TOP_RIGHT,B.BOTTOM_LEFT,B.BOTTOM_RIGHT].includes(e)?d/u>c?c=Math.max(i.minHeight,d/u):d=Math.max(i.minWidth,c*u):[B.TOP,B.BOTTOM].includes(e)?d=c*u:[B.LEFT,B.RIGHT].includes(e)&&(c=d/u)}return i.maxWidth&&d>i.maxWidth&&(d=i.maxWidth,i.preserveAspectRatio&&i.aspectRatio&&(c=d/(a/o))),i.maxHeight&&c>i.maxHeight&&(c=i.maxHeight,i.preserveAspectRatio&&i.aspectRatio&&(d=c*(a/o))),d=Math.max(i.minWidth,d),c=Math.max(i.minHeight,c),{width:Math.round(d),height:Math.round(c)}}function Rn(e,{width:t,height:n}){fe(e)&&(e.tagName==="IMG"?(e.style.width=`${t}px`,e.style.height=`${n}px`,e.width=t,e.height=n):e.tagName==="DIV"&&(e.style.width=`${t}px`,e.style.height=`${n}px`))}function sa(e,t,n){Rn(t,n);const r=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(r)}function ia(e,t,n,r){const{ctrlKey:s,metaKey:a,shiftKey:o,key:i}=e,m=s||a,l=n.offsetWidth,d=n.offsetHeight,u={">":m&&o?()=>({width:Math.min(r.maxWidth||800,l+10),height:d}):null,"<":m&&o?()=>({width:Math.max(r.minWidth||50,l-10),height:d}):null,"+":m&&o?()=>({width:l,height:Math.min(r.maxHeight||600,d+10)}):null,"-":m&&o?()=>({width:l,height:Math.max(r.minHeight||50,d-10)}):null,r:m&&!o?()=>({width:300,height:200}):null}[i];if(u){e.preventDefault();const w=u();return sa(t,n,w),!0}return!1}const Ve=({editorRef:e,onImageResize:t,onImageSelect:n,onImageDeselect:r,resizeOptions:s=Te})=>{const a=p.useRef(null),o=p.useRef(null),i=p.useRef(null),m=p.useRef(null),l=p.useRef(s),d=p.useRef(!1),c=he();p.useEffect(()=>{l.current=s},[s]);const u=p.useCallback(b=>{if(!fe(b))return;a.current&&(We(a.current),a.current=null),b.classList.add("selected");const g=gn(b,l.current);g&&(a.current=g,o.current=b,document.body.appendChild(g),g.querySelectorAll(".resize-handler").forEach(_=>{_.addEventListener("mousedown",v)}),n&&n(b))},[n]),w=p.useCallback(()=>{o.current&&(o.current.classList.remove("selected"),o.current=null),a.current&&(We(a.current),a.current=null),i.current=null,m.current=null,d.current=!1,r&&r()},[r]),v=p.useCallback(b=>{if(b.preventDefault(),b.stopPropagation(),!o.current)return;const g=b.currentTarget.dataset.handler,h=o.current.getBoundingClientRect(),_=window.pageYOffset||document.documentElement.scrollTop,A=window.pageXOffset||document.documentElement.scrollLeft;i.current={x:b.clientX,y:b.clientY,width:o.current.offsetWidth,height:o.current.offsetHeight,originalWidth:o.current.offsetWidth,originalHeight:o.current.offsetHeight,offsetX:b.clientX-h.left-A,offsetY:b.clientY-h.top-_},m.current=g,d.current=!0,document.body.classList.add("resize-in-progress"),document.body.style.cursor=oa(g),document.addEventListener("mousemove",E),document.addEventListener("mouseup",k)},[]),E=p.useCallback(b=>{if(!d.current||!o.current||!i.current||!m.current)return;b.preventDefault(),b.stopPropagation();const{x:g,y:h,width:_,height:A}=i.current,N=m.current,z=b.clientX,U=b.clientY,X=aa({handler:N,startX:g,startY:h,currentX:z,currentY:U,startWidth:_,startHeight:A,options:l.current});Rn(o.current,X),a.current&&Ge(a.current,o.current)},[]),k=p.useCallback(b=>{if(d.current){if(b.preventDefault(),b.stopPropagation(),o.current&&i.current){const g={width:i.current.originalWidth,height:i.current.originalHeight},h={width:o.current.offsetWidth,height:o.current.offsetHeight};(g.width!==h.width||g.height!==h.height)&&c.recordOperation({type:"IMAGE_RESIZE",payload:{element:o.current,state:h}},{type:"IMAGE_RESIZE",payload:{element:o.current,state:g}})}if(i.current=null,m.current=null,d.current=!1,document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",k),document.body.classList.remove("resize-in-progress"),document.body.style.cursor="",o.current){const g=new Event("input",{bubbles:!0,cancelable:!0});o.current.dispatchEvent(g),t&&t(o.current,{width:o.current.offsetWidth,height:o.current.offsetHeight})}}},[t,c]),L=p.useCallback(b=>{a.current&&!a.current.contains(b.target)&&w();const g=b.target;if(fe(g)){if(g===o.current)return;u(g)}},[u,w]),j=p.useCallback(b=>{if((b.key==="Delete"||b.key==="Backspace")&&o.current&&!d.current){b.preventDefault();const g=o.current;if(g.parentNode){g.parentNode.removeChild(g),w();const h=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(h)}}b.key==="Escape"&&o.current&&w(),o.current&&!d.current&&ia(b,e,o.current,l.current)},[e,w]),I=p.useCallback(()=>{a.current&&o.current&&Ge(a.current,o.current)},[]);return p.useEffect(()=>{if(!e.current)return;const g=e.current.closest(".editor-viewport");return g&&(g.addEventListener("scroll",I),window.addEventListener("scroll",I)),()=>{g&&g.removeEventListener("scroll",I),window.removeEventListener("scroll",I)}},[e,I]),p.useEffect(()=>{if(!e.current)return;const b=e.current;return b.addEventListener("click",L),b.addEventListener("keydown",j),window.addEventListener("resize",I),()=>{b.removeEventListener("click",L),b.removeEventListener("keydown",j),window.removeEventListener("resize",I),d.current&&(document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",k),document.body.classList.remove("resize-in-progress"),document.body.style.cursor=""),a.current&&We(a.current)}},[e,L,j,I,E,k]),p.useEffect(()=>{if(!e.current)return;const b=new MutationObserver(g=>{g.forEach(h=>{h.type==="childList"&&(h.removedNodes.forEach(_=>{_.nodeType===Node.ELEMENT_NODE&&fe(_)&&_===o.current&&w()}),h.addedNodes.forEach(_=>{if(_.nodeType!==Node.ELEMENT_NODE)return;if(fe(_)){setTimeout(()=>u(_),50);return}const A=_.querySelectorAll?.("img")||[];A.length>0&&setTimeout(()=>u(A[0]),50)}))})});return b.observe(e.current,{childList:!0,subtree:!0}),()=>b.disconnect()},[e,w,u]),null};Ve.propTypes={editorRef:T.shape({current:T.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onImageResize:T.func,onImageSelect:T.func,onImageDeselect:T.func,resizeOptions:T.shape({minWidth:T.number,minHeight:T.number,maxWidth:T.number,maxHeight:T.number,aspectRatio:T.bool,preserveAspectRatio:T.bool,defaultWidth:T.number,defaultHeight:T.number})},Ve.defaultProps={onImageResize:void 0,onImageSelect:void 0,onImageDeselect:void 0,resizeOptions:Te};const St=({imageElement:e,onAlignChange:t,onAspectRatioToggle:n,onDelete:r,onClose:s,initialPreserveAspectRatio:a=!0})=>{const[o,i]=p.useState({top:0,left:0}),[m,l]=p.useState(!1),[d,c]=p.useState("top"),[u,w]=p.useState(a),v=p.useRef(null),E=p.useRef(null),k=he(),L=M=>{if(!M)return;(typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame:te=>setTimeout(te,16))(()=>{const te=document.querySelector(".image-resize-overlay");te&&Ge(te,M)})},j=M=>{if(!M)return null;const W=window.getComputedStyle(M);return{float:W.float||"none",margin:M.style.margin||"",display:W.display||"inline",width:M.style.width||M.width||"",height:M.style.height||M.height||"",aspectRatio:u}},I=p.useCallback(()=>{if(!e)return"left";const M=window.getComputedStyle(e);return M.float==="right"?"right":M.float==="left"?"left":M.display==="block"&&M.margin.includes("auto")?"center":"left"},[e]),[b,g]=p.useState("left");p.useEffect(()=>{e&&g(I())},[e,I]);const h=p.useCallback(()=>{if(!e||!v.current)return;const M=e.getBoundingClientRect(),W=v.current.getBoundingClientRect(),te=window.visualViewport?window.visualViewport:{width:window.innerWidth,height:window.innerHeight},ee=M.bottom>=0&&M.top<=te.height&&M.right>=0&&M.left<=te.width;let ne="top",oe=0,le=0;if(ee){const P=M.top-W.height-10,F=te.height-M.bottom-W.height-10;F>P&&F>0?(ne="bottom",oe=M.bottom+10):(ne="top",oe=M.top-W.height-10)}else ne="top",oe=10;le=M.left+M.width/2-W.width/2;const x=window.innerWidth,f=window.innerHeight;let C=Math.max(10,Math.min(le,x-W.width-10)),R=Math.max(10,Math.min(oe,f-W.height-10));i({top:R,left:C}),c(ne),l(!0)},[e]);p.useLayoutEffect(()=>{h();const M=()=>{h()},W=E.current;return W&&W.addEventListener("scroll",M),window.addEventListener("scroll",M),window.addEventListener("resize",M),()=>{W&&W.removeEventListener("scroll",M),window.removeEventListener("scroll",M),window.removeEventListener("resize",M),l(!1)}},[e,h]),p.useEffect(()=>{const M=W=>{v.current&&!v.current.contains(W.target)&&W.target!==e&&s()};return document.addEventListener("mousedown",M),()=>{document.removeEventListener("mousedown",M)}},[e,s]);const _={left:{float:"left",margin:"0 10px 10px 0",display:"block"},center:{float:"none",margin:"10px auto",display:"block"},right:{float:"right",margin:"0 0 10px 10px",display:"block"}},A=M=>{if(e&&_[M]){const W=j(e),te=b,ee=_[M];e.style.float=ee.float,e.style.margin=ee.margin,e.style.display=ee.display,g(M),L(e);const ne=j(e);k.recordOperation({type:"IMAGE_ALIGN",payload:{element:e,alignment:M,state:ne}},{type:"IMAGE_ALIGN",payload:{element:e,alignment:te,state:W}}),t&&t(M)}},N=()=>{if(e&&e.parentNode){const M={element:e,parent:e.parentNode,nextSibling:e.nextSibling};k.recordOperation({type:"IMAGE_DELETE",payload:{element:e}},{type:"IMAGE_REINSERT",payload:{state:M}}),e.parentNode.removeChild(e),r&&r(),s()}},z=()=>{const M=u,W=!u;w(W),k.recordOperation({type:"IMAGE_ASPECT_RATIO",payload:{element:e,preserveAspectRatio:W}},{type:"IMAGE_ASPECT_RATIO",payload:{element:e,preserveAspectRatio:M}}),n&&n(W)},U={border:"1px solid #ccc",borderRadius:"4px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"28px",height:"28px"},X=M=>({...U,background:M?"#007bff":"transparent",color:M?"#fff":"#333"});return!e||typeof document>"u"?null:It.createPortal(y.jsxs("div",{ref:v,className:"image-tooltip-menu","data-menu-position":d,"aria-hidden":!m,style:{position:"fixed",top:`${o.top}px`,left:`${o.left}px`,zIndex:999,background:"#fff",border:"1px solid #ddd",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"8px",display:"flex",gap:"2px",alignItems:"center",pointerEvents:m?"auto":"none",minWidth:"140px",minHeight:"32px",opacity:m?1:0,visibility:m?"visible":"hidden",transition:"opacity 0.15s ease, visibility 0.15s ease"},children:[y.jsx("button",{className:`tooltip-button aspect-ratio-toggle ${u?"":"active"}`,onClick:z,title:`Toggle aspect ratio preservation (currently ${u?"ON":"OFF"})`,children:u?y.jsx(Lo,{size:14}):y.jsx(_o,{size:14})}),y.jsx("button",{className:`tooltip-button ${b==="left"?"active":""}`,onClick:()=>A("left"),title:"Align Left",style:X(b==="left"),children:y.jsx(At,{size:14})}),y.jsx("button",{className:`tooltip-button ${b==="center"?"active":""}`,onClick:()=>A("center"),title:"Align Center",style:X(b==="center"),children:y.jsx(xt,{size:14})}),y.jsx("button",{className:`tooltip-button ${b==="right"?"active":""}`,onClick:()=>A("right"),title:"Align Right",style:X(b==="right"),children:y.jsx(wt,{size:14})}),y.jsx("button",{className:"tooltip-button delete-button",onClick:N,title:"Delete Image",style:{background:"transparent",color:"#dc3545",border:"1px solid #dc3545",borderRadius:"4px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"28px",height:"28px"},children:y.jsx(jo,{size:14})})]}),document.body)};St.propTypes={imageElement:T.instanceOf(typeof Element<"u"?Element:Object),onAlignChange:T.func,onAspectRatioToggle:T.func,onDelete:T.func,onClose:T.func.isRequired,initialPreserveAspectRatio:T.bool},St.defaultProps={imageElement:null,onAlignChange:void 0,onAspectRatioToggle:void 0,onDelete:void 0,initialPreserveAspectRatio:!0};const Me={minColumnWidth:10,minRowHeight:8,maxColumnWidth:800,maxRowHeight:600,tableMinWidth:100,tableMinHeight:50,tableMaxWidth:1200,tableMaxHeight:800},ae={COLUMN:"column",ROW:"row",TABLE_BOTTOM:"table-bottom",TABLE_RIGHT:"table-right"};function pe(e){return e?e.tagName==="TABLE":!1}function xe(e){if(!pe(e))return null;const t=e.getBoundingClientRect(),n=Array.from(e.rows),r=n.length>0?n[0].cells.length:0,s=[],a=e.querySelector("colgroup"),o=a?a.querySelectorAll("col"):[];if(o.length>=r)for(let m=0;m<r;m++){const l=o[m],d=l.style.width?parseInt(l.style.width,10):l.offsetWidth;s.push(d||100)}else if(n.length>0){const m=n[0];for(let l=0;l<m.cells.length;l++){const d=m.cells[l];s.push(d.offsetWidth)}}const i=n.map(m=>(m.style.height?parseInt(m.style.height,10):null)||m.offsetHeight);return{width:t.width,height:t.height,columns:r,rows:n.length,columnWidths:s,rowHeights:i,rect:t}}function Ln({type:e,index:t,delta:n,currentStructure:r,options:s=Me}){const a={columnWidths:[...r.columnWidths],rowHeights:[...r.rowHeights],tableWidth:r.width,tableHeight:r.height},o=(i,m,l,d,c)=>{m>=0&&m<i.length&&(i[m]=Math.max(d,Math.min(c,i[m]+l)))};switch(e){case ae.COLUMN:o(a.columnWidths,t,n,s.minColumnWidth,s.maxColumnWidth),a.tableWidth=r.width;break;case ae.ROW:o(a.rowHeights,t,n,s.minRowHeight,s.maxRowHeight),a.tableHeight=r.height;break;case ae.TABLE_BOTTOM:o(a.rowHeights,r.rows-1,n,s.minRowHeight,s.maxRowHeight);break;case ae.TABLE_RIGHT:o(a.columnWidths,r.columns-1,n,s.minColumnWidth,s.maxColumnWidth);break}return a}function Pt(e){if(!pe(e))return;const t=Array.from(e.rows);if(t.length===0)return;const n=t[0].cells.length;let r=e.querySelector("colgroup");r||(r=document.createElement("colgroup"),e.insertBefore(r,e.firstChild));const s=r.querySelectorAll("col"),a=s.length;if(a<n)for(let o=a;o<n;o++){const i=document.createElement("col");r.appendChild(i)}else if(a>n)for(let o=a-1;o>=n;o--)r.removeChild(s[o])}function In(e,t,n){if(!pe(e))return;Pt(e);const{columnWidths:r,rowHeights:s,tableWidth:a,tableHeight:o}=t,i=r?r.reduce((l,d)=>l+d,0):0,m=s?s.reduce((l,d)=>l+d,0):0;if(a!==void 0?e.style.width=`${a}px`:i>0&&(e.style.width=`${i}px`),o!==void 0?e.style.height=`${o}px`:m>0&&(e.style.height=`${m}px`),r&&r.length>0){e.style.tableLayout="fixed";const l=e.querySelector("colgroup");l&&l.querySelectorAll("col").forEach((c,u)=>{u<r.length&&(c.style.width=`${r[u]}px`)}),e.style.width=`${i}px`}s&&s.length>0&&(Array.from(e.rows).forEach((d,c)=>{c<s.length&&(d.style.height=`${s[c]}px`)}),e.style.height=`${m}px`),e.offsetHeight}function Dn(e,t=Me){if(!pe(e))return null;Pt(e);const n=xe(e);if(!n)return null;const r=document.createElement("div");r.className="table-resize-overlay",r.style.position="fixed",r.style.zIndex="1000",r.style.pointerEvents="none";const s=e.getBoundingClientRect();r.style.top=`${s.top}px`,r.style.left=`${s.left}px`,r.style.width=`${s.width}px`,r.style.height=`${s.height}px`;for(let i=0;i<n.columns-1;i++){const m=Hn(i,n,s,e);r.appendChild(m)}for(let i=0;i<n.rows-1;i++){const m=Bn(i,n,s,e);r.appendChild(m)}const a=jn(n,s);r.appendChild(a);const o=zn(n,s);return r.appendChild(o),r}function Hn(e,t,n,r){const s=document.createElement("div");return s.className="table-resize-handler table-column-resize-handler",s.dataset.type=ae.COLUMN,s.dataset.index=e,s.style.position="absolute",s.style.width="4px",s.style.height=`${n.height}px`,s.style.cursor="col-resize",s.style.pointerEvents="all",$n(s,e,t,n,r),s}function Bn(e,t,n,r){const s=document.createElement("div");return s.className="table-resize-handler table-row-resize-handler",s.dataset.type=ae.ROW,s.dataset.index=e,s.style.position="absolute",s.style.width=`${n.width}px`,s.style.height="4px",s.style.cursor="row-resize",s.style.pointerEvents="all",Un(s,e,t,n,r),s}function jn(e,t){const n=document.createElement("div");return n.className="table-resize-handler table-bottom-resize-handler",n.dataset.type=ae.TABLE_BOTTOM,n.style.position="absolute",n.style.width=`${t.width}px`,n.style.height="4px",n.style.cursor="ns-resize",n.style.pointerEvents="all",Fn(n,e,t),n}function zn(e,t){const n=document.createElement("div");return n.className="table-resize-handler table-right-resize-handler",n.dataset.type=ae.TABLE_RIGHT,n.style.position="absolute",n.style.width="4px",n.style.height=`${t.height}px`,n.style.cursor="ew-resize",n.style.pointerEvents="all",Gn(n,e,t),n}function Ke(e,t){if(!e||!t)return;Pt(t);const n=xe(t);if(!n)return;const r=t.getBoundingClientRect();e.style.top=`${r.top}px`,e.style.left=`${r.left}px`,e.style.width=`${r.width}px`,e.style.height=`${r.height}px`;const s=e.querySelectorAll(".table-column-resize-handler"),a=e.querySelectorAll(".table-row-resize-handler"),o=e.querySelector(".table-bottom-resize-handler"),i=e.querySelector(".table-right-resize-handler");if(s.length!==n.columns-1||a.length!==n.rows-1||!o||!i){e.innerHTML="";for(let c=0;c<n.columns-1;c++){const u=Hn(c,n,r,t);e.appendChild(u)}for(let c=0;c<n.rows-1;c++){const u=Bn(c,n,r,t);e.appendChild(u)}const l=jn(n,r);e.appendChild(l);const d=zn(n,r);e.appendChild(d)}else s.forEach((l,d)=>{$n(l,d,n,r,t)}),a.forEach((l,d)=>{Un(l,d,n,r,t)}),o&&Fn(o,n,r),i&&Gn(i,n,r)}function Re(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function $n(e,t,n,r,s){if(s&&s.rows.length>0){const o=s.rows[0];if(o.cells.length>t){const m=o.cells[t].getBoundingClientRect(),l=s.getBoundingClientRect(),d=m.right-l.left-2;e.style.left=`${d}px`,e.style.height=`${r.height}px`;return}}let a=0;for(let o=0;o<=t;o++)a+=n.columnWidths[o];e.style.left=`${a-2}px`,e.style.height=`${r.height}px`}function Un(e,t,n,r,s){if(s&&s.rows.length>t){const o=s.rows[t];if(o.cells.length>0){const m=o.cells[0].getBoundingClientRect(),l=s.getBoundingClientRect(),d=m.bottom-l.top-2;e.style.top=`${d}px`,e.style.width=`${r.width}px`;return}}let a=0;for(let o=0;o<=t;o++)a+=n.rowHeights[o];e.style.top=`${a-2}px`,e.style.width=`${r.width}px`}function Fn(e,t,n){e.style.bottom="-2px",e.style.left="0px",e.style.width=`${n.width}px`}function Gn(e,t,n){e.style.right="-2px",e.style.top="0px",e.style.height=`${n.height}px`}const Xe=({editorRef:e,onTableResize:t,onTableSelect:n,onTableDeselect:r,resizeOptions:s=Me})=>{const a=p.useRef(null),o=p.useRef(null),i=p.useRef(null),m=p.useRef(null),l=p.useRef(null),d=p.useRef(s),c=p.useRef(!1),[u,w]=p.useState(null),v=he();p.useEffect(()=>{d.current=s},[s]);const E=p.useCallback(()=>{o.current&&(o.current.classList.remove("selected"),o.current=null),a.current&&(Re(a.current),a.current=null),w(null),i.current=null,m.current=null,l.current=null,c.current=!1,r&&r()},[r]),k=p.useCallback(A=>{if(A.preventDefault(),A.stopPropagation(),!o.current)return;const N=A.currentTarget,z=N.dataset.type,U=parseInt(N.dataset.index,10);o.current.getBoundingClientRect(),window.pageYOffset||document.documentElement.scrollTop,window.pageXOffset||document.documentElement.scrollLeft;const X=xe(o.current);i.current={x:A.clientX,y:A.clientY,structure:{...X}},m.current=z,l.current=U,c.current=!0,document.body.classList.add("table-resize-in-progress");const M={[ae.COLUMN]:"col-resize",[ae.ROW]:"row-resize",[ae.TABLE_BOTTOM]:"ns-resize",[ae.TABLE_RIGHT]:"ew-resize"};document.body.style.cursor=M[z]||"default",document.addEventListener("mousemove",I),document.addEventListener("mouseup",b)},[]),L=p.useCallback(A=>{const N=Dn(A,d.current);return N&&(a.current=N,o.current=A,document.body.appendChild(N),N.querySelectorAll(".table-resize-handler").forEach(U=>{U.addEventListener("mousedown",k)})),N},[k]),j=p.useCallback(A=>{if(!pe(A))return;a.current&&(Re(a.current),a.current=null),A.classList.add("selected"),L(A)&&(w(A),n&&n(A))},[n,L]),I=p.useCallback(A=>{if(!c.current||!o.current||!i.current||!m.current)return;A.preventDefault(),A.stopPropagation();const{x:N,y:z,structure:U}=i.current,X=m.current,M=l.current,W=A.clientX,te=A.clientY;let ee=0;switch(X){case ae.COLUMN:ee=W-N;break;case ae.ROW:ee=te-z;break;case ae.TABLE_BOTTOM:ee=te-z;break;case ae.TABLE_RIGHT:ee=W-N;break}const ne=Ln({type:X,index:M,delta:ee,currentStructure:U,options:d.current});In(o.current,ne),a.current&&Ke(a.current,o.current)},[]),b=p.useCallback(A=>{if(c.current){if(A.preventDefault(),A.stopPropagation(),o.current&&i.current){const N={structure:i.current.structure},z={structure:xe(o.current)};(N.structure.width!==z.structure.width||N.structure.height!==z.structure.height||JSON.stringify(N.structure.columnWidths)!==JSON.stringify(z.structure.columnWidths)||JSON.stringify(N.structure.rowHeights)!==JSON.stringify(z.structure.rowHeights))&&v.recordOperation({type:"TABLE_RESIZE",payload:{element:o.current,state:z}},{type:"TABLE_RESIZE",payload:{element:o.current,state:N}})}if(i.current=null,m.current=null,l.current=null,c.current=!1,document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",b),document.body.classList.remove("table-resize-in-progress"),document.body.style.cursor="",o.current){const N=new Event("input",{bubbles:!0,cancelable:!0});o.current.dispatchEvent(N),t&&t(o.current,xe(o.current))}}},[t,v]),g=p.useCallback(A=>{a.current&&!a.current.contains(A.target)&&E();const z=A.target.closest("table");if(z&&pe(z)){if(z===o.current)return;j(z)}},[j,E]),h=p.useCallback(A=>{if((A.key==="Delete"||A.key==="Backspace")&&o.current&&!c.current){A.preventDefault();const N=o.current;if(N.parentNode){N.parentNode.removeChild(N),E();const z=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(z)}}A.key==="Escape"&&o.current&&E()},[e,E]),_=p.useCallback(()=>{a.current&&o.current&&Ke(a.current,o.current)},[]);return p.useEffect(()=>{if(!e.current)return;const N=e.current.closest(".editor-viewport");return N&&(N.addEventListener("scroll",_),window.addEventListener("scroll",_)),()=>{N&&N.removeEventListener("scroll",_),window.removeEventListener("scroll",_)}},[e,_]),p.useEffect(()=>{if(!e.current)return;const A=e.current;return A.addEventListener("click",g),A.addEventListener("keydown",h),window.addEventListener("resize",_),()=>{A.removeEventListener("click",g),A.removeEventListener("keydown",h),window.removeEventListener("resize",_),c.current&&(document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",b),document.body.classList.remove("table-resize-in-progress"),document.body.style.cursor=""),a.current&&Re(a.current)}},[e,g,h,_,I,b]),p.useEffect(()=>{if(!e.current)return;const A=new MutationObserver(N=>{N.forEach(z=>{z.type==="childList"&&(z.removedNodes.forEach(U=>{U.nodeType===Node.ELEMENT_NODE&&pe(U)&&U===u&&E()}),z.addedNodes.forEach(U=>{if(U.nodeType!==Node.ELEMENT_NODE)return;if(pe(U)){setTimeout(()=>j(U),50);return}const X=U.querySelectorAll?.("table")||[];X.length>0&&setTimeout(()=>j(X[0]),50)}))})});return A.observe(e.current,{childList:!0,subtree:!0}),()=>A.disconnect()},[e,E,j]),p.useEffect(()=>{if(!u)return;const A=new MutationObserver(N=>{N.some(U=>{if(U.type==="childList"){if([...U.addedNodes,...U.removedNodes].some(M=>M.nodeType===Node.ELEMENT_NODE&&M.tagName==="TR"))return!0}else if(U.type==="attributes"&&["colspan","rowspan"].includes(U.attributeName))return!0;return!1})&&a.current&&o.current&&(Re(a.current),a.current=null,L(o.current))});return A.observe(u,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["colspan","rowspan"]}),()=>A.disconnect()},[u,L]),null};Xe.propTypes={editorRef:T.shape({current:T.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onTableResize:T.func,onTableSelect:T.func,onTableDeselect:T.func,resizeOptions:T.shape({minColumnWidth:T.number,minRowHeight:T.number,maxColumnWidth:T.number,maxRowHeight:T.number,tableMinWidth:T.number,tableMinHeight:T.number,tableMaxWidth:T.number,tableMaxHeight:T.number})},Xe.defaultProps={onTableResize:void 0,onTableSelect:void 0,onTableDeselect:void 0,resizeOptions:Me};const Ot=({tableElement:e,onAlignChange:t,onClose:n})=>{const[r,s]=p.useState({top:0,left:0}),[a,o]=p.useState(!1),[i,m]=p.useState("top"),l=p.useRef(null),d=p.useRef(null),c=he(),u=h=>{if(!h)return;(typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame:A=>setTimeout(A,16))(()=>{const A=document.querySelector(".table-resize-overlay");A&&Ke(A,h)})},w=h=>{if(!h)return null;const _=window.getComputedStyle(h);return{float:_.float||"none",margin:h.style.margin||"",marginLeft:h.style.marginLeft||"",marginRight:h.style.marginRight||"",display:_.display||"table"}},v=p.useCallback(()=>{if(!e)return"left";const h=window.getComputedStyle(e);return h.marginLeft==="auto"&&h.marginRight==="auto"?"center":h.float==="right"?"right":(h.float==="left","left")},[e]),[E,k]=p.useState("left");p.useEffect(()=>{e&&k(v())},[e,v]);const L=p.useCallback(()=>{if(!e||!l.current)return;const h=e.getBoundingClientRect(),_=l.current.getBoundingClientRect(),A=window.visualViewport?window.visualViewport:{width:window.innerWidth,height:window.innerHeight},N=h.bottom>=0&&h.top<=A.height&&h.right>=0&&h.left<=A.width;let z="top",U=0,X=0;if(N){const ne=h.top-_.height-10,oe=A.height-h.bottom-_.height-10;oe>ne&&oe>0?(z="bottom",U=h.bottom+10):(z="top",U=h.top-_.height-10)}else z="top",U=10;X=h.left+h.width/2-_.width/2;const M=window.innerWidth,W=window.innerHeight;let te=Math.max(10,Math.min(X,M-_.width-10)),ee=Math.max(10,Math.min(U,W-_.height-10));s({top:ee,left:te}),m(z),o(!0)},[e]);p.useLayoutEffect(()=>{L();const h=()=>{L()},_=d.current;return _&&_.addEventListener("scroll",h),window.addEventListener("scroll",h),window.addEventListener("resize",h),()=>{_&&_.removeEventListener("scroll",h),window.removeEventListener("scroll",h),window.removeEventListener("resize",h),o(!1)}},[e,L]),p.useEffect(()=>{const h=_=>{l.current&&!l.current.contains(_.target)&&_.target!==e&&!e.contains(_.target)&&n()};return document.addEventListener("mousedown",h),()=>{document.removeEventListener("mousedown",h)}},[e,n]);const j={left:{float:"left",margin:"10px 10px 10px 0",marginLeft:"",marginRight:""},center:{float:"none",margin:"10px auto",marginLeft:"auto",marginRight:"auto"},right:{float:"right",margin:"10px 0 10px 10px",marginLeft:"",marginRight:""}},I=h=>{if(e&&j[h]){const _=w(e),A=E,N=j[h];e.style.float=N.float,e.style.margin=N.margin,e.style.marginLeft=N.marginLeft,e.style.marginRight=N.marginRight,k(h),u(e);const z=w(e);c.recordOperation({type:"TABLE_ALIGN",payload:{element:e,alignment:h,state:z}},{type:"TABLE_ALIGN",payload:{element:e,alignment:A,state:_}}),t&&t(h)}},b={border:"1px solid #ccc",borderRadius:"4px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"28px",height:"28px"},g=h=>({...b,background:h?"#007bff":"transparent",color:h?"#fff":"#333"});return!e||typeof document>"u"?null:It.createPortal(y.jsxs("div",{ref:l,className:"table-tooltip-menu","data-menu-position":i,"aria-hidden":!a,style:{position:"fixed",top:`${r.top}px`,left:`${r.left}px`,zIndex:999,background:"#fff",border:"1px solid #ddd",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"8px",display:"flex",gap:"2px",alignItems:"center",pointerEvents:a?"auto":"none",minWidth:"100px",minHeight:"32px",opacity:a?1:0,visibility:a?"visible":"hidden",transition:"opacity 0.15s ease, visibility 0.15s ease"},children:[y.jsx("button",{className:`tooltip-button ${E==="left"?"active":""}`,onClick:()=>I("left"),title:"Align Left",style:g(E==="left"),children:y.jsx(At,{size:14})}),y.jsx("button",{className:`tooltip-button ${E==="center"?"active":""}`,onClick:()=>I("center"),title:"Align Center",style:g(E==="center"),children:y.jsx(xt,{size:14})}),y.jsx("button",{className:`tooltip-button ${E==="right"?"active":""}`,onClick:()=>I("right"),title:"Align Right",style:g(E==="right"),children:y.jsx(wt,{size:14})})]}),document.body)};Ot.propTypes={tableElement:T.instanceOf(typeof Element<"u"?Element:Object),onAlignChange:T.func,onClose:T.func.isRequired},Ot.defaultProps={tableElement:null,onAlignChange:void 0};const ca=50,Nt=50,la=50,ua=100,da=300,Je=p.forwardRef(({pageManagerComponent:e=null,onNavigatePage:t,onAddPage:n,onDeletePage:r,onPageSizeChange:s,onPageMarginsChange:a,onChange:o,showSidebar:i=!0,showToolbar:m=!0,showPageManager:l=!0},d)=>{const c=pt(),u=he(),{pageSize:w,pageMargins:v,continuousContent:E,pageBoundaries:k,activePage:L,zoomLevel:j,canUndo:I,canRedo:b}=c,g=p.useRef(null),h=p.useRef(null),{currentFormat:_,formatText:A,updateCurrentFormatFromSelection:N}=an(),[z,U]=p.useState(!1),[X,M]=p.useState(null),[W,te]=p.useState(!0),[ee,ne]=p.useState(!1),[oe,le]=p.useState(null),x=p.useRef(null),{checkAndUpdateBoundaries:f,getCurrentPage:C,scrollToPage:R,updateBoundaries:P,triggerAutoReflow:F,removePageAndContent:G,removePageBreak:H,insertPageBreakAtBoundary:q}=pn(w,h,j,v),Y=p.useMemo(()=>Be(w),[w]),[Z,se]=p.useState(!1),S=p.useRef(null),ie=p.useRef(!1),ge=p.useRef(!1),we=p.useRef(!1),Ae=p.useRef(E);p.useEffect(()=>{if(h.current){if(!we.current){h.current.innerHTML=E,we.current=!0,Ae.current=E;const O=setTimeout(()=>{P()},ca);return()=>clearTimeout(O)}if(Ae.current!==E){if(h.current.innerHTML!==E){h.current.innerHTML=E;const K=setTimeout(()=>{P(),ie.current&&qn()},Nt);return Ae.current=E,()=>clearTimeout(K)}Ae.current=E}}},[E,P,k.length,u,R]),p.useEffect(()=>{o&&we.current&&o(E)},[E,o]);const Wn=p.useMemo(()=>({getHTMLContent:()=>h.current?h.current.innerHTML:E,getPlainText:()=>(h.current?h.current.innerHTML:E).replace(/<[^>]*>/g," ").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\s+/g," ").trim(),getCursorPosition:()=>h.current?qr(h.current):null,setContent:O=>{const K=qe(O);K!==E&&u.updateContinuousContent(K),h.current&&h.current.innerHTML!==K&&(h.current.innerHTML=K),Ae.current=K,h.current&&setTimeout(()=>{P()},Nt)},insertContent:O=>{if(!h.current||!O)return;const K=qe(O),re=window.getSelection();let ue=!1;if(re&&re.rangeCount>0){const Lt=re.getRangeAt(0);h.current.contains(Lt.commonAncestorContainer)&&(ue=!0)}if(!ue&&x.current)try{re.removeAllRanges(),re.addRange(x.current)}catch(Lt){console.warn("[insertContent] Failed to restore last cursor position:",Lt);const Le=h.current.lastChild;if(Le){const nt=document.createRange();Le.nodeType===Node.TEXT_NODE?nt.setStart(Le,Le.textContent.length):nt.setStartAfter(Le),nt.collapse(!0),re.removeAllRanges(),re.addRange(nt)}}document.execCommand("insertHTML",!1,K);const ye=h.current.innerHTML;u.updateContinuousContent(ye),Ae.current=ye,setTimeout(()=>{P(),F(200)},Nt)}}),[E,u,P,h,x,f]);p.useImperativeHandle(d,()=>Wn,[Wn]),p.useEffect(()=>{const O=()=>{if(N(),h.current){const re=window.getSelection();if(re.rangeCount>0){const ue=re.getRangeAt(0);ue.collapsed&&h.current.contains(ue.commonAncestorContainer)&&(x.current=ue.cloneRange())}}};document.addEventListener("selectionchange",O);const K=()=>{if(setTimeout(N,10),x.current&&h.current)try{const re=window.getSelection();re.removeAllRanges(),re.addRange(x.current)}catch(re){console.warn("[handleFocus] Failed to restore cursor:",re)}};return h.current&&h.current.addEventListener("focus",K),()=>{document.removeEventListener("selectionchange",O),h.current&&h.current.removeEventListener("focus",K)}},[N]);const qn=p.useCallback(()=>{ie.current=!1;const O=Math.max(0,k.length-1);u.setActivePage(O),setTimeout(()=>{R(O,g)},la)},[k.length,u,R]),Rt=p.useCallback(()=>{if(!h.current)return;let O=h.current.innerHTML;O=qe(O),O!==h.current.innerHTML&&(h.current.innerHTML=O);const K=E;if(K!==O){const ue={type:"UPDATE_CONTINUOUS_CONTENT",payload:O},ye={type:"UPDATE_CONTINUOUS_CONTENT",payload:K};u.recordOperation(ue,ye)}u.updateContinuousContent(O),f(),F(200);const re=C(g);re!==L&&u.setActivePage(re)},[u,f,C,L,F,g,h,E]),fa=p.useCallback(O=>{Rt()},[Rt]),Zn=p.useCallback(O=>{u.updatePageSize(O),P({pageSize:O}),s&&s(O)},[u,P,s]),Yn=p.useCallback(O=>{u.updatePageMargins(O),P({pageMargins:O}),a&&a(O)},[u,P,a]),Vn=p.useCallback(O=>{O<0||O>=k.length||(ge.current=!0,u.setActivePage(O),R(O,g),setTimeout(()=>{ge.current=!1},da),t&&t(O))},[u,R,t,k.length]),Kn=p.useCallback(()=>{const O=k.length+1;q(O)&&(ie.current=!0,setTimeout(()=>{ie.current&&qn()},100)),n&&n()},[k.length,q,u,R,n]),pa=p.useCallback(()=>{const O=window.getSelection();if(O&&O.rangeCount>0){if(!h?.current)return;const ue=`<page-break data-page-break="true" contenteditable="false" data-page-number="${h.current.querySelectorAll('page-break, [data-page-break="true"]').length+2}"></page-break><p><br></p>`;document.execCommand("insertHTML",!1,ue),setTimeout(()=>{P();const ye=C(g);u.setActivePage(ye)},150)}},[P,C,u,g]),ga=p.useCallback(O=>{if(!O)return;H(O)&&setTimeout(()=>{const re=C(g);u.setActivePage(re)},200)},[H,C,u,g]),Xn=p.useCallback(O=>{if(k.length<=1){console.warn("Cannot delete the only page");return}G(O)&&(u.setActivePage(0),r&&r(O))},[k.length,G,u,r]),Qe=p.useCallback(()=>{u.zoomIn()},[u]),et=p.useCallback(()=>{u.zoomOut()},[u]),tt=p.useCallback(()=>{u.resetZoom()},[u]),Jn=p.useCallback(()=>{u.undo()},[u]),Qn=p.useCallback(()=>{u.redo()},[u]);p.useEffect(()=>{const O=K=>{if(K.ctrlKey||K.metaKey){["+","=","-","_","0","z","y"].includes(K.key)&&K.preventDefault();const re=document.activeElement===h.current,ue=document.activeElement===g.current,ye=document.activeElement?.tagName==="INPUT"||document.activeElement?.tagName==="TEXTAREA"||document.activeElement?.isContentEditable===!1;if(re||ue||!ye)switch(K.key){case"+":case"=":Qe();break;case"-":case"_":et();break;case"0":tt();break;case"z":K.shiftKey||Jn();break;case"y":Qn();break}}};return window.addEventListener("keydown",O),()=>{window.removeEventListener("keydown",O)}},[Qe,et,tt,Jn,Qn]);const ha=p.useCallback(()=>{!g.current||!h.current||ge.current||(S.current&&clearTimeout(S.current),S.current=setTimeout(()=>{if(ge.current){S.current=null;return}const O=C(g);O!==L&&O>=0&&u.setActivePage(O),S.current=null},ua))},[C,L,u]),ma=p.useMemo(()=>{if(!E)return 0;const K=E.replace(/<[^>]*>/g," ").match(new RegExp("\\p{L}+","gu"));return K?K.length:0},[E]),ya=k.length||1,ba=p.useCallback(O=>{U(!0),M(O)},[]),er=p.useCallback(()=>{U(!1),M(null)},[]),Ea=p.useCallback((O,K)=>{},[]),Ta=p.useCallback(O=>{ne(!0),le(O)},[]),tr=p.useCallback(()=>{ne(!1),le(null)},[]),va=p.useCallback((O,K)=>{},[]);return p.useEffect(()=>()=>{S.current&&clearTimeout(S.current)},[]),y.jsxs("div",{className:"multi-page-editor",children:[m&&y.jsx(Ye,{currentFormat:{..._,imageSelected:z},onFormatText:A,onAddPageBreak:pa,canUndo:I,canRedo:b}),y.jsxs("div",{className:"editor-container",children:[i&&y.jsx(_n,{editorView:null,isCollapsed:Z,onToggle:()=>se(O=>!O),wordCount:ma,pageCount:ya}),y.jsx("div",{className:"editor-viewport continuous-scroll",ref:g,onScroll:ha,children:y.jsx(Nn,{content:E,dimensions:Y,pageSize:w,pageMargins:v,pageBoundaries:k,editorRef:h,onInput:fa,onContentChange:Rt,onClick:()=>h.current?.focus(),onRemovePageBreak:ga,zoomLevel:j})}),y.jsx(Ve,{editorRef:h,onImageSelect:ba,onImageDeselect:er,onImageResize:Ea,resizeOptions:{...Te,preserveAspectRatio:W,aspectRatio:W}}),y.jsx(Xe,{editorRef:h,onTableSelect:Ta,onTableDeselect:tr,onTableResize:va}),z&&X&&y.jsx(St,{imageElement:X,initialPreserveAspectRatio:W,onAlignChange:O=>{},onAspectRatioToggle:O=>{te(O)},onDelete:()=>{if(X){const O=X.getAttribute("data-key");O&&bn(O).catch(K=>{console.error("Failed to delete image from IndexedDB:",K)})}},onClose:er}),ee&&oe&&y.jsx(Ot,{tableElement:oe,onAlignChange:O=>{},onClose:tr}),l&&y.jsx("div",{className:"page-manager-sidebar",children:e?p.cloneElement(e,{onNavigate:Vn,onAddPage:Kn,onDeletePage:Xn,onPageSizeChange:Zn,onPageMarginsChange:Yn,zoomLevel:j,canZoomIn:it(j),canZoomOut:ct(j),onZoomIn:Qe,onZoomOut:et,onZoomReset:tt}):y.jsx(Mn,{pageBoundaries:k,activePage:L,pageSize:w,pageMargins:v,zoomLevel:j,canZoomIn:it(j),canZoomOut:ct(j),onNavigate:Vn,onAddPage:Kn,onDeletePage:Xn,onPageSizeChange:Zn,onPageMarginsChange:Yn,onZoomIn:Qe,onZoomOut:et,onZoomReset:tt})})]})]})});Je.displayName="HtmlEditor",Je.propTypes={pageManagerComponent:T.element,onNavigatePage:T.func,onAddPage:T.func,onDeletePage:T.func,onPageSizeChange:T.func,onPageMarginsChange:T.func,onChange:T.func,showSidebar:T.bool,showToolbar:T.bool,showPageManager:T.bool},Je.defaultProps={pageManagerComponent:null,onNavigatePage:void 0,onAddPage:void 0,onDeletePage:void 0,onPageSizeChange:void 0,onPageMarginsChange:void 0,onChange:void 0,showSidebar:!0,showToolbar:!0,showPageManager:!0};class Mt extends p.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,n){console.error("[ErrorBoundary] Caught error:",t),console.error("[ErrorBoundary] Error info:",n),this.setState({error:t,errorInfo:n}),this.props.onError&&this.props.onError(t,n)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onReset&&this.props.onReset()};render(){return this.state.hasError?this.props.fallback?this.props.fallback:y.jsxs("div",{style:{padding:"20px",margin:"20px",border:"2px solid #f44336",borderRadius:"4px",backgroundColor:"#ffebee",color:"#c62828"},children:[y.jsx("h2",{style:{marginTop:0},children:"⚠️ Something went wrong"}),y.jsx("p",{children:"The editor encountered an unexpected error and couldn't continue."}),this.props.showDetails&&this.state.error&&y.jsxs("details",{style:{marginTop:"10px",padding:"10px",backgroundColor:"white",borderRadius:"4px",fontSize:"12px",fontFamily:"monospace"},children:[y.jsx("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Error Details"}),y.jsxs("pre",{style:{marginTop:"10px",overflow:"auto",maxHeight:"200px"},children:[this.state.error.toString(),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}),y.jsx("button",{onClick:this.handleReset,style:{marginTop:"15px",padding:"8px 16px",backgroundColor:"#f44336",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:"Try Again"})]}):this.props.children}}Mt.propTypes={children:T.node.isRequired,fallback:T.node,onError:T.func,onReset:T.func,showDetails:T.bool},Mt.defaultProps={fallback:null,onError:void 0,onReset:void 0,showDetails:process.env.NODE_ENV==="development"},D.COMMON_FONT_SIZES=tn,D.DEFAULT_FONT_SIZE=Pe,D.DEFAULT_IMAGE_RESIZE_OPTIONS=Te,D.DEFAULT_PAGE_SIZE=lt,D.DEFAULT_TABLE_RESIZE_OPTIONS=Me,D.DocumentProvider=gr,D.EditorToolbar=Ye,D.ErrorBoundary=Mt,D.FONT_SIZE_MAP=vt,D.HtmlEditor=Je,D.ImageResizeHandlers=Ve,D.PAGE_SIZES=be,D.PageManager=Mn,D.PageView=Nn,D.RESIZE_HANDLERS=B,D.Sidebar=_n,D.TABLE_RESIZE_HANDLERS=ae,D.TableResizeHandlers=Xe,D.applyImageDimensions=Kr,D.applyTableDimensions=In,D.calculateResizeDimensions=Yr,D.calculateTableResizeDimensions=Ln,D.clearImages=to,D.createResizeOverlay=gn,D.createTableResizeOverlay=Dn,D.deleteImage=bn,D.getAllImageKeys=no,D.getAvailablePageSizes=dr,D.getImage=yn,D.getImageDimensions=Vr,D.getPageDimensions=Be,D.getPixelValue=wr,D.getPointValue=Ar,D.getTableStructure=xe,D.isResizableImage=fe,D.isResizableTable=pe,D.isValidFontSize=_r,D.isValidPageSize=ur,D.logger=Cn,D.pixelsToPoints=rn,D.pointsToPixels=nn,D.removeResizeOverlay=We,D.removeTableResizeOverlay=Re,D.saveImage=mn,D.updateResizeOverlay=Ge,D.updateTableResizeOverlay=Ke,D.useContinuousReflow=pn,D.useDocument=ft,D.useDocumentActions=he,D.useDocumentState=pt,D.useFormatting=an,Object.defineProperty(D,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=htmleditor.umd.cjs.map
