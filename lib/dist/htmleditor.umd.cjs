(function(U,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("react"),require("uuid"),require("react-dom")):typeof define=="function"&&define.amd?define(["exports","react","uuid","react-dom"],d):(U=typeof globalThis<"u"?globalThis:U||self,d(U.HTMLEditor={},U.React,U.uuid,U.ReactDOM))})(this,(function(U,d,at,jt){"use strict";function sr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var De={exports:{}},Ae={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zt;function ar(){if(zt)return Ae;zt=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function r(n,a,s){var o=null;if(s!==void 0&&(o=""+s),a.key!==void 0&&(o=""+a.key),"key"in a){s={};for(var i in a)i!=="key"&&(s[i]=a[i])}else s=a;return a=s.ref,{$$typeof:e,type:n,key:o,ref:a!==void 0?a:null,props:s}}return Ae.Fragment=t,Ae.jsx=r,Ae.jsxs=r,Ae}var _e={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $t;function ir(){return $t||($t=1,process.env.NODE_ENV!=="production"&&(function(){function e(p){if(p==null)return null;if(typeof p=="function")return p.$$typeof===C?null:p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case k:return"Fragment";case z:return"Profiler";case M:return"StrictMode";case y:return"Suspense";case R:return"SuspenseList";case _:return"Activity"}if(typeof p=="object")switch(typeof p.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),p.$$typeof){case x:return"Portal";case b:return p.displayName||"Context";case N:return(p._context.displayName||"Context")+".Consumer";case h:var S=p.render;return p=p.displayName,p||(p=S.displayName||S.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case O:return S=p.displayName||null,S!==null?S:e(p.type)||"Memo";case B:S=p._payload,p=p._init;try{return e(p(S))}catch{}}return null}function t(p){return""+p}function r(p){try{t(p);var S=!1}catch{S=!0}if(S){S=console;var j=S.error,I=typeof Symbol=="function"&&Symbol.toStringTag&&p[Symbol.toStringTag]||p.constructor.name||"Object";return j.call(S,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",I),t(p)}}function n(p){if(p===k)return"<>";if(typeof p=="object"&&p!==null&&p.$$typeof===B)return"<...>";try{var S=e(p);return S?"<"+S+">":"<...>"}catch{return"<...>"}}function a(){var p=D.A;return p===null?null:p.getOwner()}function s(){return Error("react-stack-top-frame")}function o(p){if(E.call(p,"key")){var S=Object.getOwnPropertyDescriptor(p,"key").get;if(S&&S.isReactWarning)return!1}return p.key!==void 0}function i(p,S){function j(){Z||(Z=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",S))}j.isReactWarning=!0,Object.defineProperty(p,"key",{get:j,configurable:!0})}function g(){var p=e(this.type);return ee[p]||(ee[p]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),p=this.props.ref,p!==void 0?p:null}function l(p,S,j,I,G,W){var $=j.ref;return p={$$typeof:v,type:p,key:S,props:j,_owner:I},($!==void 0?$:null)!==null?Object.defineProperty(p,"ref",{enumerable:!1,get:g}):Object.defineProperty(p,"ref",{enumerable:!1,value:null}),p._store={},Object.defineProperty(p._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(p,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(p,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:G}),Object.defineProperty(p,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:W}),Object.freeze&&(Object.freeze(p.props),Object.freeze(p)),p}function f(p,S,j,I,G,W){var $=S.children;if($!==void 0)if(I)if(L($)){for(I=0;I<$.length;I++)c($[I]);Object.freeze&&Object.freeze($)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else c($);if(E.call(S,"key")){$=e(p);var Y=Object.keys(S).filter(function(K){return K!=="key"});I=0<Y.length?"{key: someKey, "+Y.join(": ..., ")+": ...}":"{key: someKey}",A[$+I]||(Y=0<Y.length?"{"+Y.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,I,$,Y,$),A[$+I]=!0)}if($=null,j!==void 0&&(r(j),$=""+j),o(S)&&(r(S.key),$=""+S.key),"key"in S){j={};for(var X in S)X!=="key"&&(j[X]=S[X])}else j=S;return $&&i(j,typeof p=="function"?p.displayName||p.name||"Unknown":p),l(p,$,j,a(),G,W)}function c(p){u(p)?p._store&&(p._store.validated=1):typeof p=="object"&&p!==null&&p.$$typeof===B&&(p._payload.status==="fulfilled"?u(p._payload.value)&&p._payload.value._store&&(p._payload.value._store.validated=1):p._store&&(p._store.validated=1))}function u(p){return typeof p=="object"&&p!==null&&p.$$typeof===v}var w=d,v=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),z=Symbol.for("react.profiler"),N=Symbol.for("react.consumer"),b=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),_=Symbol.for("react.activity"),C=Symbol.for("react.client.reference"),D=w.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,E=Object.prototype.hasOwnProperty,L=Array.isArray,V=console.createTask?console.createTask:function(){return null};w={react_stack_bottom_frame:function(p){return p()}};var Z,ee={},oe=w.react_stack_bottom_frame.bind(w,s)(),re=V(n(s)),A={};_e.Fragment=k,_e.jsx=function(p,S,j){var I=1e4>D.recentlyCreatedOwnerStacks++;return f(p,S,j,!1,I?Error("react-stack-top-frame"):oe,I?V(n(p)):re)},_e.jsxs=function(p,S,j){var I=1e4>D.recentlyCreatedOwnerStacks++;return f(p,S,j,!0,I?Error("react-stack-top-frame"):oe,I?V(n(p)):re)}})()),_e}var Ut;function cr(){return Ut||(Ut=1,process.env.NODE_ENV==="production"?De.exports=ar():De.exports=ir()),De.exports}var m=cr();const it=100,ct=50,lt=200,Ft=5,ut=e=>e<lt,dt=e=>e>ct,lr=96,He=e=>Math.round(e*lr),Be={NORMAL:{name:"Normal",label:'Normal (1")',top:1,bottom:1,left:1,right:1},NARROW:{name:"Narrow",label:'Narrow (0.5")',top:.5,bottom:.5,left:.5,right:.5},MODERATE:{name:"Moderate",label:'Moderate (1" / 0.75")',top:1,bottom:1,left:.75,right:.75},WIDE:{name:"Wide",label:'Wide (1" / 2")',top:1,bottom:1,left:2,right:2},OFFICE_2003:{name:"Office 2003",label:'Office 2003 (1" / 1.25")',top:1,bottom:1,left:1.25,right:1.25}},pe="NORMAL",Wt=(e=pe)=>{const t=Be[e]||Be[pe];return{top:He(t.top),bottom:He(t.bottom),left:He(t.left),right:He(t.right)}},ur=(e=pe)=>{const t=Wt(e);return t.top+t.bottom},dr=()=>Object.keys(Be),fr=e=>{const t=Be[e];return t?t.label:"Unknown"},Ee={A4:{name:"A4",width:794,height:1123,widthMm:210,heightMm:297,widthIn:8.27,heightIn:11.69},Letter:{name:"Letter",width:816,height:1056,widthMm:216,heightMm:279,widthIn:8.5,heightIn:11},Legal:{name:"Legal",width:816,height:1344,widthMm:216,heightMm:356,widthIn:8.5,heightIn:14}},ft="A4",je=e=>{const t=Ee[e]||Ee[ft];return{width:t.width,height:t.height}},pr=e=>Object.keys(Ee).includes(e),gr=()=>Object.keys(Ee),Se=ft,Te="<p><br></p>",hr="continuous",ke=(e,t=Se)=>({id:at.v4(),index:e,size:t,content:Te,images:[],isBreakPoint:!1}),ze=e=>typeof e!="string"||e.trim()===""?Te:e,Gt=(e,t=Se)=>(e.length>0?e:[ke(0,t)]).map((n,a)=>({id:n.id||at.v4(),index:a,size:n.size||t,content:ze(n.content),images:n.images||[],isBreakPoint:!!n.isBreakPoint})),mr=(e=Se)=>[{id:"page-0",pageNumber:1,top:0,height:je(e).height}],$e=e=>e.slice(0,-1).map((t,r)=>({id:`auto-break-${r}`,pageNumber:r+1})),pt=(e={})=>{const t=new Date().toISOString(),r=e.pageSize||Se,n=Gt(e.pages||[ke(0,r)],r);return{id:at.v4(),title:e.title||"Untitled Document",createdAt:t,updatedAt:t,pageSize:r,pages:n,activePage:e.activePage&&e.activePage<n.length?e.activePage:0,pageBreaks:e.pageBreaks||[],totalPages:n.length,editorMode:e.editorMode||hr,continuousContent:e.continuousContent||Te,pageBoundaries:e.pageBoundaries||mr(r),zoomLevel:e.zoomLevel||it,pageMargins:e.pageMargins||pe,undoStack:[],redoStack:[],canUndo:!1,canRedo:!1}},q={INITIALIZE_DOCUMENT:"INITIALIZE_DOCUMENT",UPDATE_TITLE:"UPDATE_TITLE",UPDATE_PAGE_CONTENT:"UPDATE_PAGE_CONTENT",UPDATE_PAGES:"UPDATE_PAGES",ADD_PAGE:"ADD_PAGE",DELETE_PAGE:"DELETE_PAGE",SET_ACTIVE_PAGE:"SET_ACTIVE_PAGE",UPDATE_PAGE_SIZE:"UPDATE_PAGE_SIZE",RESET_DOCUMENT:"RESET_DOCUMENT",UPDATE_CONTINUOUS_CONTENT:"UPDATE_CONTINUOUS_CONTENT",UPDATE_PAGE_BOUNDARIES:"UPDATE_PAGE_BOUNDARIES",ADD_PAGE_BREAK:"ADD_PAGE_BREAK",REMOVE_PAGE_BREAK:"REMOVE_PAGE_BREAK",SET_EDITOR_MODE:"SET_EDITOR_MODE",SET_ZOOM_LEVEL:"SET_ZOOM_LEVEL",ZOOM_IN:"ZOOM_IN",ZOOM_OUT:"ZOOM_OUT",RESET_ZOOM:"RESET_ZOOM",UPDATE_PAGE_MARGINS:"UPDATE_PAGE_MARGINS",RECORD_OPERATION:"RECORD_OPERATION",UNDO:"UNDO",REDO:"REDO",CLEAR_UNDO_REDO:"CLEAR_UNDO_REDO"},gt=(e,t)=>{const r=new Date().toISOString();switch(t.type){case q.INITIALIZE_DOCUMENT:{const{initialContent:n=Te,pageSize:a=Se}=t.payload||{},s={...ke(0,a),content:ze(n)};return pt({title:e.title,pageSize:a,pages:[s]})}case q.UPDATE_TITLE:return{...e,title:t.payload,updatedAt:r};case q.UPDATE_PAGE_CONTENT:{const{pageIndex:n,content:a}=t.payload;if(n<0||n>=e.pages.length)return e;const s=[...e.pages];return s[n]={...s[n],content:ze(a)},{...e,pages:s,updatedAt:r}}case q.UPDATE_PAGES:{const n=Array.isArray(t.payload)?{pages:t.payload}:t.payload||{},a=Gt(n.pages||[],e.pageSize),s=Array.isArray(n.pageBreaks)?n.pageBreaks:$e(a);return{...e,pages:a,activePage:Math.min(e.activePage,a.length-1),pageBreaks:s,totalPages:a.length,updatedAt:r}}case q.ADD_PAGE:{const n=typeof t.payload?.index=="number"?Math.min(Math.max(t.payload.index,0),e.pages.length):e.pages.length,a=[...e.pages];a.splice(n,0,ke(n,e.pageSize));const s=a.map((i,g)=>({...i,index:g,size:e.pageSize})),o=$e(s);return{...e,pages:s,activePage:n,pageBreaks:o,totalPages:s.length,updatedAt:r}}case q.DELETE_PAGE:{const n=t.payload;if(e.pages.length<=1)return e;const a=[...e.pages];a.splice(n,1);const s=a.map((g,l)=>({...g,index:l,size:e.pageSize}));let o=e.activePage;o>=s.length?o=s.length-1:n<=o&&o>0&&(o-=1);const i=$e(s);return{...e,pages:s,activePage:o,pageBreaks:i,totalPages:s.length,updatedAt:r}}case q.SET_ACTIVE_PAGE:{const n=t.payload;if(n===e.activePage)return e;const a=e.editorMode==="continuous"?e.pageBoundaries.length:e.pages.length;return n<0||n>=a?e:{...e,activePage:n,updatedAt:r}}case q.UPDATE_PAGE_SIZE:{const n=t.payload;if(n===e.pageSize)return e;try{je(n)}catch{return console.warn(`Invalid page size: ${n}`),e}const a=e.pages.map((o,i)=>({...o,index:i,size:n})),s=$e(a);return{...e,pageSize:n,pages:a,pageBreaks:s,updatedAt:r}}case q.RESET_DOCUMENT:return pt();case q.UPDATE_CONTINUOUS_CONTENT:{const n=ze(t.payload);return n===e.continuousContent?e:{...e,continuousContent:n,updatedAt:r}}case q.UPDATE_PAGE_BOUNDARIES:{const n=Array.isArray(t.payload)?t.payload:[];if(n.length===e.pageBoundaries.length&&n.length>0&&n[0].id===e.pageBoundaries[0]?.id&&n[n.length-1].id===e.pageBoundaries[n.length-1]?.id)return e;const a=e.activePage>=n.length?Math.max(0,n.length-1):e.activePage;return{...e,pageBoundaries:n,totalPages:n.length,activePage:a,updatedAt:r}}case q.ADD_PAGE_BREAK:{const{position:n="end",pageIndex:a}=t.payload||{},s='<page-break data-page-break="true" style="display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;"></page-break>';let o=e.continuousContent;if(n==="end")o=o+s+"<p><br></p>";else if(typeof n=="number"){const i=o.substring(0,n),g=o.substring(n);o=i+s+g}else if(typeof a=="number"&&typeof document<"u"){const i=document.createElement("div");i.innerHTML=o;const g=i.querySelectorAll('page-break, [data-page-break="true"]');if(a===0&&g.length===0)o=o+s+"<p><br></p>";else if(a<g.length){const l=g[a],f=document.createElement("page-break");f.setAttribute("data-page-break","true"),f.setAttribute("style","display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;");const c=document.createElement("p");c.innerHTML="<br>",l.parentNode.insertBefore(f,l.nextSibling),f.parentNode.insertBefore(c,f.nextSibling),o=i.innerHTML}else o=o+s+"<p><br></p>"}return{...e,continuousContent:o,updatedAt:r}}case q.REMOVE_PAGE_BREAK:{const{pageIndex:n}=t.payload||{};if(typeof n!="number"||typeof document>"u")return e;const a=document.createElement("div");a.innerHTML=e.continuousContent;const s=a.querySelectorAll('page-break, [data-page-break="true"]');return s[n]&&s[n].remove(),a.querySelectorAll('page-break, [data-page-break="true"]').forEach((i,g)=>{i.setAttribute("data-page-number",String(g+2))}),{...e,continuousContent:a.innerHTML,updatedAt:r}}case q.SET_EDITOR_MODE:{const n=t.payload;if(n===e.editorMode)return e;let a=e.continuousContent,s=e.pages;return n==="continuous"?a=e.pages.map(i=>i.content).filter(i=>i&&i!==Te).join(`
`)||Te:e.continuousContent&&e.continuousContent!==Te&&(s=[{...ke(0,e.pageSize),content:e.continuousContent}]),{...e,editorMode:n,continuousContent:a,pages:s,updatedAt:r}}case q.SET_ZOOM_LEVEL:{const n=t.payload;return n<ct||n>lt?(console.warn(`Invalid zoom level: ${n}. Must be between ${ct} and ${lt}.`),e):n===e.zoomLevel?e:{...e,zoomLevel:n,updatedAt:r}}case q.ZOOM_IN:{if(!ut(e.zoomLevel))return e;const n=e.zoomLevel+Ft;return{...e,zoomLevel:n,updatedAt:r}}case q.ZOOM_OUT:{if(!dt(e.zoomLevel))return e;const n=e.zoomLevel-Ft;return{...e,zoomLevel:n,updatedAt:r}}case q.RESET_ZOOM:return e.zoomLevel===it?e:{...e,zoomLevel:it,updatedAt:r};case q.UPDATE_PAGE_MARGINS:{const n=t.payload;return n===e.pageMargins?e:{...e,pageMargins:n,updatedAt:r}}case q.RECORD_OPERATION:{const{operation:n,inverseOperation:a}=t.payload;return{...e,undoStack:[...e.undoStack,{operation:n,inverseOperation:a}],redoStack:[],canUndo:!0,canRedo:!1,updatedAt:r}}case q.UNDO:{if(e.undoStack.length===0)return e;const n=e.undoStack[e.undoStack.length-1],a=e.undoStack.slice(0,-1);let s=e;return n.inverseOperation&&(s=gt(e,n.inverseOperation)),{...s,undoStack:a,redoStack:[...e.redoStack,n],canUndo:a.length>0,canRedo:!0,updatedAt:r}}case q.REDO:{if(e.redoStack.length===0)return e;const n=e.redoStack[e.redoStack.length-1],a=e.redoStack.slice(0,-1);let s=e;return n.operation&&(s=gt(e,n.operation)),{...s,undoStack:[...e.undoStack,n],redoStack:a,canUndo:!0,canRedo:a.length>0,updatedAt:r}}case q.CLEAR_UNDO_REDO:return{...e,undoStack:[],redoStack:[],canUndo:!1,canRedo:!1,updatedAt:r};default:return e}},qt=d.createContext(null),yr=({children:e,initialState:t={}})=>{const[r,n]=d.useReducer(gt,pt(t)),a=d.useMemo(()=>({initializeDocument:o=>n({type:q.INITIALIZE_DOCUMENT,payload:o}),updateTitle:o=>n({type:q.UPDATE_TITLE,payload:o}),updatePageContent:o=>n({type:q.UPDATE_PAGE_CONTENT,payload:o}),updatePages:o=>n({type:q.UPDATE_PAGES,payload:o}),addPage:o=>n({type:q.ADD_PAGE,payload:o}),deletePage:o=>n({type:q.DELETE_PAGE,payload:o}),setActivePage:o=>n({type:q.SET_ACTIVE_PAGE,payload:o}),updatePageSize:o=>n({type:q.UPDATE_PAGE_SIZE,payload:o}),resetDocument:()=>n({type:q.RESET_DOCUMENT}),updateContinuousContent:o=>n({type:q.UPDATE_CONTINUOUS_CONTENT,payload:o}),updatePageBoundaries:o=>n({type:q.UPDATE_PAGE_BOUNDARIES,payload:o}),addPageBreak:o=>n({type:q.ADD_PAGE_BREAK,payload:o}),removePageBreak:o=>n({type:q.REMOVE_PAGE_BREAK,payload:o}),setEditorMode:o=>n({type:q.SET_EDITOR_MODE,payload:o}),setZoomLevel:o=>n({type:q.SET_ZOOM_LEVEL,payload:o}),zoomIn:()=>n({type:q.ZOOM_IN}),zoomOut:()=>n({type:q.ZOOM_OUT}),resetZoom:()=>n({type:q.RESET_ZOOM}),updatePageMargins:o=>n({type:q.UPDATE_PAGE_MARGINS,payload:o}),recordOperation:(o,i)=>n({type:q.RECORD_OPERATION,payload:{operation:o,inverseOperation:i}}),undo:()=>n({type:q.UNDO}),redo:()=>n({type:q.REDO}),clearUndoRedo:()=>n({type:q.CLEAR_UNDO_REDO})}),[]),s=d.useMemo(()=>({state:r,actions:a,dispatch:n}),[r,a]);return m.jsx(qt.Provider,{value:s,children:e})},ht=()=>{const e=d.useContext(qt);if(!e)throw new Error("useDocument must be used within a DocumentProvider");return e},mt=()=>{const{state:e}=ht();return e},ge=()=>{const{actions:e}=ht();return e};var Ue={exports:{}},Fe={exports:{}},te={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zt;function br(){if(Zt)return te;Zt=1;var e=typeof Symbol=="function"&&Symbol.for,t=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,n=e?Symbol.for("react.fragment"):60107,a=e?Symbol.for("react.strict_mode"):60108,s=e?Symbol.for("react.profiler"):60114,o=e?Symbol.for("react.provider"):60109,i=e?Symbol.for("react.context"):60110,g=e?Symbol.for("react.async_mode"):60111,l=e?Symbol.for("react.concurrent_mode"):60111,f=e?Symbol.for("react.forward_ref"):60112,c=e?Symbol.for("react.suspense"):60113,u=e?Symbol.for("react.suspense_list"):60120,w=e?Symbol.for("react.memo"):60115,v=e?Symbol.for("react.lazy"):60116,x=e?Symbol.for("react.block"):60121,k=e?Symbol.for("react.fundamental"):60117,M=e?Symbol.for("react.responder"):60118,z=e?Symbol.for("react.scope"):60119;function N(h){if(typeof h=="object"&&h!==null){var y=h.$$typeof;switch(y){case t:switch(h=h.type,h){case g:case l:case n:case s:case a:case c:return h;default:switch(h=h&&h.$$typeof,h){case i:case f:case v:case w:case o:return h;default:return y}}case r:return y}}}function b(h){return N(h)===l}return te.AsyncMode=g,te.ConcurrentMode=l,te.ContextConsumer=i,te.ContextProvider=o,te.Element=t,te.ForwardRef=f,te.Fragment=n,te.Lazy=v,te.Memo=w,te.Portal=r,te.Profiler=s,te.StrictMode=a,te.Suspense=c,te.isAsyncMode=function(h){return b(h)||N(h)===g},te.isConcurrentMode=b,te.isContextConsumer=function(h){return N(h)===i},te.isContextProvider=function(h){return N(h)===o},te.isElement=function(h){return typeof h=="object"&&h!==null&&h.$$typeof===t},te.isForwardRef=function(h){return N(h)===f},te.isFragment=function(h){return N(h)===n},te.isLazy=function(h){return N(h)===v},te.isMemo=function(h){return N(h)===w},te.isPortal=function(h){return N(h)===r},te.isProfiler=function(h){return N(h)===s},te.isStrictMode=function(h){return N(h)===a},te.isSuspense=function(h){return N(h)===c},te.isValidElementType=function(h){return typeof h=="string"||typeof h=="function"||h===n||h===l||h===s||h===a||h===c||h===u||typeof h=="object"&&h!==null&&(h.$$typeof===v||h.$$typeof===w||h.$$typeof===o||h.$$typeof===i||h.$$typeof===f||h.$$typeof===k||h.$$typeof===M||h.$$typeof===z||h.$$typeof===x)},te.typeOf=N,te}var ne={};/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yt;function Er(){return Yt||(Yt=1,process.env.NODE_ENV!=="production"&&(function(){var e=typeof Symbol=="function"&&Symbol.for,t=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,n=e?Symbol.for("react.fragment"):60107,a=e?Symbol.for("react.strict_mode"):60108,s=e?Symbol.for("react.profiler"):60114,o=e?Symbol.for("react.provider"):60109,i=e?Symbol.for("react.context"):60110,g=e?Symbol.for("react.async_mode"):60111,l=e?Symbol.for("react.concurrent_mode"):60111,f=e?Symbol.for("react.forward_ref"):60112,c=e?Symbol.for("react.suspense"):60113,u=e?Symbol.for("react.suspense_list"):60120,w=e?Symbol.for("react.memo"):60115,v=e?Symbol.for("react.lazy"):60116,x=e?Symbol.for("react.block"):60121,k=e?Symbol.for("react.fundamental"):60117,M=e?Symbol.for("react.responder"):60118,z=e?Symbol.for("react.scope"):60119;function N(H){return typeof H=="string"||typeof H=="function"||H===n||H===l||H===s||H===a||H===c||H===u||typeof H=="object"&&H!==null&&(H.$$typeof===v||H.$$typeof===w||H.$$typeof===o||H.$$typeof===i||H.$$typeof===f||H.$$typeof===k||H.$$typeof===M||H.$$typeof===z||H.$$typeof===x)}function b(H){if(typeof H=="object"&&H!==null){var le=H.$$typeof;switch(le){case t:var ue=H.type;switch(ue){case g:case l:case n:case s:case a:case c:return ue;default:var xe=ue&&ue.$$typeof;switch(xe){case i:case f:case v:case w:case o:return xe;default:return le}}case r:return le}}}var h=g,y=l,R=i,O=o,B=t,_=f,C=n,D=v,E=w,L=r,V=s,Z=a,ee=c,oe=!1;function re(H){return oe||(oe=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),A(H)||b(H)===g}function A(H){return b(H)===l}function p(H){return b(H)===i}function S(H){return b(H)===o}function j(H){return typeof H=="object"&&H!==null&&H.$$typeof===t}function I(H){return b(H)===f}function G(H){return b(H)===n}function W(H){return b(H)===v}function $(H){return b(H)===w}function Y(H){return b(H)===r}function X(H){return b(H)===s}function K(H){return b(H)===a}function ie(H){return b(H)===c}ne.AsyncMode=h,ne.ConcurrentMode=y,ne.ContextConsumer=R,ne.ContextProvider=O,ne.Element=B,ne.ForwardRef=_,ne.Fragment=C,ne.Lazy=D,ne.Memo=E,ne.Portal=L,ne.Profiler=V,ne.StrictMode=Z,ne.Suspense=ee,ne.isAsyncMode=re,ne.isConcurrentMode=A,ne.isContextConsumer=p,ne.isContextProvider=S,ne.isElement=j,ne.isForwardRef=I,ne.isFragment=G,ne.isLazy=W,ne.isMemo=$,ne.isPortal=Y,ne.isProfiler=X,ne.isStrictMode=K,ne.isSuspense=ie,ne.isValidElementType=N,ne.typeOf=b})()),ne}var Vt;function Kt(){return Vt||(Vt=1,process.env.NODE_ENV==="production"?Fe.exports=br():Fe.exports=Er()),Fe.exports}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var yt,Xt;function Tr(){if(Xt)return yt;Xt=1;var e=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function n(s){if(s==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(s)}function a(){try{if(!Object.assign)return!1;var s=new String("abc");if(s[5]="de",Object.getOwnPropertyNames(s)[0]==="5")return!1;for(var o={},i=0;i<10;i++)o["_"+String.fromCharCode(i)]=i;var g=Object.getOwnPropertyNames(o).map(function(f){return o[f]});if(g.join("")!=="0123456789")return!1;var l={};return"abcdefghijklmnopqrst".split("").forEach(function(f){l[f]=f}),Object.keys(Object.assign({},l)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return yt=a()?Object.assign:function(s,o){for(var i,g=n(s),l,f=1;f<arguments.length;f++){i=Object(arguments[f]);for(var c in i)t.call(i,c)&&(g[c]=i[c]);if(e){l=e(i);for(var u=0;u<l.length;u++)r.call(i,l[u])&&(g[l[u]]=i[l[u]])}}return g},yt}var bt,Jt;function Et(){if(Jt)return bt;Jt=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return bt=e,bt}var Tt,Qt;function en(){return Qt||(Qt=1,Tt=Function.call.bind(Object.prototype.hasOwnProperty)),Tt}var vt,tn;function vr(){if(tn)return vt;tn=1;var e=function(){};if(process.env.NODE_ENV!=="production"){var t=Et(),r={},n=en();e=function(s){var o="Warning: "+s;typeof console<"u"&&console.error(o);try{throw new Error(o)}catch{}}}function a(s,o,i,g,l){if(process.env.NODE_ENV!=="production"){for(var f in s)if(n(s,f)){var c;try{if(typeof s[f]!="function"){var u=Error((g||"React class")+": "+i+" type `"+f+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof s[f]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw u.name="Invariant Violation",u}c=s[f](o,f,g,i,null,t)}catch(v){c=v}if(c&&!(c instanceof Error)&&e((g||"React class")+": type specification of "+i+" `"+f+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof c+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),c instanceof Error&&!(c.message in r)){r[c.message]=!0;var w=l?l():"";e("Failed "+i+" type: "+c.message+(w??""))}}}}return a.resetWarningCache=function(){process.env.NODE_ENV!=="production"&&(r={})},vt=a,vt}var wt,nn;function wr(){if(nn)return wt;nn=1;var e=Kt(),t=Tr(),r=Et(),n=en(),a=vr(),s=function(){};process.env.NODE_ENV!=="production"&&(s=function(i){var g="Warning: "+i;typeof console<"u"&&console.error(g);try{throw new Error(g)}catch{}});function o(){return null}return wt=function(i,g){var l=typeof Symbol=="function"&&Symbol.iterator,f="@@iterator";function c(A){var p=A&&(l&&A[l]||A[f]);if(typeof p=="function")return p}var u="<<anonymous>>",w={array:M("array"),bigint:M("bigint"),bool:M("boolean"),func:M("function"),number:M("number"),object:M("object"),string:M("string"),symbol:M("symbol"),any:z(),arrayOf:N,element:b(),elementType:h(),instanceOf:y,node:_(),objectOf:O,oneOf:R,oneOfType:B,shape:D,exact:E};function v(A,p){return A===p?A!==0||1/A===1/p:A!==A&&p!==p}function x(A,p){this.message=A,this.data=p&&typeof p=="object"?p:{},this.stack=""}x.prototype=Error.prototype;function k(A){if(process.env.NODE_ENV!=="production")var p={},S=0;function j(G,W,$,Y,X,K,ie){if(Y=Y||u,K=K||$,ie!==r){if(g){var H=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw H.name="Invariant Violation",H}else if(process.env.NODE_ENV!=="production"&&typeof console<"u"){var le=Y+":"+$;!p[le]&&S<3&&(s("You are manually calling a React.PropTypes validation function for the `"+K+"` prop on `"+Y+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),p[le]=!0,S++)}}return W[$]==null?G?W[$]===null?new x("The "+X+" `"+K+"` is marked as required "+("in `"+Y+"`, but its value is `null`.")):new x("The "+X+" `"+K+"` is marked as required in "+("`"+Y+"`, but its value is `undefined`.")):null:A(W,$,Y,X,K)}var I=j.bind(null,!1);return I.isRequired=j.bind(null,!0),I}function M(A){function p(S,j,I,G,W,$){var Y=S[j],X=Z(Y);if(X!==A){var K=ee(Y);return new x("Invalid "+G+" `"+W+"` of type "+("`"+K+"` supplied to `"+I+"`, expected ")+("`"+A+"`."),{expectedType:A})}return null}return k(p)}function z(){return k(o)}function N(A){function p(S,j,I,G,W){if(typeof A!="function")return new x("Property `"+W+"` of component `"+I+"` has invalid PropType notation inside arrayOf.");var $=S[j];if(!Array.isArray($)){var Y=Z($);return new x("Invalid "+G+" `"+W+"` of type "+("`"+Y+"` supplied to `"+I+"`, expected an array."))}for(var X=0;X<$.length;X++){var K=A($,X,I,G,W+"["+X+"]",r);if(K instanceof Error)return K}return null}return k(p)}function b(){function A(p,S,j,I,G){var W=p[S];if(!i(W)){var $=Z(W);return new x("Invalid "+I+" `"+G+"` of type "+("`"+$+"` supplied to `"+j+"`, expected a single ReactElement."))}return null}return k(A)}function h(){function A(p,S,j,I,G){var W=p[S];if(!e.isValidElementType(W)){var $=Z(W);return new x("Invalid "+I+" `"+G+"` of type "+("`"+$+"` supplied to `"+j+"`, expected a single ReactElement type."))}return null}return k(A)}function y(A){function p(S,j,I,G,W){if(!(S[j]instanceof A)){var $=A.name||u,Y=re(S[j]);return new x("Invalid "+G+" `"+W+"` of type "+("`"+Y+"` supplied to `"+I+"`, expected ")+("instance of `"+$+"`."))}return null}return k(p)}function R(A){if(!Array.isArray(A))return process.env.NODE_ENV!=="production"&&(arguments.length>1?s("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):s("Invalid argument supplied to oneOf, expected an array.")),o;function p(S,j,I,G,W){for(var $=S[j],Y=0;Y<A.length;Y++)if(v($,A[Y]))return null;var X=JSON.stringify(A,function(ie,H){var le=ee(H);return le==="symbol"?String(H):H});return new x("Invalid "+G+" `"+W+"` of value `"+String($)+"` "+("supplied to `"+I+"`, expected one of "+X+"."))}return k(p)}function O(A){function p(S,j,I,G,W){if(typeof A!="function")return new x("Property `"+W+"` of component `"+I+"` has invalid PropType notation inside objectOf.");var $=S[j],Y=Z($);if(Y!=="object")return new x("Invalid "+G+" `"+W+"` of type "+("`"+Y+"` supplied to `"+I+"`, expected an object."));for(var X in $)if(n($,X)){var K=A($,X,I,G,W+"."+X,r);if(K instanceof Error)return K}return null}return k(p)}function B(A){if(!Array.isArray(A))return process.env.NODE_ENV!=="production"&&s("Invalid argument supplied to oneOfType, expected an instance of array."),o;for(var p=0;p<A.length;p++){var S=A[p];if(typeof S!="function")return s("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+oe(S)+" at index "+p+"."),o}function j(I,G,W,$,Y){for(var X=[],K=0;K<A.length;K++){var ie=A[K],H=ie(I,G,W,$,Y,r);if(H==null)return null;H.data&&n(H.data,"expectedType")&&X.push(H.data.expectedType)}var le=X.length>0?", expected one of type ["+X.join(", ")+"]":"";return new x("Invalid "+$+" `"+Y+"` supplied to "+("`"+W+"`"+le+"."))}return k(j)}function _(){function A(p,S,j,I,G){return L(p[S])?null:new x("Invalid "+I+" `"+G+"` supplied to "+("`"+j+"`, expected a ReactNode."))}return k(A)}function C(A,p,S,j,I){return new x((A||"React class")+": "+p+" type `"+S+"."+j+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+I+"`.")}function D(A){function p(S,j,I,G,W){var $=S[j],Y=Z($);if(Y!=="object")return new x("Invalid "+G+" `"+W+"` of type `"+Y+"` "+("supplied to `"+I+"`, expected `object`."));for(var X in A){var K=A[X];if(typeof K!="function")return C(I,G,W,X,ee(K));var ie=K($,X,I,G,W+"."+X,r);if(ie)return ie}return null}return k(p)}function E(A){function p(S,j,I,G,W){var $=S[j],Y=Z($);if(Y!=="object")return new x("Invalid "+G+" `"+W+"` of type `"+Y+"` "+("supplied to `"+I+"`, expected `object`."));var X=t({},S[j],A);for(var K in X){var ie=A[K];if(n(A,K)&&typeof ie!="function")return C(I,G,W,K,ee(ie));if(!ie)return new x("Invalid "+G+" `"+W+"` key `"+K+"` supplied to `"+I+"`.\nBad object: "+JSON.stringify(S[j],null,"  ")+`
Valid keys: `+JSON.stringify(Object.keys(A),null,"  "));var H=ie($,K,I,G,W+"."+K,r);if(H)return H}return null}return k(p)}function L(A){switch(typeof A){case"number":case"string":case"undefined":return!0;case"boolean":return!A;case"object":if(Array.isArray(A))return A.every(L);if(A===null||i(A))return!0;var p=c(A);if(p){var S=p.call(A),j;if(p!==A.entries){for(;!(j=S.next()).done;)if(!L(j.value))return!1}else for(;!(j=S.next()).done;){var I=j.value;if(I&&!L(I[1]))return!1}}else return!1;return!0;default:return!1}}function V(A,p){return A==="symbol"?!0:p?p["@@toStringTag"]==="Symbol"||typeof Symbol=="function"&&p instanceof Symbol:!1}function Z(A){var p=typeof A;return Array.isArray(A)?"array":A instanceof RegExp?"object":V(p,A)?"symbol":p}function ee(A){if(typeof A>"u"||A===null)return""+A;var p=Z(A);if(p==="object"){if(A instanceof Date)return"date";if(A instanceof RegExp)return"regexp"}return p}function oe(A){var p=ee(A);switch(p){case"array":case"object":return"an "+p;case"boolean":case"date":case"regexp":return"a "+p;default:return p}}function re(A){return!A.constructor||!A.constructor.name?u:A.constructor.name}return w.checkPropTypes=a,w.resetWarningCache=a.resetWarningCache,w.PropTypes=w,w},wt}var xt,rn;function xr(){if(rn)return xt;rn=1;var e=Et();function t(){}function r(){}return r.resetWarningCache=t,xt=function(){function n(o,i,g,l,f,c){if(c!==e){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}n.isRequired=n;function a(){return n}var s={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:a,element:n,elementType:n,instanceOf:a,node:n,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:r,resetWarningCache:t};return s.PropTypes=s,s},xt}var on;function Cr(){if(on)return Ue.exports;if(on=1,process.env.NODE_ENV!=="production"){var e=Kt(),t=!0;Ue.exports=wr()(e.isElement,t)}else Ue.exports=xr()();return Ue.exports}var Ar=Cr();const T=sr(Ar),Ct={"7.5pt":{pt:7.5,px:10,label:"7.5"},"9pt":{pt:9,px:12,label:"9"},"10pt":{pt:10,px:13,label:"10"},"11pt":{pt:11,px:15,label:"11"},"12pt":{pt:12,px:16,label:"12"},"14pt":{pt:14,px:19,label:"14"},"16pt":{pt:16,px:21,label:"16"},"18pt":{pt:18,px:24,label:"18"},"20pt":{pt:20,px:27,label:"20"},"22pt":{pt:22,px:29,label:"22"},"24pt":{pt:24,px:32,label:"24"},"26pt":{pt:26,px:35,label:"26"},"28pt":{pt:28,px:37,label:"28"},"36pt":{pt:36,px:48,label:"36"},"48pt":{pt:48,px:64,label:"48"},"72pt":{pt:72,px:96,label:"72"}},sn=[{value:"10px",label:"7.5",pt:7.5},{value:"12px",label:"9",pt:9},{value:"13px",label:"10",pt:10},{value:"15px",label:"11",pt:11},{value:"16px",label:"12",pt:12},{value:"19px",label:"14",pt:14},{value:"21px",label:"16",pt:16},{value:"24px",label:"18",pt:18},{value:"27px",label:"20",pt:20},{value:"32px",label:"24",pt:24},{value:"37px",label:"28",pt:28},{value:"48px",label:"36",pt:36},{value:"64px",label:"48",pt:48},{value:"96px",label:"72",pt:72}],Oe="16px",an=e=>Math.round(e*96/72),cn=e=>Math.round(e*72/96*2)/2,_r=e=>{const t=Object.values(Ct).find(r=>r.pt===e);return t?`${t.px}px`:`${an(e)}px`},Sr=e=>{const t=parseInt(e),r=Object.values(Ct).find(n=>n.px===t);return r?r.pt:cn(t)},kr=e=>{if(!e)return!1;if(e.endsWith("px")){const t=parseInt(e);return t>=8&&t<=144}if(e.endsWith("pt")){const t=parseFloat(e);return t>=6&&t<=108}return!1},Or={"10px":"1","12px":"2","13px":"2","15px":"3","16px":"3","19px":"4","21px":"4","24px":"5","27px":"5","32px":"6","37px":"6","48px":"6","64px":"7","96px":"7"},ln={bold:!1,italic:!1,underline:!1,strikethrough:!1,alignLeft:!1,alignCenter:!1,alignRight:!1,alignJustify:!1,fontFamily:"Arial",fontSize:Oe,headingLevel:"p"},un=()=>{const[e,t]=d.useState(ln),r=ge(),n=d.useCallback((c,u,w=null)=>{try{const v=window.getSelection();if(!v||v.rangeCount===0)return!1;const x=v.getRangeAt(0);if(!x.toString())return t(M=>({...M,[c]:u})),!1;try{const M=document.createElement("span");M.style[c]=u;const z=x.extractContents();return M.appendChild(z),x.insertNode(M),x.selectNodeContents(M),v.removeAllRanges(),v.addRange(x),t(N=>({...N,[c]:u})),!0}catch{if(w){const M=c==="fontSize"?Or[u]||"3":u;return document.execCommand(w,!1,M),t(z=>({...z,[c]:u})),!0}return!1}}catch(v){return console.warn(`[useFormatting] Style application failed for ${c}:`,v),!1}},[]),a=d.useCallback(c=>n("fontFamily",c,"fontName"),[n]),s=d.useCallback(c=>n("fontSize",c,"fontSize"),[n]),o=d.useCallback(c=>{t(u=>({...u,alignLeft:c==="left",alignCenter:c==="center",alignRight:c==="right",alignJustify:c==="justify"}))},[]),i=d.useCallback(c=>{try{const u=window.getSelection();if(!u||u.rangeCount===0)return!1;const w=u.getRangeAt(0),v=w.toString(),k={justifyLeft:"left",justifyCenter:"center",justifyRight:"right",justifyFull:"justify"}[c];if(!k)return!1;if(!v){const z=w.startContainer,N=z.nodeType===Node.TEXT_NODE?z.parentElement:z,b=We(N)||Nr();return b&&(b.style.textAlign=k,o(k)),!0}const M=Pr(w);if(M.length===0){const z=document.createElement("p");z.style.textAlign=k;const N=w.extractContents();z.appendChild(N),w.insertNode(z),w.selectNodeContents(z),u.removeAllRanges(),u.addRange(w)}else M.forEach(z=>{z.style.textAlign=k});return o(k),!0}catch(u){return console.warn("[useFormatting] Text alignment failed:",u),!1}},[o]),g=d.useCallback((c,u=null)=>{try{if(c==="undo"){r.undo();return}if(c==="redo"){r.redo();return}if(typeof document.execCommand!="function"){console.warn("[useFormatting] execCommand not supported");return}if(c==="fontSize"){s(u);return}if(c==="fontName"){a(u);return}if(["justifyLeft","justifyCenter","justifyRight","justifyFull"].includes(c)){i(c);return}switch(document.execCommand(c,!1,u)||console.warn(`[useFormatting] Command "${c}" failed`),c){case"bold":case"italic":case"underline":case"strikethrough":case"justifyLeft":case"justifyCenter":case"justifyRight":case"justifyFull":case"fontName":break;case"formatBlock":t(v=>({...v,headingLevel:u}));break;default:break}}catch(w){console.warn(`[useFormatting] Error executing command "${c}":`,w)}},[s,a,i,r]),l=d.useCallback(()=>{try{const c=window.getSelection();if(!c||c.rangeCount===0)return;const u=c.getRangeAt(0),w=u.toString();let v=Oe,x="Arial",k="p",M="left";if(w){const N=u.startContainer,b=N.nodeType===Node.TEXT_NODE?N.parentElement:N;if(b){const h=window.getComputedStyle(b),y=h.fontSize,R=h.fontFamily;y&&y.endsWith("px")&&(v=y),R&&R!=="serif"&&(x=R.split(",")[0].replace(/['"]/g,"").trim());const O=We(b);if(O){const B=O.tagName?.toLowerCase();["h1","h2","h3","h4","h5","h6","p"].includes(B)&&(k=B);const C=window.getComputedStyle(O).textAlign;["left","center","right","justify"].includes(C)&&(M=C)}}}const z={bold:document.queryCommandState("bold"),italic:document.queryCommandState("italic"),underline:document.queryCommandState("underline"),strikethrough:document.queryCommandState("strikethrough"),alignLeft:M==="left",alignCenter:M==="center",alignRight:M==="right",alignJustify:M==="justify",fontFamily:x,fontSize:v,headingLevel:k};t(N=>({...N,...z}))}catch(c){console.warn("[useFormatting] Error updating format from selection:",c)}},[]),f=d.useCallback(()=>{t(ln)},[]);return{currentFormat:e,formatText:g,resetFormat:f,updateCurrentFormatFromSelection:l}};function We(e){let t=e;for(;t&&t!==document.body;){const r=t.tagName?.toLowerCase();if(["h1","h2","h3","h4","h5","h6","p"].includes(r))return t;if(t.contentEditable==="true"||t.contentEditable==="")break;t=t.parentElement}return null}function Pr(e){const t=[],r=e.startContainer,n=e.endContainer,a=We(r.nodeType===Node.TEXT_NODE?r.parentElement:r),s=We(n.nodeType===Node.TEXT_NODE?n.parentElement:n);if(a===s&&a)return[a];const o=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_ELEMENT,{acceptNode:g=>{const l=g.tagName?.toLowerCase();return["h1","h2","h3","h4","h5","h6","p"].includes(l)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});let i=o.nextNode();for(;i;)e.intersectsNode(i)&&t.push(i),i=o.nextNode();return t}function Nr(){try{const e=window.getSelection();if(!e||e.rangeCount===0)return null;const t=e.getRangeAt(0),r=document.createElement("p");return r.innerHTML="<br>",t.insertNode(r),t.selectNodeContents(r),t.collapse(!0),e.removeAllRanges(),e.addRange(t),r}catch(e){return console.warn("[useFormatting] Failed to create paragraph at cursor:",e),null}}const me='page-break, [data-page-break="true"]',dn=e=>Ee[e]||Ee.A4,Mr=(e,t={})=>{if(!e||typeof document>"u")return[];const r=t.pageSize||"A4",n=dn(r),a=e.querySelectorAll(me),s=[];s.push({id:"page-0",pageNumber:1,top:0,height:n.height});const o=e.getBoundingClientRect(),i=e.scrollTop;return a.forEach((g,l)=>{const c=g.getBoundingClientRect().top-o.top+i;s.push({id:`page-${l+1}`,pageNumber:l+2,top:c,height:n.height})}),s},fn=(e,t=100,r=pe)=>{const n=dn(e),a=ur(r),s=n.height-a,o=t/100;return s/o},Rr=(e,t)=>{if(!e||!t)return 0;try{const r=t.querySelectorAll(me);if(r.length===0)return 0;const n=e.getBoundingClientRect(),a=n.top+n.height/2;for(let s=r.length-1;s>=0;s--)if(r[s].getBoundingClientRect().top<a)return s+1;return 0}catch(r){return console.warn("[getCurrentPage] Failed to calculate page:",r),0}},pn=e=>{if(!e)return[];const t=Array.from(e.children);if(t.length===0)return[];let r=[],n=[];for(const a of t)a.tagName==="PAGE-BREAK"||a.getAttribute("data-page-break")==="true"?n.length>0&&(r.push(n),n=[]):n.push(a);return n.length>0&&r.push(n),r.length===0&&t.length>0&&r.push(t.filter(a=>!(a.tagName==="PAGE-BREAK"||a.getAttribute("data-page-break")==="true"))),r},Lr=e=>{if(!e||!e.getBoundingClientRect)return 0;const t=e.getBoundingClientRect();if(e.tagName==="P"){const r=e.querySelectorAll("img"),n=e.textContent.trim();if(r.length===1&&!n){const s=r[0].getBoundingClientRect(),i=window.getComputedStyle(e).textAlign;if(i==="center"||i==="-webkit-center")return s.height+16}return t.height+16}return e.tagName==="H1"||e.tagName==="H2"||e.tagName==="H3"||e.tagName==="H4"||e.tagName==="H5"||e.tagName==="H6"?t.height+20:e.tagName==="UL"||e.tagName==="OL"?t.height+16:t.height},Ir=(e,t)=>{if(!e)return!1;try{const r=document.createElement("page-break");return r.setAttribute("data-page-break","true"),r.setAttribute("contenteditable","false"),r.setAttribute("data-page-number",t||"2"),e.parentNode.insertBefore(r,e),!0}catch(r){return console.warn("[insertPageBreakBefore] Failed to insert page break:",r),!1}},Dr=(e,t,r,n,a,s,o)=>{if(!e)return!1;try{const g=fn(r,n,a)*(t-1),l=Array.from(e.children);let f=0,c=null;for(let u=0;u<l.length;u++){const w=l[u];if(w.tagName==="PAGE-BREAK"||w.getAttribute("data-page-break")==="true")continue;const v=Lr(w);if(f+v>g){c=w;break}f+=v}if(c){const u=document.createElement("page-break");if(u.setAttribute("data-page-break","true"),u.setAttribute("contenteditable","false"),u.setAttribute("data-page-number",String(t)),c.parentNode.insertBefore(u,c),s){const w=e.innerHTML;s(w)}return o&&setTimeout(()=>{o()},50),!0}else{const u=document.createElement("page-break");u.setAttribute("data-page-break","true"),u.setAttribute("contenteditable","false"),u.setAttribute("data-page-number",String(t)),e.appendChild(u);const w=document.createElement("p");if(w.innerHTML="<br>",e.appendChild(w),s){const v=e.innerHTML;s(v)}return o&&setTimeout(()=>{o()},50),!0}}catch(i){return console.error("[insertPageBreakAtBoundary] Failed to insert page break:",i),!1}},Hr=(e,t,r,n,a,s,o)=>{if(!e)return!1;if(r().length<=1)return console.warn("[removePageAndContent] Cannot delete the only page"),!1;try{const g=Array.from(e.querySelectorAll(me));if(t>g.length)return console.warn("[removePageAndContent] Invalid page index"),!1;const l=window.getSelection();let f=!1,c=[],u=null;if(t===0){const v=g[0];if(!v)return console.warn("[removePageAndContent] No page break found for first page"),!1;let x=e.firstChild;for(;x&&x!==v;)c.push(x),x=x.nextSibling;u=v}else{const v=g[t-1];if(!v)return console.warn("[removePageAndContent] Page break not found"),!1;const x=g[t];let k=v.nextSibling;for(;k&&k!==x;)c.push(k),k=k.nextSibling;u=v}if(l&&l.rangeCount>0){const x=l.getRangeAt(0).startContainer;for(const k of c)if(k.contains(x)||k===x){f=!0;break}}if(u&&u.parentNode&&u.remove(),c.forEach(v=>{v.parentNode&&v.remove()}),e.querySelectorAll(me).forEach((v,x)=>{v.setAttribute("data-page-number",String(x+2))}),f&&s&&setTimeout(()=>{s(0)},50),n){const v=e.innerHTML;n(v)}return a&&setTimeout(()=>{a(),o&&setTimeout(()=>{o()},150)},100),!0}catch(g){return console.error("[removePageAndContent] Failed to remove page:",g),!1}},Br=e=>{if(e)try{e.querySelectorAll(me).forEach((r,n)=>{r.setAttribute("data-page-number",String(n+2))})}catch(t){console.error("[renumberPageBreaks] Failed to renumber page breaks:",t)}},jr=(e,t,r,n,a)=>{if(!e||!t)return!1;try{if(e.remove(),Br(t),r){const s=t.innerHTML;r(s)}return n&&setTimeout(()=>{n(),a&&setTimeout(()=>{a()},100)},50),!0}catch(s){return console.error("[removePageBreak] Failed to remove page break:",s),!1}},zr=200,$r=50,gn=3,Ur=20,hn=e=>{if(!e||!e.getBoundingClientRect)return 0;const t=e.getBoundingClientRect();if(e.tagName==="P"){const r=e.querySelectorAll("img"),n=e.textContent.trim();if(r.length===1&&!n){const s=r[0].getBoundingClientRect(),i=window.getComputedStyle(e).textAlign;if(i==="center"||i==="-webkit-center")return s.height+16}return t.height+16}return e.tagName==="H1"||e.tagName==="H2"||e.tagName==="H3"||e.tagName==="H4"||e.tagName==="H5"||e.tagName==="H6"?t.height+20:e.tagName==="UL"||e.tagName==="OL"?t.height+16:t.height},Fr=(e,t)=>{if(!e||e.length===0)return null;let r=0,n=null;for(let a=0;a<e.length;a++){const s=e[a];if(!s||!s.getBoundingClientRect)continue;const o=hn(s);if(o<1)continue;if(r+o>t)return n===null?a>0?{overflowIndex:a,overflowElement:s,accumulatedHeight:r}:null:{overflowIndex:a,overflowElement:s,accumulatedHeight:r};r+=o,n=s}return null},Wr=(e,t,r,n,a,s,o,i)=>{if(!e||o.current)return!1;try{o.current=!0;const g=fn(t,r,n);let l=pn(e),f=!1,c=0;for(let u=0;u<l.length&&c<gn;u++){const w=l[u],v=Fr(w,g);if(v&&v.overflowIndex>0){let x=0;for(let N=0;N<w.length;N++){const b=w[N];b&&b.getBoundingClientRect&&(x+=hn(b))}if(x-g<Ur)continue;const M=u+2;Ir(v.overflowElement,M)&&(f=!0,c++,l=pn(e))}}if(f){if(a){const u=e.innerHTML;a(u)}setTimeout(()=>{s&&s(),c>=gn&&i&&setTimeout(()=>{o.current||i()},100)},$r)}return f}catch(g){return console.warn("[checkAndReflow] Reflow failed:",g),!1}finally{o.current=!1}},Gr=(e,t,r=zr)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{t.current=null,e()},r)},qr=400,mn=(e,t)=>{if(e){e.focus();try{let r=null,n=0;if(t===0)r=e.firstChild,n=0;else{const s=e.querySelectorAll(me)[t-1];s&&s.nextSibling&&(r=s.nextSibling,n=0)}if(r){const a=document.createRange(),s=window.getSelection();r.nodeType===Node.TEXT_NODE?a.setStart(r,n):a.setStart(r,0),a.collapse(!0),s.removeAllRanges(),s.addRange(a)}}catch(r){console.warn("[positionCursorAtPage] Failed to position cursor:",r)}}},Zr=(e,t,r,n)=>{if(!e||!t){console.warn("[scrollToPage] Missing refs");return}try{let a=null;if(r===0)a=t;else{const o=t.querySelectorAll(me)[r-1];if(o)a=o;else{console.warn("[scrollToPage] Page break not found for page",r);return}}if(a){const s=a.getBoundingClientRect(),o=e.getBoundingClientRect(),i=e.scrollTop+(s.top-o.top);e.scrollTo({top:i,behavior:"smooth"}),setTimeout(()=>{n?n(r):mn(t,r)},qr)}}catch(a){console.error("[scrollToPage] Error:",a)}},Yr=(e,t,r={},n=300)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{t.current=null,e(r)},Math.max(0,n))},Vr=e=>{if(!e)return null;const t=window.getSelection();if(t.rangeCount===0)return null;const r=t.getRangeAt(0);if(!e.contains(r.commonAncestorContainer))return null;let n=1;const a=e.querySelectorAll(me);for(const f of a)if(r.comparePoint(f,0)>0)n++;else break;const s=document.createRange();s.setStart(e,0),s.setEnd(r.startContainer,r.startOffset);const i=s.toString().replace(/<[^>]*>/g," ").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\s+/g," ").trim(),g=i.length,l=(i.match(/\n/g)||[]).length+1;return{page:n,line:l,charOffset:g}},Kr=300,yn=(e,t,r=100,n="NARROW")=>{const a=ge(),s=d.useRef(null),o=d.useRef(null),i=d.useRef(e),g=d.useRef(r),l=d.useRef(n),f=d.useRef(!1);d.useEffect(()=>{i.current=e},[e]),d.useEffect(()=>{g.current=r},[r]),d.useEffect(()=>{l.current=n},[n]),d.useEffect(()=>()=>{s.current&&clearTimeout(s.current),o.current&&clearTimeout(o.current)},[]);const c=d.useCallback((y={})=>t?.current?Mr(t.current,y):[],[t]),u=d.useCallback((y={})=>{const R=c(y);return a.updatePageBoundaries(R),R},[c,a]),w=d.useCallback((y={})=>{const R=typeof y.delay=="number"?y.delay:Kr;Yr(u,s,y,R)},[u]),v=d.useCallback(()=>{t?.current&&Wr(t.current,i.current,g.current,l.current,a.updateContinuousContent,u,f,v)},[t,a,u]),x=d.useCallback(y=>{Gr(v,o,y)},[v]),k=d.useCallback(y=>!y?.current||!t?.current?0:Rr(y.current,t.current),[t]),M=d.useCallback(y=>{t?.current&&mn(t.current,y)},[t]),z=d.useCallback((y,R)=>{if(!R?.current||!t?.current){console.warn("[scrollToPage] Missing refs");return}Zr(R.current,t.current,y,M)},[t,M]),N=d.useCallback(async y=>t?.current?Dr(t.current,y,i.current,g.current,l.current,a.updateContinuousContent,u):!1,[t,a,u]),b=d.useCallback(y=>t?.current?Hr(t.current,y,c,a.updateContinuousContent,u,M,v):!1,[t,c,a,u,M,v]),h=d.useCallback(y=>t?.current?jr(y,t.current,a.updateContinuousContent,u,v):!1,[t,a,u,v]);return d.useEffect(()=>()=>{s.current&&clearTimeout(s.current),o.current&&clearTimeout(o.current)},[]),d.useMemo(()=>({calculatePageBoundaries:c,checkAndUpdateBoundaries:w,updateBoundaries:u,getCurrentPage:k,scrollToPage:z,positionCursorAtPage:M,checkAndReflow:v,triggerAutoReflow:x,removePageAndContent:b,removePageBreak:h,insertPageBreakAtBoundary:N,boundaryTimeoutRef:s,reflowTimeoutRef:o}),[c,w,u,k,z,M,v,x,b,h,N])},ve={minWidth:50,minHeight:50,maxWidth:800,maxHeight:600,aspectRatio:!0,preserveAspectRatio:!0,defaultWidth:300,defaultHeight:200},F={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right"};function Xr({handler:e,startX:t,startY:r,currentX:n,currentY:a,startWidth:s,startHeight:o,options:i=ve}){const g=n-t,l=a-r;let f=s,c=o;switch(e){case F.TOP_LEFT:f=Math.max(i.minWidth,s-g),c=Math.max(i.minHeight,o-l);break;case F.TOP_RIGHT:f=Math.max(i.minWidth,s+g),c=Math.max(i.minHeight,o-l);break;case F.BOTTOM_LEFT:f=Math.max(i.minWidth,s-g),c=Math.max(i.minHeight,o+l);break;case F.BOTTOM_RIGHT:f=Math.max(i.minWidth,s+g),c=Math.max(i.minHeight,o+l);break;case F.TOP:c=Math.max(i.minHeight,o-l);break;case F.BOTTOM:c=Math.max(i.minHeight,o+l);break;case F.LEFT:f=Math.max(i.minWidth,s-g);break;case F.RIGHT:f=Math.max(i.minWidth,s+g);break;default:return{width:f,height:c}}if(i.preserveAspectRatio&&i.aspectRatio){const u=s/o;[F.TOP_LEFT,F.TOP_RIGHT,F.BOTTOM_LEFT,F.BOTTOM_RIGHT].includes(e)?f/u>c?c=Math.max(i.minHeight,f/u):f=Math.max(i.minWidth,c*u):[F.TOP,F.BOTTOM].includes(e)?f=c*u:[F.LEFT,F.RIGHT].includes(e)&&(c=f/u)}return i.maxWidth&&f>i.maxWidth&&(f=i.maxWidth,i.preserveAspectRatio&&i.aspectRatio&&(c=f/(s/o))),i.maxHeight&&c>i.maxHeight&&(c=i.maxHeight,i.preserveAspectRatio&&i.aspectRatio&&(f=c*(s/o))),f=Math.max(i.minWidth,f),c=Math.max(i.minHeight,c),{width:Math.round(f),height:Math.round(c)}}function he(e){return e?!!(e.tagName==="IMG"||e.tagName==="DIV"&&e.style.backgroundImage&&e.style.backgroundImage!=="none"):!1}function Jr(e){return he(e)?{width:e.offsetWidth,height:e.offsetHeight}:{width:0,height:0}}function Qr(e,{width:t,height:r}){he(e)&&(e.tagName==="IMG"?(e.style.width=`${t}px`,e.style.height=`${r}px`,e.width=t,e.height=r):e.tagName==="DIV"&&(e.style.width=`${t}px`,e.style.height=`${r}px`))}function bn(e,t=ve){if(!he(e))return null;const r=document.createElement("div");r.className="image-resize-overlay",r.style.position="fixed",r.style.zIndex="1000",r.style.pointerEvents="none";const n=e.getBoundingClientRect();return r.style.top=`${n.top}px`,r.style.left=`${n.left}px`,r.style.width=`${n.width}px`,r.style.height=`${n.height}px`,Object.values(F).forEach(s=>{const o=document.createElement("div");o.className=`resize-handler resize-handler-${s}`,o.dataset.handler=s,o.style.position="absolute",o.style.width="10px",o.style.height="10px",o.style.backgroundColor="#007bff",o.style.border="2px solid white",o.style.borderRadius="50%",o.style.boxShadow="0 0 3px rgba(0,0,0,0.3)",o.style.cursor=eo(s),o.style.pointerEvents="all",En(o,s,n.width,n.height),r.appendChild(o)}),r}function eo(e){switch(e){case F.TOP_LEFT:case F.BOTTOM_RIGHT:return"nwse-resize";case F.TOP_RIGHT:case F.BOTTOM_LEFT:return"nesw-resize";case F.TOP:case F.BOTTOM:return"ns-resize";case F.LEFT:case F.RIGHT:return"ew-resize";default:return"default"}}function En(e,t,r,n){switch(t){case F.TOP_LEFT:e.style.top="-5px",e.style.left="-5px";break;case F.TOP_RIGHT:e.style.top="-5px",e.style.right="-5px";break;case F.BOTTOM_LEFT:e.style.bottom="-5px",e.style.left="-5px";break;case F.BOTTOM_RIGHT:e.style.bottom="-5px",e.style.right="-5px";break;case F.TOP:e.style.top="-5px",e.style.left=`${r/2+-5}px`;break;case F.BOTTOM:e.style.bottom="-5px",e.style.left=`${r/2+-5}px`;break;case F.LEFT:e.style.top=`${n/2+-5}px`,e.style.left="-5px";break;case F.RIGHT:e.style.top=`${n/2+-5}px`,e.style.right="-5px";break}}function Ge(e,t){if(!e||!t)return;const r=t.getBoundingClientRect();e.style.top=`${r.top}px`,e.style.left=`${r.left}px`,e.style.width=`${r.width}px`,e.style.height=`${r.height}px`,e.querySelectorAll(".resize-handler").forEach(a=>{const s=a.dataset.handler;En(a,s,r.width,r.height)})}function qe(e){e&&e.parentNode&&e.parentNode.removeChild(e)}const to="html-editor-storage",no=1,ce="images";function ro(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function Pe(){return new Promise((e,t)=>{const r=indexedDB.open(to,no);r.onerror=()=>{t(new Error("Failed to open IndexedDB database"))},r.onsuccess=()=>{e(r.result)},r.onupgradeneeded=n=>{const a=n.target.result;a.objectStoreNames.contains(ce)||a.createObjectStore(ce,{keyPath:"key"}).createIndex("timestamp","timestamp",{unique:!1})}})}function Tn(e){return new Promise((t,r)=>{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(e.type)){r(new Error("Invalid image format. Supported formats: png, jpeg, gif, webp"));return}if(e.size>5*1024*1024){r(new Error("Image exceeds maximum size of 5MB"));return}const a=new FileReader;a.onload=async s=>{const o=s.target.result,g=o.split(",")[1].length*3/4;if(g>5*1024*1024){r(new Error("Image exceeds maximum size of 5MB"));return}try{const l=await Pe(),f=`editor-image-${ro()}`,u=l.transaction([ce],"readwrite").objectStore(ce),w={key:f,dataUrl:o,size:g,type:e.type,timestamp:Date.now()},v=u.add(w);v.onsuccess=()=>{l.close(),t(f)},v.onerror=()=>{l.close(),r(new Error("Failed to save image to IndexedDB"))}}catch(l){r(l)}},a.onerror=()=>{r(new Error("Error reading image file"))},a.readAsDataURL(e)})}async function vn(e){try{const t=await Pe();return new Promise((r,n)=>{const o=t.transaction([ce],"readonly").objectStore(ce).get(e);o.onsuccess=()=>{t.close();const i=o.result;r(i?i.dataUrl:null)},o.onerror=()=>{t.close(),n(new Error("Failed to retrieve image from IndexedDB"))}})}catch(t){return console.error("Error getting image:",t),null}}async function wn(e){try{const t=await Pe();return new Promise((r,n)=>{const o=t.transaction([ce],"readwrite").objectStore(ce).delete(e);o.onsuccess=()=>{t.close(),r()},o.onerror=()=>{t.close(),n(new Error("Failed to delete image from IndexedDB"))}})}catch(t){console.error("Error deleting image:",t)}}async function oo(){try{const e=await Pe();return new Promise((t,r)=>{const s=e.transaction([ce],"readwrite").objectStore(ce).clear();s.onsuccess=()=>{e.close(),t()},s.onerror=()=>{e.close(),r(new Error("Failed to clear images from IndexedDB"))}})}catch(e){console.error("Error clearing images:",e)}}async function so(){try{const e=await Pe();return new Promise((t,r)=>{const s=e.transaction([ce],"readonly").objectStore(ce).getAllKeys();s.onsuccess=()=>{e.close(),t(s.result||[])},s.onerror=()=>{e.close(),r(new Error("Failed to get image keys from IndexedDB"))}})}catch(e){return console.error("Error getting image keys:",e),[]}}const xn=["P","DIV","H1","H2","H3","H4","H5","H6","UL","OL","LI","TABLE","TBODY","TR","TD","TH","THEAD","TFOOT","BLOCKQUOTE","PRE","HR","FIGURE","FIGCAPTION","PAGE-BREAK"],ao=["SPAN","STRONG","EM","B","I","U","S","STRIKE","DEL","INS","SUB","SUP","MARK","SMALL","CODE","KBD","SAMP","VAR","A","ABBR","CITE","DFN","TIME"],io=["BR","HR","IMG","INPUT","PAGE-BREAK"];function co(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function Cn(e){const t=[];for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];t.push(` ${n.name}="${n.value}"`)}return t.join("")}function Ze(e){if(!e||typeof e!="string")return"<p><br></p>";const t=e.trim();if(!t)return"<p><br></p>";const r=document.createElement("div");return r.innerHTML=t,Ne(r)||"<p><br></p>"}function lo(e){const t=e.cloneNode(!0);return t.querySelectorAll(":scope > p").forEach(n=>{for(;n.firstChild;)t.insertBefore(n.firstChild,n);n.remove()}),t.innerHTML}function uo(e){const t=Array.from(e.children);return t.length===0?!1:t.every(r=>xn.includes(r.tagName))}function fo(e){const t=[];let r=!1;return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===Node.TEXT_NODE)n.textContent.trim()&&(r=!0);else if(n.nodeType===Node.ELEMENT_NODE){const a=n;xn.includes(a.tagName)?t.push(a.outerHTML):r=!0}}),r?e.outerHTML:t.join("")}function Ne(e){const t=[],r=Array.from(e.childNodes);for(let n=0;n<r.length;n++){const a=r[n];if(a.nodeType===Node.TEXT_NODE){const s=a.textContent.trim();s&&t.push(`<p>${co(s)}</p>`)}else if(a.nodeType===Node.ELEMENT_NODE){const s=a,o=s.tagName,i=o.toLowerCase(),g=Cn(s);if(o==="DIV"){const l=Ne(s);l.trim()?t.push(l):t.push("<p><br></p>")}else if(o==="P")uo(s)?t.push(fo(s)):t.push(s.outerHTML);else if(["H1","H2","H3","H4","H5","H6"].includes(o)){const l=lo(s);t.push(`<${i}${g}>${l}</${i}>`)}else if(o==="BR")t.push("<p><br></p>");else if(o==="IMG")t.push(s.outerHTML);else if(["UL","OL"].includes(o))t.push(po(s));else if(o==="LI")t.push(s.outerHTML);else if(o==="TABLE")t.push(go(s));else if(["TBODY","THEAD","TFOOT","TR","TD","TH"].includes(o))t.push(s.outerHTML);else if(o==="BLOCKQUOTE"){const l=Ne(s);t.push(`<blockquote${g}>${l}</blockquote>`)}else if(o==="PRE")t.push(s.outerHTML);else if(ao.includes(o))t.push(s.outerHTML);else if(o==="PAGE-BREAK"||s.getAttribute("data-page-break")==="true")t.push(s.outerHTML);else if(o==="HR")t.push(s.outerHTML);else if(o==="FIGURE")t.push(s.outerHTML);else if(io.includes(o))t.push(s.outerHTML);else{const l=Ne(s);t.push(`<${i}${g}>${l}</${i}>`)}}}return t.length===0?"":t.join("")}function po(e){const t=e.tagName.toLowerCase(),r=Cn(e),n=[];return Array.from(e.children).forEach(a=>{if(a.tagName==="LI")n.push(a.outerHTML);else{const s=Ne(a);s.trim()&&n.push(`<li>${s}</li>`)}}),n.length===0?`<${t}${r}><li><br></li></${t}>`:`<${t}${r}>${n.join("")}</${t}>`}function go(e){return e.outerHTML}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ho=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),mo=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,n)=>n?n.toUpperCase():r.toLowerCase()),An=e=>{const t=mo(e);return t.charAt(0).toUpperCase()+t.slice(1)},_n=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim(),yo=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var bo={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eo=d.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:a="",children:s,iconNode:o,...i},g)=>d.createElement("svg",{ref:g,...bo,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:_n("lucide",a),...!s&&!yo(i)&&{"aria-hidden":"true"},...i},[...o.map(([l,f])=>d.createElement(l,f)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=(e,t)=>{const r=d.forwardRef(({className:n,...a},s)=>d.createElement(Eo,{ref:s,iconNode:t,className:_n(`lucide-${ho(An(e))}`,`lucide-${e}`,n),...a}));return r.displayName=An(e),r};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const To=J("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vo=J("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wo=J("bold",[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xo=J("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Co=J("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ao=J("file-check",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=J("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _o=J("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const So=J("heading-1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ko=J("heading-2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oo=J("heading-3",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Po=J("image-upscale",[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M17 21h2a2 2 0 0 0 2-2",key:"130fy9"}],["path",{d:"M21 12v3",key:"1wzk3p"}],["path",{d:"m21 3-5 5",key:"1g5oa7"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2",key:"kk3yz1"}],["path",{d:"m5 21 4.144-4.144a1.21 1.21 0 0 1 1.712 0L13 19",key:"fyekpt"}],["path",{d:"M9 3h3",key:"d52fa"}],["rect",{x:"3",y:"11",width:"10",height:"10",rx:"1",key:"1wpmix"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const No=J("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mo=J("italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ro=J("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lo=J("list-indent-decrease",[["path",{d:"M21 5H11",key:"us1j55"}],["path",{d:"M21 12H11",key:"wd7e0v"}],["path",{d:"M21 19H11",key:"saa85w"}],["path",{d:"m7 8-4 4 4 4",key:"o5hrat"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Io=J("list-indent-increase",[["path",{d:"M21 5H11",key:"us1j55"}],["path",{d:"M21 12H11",key:"wd7e0v"}],["path",{d:"M21 19H11",key:"saa85w"}],["path",{d:"m3 8 4 4-4 4",key:"1a3j6y"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Do=J("list-ordered",[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sn=J("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ho=J("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bo=J("redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jo=J("scaling",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M14 15H9v-5",key:"pi4jk9"}],["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M21 3 9 15",key:"15kdhq"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zo=J("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $o=J("strikethrough",[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uo=J("table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=J("text-align-center",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M17 12H7",key:"16if0g"}],["path",{d:"M19 19H5",key:"vjpgq2"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=J("text-align-end",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M21 19H7",key:"4cu937"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fo=J("text-align-justify",[["path",{d:"M3 5h18",key:"1u36vt"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 19h18",key:"awlh7x"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=J("text-align-start",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wo=J("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Go=J("underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qo=J("undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zo=J("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yo=J("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vo=J("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),kn=(e,t,r="")=>{if(!e)return[];const n=document.createElement("div");n.innerHTML=e;const a=n.querySelectorAll("h1, h2, h3, h4, h5, h6");return Array.from(a).map((s,o)=>{const i=parseInt(s.tagName.charAt(1)),g=s.textContent.trim();return g?{id:`${r}heading-${o}`,level:i,text:g,page:t||1}:null}).filter(Boolean)},Ko=e=>{if(!e)return 0;const t=document.createElement("div");return t.innerHTML=e,(t.textContent||t.innerText||"").trim().split(/\s+/).filter(n=>n.length>0).length},On=({isCollapsed:e,onToggle:t,wordCount:r,pageCount:n})=>{const a=mt(),{pages:s,activePage:o,continuousContent:i}=a,{wordCount:g,outline:l}=d.useMemo(()=>{if(r!==void 0&&n!==void 0)return{wordCount:r,outline:kn(i,1,"continuous-")};let c=0;const u=[];return s.forEach((w,v)=>{c+=Ko(w.content),u.push(...kn(w.content,v+1,`page-${v}-`))}),{wordCount:c,outline:u}},[s,r,n,i]),f=n!==void 0?n:s.length;return m.jsxs("aside",{className:`sidebar ${e?"collapsed":""}`,role:"complementary","aria-label":"Document information","data-testid":"sidebar",children:[m.jsxs("div",{className:"sidebar-header",children:[m.jsxs("div",{className:"sidebar-title",children:[m.jsx(Ye,{size:18}),m.jsx("h2",{children:"Document Info"})]}),m.jsx("button",{className:"sidebar-toggle",onClick:t,"aria-label":e?"Expand sidebar":"Collapse sidebar",title:e?"Expand sidebar":"Collapse sidebar",children:e?m.jsx(Co,{size:16}):m.jsx(xo,{size:16})})]}),!e&&m.jsxs("div",{className:"sidebar-content",children:[m.jsxs("div",{className:"sidebar-section",children:[m.jsx("h3",{children:"Statistics"}),m.jsxs("div",{className:"stat-item",children:[m.jsxs("div",{className:"stat-label",children:[m.jsx(Ao,{size:14}),m.jsx("span",{children:"Pages:"})]}),m.jsx("span",{className:"stat-value",children:f})]}),m.jsxs("div",{className:"stat-item","data-testid":"word-count",children:[m.jsxs("div",{className:"stat-label",children:[m.jsx(_o,{size:14}),m.jsx("span",{children:"Words:"})]}),m.jsx("span",{className:"stat-value",children:g.toLocaleString()})]}),m.jsxs("div",{className:"stat-item",children:[m.jsxs("div",{className:"stat-label",children:[m.jsx(Ye,{size:14}),m.jsx("span",{children:"Active Page:"})]}),m.jsx("span",{className:"stat-value",children:o+1})]})]}),l.length>0&&m.jsxs("div",{className:"sidebar-section",children:[m.jsxs("h3",{children:[m.jsx(Sn,{size:14,style:{display:"inline-block",marginRight:"6px",verticalAlign:"middle"}}),"Document Outline"]}),m.jsx("div",{className:"document-outline","data-testid":"outline",children:l.map(c=>{const u=c.level===1?So:c.level===2?ko:Oo;return m.jsxs("div",{className:`outline-item outline-level-${c.level}`,style:{marginLeft:`${(c.level-1)*12}px`},children:[m.jsx(u,{size:12,className:"outline-icon"}),m.jsx("span",{className:"outline-text",children:c.text}),m.jsxs("span",{className:"outline-page",children:["p.",c.page]})]},c.id)})})]})]})]})};class Pn{constructor(t="Editor"){this.namespace=t}_format(t,r,n){return`[${new Date().toISOString()}] [${this.namespace}] [${t}] ${r}`}info(t,r){}warn(t,r){}error(t,r){}debug(t,r){}}const Nn=new Pn("Editor"),Mn=new Set(["P","DIV","H1","H2","H3","H4","H5","H6","LI","BLOCKQUOTE","PRE","TABLE"]),Rn=32;function Ln(e,t){if(!e)return;e.dataset||(e.dataset={}),e.style||(e.style={});const r=parseInt(e.dataset.indentLevel||"0",10),n=Math.max(0,t?r-1:r+1);n===0?(e.style.marginLeft="",delete e.dataset.indentLevel):(e.style.marginLeft=`${n*Rn}px`,e.dataset.indentLevel=String(n))}function Xo(e,t){Ln(e,t)}function Jo(e){let t=e;for(;t;){if(t.nodeType===1&&t.tagName&&Mn.has(t.tagName.toUpperCase()))return t;t=t.parentElement||t.parentNode}return null}function Qo(){const e=window.getSelection();if(!e||e.rangeCount===0)return[];const t=e.getRangeAt(0),r=new Set;let n=t.commonAncestorContainer;for(n.nodeType===Node.TEXT_NODE&&(n=n.parentElement);n&&n.contentEditable!=="true";)n=n.parentElement;return n?(n.querySelectorAll("p, div, h1, h2, h3, h4, h5, h6, li, blockquote, pre, table").forEach(o=>{document.createRange().selectNodeContents(o),t.intersectsNode(o)&&r.add(o)}),r.size===0&&n.querySelectorAll("img").forEach(i=>{if(document.createRange().selectNode(i),t.intersectsNode(i)){let l=i.parentElement;for(;l&&l!==n;){if(l.tagName&&Mn.has(l.tagName.toUpperCase())){r.add(l);break}l=l.parentElement}}}),Array.from(r).filter(o=>{let i=o.parentElement;for(;i;){if(r.has(i))return!1;i=i.parentElement}return!0})):[]}function es(e){if(e.style&&e.style.marginLeft&&e.style.marginLeft!==""){const t=parseInt(e.dataset.indentLevel||"0",10),r=Math.max(0,t-1);r===0?(e.style.marginLeft="",delete e.dataset.indentLevel):(e.style.marginLeft=`${r*Rn}px`,e.dataset.indentLevel=String(r));return}if(e.innerHTML.startsWith("&nbsp;&nbsp;&nbsp;&nbsp;")){e.innerHTML=e.innerHTML.replace(/^(&nbsp;){4}/,"");return}try{const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let r=t.nextNode();for(;r;){const n=r.textContent;if(n.startsWith("    ")){r.textContent=n.substring(4);break}r=t.nextNode()}}catch{e.innerHTML=e.innerHTML.replace(/^(&nbsp;){4}/,"")}}function kt(e=!1){const t=window.getSelection();if(!t||t.rangeCount===0)return!1;let r=Qo();const n=t.getRangeAt(0);if(r.length===0){const o=Jo(n.startContainer);if(!o)return!1;r=[o]}const a=r[0],s=r[r.length-1];r.forEach(o=>{if((o.tagName?o.tagName.toUpperCase():"")==="LI"){Xo(o,e);return}e?es(o):Ln(o,!1)});try{const o=document.createRange(),i=c=>c.nodeType===Node.TEXT_NODE?c:document.createTreeWalker(c,NodeFilter.SHOW_TEXT,null).nextNode(),g=c=>{if(c.nodeType===Node.TEXT_NODE)return c;const u=document.createTreeWalker(c,NodeFilter.SHOW_TEXT,null);let w=null,v=u.nextNode();for(;v;)w=v,v=u.nextNode();return w},l=i(a);l?o.setStart(l,0):o.setStart(a,0);const f=g(s);f?o.setEnd(f,f.length):o.setEnd(s,s.childNodes.length),t.removeAllRanges(),t.addRange(o)}catch{try{const i=document.createRange();i.setStartBefore(a),i.setEndAfter(s),t.removeAllRanges(),t.addRange(i)}catch(i){console.warn("Could not restore selection after indentation:",i)}}return!0}function ts(e){if(e.key!=="Tab")return!1;e.preventDefault();const t=e.shiftKey,r=window.getSelection(),n=r&&r.rangeCount>0?r.getRangeAt(0):null;return r&&r.rangeCount>0&&n&&!n.collapsed&&kt(t)||t||document.execCommand("insertHTML",!1,"&nbsp;&nbsp;&nbsp;&nbsp;"),!0}const ns=[{value:"Segoe UI",label:"Segoe UI"},{value:"Arial",label:"Arial"},{value:"Times New Roman",label:"Times New Roman"},{value:"Courier New",label:"Courier New"},{value:"Georgia",label:"Georgia"},{value:"Verdana",label:"Verdana"},{value:"Noto Sans Sinhala",label:"Noto Sans Sinhala"},{value:"Iskoola Pota",label:"Iskoola Pota"},{value:"Noto Sans Tamil",label:"Noto Sans Tamil"},{value:"Noto Sans",label:"Noto Sans"}],rs=[{value:"p",label:"Normal"},{value:"h1",label:"Heading 1"},{value:"h2",label:"Heading 2"},{value:"h3",label:"Heading 3"},{value:"h4",label:"Heading 4"},{value:"h5",label:"Heading 5"},{value:"h6",label:"Heading 6"}],os='<table border="1"><tr><td>Cell 1</td><td>Cell 2</td></tr><tr><td>Cell 3</td><td>Cell 4</td></tr></table>',Ve=({currentFormat:e,onFormatText:t,onAddPageBreak:r,canUndo:n=!1,canRedo:a=!1})=>{const s=async l=>{try{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(l.type)){alert("Invalid image format. Supported: PNG, JPEG, GIF, WEBP");return}if(l.size>5242880){alert("Image exceeds maximum size of 5MB");return}const c=await Tn(l),u=await vn(c);if(u){const v=`<img src="${u}" data-key="${c}" alt="Inserted image" />`;document.execCommand("insertHTML",!1,v),Nn.info("Image inserted",{key:c})}const w=document.getElementById("image-upload");w&&(w.value="")}catch(f){Nn.error("Error uploading image",f)}},o=(l,f,c,u)=>m.jsx("button",{onClick:()=>t(l),className:e[f]?"active":"",title:u,children:m.jsx(c,{size:16})},l),i=(l,f,c,u=!1)=>m.jsx("button",{onClick:l,disabled:u,title:c,style:{opacity:u?.5:1},children:m.jsx(f,{size:16})},c),g=()=>m.jsx("div",{className:"toolbar-separator"});return m.jsxs("div",{className:"editor-toolbar",children:[i(()=>t("undo"),qo,"Undo",!n),i(()=>t("redo"),Bo,"Redo",!a),g(),o("bold","bold",wo,"Bold"),o("italic","italic",Mo,"Italic"),o("underline","underline",Go,"Underline"),o("strikethrough","strikethrough",$o,"Strikethrough"),g(),o("justifyLeft","alignLeft",St,"Align Left"),o("justifyCenter","alignCenter",At,"Align Center"),o("justifyRight","alignRight",_t,"Align Right"),o("justifyFull","alignJustify",Fo,"Justify"),g(),m.jsx("select",{onChange:l=>t("fontName",l.target.value),value:e.fontFamily||"Segoe UI",title:"Font Family",children:ns.map(({value:l,label:f})=>m.jsx("option",{value:l,children:f},l))}),m.jsx("select",{onChange:l=>t("fontSize",l.target.value),value:e.fontSize||Oe,title:"Font Size",children:sn.map(({value:l,label:f})=>m.jsx("option",{value:l,children:f},l))}),m.jsx("select",{onChange:l=>t("formatBlock",l.target.value),value:e.headingLevel||"p",title:"Heading Level",children:rs.map(({value:l,label:f})=>m.jsx("option",{value:l,children:f},l))}),g(),i(()=>t("insertUnorderedList"),Sn,"Bullet List"),i(()=>t("insertOrderedList"),Do,"Numbered List"),g(),m.jsx("button",{onClick:()=>{kt(!1)||document.execCommand("insertHTML",!1,"&nbsp;&nbsp;&nbsp;&nbsp;")},title:"Increase Indent (Tab)",children:m.jsx(Io,{size:16})}),m.jsx("button",{onClick:()=>{kt(!0)},title:"Decrease Indent (Shift+Tab)",children:m.jsx(Lo,{size:16})}),g(),m.jsx("button",{onClick:()=>{const l=prompt("Enter URL:");l&&t("createLink",l)},title:"Insert Link",children:m.jsx(Ro,{size:16})}),i(()=>t("insertHTML",os),Uo,"Insert Table"),r&&i(r,Ye,"Insert Page Break"),g(),m.jsx("input",{type:"file",accept:"image/*",onChange:l=>l.target.files[0]&&s(l.target.files[0]),style:{display:"none"},id:"image-upload"}),m.jsx("button",{onClick:()=>document.getElementById("image-upload").click(),title:"Insert Image",children:m.jsx(No,{size:16})})]})};Ve.propTypes={currentFormat:T.shape({bold:T.bool,italic:T.bool,underline:T.bool,strikethrough:T.bool,alignLeft:T.bool,alignCenter:T.bool,alignRight:T.bool,alignJustify:T.bool,fontFamily:T.string,fontSize:T.string,headingLevel:T.string}).isRequired,onFormatText:T.func.isRequired,onAddPageBreak:T.func,canUndo:T.bool,canRedo:T.bool},Ve.defaultProps={onAddPageBreak:void 0,canUndo:!1,canRedo:!1};function ss(e){return!e||typeof e!="string"?e:Ze(e)}function as(e){e.preventDefault();const t=e.clipboardData||window.clipboardData;if(!t)return null;let r=t.getData("text/html")||t.getData("text/plain");return r?(t.getData("text/html")?r=ss(r):r=is(r),document.execCommand("insertHTML",!1,r),r):null}function is(e){if(!e)return"";const t=e.split(/\n\s*\n/).filter(r=>r.trim());return t.length===0?"<p><br></p>":t.map(r=>{const n=r.split(`
`).filter(s=>s.trim());return n.length===0?"<p><br></p>":`<p>${n.map(s=>cs(s.trim())).join("<br>")}</p>`}).join("")}function cs(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}const we=e=>e?e.nodeType===Node.ELEMENT_NODE?e.tagName==="PAGE-BREAK"||e.getAttribute("data-page-break")==="true":e.parentElement&&we(e.parentElement):!1,Ot=({dimensions:e,editorRef:t,onInput:r,onContentChange:n,onKeyDown:a,onClick:s,onScroll:o,onPaste:i,onRemovePageBreak:g,zoomLevel:l=100,pageMargins:f=pe})=>{const c=d.useMemo(()=>Wt(f),[f]),u=l/100,w=d.useCallback((b,h)=>{if(!b)return!1;const y=b.getBoundingClientRect(),R=h-y.top;return R<c.top||R>y.height-c.bottom},[c.top,c.bottom]),v=d.useCallback((b,h)=>{h.preventDefault();const y=b.getBoundingClientRect(),R=h.clientX-y.left,O=h.clientY-y.top,B=y.width-40,_=-12,C=y.width-20;R>=B&&R<=C&&O>=_&&O<=8&&g&&g(b)},[g]),x=d.useCallback(b=>{b.preventDefault();const h=t.current.getBoundingClientRect();if(b.clientY-h.top<c.top){const R=t.current.firstElementChild;if(R&&R.tagName!=="PAGE-BREAK"){const O=document.createRange(),B=window.getSelection();O.setStart(R,0),O.collapse(!0),B.removeAllRanges(),B.addRange(O)}}else{const R=t.current.lastElementChild;if(R&&R.tagName!=="PAGE-BREAK"){const O=document.createRange(),B=window.getSelection();O.selectNodeContents(R),O.collapse(!1),B.removeAllRanges(),B.addRange(O)}}},[t,c.top]),k=d.useCallback(b=>{const h=window.getSelection();if(!h||h.rangeCount===0)return;const y=h.getRangeAt(0),{startContainer:R,endContainer:O}=y;if((we(R)||we(O))&&(b.key.length===1||b.key==="Enter"||b.key===" "))return b.preventDefault(),!1;if(ts(b))return n&&n(),!1;if((b.key==="Backspace"||b.key==="Delete")&&(we(R)||we(O)))return b.preventDefault(),!1;a&&a(b)},[a,n]),M=d.useCallback(b=>{if(!t.current)return;const h=b.target;if(we(h)){v(h,b);return}if(w(t.current,b.clientY)){x(b);return}s&&s(b)},[t,s,v,x,w]),z=d.useCallback(b=>{const h=window.getSelection();if(!h||h.rangeCount===0)return;const y=h.getRangeAt(0),{startContainer:R}=y;if(we(R))return b.preventDefault(),!1},[]),N=d.useCallback(b=>{const h=as(b);i&&i(b,h)},[i]);return m.jsx("div",{className:"continuous-page-container",style:{position:"relative",width:"100%",maxWidth:`${e.width}px`,margin:"40px auto",backgroundColor:"transparent",minHeight:"100vh",transform:`scale(${u})`,transformOrigin:"top center",transition:"transform 0.2s ease-out"},children:m.jsx("div",{ref:t,contentEditable:!0,suppressContentEditableWarning:!0,className:"continuous-content",style:{position:"relative",zIndex:1,minHeight:`${e.height}px`,width:`${e.width}px`,backgroundColor:"white",padding:`${c.top}px ${c.right}px ${c.bottom}px ${c.left}px`,boxSizing:"border-box",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",outline:"none",cursor:"text",fontFamily:'"Segoe UI", "Noto Sans Sinhala", "Noto Sans", "Malithi Web", "Iskoola Pota", "Kaputa Unicode", "Helvetica Neue", Arial, "Hiragino Sans GB", "WenQuanYi Micro Hei", "Microsoft YaHei", sans-serif',fontSize:Oe,lineHeight:"1.4",color:"#333",wordWrap:"break-word",whiteSpace:"pre-wrap",overflowWrap:"break-word",border:"1px solid #e0e0e0"},onInput:r,onKeyDown:k,onBeforeInput:z,onClick:M,onScroll:o,onPaste:N,"data-testid":"continuous-editor"})})};Ot.propTypes={dimensions:T.shape({width:T.number.isRequired,height:T.number.isRequired}).isRequired,editorRef:T.shape({current:T.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onInput:T.func.isRequired,onContentChange:T.func,onKeyDown:T.func,onClick:T.func,onScroll:T.func,onPaste:T.func,onRemovePageBreak:T.func,zoomLevel:T.number,pageMargins:T.string},Ot.defaultProps={onContentChange:void 0,onKeyDown:void 0,onClick:void 0,onScroll:void 0,onPaste:void 0,onRemovePageBreak:void 0,zoomLevel:100,pageMargins:pe};const In=d.memo(Ot),Pt=({pageBoundaries:e=[{id:"page-0",pageNumber:1}],activePage:t=0,pageSize:r="A4",pageMargins:n=pe,zoomLevel:a=100,canZoomIn:s=!0,canZoomOut:o=!0,onNavigate:i,onAddPage:g,onDeletePage:l,onPageSizeChange:f,onPageMarginsChange:c,onZoomIn:u,onZoomOut:w,onZoomReset:v}={})=>{const x=Math.max(e?.length||0,1),k=h=>{i&&i(h)},M=()=>{g&&g()},z=h=>{if(x<=1){console.warn("[PageManager] Cannot delete the only page");return}l&&l(h)},N=h=>{f&&f(h)},b=h=>{c&&c(h)};return m.jsxs("div",{className:"page-manager",children:[m.jsxs("div",{className:"page-settings-group",children:[m.jsxs("div",{className:"page-settings-header",children:[m.jsx(zo,{size:14,style:{marginRight:"4px",verticalAlign:"middle"}}),"Page Settings"]}),m.jsxs("div",{className:"page-settings-controls",children:[m.jsxs("div",{className:"page-setting-item",children:[m.jsx("label",{htmlFor:"page-size-selector",children:"Size:"}),m.jsxs("select",{id:"page-size-selector",role:"combobox","aria-label":"Page size selector",value:r,onChange:h=>N(h.target.value),children:[m.jsx("option",{value:"A4",children:"A4"}),m.jsx("option",{value:"Letter",children:"Letter"}),m.jsx("option",{value:"Legal",children:"Legal"})]})]}),m.jsxs("div",{className:"page-setting-item",children:[m.jsx("label",{htmlFor:"page-margins-selector",children:"Margins:"}),m.jsx("select",{id:"page-margins-selector",role:"combobox","aria-label":"Page margins selector",value:n,onChange:h=>b(h.target.value),children:dr().map(h=>m.jsx("option",{value:h,children:fr(h)},h))})]})]})]}),m.jsxs("div",{className:"zoom-controls-compact",children:[m.jsx("button",{type:"button",className:"zoom-button-compact",onClick:w,disabled:!o,"aria-label":"Zoom out",title:"Zoom out (Ctrl + -)",children:m.jsx(Vo,{size:12})}),m.jsxs("span",{className:"zoom-level-display",children:[a,"%"]}),m.jsx("button",{type:"button",className:"zoom-button-compact",onClick:u,disabled:!s,"aria-label":"Zoom in",title:"Zoom in (Ctrl + +)",children:m.jsx(Yo,{size:12})}),m.jsx("button",{type:"button",className:"zoom-reset-compact",onClick:v,"aria-label":"Reset zoom",title:"Reset zoom to 100% (Ctrl + 0)",children:"Reset"})]}),m.jsx("div",{className:"page-list",children:e.map((h,y)=>m.jsxs("div",{className:"page-item",children:[m.jsxs("button",{type:"button",className:`page-button ${y===t?"active":""}`,onClick:()=>k(y),"aria-label":`Go to page ${y+1}`,"aria-current":y===t?"page":void 0,children:[m.jsx(Ye,{size:14}),m.jsxs("span",{children:["Page ",y+1]})]}),x>1&&m.jsx("button",{type:"button",className:"delete-page-button",onClick:R=>{R.stopPropagation(),z(y)},"aria-label":`Delete page ${y+1}`,title:"Delete this page and its content",children:m.jsx(Zo,{size:14})})]},h.id||`page-${y}`))}),m.jsxs("button",{type:"button",className:"add-page-button",onClick:M,"aria-label":"Add new page",title:"Add new page at end",children:[m.jsx(Ho,{size:16}),m.jsx("span",{children:"Add Page"})]})]})};Pt.propTypes={pageBoundaries:T.arrayOf(T.shape({id:T.string.isRequired,pageNumber:T.number.isRequired,top:T.number,height:T.number})),activePage:T.number,pageSize:T.oneOf(["A4","Letter","Legal"]),pageMargins:T.string,zoomLevel:T.number,canZoomIn:T.bool,canZoomOut:T.bool,onNavigate:T.func,onAddPage:T.func,onDeletePage:T.func,onPageSizeChange:T.func,onPageMarginsChange:T.func,onZoomIn:T.func,onZoomOut:T.func,onZoomReset:T.func},Pt.defaultProps={pageBoundaries:[{id:"page-0",pageNumber:1}],activePage:0,pageSize:"A4",pageMargins:pe,zoomLevel:100,canZoomIn:!0,canZoomOut:!0,onNavigate:void 0,onAddPage:void 0,onDeletePage:void 0,onPageSizeChange:void 0,onPageMarginsChange:void 0,onZoomIn:void 0,onZoomOut:void 0,onZoomReset:void 0};const Dn=d.memo(Pt);function ls(e){switch(e){case F.TOP_LEFT:case F.BOTTOM_RIGHT:return"nwse-resize";case F.TOP_RIGHT:case F.BOTTOM_LEFT:return"nesw-resize";case F.TOP:case F.BOTTOM:return"ns-resize";case F.LEFT:case F.RIGHT:return"ew-resize";default:return"default"}}function us({handler:e,startX:t,startY:r,currentX:n,currentY:a,startWidth:s,startHeight:o,options:i=ve}){const g=n-t,l=a-r;let f=s,c=o;switch(e){case F.TOP_LEFT:f=Math.max(i.minWidth,s-g),c=Math.max(i.minHeight,o-l);break;case F.TOP_RIGHT:f=Math.max(i.minWidth,s+g),c=Math.max(i.minHeight,o-l);break;case F.BOTTOM_LEFT:f=Math.max(i.minWidth,s-g),c=Math.max(i.minHeight,o+l);break;case F.BOTTOM_RIGHT:f=Math.max(i.minWidth,s+g),c=Math.max(i.minHeight,o+l);break;case F.TOP:c=Math.max(i.minHeight,o-l);break;case F.BOTTOM:c=Math.max(i.minHeight,o+l);break;case F.LEFT:f=Math.max(i.minWidth,s-g);break;case F.RIGHT:f=Math.max(i.minWidth,s+g);break;default:return{width:f,height:c}}if(i.preserveAspectRatio&&i.aspectRatio){const u=s/o;[F.TOP_LEFT,F.TOP_RIGHT,F.BOTTOM_LEFT,F.BOTTOM_RIGHT].includes(e)?f/u>c?c=Math.max(i.minHeight,f/u):f=Math.max(i.minWidth,c*u):[F.TOP,F.BOTTOM].includes(e)?f=c*u:[F.LEFT,F.RIGHT].includes(e)&&(c=f/u)}return i.maxWidth&&f>i.maxWidth&&(f=i.maxWidth,i.preserveAspectRatio&&i.aspectRatio&&(c=f/(s/o))),i.maxHeight&&c>i.maxHeight&&(c=i.maxHeight,i.preserveAspectRatio&&i.aspectRatio&&(f=c*(s/o))),f=Math.max(i.minWidth,f),c=Math.max(i.minHeight,c),{width:Math.round(f),height:Math.round(c)}}function Hn(e,{width:t,height:r}){he(e)&&(e.tagName==="IMG"?(e.style.width=`${t}px`,e.style.height=`${r}px`,e.width=t,e.height=r):e.tagName==="DIV"&&(e.style.width=`${t}px`,e.style.height=`${r}px`))}function ds(e,t,r){Hn(t,r);const n=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(n)}function fs(e,t,r,n){const{ctrlKey:a,metaKey:s,shiftKey:o,key:i}=e,g=a||s,l=r.offsetWidth,f=r.offsetHeight,u={">":g&&o?()=>({width:Math.min(n.maxWidth||800,l+10),height:f}):null,"<":g&&o?()=>({width:Math.max(n.minWidth||50,l-10),height:f}):null,"+":g&&o?()=>({width:l,height:Math.min(n.maxHeight||600,f+10)}):null,"-":g&&o?()=>({width:l,height:Math.max(n.minHeight||50,f-10)}):null,r:g&&!o?()=>({width:300,height:200}):null}[i];if(u){e.preventDefault();const w=u();return ds(t,r,w),!0}return!1}const Ke=({editorRef:e,onImageResize:t,onImageSelect:r,onImageDeselect:n,resizeOptions:a=ve})=>{const s=d.useRef(null),o=d.useRef(null),i=d.useRef(null),g=d.useRef(null),l=d.useRef(a),f=d.useRef(!1),c=ge();d.useEffect(()=>{l.current=a},[a]);const u=d.useCallback(b=>{if(!he(b))return;s.current&&(qe(s.current),s.current=null),b.classList.add("selected");const h=bn(b,l.current);h&&(s.current=h,o.current=b,document.body.appendChild(h),h.querySelectorAll(".resize-handler").forEach(R=>{R.addEventListener("mousedown",v)}),r&&r(b))},[r]),w=d.useCallback(()=>{o.current&&(o.current.classList.remove("selected"),o.current=null),s.current&&(qe(s.current),s.current=null),i.current=null,g.current=null,f.current=!1,n&&n()},[n]),v=d.useCallback(b=>{if(b.preventDefault(),b.stopPropagation(),!o.current)return;const h=b.currentTarget.dataset.handler,y=o.current.getBoundingClientRect(),R=window.pageYOffset||document.documentElement.scrollTop,O=window.pageXOffset||document.documentElement.scrollLeft;i.current={x:b.clientX,y:b.clientY,width:o.current.offsetWidth,height:o.current.offsetHeight,originalWidth:o.current.offsetWidth,originalHeight:o.current.offsetHeight,offsetX:b.clientX-y.left-O,offsetY:b.clientY-y.top-R},g.current=h,f.current=!0,document.body.classList.add("resize-in-progress"),document.body.style.cursor=ls(h),document.addEventListener("mousemove",x),document.addEventListener("mouseup",k)},[]),x=d.useCallback(b=>{if(!f.current||!o.current||!i.current||!g.current)return;b.preventDefault(),b.stopPropagation();const{x:h,y,width:R,height:O}=i.current,B=g.current,_=b.clientX,C=b.clientY,D=us({handler:B,startX:h,startY:y,currentX:_,currentY:C,startWidth:R,startHeight:O,options:l.current});Hn(o.current,D),s.current&&Ge(s.current,o.current)},[]),k=d.useCallback(b=>{if(f.current){if(b.preventDefault(),b.stopPropagation(),o.current&&i.current){const h={width:i.current.originalWidth,height:i.current.originalHeight},y={width:o.current.offsetWidth,height:o.current.offsetHeight};(h.width!==y.width||h.height!==y.height)&&c.recordOperation({type:"IMAGE_RESIZE",payload:{element:o.current,state:y}},{type:"IMAGE_RESIZE",payload:{element:o.current,state:h}})}if(i.current=null,g.current=null,f.current=!1,document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",k),document.body.classList.remove("resize-in-progress"),document.body.style.cursor="",o.current){const h=new Event("input",{bubbles:!0,cancelable:!0});o.current.dispatchEvent(h),t&&t(o.current,{width:o.current.offsetWidth,height:o.current.offsetHeight})}}},[t,c]),M=d.useCallback(b=>{s.current&&!s.current.contains(b.target)&&w();const h=b.target;if(he(h)){if(h===o.current)return;u(h)}},[u,w]),z=d.useCallback(b=>{if((b.key==="Delete"||b.key==="Backspace")&&o.current&&!f.current){b.preventDefault();const h=o.current;if(h.parentNode){h.parentNode.removeChild(h),w();const y=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(y)}}b.key==="Escape"&&o.current&&w(),o.current&&!f.current&&fs(b,e,o.current,l.current)},[e,w]),N=d.useCallback(()=>{s.current&&o.current&&Ge(s.current,o.current)},[]);return d.useEffect(()=>{if(!e.current)return;const h=e.current.closest(".editor-viewport");return h&&(h.addEventListener("scroll",N),window.addEventListener("scroll",N)),()=>{h&&h.removeEventListener("scroll",N),window.removeEventListener("scroll",N)}},[e,N]),d.useEffect(()=>{if(!e.current)return;const b=e.current;return b.addEventListener("click",M),b.addEventListener("keydown",z),window.addEventListener("resize",N),()=>{b.removeEventListener("click",M),b.removeEventListener("keydown",z),window.removeEventListener("resize",N),f.current&&(document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",k),document.body.classList.remove("resize-in-progress"),document.body.style.cursor=""),s.current&&qe(s.current)}},[e,M,z,N,x,k]),d.useEffect(()=>{if(!e.current)return;const b=new MutationObserver(h=>{h.forEach(y=>{y.type==="childList"&&(y.removedNodes.forEach(R=>{R.nodeType===Node.ELEMENT_NODE&&he(R)&&R===o.current&&w()}),y.addedNodes.forEach(R=>{if(R.nodeType!==Node.ELEMENT_NODE)return;if(he(R)){setTimeout(()=>u(R),50);return}const O=R.querySelectorAll?.("img")||[];O.length>0&&setTimeout(()=>u(O[0]),50)}))})});return b.observe(e.current,{childList:!0,subtree:!0}),()=>b.disconnect()},[e,w,u]),null};Ke.propTypes={editorRef:T.shape({current:T.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onImageResize:T.func,onImageSelect:T.func,onImageDeselect:T.func,resizeOptions:T.shape({minWidth:T.number,minHeight:T.number,maxWidth:T.number,maxHeight:T.number,aspectRatio:T.bool,preserveAspectRatio:T.bool,defaultWidth:T.number,defaultHeight:T.number})},Ke.defaultProps={onImageResize:void 0,onImageSelect:void 0,onImageDeselect:void 0,resizeOptions:ve};const Nt=({imageElement:e,onAlignChange:t,onAspectRatioToggle:r,onDelete:n,onClose:a,initialPreserveAspectRatio:s=!0})=>{const[o,i]=d.useState({top:0,left:0}),[g,l]=d.useState(!1),[f,c]=d.useState("top"),[u,w]=d.useState(s),v=d.useRef(null),x=d.useRef(null),k=ge(),M=E=>{if(!E)return;(typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame:V=>setTimeout(V,16))(()=>{const V=document.querySelector(".image-resize-overlay");V&&Ge(V,E)})},z=E=>{if(!E)return null;const L=window.getComputedStyle(E);return{float:L.float||"none",margin:E.style.margin||"",display:L.display||"inline",width:E.style.width||E.width||"",height:E.style.height||E.height||"",aspectRatio:u}},N=d.useCallback(()=>{if(!e)return"left";const E=window.getComputedStyle(e);return E.float==="right"?"right":E.float==="left"?"left":E.display==="block"&&E.margin.includes("auto")?"center":"left"},[e]),[b,h]=d.useState("left");d.useEffect(()=>{e&&h(N())},[e,N]);const y=d.useCallback(()=>{if(!e||!v.current)return;const E=e.getBoundingClientRect(),L=v.current.getBoundingClientRect(),V=window.visualViewport?window.visualViewport:{width:window.innerWidth,height:window.innerHeight},Z=E.bottom>=0&&E.top<=V.height&&E.right>=0&&E.left<=V.width;let ee="top",oe=0,re=0;if(Z){const I=E.top-L.height-10,G=V.height-E.bottom-L.height-10;G>I&&G>0?(ee="bottom",oe=E.bottom+10):(ee="top",oe=E.top-L.height-10)}else ee="top",oe=10;re=E.left+E.width/2-L.width/2;const A=window.innerWidth,p=window.innerHeight;let S=Math.max(10,Math.min(re,A-L.width-10)),j=Math.max(10,Math.min(oe,p-L.height-10));i({top:j,left:S}),c(ee),l(!0)},[e]);d.useLayoutEffect(()=>{y();const E=()=>{y()},L=x.current;return L&&L.addEventListener("scroll",E),window.addEventListener("scroll",E),window.addEventListener("resize",E),()=>{L&&L.removeEventListener("scroll",E),window.removeEventListener("scroll",E),window.removeEventListener("resize",E),l(!1)}},[e,y]),d.useEffect(()=>{const E=L=>{v.current&&!v.current.contains(L.target)&&L.target!==e&&a()};return document.addEventListener("mousedown",E),()=>{document.removeEventListener("mousedown",E)}},[e,a]);const R={left:{float:"left",margin:"0 10px 10px 0",display:"block"},center:{float:"none",margin:"10px auto",display:"block"},right:{float:"right",margin:"0 0 10px 10px",display:"block"}},O=E=>{if(e&&R[E]){const L=z(e),V=b,Z=R[E];e.style.float=Z.float,e.style.margin=Z.margin,e.style.display=Z.display,h(E),M(e);const ee=z(e);k.recordOperation({type:"IMAGE_ALIGN",payload:{element:e,alignment:E,state:ee}},{type:"IMAGE_ALIGN",payload:{element:e,alignment:V,state:L}}),t&&t(E)}},B=()=>{if(e&&e.parentNode){const E={element:e,parent:e.parentNode,nextSibling:e.nextSibling};k.recordOperation({type:"IMAGE_DELETE",payload:{element:e}},{type:"IMAGE_REINSERT",payload:{state:E}}),e.parentNode.removeChild(e),n&&n(),a()}},_=()=>{const E=u,L=!u;w(L),k.recordOperation({type:"IMAGE_ASPECT_RATIO",payload:{element:e,preserveAspectRatio:L}},{type:"IMAGE_ASPECT_RATIO",payload:{element:e,preserveAspectRatio:E}}),r&&r(L)},C={border:"1px solid #ccc",borderRadius:"4px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"28px",height:"28px"},D=E=>({...C,background:E?"#007bff":"transparent",color:E?"#fff":"#333"});return!e||typeof document>"u"?null:jt.createPortal(m.jsxs("div",{ref:v,className:"image-tooltip-menu","data-menu-position":f,"aria-hidden":!g,style:{position:"fixed",top:`${o.top}px`,left:`${o.left}px`,zIndex:999,background:"#fff",border:"1px solid #ddd",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"8px",display:"flex",gap:"2px",alignItems:"center",pointerEvents:g?"auto":"none",minWidth:"140px",minHeight:"32px",opacity:g?1:0,visibility:g?"visible":"hidden",transition:"opacity 0.15s ease, visibility 0.15s ease"},children:[m.jsx("button",{className:`tooltip-button aspect-ratio-toggle ${u?"":"active"}`,onClick:_,title:`Toggle aspect ratio preservation (currently ${u?"ON":"OFF"})`,children:u?m.jsx(jo,{size:14}):m.jsx(Po,{size:14})}),m.jsx("button",{className:`tooltip-button ${b==="left"?"active":""}`,onClick:()=>O("left"),title:"Align Left",style:D(b==="left"),children:m.jsx(St,{size:14})}),m.jsx("button",{className:`tooltip-button ${b==="center"?"active":""}`,onClick:()=>O("center"),title:"Align Center",style:D(b==="center"),children:m.jsx(At,{size:14})}),m.jsx("button",{className:`tooltip-button ${b==="right"?"active":""}`,onClick:()=>O("right"),title:"Align Right",style:D(b==="right"),children:m.jsx(_t,{size:14})}),m.jsx("button",{className:"tooltip-button delete-button",onClick:B,title:"Delete Image",style:{background:"transparent",color:"#dc3545",border:"1px solid #dc3545",borderRadius:"4px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"28px",height:"28px"},children:m.jsx(Wo,{size:14})})]}),document.body)};Nt.propTypes={imageElement:T.instanceOf(typeof Element<"u"?Element:Object),onAlignChange:T.func,onAspectRatioToggle:T.func,onDelete:T.func,onClose:T.func.isRequired,initialPreserveAspectRatio:T.bool},Nt.defaultProps={imageElement:null,onAlignChange:void 0,onAspectRatioToggle:void 0,onDelete:void 0,initialPreserveAspectRatio:!0};const Me={minColumnWidth:10,minRowHeight:8,maxColumnWidth:800,maxRowHeight:600,tableMinWidth:100,tableMinHeight:50,tableMaxWidth:1200,tableMaxHeight:800},ae={COLUMN:"column",ROW:"row",TABLE_BOTTOM:"table-bottom",TABLE_RIGHT:"table-right"};function fe(e){return e?e.tagName==="TABLE":!1}function ye(e){if(!fe(e))return null;const t=e.getBoundingClientRect(),r=Array.from(e.rows),n=r.length>0?r[0].cells.length:0,a=[],s=e.querySelector("colgroup"),o=s?s.querySelectorAll("col"):[];if(o.length>=n)for(let g=0;g<n;g++){const l=o[g],f=l.style.width?parseInt(l.style.width,10):l.offsetWidth;a.push(f||100)}else if(r.length>0){const g=r[0];for(let l=0;l<g.cells.length;l++){const f=g.cells[l];a.push(f.offsetWidth)}}const i=r.map(g=>(g.style.height?parseInt(g.style.height,10):null)||g.offsetHeight);return{width:t.width,height:t.height,columns:n,rows:r.length,columnWidths:a,rowHeights:i,rect:t}}function Bn({type:e,index:t,delta:r,currentStructure:n,options:a=Me}){const s={columnWidths:[...n.columnWidths],rowHeights:[...n.rowHeights],tableWidth:n.width,tableHeight:n.height},o=(i,g,l,f,c)=>{g>=0&&g<i.length&&(i[g]=Math.max(f,Math.min(c,i[g]+l)))};switch(e){case ae.COLUMN:o(s.columnWidths,t,r,a.minColumnWidth,a.maxColumnWidth),s.tableWidth=n.width;break;case ae.ROW:o(s.rowHeights,t,r,a.minRowHeight,a.maxRowHeight),s.tableHeight=n.height;break;case ae.TABLE_BOTTOM:o(s.rowHeights,n.rows-1,r,a.minRowHeight,a.maxRowHeight);break;case ae.TABLE_RIGHT:o(s.columnWidths,n.columns-1,r,a.minColumnWidth,a.maxColumnWidth);break}return s}function Re(e){if(!fe(e))return;const t=Array.from(e.rows);if(t.length===0)return;const r=t[0].cells.length;let n=e.querySelector("colgroup");n||(n=document.createElement("colgroup"),e.insertBefore(n,e.firstChild));const a=n.querySelectorAll("col"),s=a.length;if(s<r)for(let o=s;o<r;o++){const i=document.createElement("col");n.appendChild(i)}else if(s>r)for(let o=s-1;o>=r;o--)n.removeChild(a[o])}function Xe(e,t,r){if(!fe(e))return;Re(e);const{columnWidths:n,rowHeights:a,tableWidth:s,tableHeight:o}=t,i=n?n.reduce((l,f)=>l+f,0):0,g=a?a.reduce((l,f)=>l+f,0):0;if(s!==void 0?e.style.width=`${s}px`:i>0&&(e.style.width=`${i}px`),o!==void 0?e.style.height=`${o}px`:g>0&&(e.style.height=`${g}px`),n&&n.length>0){e.style.tableLayout="fixed";const l=e.querySelector("colgroup");l&&l.querySelectorAll("col").forEach((c,u)=>{u<n.length&&(c.style.width=`${n[u]}px`)}),e.style.width=`${i}px`}a&&a.length>0&&(Array.from(e.rows).forEach((f,c)=>{c<a.length&&(f.style.height=`${a[c]}px`)}),e.style.height=`${g}px`),e.offsetHeight}function jn(e,t=Me){if(!fe(e))return null;Re(e);const r=ye(e);if(!r)return null;const n=document.createElement("div");n.className="table-resize-overlay",n.style.position="fixed",n.style.zIndex="1000",n.style.pointerEvents="none";const a=e.getBoundingClientRect();n.style.top=`${a.top}px`,n.style.left=`${a.left}px`,n.style.width=`${a.width}px`,n.style.height=`${a.height}px`;for(let i=0;i<r.columns-1;i++){const g=zn(i,r,a,e);n.appendChild(g)}for(let i=0;i<r.rows-1;i++){const g=$n(i,r,a,e);n.appendChild(g)}const s=Un(r,a);n.appendChild(s);const o=Fn(r,a);return n.appendChild(o),n}function zn(e,t,r,n){const a=document.createElement("div");return a.className="table-resize-handler table-column-resize-handler",a.dataset.type=ae.COLUMN,a.dataset.index=e,a.style.position="absolute",a.style.width="4px",a.style.height=`${r.height}px`,a.style.cursor="col-resize",a.style.pointerEvents="all",Wn(a,e,t,r,n),a}function $n(e,t,r,n){const a=document.createElement("div");return a.className="table-resize-handler table-row-resize-handler",a.dataset.type=ae.ROW,a.dataset.index=e,a.style.position="absolute",a.style.width=`${r.width}px`,a.style.height="4px",a.style.cursor="row-resize",a.style.pointerEvents="all",Gn(a,e,t,r,n),a}function Un(e,t){const r=document.createElement("div");return r.className="table-resize-handler table-bottom-resize-handler",r.dataset.type=ae.TABLE_BOTTOM,r.style.position="absolute",r.style.width=`${t.width}px`,r.style.height="4px",r.style.cursor="ns-resize",r.style.pointerEvents="all",qn(r,e,t),r}function Fn(e,t){const r=document.createElement("div");return r.className="table-resize-handler table-right-resize-handler",r.dataset.type=ae.TABLE_RIGHT,r.style.position="absolute",r.style.width="4px",r.style.height=`${t.height}px`,r.style.cursor="ew-resize",r.style.pointerEvents="all",Zn(r,e,t),r}function Je(e,t){if(!e||!t)return;Re(t);const r=ye(t);if(!r)return;const n=t.getBoundingClientRect();e.style.top=`${n.top}px`,e.style.left=`${n.left}px`,e.style.width=`${n.width}px`,e.style.height=`${n.height}px`;const a=e.querySelectorAll(".table-column-resize-handler"),s=e.querySelectorAll(".table-row-resize-handler"),o=e.querySelector(".table-bottom-resize-handler"),i=e.querySelector(".table-right-resize-handler");if(a.length!==r.columns-1||s.length!==r.rows-1||!o||!i){e.innerHTML="";for(let c=0;c<r.columns-1;c++){const u=zn(c,r,n,t);e.appendChild(u)}for(let c=0;c<r.rows-1;c++){const u=$n(c,r,n,t);e.appendChild(u)}const l=Un(r,n);e.appendChild(l);const f=Fn(r,n);e.appendChild(f)}else a.forEach((l,f)=>{Wn(l,f,r,n,t)}),s.forEach((l,f)=>{Gn(l,f,r,n,t)}),o&&qn(o,r,n),i&&Zn(i,r,n)}function Le(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function ps(e,t){if(!fe(e))return console.warn("insertRowAbove: Invalid table element"),null;if(t<0||t>e.rows.length)return console.warn(`insertRowAbove: Invalid row index ${t}, table has ${e.rows.length} rows`),null;const r=e.rows[t];if(!r)return console.warn(`insertRowAbove: Could not find reference row at index ${t}`),null;const n=document.createElement("tr"),a=r.cells.length;for(let o=0;o<a;o++){const i=document.createElement("td");i.innerHTML="&nbsp;",n.appendChild(i)}try{r.parentNode.insertBefore(n,r)}catch(o){return console.error("insertRowAbove: Failed to insert row",o),null}Re(e);const s=ye(e);return s&&Xe(e,{columnWidths:s.columnWidths,rowHeights:s.rowHeights}),n}function gs(e,t){if(!fe(e))return console.warn("insertRowBelow: Invalid table element"),null;if(t<0||t>=e.rows.length)return console.warn(`insertRowBelow: Invalid row index ${t}, table has ${e.rows.length} rows`),null;const r=e.rows[t];if(!r)return console.warn(`insertRowBelow: Could not find reference row at index ${t}`),null;const n=document.createElement("tr"),a=r.cells.length;for(let i=0;i<a;i++){const g=document.createElement("td");g.innerHTML="&nbsp;",n.appendChild(g)}const s=r.nextSibling;try{s?r.parentNode.insertBefore(n,s):r.parentNode.appendChild(n)}catch(i){return console.error("insertRowBelow: Failed to insert row",i),null}Re(e);const o=ye(e);return o&&Xe(e,{columnWidths:o.columnWidths,rowHeights:o.rowHeights}),n}function Wn(e,t,r,n,a){if(a&&a.rows.length>0){const o=a.rows[0];if(o.cells.length>t){const g=o.cells[t].getBoundingClientRect(),l=a.getBoundingClientRect(),f=g.right-l.left-2;e.style.left=`${f}px`,e.style.height=`${n.height}px`;return}}let s=0;for(let o=0;o<=t;o++)s+=r.columnWidths[o];e.style.left=`${s-2}px`,e.style.height=`${n.height}px`}function Gn(e,t,r,n,a){if(a&&a.rows.length>t){const o=a.rows[t];if(o.cells.length>0){const g=o.cells[0].getBoundingClientRect(),l=a.getBoundingClientRect(),f=g.bottom-l.top-2;e.style.top=`${f}px`,e.style.width=`${n.width}px`;return}}let s=0;for(let o=0;o<=t;o++)s+=r.rowHeights[o];e.style.top=`${s-2}px`,e.style.width=`${n.width}px`}function qn(e,t,r){e.style.bottom="-2px",e.style.left="0px",e.style.width=`${r.width}px`}function Zn(e,t,r){e.style.right="-2px",e.style.top="0px",e.style.height=`${r.height}px`}const Qe=({editorRef:e,onTableResize:t,onTableSelect:r,onTableDeselect:n,resizeOptions:a=Me})=>{const s=d.useRef(null),o=d.useRef(null),i=d.useRef(null),g=d.useRef(null),l=d.useRef(null),f=d.useRef(a),c=d.useRef(!1),[u,w]=d.useState(null),v=ge();d.useEffect(()=>{f.current=a},[a]);const x=d.useCallback(()=>{o.current&&(o.current.classList.remove("selected"),o.current=null),s.current&&(Le(s.current),s.current=null),w(null),i.current=null,g.current=null,l.current=null,c.current=!1,n&&n()},[n]),k=d.useCallback(O=>{if(O.preventDefault(),O.stopPropagation(),!o.current)return;const B=O.currentTarget,_=B.dataset.type,C=parseInt(B.dataset.index,10);o.current.getBoundingClientRect(),window.pageYOffset||document.documentElement.scrollTop,window.pageXOffset||document.documentElement.scrollLeft;const D=ye(o.current);i.current={x:O.clientX,y:O.clientY,structure:{...D}},g.current=_,l.current=C,c.current=!0,document.body.classList.add("table-resize-in-progress");const E={[ae.COLUMN]:"col-resize",[ae.ROW]:"row-resize",[ae.TABLE_BOTTOM]:"ns-resize",[ae.TABLE_RIGHT]:"ew-resize"};document.body.style.cursor=E[_]||"default",document.addEventListener("mousemove",N),document.addEventListener("mouseup",b)},[]),M=d.useCallback(O=>{const B=jn(O,f.current);return B&&(s.current=B,o.current=O,document.body.appendChild(B),B.querySelectorAll(".table-resize-handler").forEach(C=>{C.addEventListener("mousedown",k)})),B},[k]),z=d.useCallback(O=>{if(!fe(O))return;s.current&&(Le(s.current),s.current=null),O.classList.add("selected"),M(O)&&(w(O),r&&r(O))},[r,M]),N=d.useCallback(O=>{if(!c.current||!o.current||!i.current||!g.current)return;O.preventDefault(),O.stopPropagation();const{x:B,y:_,structure:C}=i.current,D=g.current,E=l.current,L=O.clientX,V=O.clientY;let Z=0;switch(D){case ae.COLUMN:Z=L-B;break;case ae.ROW:Z=V-_;break;case ae.TABLE_BOTTOM:Z=V-_;break;case ae.TABLE_RIGHT:Z=L-B;break}const ee=Bn({type:D,index:E,delta:Z,currentStructure:C,options:f.current});Xe(o.current,ee),s.current&&Je(s.current,o.current)},[]),b=d.useCallback(O=>{if(c.current){if(O.preventDefault(),O.stopPropagation(),o.current&&i.current){const B={structure:i.current.structure},_={structure:ye(o.current)};(B.structure.width!==_.structure.width||B.structure.height!==_.structure.height||JSON.stringify(B.structure.columnWidths)!==JSON.stringify(_.structure.columnWidths)||JSON.stringify(B.structure.rowHeights)!==JSON.stringify(_.structure.rowHeights))&&v.recordOperation({type:"TABLE_RESIZE",payload:{element:o.current,state:_}},{type:"TABLE_RESIZE",payload:{element:o.current,state:B}})}if(i.current=null,g.current=null,l.current=null,c.current=!1,document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",b),document.body.classList.remove("table-resize-in-progress"),document.body.style.cursor="",o.current){const B=new Event("input",{bubbles:!0,cancelable:!0});o.current.dispatchEvent(B),t&&t(o.current,ye(o.current))}}},[t,v]),h=d.useCallback(O=>{s.current&&!s.current.contains(O.target)&&x();const _=O.target.closest("table");if(_&&fe(_)){if(_===o.current)return;z(_)}},[z,x]),y=d.useCallback(O=>{if(O.key==="Delete"&&o.current&&!c.current){O.preventDefault();const B=o.current;if(B.parentNode){B.parentNode.removeChild(B),x();const _=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(_)}}O.key==="Escape"&&o.current&&x()},[e,x]),R=d.useCallback(()=>{s.current&&o.current&&Je(s.current,o.current)},[]);return d.useEffect(()=>{if(!e.current)return;const B=e.current.closest(".editor-viewport");return B&&(B.addEventListener("scroll",R),window.addEventListener("scroll",R)),()=>{B&&B.removeEventListener("scroll",R),window.removeEventListener("scroll",R)}},[e,R]),d.useEffect(()=>{if(!e.current)return;const O=e.current;return O.addEventListener("click",h),O.addEventListener("keydown",y),window.addEventListener("resize",R),()=>{O.removeEventListener("click",h),O.removeEventListener("keydown",y),window.removeEventListener("resize",R),c.current&&(document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",b),document.body.classList.remove("table-resize-in-progress"),document.body.style.cursor=""),s.current&&Le(s.current)}},[e,h,y,R,N,b]),d.useEffect(()=>{if(!e.current)return;const O=new MutationObserver(B=>{B.forEach(_=>{_.type==="childList"&&(_.removedNodes.forEach(C=>{C.nodeType===Node.ELEMENT_NODE&&fe(C)&&C===u&&x()}),_.addedNodes.forEach(C=>{if(C.nodeType!==Node.ELEMENT_NODE)return;if(fe(C)){setTimeout(()=>z(C),50);return}const D=C.querySelectorAll?.("table")||[];D.length>0&&setTimeout(()=>z(D[0]),50)}))})});return O.observe(e.current,{childList:!0,subtree:!0}),()=>O.disconnect()},[e,x,z]),d.useEffect(()=>{if(!u)return;const O=new MutationObserver(B=>{B.some(C=>{if(C.type==="childList"){if([...C.addedNodes,...C.removedNodes].some(E=>E.nodeType===Node.ELEMENT_NODE&&E.tagName==="TR"))return!0}else if(C.type==="attributes"&&["colspan","rowspan"].includes(C.attributeName))return!0;return!1})&&s.current&&o.current&&(Le(s.current),s.current=null,M(o.current))});return O.observe(u,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["colspan","rowspan"]}),()=>O.disconnect()},[u,M]),null};Qe.propTypes={editorRef:T.shape({current:T.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onTableResize:T.func,onTableSelect:T.func,onTableDeselect:T.func,resizeOptions:T.shape({minColumnWidth:T.number,minRowHeight:T.number,maxColumnWidth:T.number,maxRowHeight:T.number,tableMinWidth:T.number,tableMinHeight:T.number,tableMaxWidth:T.number,tableMaxHeight:T.number})},Qe.defaultProps={onTableResize:void 0,onTableSelect:void 0,onTableDeselect:void 0,resizeOptions:Me};const Mt=({tableElement:e,onAlignChange:t,onClose:r,selectedRowIndex:n,editorRef:a})=>{const[s,o]=d.useState({top:0,left:0}),[i,g]=d.useState(!1),[l,f]=d.useState("top"),c=d.useRef(null),u=d.useRef(null),w=ge(),v=_=>{if(!_)return;(typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame:D=>setTimeout(D,16))(()=>{const D=document.querySelector(".table-resize-overlay");D&&Je(D,_)})},x=_=>{if(!_)return null;const C=window.getComputedStyle(_);return{float:C.float||"none",margin:_.style.margin||"",marginLeft:_.style.marginLeft||"",marginRight:_.style.marginRight||"",display:C.display||"table"}},k=d.useCallback(()=>{if(!e)return"left";const _=window.getComputedStyle(e);return _.marginLeft==="auto"&&_.marginRight==="auto"?"center":_.float==="right"?"right":(_.float==="left","left")},[e]),[M,z]=d.useState("left");d.useEffect(()=>{e&&z(k())},[e,k]);const N=d.useCallback(()=>{if(!e||!c.current)return;const _=e.getBoundingClientRect(),C=c.current.getBoundingClientRect(),D=window.visualViewport?window.visualViewport:{width:window.innerWidth,height:window.innerHeight},E=_.bottom>=0&&_.top<=D.height&&_.right>=0&&_.left<=D.width;let L="top",V=0,Z=0;if(E){const p=_.top-C.height-10,S=D.height-_.bottom-C.height-10;S>p&&S>0?(L="bottom",V=_.bottom+10):(L="top",V=_.top-C.height-10)}else L="top",V=10;Z=_.left+_.width/2-C.width/2;const ee=window.innerWidth,oe=window.innerHeight;let re=Math.max(10,Math.min(Z,ee-C.width-10)),A=Math.max(10,Math.min(V,oe-C.height-10));o({top:A,left:re}),f(L),g(!0)},[e]);d.useLayoutEffect(()=>{N();const _=()=>{N()},C=u.current;return C&&C.addEventListener("scroll",_),window.addEventListener("scroll",_),window.addEventListener("resize",_),()=>{C&&C.removeEventListener("scroll",_),window.removeEventListener("scroll",_),window.removeEventListener("resize",_),g(!1)}},[e,N]),d.useEffect(()=>{const _=C=>{c.current&&!c.current.contains(C.target)&&C.target!==e&&!e.contains(C.target)&&r()};return document.addEventListener("mousedown",_),()=>{document.removeEventListener("mousedown",_)}},[e,r]);const b={left:{float:"left",margin:"10px 10px 10px 0",marginLeft:"",marginRight:""},center:{float:"none",margin:"10px auto",marginLeft:"auto",marginRight:"auto"},right:{float:"right",margin:"10px 0 10px 10px",marginLeft:"",marginRight:""}},h=_=>{if(e&&b[_]){const C=x(e),D=M,E=b[_];e.style.float=E.float,e.style.margin=E.margin,e.style.marginLeft=E.marginLeft,e.style.marginRight=E.marginRight,z(_),v(e);const L=x(e);w.recordOperation({type:"TABLE_ALIGN",payload:{element:e,alignment:_,state:L}},{type:"TABLE_ALIGN",payload:{element:e,alignment:D,state:C}}),t&&t(_)}},y=()=>{if(console.log("handleInsertRowAbove called",{selectedRowIndex:n,tableElement:e,hasEditorRef:!!a}),!e){console.warn("handleInsertRowAbove: No table element");return}if(n==null){console.warn("handleInsertRowAbove: No row selected");return}console.log(`Inserting row above index ${n}`);const _=ps(e,n);if(_){if(console.log("Row inserted successfully, updating content"),a&&a.current){const C=a.current.innerHTML;console.log("Updated content length:",C.length),w.updateContinuousContent(C)}else console.warn("No editor ref available to update content");w.recordOperation({type:"INSERT_ROW",payload:{element:e,row:_,position:"above",index:n}},{type:"DELETE_ROW",payload:{element:e,index:n}}),v(e)}else console.error("Failed to insert row above")},R=()=>{if(console.log("handleInsertRowBelow called",{selectedRowIndex:n,tableElement:e,hasEditorRef:!!a}),!e){console.warn("handleInsertRowBelow: No table element");return}if(n==null){console.warn("handleInsertRowBelow: No row selected");return}console.log(`Inserting row below index ${n}`);const _=gs(e,n);if(_){if(console.log("Row inserted successfully, updating content"),a&&a.current){const C=a.current.innerHTML;console.log("Updated content length:",C.length),w.updateContinuousContent(C)}else console.warn("No editor ref available to update content");w.recordOperation({type:"INSERT_ROW",payload:{element:e,row:_,position:"below",index:n}},{type:"DELETE_ROW",payload:{element:e,index:n+1}}),v(e)}else console.error("Failed to insert row below")},O={border:"1px solid #ccc",borderRadius:"4px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"28px",height:"28px"},B=_=>({...O,background:_?"#007bff":"transparent",color:_?"#fff":"#333"});return!e||typeof document>"u"?null:jt.createPortal(m.jsxs("div",{ref:c,className:"table-tooltip-menu","data-menu-position":l,"aria-hidden":!i,style:{position:"fixed",top:`${s.top}px`,left:`${s.left}px`,zIndex:999,background:"#fff",border:"1px solid #ddd",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"8px",display:"flex",gap:"2px",alignItems:"center",pointerEvents:i?"auto":"none",minWidth:"100px",minHeight:"32px",opacity:i?1:0,visibility:i?"visible":"hidden",transition:"opacity 0.15s ease, visibility 0.15s ease"},children:[m.jsx("button",{className:`tooltip-button ${M==="left"?"active":""}`,onClick:()=>h("left"),title:"Align Left",style:B(M==="left"),children:m.jsx(St,{size:14})}),m.jsx("button",{className:`tooltip-button ${M==="center"?"active":""}`,onClick:()=>h("center"),title:"Align Center",style:B(M==="center"),children:m.jsx(At,{size:14})}),m.jsx("button",{className:`tooltip-button ${M==="right"?"active":""}`,onClick:()=>h("right"),title:"Align Right",style:B(M==="right"),children:m.jsx(_t,{size:14})}),n!=null&&m.jsxs(m.Fragment,{children:[m.jsx("div",{style:{width:"1px",height:"24px",background:"#ddd",margin:"0 4px"}}),m.jsx("button",{className:"tooltip-button insert-row-above",onClick:y,title:"Insert Row Above",style:{...O,background:"#28a745",color:"#fff"},disabled:n==null,children:m.jsx(vo,{size:14})}),m.jsx("button",{className:"tooltip-button insert-row-below",onClick:R,title:"Insert Row Below",style:{...O,background:"#28a745",color:"#fff"},disabled:n==null,children:m.jsx(To,{size:14})})]})]}),document.body)};Mt.propTypes={tableElement:T.instanceOf(typeof Element<"u"?Element:Object),onAlignChange:T.func,onClose:T.func.isRequired,selectedRowIndex:T.number,editorRef:T.shape({current:T.instanceOf(typeof Element<"u"?Element:Object)})},Mt.defaultProps={tableElement:null,onAlignChange:void 0,selectedRowIndex:null,editorRef:null};const Rt=({editorRef:e,onCellSelectionChange:t})=>{const[r,n]=d.useState(new Set),[a,s]=d.useState(null),[o,i]=d.useState(null),[g,l]=d.useState(null),[f,c]=d.useState(!1),[u,w]=d.useState(!1),[v,x]=d.useState(null),[k,M]=d.useState(null);ge(),d.useRef(null);const z=d.useCallback(()=>{n(new Set),s(null),i(null),l(null),x(null),M(null),c(!1),w(!1),document.querySelectorAll(".table-cell-selected, .table-row-selected, .table-col-selected").forEach(C=>{C.classList.remove("table-cell-selected","table-row-selected","table-col-selected")}),t&&t(null)},[t]),N=d.useCallback(C=>{const D=C.closest("tr"),E=C.closest("table");if(!D||!E)return null;const L=Array.from(E.rows).indexOf(D),V=Array.from(D.cells).indexOf(C);return{rowIndex:L,cellIndex:V,table:E}},[]),b=d.useCallback(C=>{if(C.size===0)return{mode:null,rowIndex:null,colIndex:null};const D=Array.from(C),E=D[0],L=N(E);if(!L)return{mode:null,rowIndex:null,colIndex:null};const{table:V}=L;return D.filter(oe=>{const re=N(oe);return re&&re.table===V&&re.rowIndex===L.rowIndex}).length>=2?{mode:"row",rowIndex:L.rowIndex,colIndex:null}:D.filter(oe=>{const re=N(oe);return re&&re.table===V&&re.cellIndex===L.cellIndex}).length>=2?{mode:"column",rowIndex:null,colIndex:L.cellIndex}:{mode:null,rowIndex:null,colIndex:null}},[N]),h=d.useCallback((C,D,E,L,V)=>{if(document.querySelectorAll(".table-cell-selected, .table-row-selected, .table-col-selected").forEach(Z=>{Z.classList.remove("table-cell-selected","table-row-selected","table-col-selected")}),!(!V||!C)){if(C==="row"&&D!==null){const Z=V.rows[D];Z&&Array.from(Z.cells).forEach(ee=>{ee.classList.add("table-row-selected")})}else C==="column"&&E!==null?Array.from(V.rows).forEach(Z=>{const ee=Z.cells[E];ee&&ee.classList.add("table-col-selected")}):C==="cells"&&L.forEach(Z=>{Z.classList.add("table-cell-selected")});window.getSelection&&window.getSelection().removeAllRanges()}},[]),y=d.useCallback((C,D)=>{const E=b(C);n(C),s(E.mode),i(E.rowIndex),l(E.colIndex),M(D),h(E.mode,E.rowIndex,E.colIndex,C,D),t&&E.mode&&t({mode:E.mode,cells:C,rowIndex:E.rowIndex,colIndex:E.colIndex,table:D})},[b,h,t]),R=d.useCallback(C=>{const D=C.target.closest("td, th");if(!D)return;const E=N(D);E&&(c(!0),x(D),M(E.table),w(!1))},[N]),O=d.useCallback(C=>{if(!f||!v)return;const D=C.target.closest("td, th");if(!D||!k||!k.contains(D))return;w(!0),C.preventDefault();const E=N(v),L=N(D);if(!E||!L||E.table!==L.table)return;const V=Math.min(E.rowIndex,L.rowIndex),Z=Math.max(E.rowIndex,L.rowIndex),ee=Math.min(E.cellIndex,L.cellIndex),oe=Math.max(E.cellIndex,L.cellIndex),re=new Set;for(let A=V;A<=Z;A++){const p=k.rows[A];if(p)for(let S=ee;S<=oe;S++){const j=p.cells[S];j&&re.add(j)}}y(re,k)},[f,N]),B=d.useCallback(()=>{u||z(),c(!1),x(null)},[u,z]),_=d.useCallback(C=>{const D=C.target.closest("td, th"),E=C.target.closest("table");if(!(D&&k&&k.contains(D))){if(E&&E!==k){z();return}E||z()}},[z,k]);return d.useEffect(()=>{if(!e.current)return;const C=e.current,D=L=>{L.target.closest("td, th")&&R(L)},E=L=>{L.target.closest("td, th")&&O(L)};return C.addEventListener("mousedown",D,!0),C.addEventListener("mouseenter",E,!0),document.addEventListener("mouseup",B),document.addEventListener("click",_),()=>{C.removeEventListener("mousedown",D,!0),C.removeEventListener("mouseenter",E,!0),document.removeEventListener("mouseup",B),document.removeEventListener("click",_)}},[e,R,O,B,_]),d.useEffect(()=>{if(!e.current)return;const C=new MutationObserver(D=>{D.forEach(E=>{E.type==="childList"&&k&&!e.current.contains(k)&&z()})});return C.observe(e.current,{childList:!0,subtree:!0}),()=>C.disconnect()},[e,z]),null};Rt.propTypes={editorRef:T.shape({current:T.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onCellSelectionChange:T.func},Rt.defaultProps={onCellSelectionChange:void 0};const hs=50,Lt=50,ms=50,ys=100,bs=300,et=d.forwardRef(({pageManagerComponent:e=null,onNavigatePage:t,onAddPage:r,onDeletePage:n,onPageSizeChange:a,onPageMarginsChange:s,onChange:o,showSidebar:i=!0,showToolbar:g=!0,showPageManager:l=!0},f)=>{const c=mt(),u=ge(),{pageSize:w,pageMargins:v,continuousContent:x,pageBoundaries:k,activePage:M,zoomLevel:z,canUndo:N,canRedo:b}=c,h=d.useRef(null),y=d.useRef(null),{currentFormat:R,formatText:O,updateCurrentFormatFromSelection:B}=un(),[_,C]=d.useState(!1),[D,E]=d.useState(null),[L,V]=d.useState(!0),[Z,ee]=d.useState(!1),[oe,re]=d.useState(null),[A,p]=d.useState(null),S=d.useRef(null),{checkAndUpdateBoundaries:j,getCurrentPage:I,scrollToPage:G,updateBoundaries:W,triggerAutoReflow:$,removePageAndContent:Y,removePageBreak:X,insertPageBreakAtBoundary:K}=yn(w,y,z,v),ie=d.useMemo(()=>je(w),[w]),[H,le]=d.useState(!1),ue=d.useRef(null),xe=d.useRef(!1),tt=d.useRef(!1),Dt=d.useRef(!1),Ce=d.useRef(x);d.useEffect(()=>{if(y.current){if(!Dt.current){y.current.innerHTML=x,Dt.current=!0,Ce.current=x;const P=setTimeout(()=>{W()},hs);return()=>clearTimeout(P)}if(Ce.current!==x){if(y.current.innerHTML!==x){y.current.innerHTML=x;const Q=setTimeout(()=>{W(),xe.current&&Vn()},Lt);return Ce.current=x,()=>clearTimeout(Q)}Ce.current=x}}},[x,W,k.length,u,G]),d.useEffect(()=>{o&&Dt.current&&o(x)},[x,o]);const Yn=d.useMemo(()=>({getHTMLContent:()=>y.current?y.current.innerHTML:x,getPlainText:()=>(y.current?y.current.innerHTML:x).replace(/<[^>]*>/g," ").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\s+/g," ").trim(),getCursorPosition:()=>y.current?Vr(y.current):null,setContent:P=>{const Q=Ze(P);Q!==x&&u.updateContinuousContent(Q),y.current&&y.current.innerHTML!==Q&&(y.current.innerHTML=Q),Ce.current=Q,y.current&&setTimeout(()=>{W()},Lt)},insertContent:P=>{if(!y.current||!P)return;const Q=Ze(P),se=window.getSelection();let de=!1;if(se&&se.rangeCount>0){const Bt=se.getRangeAt(0);y.current.contains(Bt.commonAncestorContainer)&&(de=!0)}if(!de&&S.current)try{se.removeAllRanges(),se.addRange(S.current)}catch(Bt){console.warn("[insertContent] Failed to restore last cursor position:",Bt);const Ie=y.current.lastChild;if(Ie){const st=document.createRange();Ie.nodeType===Node.TEXT_NODE?st.setStart(Ie,Ie.textContent.length):st.setStartAfter(Ie),st.collapse(!0),se.removeAllRanges(),se.addRange(st)}}document.execCommand("insertHTML",!1,Q);const be=y.current.innerHTML;u.updateContinuousContent(be),Ce.current=be,setTimeout(()=>{W(),$(200)},Lt)}}),[x,u,W,y,S,j]);d.useImperativeHandle(f,()=>Yn,[Yn]),d.useEffect(()=>{const P=()=>{if(B(),y.current){const se=window.getSelection();if(se.rangeCount>0){const de=se.getRangeAt(0);de.collapsed&&y.current.contains(de.commonAncestorContainer)&&(S.current=de.cloneRange())}}};document.addEventListener("selectionchange",P);const Q=()=>{if(setTimeout(B,10),S.current&&y.current)try{const se=window.getSelection();se.removeAllRanges(),se.addRange(S.current)}catch(se){console.warn("[handleFocus] Failed to restore cursor:",se)}};return y.current&&y.current.addEventListener("focus",Q),()=>{document.removeEventListener("selectionchange",P),y.current&&y.current.removeEventListener("focus",Q)}},[B]);const Vn=d.useCallback(()=>{xe.current=!1;const P=Math.max(0,k.length-1);u.setActivePage(P),setTimeout(()=>{G(P,h)},ms)},[k.length,u,G]),Ht=d.useCallback(()=>{if(!y.current)return;let P=y.current.innerHTML;P=Ze(P),P!==y.current.innerHTML&&(y.current.innerHTML=P);const Q=x;if(Q!==P){const de={type:"UPDATE_CONTINUOUS_CONTENT",payload:P},be={type:"UPDATE_CONTINUOUS_CONTENT",payload:Q};u.recordOperation(de,be)}u.updateContinuousContent(P),j(),$(200);const se=I(h);se!==M&&u.setActivePage(se)},[u,j,I,M,$,h,y,x]),Es=d.useCallback(P=>{Ht()},[Ht]),Kn=d.useCallback(P=>{u.updatePageSize(P),W({pageSize:P}),a&&a(P)},[u,W,a]),Xn=d.useCallback(P=>{u.updatePageMargins(P),W({pageMargins:P}),s&&s(P)},[u,W,s]),Jn=d.useCallback(P=>{P<0||P>=k.length||(tt.current=!0,u.setActivePage(P),G(P,h),setTimeout(()=>{tt.current=!1},bs),t&&t(P))},[u,G,t,k.length]),Qn=d.useCallback(()=>{const P=k.length+1;K(P)&&(xe.current=!0,setTimeout(()=>{xe.current&&Vn()},100)),r&&r()},[k.length,K,u,G,r]),Ts=d.useCallback(()=>{const P=window.getSelection();if(P&&P.rangeCount>0){if(!y?.current)return;const de=`<page-break data-page-break="true" contenteditable="false" data-page-number="${y.current.querySelectorAll('page-break, [data-page-break="true"]').length+2}"></page-break><p><br></p>`;document.execCommand("insertHTML",!1,de),setTimeout(()=>{W();const be=I(h);u.setActivePage(be)},150)}},[W,I,u,h]),vs=d.useCallback(P=>{if(!P)return;X(P)&&setTimeout(()=>{const se=I(h);u.setActivePage(se)},200)},[X,I,u,h]),er=d.useCallback(P=>{if(k.length<=1){console.warn("Cannot delete the only page");return}Y(P)&&(u.setActivePage(0),n&&n(P))},[k.length,Y,u,n]),nt=d.useCallback(()=>{u.zoomIn()},[u]),rt=d.useCallback(()=>{u.zoomOut()},[u]),ot=d.useCallback(()=>{u.resetZoom()},[u]),tr=d.useCallback(()=>{u.undo()},[u]),nr=d.useCallback(()=>{u.redo()},[u]);d.useEffect(()=>{const P=Q=>{if(Q.ctrlKey||Q.metaKey){["+","=","-","_","0","z","y"].includes(Q.key)&&Q.preventDefault();const se=document.activeElement===y.current,de=document.activeElement===h.current,be=document.activeElement?.tagName==="INPUT"||document.activeElement?.tagName==="TEXTAREA"||document.activeElement?.isContentEditable===!1;if(se||de||!be)switch(Q.key){case"+":case"=":nt();break;case"-":case"_":rt();break;case"0":ot();break;case"z":Q.shiftKey||tr();break;case"y":nr();break}}};return window.addEventListener("keydown",P),()=>{window.removeEventListener("keydown",P)}},[nt,rt,ot,tr,nr]);const ws=d.useCallback(()=>{!h.current||!y.current||tt.current||(ue.current&&clearTimeout(ue.current),ue.current=setTimeout(()=>{if(tt.current){ue.current=null;return}const P=I(h);P!==M&&P>=0&&u.setActivePage(P),ue.current=null},ys))},[I,M,u]),xs=d.useMemo(()=>{if(!x)return 0;const Q=x.replace(/<[^>]*>/g," ").match(new RegExp("\\p{L}+","gu"));return Q?Q.length:0},[x]),Cs=k.length||1,As=d.useCallback(P=>{C(!0),E(P)},[]),rr=d.useCallback(()=>{C(!1),E(null)},[]),_s=d.useCallback((P,Q)=>{},[]),Ss=d.useCallback(P=>{ee(!0),re(P)},[]),or=d.useCallback(()=>{ee(!1),re(null)},[]),ks=d.useCallback((P,Q)=>{},[]);return d.useEffect(()=>()=>{ue.current&&clearTimeout(ue.current)},[]),m.jsxs("div",{className:"multi-page-editor",children:[g&&m.jsx(Ve,{currentFormat:{...R,imageSelected:_},onFormatText:O,onAddPageBreak:Ts,canUndo:N,canRedo:b}),m.jsxs("div",{className:"editor-container",children:[i&&m.jsx(On,{editorView:null,isCollapsed:H,onToggle:()=>le(P=>!P),wordCount:xs,pageCount:Cs}),m.jsx("div",{className:"editor-viewport continuous-scroll",ref:h,onScroll:ws,children:m.jsx(In,{content:x,dimensions:ie,pageSize:w,pageMargins:v,pageBoundaries:k,editorRef:y,onInput:Es,onContentChange:Ht,onClick:()=>y.current?.focus(),onRemovePageBreak:vs,zoomLevel:z})}),m.jsx(Ke,{editorRef:y,onImageSelect:As,onImageDeselect:rr,onImageResize:_s,resizeOptions:{...ve,preserveAspectRatio:L,aspectRatio:L}}),m.jsx(Qe,{editorRef:y,onTableSelect:Ss,onTableDeselect:or,onTableResize:ks}),m.jsx(Rt,{editorRef:y,onCellSelectionChange:P=>{console.log("onCellSelectionChange:",P),P&&P.mode==="row"?(console.log("Row selected with index:",P.rowIndex),p(P.rowIndex)):(console.log("No row selected, clearing selection"),p(null))}}),_&&D&&m.jsx(Nt,{imageElement:D,initialPreserveAspectRatio:L,onAlignChange:P=>{},onAspectRatioToggle:P=>{V(P)},onDelete:()=>{if(D){const P=D.getAttribute("data-key");P&&wn(P).catch(Q=>{console.error("Failed to delete image from IndexedDB:",Q)})}},onClose:rr}),Z&&oe&&m.jsx(Mt,{tableElement:oe,onAlignChange:P=>{},onClose:or,selectedRowIndex:A,editorRef:y}),l&&m.jsx("div",{className:"page-manager-sidebar",children:e?d.cloneElement(e,{onNavigate:Jn,onAddPage:Qn,onDeletePage:er,onPageSizeChange:Kn,onPageMarginsChange:Xn,zoomLevel:z,canZoomIn:ut(z),canZoomOut:dt(z),onZoomIn:nt,onZoomOut:rt,onZoomReset:ot}):m.jsx(Dn,{pageBoundaries:k,activePage:M,pageSize:w,pageMargins:v,zoomLevel:z,canZoomIn:ut(z),canZoomOut:dt(z),onNavigate:Jn,onAddPage:Qn,onDeletePage:er,onPageSizeChange:Kn,onPageMarginsChange:Xn,onZoomIn:nt,onZoomOut:rt,onZoomReset:ot})})]})]})});et.displayName="HtmlEditor",et.propTypes={pageManagerComponent:T.element,onNavigatePage:T.func,onAddPage:T.func,onDeletePage:T.func,onPageSizeChange:T.func,onPageMarginsChange:T.func,onChange:T.func,showSidebar:T.bool,showToolbar:T.bool,showPageManager:T.bool},et.defaultProps={pageManagerComponent:null,onNavigatePage:void 0,onAddPage:void 0,onDeletePage:void 0,onPageSizeChange:void 0,onPageMarginsChange:void 0,onChange:void 0,showSidebar:!0,showToolbar:!0,showPageManager:!0};class It extends d.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,r){console.error("[ErrorBoundary] Caught error:",t),console.error("[ErrorBoundary] Error info:",r),this.setState({error:t,errorInfo:r}),this.props.onError&&this.props.onError(t,r)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onReset&&this.props.onReset()};render(){return this.state.hasError?this.props.fallback?this.props.fallback:m.jsxs("div",{style:{padding:"20px",margin:"20px",border:"2px solid #f44336",borderRadius:"4px",backgroundColor:"#ffebee",color:"#c62828"},children:[m.jsx("h2",{style:{marginTop:0},children:"⚠️ Something went wrong"}),m.jsx("p",{children:"The editor encountered an unexpected error and couldn't continue."}),this.props.showDetails&&this.state.error&&m.jsxs("details",{style:{marginTop:"10px",padding:"10px",backgroundColor:"white",borderRadius:"4px",fontSize:"12px",fontFamily:"monospace"},children:[m.jsx("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Error Details"}),m.jsxs("pre",{style:{marginTop:"10px",overflow:"auto",maxHeight:"200px"},children:[this.state.error.toString(),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}),m.jsx("button",{onClick:this.handleReset,style:{marginTop:"15px",padding:"8px 16px",backgroundColor:"#f44336",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:"Try Again"})]}):this.props.children}}It.propTypes={children:T.node.isRequired,fallback:T.node,onError:T.func,onReset:T.func,showDetails:T.bool},It.defaultProps={fallback:null,onError:void 0,onReset:void 0,showDetails:process.env.NODE_ENV==="development"},U.COMMON_FONT_SIZES=sn,U.DEFAULT_FONT_SIZE=Oe,U.DEFAULT_IMAGE_RESIZE_OPTIONS=ve,U.DEFAULT_PAGE_SIZE=ft,U.DEFAULT_TABLE_RESIZE_OPTIONS=Me,U.DocumentProvider=yr,U.EditorToolbar=Ve,U.ErrorBoundary=It,U.FONT_SIZE_MAP=Ct,U.HtmlEditor=et,U.ImageResizeHandlers=Ke,U.PAGE_SIZES=Ee,U.PageManager=Dn,U.PageView=In,U.RESIZE_HANDLERS=F,U.Sidebar=On,U.TABLE_RESIZE_HANDLERS=ae,U.TableResizeHandlers=Qe,U.applyImageDimensions=Qr,U.applyTableDimensions=Xe,U.calculateResizeDimensions=Xr,U.calculateTableResizeDimensions=Bn,U.clearImages=oo,U.createResizeOverlay=bn,U.createTableResizeOverlay=jn,U.deleteImage=wn,U.getAllImageKeys=so,U.getAvailablePageSizes=gr,U.getImage=vn,U.getImageDimensions=Jr,U.getPageDimensions=je,U.getPixelValue=_r,U.getPointValue=Sr,U.getTableStructure=ye,U.isResizableImage=he,U.isResizableTable=fe,U.isValidFontSize=kr,U.isValidPageSize=pr,U.logger=Pn,U.pixelsToPoints=cn,U.pointsToPixels=an,U.removeResizeOverlay=qe,U.removeTableResizeOverlay=Le,U.saveImage=Tn,U.updateResizeOverlay=Ge,U.updateTableResizeOverlay=Je,U.useContinuousReflow=yn,U.useDocument=ht,U.useDocumentActions=ge,U.useDocumentState=mt,U.useFormatting=un,Object.defineProperty(U,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=htmleditor.umd.cjs.map
