(function(D,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("react"),require("uuid"),require("react-dom")):typeof define=="function"&&define.amd?define(["exports","react","uuid","react-dom"],g):(D=typeof globalThis<"u"?globalThis:D||self,g(D.HTMLEditor={},D.React,D.uuid,D.ReactDOM))})(this,(function(D,g,Ve,wn){"use strict";function On(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var we={exports:{}},ve={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vt;function Nn(){if(vt)return ve;vt=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function r(n,s,a){var o=null;if(a!==void 0&&(o=""+a),s.key!==void 0&&(o=""+s.key),"key"in s){a={};for(var i in s)i!=="key"&&(a[i]=s[i])}else a=s;return s=a.ref,{$$typeof:e,type:n,key:o,ref:s!==void 0?s:null,props:a}}return ve.Fragment=t,ve.jsx=r,ve.jsxs=r,ve}var xe={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xt;function Mn(){return xt||(xt=1,process.env.NODE_ENV!=="production"&&(function(){function e(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===re?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case S:return"Fragment";case j:return"Profiler";case I:return"StrictMode";case y:return"Suspense";case M:return"SuspenseList";case se:return"Activity"}if(typeof u=="object")switch(typeof u.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),u.$$typeof){case x:return"Portal";case E:return u.displayName||"Context";case L:return(u._context.displayName||"Context")+".Consumer";case d:var A=u.render;return u=u.displayName,u||(u=A.displayName||A.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case q:return A=u.displayName||null,A!==null?A:e(u.type)||"Memo";case K:A=u._payload,u=u._init;try{return e(u(A))}catch{}}return null}function t(u){return""+u}function r(u){try{t(u);var A=!1}catch{A=!0}if(A){A=console;var w=A.error,C=typeof Symbol=="function"&&Symbol.toStringTag&&u[Symbol.toStringTag]||u.constructor.name||"Object";return w.call(A,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",C),t(u)}}function n(u){if(u===S)return"<>";if(typeof u=="object"&&u!==null&&u.$$typeof===K)return"<...>";try{var A=e(u);return A?"<"+A+">":"<...>"}catch{return"<...>"}}function s(){var u=ne.A;return u===null?null:u.getOwner()}function a(){return Error("react-stack-top-frame")}function o(u){if(O.call(u,"key")){var A=Object.getOwnPropertyDescriptor(u,"key").get;if(A&&A.isReactWarning)return!1}return u.key!==void 0}function i(u,A){function w(){X||(X=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",A))}w.isReactWarning=!0,Object.defineProperty(u,"key",{get:w,configurable:!0})}function h(){var u=e(this.type);return Q[u]||(Q[u]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),u=this.props.ref,u!==void 0?u:null}function f(u,A,w,C,z,H){var R=w.ref;return u={$$typeof:v,type:u,key:A,props:w,_owner:C},(R!==void 0?R:null)!==null?Object.defineProperty(u,"ref",{enumerable:!1,get:h}):Object.defineProperty(u,"ref",{enumerable:!1,value:null}),u._store={},Object.defineProperty(u._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(u,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(u,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:z}),Object.defineProperty(u,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:H}),Object.freeze&&(Object.freeze(u.props),Object.freeze(u)),u}function p(u,A,w,C,z,H){var R=A.children;if(R!==void 0)if(C)if(G(R)){for(C=0;C<R.length;C++)c(R[C]);Object.freeze&&Object.freeze(R)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else c(R);if(O.call(A,"key")){R=e(u);var B=Object.keys(A).filter(function(F){return F!=="key"});C=0<B.length?"{key: someKey, "+B.join(": ..., ")+": ...}":"{key: someKey}",b[R+C]||(B=0<B.length?"{"+B.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,C,R,B,R),b[R+C]=!0)}if(R=null,w!==void 0&&(r(w),R=""+w),o(A)&&(r(A.key),R=""+A.key),"key"in A){w={};for(var U in A)U!=="key"&&(w[U]=A[U])}else w=A;return R&&i(w,typeof u=="function"?u.displayName||u.name||"Unknown":u),f(u,R,w,s(),z,H)}function c(u){l(u)?u._store&&(u._store.validated=1):typeof u=="object"&&u!==null&&u.$$typeof===K&&(u._payload.status==="fulfilled"?l(u._payload.value)&&u._payload.value._store&&(u._payload.value._store.validated=1):u._store&&(u._store.validated=1))}function l(u){return typeof u=="object"&&u!==null&&u.$$typeof===v}var T=g,v=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),L=Symbol.for("react.consumer"),E=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),q=Symbol.for("react.memo"),K=Symbol.for("react.lazy"),se=Symbol.for("react.activity"),re=Symbol.for("react.client.reference"),ne=T.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O=Object.prototype.hasOwnProperty,G=Array.isArray,te=console.createTask?console.createTask:function(){return null};T={react_stack_bottom_frame:function(u){return u()}};var X,Q={},ee=T.react_stack_bottom_frame.bind(T,a)(),ae=te(n(a)),b={};xe.Fragment=S,xe.jsx=function(u,A,w){var C=1e4>ne.recentlyCreatedOwnerStacks++;return p(u,A,w,!1,C?Error("react-stack-top-frame"):ee,C?te(n(u)):ae)},xe.jsxs=function(u,A,w){var C=1e4>ne.recentlyCreatedOwnerStacks++;return p(u,A,w,!0,C?Error("react-stack-top-frame"):ee,C?te(n(u)):ae)}})()),xe}var _t;function Rn(){return _t||(_t=1,process.env.NODE_ENV==="production"?we.exports=Nn():we.exports=Mn()),we.exports}var m=Rn();const Ke=100,Xe=50,Je=200,At=5,Qe=e=>e<Je,et=e=>e>Xe,In=96,Oe=e=>Math.round(e*In),Ne={NORMAL:{name:"Normal",label:'Normal (1")',top:1,bottom:1,left:1,right:1},NARROW:{name:"Narrow",label:'Narrow (0.5")',top:.5,bottom:.5,left:.5,right:.5},MODERATE:{name:"Moderate",label:'Moderate (1" / 0.75")',top:1,bottom:1,left:.75,right:.75},WIDE:{name:"Wide",label:'Wide (1" / 2")',top:1,bottom:1,left:2,right:2},OFFICE_2003:{name:"Office 2003",label:'Office 2003 (1" / 1.25")',top:1,bottom:1,left:1.25,right:1.25}},de="NORMAL",kt=(e=de)=>{const t=Ne[e]||Ne[de];return{top:Oe(t.top),bottom:Oe(t.bottom),left:Oe(t.left),right:Oe(t.right)}},Ln=(e=de)=>{const t=kt(e);return t.top+t.bottom},Dn=()=>Object.keys(Ne),jn=e=>{const t=Ne[e];return t?t.label:"Unknown"},ie={A4:{name:"A4",width:794,height:1123,widthMm:210,heightMm:297,widthIn:8.27,heightIn:11.69},Letter:{name:"Letter",width:816,height:1056,widthMm:216,heightMm:279,widthIn:8.5,heightIn:11},Legal:{name:"Legal",width:816,height:1344,widthMm:216,heightMm:356,widthIn:8.5,heightIn:14}},tt="A4",Me=e=>{const t=ie[e]||ie[tt];return{width:t.width,height:t.height}},Bn=e=>Object.keys(ie).includes(e),$n=()=>Object.keys(ie),_e=tt,he="<p><br></p>",Hn="continuous",Ae=(e,t=_e)=>({id:Ve.v4(),index:e,size:t,content:he,images:[],isBreakPoint:!1}),Re=e=>typeof e!="string"||e.trim()===""?he:e,St=(e,t=_e)=>(e.length>0?e:[Ae(0,t)]).map((n,s)=>({id:n.id||Ve.v4(),index:s,size:n.size||t,content:Re(n.content),images:n.images||[],isBreakPoint:!!n.isBreakPoint})),zn=(e=_e)=>[{id:"page-0",pageNumber:1,top:0,height:Me(e).height}],Ie=e=>e.slice(0,-1).map((t,r)=>({id:`auto-break-${r}`,pageNumber:r+1})),nt=(e={})=>{const t=new Date().toISOString(),r=e.pageSize||_e,n=St(e.pages||[Ae(0,r)],r);return{id:Ve.v4(),title:e.title||"Untitled Document",createdAt:t,updatedAt:t,pageSize:r,pages:n,activePage:e.activePage&&e.activePage<n.length?e.activePage:0,pageBreaks:e.pageBreaks||[],totalPages:n.length,editorMode:e.editorMode||Hn,continuousContent:e.continuousContent||he,pageBoundaries:e.pageBoundaries||zn(r),zoomLevel:e.zoomLevel||Ke,pageMargins:e.pageMargins||de,undoStack:[],redoStack:[],canUndo:!1,canRedo:!1}},$={INITIALIZE_DOCUMENT:"INITIALIZE_DOCUMENT",UPDATE_TITLE:"UPDATE_TITLE",UPDATE_PAGE_CONTENT:"UPDATE_PAGE_CONTENT",UPDATE_PAGES:"UPDATE_PAGES",ADD_PAGE:"ADD_PAGE",DELETE_PAGE:"DELETE_PAGE",SET_ACTIVE_PAGE:"SET_ACTIVE_PAGE",UPDATE_PAGE_SIZE:"UPDATE_PAGE_SIZE",RESET_DOCUMENT:"RESET_DOCUMENT",UPDATE_CONTINUOUS_CONTENT:"UPDATE_CONTINUOUS_CONTENT",UPDATE_PAGE_BOUNDARIES:"UPDATE_PAGE_BOUNDARIES",ADD_PAGE_BREAK:"ADD_PAGE_BREAK",REMOVE_PAGE_BREAK:"REMOVE_PAGE_BREAK",SET_EDITOR_MODE:"SET_EDITOR_MODE",SET_ZOOM_LEVEL:"SET_ZOOM_LEVEL",ZOOM_IN:"ZOOM_IN",ZOOM_OUT:"ZOOM_OUT",RESET_ZOOM:"RESET_ZOOM",UPDATE_PAGE_MARGINS:"UPDATE_PAGE_MARGINS",RECORD_OPERATION:"RECORD_OPERATION",UNDO:"UNDO",REDO:"REDO",CLEAR_UNDO_REDO:"CLEAR_UNDO_REDO"},rt=(e,t)=>{const r=new Date().toISOString();switch(t.type){case $.INITIALIZE_DOCUMENT:{const{initialContent:n=he,pageSize:s=_e}=t.payload||{},a={...Ae(0,s),content:Re(n)};return nt({title:e.title,pageSize:s,pages:[a]})}case $.UPDATE_TITLE:return{...e,title:t.payload,updatedAt:r};case $.UPDATE_PAGE_CONTENT:{const{pageIndex:n,content:s}=t.payload;if(n<0||n>=e.pages.length)return e;const a=[...e.pages];return a[n]={...a[n],content:Re(s)},{...e,pages:a,updatedAt:r}}case $.UPDATE_PAGES:{const n=Array.isArray(t.payload)?{pages:t.payload}:t.payload||{},s=St(n.pages||[],e.pageSize),a=Array.isArray(n.pageBreaks)?n.pageBreaks:Ie(s);return{...e,pages:s,activePage:Math.min(e.activePage,s.length-1),pageBreaks:a,totalPages:s.length,updatedAt:r}}case $.ADD_PAGE:{const n=typeof t.payload?.index=="number"?Math.min(Math.max(t.payload.index,0),e.pages.length):e.pages.length,s=[...e.pages];s.splice(n,0,Ae(n,e.pageSize));const a=s.map((i,h)=>({...i,index:h,size:e.pageSize})),o=Ie(a);return{...e,pages:a,activePage:n,pageBreaks:o,totalPages:a.length,updatedAt:r}}case $.DELETE_PAGE:{const n=t.payload;if(e.pages.length<=1)return e;const s=[...e.pages];s.splice(n,1);const a=s.map((h,f)=>({...h,index:f,size:e.pageSize}));let o=e.activePage;o>=a.length?o=a.length-1:n<=o&&o>0&&(o-=1);const i=Ie(a);return{...e,pages:a,activePage:o,pageBreaks:i,totalPages:a.length,updatedAt:r}}case $.SET_ACTIVE_PAGE:{const n=t.payload;if(n===e.activePage)return e;const s=e.editorMode==="continuous"?e.pageBoundaries.length:e.pages.length;return n<0||n>=s?e:{...e,activePage:n,updatedAt:r}}case $.UPDATE_PAGE_SIZE:{const n=t.payload;if(n===e.pageSize)return e;try{Me(n)}catch{return console.warn(`Invalid page size: ${n}`),e}const s=e.pages.map((o,i)=>({...o,index:i,size:n})),a=Ie(s);return{...e,pageSize:n,pages:s,pageBreaks:a,updatedAt:r}}case $.RESET_DOCUMENT:return nt();case $.UPDATE_CONTINUOUS_CONTENT:{const n=Re(t.payload);return n===e.continuousContent?e:{...e,continuousContent:n,updatedAt:r}}case $.UPDATE_PAGE_BOUNDARIES:{const n=Array.isArray(t.payload)?t.payload:[];if(n.length===e.pageBoundaries.length&&n.length>0&&n[0].id===e.pageBoundaries[0]?.id&&n[n.length-1].id===e.pageBoundaries[n.length-1]?.id)return e;const s=e.activePage>=n.length?Math.max(0,n.length-1):e.activePage;return{...e,pageBoundaries:n,totalPages:n.length,activePage:s,updatedAt:r}}case $.ADD_PAGE_BREAK:{const{position:n="end",pageIndex:s}=t.payload||{},a='<page-break data-page-break="true" style="display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;"></page-break>';let o=e.continuousContent;if(n==="end")o=o+a+"<p><br></p>";else if(typeof n=="number"){const i=o.substring(0,n),h=o.substring(n);o=i+a+h}else if(typeof s=="number"&&typeof document<"u"){const i=document.createElement("div");i.innerHTML=o;const h=i.querySelectorAll('page-break, [data-page-break="true"]');if(s===0&&h.length===0)o=o+a+"<p><br></p>";else if(s<h.length){const f=h[s],p=document.createElement("page-break");p.setAttribute("data-page-break","true"),p.setAttribute("style","display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;");const c=document.createElement("p");c.innerHTML="<br>",f.parentNode.insertBefore(p,f.nextSibling),p.parentNode.insertBefore(c,p.nextSibling),o=i.innerHTML}else o=o+a+"<p><br></p>"}return{...e,continuousContent:o,updatedAt:r}}case $.REMOVE_PAGE_BREAK:{const{pageIndex:n}=t.payload||{};if(typeof n!="number"||typeof document>"u")return e;const s=document.createElement("div");s.innerHTML=e.continuousContent;const a=s.querySelectorAll('page-break, [data-page-break="true"]');return a[n]&&a[n].remove(),s.querySelectorAll('page-break, [data-page-break="true"]').forEach((i,h)=>{i.setAttribute("data-page-number",String(h+2))}),{...e,continuousContent:s.innerHTML,updatedAt:r}}case $.SET_EDITOR_MODE:{const n=t.payload;if(n===e.editorMode)return e;let s=e.continuousContent,a=e.pages;return n==="continuous"?s=e.pages.map(i=>i.content).filter(i=>i&&i!==he).join(`
`)||he:e.continuousContent&&e.continuousContent!==he&&(a=[{...Ae(0,e.pageSize),content:e.continuousContent}]),{...e,editorMode:n,continuousContent:s,pages:a,updatedAt:r}}case $.SET_ZOOM_LEVEL:{const n=t.payload;return n<Xe||n>Je?(console.warn(`Invalid zoom level: ${n}. Must be between ${Xe} and ${Je}.`),e):n===e.zoomLevel?e:{...e,zoomLevel:n,updatedAt:r}}case $.ZOOM_IN:{if(!Qe(e.zoomLevel))return e;const n=e.zoomLevel+At;return{...e,zoomLevel:n,updatedAt:r}}case $.ZOOM_OUT:{if(!et(e.zoomLevel))return e;const n=e.zoomLevel-At;return{...e,zoomLevel:n,updatedAt:r}}case $.RESET_ZOOM:return e.zoomLevel===Ke?e:{...e,zoomLevel:Ke,updatedAt:r};case $.UPDATE_PAGE_MARGINS:{const n=t.payload;return n===e.pageMargins?e:{...e,pageMargins:n,updatedAt:r}}case $.RECORD_OPERATION:{const{operation:n,inverseOperation:s}=t.payload;return{...e,undoStack:[...e.undoStack,{operation:n,inverseOperation:s}],redoStack:[],canUndo:!0,canRedo:!1,updatedAt:r}}case $.UNDO:{if(e.undoStack.length===0)return e;const n=e.undoStack[e.undoStack.length-1],s=e.undoStack.slice(0,-1);let a=e;return n.inverseOperation&&(a=rt(e,n.inverseOperation)),{...a,undoStack:s,redoStack:[...e.redoStack,n],canUndo:s.length>0,canRedo:!0,updatedAt:r}}case $.REDO:{if(e.redoStack.length===0)return e;const n=e.redoStack[e.redoStack.length-1],s=e.redoStack.slice(0,-1);let a=e;return n.operation&&(a=rt(e,n.operation)),{...a,undoStack:[...e.undoStack,n],redoStack:s,canUndo:!0,canRedo:s.length>0,updatedAt:r}}case $.CLEAR_UNDO_REDO:return{...e,undoStack:[],redoStack:[],canUndo:!1,canRedo:!1,updatedAt:r};default:return e}},Pt=g.createContext(null),Fn=({children:e,initialState:t={}})=>{const[r,n]=g.useReducer(rt,nt(t)),s=g.useMemo(()=>({initializeDocument:o=>n({type:$.INITIALIZE_DOCUMENT,payload:o}),updateTitle:o=>n({type:$.UPDATE_TITLE,payload:o}),updatePageContent:o=>n({type:$.UPDATE_PAGE_CONTENT,payload:o}),updatePages:o=>n({type:$.UPDATE_PAGES,payload:o}),addPage:o=>n({type:$.ADD_PAGE,payload:o}),deletePage:o=>n({type:$.DELETE_PAGE,payload:o}),setActivePage:o=>n({type:$.SET_ACTIVE_PAGE,payload:o}),updatePageSize:o=>n({type:$.UPDATE_PAGE_SIZE,payload:o}),resetDocument:()=>n({type:$.RESET_DOCUMENT}),updateContinuousContent:o=>n({type:$.UPDATE_CONTINUOUS_CONTENT,payload:o}),updatePageBoundaries:o=>n({type:$.UPDATE_PAGE_BOUNDARIES,payload:o}),addPageBreak:o=>n({type:$.ADD_PAGE_BREAK,payload:o}),removePageBreak:o=>n({type:$.REMOVE_PAGE_BREAK,payload:o}),setEditorMode:o=>n({type:$.SET_EDITOR_MODE,payload:o}),setZoomLevel:o=>n({type:$.SET_ZOOM_LEVEL,payload:o}),zoomIn:()=>n({type:$.ZOOM_IN}),zoomOut:()=>n({type:$.ZOOM_OUT}),resetZoom:()=>n({type:$.RESET_ZOOM}),updatePageMargins:o=>n({type:$.UPDATE_PAGE_MARGINS,payload:o}),recordOperation:(o,i)=>n({type:$.RECORD_OPERATION,payload:{operation:o,inverseOperation:i}}),undo:()=>n({type:$.UNDO}),redo:()=>n({type:$.REDO}),clearUndoRedo:()=>n({type:$.CLEAR_UNDO_REDO})}),[]),a=g.useMemo(()=>({state:r,actions:s,dispatch:n}),[r,s]);return m.jsx(Pt.Provider,{value:a,children:e})},ot=()=>{const e=g.useContext(Pt);if(!e)throw new Error("useDocument must be used within a DocumentProvider");return e},at=()=>{const{state:e}=ot();return e},be=()=>{const{actions:e}=ot();return e};var Le={exports:{}},De={exports:{}},Y={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ct;function Un(){if(Ct)return Y;Ct=1;var e=typeof Symbol=="function"&&Symbol.for,t=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,n=e?Symbol.for("react.fragment"):60107,s=e?Symbol.for("react.strict_mode"):60108,a=e?Symbol.for("react.profiler"):60114,o=e?Symbol.for("react.provider"):60109,i=e?Symbol.for("react.context"):60110,h=e?Symbol.for("react.async_mode"):60111,f=e?Symbol.for("react.concurrent_mode"):60111,p=e?Symbol.for("react.forward_ref"):60112,c=e?Symbol.for("react.suspense"):60113,l=e?Symbol.for("react.suspense_list"):60120,T=e?Symbol.for("react.memo"):60115,v=e?Symbol.for("react.lazy"):60116,x=e?Symbol.for("react.block"):60121,S=e?Symbol.for("react.fundamental"):60117,I=e?Symbol.for("react.responder"):60118,j=e?Symbol.for("react.scope"):60119;function L(d){if(typeof d=="object"&&d!==null){var y=d.$$typeof;switch(y){case t:switch(d=d.type,d){case h:case f:case n:case a:case s:case c:return d;default:switch(d=d&&d.$$typeof,d){case i:case p:case v:case T:case o:return d;default:return y}}case r:return y}}}function E(d){return L(d)===f}return Y.AsyncMode=h,Y.ConcurrentMode=f,Y.ContextConsumer=i,Y.ContextProvider=o,Y.Element=t,Y.ForwardRef=p,Y.Fragment=n,Y.Lazy=v,Y.Memo=T,Y.Portal=r,Y.Profiler=a,Y.StrictMode=s,Y.Suspense=c,Y.isAsyncMode=function(d){return E(d)||L(d)===h},Y.isConcurrentMode=E,Y.isContextConsumer=function(d){return L(d)===i},Y.isContextProvider=function(d){return L(d)===o},Y.isElement=function(d){return typeof d=="object"&&d!==null&&d.$$typeof===t},Y.isForwardRef=function(d){return L(d)===p},Y.isFragment=function(d){return L(d)===n},Y.isLazy=function(d){return L(d)===v},Y.isMemo=function(d){return L(d)===T},Y.isPortal=function(d){return L(d)===r},Y.isProfiler=function(d){return L(d)===a},Y.isStrictMode=function(d){return L(d)===s},Y.isSuspense=function(d){return L(d)===c},Y.isValidElementType=function(d){return typeof d=="string"||typeof d=="function"||d===n||d===f||d===a||d===s||d===c||d===l||typeof d=="object"&&d!==null&&(d.$$typeof===v||d.$$typeof===T||d.$$typeof===o||d.$$typeof===i||d.$$typeof===p||d.$$typeof===S||d.$$typeof===I||d.$$typeof===j||d.$$typeof===x)},Y.typeOf=L,Y}var V={};/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wt;function Gn(){return wt||(wt=1,process.env.NODE_ENV!=="production"&&(function(){var e=typeof Symbol=="function"&&Symbol.for,t=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,n=e?Symbol.for("react.fragment"):60107,s=e?Symbol.for("react.strict_mode"):60108,a=e?Symbol.for("react.profiler"):60114,o=e?Symbol.for("react.provider"):60109,i=e?Symbol.for("react.context"):60110,h=e?Symbol.for("react.async_mode"):60111,f=e?Symbol.for("react.concurrent_mode"):60111,p=e?Symbol.for("react.forward_ref"):60112,c=e?Symbol.for("react.suspense"):60113,l=e?Symbol.for("react.suspense_list"):60120,T=e?Symbol.for("react.memo"):60115,v=e?Symbol.for("react.lazy"):60116,x=e?Symbol.for("react.block"):60121,S=e?Symbol.for("react.fundamental"):60117,I=e?Symbol.for("react.responder"):60118,j=e?Symbol.for("react.scope"):60119;function L(k){return typeof k=="string"||typeof k=="function"||k===n||k===f||k===a||k===s||k===c||k===l||typeof k=="object"&&k!==null&&(k.$$typeof===v||k.$$typeof===T||k.$$typeof===o||k.$$typeof===i||k.$$typeof===p||k.$$typeof===S||k.$$typeof===I||k.$$typeof===j||k.$$typeof===x)}function E(k){if(typeof k=="object"&&k!==null){var ce=k.$$typeof;switch(ce){case t:var Ee=k.type;switch(Ee){case h:case f:case n:case a:case s:case c:return Ee;default:var Te=Ee&&Ee.$$typeof;switch(Te){case i:case p:case v:case T:case o:return Te;default:return ce}}case r:return ce}}}var d=h,y=f,M=i,q=o,K=t,se=p,re=n,ne=v,O=T,G=r,te=a,X=s,Q=c,ee=!1;function ae(k){return ee||(ee=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),b(k)||E(k)===h}function b(k){return E(k)===f}function u(k){return E(k)===i}function A(k){return E(k)===o}function w(k){return typeof k=="object"&&k!==null&&k.$$typeof===t}function C(k){return E(k)===p}function z(k){return E(k)===n}function H(k){return E(k)===v}function R(k){return E(k)===T}function B(k){return E(k)===r}function U(k){return E(k)===a}function F(k){return E(k)===s}function oe(k){return E(k)===c}V.AsyncMode=d,V.ConcurrentMode=y,V.ContextConsumer=M,V.ContextProvider=q,V.Element=K,V.ForwardRef=se,V.Fragment=re,V.Lazy=ne,V.Memo=O,V.Portal=G,V.Profiler=te,V.StrictMode=X,V.Suspense=Q,V.isAsyncMode=ae,V.isConcurrentMode=b,V.isContextConsumer=u,V.isContextProvider=A,V.isElement=w,V.isForwardRef=C,V.isFragment=z,V.isLazy=H,V.isMemo=R,V.isPortal=B,V.isProfiler=U,V.isStrictMode=F,V.isSuspense=oe,V.isValidElementType=L,V.typeOf=E})()),V}var Ot;function Nt(){return Ot||(Ot=1,process.env.NODE_ENV==="production"?De.exports=Un():De.exports=Gn()),De.exports}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var st,Mt;function qn(){if(Mt)return st;Mt=1;var e=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function n(a){if(a==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(a)}function s(){try{if(!Object.assign)return!1;var a=new String("abc");if(a[5]="de",Object.getOwnPropertyNames(a)[0]==="5")return!1;for(var o={},i=0;i<10;i++)o["_"+String.fromCharCode(i)]=i;var h=Object.getOwnPropertyNames(o).map(function(p){return o[p]});if(h.join("")!=="0123456789")return!1;var f={};return"abcdefghijklmnopqrst".split("").forEach(function(p){f[p]=p}),Object.keys(Object.assign({},f)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return st=s()?Object.assign:function(a,o){for(var i,h=n(a),f,p=1;p<arguments.length;p++){i=Object(arguments[p]);for(var c in i)t.call(i,c)&&(h[c]=i[c]);if(e){f=e(i);for(var l=0;l<f.length;l++)r.call(i,f[l])&&(h[f[l]]=i[f[l]])}}return h},st}var it,Rt;function ct(){if(Rt)return it;Rt=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return it=e,it}var lt,It;function Lt(){return It||(It=1,lt=Function.call.bind(Object.prototype.hasOwnProperty)),lt}var ut,Dt;function Wn(){if(Dt)return ut;Dt=1;var e=function(){};if(process.env.NODE_ENV!=="production"){var t=ct(),r={},n=Lt();e=function(a){var o="Warning: "+a;typeof console<"u"&&console.error(o);try{throw new Error(o)}catch{}}}function s(a,o,i,h,f){if(process.env.NODE_ENV!=="production"){for(var p in a)if(n(a,p)){var c;try{if(typeof a[p]!="function"){var l=Error((h||"React class")+": "+i+" type `"+p+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof a[p]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw l.name="Invariant Violation",l}c=a[p](o,p,h,i,null,t)}catch(v){c=v}if(c&&!(c instanceof Error)&&e((h||"React class")+": type specification of "+i+" `"+p+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof c+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),c instanceof Error&&!(c.message in r)){r[c.message]=!0;var T=f?f():"";e("Failed "+i+" type: "+c.message+(T??""))}}}}return s.resetWarningCache=function(){process.env.NODE_ENV!=="production"&&(r={})},ut=s,ut}var dt,jt;function Zn(){if(jt)return dt;jt=1;var e=Nt(),t=qn(),r=ct(),n=Lt(),s=Wn(),a=function(){};process.env.NODE_ENV!=="production"&&(a=function(i){var h="Warning: "+i;typeof console<"u"&&console.error(h);try{throw new Error(h)}catch{}});function o(){return null}return dt=function(i,h){var f=typeof Symbol=="function"&&Symbol.iterator,p="@@iterator";function c(b){var u=b&&(f&&b[f]||b[p]);if(typeof u=="function")return u}var l="<<anonymous>>",T={array:I("array"),bigint:I("bigint"),bool:I("boolean"),func:I("function"),number:I("number"),object:I("object"),string:I("string"),symbol:I("symbol"),any:j(),arrayOf:L,element:E(),elementType:d(),instanceOf:y,node:se(),objectOf:q,oneOf:M,oneOfType:K,shape:ne,exact:O};function v(b,u){return b===u?b!==0||1/b===1/u:b!==b&&u!==u}function x(b,u){this.message=b,this.data=u&&typeof u=="object"?u:{},this.stack=""}x.prototype=Error.prototype;function S(b){if(process.env.NODE_ENV!=="production")var u={},A=0;function w(z,H,R,B,U,F,oe){if(B=B||l,F=F||R,oe!==r){if(h){var k=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw k.name="Invariant Violation",k}else if(process.env.NODE_ENV!=="production"&&typeof console<"u"){var ce=B+":"+R;!u[ce]&&A<3&&(a("You are manually calling a React.PropTypes validation function for the `"+F+"` prop on `"+B+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),u[ce]=!0,A++)}}return H[R]==null?z?H[R]===null?new x("The "+U+" `"+F+"` is marked as required "+("in `"+B+"`, but its value is `null`.")):new x("The "+U+" `"+F+"` is marked as required in "+("`"+B+"`, but its value is `undefined`.")):null:b(H,R,B,U,F)}var C=w.bind(null,!1);return C.isRequired=w.bind(null,!0),C}function I(b){function u(A,w,C,z,H,R){var B=A[w],U=X(B);if(U!==b){var F=Q(B);return new x("Invalid "+z+" `"+H+"` of type "+("`"+F+"` supplied to `"+C+"`, expected ")+("`"+b+"`."),{expectedType:b})}return null}return S(u)}function j(){return S(o)}function L(b){function u(A,w,C,z,H){if(typeof b!="function")return new x("Property `"+H+"` of component `"+C+"` has invalid PropType notation inside arrayOf.");var R=A[w];if(!Array.isArray(R)){var B=X(R);return new x("Invalid "+z+" `"+H+"` of type "+("`"+B+"` supplied to `"+C+"`, expected an array."))}for(var U=0;U<R.length;U++){var F=b(R,U,C,z,H+"["+U+"]",r);if(F instanceof Error)return F}return null}return S(u)}function E(){function b(u,A,w,C,z){var H=u[A];if(!i(H)){var R=X(H);return new x("Invalid "+C+" `"+z+"` of type "+("`"+R+"` supplied to `"+w+"`, expected a single ReactElement."))}return null}return S(b)}function d(){function b(u,A,w,C,z){var H=u[A];if(!e.isValidElementType(H)){var R=X(H);return new x("Invalid "+C+" `"+z+"` of type "+("`"+R+"` supplied to `"+w+"`, expected a single ReactElement type."))}return null}return S(b)}function y(b){function u(A,w,C,z,H){if(!(A[w]instanceof b)){var R=b.name||l,B=ae(A[w]);return new x("Invalid "+z+" `"+H+"` of type "+("`"+B+"` supplied to `"+C+"`, expected ")+("instance of `"+R+"`."))}return null}return S(u)}function M(b){if(!Array.isArray(b))return process.env.NODE_ENV!=="production"&&(arguments.length>1?a("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):a("Invalid argument supplied to oneOf, expected an array.")),o;function u(A,w,C,z,H){for(var R=A[w],B=0;B<b.length;B++)if(v(R,b[B]))return null;var U=JSON.stringify(b,function(oe,k){var ce=Q(k);return ce==="symbol"?String(k):k});return new x("Invalid "+z+" `"+H+"` of value `"+String(R)+"` "+("supplied to `"+C+"`, expected one of "+U+"."))}return S(u)}function q(b){function u(A,w,C,z,H){if(typeof b!="function")return new x("Property `"+H+"` of component `"+C+"` has invalid PropType notation inside objectOf.");var R=A[w],B=X(R);if(B!=="object")return new x("Invalid "+z+" `"+H+"` of type "+("`"+B+"` supplied to `"+C+"`, expected an object."));for(var U in R)if(n(R,U)){var F=b(R,U,C,z,H+"."+U,r);if(F instanceof Error)return F}return null}return S(u)}function K(b){if(!Array.isArray(b))return process.env.NODE_ENV!=="production"&&a("Invalid argument supplied to oneOfType, expected an instance of array."),o;for(var u=0;u<b.length;u++){var A=b[u];if(typeof A!="function")return a("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+ee(A)+" at index "+u+"."),o}function w(C,z,H,R,B){for(var U=[],F=0;F<b.length;F++){var oe=b[F],k=oe(C,z,H,R,B,r);if(k==null)return null;k.data&&n(k.data,"expectedType")&&U.push(k.data.expectedType)}var ce=U.length>0?", expected one of type ["+U.join(", ")+"]":"";return new x("Invalid "+R+" `"+B+"` supplied to "+("`"+H+"`"+ce+"."))}return S(w)}function se(){function b(u,A,w,C,z){return G(u[A])?null:new x("Invalid "+C+" `"+z+"` supplied to "+("`"+w+"`, expected a ReactNode."))}return S(b)}function re(b,u,A,w,C){return new x((b||"React class")+": "+u+" type `"+A+"."+w+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+C+"`.")}function ne(b){function u(A,w,C,z,H){var R=A[w],B=X(R);if(B!=="object")return new x("Invalid "+z+" `"+H+"` of type `"+B+"` "+("supplied to `"+C+"`, expected `object`."));for(var U in b){var F=b[U];if(typeof F!="function")return re(C,z,H,U,Q(F));var oe=F(R,U,C,z,H+"."+U,r);if(oe)return oe}return null}return S(u)}function O(b){function u(A,w,C,z,H){var R=A[w],B=X(R);if(B!=="object")return new x("Invalid "+z+" `"+H+"` of type `"+B+"` "+("supplied to `"+C+"`, expected `object`."));var U=t({},A[w],b);for(var F in U){var oe=b[F];if(n(b,F)&&typeof oe!="function")return re(C,z,H,F,Q(oe));if(!oe)return new x("Invalid "+z+" `"+H+"` key `"+F+"` supplied to `"+C+"`.\nBad object: "+JSON.stringify(A[w],null,"  ")+`
Valid keys: `+JSON.stringify(Object.keys(b),null,"  "));var k=oe(R,F,C,z,H+"."+F,r);if(k)return k}return null}return S(u)}function G(b){switch(typeof b){case"number":case"string":case"undefined":return!0;case"boolean":return!b;case"object":if(Array.isArray(b))return b.every(G);if(b===null||i(b))return!0;var u=c(b);if(u){var A=u.call(b),w;if(u!==b.entries){for(;!(w=A.next()).done;)if(!G(w.value))return!1}else for(;!(w=A.next()).done;){var C=w.value;if(C&&!G(C[1]))return!1}}else return!1;return!0;default:return!1}}function te(b,u){return b==="symbol"?!0:u?u["@@toStringTag"]==="Symbol"||typeof Symbol=="function"&&u instanceof Symbol:!1}function X(b){var u=typeof b;return Array.isArray(b)?"array":b instanceof RegExp?"object":te(u,b)?"symbol":u}function Q(b){if(typeof b>"u"||b===null)return""+b;var u=X(b);if(u==="object"){if(b instanceof Date)return"date";if(b instanceof RegExp)return"regexp"}return u}function ee(b){var u=Q(b);switch(u){case"array":case"object":return"an "+u;case"boolean":case"date":case"regexp":return"a "+u;default:return u}}function ae(b){return!b.constructor||!b.constructor.name?l:b.constructor.name}return T.checkPropTypes=s,T.resetWarningCache=s.resetWarningCache,T.PropTypes=T,T},dt}var ft,Bt;function Yn(){if(Bt)return ft;Bt=1;var e=ct();function t(){}function r(){}return r.resetWarningCache=t,ft=function(){function n(o,i,h,f,p,c){if(c!==e){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}n.isRequired=n;function s(){return n}var a={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:s,element:n,elementType:n,instanceOf:s,node:n,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:r,resetWarningCache:t};return a.PropTypes=a,a},ft}var $t;function Vn(){if($t)return Le.exports;if($t=1,process.env.NODE_ENV!=="production"){var e=Nt(),t=!0;Le.exports=Zn()(e.isElement,t)}else Le.exports=Yn()();return Le.exports}var Kn=Vn();const _=On(Kn),pt={"7.5pt":{pt:7.5,px:10,label:"7.5"},"9pt":{pt:9,px:12,label:"9"},"10pt":{pt:10,px:13,label:"10"},"11pt":{pt:11,px:15,label:"11"},"12pt":{pt:12,px:16,label:"12"},"14pt":{pt:14,px:19,label:"14"},"16pt":{pt:16,px:21,label:"16"},"18pt":{pt:18,px:24,label:"18"},"20pt":{pt:20,px:27,label:"20"},"22pt":{pt:22,px:29,label:"22"},"24pt":{pt:24,px:32,label:"24"},"26pt":{pt:26,px:35,label:"26"},"28pt":{pt:28,px:37,label:"28"},"36pt":{pt:36,px:48,label:"36"},"48pt":{pt:48,px:64,label:"48"},"72pt":{pt:72,px:96,label:"72"}},Ht=[{value:"10px",label:"7.5",pt:7.5},{value:"12px",label:"9",pt:9},{value:"13px",label:"10",pt:10},{value:"15px",label:"11",pt:11},{value:"16px",label:"12",pt:12},{value:"19px",label:"14",pt:14},{value:"21px",label:"16",pt:16},{value:"24px",label:"18",pt:18},{value:"27px",label:"20",pt:20},{value:"32px",label:"24",pt:24},{value:"37px",label:"28",pt:28},{value:"48px",label:"36",pt:36},{value:"64px",label:"48",pt:48},{value:"96px",label:"72",pt:72}],ke="16px",zt=e=>Math.round(e*96/72),Ft=e=>Math.round(e*72/96*2)/2,Xn=e=>{const t=Object.values(pt).find(r=>r.pt===e);return t?`${t.px}px`:`${zt(e)}px`},Jn=e=>{const t=parseInt(e),r=Object.values(pt).find(n=>n.px===t);return r?r.pt:Ft(t)},Qn=e=>{if(!e)return!1;if(e.endsWith("px")){const t=parseInt(e);return t>=8&&t<=144}if(e.endsWith("pt")){const t=parseFloat(e);return t>=6&&t<=108}return!1},er={"10px":"1","12px":"2","13px":"2","15px":"3","16px":"3","19px":"4","21px":"4","24px":"5","27px":"5","32px":"6","37px":"6","48px":"6","64px":"7","96px":"7"},Ut={bold:!1,italic:!1,underline:!1,strikethrough:!1,alignLeft:!1,alignCenter:!1,alignRight:!1,alignJustify:!1,fontFamily:"Arial",fontSize:ke,headingLevel:"p"},Gt=()=>{const[e,t]=g.useState(Ut),r=be(),n=g.useCallback((c,l,T=null)=>{try{const v=window.getSelection();if(!v||v.rangeCount===0)return!1;const x=v.getRangeAt(0);if(!x.toString())return t(I=>({...I,[c]:l})),!1;try{const I=document.createElement("span");I.style[c]=l;const j=x.extractContents();return I.appendChild(j),x.insertNode(I),x.selectNodeContents(I),v.removeAllRanges(),v.addRange(x),t(L=>({...L,[c]:l})),!0}catch{if(T){const I=c==="fontSize"?er[l]||"3":l;return document.execCommand(T,!1,I),t(j=>({...j,[c]:l})),!0}return!1}}catch(v){return console.warn(`[useFormatting] Style application failed for ${c}:`,v),!1}},[]),s=g.useCallback(c=>n("fontFamily",c,"fontName"),[n]),a=g.useCallback(c=>n("fontSize",c,"fontSize"),[n]),o=g.useCallback(c=>{t(l=>({...l,alignLeft:c==="left",alignCenter:c==="center",alignRight:c==="right",alignJustify:c==="justify"}))},[]),i=g.useCallback(c=>{try{const l=window.getSelection();if(!l||l.rangeCount===0)return!1;const T=l.getRangeAt(0),v=T.toString(),S={justifyLeft:"left",justifyCenter:"center",justifyRight:"right",justifyFull:"justify"}[c];if(!S)return!1;if(!v){const j=T.startContainer,L=j.nodeType===Node.TEXT_NODE?j.parentElement:j,E=je(L)||nr();return E&&(E.style.textAlign=S,o(S)),!0}const I=tr(T);if(I.length===0){const j=document.createElement("p");j.style.textAlign=S;const L=T.extractContents();j.appendChild(L),T.insertNode(j),T.selectNodeContents(j),l.removeAllRanges(),l.addRange(T)}else I.forEach(j=>{j.style.textAlign=S});return o(S),!0}catch(l){return console.warn("[useFormatting] Text alignment failed:",l),!1}},[o]),h=g.useCallback((c,l=null)=>{try{if(c==="undo"){r.undo();return}if(c==="redo"){r.redo();return}if(typeof document.execCommand!="function"){console.warn("[useFormatting] execCommand not supported");return}if(c==="fontSize"){a(l);return}if(c==="fontName"){s(l);return}if(["justifyLeft","justifyCenter","justifyRight","justifyFull"].includes(c)){i(c);return}switch(document.execCommand(c,!1,l)||console.warn(`[useFormatting] Command "${c}" failed`),c){case"bold":case"italic":case"underline":case"strikethrough":case"justifyLeft":case"justifyCenter":case"justifyRight":case"justifyFull":case"fontName":break;case"formatBlock":t(v=>({...v,headingLevel:l}));break;default:break}}catch(T){console.warn(`[useFormatting] Error executing command "${c}":`,T)}},[a,s,i,r]),f=g.useCallback(()=>{try{const c=window.getSelection();if(!c||c.rangeCount===0)return;const l=c.getRangeAt(0),T=l.toString();let v=ke,x="Arial",S="p",I="left";if(T){const L=l.startContainer,E=L.nodeType===Node.TEXT_NODE?L.parentElement:L;if(E){const d=window.getComputedStyle(E),y=d.fontSize,M=d.fontFamily;y&&y.endsWith("px")&&(v=y),M&&M!=="serif"&&(x=M.split(",")[0].replace(/['"]/g,"").trim());const q=je(E);if(q){const K=q.tagName?.toLowerCase();["h1","h2","h3","h4","h5","h6","p"].includes(K)&&(S=K);const re=window.getComputedStyle(q).textAlign;["left","center","right","justify"].includes(re)&&(I=re)}}}const j={bold:document.queryCommandState("bold"),italic:document.queryCommandState("italic"),underline:document.queryCommandState("underline"),strikethrough:document.queryCommandState("strikethrough"),alignLeft:I==="left",alignCenter:I==="center",alignRight:I==="right",alignJustify:I==="justify",fontFamily:x,fontSize:v,headingLevel:S};t(L=>({...L,...j}))}catch(c){console.warn("[useFormatting] Error updating format from selection:",c)}},[]),p=g.useCallback(()=>{t(Ut)},[]);return{currentFormat:e,formatText:h,resetFormat:p,updateCurrentFormatFromSelection:f}};function je(e){let t=e;for(;t&&t!==document.body;){const r=t.tagName?.toLowerCase();if(["h1","h2","h3","h4","h5","h6","p"].includes(r))return t;if(t.contentEditable==="true"||t.contentEditable==="")break;t=t.parentElement}return null}function tr(e){const t=[],r=e.startContainer,n=e.endContainer,s=je(r.nodeType===Node.TEXT_NODE?r.parentElement:r),a=je(n.nodeType===Node.TEXT_NODE?n.parentElement:n);if(s===a&&s)return[s];const o=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_ELEMENT,{acceptNode:h=>{const f=h.tagName?.toLowerCase();return["h1","h2","h3","h4","h5","h6","p"].includes(f)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});let i=o.nextNode();for(;i;)e.intersectsNode(i)&&t.push(i),i=o.nextNode();return t}function nr(){try{const e=window.getSelection();if(!e||e.rangeCount===0)return null;const t=e.getRangeAt(0),r=document.createElement("p");return r.innerHTML="<br>",t.insertNode(r),t.selectNodeContents(r),t.collapse(!0),e.removeAllRanges(),e.addRange(t),r}catch(e){return console.warn("[useFormatting] Failed to create paragraph at cursor:",e),null}}const pe='page-break, [data-page-break="true"]',qt=e=>ie[e]||ie.A4,rr=(e,t={})=>{if(!e||typeof document>"u")return[];const r=t.pageSize||"A4",n=qt(r),s=e.querySelectorAll(pe),a=[];a.push({id:"page-0",pageNumber:1,top:0,height:n.height});const o=e.getBoundingClientRect(),i=e.scrollTop;return s.forEach((h,f)=>{const c=h.getBoundingClientRect().top-o.top+i;a.push({id:`page-${f+1}`,pageNumber:f+2,top:c,height:n.height})}),a},Wt=(e,t=100,r=de)=>{const n=qt(e),s=Ln(r),a=n.height-s,o=t/100;return a/o},or=(e,t)=>{if(!e||!t)return 0;try{const r=t.querySelectorAll(pe);if(r.length===0)return 0;const n=e.getBoundingClientRect(),s=n.top+n.height/2;for(let a=r.length-1;a>=0;a--)if(r[a].getBoundingClientRect().top<s)return a+1;return 0}catch(r){return console.warn("[getCurrentPage] Failed to calculate page:",r),0}},Zt=e=>{if(!e)return[];const t=Array.from(e.children);if(t.length===0)return[];let r=[],n=[];for(const s of t)s.tagName==="PAGE-BREAK"||s.getAttribute("data-page-break")==="true"?n.length>0&&(r.push(n),n=[]):n.push(s);return n.length>0&&r.push(n),r.length===0&&t.length>0&&r.push(t.filter(s=>!(s.tagName==="PAGE-BREAK"||s.getAttribute("data-page-break")==="true"))),r},ar=e=>{if(!e||!e.getBoundingClientRect)return 0;const t=e.getBoundingClientRect();if(e.tagName==="P"){const r=e.querySelectorAll("img"),n=e.textContent.trim();if(r.length===1&&!n){const a=r[0].getBoundingClientRect(),i=window.getComputedStyle(e).textAlign;if(i==="center"||i==="-webkit-center")return a.height+16}return t.height+16}return e.tagName==="H1"||e.tagName==="H2"||e.tagName==="H3"||e.tagName==="H4"||e.tagName==="H5"||e.tagName==="H6"?t.height+20:e.tagName==="UL"||e.tagName==="OL"?t.height+16:t.height},sr=(e,t)=>{if(!e)return!1;try{const r=document.createElement("page-break");return r.setAttribute("data-page-break","true"),r.setAttribute("contenteditable","false"),r.setAttribute("data-page-number",t||"2"),e.parentNode.insertBefore(r,e),!0}catch(r){return console.warn("[insertPageBreakBefore] Failed to insert page break:",r),!1}},ir=(e,t,r,n,s,a,o)=>{if(!e)return!1;try{const h=Wt(r,n,s)*(t-1),f=Array.from(e.children);let p=0,c=null;for(let l=0;l<f.length;l++){const T=f[l];if(T.tagName==="PAGE-BREAK"||T.getAttribute("data-page-break")==="true")continue;const v=ar(T);if(p+v>h){c=T;break}p+=v}if(c){const l=document.createElement("page-break");if(l.setAttribute("data-page-break","true"),l.setAttribute("contenteditable","false"),l.setAttribute("data-page-number",String(t)),c.parentNode.insertBefore(l,c),a){const T=e.innerHTML;a(T)}return o&&setTimeout(()=>{o()},50),!0}else{const l=document.createElement("page-break");l.setAttribute("data-page-break","true"),l.setAttribute("contenteditable","false"),l.setAttribute("data-page-number",String(t)),e.appendChild(l);const T=document.createElement("p");if(T.innerHTML="<br>",e.appendChild(T),a){const v=e.innerHTML;a(v)}return o&&setTimeout(()=>{o()},50),!0}}catch(i){return console.error("[insertPageBreakAtBoundary] Failed to insert page break:",i),!1}},cr=(e,t,r,n,s,a,o)=>{if(!e)return!1;if(r().length<=1)return console.warn("[removePageAndContent] Cannot delete the only page"),!1;try{const h=Array.from(e.querySelectorAll(pe));if(t>h.length)return console.warn("[removePageAndContent] Invalid page index"),!1;const f=window.getSelection();let p=!1,c=[],l=null;if(t===0){const v=h[0];if(!v)return console.warn("[removePageAndContent] No page break found for first page"),!1;let x=e.firstChild;for(;x&&x!==v;)c.push(x),x=x.nextSibling;l=v}else{const v=h[t-1];if(!v)return console.warn("[removePageAndContent] Page break not found"),!1;const x=h[t];let S=v.nextSibling;for(;S&&S!==x;)c.push(S),S=S.nextSibling;l=v}if(f&&f.rangeCount>0){const x=f.getRangeAt(0).startContainer;for(const S of c)if(S.contains(x)||S===x){p=!0;break}}if(l&&l.parentNode&&l.remove(),c.forEach(v=>{v.parentNode&&v.remove()}),e.querySelectorAll(pe).forEach((v,x)=>{v.setAttribute("data-page-number",String(x+2))}),p&&a&&setTimeout(()=>{a(0)},50),n){const v=e.innerHTML;n(v)}return s&&setTimeout(()=>{s(),o&&setTimeout(()=>{o()},150)},100),!0}catch(h){return console.error("[removePageAndContent] Failed to remove page:",h),!1}},lr=e=>{if(e)try{e.querySelectorAll(pe).forEach((r,n)=>{r.setAttribute("data-page-number",String(n+2))})}catch(t){console.error("[renumberPageBreaks] Failed to renumber page breaks:",t)}},ur=(e,t,r,n,s)=>{if(!e||!t)return!1;try{if(e.remove(),lr(t),r){const a=t.innerHTML;r(a)}return n&&setTimeout(()=>{n(),s&&setTimeout(()=>{s()},100)},50),!0}catch(a){return console.error("[removePageBreak] Failed to remove page break:",a),!1}},dr=200,fr=50,Yt=3,pr=20,Vt=e=>{if(!e||!e.getBoundingClientRect)return 0;const t=e.getBoundingClientRect();if(e.tagName==="P"){const r=e.querySelectorAll("img"),n=e.textContent.trim();if(r.length===1&&!n){const a=r[0].getBoundingClientRect(),i=window.getComputedStyle(e).textAlign;if(i==="center"||i==="-webkit-center")return a.height+16}return t.height+16}return e.tagName==="H1"||e.tagName==="H2"||e.tagName==="H3"||e.tagName==="H4"||e.tagName==="H5"||e.tagName==="H6"?t.height+20:e.tagName==="UL"||e.tagName==="OL"?t.height+16:t.height},gr=(e,t)=>{if(!e||e.length===0)return null;let r=0,n=null;for(let s=0;s<e.length;s++){const a=e[s];if(!a||!a.getBoundingClientRect)continue;const o=Vt(a);if(o<1)continue;if(r+o>t)return n===null?s>0?{overflowIndex:s,overflowElement:a,accumulatedHeight:r}:null:{overflowIndex:s,overflowElement:a,accumulatedHeight:r};r+=o,n=a}return null},hr=(e,t,r,n,s,a,o,i)=>{if(!e||o.current)return!1;try{o.current=!0;const h=Wt(t,r,n);let f=Zt(e),p=!1,c=0;for(let l=0;l<f.length&&c<Yt;l++){const T=f[l],v=gr(T,h);if(v&&v.overflowIndex>0){let x=0;for(let L=0;L<T.length;L++){const E=T[L];E&&E.getBoundingClientRect&&(x+=Vt(E))}if(x-h<pr)continue;const I=l+2;sr(v.overflowElement,I)&&(p=!0,c++,f=Zt(e))}}if(p){if(s){const l=e.innerHTML;s(l)}setTimeout(()=>{a&&a(),c>=Yt&&i&&setTimeout(()=>{o.current||i()},100)},fr)}return p}catch(h){return console.warn("[checkAndReflow] Reflow failed:",h),!1}finally{o.current=!1}},mr=(e,t,r=dr)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{t.current=null,e()},r)},yr=400,Kt=(e,t)=>{if(e){e.focus();try{let r=null,n=0;if(t===0)r=e.firstChild,n=0;else{const a=e.querySelectorAll(pe)[t-1];a&&a.nextSibling&&(r=a.nextSibling,n=0)}if(r){const s=document.createRange(),a=window.getSelection();r.nodeType===Node.TEXT_NODE?s.setStart(r,n):s.setStart(r,0),s.collapse(!0),a.removeAllRanges(),a.addRange(s)}}catch(r){console.warn("[positionCursorAtPage] Failed to position cursor:",r)}}},Er=(e,t,r,n)=>{if(!e||!t){console.warn("[scrollToPage] Missing refs");return}try{let s=null;if(r===0)s=t;else{const o=t.querySelectorAll(pe)[r-1];if(o)s=o;else{console.warn("[scrollToPage] Page break not found for page",r);return}}if(s){const a=s.getBoundingClientRect(),o=e.getBoundingClientRect(),i=e.scrollTop+(a.top-o.top);e.scrollTo({top:i,behavior:"smooth"}),setTimeout(()=>{n?n(r):Kt(t,r)},yr)}}catch(s){console.error("[scrollToPage] Error:",s)}},br=(e,t,r={},n=300)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{t.current=null,e(r)},Math.max(0,n))},Tr=e=>{if(!e)return null;const t=window.getSelection();if(t.rangeCount===0)return null;const r=t.getRangeAt(0);if(!e.contains(r.commonAncestorContainer))return null;let n=1;const s=e.querySelectorAll(pe);for(const p of s)if(r.comparePoint(p,0)>0)n++;else break;const a=document.createRange();a.setStart(e,0),a.setEnd(r.startContainer,r.startOffset);const i=a.toString().replace(/<[^>]*>/g," ").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\s+/g," ").trim(),h=i.length,f=(i.match(/\n/g)||[]).length+1;return{page:n,line:f,charOffset:h}},vr=300,Xt=(e,t,r=100,n="NARROW")=>{const s=be(),a=g.useRef(null),o=g.useRef(null),i=g.useRef(e),h=g.useRef(r),f=g.useRef(n),p=g.useRef(!1);g.useEffect(()=>{i.current=e},[e]),g.useEffect(()=>{h.current=r},[r]),g.useEffect(()=>{f.current=n},[n]),g.useEffect(()=>()=>{a.current&&clearTimeout(a.current),o.current&&clearTimeout(o.current)},[]);const c=g.useCallback((y={})=>t?.current?rr(t.current,y):[],[t]),l=g.useCallback((y={})=>{const M=c(y);return s.updatePageBoundaries(M),M},[c,s]),T=g.useCallback((y={})=>{const M=typeof y.delay=="number"?y.delay:vr;br(l,a,y,M)},[l]),v=g.useCallback(()=>{t?.current&&hr(t.current,i.current,h.current,f.current,s.updateContinuousContent,l,p,v)},[t,s,l]),x=g.useCallback(y=>{mr(v,o,y)},[v]),S=g.useCallback(y=>!y?.current||!t?.current?0:or(y.current,t.current),[t]),I=g.useCallback(y=>{t?.current&&Kt(t.current,y)},[t]),j=g.useCallback((y,M)=>{if(!M?.current||!t?.current){console.warn("[scrollToPage] Missing refs");return}Er(M.current,t.current,y,I)},[t,I]),L=g.useCallback(async y=>t?.current?ir(t.current,y,i.current,h.current,f.current,s.updateContinuousContent,l):!1,[t,s,l]),E=g.useCallback(y=>t?.current?cr(t.current,y,c,s.updateContinuousContent,l,I,v):!1,[t,c,s,l,I,v]),d=g.useCallback(y=>t?.current?ur(y,t.current,s.updateContinuousContent,l,v):!1,[t,s,l,v]);return g.useEffect(()=>()=>{a.current&&clearTimeout(a.current),o.current&&clearTimeout(o.current)},[]),g.useMemo(()=>({calculatePageBoundaries:c,checkAndUpdateBoundaries:T,updateBoundaries:l,getCurrentPage:S,scrollToPage:j,positionCursorAtPage:I,checkAndReflow:v,triggerAutoReflow:x,removePageAndContent:E,removePageBreak:d,insertPageBreakAtBoundary:L,boundaryTimeoutRef:a,reflowTimeoutRef:o}),[c,T,l,S,j,I,v,x,E,d,L])},me={minWidth:50,minHeight:50,maxWidth:800,maxHeight:600,aspectRatio:!0,preserveAspectRatio:!0,defaultWidth:300,defaultHeight:200},N={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right"};function xr({handler:e,startX:t,startY:r,currentX:n,currentY:s,startWidth:a,startHeight:o,options:i=me}){const h=n-t,f=s-r;let p=a,c=o;switch(e){case N.TOP_LEFT:p=Math.max(i.minWidth,a-h),c=Math.max(i.minHeight,o-f);break;case N.TOP_RIGHT:p=Math.max(i.minWidth,a+h),c=Math.max(i.minHeight,o-f);break;case N.BOTTOM_LEFT:p=Math.max(i.minWidth,a-h),c=Math.max(i.minHeight,o+f);break;case N.BOTTOM_RIGHT:p=Math.max(i.minWidth,a+h),c=Math.max(i.minHeight,o+f);break;case N.TOP:c=Math.max(i.minHeight,o-f);break;case N.BOTTOM:c=Math.max(i.minHeight,o+f);break;case N.LEFT:p=Math.max(i.minWidth,a-h);break;case N.RIGHT:p=Math.max(i.minWidth,a+h);break;default:return{width:p,height:c}}if(i.preserveAspectRatio&&i.aspectRatio){const l=a/o;[N.TOP_LEFT,N.TOP_RIGHT,N.BOTTOM_LEFT,N.BOTTOM_RIGHT].includes(e)?p/l>c?c=Math.max(i.minHeight,p/l):p=Math.max(i.minWidth,c*l):[N.TOP,N.BOTTOM].includes(e)?p=c*l:[N.LEFT,N.RIGHT].includes(e)&&(c=p/l)}return i.maxWidth&&p>i.maxWidth&&(p=i.maxWidth,i.preserveAspectRatio&&i.aspectRatio&&(c=p/(a/o))),i.maxHeight&&c>i.maxHeight&&(c=i.maxHeight,i.preserveAspectRatio&&i.aspectRatio&&(p=c*(a/o))),p=Math.max(i.minWidth,p),c=Math.max(i.minHeight,c),{width:Math.round(p),height:Math.round(c)}}function fe(e){return e?!!(e.tagName==="IMG"||e.tagName==="DIV"&&e.style.backgroundImage&&e.style.backgroundImage!=="none"):!1}function _r(e){return fe(e)?{width:e.offsetWidth,height:e.offsetHeight}:{width:0,height:0}}function Ar(e,{width:t,height:r}){fe(e)&&(e.tagName==="IMG"?(e.style.width=`${t}px`,e.style.height=`${r}px`,e.width=t,e.height=r):e.tagName==="DIV"&&(e.style.width=`${t}px`,e.style.height=`${r}px`))}function Jt(e,t=me){if(!fe(e))return null;const r=document.createElement("div");r.className="image-resize-overlay",r.style.position="fixed",r.style.zIndex="1000",r.style.pointerEvents="none";const n=e.getBoundingClientRect();return r.style.top=`${n.top}px`,r.style.left=`${n.left}px`,r.style.width=`${n.width}px`,r.style.height=`${n.height}px`,Object.values(N).forEach(a=>{const o=document.createElement("div");o.className=`resize-handler resize-handler-${a}`,o.dataset.handler=a,o.style.position="absolute",o.style.width="10px",o.style.height="10px",o.style.backgroundColor="#007bff",o.style.border="2px solid white",o.style.borderRadius="50%",o.style.boxShadow="0 0 3px rgba(0,0,0,0.3)",o.style.cursor=kr(a),o.style.pointerEvents="all",Qt(o,a,n.width,n.height),r.appendChild(o)}),r}function kr(e){switch(e){case N.TOP_LEFT:case N.BOTTOM_RIGHT:return"nwse-resize";case N.TOP_RIGHT:case N.BOTTOM_LEFT:return"nesw-resize";case N.TOP:case N.BOTTOM:return"ns-resize";case N.LEFT:case N.RIGHT:return"ew-resize";default:return"default"}}function Qt(e,t,r,n){switch(t){case N.TOP_LEFT:e.style.top="-5px",e.style.left="-5px";break;case N.TOP_RIGHT:e.style.top="-5px",e.style.right="-5px";break;case N.BOTTOM_LEFT:e.style.bottom="-5px",e.style.left="-5px";break;case N.BOTTOM_RIGHT:e.style.bottom="-5px",e.style.right="-5px";break;case N.TOP:e.style.top="-5px",e.style.left=`${r/2+-5}px`;break;case N.BOTTOM:e.style.bottom="-5px",e.style.left=`${r/2+-5}px`;break;case N.LEFT:e.style.top=`${n/2+-5}px`,e.style.left="-5px";break;case N.RIGHT:e.style.top=`${n/2+-5}px`,e.style.right="-5px";break}}function Be(e,t){if(!e||!t)return;const r=t.getBoundingClientRect();e.style.top=`${r.top}px`,e.style.left=`${r.left}px`,e.style.width=`${r.width}px`,e.style.height=`${r.height}px`,e.querySelectorAll(".resize-handler").forEach(s=>{const a=s.dataset.handler;Qt(s,a,r.width,r.height)})}function $e(e){e&&e.parentNode&&e.parentNode.removeChild(e)}const Sr="html-editor-storage",Pr=1,le="images";function Cr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function Se(){return new Promise((e,t)=>{const r=indexedDB.open(Sr,Pr);r.onerror=()=>{t(new Error("Failed to open IndexedDB database"))},r.onsuccess=()=>{e(r.result)},r.onupgradeneeded=n=>{const s=n.target.result;s.objectStoreNames.contains(le)||s.createObjectStore(le,{keyPath:"key"}).createIndex("timestamp","timestamp",{unique:!1})}})}function en(e){return new Promise((t,r)=>{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(e.type)){r(new Error("Invalid image format. Supported formats: png, jpeg, gif, webp"));return}if(e.size>5*1024*1024){r(new Error("Image exceeds maximum size of 5MB"));return}const s=new FileReader;s.onload=async a=>{const o=a.target.result,h=o.split(",")[1].length*3/4;if(h>5*1024*1024){r(new Error("Image exceeds maximum size of 5MB"));return}try{const f=await Se(),p=`editor-image-${Cr()}`,l=f.transaction([le],"readwrite").objectStore(le),T={key:p,dataUrl:o,size:h,type:e.type,timestamp:Date.now()},v=l.add(T);v.onsuccess=()=>{f.close(),t(p)},v.onerror=()=>{f.close(),r(new Error("Failed to save image to IndexedDB"))}}catch(f){r(f)}},s.onerror=()=>{r(new Error("Error reading image file"))},s.readAsDataURL(e)})}async function tn(e){try{const t=await Se();return new Promise((r,n)=>{const o=t.transaction([le],"readonly").objectStore(le).get(e);o.onsuccess=()=>{t.close();const i=o.result;r(i?i.dataUrl:null)},o.onerror=()=>{t.close(),n(new Error("Failed to retrieve image from IndexedDB"))}})}catch(t){return console.error("Error getting image:",t),null}}async function nn(e){try{const t=await Se();return new Promise((r,n)=>{const o=t.transaction([le],"readwrite").objectStore(le).delete(e);o.onsuccess=()=>{t.close(),r()},o.onerror=()=>{t.close(),n(new Error("Failed to delete image from IndexedDB"))}})}catch(t){console.error("Error deleting image:",t)}}async function wr(){try{const e=await Se();return new Promise((t,r)=>{const a=e.transaction([le],"readwrite").objectStore(le).clear();a.onsuccess=()=>{e.close(),t()},a.onerror=()=>{e.close(),r(new Error("Failed to clear images from IndexedDB"))}})}catch(e){console.error("Error clearing images:",e)}}async function Or(){try{const e=await Se();return new Promise((t,r)=>{const a=e.transaction([le],"readonly").objectStore(le).getAllKeys();a.onsuccess=()=>{e.close(),t(a.result||[])},a.onerror=()=>{e.close(),r(new Error("Failed to get image keys from IndexedDB"))}})}catch(e){return console.error("Error getting image keys:",e),[]}}const Nr=["SPAN","STRONG","EM","B","I","U","S","STRIKE","DEL","INS","SUB","SUP","MARK","SMALL","CODE","KBD","SAMP","VAR","A","ABBR","CITE","DFN","TIME"],Mr=["BR","HR","IMG","INPUT","PAGE-BREAK"];function Rr(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function rn(e){const t=[];for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];t.push(` ${n.name}="${n.value}"`)}return t.join("")}function He(e){if(!e||typeof e!="string")return"<p><br></p>";const t=e.trim();if(!t)return"<p><br></p>";const r=document.createElement("div");return r.innerHTML=t,Pe(r)||"<p><br></p>"}function Ir(e){const t=e.cloneNode(!0);return t.querySelectorAll(":scope > p").forEach(n=>{for(;n.firstChild;)t.insertBefore(n.firstChild,n);n.remove()}),t.innerHTML}function Pe(e){const t=[],r=Array.from(e.childNodes);for(let n=0;n<r.length;n++){const s=r[n];if(s.nodeType===Node.TEXT_NODE){const a=s.textContent.trim();a&&t.push(`<p>${Rr(a)}</p>`)}else if(s.nodeType===Node.ELEMENT_NODE){const a=s,o=a.tagName,i=o.toLowerCase(),h=rn(a);if(o==="DIV"){const f=Pe(a);f.trim()?t.push(f):t.push("<p><br></p>")}else if(o==="P")t.push(a.outerHTML);else if(["H1","H2","H3","H4","H5","H6"].includes(o)){const f=Ir(a);t.push(`<${i}${h}>${f}</${i}>`)}else if(o==="BR")t.push("<p><br></p>");else if(o==="IMG")t.push(a.outerHTML);else if(["UL","OL"].includes(o))t.push(Lr(a));else if(o==="LI")t.push(a.outerHTML);else if(o==="TABLE")t.push(Dr(a));else if(["TBODY","THEAD","TFOOT","TR","TD","TH"].includes(o))t.push(a.outerHTML);else if(o==="BLOCKQUOTE"){const f=Pe(a);t.push(`<blockquote${h}>${f}</blockquote>`)}else if(o==="PRE")t.push(a.outerHTML);else if(Nr.includes(o))t.push(a.outerHTML);else if(o==="PAGE-BREAK"||a.getAttribute("data-page-break")==="true")t.push(a.outerHTML);else if(o==="HR")t.push(a.outerHTML);else if(o==="FIGURE")t.push(a.outerHTML);else if(Mr.includes(o))t.push(a.outerHTML);else{const f=Pe(a);t.push(`<${i}${h}>${f}</${i}>`)}}}return t.length===0?"":t.join("")}function Lr(e){const t=e.tagName.toLowerCase(),r=rn(e),n=[];return Array.from(e.children).forEach(s=>{if(s.tagName==="LI")n.push(s.outerHTML);else{const a=Pe(s);a.trim()&&n.push(`<li>${a}</li>`)}}),n.length===0?`<${t}${r}><li><br></li></${t}>`:`<${t}${r}>${n.join("")}</${t}>`}function Dr(e){return e.outerHTML}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Br=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,n)=>n?n.toUpperCase():r.toLowerCase()),on=e=>{const t=Br(e);return t.charAt(0).toUpperCase()+t.slice(1)},an=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim(),$r=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Hr={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zr=g.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:s="",children:a,iconNode:o,...i},h)=>g.createElement("svg",{ref:h,...Hr,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:an("lucide",s),...!a&&!$r(i)&&{"aria-hidden":"true"},...i},[...o.map(([f,p])=>g.createElement(f,p)),...Array.isArray(a)?a:[a]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=(e,t)=>{const r=g.forwardRef(({className:n,...s},a)=>g.createElement(zr,{ref:a,iconNode:t,className:an(`lucide-${jr(on(e))}`,`lucide-${e}`,n),...s}));return r.displayName=on(e),r};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fr=W("bold",[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=W("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=W("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qr=W("file-check",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=W("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wr=W("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zr=W("heading-1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yr=W("heading-2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=W("heading-3",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kr=W("image-upscale",[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M17 21h2a2 2 0 0 0 2-2",key:"130fy9"}],["path",{d:"M21 12v3",key:"1wzk3p"}],["path",{d:"m21 3-5 5",key:"1g5oa7"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2",key:"kk3yz1"}],["path",{d:"m5 21 4.144-4.144a1.21 1.21 0 0 1 1.712 0L13 19",key:"fyekpt"}],["path",{d:"M9 3h3",key:"d52fa"}],["rect",{x:"3",y:"11",width:"10",height:"10",rx:"1",key:"1wpmix"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xr=W("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jr=W("italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qr=W("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eo=W("list-indent-decrease",[["path",{d:"M21 5H11",key:"us1j55"}],["path",{d:"M21 12H11",key:"wd7e0v"}],["path",{d:"M21 19H11",key:"saa85w"}],["path",{d:"m7 8-4 4 4 4",key:"o5hrat"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const to=W("list-indent-increase",[["path",{d:"M21 5H11",key:"us1j55"}],["path",{d:"M21 12H11",key:"wd7e0v"}],["path",{d:"M21 19H11",key:"saa85w"}],["path",{d:"m3 8 4 4-4 4",key:"1a3j6y"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const no=W("list-ordered",[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sn=W("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ro=W("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oo=W("redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ao=W("scaling",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M14 15H9v-5",key:"pi4jk9"}],["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M21 3 9 15",key:"15kdhq"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const so=W("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const io=W("strikethrough",[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const co=W("table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=W("text-align-center",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M17 12H7",key:"16if0g"}],["path",{d:"M19 19H5",key:"vjpgq2"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ln=W("text-align-end",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M21 19H7",key:"4cu937"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lo=W("text-align-justify",[["path",{d:"M3 5h18",key:"1u36vt"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 19h18",key:"awlh7x"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=W("text-align-start",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uo=W("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fo=W("underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const po=W("undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const go=W("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ho=W("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mo=W("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),dn=(e,t,r="")=>{if(!e)return[];const n=document.createElement("div");n.innerHTML=e;const s=n.querySelectorAll("h1, h2, h3, h4, h5, h6");return Array.from(s).map((a,o)=>{const i=parseInt(a.tagName.charAt(1)),h=a.textContent.trim();return h?{id:`${r}heading-${o}`,level:i,text:h,page:t||1}:null}).filter(Boolean)},yo=e=>{if(!e)return 0;const t=document.createElement("div");return t.innerHTML=e,(t.textContent||t.innerText||"").trim().split(/\s+/).filter(n=>n.length>0).length},fn=({isCollapsed:e,onToggle:t,wordCount:r,pageCount:n})=>{const s=at(),{pages:a,activePage:o,continuousContent:i}=s,[h,f]=g.useState(0),[p,c]=g.useState([]);g.useEffect(()=>{if(r!==void 0&&n!==void 0){f(r),c(dn(i,1,"continuous-"));return}let T=0;const v=[];a.forEach((x,S)=>{T+=yo(x.content),v.push(...dn(x.content,S+1,`page-${S}-`))}),f(T),c(v)},[a,r,n,i]);const l=n!==void 0?n:a.length;return m.jsxs("aside",{className:`sidebar ${e?"collapsed":""}`,role:"complementary","aria-label":"Document information","data-testid":"sidebar",children:[m.jsxs("div",{className:"sidebar-header",children:[m.jsxs("div",{className:"sidebar-title",children:[m.jsx(ze,{size:18}),m.jsx("h2",{children:"Document Info"})]}),m.jsx("button",{className:"sidebar-toggle",onClick:t,"aria-label":e?"Expand sidebar":"Collapse sidebar",title:e?"Expand sidebar":"Collapse sidebar",children:e?m.jsx(Gr,{size:16}):m.jsx(Ur,{size:16})})]}),!e&&m.jsxs("div",{className:"sidebar-content",children:[m.jsxs("div",{className:"sidebar-section",children:[m.jsx("h3",{children:"Statistics"}),m.jsxs("div",{className:"stat-item",children:[m.jsxs("div",{className:"stat-label",children:[m.jsx(qr,{size:14}),m.jsx("span",{children:"Pages:"})]}),m.jsx("span",{className:"stat-value",children:l})]}),m.jsxs("div",{className:"stat-item","data-testid":"word-count",children:[m.jsxs("div",{className:"stat-label",children:[m.jsx(Wr,{size:14}),m.jsx("span",{children:"Words:"})]}),m.jsx("span",{className:"stat-value",children:h.toLocaleString()})]}),m.jsxs("div",{className:"stat-item",children:[m.jsxs("div",{className:"stat-label",children:[m.jsx(ze,{size:14}),m.jsx("span",{children:"Active Page:"})]}),m.jsx("span",{className:"stat-value",children:o+1})]})]}),p.length>0&&m.jsxs("div",{className:"sidebar-section",children:[m.jsxs("h3",{children:[m.jsx(sn,{size:14,style:{display:"inline-block",marginRight:"6px",verticalAlign:"middle"}}),"Document Outline"]}),m.jsx("div",{className:"document-outline","data-testid":"outline",children:p.map(T=>{const v=T.level===1?Zr:T.level===2?Yr:Vr;return m.jsxs("div",{className:`outline-item outline-level-${T.level}`,style:{marginLeft:`${(T.level-1)*12}px`},children:[m.jsx(v,{size:12,className:"outline-icon"}),m.jsx("span",{className:"outline-text",children:T.text}),m.jsxs("span",{className:"outline-page",children:["p.",T.page]})]},T.id)})})]})]})]})};class pn{constructor(t="Editor"){this.namespace=t}_format(t,r,n){return`[${new Date().toISOString()}] [${this.namespace}] [${t}] ${r}`}info(t,r){}warn(t,r){}error(t,r){}debug(t,r){}}const gn=new pn("Editor"),hn=new Set(["P","DIV","H1","H2","H3","H4","H5","H6","LI","BLOCKQUOTE","PRE","TABLE"]),mn=32;function yn(e,t){if(!e)return;e.dataset||(e.dataset={}),e.style||(e.style={});const r=parseInt(e.dataset.indentLevel||"0",10),n=Math.max(0,t?r-1:r+1);n===0?(e.style.marginLeft="",delete e.dataset.indentLevel):(e.style.marginLeft=`${n*mn}px`,e.dataset.indentLevel=String(n))}function Eo(e,t){yn(e,t)}function bo(e){let t=e;for(;t;){if(t.nodeType===1&&t.tagName&&hn.has(t.tagName.toUpperCase()))return t;t=t.parentElement||t.parentNode}return null}function To(){const e=window.getSelection();if(!e||e.rangeCount===0)return[];const t=e.getRangeAt(0),r=new Set;let n=t.commonAncestorContainer;for(n.nodeType===Node.TEXT_NODE&&(n=n.parentElement);n&&n.contentEditable!=="true";)n=n.parentElement;return n?(n.querySelectorAll("p, div, h1, h2, h3, h4, h5, h6, li, blockquote, pre, table").forEach(o=>{document.createRange().selectNodeContents(o),t.intersectsNode(o)&&r.add(o)}),r.size===0&&n.querySelectorAll("img").forEach(i=>{if(document.createRange().selectNode(i),t.intersectsNode(i)){let f=i.parentElement;for(;f&&f!==n;){if(f.tagName&&hn.has(f.tagName.toUpperCase())){r.add(f);break}f=f.parentElement}}}),Array.from(r).filter(o=>{let i=o.parentElement;for(;i;){if(r.has(i))return!1;i=i.parentElement}return!0})):[]}function vo(e){if(e.style&&e.style.marginLeft&&e.style.marginLeft!==""){const t=parseInt(e.dataset.indentLevel||"0",10),r=Math.max(0,t-1);r===0?(e.style.marginLeft="",delete e.dataset.indentLevel):(e.style.marginLeft=`${r*mn}px`,e.dataset.indentLevel=String(r));return}if(e.innerHTML.startsWith("&nbsp;&nbsp;&nbsp;&nbsp;")){e.innerHTML=e.innerHTML.replace(/^(&nbsp;){4}/,"");return}try{const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let r=t.nextNode();for(;r;){const n=r.textContent;if(n.startsWith("    ")){r.textContent=n.substring(4);break}r=t.nextNode()}}catch{e.innerHTML=e.innerHTML.replace(/^(&nbsp;){4}/,"")}}function gt(e=!1){const t=window.getSelection();if(!t||t.rangeCount===0)return!1;let r=To();const n=t.getRangeAt(0);if(r.length===0){const o=bo(n.startContainer);if(!o)return!1;r=[o]}const s=r[0],a=r[r.length-1];r.forEach(o=>{if((o.tagName?o.tagName.toUpperCase():"")==="LI"){Eo(o,e);return}e?vo(o):yn(o,!1)});try{const o=document.createRange(),i=c=>c.nodeType===Node.TEXT_NODE?c:document.createTreeWalker(c,NodeFilter.SHOW_TEXT,null).nextNode(),h=c=>{if(c.nodeType===Node.TEXT_NODE)return c;const l=document.createTreeWalker(c,NodeFilter.SHOW_TEXT,null);let T=null,v=l.nextNode();for(;v;)T=v,v=l.nextNode();return T},f=i(s);f?o.setStart(f,0):o.setStart(s,0);const p=h(a);p?o.setEnd(p,p.length):o.setEnd(a,a.childNodes.length),t.removeAllRanges(),t.addRange(o)}catch{try{const i=document.createRange();i.setStartBefore(s),i.setEndAfter(a),t.removeAllRanges(),t.addRange(i)}catch(i){console.warn("Could not restore selection after indentation:",i)}}return!0}function xo(e){if(e.key!=="Tab")return!1;e.preventDefault();const t=e.shiftKey,r=window.getSelection(),n=r&&r.rangeCount>0?r.getRangeAt(0):null;return r&&r.rangeCount>0&&n&&!n.collapsed&&gt(t)||t||document.execCommand("insertHTML",!1,"&nbsp;&nbsp;&nbsp;&nbsp;"),!0}const _o=[{value:"Segoe UI",label:"Segoe UI"},{value:"Arial",label:"Arial"},{value:"Times New Roman",label:"Times New Roman"},{value:"Courier New",label:"Courier New"},{value:"Georgia",label:"Georgia"},{value:"Verdana",label:"Verdana"},{value:"Noto Sans Sinhala",label:"Noto Sans Sinhala"},{value:"Iskoola Pota",label:"Iskoola Pota"},{value:"Noto Sans Tamil",label:"Noto Sans Tamil"},{value:"Noto Sans",label:"Noto Sans"}],Ao=[{value:"p",label:"Normal"},{value:"h1",label:"Heading 1"},{value:"h2",label:"Heading 2"},{value:"h3",label:"Heading 3"},{value:"h4",label:"Heading 4"},{value:"h5",label:"Heading 5"},{value:"h6",label:"Heading 6"}],ko='<table border="1"><tr><td>Cell 1</td><td>Cell 2</td></tr><tr><td>Cell 3</td><td>Cell 4</td></tr></table>',Fe=({currentFormat:e,onFormatText:t,onAddPageBreak:r,canUndo:n=!1,canRedo:s=!1})=>{const a=async f=>{try{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(f.type)){alert("Invalid image format. Supported: PNG, JPEG, GIF, WEBP");return}if(f.size>5242880){alert("Image exceeds maximum size of 5MB");return}const c=await en(f),l=await tn(c);if(l){const v=`<img src="${l}" data-key="${c}" alt="Inserted image" />`;document.execCommand("insertHTML",!1,v),gn.info("Image inserted",{key:c})}const T=document.getElementById("image-upload");T&&(T.value="")}catch(p){gn.error("Error uploading image",p)}},o=(f,p,c,l)=>m.jsx("button",{onClick:()=>t(f),className:e[p]?"active":"",title:l,children:m.jsx(c,{size:16})},f),i=(f,p,c,l=!1)=>m.jsx("button",{onClick:f,disabled:l,title:c,style:{opacity:l?.5:1},children:m.jsx(p,{size:16})},c),h=()=>m.jsx("div",{className:"toolbar-separator"});return m.jsxs("div",{className:"editor-toolbar",children:[i(()=>t("undo"),po,"Undo",!n),i(()=>t("redo"),oo,"Redo",!s),h(),o("bold","bold",Fr,"Bold"),o("italic","italic",Jr,"Italic"),o("underline","underline",fo,"Underline"),o("strikethrough","strikethrough",io,"Strikethrough"),h(),o("justifyLeft","alignLeft",un,"Align Left"),o("justifyCenter","alignCenter",cn,"Align Center"),o("justifyRight","alignRight",ln,"Align Right"),o("justifyFull","alignJustify",lo,"Justify"),h(),m.jsx("select",{onChange:f=>t("fontName",f.target.value),value:e.fontFamily||"Segoe UI",title:"Font Family",children:_o.map(({value:f,label:p})=>m.jsx("option",{value:f,children:p},f))}),m.jsx("select",{onChange:f=>t("fontSize",f.target.value),value:e.fontSize||ke,title:"Font Size",children:Ht.map(({value:f,label:p})=>m.jsx("option",{value:f,children:p},f))}),m.jsx("select",{onChange:f=>t("formatBlock",f.target.value),value:e.headingLevel||"p",title:"Heading Level",children:Ao.map(({value:f,label:p})=>m.jsx("option",{value:f,children:p},f))}),h(),i(()=>t("insertUnorderedList"),sn,"Bullet List"),i(()=>t("insertOrderedList"),no,"Numbered List"),h(),m.jsx("button",{onClick:()=>{gt(!1)||document.execCommand("insertHTML",!1,"&nbsp;&nbsp;&nbsp;&nbsp;")},title:"Increase Indent (Tab)",children:m.jsx(to,{size:16})}),m.jsx("button",{onClick:()=>{gt(!0)},title:"Decrease Indent (Shift+Tab)",children:m.jsx(eo,{size:16})}),h(),m.jsx("button",{onClick:()=>{const f=prompt("Enter URL:");f&&t("createLink",f)},title:"Insert Link",children:m.jsx(Qr,{size:16})}),i(()=>t("insertHTML",ko),co,"Insert Table"),r&&i(r,ze,"Insert Page Break"),h(),m.jsx("input",{type:"file",accept:"image/*",onChange:f=>f.target.files[0]&&a(f.target.files[0]),style:{display:"none"},id:"image-upload"}),m.jsx("button",{onClick:()=>document.getElementById("image-upload").click(),title:"Insert Image",children:m.jsx(Xr,{size:16})})]})};Fe.propTypes={currentFormat:_.shape({bold:_.bool,italic:_.bool,underline:_.bool,strikethrough:_.bool,alignLeft:_.bool,alignCenter:_.bool,alignRight:_.bool,alignJustify:_.bool,fontFamily:_.string,fontSize:_.string,headingLevel:_.string}).isRequired,onFormatText:_.func.isRequired,onAddPageBreak:_.func,canUndo:_.bool,canRedo:_.bool},Fe.defaultProps={onAddPageBreak:void 0,canUndo:!1,canRedo:!1};function So(e){return!e||typeof e!="string"?e:He(e)}function Po(e){e.preventDefault();const t=e.clipboardData||window.clipboardData;if(!t)return null;let r=t.getData("text/html")||t.getData("text/plain");return r?(t.getData("text/html")?r=So(r):r=Co(r),document.execCommand("insertHTML",!1,r),r):null}function Co(e){if(!e)return"";const t=e.split(/\n\s*\n/).filter(r=>r.trim());return t.length===0?"<p><br></p>":t.map(r=>{const n=r.split(`
`).filter(a=>a.trim());return n.length===0?"<p><br></p>":`<p>${n.map(a=>wo(a.trim())).join("<br>")}</p>`}).join("")}function wo(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}const ye=e=>e?e.nodeType===Node.ELEMENT_NODE?e.tagName==="PAGE-BREAK"||e.getAttribute("data-page-break")==="true":e.parentElement&&ye(e.parentElement):!1,ht=({dimensions:e,editorRef:t,onInput:r,onContentChange:n,onKeyDown:s,onClick:a,onScroll:o,onPaste:i,onRemovePageBreak:h,zoomLevel:f=100,pageMargins:p=de})=>{const c=g.useMemo(()=>kt(p),[p]),l=f/100,T=g.useCallback((E,d)=>{if(!E)return!1;const y=E.getBoundingClientRect(),M=d-y.top;return M<c.top||M>y.height-c.bottom},[c.top,c.bottom]),v=g.useCallback((E,d)=>{d.preventDefault();const y=E.getBoundingClientRect(),M=d.clientX-y.left,q=d.clientY-y.top,K=y.width-40,se=-12,re=y.width-20;M>=K&&M<=re&&q>=se&&q<=8&&h&&h(E)},[h]),x=g.useCallback(E=>{E.preventDefault();const d=t.current.getBoundingClientRect();if(E.clientY-d.top<c.top){const M=t.current.firstElementChild;if(M&&M.tagName!=="PAGE-BREAK"){const q=document.createRange(),K=window.getSelection();q.setStart(M,0),q.collapse(!0),K.removeAllRanges(),K.addRange(q)}}else{const M=t.current.lastElementChild;if(M&&M.tagName!=="PAGE-BREAK"){const q=document.createRange(),K=window.getSelection();q.selectNodeContents(M),q.collapse(!1),K.removeAllRanges(),K.addRange(q)}}},[t,c.top]),S=g.useCallback(E=>{const d=window.getSelection();if(!d||d.rangeCount===0)return;const y=d.getRangeAt(0),{startContainer:M,endContainer:q}=y;if((ye(M)||ye(q))&&(E.key.length===1||E.key==="Enter"||E.key===" "))return E.preventDefault(),!1;if(xo(E))return n&&n(),!1;if((E.key==="Backspace"||E.key==="Delete")&&(ye(M)||ye(q)))return E.preventDefault(),!1;s&&s(E)},[s,n]),I=g.useCallback(E=>{if(!t.current)return;const d=E.target;if(ye(d)){v(d,E);return}if(T(t.current,E.clientY)){x(E);return}a&&a(E)},[t,a,v,x,T]),j=g.useCallback(E=>{const d=window.getSelection();if(!d||d.rangeCount===0)return;const y=d.getRangeAt(0),{startContainer:M}=y;if(ye(M))return E.preventDefault(),!1},[]),L=g.useCallback(E=>{const d=Po(E);i&&i(E,d)},[i]);return m.jsx("div",{className:"continuous-page-container",style:{position:"relative",width:"100%",maxWidth:`${e.width}px`,margin:"40px auto",backgroundColor:"transparent",minHeight:"100vh",transform:`scale(${l})`,transformOrigin:"top center",transition:"transform 0.2s ease-out"},children:m.jsx("div",{ref:t,contentEditable:!0,suppressContentEditableWarning:!0,className:"continuous-content",style:{position:"relative",zIndex:1,minHeight:`${e.height}px`,width:`${e.width}px`,backgroundColor:"white",padding:`${c.top}px ${c.right}px ${c.bottom}px ${c.left}px`,boxSizing:"border-box",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",outline:"none",cursor:"text",fontFamily:'"Segoe UI", "Noto Sans Sinhala", "Noto Sans", "Malithi Web", "Iskoola Pota", "Kaputa Unicode", "Helvetica Neue", Arial, "Hiragino Sans GB", "WenQuanYi Micro Hei", "Microsoft YaHei", sans-serif',fontSize:ke,lineHeight:"1.3",color:"#333",wordWrap:"break-word",whiteSpace:"pre-wrap",overflowWrap:"break-word",border:"1px solid #e0e0e0"},onInput:r,onKeyDown:S,onBeforeInput:j,onClick:I,onScroll:o,onPaste:L,"data-testid":"continuous-editor"})})};ht.propTypes={dimensions:_.shape({width:_.number.isRequired,height:_.number.isRequired}).isRequired,editorRef:_.shape({current:_.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onInput:_.func.isRequired,onContentChange:_.func,onKeyDown:_.func,onClick:_.func,onScroll:_.func,onPaste:_.func,onRemovePageBreak:_.func,zoomLevel:_.number,pageMargins:_.string},ht.defaultProps={onContentChange:void 0,onKeyDown:void 0,onClick:void 0,onScroll:void 0,onPaste:void 0,onRemovePageBreak:void 0,zoomLevel:100,pageMargins:de};const En=g.memo(ht),mt=({pageBoundaries:e=[{id:"page-0",pageNumber:1}],activePage:t=0,pageSize:r="A4",pageMargins:n=de,zoomLevel:s=100,canZoomIn:a=!0,canZoomOut:o=!0,onNavigate:i,onAddPage:h,onDeletePage:f,onPageSizeChange:p,onPageMarginsChange:c,onZoomIn:l,onZoomOut:T,onZoomReset:v}={})=>{const x=Math.max(e?.length||0,1),S=d=>{i&&i(d)},I=()=>{h&&h()},j=d=>{if(x<=1){console.warn("[PageManager] Cannot delete the only page");return}f&&f(d)},L=d=>{p&&p(d)},E=d=>{c&&c(d)};return m.jsxs("div",{className:"page-manager",children:[m.jsxs("div",{className:"page-settings-group",children:[m.jsxs("div",{className:"page-settings-header",children:[m.jsx(so,{size:14,style:{marginRight:"4px",verticalAlign:"middle"}}),"Page Settings"]}),m.jsxs("div",{className:"page-settings-controls",children:[m.jsxs("div",{className:"page-setting-item",children:[m.jsx("label",{htmlFor:"page-size-selector",children:"Size:"}),m.jsxs("select",{id:"page-size-selector",role:"combobox","aria-label":"Page size selector",value:r,onChange:d=>L(d.target.value),children:[m.jsx("option",{value:"A4",children:"A4"}),m.jsx("option",{value:"Letter",children:"Letter"}),m.jsx("option",{value:"Legal",children:"Legal"})]})]}),m.jsxs("div",{className:"page-setting-item",children:[m.jsx("label",{htmlFor:"page-margins-selector",children:"Margins:"}),m.jsx("select",{id:"page-margins-selector",role:"combobox","aria-label":"Page margins selector",value:n,onChange:d=>E(d.target.value),children:Dn().map(d=>m.jsx("option",{value:d,children:jn(d)},d))})]})]})]}),m.jsxs("div",{className:"zoom-controls-compact",children:[m.jsx("button",{type:"button",className:"zoom-button-compact",onClick:T,disabled:!o,"aria-label":"Zoom out",title:"Zoom out (Ctrl + -)",children:m.jsx(mo,{size:12})}),m.jsxs("span",{className:"zoom-level-display",children:[s,"%"]}),m.jsx("button",{type:"button",className:"zoom-button-compact",onClick:l,disabled:!a,"aria-label":"Zoom in",title:"Zoom in (Ctrl + +)",children:m.jsx(ho,{size:12})}),m.jsx("button",{type:"button",className:"zoom-reset-compact",onClick:v,"aria-label":"Reset zoom",title:"Reset zoom to 100% (Ctrl + 0)",children:"Reset"})]}),m.jsx("div",{className:"page-list",children:e.map((d,y)=>m.jsxs("div",{className:"page-item",children:[m.jsxs("button",{type:"button",className:`page-button ${y===t?"active":""}`,onClick:()=>S(y),"aria-label":`Go to page ${y+1}`,"aria-current":y===t?"page":void 0,children:[m.jsx(ze,{size:14}),m.jsxs("span",{children:["Page ",y+1]})]}),x>1&&m.jsx("button",{type:"button",className:"delete-page-button",onClick:M=>{M.stopPropagation(),j(y)},"aria-label":`Delete page ${y+1}`,title:"Delete this page and its content",children:m.jsx(go,{size:14})})]},d.id||`page-${y}`))}),m.jsxs("button",{type:"button",className:"add-page-button",onClick:I,"aria-label":"Add new page",title:"Add new page at end",children:[m.jsx(ro,{size:16}),m.jsx("span",{children:"Add Page"})]})]})};mt.propTypes={pageBoundaries:_.arrayOf(_.shape({id:_.string.isRequired,pageNumber:_.number.isRequired,top:_.number,height:_.number})),activePage:_.number,pageSize:_.oneOf(["A4","Letter","Legal"]),pageMargins:_.string,zoomLevel:_.number,canZoomIn:_.bool,canZoomOut:_.bool,onNavigate:_.func,onAddPage:_.func,onDeletePage:_.func,onPageSizeChange:_.func,onPageMarginsChange:_.func,onZoomIn:_.func,onZoomOut:_.func,onZoomReset:_.func},mt.defaultProps={pageBoundaries:[{id:"page-0",pageNumber:1}],activePage:0,pageSize:"A4",pageMargins:de,zoomLevel:100,canZoomIn:!0,canZoomOut:!0,onNavigate:void 0,onAddPage:void 0,onDeletePage:void 0,onPageSizeChange:void 0,onPageMarginsChange:void 0,onZoomIn:void 0,onZoomOut:void 0,onZoomReset:void 0};const bn=g.memo(mt);function Oo(e){switch(e){case N.TOP_LEFT:case N.BOTTOM_RIGHT:return"nwse-resize";case N.TOP_RIGHT:case N.BOTTOM_LEFT:return"nesw-resize";case N.TOP:case N.BOTTOM:return"ns-resize";case N.LEFT:case N.RIGHT:return"ew-resize";default:return"default"}}function No({handler:e,startX:t,startY:r,currentX:n,currentY:s,startWidth:a,startHeight:o,options:i=me}){const h=n-t,f=s-r;let p=a,c=o;switch(e){case N.TOP_LEFT:p=Math.max(i.minWidth,a-h),c=Math.max(i.minHeight,o-f);break;case N.TOP_RIGHT:p=Math.max(i.minWidth,a+h),c=Math.max(i.minHeight,o-f);break;case N.BOTTOM_LEFT:p=Math.max(i.minWidth,a-h),c=Math.max(i.minHeight,o+f);break;case N.BOTTOM_RIGHT:p=Math.max(i.minWidth,a+h),c=Math.max(i.minHeight,o+f);break;case N.TOP:c=Math.max(i.minHeight,o-f);break;case N.BOTTOM:c=Math.max(i.minHeight,o+f);break;case N.LEFT:p=Math.max(i.minWidth,a-h);break;case N.RIGHT:p=Math.max(i.minWidth,a+h);break;default:return{width:p,height:c}}if(i.preserveAspectRatio&&i.aspectRatio){const l=a/o;[N.TOP_LEFT,N.TOP_RIGHT,N.BOTTOM_LEFT,N.BOTTOM_RIGHT].includes(e)?p/l>c?c=Math.max(i.minHeight,p/l):p=Math.max(i.minWidth,c*l):[N.TOP,N.BOTTOM].includes(e)?p=c*l:[N.LEFT,N.RIGHT].includes(e)&&(c=p/l)}return i.maxWidth&&p>i.maxWidth&&(p=i.maxWidth,i.preserveAspectRatio&&i.aspectRatio&&(c=p/(a/o))),i.maxHeight&&c>i.maxHeight&&(c=i.maxHeight,i.preserveAspectRatio&&i.aspectRatio&&(p=c*(a/o))),p=Math.max(i.minWidth,p),c=Math.max(i.minHeight,c),{width:Math.round(p),height:Math.round(c)}}function Tn(e,{width:t,height:r}){fe(e)&&(e.tagName==="IMG"?(e.style.width=`${t}px`,e.style.height=`${r}px`,e.width=t,e.height=r):e.tagName==="DIV"&&(e.style.width=`${t}px`,e.style.height=`${r}px`))}function Mo(e,t,r){Tn(t,r);const n=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(n)}function Ro(e,t,r,n){const{ctrlKey:s,metaKey:a,shiftKey:o,key:i}=e,h=s||a,f=r.offsetWidth,p=r.offsetHeight,l={">":h&&o?()=>({width:Math.min(n.maxWidth||800,f+10),height:p}):null,"<":h&&o?()=>({width:Math.max(n.minWidth||50,f-10),height:p}):null,"+":h&&o?()=>({width:f,height:Math.min(n.maxHeight||600,p+10)}):null,"-":h&&o?()=>({width:f,height:Math.max(n.minHeight||50,p-10)}):null,r:h&&!o?()=>({width:300,height:200}):null}[i];if(l){e.preventDefault();const T=l();return Mo(t,r,T),!0}return!1}const Ue=({editorRef:e,onImageResize:t,onImageSelect:r,onImageDeselect:n,resizeOptions:s=me})=>{const a=g.useRef(null),o=g.useRef(null),i=g.useRef(null),h=g.useRef(null),f=g.useRef(s),p=g.useRef(!1),c=be();g.useEffect(()=>{f.current=s},[s]);const l=g.useCallback(E=>{if(!fe(E))return;a.current&&($e(a.current),a.current=null),E.classList.add("selected");const d=Jt(E,f.current);d&&(a.current=d,o.current=E,document.body.appendChild(d),d.querySelectorAll(".resize-handler").forEach(M=>{M.addEventListener("mousedown",v)}),r&&r(E))},[r]),T=g.useCallback(()=>{o.current&&(o.current.classList.remove("selected"),o.current=null),a.current&&($e(a.current),a.current=null),i.current=null,h.current=null,p.current=!1,n&&n()},[n]),v=g.useCallback(E=>{if(E.preventDefault(),E.stopPropagation(),!o.current)return;const d=E.currentTarget.dataset.handler,y=o.current.getBoundingClientRect(),M=window.pageYOffset||document.documentElement.scrollTop,q=window.pageXOffset||document.documentElement.scrollLeft;i.current={x:E.clientX,y:E.clientY,width:o.current.offsetWidth,height:o.current.offsetHeight,originalWidth:o.current.offsetWidth,originalHeight:o.current.offsetHeight,offsetX:E.clientX-y.left-q,offsetY:E.clientY-y.top-M},h.current=d,p.current=!0,document.body.classList.add("resize-in-progress"),document.body.style.cursor=Oo(d),document.addEventListener("mousemove",x),document.addEventListener("mouseup",S)},[]),x=g.useCallback(E=>{if(!p.current||!o.current||!i.current||!h.current)return;E.preventDefault(),E.stopPropagation();const{x:d,y,width:M,height:q}=i.current,K=h.current,se=E.clientX,re=E.clientY,ne=No({handler:K,startX:d,startY:y,currentX:se,currentY:re,startWidth:M,startHeight:q,options:f.current});Tn(o.current,ne),a.current&&Be(a.current,o.current)},[]),S=g.useCallback(E=>{if(p.current){if(E.preventDefault(),E.stopPropagation(),o.current&&i.current){const d={width:i.current.originalWidth,height:i.current.originalHeight},y={width:o.current.offsetWidth,height:o.current.offsetHeight};(d.width!==y.width||d.height!==y.height)&&c.recordOperation({type:"IMAGE_RESIZE",payload:{element:o.current,state:y}},{type:"IMAGE_RESIZE",payload:{element:o.current,state:d}})}if(i.current=null,h.current=null,p.current=!1,document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",S),document.body.classList.remove("resize-in-progress"),document.body.style.cursor="",o.current){const d=new Event("input",{bubbles:!0,cancelable:!0});o.current.dispatchEvent(d),t&&t(o.current,{width:o.current.offsetWidth,height:o.current.offsetHeight})}}},[t,c]),I=g.useCallback(E=>{a.current&&!a.current.contains(E.target)&&T();const d=E.target;if(fe(d)){if(d===o.current)return;l(d)}},[l,T]),j=g.useCallback(E=>{if((E.key==="Delete"||E.key==="Backspace")&&o.current&&!p.current){E.preventDefault();const d=o.current;if(d.parentNode){d.parentNode.removeChild(d),T();const y=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(y)}}E.key==="Escape"&&o.current&&T(),o.current&&!p.current&&Ro(E,e,o.current,f.current)},[e,T]),L=g.useCallback(()=>{a.current&&o.current&&Be(a.current,o.current)},[]);return g.useEffect(()=>{if(!e.current)return;const d=e.current.closest(".editor-viewport");return d&&(d.addEventListener("scroll",L),window.addEventListener("scroll",L)),()=>{d&&d.removeEventListener("scroll",L),window.removeEventListener("scroll",L)}},[e,L]),g.useEffect(()=>{if(!e.current)return;const E=e.current;return E.addEventListener("click",I),E.addEventListener("keydown",j),window.addEventListener("resize",L),()=>{E.removeEventListener("click",I),E.removeEventListener("keydown",j),window.removeEventListener("resize",L),p.current&&(document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",S),document.body.classList.remove("resize-in-progress"),document.body.style.cursor=""),a.current&&$e(a.current)}},[e,I,j,L,x,S]),g.useEffect(()=>{if(!e.current)return;const E=new MutationObserver(d=>{d.forEach(y=>{y.type==="childList"&&(y.removedNodes.forEach(M=>{M.nodeType===Node.ELEMENT_NODE&&fe(M)&&M===o.current&&T()}),y.addedNodes.forEach(M=>{if(M.nodeType!==Node.ELEMENT_NODE)return;if(fe(M)){setTimeout(()=>l(M),50);return}const q=M.querySelectorAll?.("img")||[];q.length>0&&setTimeout(()=>l(q[0]),50)}))})});return E.observe(e.current,{childList:!0,subtree:!0}),()=>E.disconnect()},[e,T,l]),null};Ue.propTypes={editorRef:_.shape({current:_.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onImageResize:_.func,onImageSelect:_.func,onImageDeselect:_.func,resizeOptions:_.shape({minWidth:_.number,minHeight:_.number,maxWidth:_.number,maxHeight:_.number,aspectRatio:_.bool,preserveAspectRatio:_.bool,defaultWidth:_.number,defaultHeight:_.number})},Ue.defaultProps={onImageResize:void 0,onImageSelect:void 0,onImageDeselect:void 0,resizeOptions:me};const yt=({imageElement:e,onAlignChange:t,onAspectRatioToggle:r,onDelete:n,onClose:s,initialPreserveAspectRatio:a=!0})=>{const[o,i]=g.useState({top:0,left:0}),[h,f]=g.useState(!1),[p,c]=g.useState("top"),[l,T]=g.useState(a),v=g.useRef(null),x=g.useRef(null),S=be(),I=O=>{if(!O)return;(typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame:te=>setTimeout(te,16))(()=>{const te=document.querySelector(".image-resize-overlay");te&&Be(te,O)})},j=O=>{if(!O)return null;const G=window.getComputedStyle(O);return{float:G.float||"none",margin:O.style.margin||"",display:G.display||"inline",width:O.style.width||O.width||"",height:O.style.height||O.height||"",aspectRatio:l}},L=g.useCallback(()=>{if(!e)return"left";const O=window.getComputedStyle(e);return O.float==="right"?"right":O.float==="left"?"left":O.display==="block"&&O.margin.includes("auto")?"center":"left"},[e]),[E,d]=g.useState("left");g.useEffect(()=>{e&&d(L())},[e,L]);const y=g.useCallback(()=>{if(!e||!v.current)return;const O=e.getBoundingClientRect(),G=v.current.getBoundingClientRect(),te=window.visualViewport?window.visualViewport:{width:window.innerWidth,height:window.innerHeight},X=O.bottom>=0&&O.top<=te.height&&O.right>=0&&O.left<=te.width;let Q="top",ee=0,ae=0;if(X){const C=O.top-G.height-10,z=te.height-O.bottom-G.height-10;z>C&&z>0?(Q="bottom",ee=O.bottom+10):(Q="top",ee=O.top-G.height-10)}else Q="top",ee=10;ae=O.left+O.width/2-G.width/2;const b=window.innerWidth,u=window.innerHeight;let A=Math.max(10,Math.min(ae,b-G.width-10)),w=Math.max(10,Math.min(ee,u-G.height-10));i({top:w,left:A}),c(Q),f(!0)},[e]);g.useLayoutEffect(()=>{y();const O=()=>{y()},G=x.current;return G&&G.addEventListener("scroll",O),window.addEventListener("scroll",O),window.addEventListener("resize",O),()=>{G&&G.removeEventListener("scroll",O),window.removeEventListener("scroll",O),window.removeEventListener("resize",O),f(!1)}},[e,y]),g.useEffect(()=>{const O=G=>{v.current&&!v.current.contains(G.target)&&G.target!==e&&s()};return document.addEventListener("mousedown",O),()=>{document.removeEventListener("mousedown",O)}},[e,s]);const M={left:{float:"left",margin:"0 10px 10px 0",display:"block"},center:{float:"none",margin:"10px auto",display:"block"},right:{float:"right",margin:"0 0 10px 10px",display:"block"}},q=O=>{if(e&&M[O]){const G=j(e),te=E,X=M[O];e.style.float=X.float,e.style.margin=X.margin,e.style.display=X.display,d(O),I(e);const Q=j(e);S.recordOperation({type:"IMAGE_ALIGN",payload:{element:e,alignment:O,state:Q}},{type:"IMAGE_ALIGN",payload:{element:e,alignment:te,state:G}}),t&&t(O)}},K=()=>{if(e&&e.parentNode){const O={element:e,parent:e.parentNode,nextSibling:e.nextSibling};S.recordOperation({type:"IMAGE_DELETE",payload:{element:e}},{type:"IMAGE_REINSERT",payload:{state:O}}),e.parentNode.removeChild(e),n&&n(),s()}},se=()=>{const O=l,G=!l;T(G),S.recordOperation({type:"IMAGE_ASPECT_RATIO",payload:{element:e,preserveAspectRatio:G}},{type:"IMAGE_ASPECT_RATIO",payload:{element:e,preserveAspectRatio:O}}),r&&r(G)},re={border:"1px solid #ccc",borderRadius:"4px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"28px",height:"28px"},ne=O=>({...re,background:O?"#007bff":"transparent",color:O?"#fff":"#333"});return!e||typeof document>"u"?null:wn.createPortal(m.jsxs("div",{ref:v,className:"image-tooltip-menu","data-menu-position":p,"aria-hidden":!h,style:{position:"fixed",top:`${o.top}px`,left:`${o.left}px`,zIndex:999,background:"#fff",border:"1px solid #ddd",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"8px",display:"flex",gap:"2px",alignItems:"center",pointerEvents:h?"auto":"none",minWidth:"140px",minHeight:"32px",opacity:h?1:0,visibility:h?"visible":"hidden",transition:"opacity 0.15s ease, visibility 0.15s ease"},children:[m.jsx("button",{className:`tooltip-button aspect-ratio-toggle ${l?"":"active"}`,onClick:se,title:`Toggle aspect ratio preservation (currently ${l?"ON":"OFF"})`,children:l?m.jsx(ao,{size:14}):m.jsx(Kr,{size:14})}),m.jsx("button",{className:`tooltip-button ${E==="left"?"active":""}`,onClick:()=>q("left"),title:"Align Left",style:ne(E==="left"),children:m.jsx(un,{size:14})}),m.jsx("button",{className:`tooltip-button ${E==="center"?"active":""}`,onClick:()=>q("center"),title:"Align Center",style:ne(E==="center"),children:m.jsx(cn,{size:14})}),m.jsx("button",{className:`tooltip-button ${E==="right"?"active":""}`,onClick:()=>q("right"),title:"Align Right",style:ne(E==="right"),children:m.jsx(ln,{size:14})}),m.jsx("button",{className:"tooltip-button delete-button",onClick:K,title:"Delete Image",style:{background:"transparent",color:"#dc3545",border:"1px solid #dc3545",borderRadius:"4px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"28px",height:"28px"},children:m.jsx(uo,{size:14})})]}),document.body)};yt.propTypes={imageElement:_.instanceOf(typeof Element<"u"?Element:Object),onAlignChange:_.func,onAspectRatioToggle:_.func,onDelete:_.func,onClose:_.func.isRequired,initialPreserveAspectRatio:_.bool},yt.defaultProps={imageElement:null,onAlignChange:void 0,onAspectRatioToggle:void 0,onDelete:void 0,initialPreserveAspectRatio:!0};const Io=50,Et=50,Lo=50,Ge=g.forwardRef(({pageManagerComponent:e=null,onNavigatePage:t,onAddPage:r,onDeletePage:n,onPageSizeChange:s,onPageMarginsChange:a,onChange:o,showSidebar:i=!0,showToolbar:h=!0,showPageManager:f=!0},p)=>{const c=at(),l=be(),{pageSize:T,pageMargins:v,continuousContent:x,pageBoundaries:S,activePage:I,zoomLevel:j,canUndo:L,canRedo:E}=c,d=g.useRef(null),y=g.useRef(null),{currentFormat:M,formatText:q,updateCurrentFormatFromSelection:K}=Gt(),[se,re]=g.useState(!1),[ne,O]=g.useState(null),[G,te]=g.useState(!0),X=g.useRef(null),{checkAndUpdateBoundaries:Q,getCurrentPage:ee,scrollToPage:ae,updateBoundaries:b,triggerAutoReflow:u,removePageAndContent:A,removePageBreak:w,insertPageBreakAtBoundary:C}=Xt(T,y,j,v),z=g.useMemo(()=>Me(T),[T]),[H,R]=g.useState(!1),B=g.useRef(null),U=g.useRef(!1),F=g.useRef(!1),oe=g.useRef(!1),k=g.useRef(x);g.useEffect(()=>{if(y.current){if(!oe.current){y.current.innerHTML=x,oe.current=!0,k.current=x;const P=setTimeout(()=>{b()},Io);return()=>clearTimeout(P)}if(k.current!==x){if(y.current.innerHTML!==x){y.current.innerHTML=x;const Z=setTimeout(()=>{b(),U.current&&Ee()},Et);return k.current=x,()=>clearTimeout(Z)}k.current=x}}},[x,b,S.length,l,ae]),g.useEffect(()=>{o&&oe.current&&o(x)},[x,o]);const ce=g.useMemo(()=>({getHTMLContent:()=>y.current?y.current.innerHTML:x,getPlainText:()=>(y.current?y.current.innerHTML:x).replace(/<[^>]*>/g," ").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\s+/g," ").trim(),getCursorPosition:()=>y.current?Tr(y.current):null,setContent:P=>{const Z=He(P);Z!==x&&l.updateContinuousContent(Z),y.current&&y.current.innerHTML!==Z&&(y.current.innerHTML=Z),k.current=Z,y.current&&setTimeout(()=>{b()},Et)},insertContent:P=>{if(!y.current||!P)return;const Z=He(P),J=window.getSelection();let ue=!1;if(J&&J.rangeCount>0){const Tt=J.getRangeAt(0);y.current.contains(Tt.commonAncestorContainer)&&(ue=!0)}if(!ue&&X.current)try{J.removeAllRanges(),J.addRange(X.current)}catch(Tt){console.warn("[insertContent] Failed to restore last cursor position:",Tt);const Ce=y.current.lastChild;if(Ce){const Ye=document.createRange();Ce.nodeType===Node.TEXT_NODE?Ye.setStart(Ce,Ce.textContent.length):Ye.setStartAfter(Ce),Ye.collapse(!0),J.removeAllRanges(),J.addRange(Ye)}}document.execCommand("insertHTML",!1,Z);const ge=y.current.innerHTML;l.updateContinuousContent(ge),k.current=ge,setTimeout(()=>{b(),u(200)},Et)}}),[x,l,b,y,X,Q]);g.useImperativeHandle(p,()=>ce,[ce]),g.useEffect(()=>{const P=()=>{if(K(),y.current){const J=window.getSelection();if(J.rangeCount>0){const ue=J.getRangeAt(0);ue.collapsed&&y.current.contains(ue.commonAncestorContainer)&&(X.current=ue.cloneRange())}}};document.addEventListener("selectionchange",P);const Z=()=>{if(setTimeout(K,10),X.current&&y.current)try{const J=window.getSelection();J.removeAllRanges(),J.addRange(X.current)}catch(J){console.warn("[handleFocus] Failed to restore cursor:",J)}};return y.current&&y.current.addEventListener("focus",Z),()=>{document.removeEventListener("selectionchange",P),y.current&&y.current.removeEventListener("focus",Z)}},[K]);const Ee=g.useCallback(()=>{U.current=!1;const P=Math.max(0,S.length-1);l.setActivePage(P),setTimeout(()=>{ae(P,d)},Lo)},[S.length,l,ae]),Te=g.useCallback(()=>{if(!y.current)return;let P=y.current.innerHTML;P=He(P),P!==y.current.innerHTML&&(y.current.innerHTML=P);const Z=x;if(Z!==P){const ue={type:"UPDATE_CONTINUOUS_CONTENT",payload:P},ge={type:"UPDATE_CONTINUOUS_CONTENT",payload:Z};l.recordOperation(ue,ge)}l.updateContinuousContent(P),Q(),u(200);const J=ee(d);J!==I&&l.setActivePage(J)},[l,Q,ee,I,u,d,y,x]),jo=g.useCallback(P=>{Te()},[Te]),vn=g.useCallback(P=>{l.updatePageSize(P),b({pageSize:P}),s&&s(P)},[l,b,s]),xn=g.useCallback(P=>{l.updatePageMargins(P),b({pageMargins:P}),a&&a(P)},[l,b,a]),_n=g.useCallback(P=>{P<0||P>=S.length||(F.current=!0,l.setActivePage(P),ae(P,d),setTimeout(()=>{F.current=!1},NAVIGATION_LOCK_TIMEOUT),t&&t(P))},[l,ae,t,S.length]),An=g.useCallback(()=>{const P=S.length+1;C(P)&&(U.current=!0,setTimeout(()=>{U.current&&Ee()},100)),r&&r()},[S.length,C,l,ae,r]),Bo=g.useCallback(()=>{const P=window.getSelection();if(P&&P.rangeCount>0){if(!y?.current)return;const ue=`<page-break data-page-break="true" contenteditable="false" data-page-number="${y.current.querySelectorAll('page-break, [data-page-break="true"]').length+2}"></page-break><p><br></p>`;document.execCommand("insertHTML",!1,ue),setTimeout(()=>{b();const ge=ee(d);l.setActivePage(ge)},150)}},[b,ee,l,d]),$o=g.useCallback(P=>{if(!P)return;w(P)&&setTimeout(()=>{const J=ee(d);l.setActivePage(J)},200)},[w,ee,l,d]),kn=g.useCallback(P=>{if(S.length<=1){console.warn("Cannot delete the only page");return}A(P)&&(l.setActivePage(0),n&&n(P))},[S.length,A,l,n]),qe=g.useCallback(()=>{l.zoomIn()},[l]),We=g.useCallback(()=>{l.zoomOut()},[l]),Ze=g.useCallback(()=>{l.resetZoom()},[l]),Sn=g.useCallback(()=>{l.undo()},[l]),Pn=g.useCallback(()=>{l.redo()},[l]);g.useEffect(()=>{const P=Z=>{if(Z.ctrlKey||Z.metaKey){["+","=","-","_","0","z","y"].includes(Z.key)&&Z.preventDefault();const J=document.activeElement===y.current,ue=document.activeElement===d.current,ge=document.activeElement?.tagName==="INPUT"||document.activeElement?.tagName==="TEXTAREA"||document.activeElement?.isContentEditable===!1;if(J||ue||!ge)switch(Z.key){case"+":case"=":qe();break;case"-":case"_":We();break;case"0":Ze();break;case"z":Z.shiftKey||Sn();break;case"y":Pn();break}}};return window.addEventListener("keydown",P),()=>{window.removeEventListener("keydown",P)}},[qe,We,Ze,Sn,Pn]);const Ho=g.useCallback(()=>{!d.current||!y.current||F.current||(B.current&&clearTimeout(B.current),B.current=setTimeout(()=>{if(F.current){B.current=null;return}const P=ee(d);P!==I&&P>=0&&l.setActivePage(P),B.current=null},SCROLL_DEBOUNCE))},[ee,I,l]),zo=g.useMemo(()=>{if(!x)return 0;const Z=x.replace(/<[^>]*>/g," ").match(new RegExp("\\p{L}+","gu"));return Z?Z.length:0},[x]),Fo=S.length||1,Uo=g.useCallback(P=>{re(!0),O(P)},[]),Cn=g.useCallback(()=>{re(!1),O(null)},[]),Go=g.useCallback((P,Z)=>{},[]);return g.useEffect(()=>()=>{B.current&&clearTimeout(B.current)},[]),m.jsxs("div",{className:"multi-page-editor",children:[h&&m.jsx(Fe,{currentFormat:{...M,imageSelected:se},onFormatText:q,onAddPageBreak:Bo,canUndo:L,canRedo:E}),m.jsxs("div",{className:"editor-container",children:[i&&m.jsx(fn,{editorView:null,isCollapsed:H,onToggle:()=>R(P=>!P),wordCount:zo,pageCount:Fo}),m.jsx("div",{className:"editor-viewport continuous-scroll",ref:d,onScroll:Ho,children:m.jsx(En,{content:x,dimensions:z,pageSize:T,pageMargins:v,pageBoundaries:S,editorRef:y,onInput:jo,onContentChange:Te,onClick:()=>y.current?.focus(),onRemovePageBreak:$o,zoomLevel:j})}),m.jsx(Ue,{editorRef:y,onImageSelect:Uo,onImageDeselect:Cn,onImageResize:Go,resizeOptions:{...me,preserveAspectRatio:G,aspectRatio:G}}),se&&ne&&m.jsx(yt,{imageElement:ne,initialPreserveAspectRatio:G,onAlignChange:P=>{},onAspectRatioToggle:P=>{te(P)},onDelete:()=>{if(ne){const P=ne.getAttribute("data-key");P&&nn(P).catch(Z=>{console.error("Failed to delete image from IndexedDB:",Z)})}},onClose:Cn}),f&&m.jsx("div",{className:"page-manager-sidebar",children:e?g.cloneElement(e,{onNavigate:_n,onAddPage:An,onDeletePage:kn,onPageSizeChange:vn,onPageMarginsChange:xn,zoomLevel:j,canZoomIn:Qe(j),canZoomOut:et(j),onZoomIn:qe,onZoomOut:We,onZoomReset:Ze}):m.jsx(bn,{pageBoundaries:S,activePage:I,pageSize:T,pageMargins:v,zoomLevel:j,canZoomIn:Qe(j),canZoomOut:et(j),onNavigate:_n,onAddPage:An,onDeletePage:kn,onPageSizeChange:vn,onPageMarginsChange:xn,onZoomIn:qe,onZoomOut:We,onZoomReset:Ze})})]})]})});Ge.displayName="HtmlEditor",Ge.propTypes={pageManagerComponent:_.element,onNavigatePage:_.func,onAddPage:_.func,onDeletePage:_.func,onPageSizeChange:_.func,onPageMarginsChange:_.func,onChange:_.func,showSidebar:_.bool,showToolbar:_.bool,showPageManager:_.bool},Ge.defaultProps={pageManagerComponent:null,onNavigatePage:void 0,onAddPage:void 0,onDeletePage:void 0,onPageSizeChange:void 0,onPageMarginsChange:void 0,onChange:void 0,showSidebar:!0,showToolbar:!0,showPageManager:!0};class bt extends g.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,r){console.error("[ErrorBoundary] Caught error:",t),console.error("[ErrorBoundary] Error info:",r),this.setState({error:t,errorInfo:r}),this.props.onError&&this.props.onError(t,r)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onReset&&this.props.onReset()};render(){return this.state.hasError?this.props.fallback?this.props.fallback:m.jsxs("div",{style:{padding:"20px",margin:"20px",border:"2px solid #f44336",borderRadius:"4px",backgroundColor:"#ffebee",color:"#c62828"},children:[m.jsx("h2",{style:{marginTop:0},children:"⚠️ Something went wrong"}),m.jsx("p",{children:"The editor encountered an unexpected error and couldn't continue."}),this.props.showDetails&&this.state.error&&m.jsxs("details",{style:{marginTop:"10px",padding:"10px",backgroundColor:"white",borderRadius:"4px",fontSize:"12px",fontFamily:"monospace"},children:[m.jsx("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Error Details"}),m.jsxs("pre",{style:{marginTop:"10px",overflow:"auto",maxHeight:"200px"},children:[this.state.error.toString(),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}),m.jsx("button",{onClick:this.handleReset,style:{marginTop:"15px",padding:"8px 16px",backgroundColor:"#f44336",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:"Try Again"})]}):this.props.children}}bt.propTypes={children:_.node.isRequired,fallback:_.node,onError:_.func,onReset:_.func,showDetails:_.bool},bt.defaultProps={fallback:null,onError:void 0,onReset:void 0,showDetails:process.env.NODE_ENV==="development"};const Do={A4:{width:ie.A4.width,height:ie.A4.height},Letter:{width:ie.Letter.width,height:ie.Letter.height},Legal:{width:ie.Legal.width,height:ie.Legal.height}};D.COMMON_FONT_SIZES=Ht,D.DEFAULT_FONT_SIZE=ke,D.DEFAULT_IMAGE_RESIZE_OPTIONS=me,D.DEFAULT_PAGE_SIZE=tt,D.DocumentProvider=Fn,D.EditorToolbar=Fe,D.ErrorBoundary=bt,D.FONT_SIZE_MAP=pt,D.HtmlEditor=Ge,D.ImageResizeHandlers=Ue,D.PAGE_DIMENSIONS=Do,D.PAGE_SIZES=ie,D.PageManager=bn,D.PageView=En,D.RESIZE_HANDLERS=N,D.Sidebar=fn,D.applyImageDimensions=Ar,D.calculateResizeDimensions=xr,D.clearImages=wr,D.createResizeOverlay=Jt,D.deleteImage=nn,D.getAllImageKeys=Or,D.getAvailablePageSizes=$n,D.getImage=tn,D.getImageDimensions=_r,D.getPageDimensions=Me,D.getPixelValue=Xn,D.getPointValue=Jn,D.isResizableImage=fe,D.isValidFontSize=Qn,D.isValidPageSize=Bn,D.logger=pn,D.pixelsToPoints=Ft,D.pointsToPixels=zt,D.removeResizeOverlay=$e,D.saveImage=en,D.updateResizeOverlay=Be,D.useContinuousReflow=Xt,D.useDocument=ot,D.useDocumentActions=be,D.useDocumentState=at,D.useFormatting=Gt,Object.defineProperty(D,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=htmleditor.umd.cjs.map
