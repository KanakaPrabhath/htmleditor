(function(U,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("react"),require("uuid"),require("react-dom")):typeof define=="function"&&define.amd?define(["exports","react","uuid","react-dom"],l):(U=typeof globalThis<"u"?globalThis:U||self,l(U.HTMLEditor={},U.React,U.uuid,U.ReactDOM))})(this,(function(U,l,nt,Wt){"use strict";function lr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var De={exports:{}},Ce={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gt;function cr(){if(Gt)return Ce;Gt=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function r(n,a,o){var s=null;if(o!==void 0&&(s=""+o),a.key!==void 0&&(s=""+a.key),"key"in a){o={};for(var i in a)i!=="key"&&(o[i]=a[i])}else o=a;return a=o.ref,{$$typeof:e,type:n,key:s,ref:a!==void 0?a:null,props:o}}return Ce.Fragment=t,Ce.jsx=r,Ce.jsxs=r,Ce}var Ae={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zt;function ur(){return Zt||(Zt=1,process.env.NODE_ENV!=="production"&&(function(){function e(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===I?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case v:return"Fragment";case N:return"Profiler";case _:return"StrictMode";case x:return"Suspense";case q:return"SuspenseList";case k:return"Activity"}if(typeof u=="object")switch(typeof u.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),u.$$typeof){case T:return"Portal";case E:return u.displayName||"Context";case O:return(u._context.displayName||"Context")+".Consumer";case y:var M=u.render;return u=u.displayName,u||(u=M.displayName||M.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case P:return M=u.displayName||null,M!==null?M:e(u.type)||"Memo";case z:M=u._payload,u=u._init;try{return e(u(M))}catch{}}return null}function t(u){return""+u}function r(u){try{t(u);var M=!1}catch{M=!0}if(M){M=console;var H=M.error,j=typeof Symbol=="function"&&Symbol.toStringTag&&u[Symbol.toStringTag]||u.constructor.name||"Object";return H.call(M,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",j),t(u)}}function n(u){if(u===v)return"<>";if(typeof u=="object"&&u!==null&&u.$$typeof===z)return"<...>";try{var M=e(u);return M?"<"+M+">":"<...>"}catch{return"<...>"}}function a(){var u=B.A;return u===null?null:u.getOwner()}function o(){return Error("react-stack-top-frame")}function s(u){if($.call(u,"key")){var M=Object.getOwnPropertyDescriptor(u,"key").get;if(M&&M.isReactWarning)return!1}return u.key!==void 0}function i(u,M){function H(){L||(L=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",M))}H.isReactWarning=!0,Object.defineProperty(u,"key",{get:H,configurable:!0})}function d(){var u=e(this.type);return K[u]||(K[u]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),u=this.props.ref,u!==void 0?u:null}function c(u,M,H,j,Z,G){var R=H.ref;return u={$$typeof:b,type:u,key:M,props:H,_owner:j},(R!==void 0?R:null)!==null?Object.defineProperty(u,"ref",{enumerable:!1,get:d}):Object.defineProperty(u,"ref",{enumerable:!1,value:null}),u._store={},Object.defineProperty(u._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(u,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(u,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:Z}),Object.defineProperty(u,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:G}),Object.freeze&&(Object.freeze(u.props),Object.freeze(u)),u}function p(u,M,H,j,Z,G){var R=M.children;if(R!==void 0)if(j)if(F(R)){for(j=0;j<R.length;j++)f(R[j]);Object.freeze&&Object.freeze(R)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else f(R);if($.call(M,"key")){R=e(u);var V=Object.keys(M).filter(function(J){return J!=="key"});j=0<V.length?"{key: someKey, "+V.join(": ..., ")+": ...}":"{key: someKey}",C[R+j]||(V=0<V.length?"{"+V.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,j,R,V,R),C[R+j]=!0)}if(R=null,H!==void 0&&(r(H),R=""+H),s(M)&&(r(M.key),R=""+M.key),"key"in M){H={};for(var Q in M)Q!=="key"&&(H[Q]=M[Q])}else H=M;return R&&i(H,typeof u=="function"?u.displayName||u.name||"Unknown":u),c(u,R,H,a(),Z,G)}function f(u){g(u)?u._store&&(u._store.validated=1):typeof u=="object"&&u!==null&&u.$$typeof===z&&(u._payload.status==="fulfilled"?g(u._payload.value)&&u._payload.value._store&&(u._payload.value._store.validated=1):u._store&&(u._store.validated=1))}function g(u){return typeof u=="object"&&u!==null&&u.$$typeof===b}var m=l,b=Symbol.for("react.transitional.element"),T=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),O=Symbol.for("react.consumer"),E=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),q=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),z=Symbol.for("react.lazy"),k=Symbol.for("react.activity"),I=Symbol.for("react.client.reference"),B=m.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$=Object.prototype.hasOwnProperty,F=Array.isArray,A=console.createTask?console.createTask:function(){return null};m={react_stack_bottom_frame:function(u){return u()}};var L,K={},ne=m.react_stack_bottom_frame.bind(m,o)(),re=A(n(o)),C={};Ae.Fragment=v,Ae.jsx=function(u,M,H){var j=1e4>B.recentlyCreatedOwnerStacks++;return p(u,M,H,!1,j?Error("react-stack-top-frame"):ne,j?A(n(u)):re)},Ae.jsxs=function(u,M,H){var j=1e4>B.recentlyCreatedOwnerStacks++;return p(u,M,H,!0,j?Error("react-stack-top-frame"):ne,j?A(n(u)):re)}})()),Ae}var Yt;function dr(){return Yt||(Yt=1,process.env.NODE_ENV==="production"?De.exports=cr():De.exports=ur()),De.exports}var h=dr();const rt=100,ot=50,st=200,Vt=5,at=e=>e<st,it=e=>e>ot,fr=96,he=e=>Math.round(e*fr),He={NORMAL:{name:"Normal",label:'Normal (1")',top:1,bottom:1,left:1,right:1},NARROW:{name:"Narrow",label:'Narrow (0.5")',top:.5,bottom:.5,left:.5,right:.5},MODERATE:{name:"Moderate",label:'Moderate (1" / 0.75")',top:1,bottom:1,left:.75,right:.75},WIDE:{name:"Wide",label:'Wide (1" / 2")',top:1,bottom:1,left:2,right:2},OFFICE_2003:{name:"Office 2003",label:'Office 2003 (1" / 1.25")',top:1,bottom:1,left:1.25,right:1.25}},fe="NORMAL",Kt=(e=fe)=>{if(typeof e=="object"&&e!==null&&typeof e.top=="number"&&typeof e.bottom=="number"&&typeof e.left=="number"&&typeof e.right=="number")return{top:he(e.top),bottom:he(e.bottom),left:he(e.left),right:he(e.right)};const t=He[e]||He[fe];return{top:he(t.top),bottom:he(t.bottom),left:he(t.left),right:he(t.right)}},pr=(e=fe)=>{const t=Kt(e);return t.top+t.bottom},gr=()=>Object.keys(He),hr=e=>{if(typeof e=="object"&&e!==null&&typeof e.top=="number"&&typeof e.bottom=="number"&&typeof e.left=="number"&&typeof e.right=="number")return`Custom (${e.top}" / ${e.left}")`;const t=He[e];return t?t.label:"Unknown"},_e={A4:{name:"A4",width:794,height:1123,widthMm:210,heightMm:297,widthIn:8.27,heightIn:11.69},Letter:{name:"Letter",width:816,height:1056,widthMm:216,heightMm:279,widthIn:8.5,heightIn:11},Legal:{name:"Legal",width:816,height:1344,widthMm:216,heightMm:356,widthIn:8.5,heightIn:14}},lt="A4",we=e=>{const t=_e[e]||_e[lt];return{width:t.width,height:t.height}},mr=e=>Object.keys(_e).includes(e),yr=()=>Object.keys(_e),ke=lt,ve="<p><br></p>",br="continuous",Se=(e,t=ke)=>({id:nt.v4(),index:e,size:t,content:ve,images:[],isBreakPoint:!1}),Be=e=>typeof e!="string"||e.trim()===""?ve:e,Xt=(e,t=ke)=>(e.length>0?e:[Se(0,t)]).map((n,a)=>({id:n.id||nt.v4(),index:a,size:n.size||t,content:Be(n.content),images:n.images||[],isBreakPoint:!!n.isBreakPoint})),vr=(e=ke)=>[{id:"page-0",pageNumber:1,top:0,height:we(e).height}],je=e=>e.slice(0,-1).map((t,r)=>({id:`auto-break-${r}`,pageNumber:r+1})),ct=(e={})=>{const t=new Date().toISOString(),r=e.pageSize||ke,n=Xt(e.pages||[Se(0,r)],r);return{id:nt.v4(),title:e.title||"Untitled Document",createdAt:t,updatedAt:t,pageSize:r,pages:n,activePage:e.activePage&&e.activePage<n.length?e.activePage:0,pageBreaks:e.pageBreaks||[],totalPages:n.length,editorMode:e.editorMode||br,continuousContent:e.continuousContent||ve,pageBoundaries:e.pageBoundaries||vr(r),zoomLevel:e.zoomLevel||rt,pageMargins:e.pageMargins||fe,undoStack:[],redoStack:[],canUndo:!1,canRedo:!1}},Y={INITIALIZE_DOCUMENT:"INITIALIZE_DOCUMENT",UPDATE_TITLE:"UPDATE_TITLE",UPDATE_PAGE_CONTENT:"UPDATE_PAGE_CONTENT",UPDATE_PAGES:"UPDATE_PAGES",ADD_PAGE:"ADD_PAGE",DELETE_PAGE:"DELETE_PAGE",SET_ACTIVE_PAGE:"SET_ACTIVE_PAGE",UPDATE_PAGE_SIZE:"UPDATE_PAGE_SIZE",RESET_DOCUMENT:"RESET_DOCUMENT",UPDATE_CONTINUOUS_CONTENT:"UPDATE_CONTINUOUS_CONTENT",UPDATE_PAGE_BOUNDARIES:"UPDATE_PAGE_BOUNDARIES",ADD_PAGE_BREAK:"ADD_PAGE_BREAK",REMOVE_PAGE_BREAK:"REMOVE_PAGE_BREAK",SET_EDITOR_MODE:"SET_EDITOR_MODE",SET_ZOOM_LEVEL:"SET_ZOOM_LEVEL",ZOOM_IN:"ZOOM_IN",ZOOM_OUT:"ZOOM_OUT",RESET_ZOOM:"RESET_ZOOM",UPDATE_PAGE_MARGINS:"UPDATE_PAGE_MARGINS",RECORD_OPERATION:"RECORD_OPERATION",UNDO:"UNDO",REDO:"REDO",CLEAR_UNDO_REDO:"CLEAR_UNDO_REDO"},ut=(e,t)=>{const r=new Date().toISOString();switch(t.type){case Y.INITIALIZE_DOCUMENT:{const{initialContent:n=ve,pageSize:a=ke}=t.payload||{},o={...Se(0,a),content:Be(n)};return ct({title:e.title,pageSize:a,pages:[o]})}case Y.UPDATE_TITLE:return{...e,title:t.payload,updatedAt:r};case Y.UPDATE_PAGE_CONTENT:{const{pageIndex:n,content:a}=t.payload;if(n<0||n>=e.pages.length)return e;const o=[...e.pages];return o[n]={...o[n],content:Be(a)},{...e,pages:o,updatedAt:r}}case Y.UPDATE_PAGES:{const n=Array.isArray(t.payload)?{pages:t.payload}:t.payload||{},a=Xt(n.pages||[],e.pageSize),o=Array.isArray(n.pageBreaks)?n.pageBreaks:je(a);return{...e,pages:a,activePage:Math.min(e.activePage,a.length-1),pageBreaks:o,totalPages:a.length,updatedAt:r}}case Y.ADD_PAGE:{const n=typeof t.payload?.index=="number"?Math.min(Math.max(t.payload.index,0),e.pages.length):e.pages.length,a=[...e.pages];a.splice(n,0,Se(n,e.pageSize));const o=a.map((i,d)=>({...i,index:d,size:e.pageSize})),s=je(o);return{...e,pages:o,activePage:n,pageBreaks:s,totalPages:o.length,updatedAt:r}}case Y.DELETE_PAGE:{const n=t.payload;if(e.pages.length<=1)return e;const a=[...e.pages];a.splice(n,1);const o=a.map((d,c)=>({...d,index:c,size:e.pageSize}));let s=e.activePage;s>=o.length?s=o.length-1:n<=s&&s>0&&(s-=1);const i=je(o);return{...e,pages:o,activePage:s,pageBreaks:i,totalPages:o.length,updatedAt:r}}case Y.SET_ACTIVE_PAGE:{const n=t.payload;if(n===e.activePage)return e;const a=e.editorMode==="continuous"?e.pageBoundaries.length:e.pages.length;return n<0||n>=a?e:{...e,activePage:n,updatedAt:r}}case Y.UPDATE_PAGE_SIZE:{const n=t.payload;if(n===e.pageSize)return e;try{we(n)}catch{return console.warn(`Invalid page size: ${n}`),e}const a=e.pages.map((s,i)=>({...s,index:i,size:n})),o=je(a);return{...e,pageSize:n,pages:a,pageBreaks:o,updatedAt:r}}case Y.RESET_DOCUMENT:return ct();case Y.UPDATE_CONTINUOUS_CONTENT:{const n=Be(t.payload);return n===e.continuousContent?e:{...e,continuousContent:n,updatedAt:r}}case Y.UPDATE_PAGE_BOUNDARIES:{const n=Array.isArray(t.payload)?t.payload:[];if(n.length===e.pageBoundaries.length&&n.length>0&&n[0].id===e.pageBoundaries[0]?.id&&n[n.length-1].id===e.pageBoundaries[n.length-1]?.id)return e;const a=e.activePage>=n.length?Math.max(0,n.length-1):e.activePage;return{...e,pageBoundaries:n,totalPages:n.length,activePage:a,updatedAt:r}}case Y.ADD_PAGE_BREAK:{const{position:n="end",pageIndex:a}=t.payload||{},o='<page-break data-page-break="true" style="display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;"></page-break>';let s=e.continuousContent;if(n==="end")s=s+o+"<p><br></p>";else if(typeof n=="number"){const i=s.substring(0,n),d=s.substring(n);s=i+o+d}else if(typeof a=="number"&&typeof document<"u"){const i=document.createElement("div");i.innerHTML=s;const d=i.querySelectorAll('page-break, [data-page-break="true"]');if(a===0&&d.length===0)s=s+o+"<p><br></p>";else if(a<d.length){const c=d[a],p=document.createElement("page-break");p.setAttribute("data-page-break","true"),p.setAttribute("style","display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;");const f=document.createElement("p");f.innerHTML="<br>",c.parentNode.insertBefore(p,c.nextSibling),p.parentNode.insertBefore(f,p.nextSibling),s=i.innerHTML}else s=s+o+"<p><br></p>"}return{...e,continuousContent:s,updatedAt:r}}case Y.REMOVE_PAGE_BREAK:{const{pageIndex:n}=t.payload||{};if(typeof n!="number"||typeof document>"u")return e;const a=document.createElement("div");a.innerHTML=e.continuousContent;const o=a.querySelectorAll('page-break, [data-page-break="true"]');return o[n]&&o[n].remove(),a.querySelectorAll('page-break, [data-page-break="true"]').forEach((i,d)=>{i.setAttribute("data-page-number",String(d+2))}),{...e,continuousContent:a.innerHTML,updatedAt:r}}case Y.SET_EDITOR_MODE:{const n=t.payload;if(n===e.editorMode)return e;let a=e.continuousContent,o=e.pages;return n==="continuous"?a=e.pages.map(i=>i.content).filter(i=>i&&i!==ve).join(`
`)||ve:e.continuousContent&&e.continuousContent!==ve&&(o=[{...Se(0,e.pageSize),content:e.continuousContent}]),{...e,editorMode:n,continuousContent:a,pages:o,updatedAt:r}}case Y.SET_ZOOM_LEVEL:{const n=t.payload;return n<ot||n>st?(console.warn(`Invalid zoom level: ${n}. Must be between ${ot} and ${st}.`),e):n===e.zoomLevel?e:{...e,zoomLevel:n,updatedAt:r}}case Y.ZOOM_IN:{if(!at(e.zoomLevel))return e;const n=e.zoomLevel+Vt;return{...e,zoomLevel:n,updatedAt:r}}case Y.ZOOM_OUT:{if(!it(e.zoomLevel))return e;const n=e.zoomLevel-Vt;return{...e,zoomLevel:n,updatedAt:r}}case Y.RESET_ZOOM:return e.zoomLevel===rt?e:{...e,zoomLevel:rt,updatedAt:r};case Y.UPDATE_PAGE_MARGINS:{const n=t.payload;return n===e.pageMargins?e:{...e,pageMargins:n,updatedAt:r}}case Y.RECORD_OPERATION:{const{operation:n,inverseOperation:a}=t.payload;return{...e,undoStack:[...e.undoStack,{operation:n,inverseOperation:a}],redoStack:[],canUndo:!0,canRedo:!1,updatedAt:r}}case Y.UNDO:{if(e.undoStack.length===0)return e;const n=e.undoStack[e.undoStack.length-1],a=e.undoStack.slice(0,-1);let o=e;return n.inverseOperation&&(o=ut(e,n.inverseOperation)),{...o,undoStack:a,redoStack:[...e.redoStack,n],canUndo:a.length>0,canRedo:!0,updatedAt:r}}case Y.REDO:{if(e.redoStack.length===0)return e;const n=e.redoStack[e.redoStack.length-1],a=e.redoStack.slice(0,-1);let o=e;return n.operation&&(o=ut(e,n.operation)),{...o,undoStack:[...e.undoStack,n],redoStack:a,canUndo:!0,canRedo:a.length>0,updatedAt:r}}case Y.CLEAR_UNDO_REDO:return{...e,undoStack:[],redoStack:[],canUndo:!1,canRedo:!1,updatedAt:r};default:return e}},Jt=l.createContext(null),Tr=({children:e,initialState:t={}})=>{const[r,n]=l.useReducer(ut,ct(t)),a=l.useMemo(()=>({initializeDocument:s=>n({type:Y.INITIALIZE_DOCUMENT,payload:s}),updateTitle:s=>n({type:Y.UPDATE_TITLE,payload:s}),updatePageContent:s=>n({type:Y.UPDATE_PAGE_CONTENT,payload:s}),updatePages:s=>n({type:Y.UPDATE_PAGES,payload:s}),addPage:s=>n({type:Y.ADD_PAGE,payload:s}),deletePage:s=>n({type:Y.DELETE_PAGE,payload:s}),setActivePage:s=>n({type:Y.SET_ACTIVE_PAGE,payload:s}),updatePageSize:s=>n({type:Y.UPDATE_PAGE_SIZE,payload:s}),resetDocument:()=>n({type:Y.RESET_DOCUMENT}),updateContinuousContent:s=>n({type:Y.UPDATE_CONTINUOUS_CONTENT,payload:s}),updatePageBoundaries:s=>n({type:Y.UPDATE_PAGE_BOUNDARIES,payload:s}),addPageBreak:s=>n({type:Y.ADD_PAGE_BREAK,payload:s}),removePageBreak:s=>n({type:Y.REMOVE_PAGE_BREAK,payload:s}),setEditorMode:s=>n({type:Y.SET_EDITOR_MODE,payload:s}),setZoomLevel:s=>n({type:Y.SET_ZOOM_LEVEL,payload:s}),zoomIn:()=>n({type:Y.ZOOM_IN}),zoomOut:()=>n({type:Y.ZOOM_OUT}),resetZoom:()=>n({type:Y.RESET_ZOOM}),updatePageMargins:s=>n({type:Y.UPDATE_PAGE_MARGINS,payload:s}),recordOperation:(s,i)=>n({type:Y.RECORD_OPERATION,payload:{operation:s,inverseOperation:i}}),undo:()=>n({type:Y.UNDO}),redo:()=>n({type:Y.REDO}),clearUndoRedo:()=>n({type:Y.CLEAR_UNDO_REDO})}),[]),o=l.useMemo(()=>({state:r,actions:a,dispatch:n}),[r,a]);return h.jsx(Jt.Provider,{value:o,children:e})},dt=()=>{const e=l.useContext(Jt);if(!e)throw new Error("useDocument must be used within a DocumentProvider");return e},ft=()=>{const{state:e}=dt();return e},pe=()=>{const{actions:e}=dt();return e};var $e={exports:{}},ze={exports:{}},ee={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qt;function Er(){if(Qt)return ee;Qt=1;var e=typeof Symbol=="function"&&Symbol.for,t=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,n=e?Symbol.for("react.fragment"):60107,a=e?Symbol.for("react.strict_mode"):60108,o=e?Symbol.for("react.profiler"):60114,s=e?Symbol.for("react.provider"):60109,i=e?Symbol.for("react.context"):60110,d=e?Symbol.for("react.async_mode"):60111,c=e?Symbol.for("react.concurrent_mode"):60111,p=e?Symbol.for("react.forward_ref"):60112,f=e?Symbol.for("react.suspense"):60113,g=e?Symbol.for("react.suspense_list"):60120,m=e?Symbol.for("react.memo"):60115,b=e?Symbol.for("react.lazy"):60116,T=e?Symbol.for("react.block"):60121,v=e?Symbol.for("react.fundamental"):60117,_=e?Symbol.for("react.responder"):60118,N=e?Symbol.for("react.scope"):60119;function O(y){if(typeof y=="object"&&y!==null){var x=y.$$typeof;switch(x){case t:switch(y=y.type,y){case d:case c:case n:case o:case a:case f:return y;default:switch(y=y&&y.$$typeof,y){case i:case p:case b:case m:case s:return y;default:return x}}case r:return x}}}function E(y){return O(y)===c}return ee.AsyncMode=d,ee.ConcurrentMode=c,ee.ContextConsumer=i,ee.ContextProvider=s,ee.Element=t,ee.ForwardRef=p,ee.Fragment=n,ee.Lazy=b,ee.Memo=m,ee.Portal=r,ee.Profiler=o,ee.StrictMode=a,ee.Suspense=f,ee.isAsyncMode=function(y){return E(y)||O(y)===d},ee.isConcurrentMode=E,ee.isContextConsumer=function(y){return O(y)===i},ee.isContextProvider=function(y){return O(y)===s},ee.isElement=function(y){return typeof y=="object"&&y!==null&&y.$$typeof===t},ee.isForwardRef=function(y){return O(y)===p},ee.isFragment=function(y){return O(y)===n},ee.isLazy=function(y){return O(y)===b},ee.isMemo=function(y){return O(y)===m},ee.isPortal=function(y){return O(y)===r},ee.isProfiler=function(y){return O(y)===o},ee.isStrictMode=function(y){return O(y)===a},ee.isSuspense=function(y){return O(y)===f},ee.isValidElementType=function(y){return typeof y=="string"||typeof y=="function"||y===n||y===c||y===o||y===a||y===f||y===g||typeof y=="object"&&y!==null&&(y.$$typeof===b||y.$$typeof===m||y.$$typeof===s||y.$$typeof===i||y.$$typeof===p||y.$$typeof===v||y.$$typeof===_||y.$$typeof===N||y.$$typeof===T)},ee.typeOf=O,ee}var te={};/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var en;function wr(){return en||(en=1,process.env.NODE_ENV!=="production"&&(function(){var e=typeof Symbol=="function"&&Symbol.for,t=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,n=e?Symbol.for("react.fragment"):60107,a=e?Symbol.for("react.strict_mode"):60108,o=e?Symbol.for("react.profiler"):60114,s=e?Symbol.for("react.provider"):60109,i=e?Symbol.for("react.context"):60110,d=e?Symbol.for("react.async_mode"):60111,c=e?Symbol.for("react.concurrent_mode"):60111,p=e?Symbol.for("react.forward_ref"):60112,f=e?Symbol.for("react.suspense"):60113,g=e?Symbol.for("react.suspense_list"):60120,m=e?Symbol.for("react.memo"):60115,b=e?Symbol.for("react.lazy"):60116,T=e?Symbol.for("react.block"):60121,v=e?Symbol.for("react.fundamental"):60117,_=e?Symbol.for("react.responder"):60118,N=e?Symbol.for("react.scope"):60119;function O(D){return typeof D=="string"||typeof D=="function"||D===n||D===c||D===o||D===a||D===f||D===g||typeof D=="object"&&D!==null&&(D.$$typeof===b||D.$$typeof===m||D.$$typeof===s||D.$$typeof===i||D.$$typeof===p||D.$$typeof===v||D.$$typeof===_||D.$$typeof===N||D.$$typeof===T)}function E(D){if(typeof D=="object"&&D!==null){var ue=D.$$typeof;switch(ue){case t:var xe=D.type;switch(xe){case d:case c:case n:case o:case a:case f:return xe;default:var de=xe&&xe.$$typeof;switch(de){case i:case p:case b:case m:case s:return de;default:return ue}}case r:return ue}}}var y=d,x=c,q=i,P=s,z=t,k=p,I=n,B=b,$=m,F=r,A=o,L=a,K=f,ne=!1;function re(D){return ne||(ne=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),C(D)||E(D)===d}function C(D){return E(D)===c}function u(D){return E(D)===i}function M(D){return E(D)===s}function H(D){return typeof D=="object"&&D!==null&&D.$$typeof===t}function j(D){return E(D)===p}function Z(D){return E(D)===n}function G(D){return E(D)===b}function R(D){return E(D)===m}function V(D){return E(D)===r}function Q(D){return E(D)===o}function J(D){return E(D)===a}function ae(D){return E(D)===f}te.AsyncMode=y,te.ConcurrentMode=x,te.ContextConsumer=q,te.ContextProvider=P,te.Element=z,te.ForwardRef=k,te.Fragment=I,te.Lazy=B,te.Memo=$,te.Portal=F,te.Profiler=A,te.StrictMode=L,te.Suspense=K,te.isAsyncMode=re,te.isConcurrentMode=C,te.isContextConsumer=u,te.isContextProvider=M,te.isElement=H,te.isForwardRef=j,te.isFragment=Z,te.isLazy=G,te.isMemo=R,te.isPortal=V,te.isProfiler=Q,te.isStrictMode=J,te.isSuspense=ae,te.isValidElementType=O,te.typeOf=E})()),te}var tn;function nn(){return tn||(tn=1,process.env.NODE_ENV==="production"?ze.exports=Er():ze.exports=wr()),ze.exports}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var pt,rn;function xr(){if(rn)return pt;rn=1;var e=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function n(o){if(o==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(o)}function a(){try{if(!Object.assign)return!1;var o=new String("abc");if(o[5]="de",Object.getOwnPropertyNames(o)[0]==="5")return!1;for(var s={},i=0;i<10;i++)s["_"+String.fromCharCode(i)]=i;var d=Object.getOwnPropertyNames(s).map(function(p){return s[p]});if(d.join("")!=="0123456789")return!1;var c={};return"abcdefghijklmnopqrst".split("").forEach(function(p){c[p]=p}),Object.keys(Object.assign({},c)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return pt=a()?Object.assign:function(o,s){for(var i,d=n(o),c,p=1;p<arguments.length;p++){i=Object(arguments[p]);for(var f in i)t.call(i,f)&&(d[f]=i[f]);if(e){c=e(i);for(var g=0;g<c.length;g++)r.call(i,c[g])&&(d[c[g]]=i[c[g]])}}return d},pt}var gt,on;function ht(){if(on)return gt;on=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return gt=e,gt}var mt,sn;function an(){return sn||(sn=1,mt=Function.call.bind(Object.prototype.hasOwnProperty)),mt}var yt,ln;function Cr(){if(ln)return yt;ln=1;var e=function(){};if(process.env.NODE_ENV!=="production"){var t=ht(),r={},n=an();e=function(o){var s="Warning: "+o;typeof console<"u"&&console.error(s);try{throw new Error(s)}catch{}}}function a(o,s,i,d,c){if(process.env.NODE_ENV!=="production"){for(var p in o)if(n(o,p)){var f;try{if(typeof o[p]!="function"){var g=Error((d||"React class")+": "+i+" type `"+p+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof o[p]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw g.name="Invariant Violation",g}f=o[p](s,p,d,i,null,t)}catch(b){f=b}if(f&&!(f instanceof Error)&&e((d||"React class")+": type specification of "+i+" `"+p+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof f+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),f instanceof Error&&!(f.message in r)){r[f.message]=!0;var m=c?c():"";e("Failed "+i+" type: "+f.message+(m??""))}}}}return a.resetWarningCache=function(){process.env.NODE_ENV!=="production"&&(r={})},yt=a,yt}var bt,cn;function Ar(){if(cn)return bt;cn=1;var e=nn(),t=xr(),r=ht(),n=an(),a=Cr(),o=function(){};process.env.NODE_ENV!=="production"&&(o=function(i){var d="Warning: "+i;typeof console<"u"&&console.error(d);try{throw new Error(d)}catch{}});function s(){return null}return bt=function(i,d){var c=typeof Symbol=="function"&&Symbol.iterator,p="@@iterator";function f(C){var u=C&&(c&&C[c]||C[p]);if(typeof u=="function")return u}var g="<<anonymous>>",m={array:_("array"),bigint:_("bigint"),bool:_("boolean"),func:_("function"),number:_("number"),object:_("object"),string:_("string"),symbol:_("symbol"),any:N(),arrayOf:O,element:E(),elementType:y(),instanceOf:x,node:k(),objectOf:P,oneOf:q,oneOfType:z,shape:B,exact:$};function b(C,u){return C===u?C!==0||1/C===1/u:C!==C&&u!==u}function T(C,u){this.message=C,this.data=u&&typeof u=="object"?u:{},this.stack=""}T.prototype=Error.prototype;function v(C){if(process.env.NODE_ENV!=="production")var u={},M=0;function H(Z,G,R,V,Q,J,ae){if(V=V||g,J=J||R,ae!==r){if(d){var D=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw D.name="Invariant Violation",D}else if(process.env.NODE_ENV!=="production"&&typeof console<"u"){var ue=V+":"+R;!u[ue]&&M<3&&(o("You are manually calling a React.PropTypes validation function for the `"+J+"` prop on `"+V+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),u[ue]=!0,M++)}}return G[R]==null?Z?G[R]===null?new T("The "+Q+" `"+J+"` is marked as required "+("in `"+V+"`, but its value is `null`.")):new T("The "+Q+" `"+J+"` is marked as required in "+("`"+V+"`, but its value is `undefined`.")):null:C(G,R,V,Q,J)}var j=H.bind(null,!1);return j.isRequired=H.bind(null,!0),j}function _(C){function u(M,H,j,Z,G,R){var V=M[H],Q=L(V);if(Q!==C){var J=K(V);return new T("Invalid "+Z+" `"+G+"` of type "+("`"+J+"` supplied to `"+j+"`, expected ")+("`"+C+"`."),{expectedType:C})}return null}return v(u)}function N(){return v(s)}function O(C){function u(M,H,j,Z,G){if(typeof C!="function")return new T("Property `"+G+"` of component `"+j+"` has invalid PropType notation inside arrayOf.");var R=M[H];if(!Array.isArray(R)){var V=L(R);return new T("Invalid "+Z+" `"+G+"` of type "+("`"+V+"` supplied to `"+j+"`, expected an array."))}for(var Q=0;Q<R.length;Q++){var J=C(R,Q,j,Z,G+"["+Q+"]",r);if(J instanceof Error)return J}return null}return v(u)}function E(){function C(u,M,H,j,Z){var G=u[M];if(!i(G)){var R=L(G);return new T("Invalid "+j+" `"+Z+"` of type "+("`"+R+"` supplied to `"+H+"`, expected a single ReactElement."))}return null}return v(C)}function y(){function C(u,M,H,j,Z){var G=u[M];if(!e.isValidElementType(G)){var R=L(G);return new T("Invalid "+j+" `"+Z+"` of type "+("`"+R+"` supplied to `"+H+"`, expected a single ReactElement type."))}return null}return v(C)}function x(C){function u(M,H,j,Z,G){if(!(M[H]instanceof C)){var R=C.name||g,V=re(M[H]);return new T("Invalid "+Z+" `"+G+"` of type "+("`"+V+"` supplied to `"+j+"`, expected ")+("instance of `"+R+"`."))}return null}return v(u)}function q(C){if(!Array.isArray(C))return process.env.NODE_ENV!=="production"&&(arguments.length>1?o("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):o("Invalid argument supplied to oneOf, expected an array.")),s;function u(M,H,j,Z,G){for(var R=M[H],V=0;V<C.length;V++)if(b(R,C[V]))return null;var Q=JSON.stringify(C,function(ae,D){var ue=K(D);return ue==="symbol"?String(D):D});return new T("Invalid "+Z+" `"+G+"` of value `"+String(R)+"` "+("supplied to `"+j+"`, expected one of "+Q+"."))}return v(u)}function P(C){function u(M,H,j,Z,G){if(typeof C!="function")return new T("Property `"+G+"` of component `"+j+"` has invalid PropType notation inside objectOf.");var R=M[H],V=L(R);if(V!=="object")return new T("Invalid "+Z+" `"+G+"` of type "+("`"+V+"` supplied to `"+j+"`, expected an object."));for(var Q in R)if(n(R,Q)){var J=C(R,Q,j,Z,G+"."+Q,r);if(J instanceof Error)return J}return null}return v(u)}function z(C){if(!Array.isArray(C))return process.env.NODE_ENV!=="production"&&o("Invalid argument supplied to oneOfType, expected an instance of array."),s;for(var u=0;u<C.length;u++){var M=C[u];if(typeof M!="function")return o("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+ne(M)+" at index "+u+"."),s}function H(j,Z,G,R,V){for(var Q=[],J=0;J<C.length;J++){var ae=C[J],D=ae(j,Z,G,R,V,r);if(D==null)return null;D.data&&n(D.data,"expectedType")&&Q.push(D.data.expectedType)}var ue=Q.length>0?", expected one of type ["+Q.join(", ")+"]":"";return new T("Invalid "+R+" `"+V+"` supplied to "+("`"+G+"`"+ue+"."))}return v(H)}function k(){function C(u,M,H,j,Z){return F(u[M])?null:new T("Invalid "+j+" `"+Z+"` supplied to "+("`"+H+"`, expected a ReactNode."))}return v(C)}function I(C,u,M,H,j){return new T((C||"React class")+": "+u+" type `"+M+"."+H+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+j+"`.")}function B(C){function u(M,H,j,Z,G){var R=M[H],V=L(R);if(V!=="object")return new T("Invalid "+Z+" `"+G+"` of type `"+V+"` "+("supplied to `"+j+"`, expected `object`."));for(var Q in C){var J=C[Q];if(typeof J!="function")return I(j,Z,G,Q,K(J));var ae=J(R,Q,j,Z,G+"."+Q,r);if(ae)return ae}return null}return v(u)}function $(C){function u(M,H,j,Z,G){var R=M[H],V=L(R);if(V!=="object")return new T("Invalid "+Z+" `"+G+"` of type `"+V+"` "+("supplied to `"+j+"`, expected `object`."));var Q=t({},M[H],C);for(var J in Q){var ae=C[J];if(n(C,J)&&typeof ae!="function")return I(j,Z,G,J,K(ae));if(!ae)return new T("Invalid "+Z+" `"+G+"` key `"+J+"` supplied to `"+j+"`.\nBad object: "+JSON.stringify(M[H],null,"  ")+`
Valid keys: `+JSON.stringify(Object.keys(C),null,"  "));var D=ae(R,J,j,Z,G+"."+J,r);if(D)return D}return null}return v(u)}function F(C){switch(typeof C){case"number":case"string":case"undefined":return!0;case"boolean":return!C;case"object":if(Array.isArray(C))return C.every(F);if(C===null||i(C))return!0;var u=f(C);if(u){var M=u.call(C),H;if(u!==C.entries){for(;!(H=M.next()).done;)if(!F(H.value))return!1}else for(;!(H=M.next()).done;){var j=H.value;if(j&&!F(j[1]))return!1}}else return!1;return!0;default:return!1}}function A(C,u){return C==="symbol"?!0:u?u["@@toStringTag"]==="Symbol"||typeof Symbol=="function"&&u instanceof Symbol:!1}function L(C){var u=typeof C;return Array.isArray(C)?"array":C instanceof RegExp?"object":A(u,C)?"symbol":u}function K(C){if(typeof C>"u"||C===null)return""+C;var u=L(C);if(u==="object"){if(C instanceof Date)return"date";if(C instanceof RegExp)return"regexp"}return u}function ne(C){var u=K(C);switch(u){case"array":case"object":return"an "+u;case"boolean":case"date":case"regexp":return"a "+u;default:return u}}function re(C){return!C.constructor||!C.constructor.name?g:C.constructor.name}return m.checkPropTypes=a,m.resetWarningCache=a.resetWarningCache,m.PropTypes=m,m},bt}var vt,un;function _r(){if(un)return vt;un=1;var e=ht();function t(){}function r(){}return r.resetWarningCache=t,vt=function(){function n(s,i,d,c,p,f){if(f!==e){var g=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw g.name="Invariant Violation",g}}n.isRequired=n;function a(){return n}var o={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:a,element:n,elementType:n,instanceOf:a,node:n,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:r,resetWarningCache:t};return o.PropTypes=o,o},vt}var dn;function kr(){if(dn)return $e.exports;if(dn=1,process.env.NODE_ENV!=="production"){var e=nn(),t=!0;$e.exports=Ar()(e.isElement,t)}else $e.exports=_r()();return $e.exports}var Sr=kr();const w=lr(Sr),Tt={"7.5pt":{pt:7.5,px:10,label:"7.5"},"9pt":{pt:9,px:12,label:"9"},"10pt":{pt:10,px:13,label:"10"},"11pt":{pt:11,px:15,label:"11"},"12pt":{pt:12,px:16,label:"12"},"14pt":{pt:14,px:19,label:"14"},"16pt":{pt:16,px:21,label:"16"},"18pt":{pt:18,px:24,label:"18"},"20pt":{pt:20,px:27,label:"20"},"22pt":{pt:22,px:29,label:"22"},"24pt":{pt:24,px:32,label:"24"},"26pt":{pt:26,px:35,label:"26"},"28pt":{pt:28,px:37,label:"28"},"36pt":{pt:36,px:48,label:"36"},"48pt":{pt:48,px:64,label:"48"},"72pt":{pt:72,px:96,label:"72"}},fn=[{value:"10px",label:"7.5",pt:7.5},{value:"12px",label:"9",pt:9},{value:"13px",label:"10",pt:10},{value:"15px",label:"11",pt:11},{value:"16px",label:"12",pt:12},{value:"19px",label:"14",pt:14},{value:"21px",label:"16",pt:16},{value:"24px",label:"18",pt:18},{value:"27px",label:"20",pt:20},{value:"32px",label:"24",pt:24},{value:"37px",label:"28",pt:28},{value:"48px",label:"36",pt:36},{value:"64px",label:"48",pt:48},{value:"96px",label:"72",pt:72}],Ne="16px",pn=e=>Math.round(e*96/72),gn=e=>Math.round(e*72/96*2)/2,Nr=e=>{const t=Object.values(Tt).find(r=>r.pt===e);return t?`${t.px}px`:`${pn(e)}px`},Or=e=>{const t=parseInt(e),r=Object.values(Tt).find(n=>n.px===t);return r?r.pt:gn(t)},Pr=e=>{if(!e)return!1;if(e.endsWith("px")){const t=parseInt(e);return t>=8&&t<=144}if(e.endsWith("pt")){const t=parseFloat(e);return t>=6&&t<=108}return!1},Mr={"10px":"1","12px":"2","13px":"2","15px":"3","16px":"3","19px":"4","21px":"4","24px":"5","27px":"5","32px":"6","37px":"6","48px":"6","64px":"7","96px":"7"},hn={bold:!1,italic:!1,underline:!1,strikethrough:!1,alignLeft:!1,alignCenter:!1,alignRight:!1,alignJustify:!1,fontFamily:"Arial",fontSize:Ne,fontColor:"#000000",headingLevel:"p"},mn=()=>{const[e,t]=l.useState(hn),r=pe(),n=l.useCallback((m,b,T=null)=>{try{const v=window.getSelection();if(!v||v.rangeCount===0)return!1;const _=v.getRangeAt(0);if(!_.toString())return t(O=>({...O,[m]:b})),!1;try{const O=document.createElement("span");O.style[m]=b;const E=_.extractContents();return O.appendChild(E),_.insertNode(O),_.selectNodeContents(O),v.removeAllRanges(),v.addRange(_),t(y=>({...y,[m]:b})),!0}catch{if(T){const O=m==="fontSize"?Mr[b]||"3":b;return document.execCommand(T,!1,O),t(E=>({...E,[m]:b})),!0}return!1}}catch(v){return console.warn(`[useFormatting] Style application failed for ${m}:`,v),!1}},[]),a=l.useCallback(m=>n("fontFamily",m,"fontName"),[n]),o=l.useCallback(m=>n("fontSize",m,"fontSize"),[n]),s=l.useCallback(m=>n("color",m,"foreColor"),[n]),i=l.useCallback(m=>{t(b=>({...b,alignLeft:m==="left",alignCenter:m==="center",alignRight:m==="right",alignJustify:m==="justify"}))},[]),d=l.useCallback(m=>{try{const b=window.getSelection();if(!b||b.rangeCount===0)return!1;const T=b.getRangeAt(0),v=T.toString(),N={justifyLeft:"left",justifyCenter:"center",justifyRight:"right",justifyFull:"justify"}[m];if(!N)return!1;if(!v){const E=T.startContainer,y=E.nodeType===Node.TEXT_NODE?E.parentElement:E,x=Oe(y)||Ir();return x&&(x.style.textAlign=N,i(N)),!0}const O=Rr(T);if(O.length===0){const E=document.createElement("p");E.style.textAlign=N;const y=T.extractContents();E.appendChild(y),T.insertNode(E),T.selectNodeContents(E),b.removeAllRanges(),b.addRange(T)}else O.forEach(E=>{E.style.textAlign=N});return i(N),!0}catch(b){return console.warn("[useFormatting] Text alignment failed:",b),!1}},[i]),c=l.useCallback(m=>{try{const b=window.getSelection();if(!b||b.rangeCount===0)return!1;const T=b.getRangeAt(0),v=document.createElement("div");if(v.innerHTML=m,Array.from(v.children).some(N=>["TABLE","UL","OL","BLOCKQUOTE","PRE","DIV","H1","H2","H3","H4","H5","H6"].includes(N.tagName))){const N=T.startContainer,O=N.nodeType===Node.TEXT_NODE?N.parentElement:N,E=Oe(O);if(E&&["P","H1","H2","H3","H4","H5","H6"].includes(E.tagName)){const y=E.tagName.toLowerCase();if(T.startOffset===0&&(N===E||N.nodeType===Node.TEXT_NODE&&N===E.firstChild))E.parentNode.insertBefore(v,E);else if(T.startOffset===N.textContent?.length&&N===E.lastChild&&T.endOffset===N.textContent?.length){const P=E.nextSibling;P?E.parentNode.insertBefore(v,P):E.parentNode.appendChild(v)}else{const P=T.extractContents(),z=document.createTextNode(""),k=document.createElement(y);k.appendChild(z),k.appendChild(P);const I=E.parentNode;I.insertBefore(v,E.nextSibling),I.insertBefore(k,v.nextSibling),!E.textContent.trim()&&E.children.length===0&&I.removeChild(E)}}else T.insertNode(v);T.setStartAfter(v),T.setEndAfter(v),b.removeAllRanges(),b.addRange(T)}else document.execCommand("insertHTML",!1,m);return!0}catch(b){console.warn("[useFormatting] InsertHTML failed:",b);try{return document.execCommand("insertHTML",!1,m),!0}catch(T){return console.warn("[useFormatting] InsertHTML fallback also failed:",T),!1}}},[]),p=l.useCallback((m,b=null)=>{try{if(m==="undo"){r.undo();return}if(m==="redo"){r.redo();return}if(typeof document.execCommand!="function"){console.warn("[useFormatting] execCommand not supported");return}if(m==="insertHTML"&&b){c(b);return}if(m==="fontSize"){o(b);return}if(m==="fontName"){a(b);return}if(m==="foreColor"){s(b);return}if(["justifyLeft","justifyCenter","justifyRight","justifyFull"].includes(m)){d(m);return}switch(document.execCommand(m,!1,b)||console.warn(`[useFormatting] Command "${m}" failed`),m){case"bold":case"italic":case"underline":case"strikethrough":case"justifyLeft":case"justifyCenter":case"justifyRight":case"justifyFull":case"fontName":case"foreColor":break;case"formatBlock":t(v=>({...v,headingLevel:b}));break;default:break}}catch(T){console.warn(`[useFormatting] Error executing command "${m}":`,T)}},[o,a,d,c,r]),f=l.useCallback(()=>{try{const m=window.getSelection();if(!m||m.rangeCount===0)return;const b=m.getRangeAt(0),T=b.toString();let v=Ne,_="Arial",N="#000000",O="p",E="left";if(T){const x=b.startContainer,q=x.nodeType===Node.TEXT_NODE?x.parentElement:x;if(q){const P=window.getComputedStyle(q),z=P.fontSize,k=P.fontFamily;z&&z.endsWith("px")&&(v=z),k&&k!=="serif"&&(_=k.split(",")[0].replace(/['"]/g,"").trim());const I=P.color;I&&I!=="rgb(0, 0, 0)"&&I!=="#000000"&&(I.startsWith("rgb")?N=Lr(I):N=I);const B=Oe(q);if(B){const $=B.tagName?.toLowerCase();["h1","h2","h3","h4","h5","h6","p"].includes($)&&(O=$);const A=window.getComputedStyle(B).textAlign;["left","center","right","justify"].includes(A)&&(E=A)}}}const y={bold:document.queryCommandState("bold"),italic:document.queryCommandState("italic"),underline:document.queryCommandState("underline"),strikethrough:document.queryCommandState("strikethrough"),alignLeft:E==="left",alignCenter:E==="center",alignRight:E==="right",alignJustify:E==="justify",fontFamily:_,fontSize:v,fontColor:N,headingLevel:O};t(x=>({...x,...y}))}catch(m){console.warn("[useFormatting] Error updating format from selection:",m)}},[]),g=l.useCallback(()=>{t(hn)},[]);return{currentFormat:e,formatText:p,resetFormat:g,updateCurrentFormatFromSelection:f}};function Lr(e){const t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);if(!t)return"#000000";const r=parseInt(t[1],10),n=parseInt(t[2],10),a=parseInt(t[3],10);return`#${((1<<24)+(r<<16)+(n<<8)+a).toString(16).slice(1)}`}function Oe(e){let t=e;for(;t&&t!==document.body;){const r=t.tagName?.toLowerCase();if(["h1","h2","h3","h4","h5","h6","p"].includes(r))return t;if(t.contentEditable==="true"||t.contentEditable==="")break;t=t.parentElement}return null}function Rr(e){const t=[],r=e.startContainer,n=e.endContainer,a=Oe(r.nodeType===Node.TEXT_NODE?r.parentElement:r),o=Oe(n.nodeType===Node.TEXT_NODE?n.parentElement:n);if(a===o&&a)return[a];const s=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_ELEMENT,{acceptNode:d=>{const c=d.tagName?.toLowerCase();return["h1","h2","h3","h4","h5","h6","p"].includes(c)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});let i=s.nextNode();for(;i;)e.intersectsNode(i)&&t.push(i),i=s.nextNode();return t}function Ir(){try{const e=window.getSelection();if(!e||e.rangeCount===0)return null;const t=e.getRangeAt(0),r=document.createElement("p");return r.innerHTML="<br>",t.insertNode(r),t.selectNodeContents(r),t.collapse(!0),e.removeAllRanges(),e.addRange(t),r}catch(e){return console.warn("[useFormatting] Failed to create paragraph at cursor:",e),null}}const me='page-break, [data-page-break="true"]',Dr=(e,t={})=>{if(!e||typeof document>"u")return[];const r=t.pageSize||"A4",n=we(r),a=e.querySelectorAll(me),o=[];o.push({id:"page-0",pageNumber:1,top:0,height:n.height});const s=e.getBoundingClientRect(),i=e.scrollTop;return a.forEach((d,c)=>{const f=d.getBoundingClientRect().top-s.top+i;o.push({id:`page-${c+1}`,pageNumber:c+2,top:f,height:n.height})}),o},yn=(e,t=100,r=fe)=>{const n=we(e),a=pr(r),o=n.height-a,s=t/100;return o/s},Hr=(e,t)=>{if(!e||!t)return 0;try{const r=t.querySelectorAll(me);if(r.length===0)return 0;const n=e.getBoundingClientRect(),a=n.top+n.height/2;for(let o=r.length-1;o>=0;o--)if(r[o].getBoundingClientRect().top<a)return o+1;return 0}catch(r){return console.warn("[getCurrentPage] Failed to calculate page:",r),0}},bn=e=>{if(!e)return[];const t=Array.from(e.children);if(t.length===0)return[];let r=[],n=[];for(const a of t)a.tagName==="PAGE-BREAK"||a.getAttribute("data-page-break")==="true"?n.length>0&&(r.push(n),n=[]):n.push(a);return n.length>0&&r.push(n),r.length===0&&t.length>0&&r.push(t.filter(a=>!(a.tagName==="PAGE-BREAK"||a.getAttribute("data-page-break")==="true"))),r},Br=e=>{if(!e||!e.getBoundingClientRect)return 0;const t=e.getBoundingClientRect();if(e.tagName==="P"){const r=e.querySelectorAll("img"),n=e.textContent.trim();if(r.length===1&&!n){const o=r[0].getBoundingClientRect(),i=window.getComputedStyle(e).textAlign;if(i==="center"||i==="-webkit-center")return o.height+16}return t.height+16}return e.tagName==="H1"||e.tagName==="H2"||e.tagName==="H3"||e.tagName==="H4"||e.tagName==="H5"||e.tagName==="H6"?t.height+20:e.tagName==="UL"||e.tagName==="OL"?t.height+16:t.height},jr=(e,t)=>{if(!e)return!1;try{const r=document.createElement("page-break");return r.setAttribute("data-page-break","true"),r.setAttribute("contenteditable","false"),r.setAttribute("data-page-number",t||"2"),e.parentNode.insertBefore(r,e),!0}catch(r){return console.warn("[insertPageBreakBefore] Failed to insert page break:",r),!1}},$r=(e,t,r,n,a,o,s)=>{if(!e)return!1;try{const d=yn(r,n,a)*(t-1),c=Array.from(e.children);let p=0,f=null;for(let g=0;g<c.length;g++){const m=c[g];if(m.tagName==="PAGE-BREAK"||m.getAttribute("data-page-break")==="true")continue;const b=Br(m);if(p+b>d){f=m;break}p+=b}if(f){const g=document.createElement("page-break");if(g.setAttribute("data-page-break","true"),g.setAttribute("contenteditable","false"),g.setAttribute("data-page-number",String(t)),f.parentNode.insertBefore(g,f),o){const m=e.innerHTML;o(m)}return s&&setTimeout(()=>{s()},50),!0}else{const g=document.createElement("page-break");g.setAttribute("data-page-break","true"),g.setAttribute("contenteditable","false"),g.setAttribute("data-page-number",String(t)),e.appendChild(g);const m=document.createElement("p");if(m.innerHTML="<br>",e.appendChild(m),o){const b=e.innerHTML;o(b)}return s&&setTimeout(()=>{s()},50),!0}}catch(i){return console.error("[insertPageBreakAtBoundary] Failed to insert page break:",i),!1}},zr=(e,t,r,n,a,o,s)=>{if(!e)return!1;if(r().length<=1)return console.warn("[removePageAndContent] Cannot delete the only page"),!1;try{const d=Array.from(e.querySelectorAll(me));if(t>d.length)return console.warn("[removePageAndContent] Invalid page index"),!1;const c=window.getSelection();let p=!1,f=[],g=null;if(t===0){const b=d[0];if(!b)return console.warn("[removePageAndContent] No page break found for first page"),!1;let T=e.firstChild;for(;T&&T!==b;)f.push(T),T=T.nextSibling;g=b}else{const b=d[t-1];if(!b)return console.warn("[removePageAndContent] Page break not found"),!1;const T=d[t];let v=b.nextSibling;for(;v&&v!==T;)f.push(v),v=v.nextSibling;g=b}if(c&&c.rangeCount>0){const T=c.getRangeAt(0).startContainer;for(const v of f)if(v.contains(T)||v===T){p=!0;break}}if(g&&g.parentNode&&g.remove(),f.forEach(b=>{b.parentNode&&b.remove()}),e.querySelectorAll(me).forEach((b,T)=>{b.setAttribute("data-page-number",String(T+2))}),p&&o&&setTimeout(()=>{o(0)},50),n){const b=e.innerHTML;n(b)}return a&&setTimeout(()=>{a(),s&&setTimeout(()=>{s()},150)},100),!0}catch(d){return console.error("[removePageAndContent] Failed to remove page:",d),!1}},Fr=e=>{if(e)try{e.querySelectorAll(me).forEach((r,n)=>{r.setAttribute("data-page-number",String(n+2))})}catch(t){console.error("[renumberPageBreaks] Failed to renumber page breaks:",t)}},Ur=(e,t,r,n,a)=>{if(!e||!t)return!1;try{if(e.remove(),Fr(t),r){const o=t.innerHTML;r(o)}return n&&setTimeout(()=>{n(),a&&setTimeout(()=>{a()},100)},50),!0}catch(o){return console.error("[removePageBreak] Failed to remove page break:",o),!1}},qr=200,Wr=50,vn=3,Gr=20,Tn=e=>{if(!e||!e.getBoundingClientRect)return 0;const t=e.getBoundingClientRect();if(e.tagName==="P"){const r=e.querySelectorAll("img"),n=e.textContent.trim();if(r.length===1&&!n){const o=r[0].getBoundingClientRect(),i=window.getComputedStyle(e).textAlign;if(i==="center"||i==="-webkit-center")return o.height+16}return t.height+16}return e.tagName==="H1"||e.tagName==="H2"||e.tagName==="H3"||e.tagName==="H4"||e.tagName==="H5"||e.tagName==="H6"?t.height+20:e.tagName==="UL"||e.tagName==="OL"?t.height+16:t.height},Zr=(e,t)=>{if(!e||e.length===0)return null;let r=0,n=null;for(let a=0;a<e.length;a++){const o=e[a];if(!o||!o.getBoundingClientRect)continue;const s=Tn(o);if(s<1)continue;if(r+s>t)return n===null?a>0?{overflowIndex:a,overflowElement:o,accumulatedHeight:r}:null:{overflowIndex:a,overflowElement:o,accumulatedHeight:r};r+=s,n=o}return null},Yr=(e,t,r,n,a,o,s,i)=>{if(!e||s.current)return!1;try{s.current=!0;const d=yn(t,r,n);let c=bn(e),p=!1,f=0;for(let g=0;g<c.length&&f<vn;g++){const m=c[g],b=Zr(m,d);if(b&&b.overflowIndex>0){let T=0;for(let O=0;O<m.length;O++){const E=m[O];E&&E.getBoundingClientRect&&(T+=Tn(E))}if(T-d<Gr)continue;const _=g+2;jr(b.overflowElement,_)&&(p=!0,f++,c=bn(e))}}if(p){if(a){const g=e.innerHTML;a(g)}setTimeout(()=>{o&&o(),f>=vn&&i&&setTimeout(()=>{s.current||i()},100)},Wr)}return p}catch(d){return console.warn("[checkAndReflow] Reflow failed:",d),!1}finally{s.current=!1}},Vr=(e,t,r=qr)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{t.current=null,e()},r)},Kr=400,En=(e,t)=>{if(e){e.focus();try{let r=null,n=0;if(t===0)r=e.firstChild,n=0;else{const o=e.querySelectorAll(me)[t-1];o&&o.nextSibling&&(r=o.nextSibling,n=0)}if(r){const a=document.createRange(),o=window.getSelection();r.nodeType===Node.TEXT_NODE?a.setStart(r,n):a.setStart(r,0),a.collapse(!0),o.removeAllRanges(),o.addRange(a)}}catch(r){console.warn("[positionCursorAtPage] Failed to position cursor:",r)}}},Xr=(e,t,r,n)=>{if(!e||!t){console.warn("[scrollToPage] Missing refs");return}try{let a=null;if(r===0)a=t;else{const s=t.querySelectorAll(me)[r-1];if(s)a=s;else{console.warn("[scrollToPage] Page break not found for page",r);return}}if(a){const o=a.getBoundingClientRect(),s=e.getBoundingClientRect(),i=e.scrollTop+(o.top-s.top);e.scrollTo({top:i,behavior:"smooth"}),setTimeout(()=>{n?n(r):En(t,r)},Kr)}}catch(a){console.error("[scrollToPage] Error:",a)}},Jr=(e,t,r={},n=300)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{t.current=null,e(r)},Math.max(0,n))},Qr=e=>{if(!e)return null;const t=window.getSelection();if(t.rangeCount===0)return null;const r=t.getRangeAt(0);if(!e.contains(r.commonAncestorContainer))return null;let n=1;const a=e.querySelectorAll(me);for(const p of a)if(r.comparePoint(p,0)>0)n++;else break;const o=document.createRange();o.setStart(e,0),o.setEnd(r.startContainer,r.startOffset);const i=o.toString().replace(/<[^>]*>/g," ").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\s+/g," ").trim(),d=i.length,c=(i.match(/\n/g)||[]).length+1;return{page:n,line:c,charOffset:d}},eo=300,wn=(e,t,r=100,n="NARROW")=>{const a=pe(),o=l.useRef(null),s=l.useRef(null),i=l.useRef(e),d=l.useRef(r),c=l.useRef(n),p=l.useRef(!1);l.useEffect(()=>{i.current=e},[e]),l.useEffect(()=>{d.current=r},[r]),l.useEffect(()=>{c.current=n},[n]),l.useEffect(()=>()=>{o.current&&clearTimeout(o.current),s.current&&clearTimeout(s.current)},[]);const f=l.useCallback((x={})=>t?.current?Dr(t.current,x):[],[t]),g=l.useCallback((x={})=>{const q=f(x);return a.updatePageBoundaries(q),q},[f,a]),m=l.useCallback((x={})=>{const q=typeof x.delay=="number"?x.delay:eo;Jr(g,o,x,q)},[g]),b=l.useCallback(()=>{t?.current&&Yr(t.current,i.current,d.current,c.current,a.updateContinuousContent,g,p,b)},[t,a,g]),T=l.useCallback(x=>{Vr(b,s,x)},[b]),v=l.useCallback(x=>!x?.current||!t?.current?0:Hr(x.current,t.current),[t]),_=l.useCallback(x=>{t?.current&&En(t.current,x)},[t]),N=l.useCallback((x,q)=>{if(!q?.current||!t?.current){console.warn("[scrollToPage] Missing refs");return}Xr(q.current,t.current,x,_)},[t,_]),O=l.useCallback(async x=>t?.current?$r(t.current,x,i.current,d.current,c.current,a.updateContinuousContent,g):!1,[t,a,g]),E=l.useCallback(x=>t?.current?zr(t.current,x,f,a.updateContinuousContent,g,_,b):!1,[t,f,a,g,_,b]),y=l.useCallback(x=>t?.current?Ur(x,t.current,a.updateContinuousContent,g,b):!1,[t,a,g,b]);return l.useEffect(()=>()=>{o.current&&clearTimeout(o.current),s.current&&clearTimeout(s.current)},[]),l.useMemo(()=>({calculatePageBoundaries:f,checkAndUpdateBoundaries:m,updateBoundaries:g,getCurrentPage:v,scrollToPage:N,positionCursorAtPage:_,checkAndReflow:b,triggerAutoReflow:T,removePageAndContent:E,removePageBreak:y,insertPageBreakAtBoundary:O,boundaryTimeoutRef:o,reflowTimeoutRef:s}),[f,m,g,v,N,_,b,T,E,y,O])},to=(e,t)=>{const{handleZoomIn:r,handleZoomOut:n,handleZoomReset:a,handleUndo:o,handleRedo:s}=e,{editorRef:i,containerRef:d}=t;l.useEffect(()=>{const c=p=>{if(p.ctrlKey||p.metaKey){["+","=","-","_","0","z","y"].includes(p.key)&&p.preventDefault();const f=document.activeElement===i.current,g=document.activeElement===d.current,m=document.activeElement?.tagName==="INPUT"||document.activeElement?.tagName==="TEXTAREA"||document.activeElement?.isContentEditable===!1;if(f||g||!m)switch(p.key){case"+":case"=":r();break;case"-":case"_":n();break;case"0":a();break;case"z":p.shiftKey||o();break;case"y":s();break}}};return window.addEventListener("keydown",c),()=>{window.removeEventListener("keydown",c)}},[r,n,a,o,s,i,d])},no=({updateCurrentFormatFromSelection:e,editorRef:t})=>{const r=l.useRef(null),n=l.useCallback(()=>{if(!t.current)return;const o=window.getSelection();if(r.current)try{o.removeAllRanges(),o.addRange(r.current);return}catch(i){console.warn("[restoreCursorPosition] Failed to restore cursor:",i)}const s=t.current.lastChild;if(s){const i=document.createRange();s.nodeType===Node.TEXT_NODE?i.setStart(s,s.textContent.length):i.setStartAfter(s),i.collapse(!0),o.removeAllRanges(),o.addRange(i)}},[t]),a=l.useCallback(()=>{if(!t.current)return!1;const o=window.getSelection();if(!o||o.rangeCount===0)return!1;const s=o.getRangeAt(0);return t.current.contains(s.commonAncestorContainer)},[t]);return l.useEffect(()=>{const o=()=>{if(e(),t.current){const i=window.getSelection();if(i.rangeCount>0){const d=i.getRangeAt(0);d.collapsed&&t.current.contains(d.commonAncestorContainer)&&(r.current=d.cloneRange())}}};document.addEventListener("selectionchange",o);const s=()=>{if(setTimeout(e,10),r.current&&t.current)try{const i=window.getSelection();i.removeAllRanges(),i.addRange(r.current)}catch(i){console.warn("[handleFocus] Failed to restore cursor:",i)}};return t.current&&t.current.addEventListener("focus",s),()=>{document.removeEventListener("selectionchange",o),t.current&&t.current.removeEventListener("focus",s)}},[e,t]),{restoreCursorPosition:n,hasActiveCursorSelection:a}},Te={minWidth:50,minHeight:50,maxWidth:800,maxHeight:600,aspectRatio:!0,preserveAspectRatio:!0,defaultWidth:300,defaultHeight:200},W={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right"};function ro({handler:e,startX:t,startY:r,currentX:n,currentY:a,startWidth:o,startHeight:s,options:i=Te}){const d=n-t,c=a-r;let p=o,f=s;switch(e){case W.TOP_LEFT:p=Math.max(i.minWidth,o-d),f=Math.max(i.minHeight,s-c);break;case W.TOP_RIGHT:p=Math.max(i.minWidth,o+d),f=Math.max(i.minHeight,s-c);break;case W.BOTTOM_LEFT:p=Math.max(i.minWidth,o-d),f=Math.max(i.minHeight,s+c);break;case W.BOTTOM_RIGHT:p=Math.max(i.minWidth,o+d),f=Math.max(i.minHeight,s+c);break;case W.TOP:f=Math.max(i.minHeight,s-c);break;case W.BOTTOM:f=Math.max(i.minHeight,s+c);break;case W.LEFT:p=Math.max(i.minWidth,o-d);break;case W.RIGHT:p=Math.max(i.minWidth,o+d);break;default:return{width:p,height:f}}if(i.preserveAspectRatio&&i.aspectRatio){const g=o/s;[W.TOP_LEFT,W.TOP_RIGHT,W.BOTTOM_LEFT,W.BOTTOM_RIGHT].includes(e)?p/g>f?f=Math.max(i.minHeight,p/g):p=Math.max(i.minWidth,f*g):[W.TOP,W.BOTTOM].includes(e)?p=f*g:[W.LEFT,W.RIGHT].includes(e)&&(f=p/g)}return i.maxWidth&&p>i.maxWidth&&(p=i.maxWidth,i.preserveAspectRatio&&i.aspectRatio&&(f=p/(o/s))),i.maxHeight&&f>i.maxHeight&&(f=i.maxHeight,i.preserveAspectRatio&&i.aspectRatio&&(p=f*(o/s))),p=Math.max(i.minWidth,p),f=Math.max(i.minHeight,f),{width:Math.round(p),height:Math.round(f)}}function ye(e){return e?!!(e.tagName==="IMG"||e.tagName==="DIV"&&e.style.backgroundImage&&e.style.backgroundImage!=="none"):!1}function oo(e){return ye(e)?{width:e.offsetWidth,height:e.offsetHeight}:{width:0,height:0}}function so(e,{width:t,height:r}){ye(e)&&(e.tagName==="IMG"?(e.style.width=`${t}px`,e.style.height=`${r}px`,e.width=t,e.height=r):e.tagName==="DIV"&&(e.style.width=`${t}px`,e.style.height=`${r}px`))}function xn(e,t=Te){if(!ye(e))return null;const r=document.createElement("div");r.className="image-resize-overlay",r.style.position="fixed",r.style.zIndex="1000",r.style.pointerEvents="none";const n=e.getBoundingClientRect();return r.style.top=`${n.top}px`,r.style.left=`${n.left}px`,r.style.width=`${n.width}px`,r.style.height=`${n.height}px`,Object.values(W).forEach(o=>{const s=document.createElement("div");s.className=`resize-handler resize-handler-${o}`,s.dataset.handler=o,s.style.position="absolute",s.style.width="10px",s.style.height="10px",s.style.backgroundColor="#007bff",s.style.border="2px solid white",s.style.borderRadius="50%",s.style.boxShadow="0 0 3px rgba(0,0,0,0.3)",s.style.cursor=ao(o),s.style.pointerEvents="all",Cn(s,o,n.width,n.height),r.appendChild(s)}),r}function ao(e){switch(e){case W.TOP_LEFT:case W.BOTTOM_RIGHT:return"nwse-resize";case W.TOP_RIGHT:case W.BOTTOM_LEFT:return"nesw-resize";case W.TOP:case W.BOTTOM:return"ns-resize";case W.LEFT:case W.RIGHT:return"ew-resize";default:return"default"}}function Cn(e,t,r,n){switch(t){case W.TOP_LEFT:e.style.top="-5px",e.style.left="-5px";break;case W.TOP_RIGHT:e.style.top="-5px",e.style.right="-5px";break;case W.BOTTOM_LEFT:e.style.bottom="-5px",e.style.left="-5px";break;case W.BOTTOM_RIGHT:e.style.bottom="-5px",e.style.right="-5px";break;case W.TOP:e.style.top="-5px",e.style.left=`${r/2+-5}px`;break;case W.BOTTOM:e.style.bottom="-5px",e.style.left=`${r/2+-5}px`;break;case W.LEFT:e.style.top=`${n/2+-5}px`,e.style.left="-5px";break;case W.RIGHT:e.style.top=`${n/2+-5}px`,e.style.right="-5px";break}}function Fe(e,t){if(!e||!t)return;const r=t.getBoundingClientRect();e.style.top=`${r.top}px`,e.style.left=`${r.left}px`,e.style.width=`${r.width}px`,e.style.height=`${r.height}px`,e.querySelectorAll(".resize-handler").forEach(a=>{const o=a.dataset.handler;Cn(a,o,r.width,r.height)})}function Ue(e){e&&e.parentNode&&e.parentNode.removeChild(e)}const io="html-editor-storage",lo=1,le="images";function co(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function Pe(){return new Promise((e,t)=>{const r=indexedDB.open(io,lo);r.onerror=()=>{t(new Error("Failed to open IndexedDB database"))},r.onsuccess=()=>{e(r.result)},r.onupgradeneeded=n=>{const a=n.target.result;a.objectStoreNames.contains(le)||a.createObjectStore(le,{keyPath:"key"}).createIndex("timestamp","timestamp",{unique:!1})}})}function An(e){return new Promise((t,r)=>{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(e.type)){r(new Error("Invalid image format. Supported formats: png, jpeg, gif, webp"));return}if(e.size>5*1024*1024){r(new Error("Image exceeds maximum size of 5MB"));return}const a=new FileReader;a.onload=async o=>{const s=o.target.result,d=s.split(",")[1].length*3/4;if(d>5*1024*1024){r(new Error("Image exceeds maximum size of 5MB"));return}try{const c=await Pe(),p=`editor-image-${co()}`,g=c.transaction([le],"readwrite").objectStore(le),m={key:p,dataUrl:s,size:d,type:e.type,timestamp:Date.now()},b=g.add(m);b.onsuccess=()=>{c.close(),t(p)},b.onerror=()=>{c.close(),r(new Error("Failed to save image to IndexedDB"))}}catch(c){r(c)}},a.onerror=()=>{r(new Error("Error reading image file"))},a.readAsDataURL(e)})}async function _n(e){try{const t=await Pe();return new Promise((r,n)=>{const s=t.transaction([le],"readonly").objectStore(le).get(e);s.onsuccess=()=>{t.close();const i=s.result;r(i?i.dataUrl:null)},s.onerror=()=>{t.close(),n(new Error("Failed to retrieve image from IndexedDB"))}})}catch(t){return console.error("Error getting image:",t),null}}async function kn(e){try{const t=await Pe();return new Promise((r,n)=>{const s=t.transaction([le],"readwrite").objectStore(le).delete(e);s.onsuccess=()=>{t.close(),r()},s.onerror=()=>{t.close(),n(new Error("Failed to delete image from IndexedDB"))}})}catch(t){console.error("Error deleting image:",t)}}async function uo(){try{const e=await Pe();return new Promise((t,r)=>{const o=e.transaction([le],"readwrite").objectStore(le).clear();o.onsuccess=()=>{e.close(),t()},o.onerror=()=>{e.close(),r(new Error("Failed to clear images from IndexedDB"))}})}catch(e){console.error("Error clearing images:",e)}}async function fo(){try{const e=await Pe();return new Promise((t,r)=>{const o=e.transaction([le],"readonly").objectStore(le).getAllKeys();o.onsuccess=()=>{e.close(),t(o.result||[])},o.onerror=()=>{e.close(),r(new Error("Failed to get image keys from IndexedDB"))}})}catch(e){return console.error("Error getting image keys:",e),[]}}const Sn=["P","DIV","H1","H2","H3","H4","H5","H6","UL","OL","LI","TABLE","TBODY","TR","TD","TH","THEAD","TFOOT","BLOCKQUOTE","PRE","HR","FIGURE","FIGCAPTION","PAGE-BREAK"],po=["SPAN","STRONG","EM","B","I","U","S","STRIKE","DEL","INS","SUB","SUP","MARK","SMALL","CODE","KBD","SAMP","VAR","A","ABBR","CITE","DFN","TIME"],go=["BR","HR","IMG","INPUT","PAGE-BREAK"];function ho(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function Nn(e){const t=[];for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];t.push(` ${n.name}="${n.value}"`)}return t.join("")}function qe(e){if(!e||typeof e!="string")return"<p><br></p>";const t=e.trim();if(!t)return"<p><br></p>";const r=document.createElement("div");return r.innerHTML=t,Me(r)||"<p><br></p>"}function mo(e){const t=e.cloneNode(!0);return t.querySelectorAll(":scope > p").forEach(n=>{for(;n.firstChild;)t.insertBefore(n.firstChild,n);n.remove()}),t.innerHTML}function yo(e){const t=Array.from(e.children);return t.length===0?!1:t.every(r=>Sn.includes(r.tagName))}function bo(e){const t=[];let r=!1;return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===Node.TEXT_NODE)n.textContent.trim()&&(r=!0);else if(n.nodeType===Node.ELEMENT_NODE){const a=n;Sn.includes(a.tagName)?t.push(a.outerHTML):r=!0}}),r?e.outerHTML:t.join("")}function Me(e){const t=[],r=Array.from(e.childNodes);for(let n=0;n<r.length;n++){const a=r[n];if(a.nodeType===Node.TEXT_NODE){const o=a.textContent.trim();o&&t.push(`<p>${ho(o)}</p>`)}else if(a.nodeType===Node.ELEMENT_NODE){const o=a,s=o.tagName,i=s.toLowerCase(),d=Nn(o);if(s==="DIV"){const c=Me(o);c.trim()?t.push(c):t.push("<p><br></p>")}else if(s==="P")yo(o)?t.push(bo(o)):t.push(o.outerHTML);else if(["H1","H2","H3","H4","H5","H6"].includes(s)){const c=mo(o);t.push(`<${i}${d}>${c}</${i}>`)}else if(s==="BR")t.push("<p><br></p>");else if(s==="IMG")t.push(o.outerHTML);else if(["UL","OL"].includes(s))t.push(vo(o));else if(s==="LI")t.push(o.outerHTML);else if(s==="TABLE")t.push(To(o));else if(["TBODY","THEAD","TFOOT","TR","TD","TH"].includes(s))t.push(o.outerHTML);else if(s==="BLOCKQUOTE"){const c=Me(o);t.push(`<blockquote${d}>${c}</blockquote>`)}else if(s==="PRE")t.push(o.outerHTML);else if(po.includes(s))t.push(o.outerHTML);else if(s==="PAGE-BREAK"||o.getAttribute("data-page-break")==="true")t.push(o.outerHTML);else if(s==="HR")t.push(o.outerHTML);else if(s==="FIGURE")t.push(o.outerHTML);else if(go.includes(s))t.push(o.outerHTML);else{const c=Me(o);t.push(`<${i}${d}>${c}</${i}>`)}}}return t.length===0?"":t.join("")}function vo(e){const t=e.tagName.toLowerCase(),r=Nn(e),n=[];return Array.from(e.children).forEach(a=>{if(a.tagName==="LI")n.push(a.outerHTML);else{const o=Me(a);o.trim()&&n.push(`<li>${o}</li>`)}}),n.length===0?`<${t}${r}><li><br></li></${t}>`:`<${t}${r}>${n.join("")}</${t}>`}function To(e){return e.outerHTML}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eo=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),wo=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,n)=>n?n.toUpperCase():r.toLowerCase()),On=e=>{const t=wo(e);return t.charAt(0).toUpperCase()+t.slice(1)},Pn=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim(),xo=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Co={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ao=l.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:a="",children:o,iconNode:s,...i},d)=>l.createElement("svg",{ref:d,...Co,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:Pn("lucide",a),...!o&&!xo(i)&&{"aria-hidden":"true"},...i},[...s.map(([c,p])=>l.createElement(c,p)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=(e,t)=>{const r=l.forwardRef(({className:n,...a},o)=>l.createElement(Ao,{ref:o,iconNode:t,className:Pn(`lucide-${Eo(On(e))}`,`lucide-${e}`,n),...a}));return r.displayName=On(e),r};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _o=X("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ko=X("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const So=X("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const No=X("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oo=X("bold",[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Po=X("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mo=X("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lo=X("file-check",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=X("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ro=X("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Io=X("heading-1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Do=X("heading-2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ho=X("heading-3",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bo=X("image-upscale",[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M17 21h2a2 2 0 0 0 2-2",key:"130fy9"}],["path",{d:"M21 12v3",key:"1wzk3p"}],["path",{d:"m21 3-5 5",key:"1g5oa7"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2",key:"kk3yz1"}],["path",{d:"m5 21 4.144-4.144a1.21 1.21 0 0 1 1.712 0L13 19",key:"fyekpt"}],["path",{d:"M9 3h3",key:"d52fa"}],["rect",{x:"3",y:"11",width:"10",height:"10",rx:"1",key:"1wpmix"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jo=X("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $o=X("italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zo=X("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fo=X("list-indent-decrease",[["path",{d:"M21 5H11",key:"us1j55"}],["path",{d:"M21 12H11",key:"wd7e0v"}],["path",{d:"M21 19H11",key:"saa85w"}],["path",{d:"m7 8-4 4 4 4",key:"o5hrat"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uo=X("list-indent-increase",[["path",{d:"M21 5H11",key:"us1j55"}],["path",{d:"M21 12H11",key:"wd7e0v"}],["path",{d:"M21 19H11",key:"saa85w"}],["path",{d:"m3 8 4 4-4 4",key:"1a3j6y"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qo=X("list-ordered",[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=X("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wo=X("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Go=X("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zo=X("redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yo=X("scaling",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M14 15H9v-5",key:"pi4jk9"}],["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M21 3 9 15",key:"15kdhq"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vo=X("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ko=X("strikethrough",[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xo=X("table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=X("text-align-center",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M17 12H7",key:"16if0g"}],["path",{d:"M19 19H5",key:"vjpgq2"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=X("text-align-end",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M21 19H7",key:"4cu937"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jo=X("text-align-justify",[["path",{d:"M3 5h18",key:"1u36vt"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 19h18",key:"awlh7x"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=X("text-align-start",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=X("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qo=X("underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=X("undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=X("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=X("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=X("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Ln=(e,t,r="")=>{if(!e)return[];const n=document.createElement("div");n.innerHTML=e;const a=n.querySelectorAll("h1, h2, h3, h4, h5, h6");return Array.from(a).map((o,s)=>{const i=parseInt(o.tagName.charAt(1)),d=o.textContent.trim();return d?{id:`${r}heading-${s}`,level:i,text:d,page:t||1}:null}).filter(Boolean)},os=e=>{if(!e)return 0;const t=document.createElement("div");return t.innerHTML=e,(t.textContent||t.innerText||"").trim().split(/\s+/).filter(n=>n.length>0).length},Rn=({isCollapsed:e,onToggle:t,wordCount:r,pageCount:n})=>{const a=ft(),{pages:o,activePage:s,continuousContent:i}=a,{wordCount:d,outline:c}=l.useMemo(()=>{if(r!==void 0&&n!==void 0)return{wordCount:r,outline:Ln(i,1,"continuous-")};let f=0;const g=[];return o.forEach((m,b)=>{f+=os(m.content),g.push(...Ln(m.content,b+1,`page-${b}-`))}),{wordCount:f,outline:g}},[o,r,n,i]),p=n!==void 0?n:o.length;return h.jsxs("aside",{className:`sidebar ${e?"collapsed":""}`,role:"complementary","aria-label":"Document information","data-testid":"sidebar",children:[h.jsxs("div",{className:"sidebar-header",children:[h.jsxs("div",{className:"sidebar-title",children:[h.jsx(We,{size:18}),h.jsx("h2",{children:"Document Info"})]}),h.jsx("button",{className:"sidebar-toggle",onClick:t,"aria-label":e?"Expand sidebar":"Collapse sidebar",title:e?"Expand sidebar":"Collapse sidebar",children:e?h.jsx(Mo,{size:16}):h.jsx(Po,{size:16})})]}),!e&&h.jsxs("div",{className:"sidebar-content",children:[h.jsxs("div",{className:"sidebar-section",children:[h.jsx("h3",{children:"Statistics"}),h.jsxs("div",{className:"stat-item",children:[h.jsxs("div",{className:"stat-label",children:[h.jsx(Lo,{size:14}),h.jsx("span",{children:"Pages:"})]}),h.jsx("span",{className:"stat-value",children:p})]}),h.jsxs("div",{className:"stat-item","data-testid":"word-count",children:[h.jsxs("div",{className:"stat-label",children:[h.jsx(Ro,{size:14}),h.jsx("span",{children:"Words:"})]}),h.jsx("span",{className:"stat-value",children:d.toLocaleString()})]}),h.jsxs("div",{className:"stat-item",children:[h.jsxs("div",{className:"stat-label",children:[h.jsx(We,{size:14}),h.jsx("span",{children:"Active Page:"})]}),h.jsx("span",{className:"stat-value",children:s+1})]})]}),c.length>0&&h.jsxs("div",{className:"sidebar-section",children:[h.jsxs("h3",{children:[h.jsx(Mn,{size:14,style:{display:"inline-block",marginRight:"6px",verticalAlign:"middle"}}),"Document Outline"]}),h.jsx("div",{className:"document-outline","data-testid":"outline",children:c.map(f=>{const g=f.level===1?Io:f.level===2?Do:Ho;return h.jsxs("div",{className:`outline-item outline-level-${f.level}`,style:{marginLeft:`${(f.level-1)*12}px`},children:[h.jsx(g,{size:12,className:"outline-icon"}),h.jsx("span",{className:"outline-text",children:f.text}),h.jsxs("span",{className:"outline-page",children:["p.",f.page]})]},f.id)})})]})]})]})};class In{constructor(t="Editor"){this.namespace=t}_format(t,r,n){return`[${new Date().toISOString()}] [${this.namespace}] [${t}] ${r}`}info(t,r){}warn(t,r){}error(t,r){}debug(t,r){}}const Dn=new In("Editor"),Hn=new Set(["P","DIV","H1","H2","H3","H4","H5","H6","LI","BLOCKQUOTE","PRE","TABLE"]),Bn=32;function jn(e,t){if(!e)return;e.dataset||(e.dataset={}),e.style||(e.style={});const r=parseInt(e.dataset.indentLevel||"0",10),n=Math.max(0,t?r-1:r+1);n===0?(e.style.marginLeft="",delete e.dataset.indentLevel):(e.style.marginLeft=`${n*Bn}px`,e.dataset.indentLevel=String(n))}function ss(e,t){jn(e,t)}function as(e){let t=e;for(;t;){if(t.nodeType===1&&t.tagName&&Hn.has(t.tagName.toUpperCase()))return t;t=t.parentElement||t.parentNode}return null}function is(){const e=window.getSelection();if(!e||e.rangeCount===0)return[];const t=e.getRangeAt(0),r=new Set;let n=t.commonAncestorContainer;for(n.nodeType===Node.TEXT_NODE&&(n=n.parentElement);n&&n.contentEditable!=="true";)n=n.parentElement;return n?(n.querySelectorAll("p, div, h1, h2, h3, h4, h5, h6, li, blockquote, pre, table").forEach(s=>{document.createRange().selectNodeContents(s),t.intersectsNode(s)&&r.add(s)}),r.size===0&&n.querySelectorAll("img").forEach(i=>{if(document.createRange().selectNode(i),t.intersectsNode(i)){let c=i.parentElement;for(;c&&c!==n;){if(c.tagName&&Hn.has(c.tagName.toUpperCase())){r.add(c);break}c=c.parentElement}}}),Array.from(r).filter(s=>{let i=s.parentElement;for(;i;){if(r.has(i))return!1;i=i.parentElement}return!0})):[]}function ls(e){if(e.style&&e.style.marginLeft&&e.style.marginLeft!==""){const t=parseInt(e.dataset.indentLevel||"0",10),r=Math.max(0,t-1);r===0?(e.style.marginLeft="",delete e.dataset.indentLevel):(e.style.marginLeft=`${r*Bn}px`,e.dataset.indentLevel=String(r));return}if(e.innerHTML.startsWith("&nbsp;&nbsp;&nbsp;&nbsp;")){e.innerHTML=e.innerHTML.replace(/^(&nbsp;){4}/,"");return}try{const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let r=t.nextNode();for(;r;){const n=r.textContent;if(n.startsWith("    ")){r.textContent=n.substring(4);break}r=t.nextNode()}}catch{e.innerHTML=e.innerHTML.replace(/^(&nbsp;){4}/,"")}}function At(e=!1){const t=window.getSelection();if(!t||t.rangeCount===0)return!1;let r=is();const n=t.getRangeAt(0);if(r.length===0){const s=as(n.startContainer);if(!s)return!1;r=[s]}const a=r[0],o=r[r.length-1];r.forEach(s=>{if((s.tagName?s.tagName.toUpperCase():"")==="LI"){ss(s,e);return}e?ls(s):jn(s,!1)});try{const s=document.createRange(),i=f=>f.nodeType===Node.TEXT_NODE?f:document.createTreeWalker(f,NodeFilter.SHOW_TEXT,null).nextNode(),d=f=>{if(f.nodeType===Node.TEXT_NODE)return f;const g=document.createTreeWalker(f,NodeFilter.SHOW_TEXT,null);let m=null,b=g.nextNode();for(;b;)m=b,b=g.nextNode();return m},c=i(a);c?s.setStart(c,0):s.setStart(a,0);const p=d(o);p?s.setEnd(p,p.length):s.setEnd(o,o.childNodes.length),t.removeAllRanges(),t.addRange(s)}catch{try{const i=document.createRange();i.setStartBefore(a),i.setEndAfter(o),t.removeAllRanges(),t.addRange(i)}catch(i){console.warn("Could not restore selection after indentation:",i)}}return!0}function cs(e){if(e.key!=="Tab")return!1;e.preventDefault();const t=e.shiftKey,r=window.getSelection(),n=r&&r.rangeCount>0?r.getRangeAt(0):null;return r&&r.rangeCount>0&&n&&!n.collapsed&&At(t)||t||document.execCommand("insertHTML",!1,"&nbsp;&nbsp;&nbsp;&nbsp;"),!0}const _t=({currentColor:e,onColorSelect:t,title:r="Font Color"})=>{const[n,a]=l.useState(!1),o=l.useRef(null),s=["#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#FFC0CB","#A52A2A","#808080","#FFFFFF"];l.useEffect(()=>{const c=p=>{o.current&&!o.current.contains(p.target)&&a(!1)};return document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[]);const i=c=>{t(c),a(!1)},d=c=>{const p=c.target.value;t(p)};return h.jsxs("div",{className:"color-picker-dropdown",ref:o,children:[h.jsx("button",{onClick:()=>a(!n),className:"color-picker-button",title:r,style:{backgroundColor:e||"#000000",border:"1px solid #ccc",borderRadius:"3px",width:"24px",height:"24px",cursor:"pointer",position:"relative"},children:h.jsx(Wo,{size:14,style:{color:e==="#FFFFFF"?"#000":"#FFF"}})}),n&&h.jsxs("div",{className:"color-picker-palette",children:[h.jsx("div",{className:"color-grid",children:s.map(c=>h.jsx("button",{onClick:()=>i(c),className:`color-option ${e===c?"selected":""}`,style:{backgroundColor:c,border:e===c?"2px solid #007acc":"1px solid #ccc",width:"24px",height:"24px",margin:"2px",borderRadius:"3px",cursor:"pointer"},title:c},c))}),h.jsxs("div",{className:"custom-color-section",children:[h.jsx("label",{htmlFor:"custom-color-input",style:{fontSize:"12px",marginBottom:"4px",display:"block"},children:"Custom Color:"}),h.jsx("input",{id:"custom-color-input",type:"color",value:e||"#000000",onChange:d,style:{width:"100%",height:"32px",border:"1px solid #ccc",borderRadius:"3px",cursor:"pointer"}})]})]})]})};_t.propTypes={currentColor:w.string,onColorSelect:w.func.isRequired,title:w.string};const us=[{value:"Segoe UI",label:"Segoe UI"},{value:"Arial",label:"Arial"},{value:"Times New Roman",label:"Times New Roman"},{value:"Courier New",label:"Courier New"},{value:"Georgia",label:"Georgia"},{value:"Verdana",label:"Verdana"},{value:"Noto Sans Sinhala",label:"Noto Sans Sinhala"},{value:"Iskoola Pota",label:"Iskoola Pota"},{value:"Noto Sans Tamil",label:"Noto Sans Tamil"},{value:"Noto Sans",label:"Noto Sans"}],ds=[{value:"p",label:"Normal"},{value:"h1",label:"Heading 1"},{value:"h2",label:"Heading 2"},{value:"h3",label:"Heading 3"},{value:"h4",label:"Heading 4"},{value:"h5",label:"Heading 5"},{value:"h6",label:"Heading 6"}],fs='<table border="1"><tr><th>Header 1</th><th>Header 2</th></tr><tr><td>Cell 3</td><td>Cell 4</td></tr></table>',Ge=({currentFormat:e,onFormatText:t,onAddPageBreak:r,onInsertImage:n,canUndo:a=!1,canRedo:o=!1})=>{const s=(m,b,T,v=null,_=!1)=>h.jsx("button",{onClick:m,className:v&&e[v]?"active":"",disabled:_,title:T,style:{opacity:_?.5:1},children:h.jsx(b,{size:16})},T),i=()=>h.jsx("div",{className:"toolbar-separator"}),d=async m=>{try{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(m.type)){alert("Invalid image format. Supported: PNG, JPEG, GIF, WEBP");return}if(m.size>5242880){alert("Image exceeds maximum size of 5MB");return}const T=await An(m),v=await _n(T);if(v&&n){const _=`<img src="${v}" data-key="${T}" alt="Inserted image" />`;n(_)}else Dn.warn("Failed to insert image: missing URL or callback");document.getElementById("image-upload").value=""}catch(b){Dn.error("Error uploading image",b)}},c=()=>{At(!1)||document.execCommand("insertHTML",!1,"&nbsp;&nbsp;&nbsp;&nbsp;")},p=()=>{At(!0)},f=()=>{const m=prompt("Enter URL:");m&&t("createLink",m)},g=()=>{document.getElementById("image-upload").click()};return h.jsxs("div",{className:"editor-toolbar",children:[s(()=>t("undo"),es,"Undo",null,!a),s(()=>t("redo"),Zo,"Redo",null,!o),i(),s(()=>t("bold"),Oo,"Bold","bold"),s(()=>t("italic"),$o,"Italic","italic"),s(()=>t("underline"),Qo,"Underline","underline"),s(()=>t("strikethrough"),Ko,"Strikethrough","strikethrough"),i(),s(()=>t("justifyLeft"),xt,"Align Left","alignLeft"),s(()=>t("justifyCenter"),Et,"Align Center","alignCenter"),s(()=>t("justifyRight"),wt,"Align Right","alignRight"),s(()=>t("justifyFull"),Jo,"Justify","alignJustify"),i(),h.jsx("select",{onChange:m=>t("fontName",m.target.value),value:e.fontFamily||"Segoe UI",title:"Font Family",children:us.map(({value:m,label:b})=>h.jsx("option",{value:m,children:b},m))}),h.jsx("select",{onChange:m=>t("fontSize",m.target.value),value:e.fontSize||Ne,title:"Font Size",children:fn.map(({value:m,label:b})=>h.jsx("option",{value:m,children:b},m))}),h.jsx(_t,{currentColor:e.fontColor,onColorSelect:m=>t("foreColor",m),title:"Font Color"}),h.jsx("select",{onChange:m=>t("formatBlock",m.target.value),value:e.headingLevel||"p",title:"Heading Level",children:ds.map(({value:m,label:b})=>h.jsx("option",{value:m,children:b},m))}),i(),s(()=>t("insertUnorderedList"),Mn,"Bullet List"),s(()=>t("insertOrderedList"),qo,"Numbered List"),i(),h.jsx("button",{onClick:c,title:"Increase Indent (Tab)",children:h.jsx(Uo,{size:16})}),h.jsx("button",{onClick:p,title:"Decrease Indent (Shift+Tab)",children:h.jsx(Fo,{size:16})}),i(),h.jsx("button",{onClick:f,title:"Insert Link",children:h.jsx(zo,{size:16})}),s(()=>t("insertHTML",fs),Xo,"Insert Table"),r&&s(r,We,"Insert Page Break"),i(),h.jsx("input",{type:"file",accept:"image/*",onChange:m=>m.target.files[0]&&d(m.target.files[0]),style:{display:"none"},id:"image-upload"}),h.jsx("button",{onClick:g,title:"Insert Image",children:h.jsx(jo,{size:16})})]})};Ge.propTypes={currentFormat:w.shape({bold:w.bool,italic:w.bool,underline:w.bool,strikethrough:w.bool,alignLeft:w.bool,alignCenter:w.bool,alignRight:w.bool,alignJustify:w.bool,fontFamily:w.string,fontSize:w.string,fontColor:w.string,headingLevel:w.string}).isRequired,onFormatText:w.func.isRequired,onAddPageBreak:w.func,onInsertImage:w.func,canUndo:w.bool,canRedo:w.bool},Ge.defaultProps={onAddPageBreak:void 0,onInsertImage:void 0,canUndo:!1,canRedo:!1};function ps(e){return!e||typeof e!="string"?e:qe(e)}function gs(e){e.preventDefault();const t=e.clipboardData||window.clipboardData;if(!t)return null;let r=t.getData("text/html")||t.getData("text/plain");return r?(t.getData("text/html")?r=ps(r):r=hs(r),document.execCommand("insertHTML",!1,r),r):null}function hs(e){if(!e)return"";const t=e.split(/\n\s*\n/).filter(r=>r.trim());return t.length===0?"<p><br></p>":t.map(r=>{const n=r.split(`
`).filter(o=>o.trim());return n.length===0?"<p><br></p>":`<p>${n.map(o=>ms(o.trim())).join("<br>")}</p>`}).join("")}function ms(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}const Ee=e=>e?e.nodeType===Node.ELEMENT_NODE?e.tagName==="PAGE-BREAK"||e.getAttribute("data-page-break")==="true":e.parentElement&&Ee(e.parentElement):!1,kt=({dimensions:e,editorRef:t,onInput:r,onContentChange:n,onKeyDown:a,onClick:o,onScroll:s,onPaste:i,onRemovePageBreak:d,zoomLevel:c=100,pageMargins:p=fe})=>{const f=l.useMemo(()=>Kt(p),[p]),g=c/100,m=l.useCallback((E,y)=>{if(!E)return!1;const x=E.getBoundingClientRect(),q=y-x.top;return q<f.top||q>x.height-f.bottom},[f.top,f.bottom]),b=l.useCallback((E,y)=>{y.preventDefault();const x=E.getBoundingClientRect(),q=y.clientX-x.left,P=y.clientY-x.top,z=x.width-40,k=-12,I=x.width-20;q>=z&&q<=I&&P>=k&&P<=8&&d&&d(E)},[d]),T=l.useCallback(E=>{E.preventDefault();const y=t.current.getBoundingClientRect();if(E.clientY-y.top<f.top){const q=t.current.firstElementChild;if(q&&q.tagName!=="PAGE-BREAK"){const P=document.createRange(),z=window.getSelection();P.setStart(q,0),P.collapse(!0),z.removeAllRanges(),z.addRange(P)}}else{const q=t.current.lastElementChild;if(q&&q.tagName!=="PAGE-BREAK"){const P=document.createRange(),z=window.getSelection();P.selectNodeContents(q),P.collapse(!1),z.removeAllRanges(),z.addRange(P)}}},[t,f.top]),v=l.useCallback(E=>{const y=window.getSelection();if(!y||y.rangeCount===0)return;const x=y.getRangeAt(0),{startContainer:q,endContainer:P}=x;if((Ee(q)||Ee(P))&&(E.key.length===1||E.key==="Enter"||E.key===" "))return E.preventDefault(),!1;if(cs(E))return n&&n(),!1;if((E.key==="Backspace"||E.key==="Delete")&&(Ee(q)||Ee(P)))return E.preventDefault(),!1;a&&a(E)},[a,n]),_=l.useCallback(E=>{if(!t.current)return;const y=E.target;if(Ee(y)){b(y,E);return}if(m(t.current,E.clientY)){T(E);return}o&&o(E)},[t,o,b,T,m]),N=l.useCallback(E=>{const y=window.getSelection();if(!y||y.rangeCount===0)return;const x=y.getRangeAt(0),{startContainer:q}=x;if(Ee(q))return E.preventDefault(),!1},[]),O=l.useCallback(E=>{const y=gs(E);i&&i(E,y)},[i]);return h.jsx("div",{className:"continuous-page-container",style:{position:"relative",width:"100%",maxWidth:`${e.width}px`,margin:"40px auto",backgroundColor:"transparent",minHeight:"100vh",transform:`scale(${g})`,transformOrigin:"top center",transition:"transform 0.2s ease-out"},children:h.jsx("div",{ref:t,contentEditable:!0,suppressContentEditableWarning:!0,className:"continuous-content",style:{position:"relative",zIndex:1,minHeight:`${e.height}px`,width:`${e.width}px`,backgroundColor:"white",padding:`${f.top}px ${f.right}px ${f.bottom}px ${f.left}px`,boxSizing:"border-box",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",outline:"none",cursor:"text",fontFamily:'"Segoe UI", "Noto Sans Sinhala", "Noto Sans", "Malithi Web", "Iskoola Pota", "Kaputa Unicode", "Helvetica Neue", Arial, "Hiragino Sans GB", "WenQuanYi Micro Hei", "Microsoft YaHei", sans-serif',fontSize:Ne,lineHeight:"1.4",color:"#333",wordWrap:"break-word",whiteSpace:"pre-wrap",overflowWrap:"break-word",border:"1px solid #e0e0e0"},onInput:r,onKeyDown:v,onBeforeInput:N,onClick:_,onScroll:s,onPaste:O,"data-testid":"continuous-editor"})})};kt.propTypes={dimensions:w.shape({width:w.number.isRequired,height:w.number.isRequired}).isRequired,editorRef:w.shape({current:w.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onInput:w.func.isRequired,onContentChange:w.func,onKeyDown:w.func,onClick:w.func,onScroll:w.func,onPaste:w.func,onRemovePageBreak:w.func,zoomLevel:w.number,pageMargins:w.string},kt.defaultProps={onContentChange:void 0,onKeyDown:void 0,onClick:void 0,onScroll:void 0,onPaste:void 0,onRemovePageBreak:void 0,zoomLevel:100,pageMargins:fe};const $n=l.memo(kt),St=({pageBoundaries:e=[{id:"page-0",pageNumber:1}],activePage:t=0,pageSize:r="A4",pageMargins:n=fe,zoomLevel:a=100,canZoomIn:o=!0,canZoomOut:s=!0,onNavigate:i,onAddPage:d,onDeletePage:c,onPageSizeChange:p,onPageMarginsChange:f,onZoomIn:g,onZoomOut:m,onZoomReset:b}={})=>{const T=Math.max(e?.length||0,1),v=y=>{i&&i(y)},_=()=>{d&&d()},N=y=>{if(T<=1){console.warn("[PageManager] Cannot delete the only page");return}c&&c(y)},O=y=>{p&&p(y)},E=y=>{f&&f(y)};return h.jsxs("div",{className:"page-manager",children:[h.jsxs("div",{className:"page-settings-group",children:[h.jsxs("div",{className:"page-settings-header",children:[h.jsx(Vo,{size:14,style:{marginRight:"4px",verticalAlign:"middle"}}),"Page Settings"]}),h.jsxs("div",{className:"page-settings-controls",children:[h.jsxs("div",{className:"page-setting-item",children:[h.jsx("label",{htmlFor:"page-size-selector",children:"Size:"}),h.jsxs("select",{id:"page-size-selector",role:"combobox","aria-label":"Page size selector",value:r,onChange:y=>O(y.target.value),children:[h.jsx("option",{value:"A4",children:"A4"}),h.jsx("option",{value:"Letter",children:"Letter"}),h.jsx("option",{value:"Legal",children:"Legal"})]})]}),h.jsxs("div",{className:"page-setting-item",children:[h.jsx("label",{htmlFor:"page-margins-selector",children:"Margins:"}),h.jsx("select",{id:"page-margins-selector",role:"combobox","aria-label":"Page margins selector",value:n,onChange:y=>E(y.target.value),children:gr().map(y=>h.jsx("option",{value:y,children:hr(y)},y))})]})]})]}),h.jsxs("div",{className:"zoom-controls-compact",children:[h.jsx("button",{type:"button",className:"zoom-button-compact",onClick:m,disabled:!s,"aria-label":"Zoom out",title:"Zoom out (Ctrl + -)",children:h.jsx(rs,{size:12})}),h.jsxs("span",{className:"zoom-level-display",children:[a,"%"]}),h.jsx("button",{type:"button",className:"zoom-button-compact",onClick:g,disabled:!o,"aria-label":"Zoom in",title:"Zoom in (Ctrl + +)",children:h.jsx(ns,{size:12})}),h.jsx("button",{type:"button",className:"zoom-reset-compact",onClick:b,"aria-label":"Reset zoom",title:"Reset zoom to 100% (Ctrl + 0)",children:"Reset"})]}),h.jsx("div",{className:"page-list",children:e.map((y,x)=>h.jsxs("div",{className:"page-item",children:[h.jsxs("button",{type:"button",className:`page-button ${x===t?"active":""}`,onClick:()=>v(x),"aria-label":`Go to page ${x+1}`,"aria-current":x===t?"page":void 0,children:[h.jsx(We,{size:14}),h.jsxs("span",{children:["Page ",x+1]})]}),T>1&&h.jsx("button",{type:"button",className:"delete-page-button",onClick:q=>{q.stopPropagation(),N(x)},"aria-label":`Delete page ${x+1}`,title:"Delete this page and its content",children:h.jsx(ts,{size:14})})]},y.id||`page-${x}`))}),h.jsxs("button",{type:"button",className:"add-page-button",onClick:_,"aria-label":"Add new page",title:"Add new page at end",children:[h.jsx(Go,{size:16}),h.jsx("span",{children:"Add Page"})]})]})};St.propTypes={pageBoundaries:w.arrayOf(w.shape({id:w.string.isRequired,pageNumber:w.number.isRequired,top:w.number,height:w.number})),activePage:w.number,pageSize:w.oneOf(["A4","Letter","Legal"]),pageMargins:w.string,zoomLevel:w.number,canZoomIn:w.bool,canZoomOut:w.bool,onNavigate:w.func,onAddPage:w.func,onDeletePage:w.func,onPageSizeChange:w.func,onPageMarginsChange:w.func,onZoomIn:w.func,onZoomOut:w.func,onZoomReset:w.func},St.defaultProps={pageBoundaries:[{id:"page-0",pageNumber:1}],activePage:0,pageSize:"A4",pageMargins:fe,zoomLevel:100,canZoomIn:!0,canZoomOut:!0,onNavigate:void 0,onAddPage:void 0,onDeletePage:void 0,onPageSizeChange:void 0,onPageMarginsChange:void 0,onZoomIn:void 0,onZoomOut:void 0,onZoomReset:void 0};const zn=l.memo(St),Ze=10,ys=300,bs=200;function vs(e){switch(e){case W.TOP_LEFT:case W.BOTTOM_RIGHT:return"nwse-resize";case W.TOP_RIGHT:case W.BOTTOM_LEFT:return"nesw-resize";case W.TOP:case W.BOTTOM:return"ns-resize";case W.LEFT:case W.RIGHT:return"ew-resize";default:return"default"}}function Ts(e,t,r,n,a,o){if(!o.preserveAspectRatio)return{width:e,height:t};const s=r/n;return[W.TOP_LEFT,W.TOP_RIGHT,W.BOTTOM_LEFT,W.BOTTOM_RIGHT].includes(a)?e/s>t?t=e/s:e=t*s:[W.TOP,W.BOTTOM].includes(a)?e=t*s:[W.LEFT,W.RIGHT].includes(a)&&(t=e/s),{width:e,height:t}}function Es({handler:e,startX:t,startY:r,currentX:n,currentY:a,startWidth:o,startHeight:s,options:i=Te}){const d=n-t,c=a-r;let p=o,f=s;switch(e){case W.TOP_LEFT:p=o-d,f=s-c;break;case W.TOP_RIGHT:p=o+d,f=s-c;break;case W.BOTTOM_LEFT:p=o-d,f=s+c;break;case W.BOTTOM_RIGHT:p=o+d,f=s+c;break;case W.TOP:f=s-c;break;case W.BOTTOM:f=s+c;break;case W.LEFT:p=o-d;break;case W.RIGHT:p=o+d;break;default:return{width:p,height:f}}return{width:p,height:f}=Ts(p,f,o,s,e,i),i.maxWidth&&p>i.maxWidth&&(p=i.maxWidth,i.preserveAspectRatio&&(f=p/(o/s))),i.maxHeight&&f>i.maxHeight&&(f=i.maxHeight,i.preserveAspectRatio&&(p=f*(o/s))),p=Math.max(i.minWidth,Math.min(i.maxWidth||p,p)),f=Math.max(i.minHeight,Math.min(i.maxHeight||f,f)),{width:Math.round(p),height:Math.round(f)}}function Fn(e,{width:t,height:r}){ye(e)&&(e.tagName==="IMG"?(e.style.width=`${t}px`,e.style.height=`${r}px`,e.width=t,e.height=r):e.tagName==="DIV"&&(e.style.width=`${t}px`,e.style.height=`${r}px`))}function ws(e,t,r){Fn(t,r);const n=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(n)}function xs(e,t,r,n){const{ctrlKey:a,metaKey:o,shiftKey:s,key:i}=e,d=a||o,c=r.offsetWidth,p=r.offsetHeight,g={">":d&&s?()=>({width:Math.min(n.maxWidth||800,c+Ze),height:p}):null,"<":d&&s?()=>({width:Math.max(n.minWidth||50,c-Ze),height:p}):null,"+":d&&s?()=>({width:c,height:Math.min(n.maxHeight||600,p+Ze)}):null,"-":d&&s?()=>({width:c,height:Math.max(n.minHeight||50,p-Ze)}):null,r:d&&!s?()=>({width:ys,height:bs}):null}[i];if(g){e.preventDefault();const m=g();return ws(t,r,m),!0}return!1}const Ye=({editorRef:e,onImageResize:t,onImageSelect:r,onImageDeselect:n,resizeOptions:a=Te})=>{const o=l.useRef({overlay:null,image:null,start:null,handler:null,isResizing:!1}),s=l.useRef(a),i=pe();l.useEffect(()=>{s.current=a},[a]);const d=l.useCallback(v=>{if(!ye(v))return;o.current.overlay&&(Ue(o.current.overlay),o.current.overlay=null),v.classList.add("selected");const _=xn(v,s.current);_&&(o.current.overlay=_,o.current.image=v,document.body.appendChild(_),_.querySelectorAll(".resize-handler").forEach(O=>{O.addEventListener("mousedown",p)}),r&&r(v))},[r]),c=l.useCallback(()=>{o.current.image&&(o.current.image.classList.remove("selected"),o.current.image=null),o.current.overlay&&(Ue(o.current.overlay),o.current.overlay=null),o.current.start=null,o.current.handler=null,o.current.isResizing=!1,n&&n()},[n]),p=l.useCallback(v=>{if(v.preventDefault(),v.stopPropagation(),!o.current.image)return;const _=v.currentTarget.dataset.handler,N=o.current.image.getBoundingClientRect(),O=window.pageYOffset||document.documentElement.scrollTop,E=window.pageXOffset||document.documentElement.scrollLeft;o.current.start={x:v.clientX,y:v.clientY,width:o.current.image.offsetWidth,height:o.current.image.offsetHeight,originalWidth:o.current.image.offsetWidth,originalHeight:o.current.image.offsetHeight,offsetX:v.clientX-N.left-E,offsetY:v.clientY-N.top-O},o.current.handler=_,o.current.isResizing=!0,document.body.classList.add("resize-in-progress"),document.body.style.cursor=vs(_),document.addEventListener("mousemove",f),document.addEventListener("mouseup",g)},[]),f=l.useCallback(v=>{if(!o.current.isResizing||!o.current.image||!o.current.start||!o.current.handler)return;v.preventDefault(),v.stopPropagation();const{x:_,y:N,width:O,height:E}=o.current.start,y=o.current.handler,x=v.clientX,q=v.clientY,P=Es({handler:y,startX:_,startY:N,currentX:x,currentY:q,startWidth:O,startHeight:E,options:s.current});Fn(o.current.image,P),o.current.overlay&&Fe(o.current.overlay,o.current.image)},[]),g=l.useCallback(v=>{if(o.current.isResizing){if(v.preventDefault(),v.stopPropagation(),o.current.image&&o.current.start){const _={width:o.current.start.originalWidth,height:o.current.start.originalHeight},N={width:o.current.image.offsetWidth,height:o.current.image.offsetHeight};(_.width!==N.width||_.height!==N.height)&&i.recordOperation({type:"IMAGE_RESIZE",payload:{element:o.current.image,state:N}},{type:"IMAGE_RESIZE",payload:{element:o.current.image,state:_}})}if(o.current.start=null,o.current.handler=null,o.current.isResizing=!1,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g),document.body.classList.remove("resize-in-progress"),document.body.style.cursor="",o.current.image){const _=new Event("input",{bubbles:!0,cancelable:!0});o.current.image.dispatchEvent(_),t&&t(o.current.image,{width:o.current.image.offsetWidth,height:o.current.image.offsetHeight})}}},[t,i]),m=l.useCallback(v=>{o.current.overlay&&!o.current.overlay.contains(v.target)&&c();const _=v.target;if(ye(_)){if(_===o.current.image)return;d(_)}},[d,c]),b=l.useCallback(v=>{if((v.key==="Delete"||v.key==="Backspace")&&o.current.image&&!o.current.isResizing){v.preventDefault();const _=o.current.image;if(_.parentNode){_.parentNode.removeChild(_),c();const N=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(N)}}v.key==="Escape"&&o.current.image&&c(),o.current.image&&!o.current.isResizing&&xs(v,e,o.current.image,s.current)},[e,c]),T=l.useCallback(()=>{o.current.overlay&&o.current.image&&Fe(o.current.overlay,o.current.image)},[]);return l.useEffect(()=>{if(!e.current)return;const _=e.current.closest(".editor-viewport");return _&&(_.addEventListener("scroll",T),window.addEventListener("scroll",T)),()=>{_&&_.removeEventListener("scroll",T),window.removeEventListener("scroll",T)}},[e,T]),l.useEffect(()=>{if(!e.current)return;const v=e.current;return v.addEventListener("click",m),v.addEventListener("keydown",b),window.addEventListener("resize",T),()=>{v.removeEventListener("click",m),v.removeEventListener("keydown",b),window.removeEventListener("resize",T),o.current.isResizing&&(document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g),document.body.classList.remove("resize-in-progress"),document.body.style.cursor=""),o.current.overlay&&Ue(o.current.overlay)}},[e,m,b,T,f,g]),l.useEffect(()=>{if(!e.current)return;const v=new MutationObserver(_=>{_.forEach(N=>{N.type==="childList"&&N.removedNodes.forEach(O=>{O.nodeType===Node.ELEMENT_NODE&&ye(O)&&O===o.current.image&&c()})})});return v.observe(e.current,{childList:!0,subtree:!0}),()=>v.disconnect()},[e,c,d]),null};Ye.propTypes={editorRef:w.shape({current:w.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onImageResize:w.func,onImageSelect:w.func,onImageDeselect:w.func,resizeOptions:w.shape({minWidth:w.number,minHeight:w.number,maxWidth:w.number,maxHeight:w.number,aspectRatio:w.bool,preserveAspectRatio:w.bool,defaultWidth:w.number,defaultHeight:w.number})},Ye.defaultProps={onImageResize:void 0,onImageSelect:void 0,onImageDeselect:void 0,resizeOptions:Te};const Un={border:"1px solid #ccc",borderRadius:"4px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"28px",height:"28px"},Cs={...Un,background:"transparent",color:"#dc3545",borderColor:"#dc3545"},Nt=e=>({...Un,background:e?"#007bff":"transparent",color:e?"#fff":"#333"}),Ot=({imageElement:e,onAlignChange:t,onAspectRatioToggle:r,onDelete:n,onClose:a,initialPreserveAspectRatio:o=!0})=>{const[s,i]=l.useState({top:0,left:0}),[d,c]=l.useState(!1),[p,f]=l.useState("top"),[g,m]=l.useState(o),b=l.useRef(null),T=pe(),v=k=>{k&&requestAnimationFrame(()=>{const I=document.querySelector(".image-resize-overlay");I&&Fe(I,k)})},_=k=>{if(!k)return null;const I=window.getComputedStyle(k);return{float:I.float||"none",margin:k.style.margin||"",display:I.display||"inline",width:k.style.width||k.width||"",height:k.style.height||k.height||"",aspectRatio:g}},N=l.useCallback(()=>{if(!e)return"left";const k=window.getComputedStyle(e);return k.float==="right"?"right":k.float==="left"?"left":k.display==="block"&&k.margin.includes("auto")?"center":"left"},[e]),[O,E]=l.useState("left");l.useEffect(()=>{e&&E(N())},[e,N]);const y=l.useCallback(()=>{if(!e||!b.current)return;const k=e.getBoundingClientRect(),I=b.current.getBoundingClientRect(),B=window.innerWidth,$=window.innerHeight,F=k.bottom>=0&&k.top<=$&&k.right>=0&&k.left<=B;let A="top",L=0,K=0;if(F){const C=k.top-I.height-10,u=$-k.bottom-I.height-10;u>C&&u>0?(A="bottom",L=k.bottom+10):(A="top",L=k.top-I.height-10)}else A="top",L=10;K=k.left+k.width/2-I.width/2;let ne=Math.max(10,Math.min(K,B-I.width-10)),re=Math.max(10,Math.min(L,$-I.height-10));i({top:re,left:ne}),f(A),c(!0)},[e]);l.useLayoutEffect(()=>{y();const k=()=>{y()};return window.addEventListener("scroll",k),window.addEventListener("resize",k),()=>{window.removeEventListener("scroll",k),window.removeEventListener("resize",k),c(!1)}},[e,y]),l.useEffect(()=>{const k=I=>{b.current&&!b.current.contains(I.target)&&I.target!==e&&a()};return document.addEventListener("mousedown",k),()=>{document.removeEventListener("mousedown",k)}},[e,a]);const x={left:{float:"left",margin:"0 10px 10px 0",display:"block"},center:{float:"none",margin:"10px auto",display:"block"},right:{float:"right",margin:"0 0 10px 10px",display:"block"}},q=k=>{if(e&&x[k]){const I=_(e),B=O,$=x[k];e.style.float=$.float,e.style.margin=$.margin,e.style.display=$.display,E(k),v(e);const F=_(e);T.recordOperation({type:"IMAGE_ALIGN",payload:{element:e,alignment:k,state:F}},{type:"IMAGE_ALIGN",payload:{element:e,alignment:B,state:I}}),t&&t(k)}},P=()=>{if(e&&e.parentNode){const k={element:e,parent:e.parentNode,nextSibling:e.nextSibling};T.recordOperation({type:"IMAGE_DELETE",payload:{element:e}},{type:"IMAGE_REINSERT",payload:{state:k}}),e.parentNode.removeChild(e),n&&n(),a()}},z=()=>{const k=g,I=!g;m(I),T.recordOperation({type:"IMAGE_ASPECT_RATIO",payload:{element:e,preserveAspectRatio:I}},{type:"IMAGE_ASPECT_RATIO",payload:{element:e,preserveAspectRatio:k}}),r&&r(I)};return!e||typeof document>"u"?null:Wt.createPortal(h.jsxs("div",{ref:b,className:"image-tooltip-menu","data-menu-position":p,"aria-hidden":!d,style:{position:"fixed",top:`${s.top}px`,left:`${s.left}px`,zIndex:999,background:"#fff",border:"1px solid #ddd",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"8px",display:"flex",gap:"2px",alignItems:"center",pointerEvents:d?"auto":"none",minWidth:"140px",minHeight:"32px",opacity:d?1:0,visibility:d?"visible":"hidden",transition:"opacity 0.15s ease, visibility 0.15s ease"},children:[h.jsx("button",{className:`tooltip-button aspect-ratio-toggle ${g?"":"active"}`,onClick:z,title:`Toggle aspect ratio preservation (currently ${g?"ON":"OFF"})`,children:g?h.jsx(Yo,{size:14}):h.jsx(Bo,{size:14})}),h.jsx("button",{className:`tooltip-button ${O==="left"?"active":""}`,onClick:()=>q("left"),title:"Align Left",style:Nt(O==="left"),children:h.jsx(xt,{size:14})}),h.jsx("button",{className:`tooltip-button ${O==="center"?"active":""}`,onClick:()=>q("center"),title:"Align Center",style:Nt(O==="center"),children:h.jsx(Et,{size:14})}),h.jsx("button",{className:`tooltip-button ${O==="right"?"active":""}`,onClick:()=>q("right"),title:"Align Right",style:Nt(O==="right"),children:h.jsx(wt,{size:14})}),h.jsx("button",{className:"tooltip-button delete-button",onClick:P,title:"Delete Image",style:Cs,children:h.jsx(Ct,{size:14})})]}),document.body)};Ot.propTypes={imageElement:w.instanceOf(typeof Element<"u"?Element:Object),onAlignChange:w.func,onAspectRatioToggle:w.func,onDelete:w.func,onClose:w.func.isRequired,initialPreserveAspectRatio:w.bool},Ot.defaultProps={imageElement:null,onAlignChange:void 0,onAspectRatioToggle:void 0,onDelete:void 0,initialPreserveAspectRatio:!0};const Le={minColumnWidth:10,minRowHeight:8,maxColumnWidth:800,maxRowHeight:600,tableMinWidth:100,tableMinHeight:50,tableMaxWidth:1200,tableMaxHeight:800},se={COLUMN:"column",ROW:"row",TABLE_BOTTOM:"table-bottom",TABLE_RIGHT:"table-right"};function ie(e){return e?e.tagName==="TABLE":!1}function ce(e){if(!ie(e))return null;const t=e.getBoundingClientRect(),r=Array.from(e.rows),n=r.length>0?r[0].cells.length:0,a=[],o=e.querySelector("colgroup"),s=o?o.querySelectorAll("col"):[];if(s.length>=n)for(let d=0;d<n;d++){const c=s[d],p=c.style.width?parseInt(c.style.width,10):c.offsetWidth;a.push(p||100)}else if(r.length>0){const d=r[0];for(let c=0;c<d.cells.length;c++){const p=d.cells[c];a.push(p.offsetWidth)}}const i=r.map(d=>(d.style.height?parseInt(d.style.height,10):null)||d.offsetHeight);return{width:t.width,height:t.height,columns:n,rows:r.length,columnWidths:a,rowHeights:i,rect:t}}function qn({type:e,index:t,delta:r,currentStructure:n,options:a=Le}){const o={columnWidths:[...n.columnWidths],rowHeights:[...n.rowHeights],tableWidth:n.width,tableHeight:n.height},s=(i,d,c,p,f)=>{d>=0&&d<i.length&&(i[d]=Math.max(p,Math.min(f,i[d]+c)))};switch(e){case se.COLUMN:s(o.columnWidths,t,r,a.minColumnWidth,a.maxColumnWidth),o.tableWidth=n.width;break;case se.ROW:s(o.rowHeights,t,r,a.minRowHeight,a.maxRowHeight),o.tableHeight=n.height;break;case se.TABLE_BOTTOM:s(o.rowHeights,n.rows-1,r,a.minRowHeight,a.maxRowHeight);break;case se.TABLE_RIGHT:s(o.columnWidths,n.columns-1,r,a.minColumnWidth,a.maxColumnWidth);break}return o}function ge(e){if(!ie(e))return;const t=Array.from(e.rows);if(t.length===0)return;const r=t[0].cells.length;let n=e.querySelector("colgroup");n||(n=document.createElement("colgroup"),e.insertBefore(n,e.firstChild));const a=n.querySelectorAll("col"),o=a.length;if(o<r)for(let s=o;s<r;s++){const i=document.createElement("col");n.appendChild(i)}else if(o>r)for(let s=o-1;s>=r;s--)n.removeChild(a[s])}function be(e,t,r){if(!ie(e))return;ge(e);const{columnWidths:n,rowHeights:a,tableWidth:o,tableHeight:s}=t,i=n?n.reduce((c,p)=>c+p,0):0,d=a?a.reduce((c,p)=>c+p,0):0;if(o!==void 0?e.style.width=`${o}px`:i>0&&(e.style.width=`${i}px`),s!==void 0?e.style.height=`${s}px`:d>0&&(e.style.height=`${d}px`),n&&n.length>0){e.style.tableLayout="fixed";const c=e.querySelector("colgroup");c&&c.querySelectorAll("col").forEach((f,g)=>{g<n.length&&(f.style.width=`${n[g]}px`)}),e.style.width=`${i}px`}a&&a.length>0&&(Array.from(e.rows).forEach((p,f)=>{f<a.length&&(p.style.height=`${a[f]}px`)}),e.style.height=`${d}px`),e.offsetHeight}function Wn(e,t=Le){if(!ie(e))return null;ge(e);const r=ce(e);if(!r)return null;const n=document.createElement("div");n.className="table-resize-overlay",n.style.position="fixed",n.style.zIndex="1000",n.style.pointerEvents="none";const a=e.getBoundingClientRect();n.style.top=`${a.top}px`,n.style.left=`${a.left}px`,n.style.width=`${a.width}px`,n.style.height=`${a.height}px`;for(let i=0;i<r.columns-1;i++){const d=Gn(i,r,a,e);n.appendChild(d)}for(let i=0;i<r.rows-1;i++){const d=Zn(i,r,a,e);n.appendChild(d)}const o=Yn(r,a);n.appendChild(o);const s=Vn(r,a);return n.appendChild(s),n}function Gn(e,t,r,n){const a=document.createElement("div");return a.className="table-resize-handler table-column-resize-handler",a.dataset.type=se.COLUMN,a.dataset.index=e,a.style.position="absolute",a.style.width="4px",a.style.height=`${r.height}px`,a.style.cursor="col-resize",a.style.pointerEvents="all",Kn(a,e,t,r,n),a}function Zn(e,t,r,n){const a=document.createElement("div");return a.className="table-resize-handler table-row-resize-handler",a.dataset.type=se.ROW,a.dataset.index=e,a.style.position="absolute",a.style.width=`${r.width}px`,a.style.height="4px",a.style.cursor="row-resize",a.style.pointerEvents="all",Xn(a,e,t,r,n),a}function Yn(e,t){const r=document.createElement("div");return r.className="table-resize-handler table-bottom-resize-handler",r.dataset.type=se.TABLE_BOTTOM,r.style.position="absolute",r.style.width=`${t.width}px`,r.style.height="4px",r.style.cursor="ns-resize",r.style.pointerEvents="all",Jn(r,e,t),r}function Vn(e,t){const r=document.createElement("div");return r.className="table-resize-handler table-right-resize-handler",r.dataset.type=se.TABLE_RIGHT,r.style.position="absolute",r.style.width="4px",r.style.height=`${t.height}px`,r.style.cursor="ew-resize",r.style.pointerEvents="all",Qn(r,e,t),r}function Ve(e,t){if(!e||!t)return;ge(t);const r=ce(t);if(!r)return;const n=t.getBoundingClientRect();e.style.top=`${n.top}px`,e.style.left=`${n.left}px`,e.style.width=`${n.width}px`,e.style.height=`${n.height}px`;const a=e.querySelectorAll(".table-column-resize-handler"),o=e.querySelectorAll(".table-row-resize-handler"),s=e.querySelector(".table-bottom-resize-handler"),i=e.querySelector(".table-right-resize-handler");if(a.length!==r.columns-1||o.length!==r.rows-1||!s||!i){e.innerHTML="";for(let f=0;f<r.columns-1;f++){const g=Gn(f,r,n,t);e.appendChild(g)}for(let f=0;f<r.rows-1;f++){const g=Zn(f,r,n,t);e.appendChild(g)}const c=Yn(r,n);e.appendChild(c);const p=Vn(r,n);e.appendChild(p)}else a.forEach((c,p)=>{Kn(c,p,r,n,t)}),o.forEach((c,p)=>{Xn(c,p,r,n,t)}),s&&Jn(s,r,n),i&&Qn(i,r,n)}function Re(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function As(e,t){if(!ie(e))return console.warn("insertRowAbove: Invalid table element"),null;if(t<0||t>e.rows.length)return console.warn(`insertRowAbove: Invalid row index ${t}, table has ${e.rows.length} rows`),null;const r=e.rows[t];if(!r)return console.warn(`insertRowAbove: Could not find reference row at index ${t}`),null;const n=document.createElement("tr"),a=r.cells.length;for(let s=0;s<a;s++){const i=document.createElement("td");i.innerHTML="&nbsp;",n.appendChild(i)}try{r.parentNode.insertBefore(n,r)}catch(s){return console.error("insertRowAbove: Failed to insert row",s),null}ge(e);const o=ce(e);return o&&be(e,{columnWidths:o.columnWidths,rowHeights:o.rowHeights}),n}function _s(e,t){if(!ie(e))return console.warn("insertRowBelow: Invalid table element"),null;if(t<0||t>=e.rows.length)return console.warn(`insertRowBelow: Invalid row index ${t}, table has ${e.rows.length} rows`),null;const r=e.rows[t];if(!r)return console.warn(`insertRowBelow: Could not find reference row at index ${t}`),null;const n=document.createElement("tr"),a=r.cells.length;for(let i=0;i<a;i++){const d=document.createElement("td");d.innerHTML="&nbsp;",n.appendChild(d)}const o=r.nextSibling;try{o?r.parentNode.insertBefore(n,o):r.parentNode.appendChild(n)}catch(i){return console.error("insertRowBelow: Failed to insert row",i),null}ge(e);const s=ce(e);return s&&be(e,{columnWidths:s.columnWidths,rowHeights:s.rowHeights}),n}function Kn(e,t,r,n,a){if(a&&a.rows.length>0){const s=a.rows[0];if(s.cells.length>t){const d=s.cells[t].getBoundingClientRect(),c=a.getBoundingClientRect(),p=d.right-c.left-2;e.style.left=`${p}px`,e.style.height=`${n.height}px`;return}}let o=0;for(let s=0;s<=t;s++)o+=r.columnWidths[s];e.style.left=`${o-2}px`,e.style.height=`${n.height}px`}function Xn(e,t,r,n,a){if(a&&a.rows.length>t){const s=a.rows[t];if(s.cells.length>0){const d=s.cells[0].getBoundingClientRect(),c=a.getBoundingClientRect(),p=d.bottom-c.top-2;e.style.top=`${p}px`,e.style.width=`${n.width}px`;return}}let o=0;for(let s=0;s<=t;s++)o+=r.rowHeights[s];e.style.top=`${o-2}px`,e.style.width=`${n.width}px`}function Jn(e,t,r){e.style.bottom="-2px",e.style.left="0px",e.style.width=`${r.width}px`}function Qn(e,t,r){e.style.right="-2px",e.style.top="0px",e.style.height=`${r.height}px`}function ks(e,t){if(!ie(e))return console.warn("insertColumnLeft: Invalid table element"),!1;if(t<0)return console.warn(`insertColumnLeft: Invalid column index ${t}`),!1;const r=Array.from(e.rows);if(r.length===0)return console.warn("insertColumnLeft: Table has no rows"),!1;if(t>r[0].cells.length)return console.warn(`insertColumnLeft: Column index ${t} out of bounds`),!1;try{for(const a of r){const o=document.createElement("td");o.innerHTML="&nbsp;",t<a.cells.length?a.insertBefore(o,a.cells[t]):a.appendChild(o)}ge(e);const n=ce(e);return n&&be(e,{columnWidths:n.columnWidths,rowHeights:n.rowHeights}),!0}catch(n){return console.error("insertColumnLeft: Failed to insert column",n),!1}}function Ss(e,t){if(!ie(e))return console.warn("insertColumnRight: Invalid table element"),!1;if(t<0)return console.warn(`insertColumnRight: Invalid column index ${t}`),!1;const r=Array.from(e.rows);if(r.length===0)return console.warn("insertColumnRight: Table has no rows"),!1;if(t>=r[0].cells.length)return console.warn(`insertColumnRight: Column index ${t} out of bounds`),!1;try{for(const a of r){const o=document.createElement("td");o.innerHTML="&nbsp;";const s=a.cells[t+1];s?a.insertBefore(o,s):a.appendChild(o)}ge(e);const n=ce(e);return n&&be(e,{columnWidths:n.columnWidths,rowHeights:n.rowHeights}),!0}catch(n){return console.error("insertColumnRight: Failed to insert column",n),!1}}function Ns(e,t){if(!ie(e))return console.warn("deleteRow: Invalid table element"),!1;if(t<0||t>=e.rows.length)return console.warn(`deleteRow: Invalid row index ${t}, table has ${e.rows.length} rows`),!1;if(e.rows.length<=1)return console.warn("deleteRow: Cannot delete the last row in the table"),!1;try{const r=e.rows[t];r.parentNode.removeChild(r),ge(e);const n=ce(e);return n&&be(e,{columnWidths:n.columnWidths,rowHeights:n.rowHeights}),!0}catch(r){return console.error("deleteRow: Failed to delete row",r),!1}}function Os(e,t){if(!ie(e))return console.warn("deleteColumn: Invalid table element"),!1;if(t<0)return console.warn(`deleteColumn: Invalid column index ${t}`),!1;const r=Array.from(e.rows);if(r.length===0)return console.warn("deleteColumn: Table has no rows"),!1;if(t>=r[0].cells.length)return console.warn(`deleteColumn: Column index ${t} out of bounds`),!1;if(r[0].cells.length<=1)return console.warn("deleteColumn: Cannot delete the last column in the table"),!1;try{for(const a of r)a.cells.length>t&&a.removeChild(a.cells[t]);ge(e);const n=ce(e);return n&&be(e,{columnWidths:n.columnWidths,rowHeights:n.rowHeights}),!0}catch(n){return console.error("deleteColumn: Failed to delete column",n),!1}}const Ke=({editorRef:e,onTableResize:t,onTableSelect:r,onTableDeselect:n,resizeOptions:a=Le})=>{const o=l.useRef(null),s=l.useRef(null),i=l.useRef(null),d=l.useRef(null),c=l.useRef(null),p=l.useRef(a),f=l.useRef(!1),[g,m]=l.useState(null),b=pe();l.useEffect(()=>{p.current=a},[a]);const T=l.useCallback(()=>{s.current&&(s.current.classList.remove("selected"),s.current=null),o.current&&(Re(o.current),o.current=null),m(null),i.current=null,d.current=null,c.current=null,f.current=!1,n&&n()},[n]),v=l.useCallback(P=>{if(P.preventDefault(),P.stopPropagation(),!s.current)return;const z=P.currentTarget,k=z.dataset.type,I=parseInt(z.dataset.index,10);s.current.getBoundingClientRect(),window.pageYOffset||document.documentElement.scrollTop,window.pageXOffset||document.documentElement.scrollLeft;const B=ce(s.current);i.current={x:P.clientX,y:P.clientY,structure:{...B}},d.current=k,c.current=I,f.current=!0,document.body.classList.add("table-resize-in-progress");const $={[se.COLUMN]:"col-resize",[se.ROW]:"row-resize",[se.TABLE_BOTTOM]:"ns-resize",[se.TABLE_RIGHT]:"ew-resize"};document.body.style.cursor=$[k]||"default",document.addEventListener("mousemove",O),document.addEventListener("mouseup",E)},[]),_=l.useCallback(P=>{const z=Wn(P,p.current);return z&&(o.current=z,s.current=P,document.body.appendChild(z),z.querySelectorAll(".table-resize-handler").forEach(I=>{I.addEventListener("mousedown",v)})),z},[v]),N=l.useCallback(P=>{if(!ie(P))return;o.current&&(Re(o.current),o.current=null),P.classList.add("selected"),_(P)&&(m(P),r&&r(P))},[r,_]),O=l.useCallback(P=>{if(!f.current||!s.current||!i.current||!d.current)return;P.preventDefault(),P.stopPropagation();const{x:z,y:k,structure:I}=i.current,B=d.current,$=c.current,F=P.clientX,A=P.clientY;let L=0;switch(B){case se.COLUMN:L=F-z;break;case se.ROW:L=A-k;break;case se.TABLE_BOTTOM:L=A-k;break;case se.TABLE_RIGHT:L=F-z;break}const K=qn({type:B,index:$,delta:L,currentStructure:I,options:p.current});be(s.current,K),o.current&&Ve(o.current,s.current)},[]),E=l.useCallback(P=>{if(f.current){if(P.preventDefault(),P.stopPropagation(),s.current&&i.current){const z={structure:i.current.structure},k={structure:ce(s.current)};(z.structure.width!==k.structure.width||z.structure.height!==k.structure.height||JSON.stringify(z.structure.columnWidths)!==JSON.stringify(k.structure.columnWidths)||JSON.stringify(z.structure.rowHeights)!==JSON.stringify(k.structure.rowHeights))&&b.recordOperation({type:"TABLE_RESIZE",payload:{element:s.current,state:k}},{type:"TABLE_RESIZE",payload:{element:s.current,state:z}})}if(i.current=null,d.current=null,c.current=null,f.current=!1,document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",E),document.body.classList.remove("table-resize-in-progress"),document.body.style.cursor="",s.current){const z=new Event("input",{bubbles:!0,cancelable:!0});s.current.dispatchEvent(z),t&&t(s.current,ce(s.current))}}},[t,b]),y=l.useCallback(P=>{o.current&&!o.current.contains(P.target)&&T();const k=P.target.closest("table");if(k&&ie(k)){if(k===s.current)return;N(k)}},[N,T]),x=l.useCallback(P=>{if(P.key==="Delete"&&s.current&&!f.current){P.preventDefault();const z=s.current;if(z.parentNode){z.parentNode.removeChild(z),T();const k=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(k)}}P.key==="Escape"&&s.current&&T()},[e,T]),q=l.useCallback(()=>{o.current&&s.current&&Ve(o.current,s.current)},[]);return l.useEffect(()=>{if(!e.current)return;const z=e.current.closest(".editor-viewport");return z&&(z.addEventListener("scroll",q),window.addEventListener("scroll",q)),()=>{z&&z.removeEventListener("scroll",q),window.removeEventListener("scroll",q)}},[e,q]),l.useEffect(()=>{if(!e.current)return;const P=e.current;return P.addEventListener("click",y),P.addEventListener("keydown",x),window.addEventListener("resize",q),()=>{P.removeEventListener("click",y),P.removeEventListener("keydown",x),window.removeEventListener("resize",q),f.current&&(document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",E),document.body.classList.remove("table-resize-in-progress"),document.body.style.cursor=""),o.current&&Re(o.current)}},[e,y,x,q,O,E]),l.useEffect(()=>{if(!e.current)return;const P=new MutationObserver(z=>{z.forEach(k=>{k.type==="childList"&&(k.removedNodes.forEach(I=>{I.nodeType===Node.ELEMENT_NODE&&ie(I)&&I===g&&T()}),k.addedNodes.forEach(I=>{if(I.nodeType!==Node.ELEMENT_NODE)return;if(ie(I)){setTimeout(()=>N(I),50);return}const B=I.querySelectorAll?.("table")||[];B.length>0&&setTimeout(()=>N(B[0]),50)}))})});return P.observe(e.current,{childList:!0,subtree:!0}),()=>P.disconnect()},[e,T,N]),l.useEffect(()=>{if(!g)return;const P=new MutationObserver(z=>{z.some(I=>{if(I.type==="childList"){if([...I.addedNodes,...I.removedNodes].some($=>$.nodeType===Node.ELEMENT_NODE&&$.tagName==="TR"))return!0}else if(I.type==="attributes"&&["colspan","rowspan"].includes(I.attributeName))return!0;return!1})&&o.current&&s.current&&(Re(o.current),o.current=null,_(s.current))});return P.observe(g,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["colspan","rowspan"]}),()=>P.disconnect()},[g,_]),null};Ke.propTypes={editorRef:w.shape({current:w.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onTableResize:w.func,onTableSelect:w.func,onTableDeselect:w.func,resizeOptions:w.shape({minColumnWidth:w.number,minRowHeight:w.number,maxColumnWidth:w.number,maxRowHeight:w.number,tableMinWidth:w.number,tableMinHeight:w.number,tableMaxWidth:w.number,tableMaxHeight:w.number})},Ke.defaultProps={onTableResize:void 0,onTableSelect:void 0,onTableDeselect:void 0,resizeOptions:Le};const Pt=({tableElement:e,onAlignChange:t,onClose:r,selectedRowIndex:n,selectedColIndex:a,editorRef:o})=>{const[s,i]=l.useState({top:0,left:0}),[d,c]=l.useState(!1),[p,f]=l.useState("top"),g=l.useRef(null),m=l.useRef(null),b=pe(),T=A=>{if(!A)return;(typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame:K=>setTimeout(K,16))(()=>{const K=document.querySelector(".table-resize-overlay");K&&Ve(K,A)})},v=A=>{if(!A)return null;const L=window.getComputedStyle(A);return{float:L.float||"none",margin:A.style.margin||"",marginLeft:A.style.marginLeft||"",marginRight:A.style.marginRight||"",display:L.display||"table"}},_=l.useCallback(()=>{if(!e)return"left";const A=window.getComputedStyle(e);return A.marginLeft==="auto"&&A.marginRight==="auto"?"center":A.float==="right"?"right":(A.float==="left","left")},[e]),[N,O]=l.useState("left");l.useEffect(()=>{e&&O(_())},[e,_]);const E=l.useCallback(()=>{if(!e||!g.current)return;const A=e.getBoundingClientRect(),L=g.current.getBoundingClientRect(),K=window.visualViewport?window.visualViewport:{width:window.innerWidth,height:window.innerHeight},ne=A.bottom>=0&&A.top<=K.height&&A.right>=0&&A.left<=K.width;let re="top",C=0,u=0;if(ne){const G=A.top-L.height-10,R=K.height-A.bottom-L.height-10;R>G&&R>0?(re="bottom",C=A.bottom+10):(re="top",C=A.top-L.height-10)}else re="top",C=10;u=A.left+A.width/2-L.width/2;const M=window.innerWidth,H=window.innerHeight;let j=Math.max(10,Math.min(u,M-L.width-10)),Z=Math.max(10,Math.min(C,H-L.height-10));i({top:Z,left:j}),f(re),c(!0)},[e]);l.useLayoutEffect(()=>{E();const A=()=>{E()},L=m.current;return L&&L.addEventListener("scroll",A),window.addEventListener("scroll",A),window.addEventListener("resize",A),()=>{L&&L.removeEventListener("scroll",A),window.removeEventListener("scroll",A),window.removeEventListener("resize",A),c(!1)}},[e,E]),l.useEffect(()=>{const A=L=>{g.current&&!g.current.contains(L.target)&&L.target!==e&&!e.contains(L.target)&&r()};return document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)}},[e,r]);const y={left:{float:"left",margin:"10px 10px 10px 0",marginLeft:"",marginRight:""},center:{float:"none",margin:"10px auto",marginLeft:"auto",marginRight:"auto"},right:{float:"right",margin:"10px 0 10px 10px",marginLeft:"",marginRight:""}},x=A=>{if(e&&y[A]){const L=v(e),K=N,ne=y[A];e.style.float=ne.float,e.style.margin=ne.margin,e.style.marginLeft=ne.marginLeft,e.style.marginRight=ne.marginRight,O(A),T(e);const re=v(e);b.recordOperation({type:"TABLE_ALIGN",payload:{element:e,alignment:A,state:re}},{type:"TABLE_ALIGN",payload:{element:e,alignment:K,state:L}}),t&&t(A)}},q=()=>{if(console.log("handleInsertRowAbove called",{selectedRowIndex:n,tableElement:e,hasEditorRef:!!o}),!e){console.warn("handleInsertRowAbove: No table element");return}if(n==null){console.warn("handleInsertRowAbove: No row selected");return}console.log(`Inserting row above index ${n}`);const A=As(e,n);if(A){if(console.log("Row inserted successfully, updating content"),o&&o.current){const L=o.current.innerHTML;console.log("Updated content length:",L.length),b.updateContinuousContent(L)}else console.warn("No editor ref available to update content");b.recordOperation({type:"INSERT_ROW",payload:{element:e,row:A,position:"above",index:n}},{type:"DELETE_ROW",payload:{element:e,index:n}}),T(e),requestAnimationFrame(()=>E())}else console.error("Failed to insert row above")},P=()=>{if(console.log("handleInsertRowBelow called",{selectedRowIndex:n,tableElement:e,hasEditorRef:!!o}),!e){console.warn("handleInsertRowBelow: No table element");return}if(n==null){console.warn("handleInsertRowBelow: No row selected");return}console.log(`Inserting row below index ${n}`);const A=_s(e,n);if(A){if(console.log("Row inserted successfully, updating content"),o&&o.current){const L=o.current.innerHTML;console.log("Updated content length:",L.length),b.updateContinuousContent(L)}else console.warn("No editor ref available to update content");b.recordOperation({type:"INSERT_ROW",payload:{element:e,row:A,position:"below",index:n}},{type:"DELETE_ROW",payload:{element:e,index:n+1}}),T(e),requestAnimationFrame(()=>E())}else console.error("Failed to insert row below")},z=()=>{if(console.log("handleInsertColumnLeft called",{selectedColIndex:a,tableElement:e,hasEditorRef:!!o}),!e){console.warn("handleInsertColumnLeft: No table element");return}if(a==null){console.warn("handleInsertColumnLeft: No column selected");return}if(console.log(`Inserting column left of index ${a}`),ks(e,a)){if(console.log("Column inserted successfully, updating content"),o&&o.current){const L=o.current.innerHTML;console.log("Updated content length:",L.length),b.updateContinuousContent(L)}else console.warn("No editor ref available to update content");b.recordOperation({type:"INSERT_COLUMN",payload:{element:e,position:"left",index:a}},{type:"DELETE_COLUMN",payload:{element:e,index:a}}),T(e),requestAnimationFrame(()=>E())}else console.error("Failed to insert column left")},k=()=>{if(console.log("handleInsertColumnRight called",{selectedColIndex:a,tableElement:e,hasEditorRef:!!o}),!e){console.warn("handleInsertColumnRight: No table element");return}if(a==null){console.warn("handleInsertColumnRight: No column selected");return}if(console.log(`Inserting column right of index ${a}`),Ss(e,a)){if(console.log("Column inserted successfully, updating content"),o&&o.current){const L=o.current.innerHTML;console.log("Updated content length:",L.length),b.updateContinuousContent(L)}else console.warn("No editor ref available to update content");b.recordOperation({type:"INSERT_COLUMN",payload:{element:e,position:"right",index:a}},{type:"DELETE_COLUMN",payload:{element:e,index:a+1}}),T(e),requestAnimationFrame(()=>E())}else console.error("Failed to insert column right")},I=()=>{if(console.log("handleDeleteRow called",{selectedRowIndex:n,tableElement:e,hasEditorRef:!!o}),!e){console.warn("handleDeleteRow: No table element");return}if(n==null){console.warn("handleDeleteRow: No row selected");return}if(console.log(`Deleting row at index ${n}`),Ns(e,n)){if(console.log("Row deleted successfully, updating content"),o&&o.current){const L=o.current.innerHTML;console.log("Updated content length:",L.length),b.updateContinuousContent(L)}else console.warn("No editor ref available to update content");b.recordOperation({type:"DELETE_ROW",payload:{element:e,index:n}},{type:"INSERT_ROW",payload:{element:e,position:"at",index:n}}),T(e),requestAnimationFrame(()=>E())}else console.error("Failed to delete row")},B=()=>{if(console.log("handleDeleteColumn called",{selectedColIndex:a,tableElement:e,hasEditorRef:!!o}),!e){console.warn("handleDeleteColumn: No table element");return}if(a==null){console.warn("handleDeleteColumn: No column selected");return}if(console.log(`Deleting column at index ${a}`),Os(e,a)){if(console.log("Column deleted successfully, updating content"),o&&o.current){const L=o.current.innerHTML;console.log("Updated content length:",L.length),b.updateContinuousContent(L)}else console.warn("No editor ref available to update content");b.recordOperation({type:"DELETE_COLUMN",payload:{element:e,index:a}},{type:"INSERT_COLUMN",payload:{element:e,position:"at",index:a}}),T(e),requestAnimationFrame(()=>E())}else console.error("Failed to delete column")},$={border:"1px solid #ccc",borderRadius:"4px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"28px",height:"28px"},F=A=>({...$,background:A?"#007bff":"transparent",color:A?"#fff":"#333"});return!e||typeof document>"u"?null:Wt.createPortal(h.jsxs("div",{ref:g,className:"table-tooltip-menu","data-menu-position":p,"aria-hidden":!d,style:{position:"fixed",top:`${s.top}px`,left:`${s.left}px`,zIndex:999,background:"#fff",border:"1px solid #ddd",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"8px",display:"flex",gap:"2px",alignItems:"center",pointerEvents:d?"auto":"none",minWidth:"100px",minHeight:"32px",opacity:d?1:0,visibility:d?"visible":"hidden",transition:"opacity 0.15s ease, visibility 0.15s ease"},children:[h.jsx("button",{className:`tooltip-button ${N==="left"?"active":""}`,onClick:()=>x("left"),title:"Align Left",style:F(N==="left"),children:h.jsx(xt,{size:14})}),h.jsx("button",{className:`tooltip-button ${N==="center"?"active":""}`,onClick:()=>x("center"),title:"Align Center",style:F(N==="center"),children:h.jsx(Et,{size:14})}),h.jsx("button",{className:`tooltip-button ${N==="right"?"active":""}`,onClick:()=>x("right"),title:"Align Right",style:F(N==="right"),children:h.jsx(wt,{size:14})}),n!=null&&h.jsxs(h.Fragment,{children:[h.jsx("div",{style:{width:"1px",height:"24px",background:"#ddd",margin:"0 4px"}}),h.jsx("button",{className:"tooltip-button insert-row-above",onClick:q,title:"Insert Row Above",style:{...$,background:"#28a745",color:"#fff"},disabled:n==null,children:h.jsx(No,{size:14})}),h.jsx("button",{className:"tooltip-button insert-row-below",onClick:P,title:"Insert Row Below",style:{...$,background:"#28a745",color:"#fff"},disabled:n==null,children:h.jsx(_o,{size:14})}),h.jsx("button",{className:"tooltip-button delete-row",onClick:I,title:"Delete Row",style:{...$,background:"#dc3545",color:"#fff"},disabled:n==null,children:h.jsx(Ct,{size:14})})]}),a!=null&&h.jsxs(h.Fragment,{children:[h.jsx("div",{style:{width:"1px",height:"24px",background:"#ddd",margin:"0 4px"}}),h.jsx("button",{className:"tooltip-button insert-column-left",onClick:z,title:"Insert Column Left",style:{...$,background:"#0056b3",color:"#fff"},disabled:a==null,children:h.jsx(ko,{size:14})}),h.jsx("button",{className:"tooltip-button insert-column-right",onClick:k,title:"Insert Column Right",style:{...$,background:"#0056b3",color:"#fff"},disabled:a==null,children:h.jsx(So,{size:14})}),h.jsx("button",{className:"tooltip-button delete-column",onClick:B,title:"Delete Column",style:{...$,background:"#dc3545",color:"#fff"},disabled:a==null,children:h.jsx(Ct,{size:14})})]})]}),document.body)};Pt.propTypes={tableElement:w.instanceOf(typeof Element<"u"?Element:Object),onAlignChange:w.func,onClose:w.func.isRequired,selectedRowIndex:w.number,selectedColIndex:w.number,editorRef:w.shape({current:w.instanceOf(typeof Element<"u"?Element:Object)})},Pt.defaultProps={tableElement:null,onAlignChange:void 0,selectedRowIndex:null,selectedColIndex:null,editorRef:null};const Mt=({editorRef:e,onCellSelectionChange:t})=>{const[r,n]=l.useState(new Set),[a,o]=l.useState(null),[s,i]=l.useState(null),[d,c]=l.useState(null),[p,f]=l.useState(!1),[g,m]=l.useState(!1),[b,T]=l.useState(null),[v,_]=l.useState(null);pe(),l.useRef(null);const N=l.useRef(null),O=l.useCallback(()=>{n(new Set),o(null),i(null),c(null),T(null),_(null),f(!1),m(!1),document.querySelectorAll(".table-cell-selected, .table-row-selected, .table-col-selected").forEach(B=>{B.classList.remove("table-cell-selected","table-row-selected","table-col-selected")}),N.current!==null&&(N.current=null,t&&t(null))},[t]),E=l.useCallback(B=>{const $=B.closest("tr"),F=B.closest("table");if(!$||!F)return null;const A=Array.from(F.rows).indexOf($),L=Array.from($.cells).indexOf(B);return{rowIndex:A,cellIndex:L,table:F}},[]),y=l.useCallback(B=>{if(B.size===0)return{mode:null,rowIndex:null,colIndex:null};const $=Array.from(B),F=$[0],A=E(F);if(!A)return{mode:null,rowIndex:null,colIndex:null};const{table:L}=A;return $.filter(re=>{const C=E(re);return C&&C.table===L&&C.rowIndex===A.rowIndex}).length>=2?{mode:"row",rowIndex:A.rowIndex,colIndex:null}:$.filter(re=>{const C=E(re);return C&&C.table===L&&C.cellIndex===A.cellIndex}).length>=2?{mode:"column",rowIndex:null,colIndex:A.cellIndex}:{mode:null,rowIndex:null,colIndex:null}},[E]),x=l.useCallback((B,$,F,A,L)=>{if(document.querySelectorAll(".table-cell-selected, .table-row-selected, .table-col-selected").forEach(K=>{K.classList.remove("table-cell-selected","table-row-selected","table-col-selected")}),!(!L||!B)){if(B==="row"&&$!==null){const K=L.rows[$];K&&Array.from(K.cells).forEach(ne=>{ne.classList.add("table-row-selected")})}else B==="column"&&F!==null?Array.from(L.rows).forEach(K=>{const ne=K.cells[F];ne&&ne.classList.add("table-col-selected")}):B==="cells"&&A.forEach(K=>{K.classList.add("table-cell-selected")});window.getSelection&&window.getSelection().removeAllRanges()}},[]),q=l.useCallback((B,$)=>{const F=y(B);n(B),o(F.mode),i(F.rowIndex),c(F.colIndex),_($),x(F.mode,F.rowIndex,F.colIndex,B,$);const A=F.mode?{mode:F.mode,cells:B,rowIndex:F.rowIndex,colIndex:F.colIndex,table:$}:null;JSON.stringify(N.current)!==JSON.stringify(A)&&(N.current=A,t&&t(A))},[y,x,t]),P=l.useCallback(B=>{const $=B.target.closest("td, th");if(!$)return;const F=E($);F&&(f(!0),T($),_(F.table),m(!1))},[E]),z=l.useCallback(B=>{if(!p||!b)return;const $=B.target.closest("td, th");if(!$||!v||!v.contains($))return;m(!0),B.preventDefault();const F=E(b),A=E($);if(!F||!A||F.table!==A.table)return;const L=Math.min(F.rowIndex,A.rowIndex),K=Math.max(F.rowIndex,A.rowIndex),ne=Math.min(F.cellIndex,A.cellIndex),re=Math.max(F.cellIndex,A.cellIndex),C=new Set;for(let u=L;u<=K;u++){const M=v.rows[u];if(M)for(let H=ne;H<=re;H++){const j=M.cells[H];j&&C.add(j)}}q(C,v)},[p,E]),k=l.useCallback(()=>{g||O(),f(!1),T(null)},[g,O]),I=l.useCallback(B=>{const $=B.target.closest("td, th"),F=B.target.closest("table");if(!($&&v&&v.contains($))){if(F&&F!==v){O();return}F||O()}},[O,v]);return l.useEffect(()=>{if(!e.current)return;const B=e.current,$=A=>{A.target.closest("td, th")&&P(A)},F=A=>{A.target.closest("td, th")&&z(A)};return B.addEventListener("mousedown",$,!0),B.addEventListener("mouseenter",F,!0),document.addEventListener("mouseup",k),document.addEventListener("click",I),()=>{B.removeEventListener("mousedown",$,!0),B.removeEventListener("mouseenter",F,!0),document.removeEventListener("mouseup",k),document.removeEventListener("click",I)}},[e,P,z,k,I]),l.useEffect(()=>{if(!e.current)return;const B=new MutationObserver($=>{$.forEach(F=>{F.type==="childList"&&v&&!e.current.contains(v)&&O()})});return B.observe(e.current,{childList:!0,subtree:!0}),()=>B.disconnect()},[e,O]),null};Mt.propTypes={editorRef:w.shape({current:w.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onCellSelectionChange:w.func},Mt.defaultProps={onCellSelectionChange:void 0};const Ps=50,Lt=50,Ms=50,Ls=100,Rs=300,Xe=l.forwardRef(({pageManagerComponent:e=null,onNavigatePage:t,onAddPage:r,onDeletePage:n,onPageSizeChange:a,onPageMarginsChange:o,onChange:s,showSidebar:i=!0,showToolbar:d=!0,showPageManager:c=!0},p)=>{const f=ft(),g=pe(),{pageSize:m,pageMargins:b,continuousContent:T,pageBoundaries:v,activePage:_,zoomLevel:N,canUndo:O,canRedo:E}=f,y=l.useRef(null),x=l.useRef(null),{currentFormat:q,formatText:P,updateCurrentFormatFromSelection:z}=mn(),[k,I]=l.useState(!1),[B,$]=l.useState(null),[F,A]=l.useState(!0),[L,K]=l.useState(!1),[ne,re]=l.useState(null),[C,u]=l.useState(null),[M,H]=l.useState(null),{checkAndUpdateBoundaries:j,getCurrentPage:Z,scrollToPage:G,updateBoundaries:R,triggerAutoReflow:V,removePageAndContent:Q,removePageBreak:J,insertPageBreakAtBoundary:ae}=wn(m,x,N,b),D=l.useMemo(()=>we(m),[m]),[ue,xe]=l.useState(!1),de=l.useRef(null),Je=l.useRef(!1),Qe=l.useRef(!1),et=l.useRef(!1),tt=l.useRef(T),It=l.useCallback(()=>{Je.current=!1;const S=Math.max(0,v.length-1);g.setActivePage(S),setTimeout(()=>{G(S,y)},Ms)},[v.length,g,G]);l.useEffect(()=>{if(!x.current||et.current)return;x.current.innerHTML=T,et.current=!0,tt.current=T;const S=setTimeout(()=>{R()},Ps);return()=>clearTimeout(S)},[]),l.useEffect(()=>{if(!x.current||!et.current)return;if(x.current.innerHTML!==T){x.current.innerHTML=T;const oe=setTimeout(()=>{R(),Je.current&&It()},Lt);return tt.current=T,()=>clearTimeout(oe)}},[T,R,It]),l.useEffect(()=>{s&&et.current&&s(T)},[T,s]);const{restoreCursorPosition:Dt,hasActiveCursorSelection:Ht}=no({updateCurrentFormatFromSelection:z,editorRef:x}),Is=l.useCallback(S=>{S!==T&&g.updateContinuousContent(S),x.current&&x.current.innerHTML!==S&&(x.current.innerHTML=S),tt.current=S,setTimeout(()=>{R()},Lt)},[T,g,R]),Bt=l.useCallback(S=>{if(!x.current||!S)return;Ht()||Dt(),document.execCommand("insertHTML",!1,S);const oe=x.current.innerHTML;g.updateContinuousContent(oe),tt.current=oe,setTimeout(()=>{R(),V(200)},Lt)},[Ht,Dt,g,R,V]),er=l.useMemo(()=>({getHTMLContent:()=>x.current?x.current.innerHTML:T,getPlainText:()=>(x.current?x.current.innerHTML:T).replace(/<[^>]*>/g," ").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\s+/g," ").trim(),getCursorPosition:()=>x.current?Qr(x.current):null,setContent:S=>{const oe=qe(S);Is(oe)},setPageSize:S=>{g.updatePageSize(S),R({pageSize:S})},setPageMargins:S=>{g.updatePageMargins(S),R({pageMargins:S})},insertContent:S=>{const oe=qe(S);Bt(oe)}}),[T,g,R,V,Ht,Dt]);l.useImperativeHandle(p,()=>er,[er]);const jt=l.useCallback(()=>{if(!x.current)return;let S=x.current.innerHTML;S=qe(S),S!==x.current.innerHTML&&(x.current.innerHTML=S);const oe=T;if(oe!==S){const Ut={type:"UPDATE_CONTINUOUS_CONTENT",payload:S},qt={type:"UPDATE_CONTINUOUS_CONTENT",payload:oe};g.recordOperation(Ut,qt)}g.updateContinuousContent(S),j(),V(200);const Ie=Z(y);Ie!==_&&g.setActivePage(Ie)},[g,j,Z,_,V,y,x,T]),Ds=l.useCallback(S=>{jt()},[jt]),tr=l.useCallback(S=>{g.updatePageSize(S),R({pageSize:S}),a&&a(S)},[g,R,a]),nr=l.useCallback(S=>{g.updatePageMargins(S),R({pageMargins:S}),o&&o(S)},[g,R,o]),rr=l.useCallback(S=>{S<0||S>=v.length||(Qe.current=!0,g.setActivePage(S),G(S,y),setTimeout(()=>{Qe.current=!1},Rs),t&&t(S))},[g,G,t,v.length]),or=l.useCallback(()=>{const S=v.length+1;ae(S)&&(Je.current=!0,setTimeout(()=>{Je.current&&It()},100)),r&&r()},[v.length,ae,g,G,r]),Hs=l.useCallback(()=>{const S=window.getSelection();if(S&&S.rangeCount>0){if(!x?.current)return;const Ut=`<page-break data-page-break="true" contenteditable="false" data-page-number="${x.current.querySelectorAll('page-break, [data-page-break="true"]').length+2}"></page-break><p><br></p>`;document.execCommand("insertHTML",!1,Ut),setTimeout(()=>{R();const qt=Z(y);g.setActivePage(qt)},150)}},[R,Z,g,y]),Bs=l.useCallback(S=>{Bt(S)},[Bt]),js=l.useCallback(S=>{if(!S)return;J(S)&&setTimeout(()=>{const Ie=Z(y);g.setActivePage(Ie)},200)},[J,Z,g,y]),sr=l.useCallback(S=>{if(v.length<=1){console.warn("Cannot delete the only page");return}Q(S)&&(g.setActivePage(0),n&&n(S))},[v.length,Q,g,n]),$s=l.useMemo(()=>({handleZoomIn:()=>g.zoomIn(),handleZoomOut:()=>g.zoomOut(),handleZoomReset:()=>g.resetZoom(),handleUndo:()=>g.undo(),handleRedo:()=>g.redo()}),[g]),{handleZoomIn:$t,handleZoomOut:zt,handleZoomReset:Ft,handleUndo:zs,handleRedo:Fs}=$s;to({handleZoomIn:$t,handleZoomOut:zt,handleZoomReset:Ft,handleUndo:zs,handleRedo:Fs},{editorRef:x,containerRef:y});const Us=l.useCallback(()=>{!y.current||!x.current||Qe.current||(de.current&&clearTimeout(de.current),de.current=setTimeout(()=>{if(Qe.current){de.current=null;return}const S=Z(y);S!==_&&S>=0&&g.setActivePage(S),de.current=null},Ls))},[Z,_,g]),qs=l.useMemo(()=>{if(!T)return 0;const oe=T.replace(/<[^>]*>/g," ").match(new RegExp("\\p{L}+","gu"));return oe?oe.length:0},[T]),Ws=v.length||1,Gs=l.useCallback(S=>{I(!0),$(S)},[]),ar=l.useCallback(()=>{I(!1),$(null)},[]),Zs=l.useCallback((S,oe)=>{},[]),Ys=l.useCallback(S=>{S&&S.mode==="row"?(u(S.rowIndex),H(null)):S&&S.mode==="column"?(H(S.colIndex),u(null)):(u(null),H(null))},[]),Vs=l.useCallback(S=>{K(!0),re(S)},[]),ir=l.useCallback(()=>{K(!1),re(null)},[]),Ks=l.useCallback((S,oe)=>{},[]);return l.useEffect(()=>()=>{de.current&&clearTimeout(de.current)},[]),h.jsxs("div",{className:"multi-page-editor",children:[d&&h.jsx(Ge,{currentFormat:{...q,imageSelected:k},onFormatText:P,onAddPageBreak:Hs,onInsertImage:Bs,canUndo:O,canRedo:E}),h.jsxs("div",{className:"editor-container",children:[i&&h.jsx(Rn,{editorView:null,isCollapsed:ue,onToggle:()=>xe(S=>!S),wordCount:qs,pageCount:Ws}),h.jsx("div",{className:"editor-viewport continuous-scroll",ref:y,onScroll:Us,children:h.jsx($n,{content:T,dimensions:D,pageSize:m,pageMargins:b,pageBoundaries:v,editorRef:x,onInput:Ds,onContentChange:jt,onClick:()=>x.current?.focus(),onRemovePageBreak:js,zoomLevel:N})}),h.jsx(Ye,{editorRef:x,onImageSelect:Gs,onImageDeselect:ar,onImageResize:Zs,resizeOptions:{...Te,preserveAspectRatio:F,aspectRatio:F}}),h.jsx(Ke,{editorRef:x,onTableSelect:Vs,onTableDeselect:ir,onTableResize:Ks}),h.jsx(Mt,{editorRef:x,onCellSelectionChange:Ys}),k&&B&&h.jsx(Ot,{imageElement:B,initialPreserveAspectRatio:F,onAlignChange:S=>{},onAspectRatioToggle:S=>{A(S)},onDelete:()=>{if(B){const S=B.getAttribute("data-key");S&&kn(S).catch(oe=>{console.error("Failed to delete image from IndexedDB:",oe)})}},onClose:ar}),L&&ne&&h.jsx(Pt,{tableElement:ne,onAlignChange:S=>{},onClose:ir,selectedRowIndex:C,selectedColIndex:M,editorRef:x}),c&&h.jsx("div",{className:"page-manager-sidebar",children:e?l.cloneElement(e,{onNavigate:rr,onAddPage:or,onDeletePage:sr,onPageSizeChange:tr,onPageMarginsChange:nr,zoomLevel:N,canZoomIn:at(N),canZoomOut:it(N),onZoomIn:$t,onZoomOut:zt,onZoomReset:Ft}):h.jsx(zn,{pageBoundaries:v,activePage:_,pageSize:m,pageMargins:b,zoomLevel:N,canZoomIn:at(N),canZoomOut:it(N),onNavigate:rr,onAddPage:or,onDeletePage:sr,onPageSizeChange:tr,onPageMarginsChange:nr,onZoomIn:$t,onZoomOut:zt,onZoomReset:Ft})})]})]})});Xe.displayName="HtmlEditor",Xe.propTypes={pageManagerComponent:w.element,onNavigatePage:w.func,onAddPage:w.func,onDeletePage:w.func,onPageSizeChange:w.func,onPageMarginsChange:w.func,onChange:w.func,showSidebar:w.bool,showToolbar:w.bool,showPageManager:w.bool},Xe.defaultProps={pageManagerComponent:null,onNavigatePage:void 0,onAddPage:void 0,onDeletePage:void 0,onPageSizeChange:void 0,onPageMarginsChange:void 0,onChange:void 0,showSidebar:!0,showToolbar:!0,showPageManager:!0};class Rt extends l.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,r){console.error("[ErrorBoundary] Caught error:",t),console.error("[ErrorBoundary] Error info:",r),this.setState({error:t,errorInfo:r}),this.props.onError&&this.props.onError(t,r)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onReset&&this.props.onReset()};render(){return this.state.hasError?this.props.fallback?this.props.fallback:h.jsxs("div",{style:{padding:"20px",margin:"20px",border:"2px solid #f44336",borderRadius:"4px",backgroundColor:"#ffebee",color:"#c62828"},children:[h.jsx("h2",{style:{marginTop:0},children:"⚠️ Something went wrong"}),h.jsx("p",{children:"The editor encountered an unexpected error and couldn't continue."}),this.props.showDetails&&this.state.error&&h.jsxs("details",{style:{marginTop:"10px",padding:"10px",backgroundColor:"white",borderRadius:"4px",fontSize:"12px",fontFamily:"monospace"},children:[h.jsx("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Error Details"}),h.jsxs("pre",{style:{marginTop:"10px",overflow:"auto",maxHeight:"200px"},children:[this.state.error.toString(),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}),h.jsx("button",{onClick:this.handleReset,style:{marginTop:"15px",padding:"8px 16px",backgroundColor:"#f44336",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:"Try Again"})]}):this.props.children}}Rt.propTypes={children:w.node.isRequired,fallback:w.node,onError:w.func,onReset:w.func,showDetails:w.bool},Rt.defaultProps={fallback:null,onError:void 0,onReset:void 0,showDetails:process.env.NODE_ENV==="development"},U.COMMON_FONT_SIZES=fn,U.ColorPickerDropdown=_t,U.DEFAULT_FONT_SIZE=Ne,U.DEFAULT_IMAGE_RESIZE_OPTIONS=Te,U.DEFAULT_PAGE_SIZE=lt,U.DEFAULT_TABLE_RESIZE_OPTIONS=Le,U.DocumentProvider=Tr,U.EditorToolbar=Ge,U.ErrorBoundary=Rt,U.FONT_SIZE_MAP=Tt,U.HtmlEditor=Xe,U.ImageResizeHandlers=Ye,U.PAGE_SIZES=_e,U.PageManager=zn,U.PageView=$n,U.RESIZE_HANDLERS=W,U.Sidebar=Rn,U.TABLE_RESIZE_HANDLERS=se,U.TableResizeHandlers=Ke,U.applyImageDimensions=so,U.applyTableDimensions=be,U.calculateResizeDimensions=ro,U.calculateTableResizeDimensions=qn,U.clearImages=uo,U.createResizeOverlay=xn,U.createTableResizeOverlay=Wn,U.deleteImage=kn,U.getAllImageKeys=fo,U.getAvailablePageSizes=yr,U.getImage=_n,U.getImageDimensions=oo,U.getPageDimensions=we,U.getPixelValue=Nr,U.getPointValue=Or,U.getTableStructure=ce,U.isResizableImage=ye,U.isResizableTable=ie,U.isValidFontSize=Pr,U.isValidPageSize=mr,U.logger=In,U.pixelsToPoints=gn,U.pointsToPixels=pn,U.removeResizeOverlay=Ue,U.removeTableResizeOverlay=Re,U.saveImage=An,U.updateResizeOverlay=Fe,U.updateTableResizeOverlay=Ve,U.useContinuousReflow=wn,U.useDocument=dt,U.useDocumentActions=pe,U.useDocumentState=ft,U.useFormatting=mn,Object.defineProperty(U,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=htmleditor.umd.cjs.map
