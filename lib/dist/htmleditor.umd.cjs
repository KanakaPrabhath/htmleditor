(function(z,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("react"),require("uuid"),require("react-dom")):typeof define=="function"&&define.amd?define(["exports","react","uuid","react-dom"],c):(z=typeof globalThis<"u"?globalThis:z||self,c(z.HTMLEditor={},z.React,z.uuid,z.ReactDOM))})(this,(function(z,c,ut,Xt){"use strict";function Tr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var je={exports:{}},Ne={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jt;function Er(){if(Jt)return Ne;Jt=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function r(n,a,o){var s=null;if(o!==void 0&&(s=""+o),a.key!==void 0&&(s=""+a.key),"key"in a){o={};for(var i in a)i!=="key"&&(o[i]=a[i])}else o=a;return a=o.ref,{$$typeof:e,type:n,key:s,ref:a!==void 0?a:null,props:o}}return Ne.Fragment=t,Ne.jsx=r,Ne.jsxs=r,Ne}var Pe={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qt;function vr(){return Qt||(Qt=1,process.env.NODE_ENV!=="production"&&(function(){function e(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===L?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case E:return"Fragment";case P:return"Profiler";case A:return"StrictMode";case b:return"Suspense";case N:return"SuspenseList";case C:return"Activity"}if(typeof u=="object")switch(typeof u.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),u.$$typeof){case T:return"Portal";case w:return u.displayName||"Context";case O:return(u._context.displayName||"Context")+".Consumer";case v:var R=u.render;return u=u.displayName,u||(u=R.displayName||R.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case _:return R=u.displayName||null,R!==null?R:e(u.type)||"Memo";case M:R=u._payload,u=u._init;try{return e(u(R))}catch{}}return null}function t(u){return""+u}function r(u){try{t(u);var R=!1}catch{R=!0}if(R){R=console;var B=R.error,j=typeof Symbol=="function"&&Symbol.toStringTag&&u[Symbol.toStringTag]||u.constructor.name||"Object";return B.call(R,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",j),t(u)}}function n(u){if(u===E)return"<>";if(typeof u=="object"&&u!==null&&u.$$typeof===M)return"<...>";try{var R=e(u);return R?"<"+R+">":"<...>"}catch{return"<...>"}}function a(){var u=Z.A;return u===null?null:u.getOwner()}function o(){return Error("react-stack-top-frame")}function s(u){if(D.call(u,"key")){var R=Object.getOwnPropertyDescriptor(u,"key").get;if(R&&R.isReactWarning)return!1}return u.key!==void 0}function i(u,R){function B(){V||(V=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",R))}B.isReactWarning=!0,Object.defineProperty(u,"key",{get:B,configurable:!0})}function f(){var u=e(this.type);return ne[u]||(ne[u]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),u=this.props.ref,u!==void 0?u:null}function l(u,R,B,j,F,W){var I=B.ref;return u={$$typeof:y,type:u,key:R,props:B,_owner:j},(I!==void 0?I:null)!==null?Object.defineProperty(u,"ref",{enumerable:!1,get:f}):Object.defineProperty(u,"ref",{enumerable:!1,value:null}),u._store={},Object.defineProperty(u._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(u,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(u,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:F}),Object.defineProperty(u,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:W}),Object.freeze&&(Object.freeze(u.props),Object.freeze(u)),u}function p(u,R,B,j,F,W){var I=R.children;if(I!==void 0)if(j)if(U(I)){for(j=0;j<I.length;j++)d(I[j]);Object.freeze&&Object.freeze(I)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else d(I);if(D.call(R,"key")){I=e(u);var q=Object.keys(R).filter(function(K){return K!=="key"});j=0<q.length?"{key: someKey, "+q.join(": ..., ")+": ...}":"{key: someKey}",S[I+j]||(q=0<q.length?"{"+q.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,j,I,q,I),S[I+j]=!0)}if(I=null,B!==void 0&&(r(B),I=""+B),s(R)&&(r(R.key),I=""+R.key),"key"in R){B={};for(var X in R)X!=="key"&&(B[X]=R[X])}else B=R;return I&&i(B,typeof u=="function"?u.displayName||u.name||"Unknown":u),l(u,I,B,a(),F,W)}function d(u){g(u)?u._store&&(u._store.validated=1):typeof u=="object"&&u!==null&&u.$$typeof===M&&(u._payload.status==="fulfilled"?g(u._payload.value)&&u._payload.value._store&&(u._payload.value._store.validated=1):u._store&&(u._store.validated=1))}function g(u){return typeof u=="object"&&u!==null&&u.$$typeof===y}var h=c,y=Symbol.for("react.transitional.element"),T=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),O=Symbol.for("react.consumer"),w=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),_=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),C=Symbol.for("react.activity"),L=Symbol.for("react.client.reference"),Z=h.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,D=Object.prototype.hasOwnProperty,U=Array.isArray,Q=console.createTask?console.createTask:function(){return null};h={react_stack_bottom_frame:function(u){return u()}};var V,ne={},oe=h.react_stack_bottom_frame.bind(h,o)(),ae=Q(n(o)),S={};Pe.Fragment=E,Pe.jsx=function(u,R,B){var j=1e4>Z.recentlyCreatedOwnerStacks++;return p(u,R,B,!1,j?Error("react-stack-top-frame"):oe,j?Q(n(u)):ae)},Pe.jsxs=function(u,R,B){var j=1e4>Z.recentlyCreatedOwnerStacks++;return p(u,R,B,!0,j?Error("react-stack-top-frame"):oe,j?Q(n(u)):ae)}})()),Pe}var en;function xr(){return en||(en=1,process.env.NODE_ENV==="production"?je.exports=Er():je.exports=vr()),je.exports}var m=xr();const dt=100,ft=50,pt=200,tn=5,gt=e=>e<pt,ht=e=>e>ft,wr=96,ge=e=>Math.round(e*wr),ze={NORMAL:{name:"Normal",label:'Normal (1")',top:1,bottom:1,left:1,right:1},NARROW:{name:"Narrow",label:'Narrow (0.5")',top:.5,bottom:.5,left:.5,right:.5},MODERATE:{name:"Moderate",label:'Moderate (1" / 0.75")',top:1,bottom:1,left:.75,right:.75},WIDE:{name:"Wide",label:'Wide (1" / 2")',top:1,bottom:1,left:2,right:2},OFFICE_2003:{name:"Office 2003",label:'Office 2003 (1" / 1.25")',top:1,bottom:1,left:1.25,right:1.25}},he="NORMAL",nn=(e=he)=>{if(typeof e=="object"&&e!==null&&typeof e.top=="number"&&typeof e.bottom=="number"&&typeof e.left=="number"&&typeof e.right=="number")return{top:ge(e.top),bottom:ge(e.bottom),left:ge(e.left),right:ge(e.right)};const t=ze[e]||ze[he];return{top:ge(t.top),bottom:ge(t.bottom),left:ge(t.left),right:ge(t.right)}},Cr=(e=he)=>{const t=nn(e);return t.top+t.bottom},Ar=()=>Object.keys(ze),_r=e=>{if(typeof e=="object"&&e!==null&&typeof e.top=="number"&&typeof e.bottom=="number"&&typeof e.left=="number"&&typeof e.right=="number")return`Custom (${e.top}" / ${e.left}")`;const t=ze[e];return t?t.label:"Unknown"},Me={A4:{name:"A4",width:794,height:1123,widthMm:210,heightMm:297,widthIn:8.27,heightIn:11.69},Letter:{name:"Letter",width:816,height:1056,widthMm:216,heightMm:279,widthIn:8.5,heightIn:11},Legal:{name:"Legal",width:816,height:1344,widthMm:216,heightMm:356,widthIn:8.5,heightIn:14}},mt="A4",we=e=>{const t=Me[e]||Me[mt];return{width:t.width,height:t.height}},Sr=e=>Object.keys(Me).includes(e),kr=()=>Object.keys(Me),Le=mt,Te="<p><br></p>",Or="continuous",Re=(e,t=Le)=>({id:ut.v4(),index:e,size:t,content:Te,images:[],isBreakPoint:!1}),$e=e=>typeof e!="string"||e.trim()===""?Te:e,rn=(e,t=Le)=>(e.length>0?e:[Re(0,t)]).map((n,a)=>({id:n.id||ut.v4(),index:a,size:n.size||t,content:$e(n.content),images:n.images||[],isBreakPoint:!!n.isBreakPoint})),Nr=(e=Le)=>[{id:"page-0",pageNumber:1,top:0,height:we(e).height}],Fe=e=>e.slice(0,-1).map((t,r)=>({id:`auto-break-${r}`,pageNumber:r+1})),yt=(e={})=>{const t=new Date().toISOString(),r=e.pageSize||Le,n=rn(e.pages||[Re(0,r)],r);return{id:ut.v4(),title:e.title||"Untitled Document",createdAt:t,updatedAt:t,pageSize:r,pages:n,activePage:e.activePage&&e.activePage<n.length?e.activePage:0,pageBreaks:e.pageBreaks||[],totalPages:n.length,editorMode:e.editorMode||Or,continuousContent:e.continuousContent||Te,pageBoundaries:e.pageBoundaries||Nr(r),zoomLevel:e.zoomLevel||dt,pageMargins:e.pageMargins||he,undoStack:[],redoStack:[],canUndo:!1,canRedo:!1}},G={INITIALIZE_DOCUMENT:"INITIALIZE_DOCUMENT",UPDATE_TITLE:"UPDATE_TITLE",UPDATE_PAGE_CONTENT:"UPDATE_PAGE_CONTENT",UPDATE_PAGES:"UPDATE_PAGES",ADD_PAGE:"ADD_PAGE",DELETE_PAGE:"DELETE_PAGE",SET_ACTIVE_PAGE:"SET_ACTIVE_PAGE",UPDATE_PAGE_SIZE:"UPDATE_PAGE_SIZE",RESET_DOCUMENT:"RESET_DOCUMENT",UPDATE_CONTINUOUS_CONTENT:"UPDATE_CONTINUOUS_CONTENT",UPDATE_PAGE_BOUNDARIES:"UPDATE_PAGE_BOUNDARIES",ADD_PAGE_BREAK:"ADD_PAGE_BREAK",REMOVE_PAGE_BREAK:"REMOVE_PAGE_BREAK",SET_EDITOR_MODE:"SET_EDITOR_MODE",SET_ZOOM_LEVEL:"SET_ZOOM_LEVEL",ZOOM_IN:"ZOOM_IN",ZOOM_OUT:"ZOOM_OUT",RESET_ZOOM:"RESET_ZOOM",UPDATE_PAGE_MARGINS:"UPDATE_PAGE_MARGINS",RECORD_OPERATION:"RECORD_OPERATION",UNDO:"UNDO",REDO:"REDO",CLEAR_UNDO_REDO:"CLEAR_UNDO_REDO"},bt=(e,t)=>{const r=new Date().toISOString();switch(t.type){case G.INITIALIZE_DOCUMENT:{const{initialContent:n=Te,pageSize:a=Le}=t.payload||{},o={...Re(0,a),content:$e(n)};return yt({title:e.title,pageSize:a,pages:[o]})}case G.UPDATE_TITLE:return{...e,title:t.payload,updatedAt:r};case G.UPDATE_PAGE_CONTENT:{const{pageIndex:n,content:a}=t.payload;if(n<0||n>=e.pages.length)return e;const o=[...e.pages];return o[n]={...o[n],content:$e(a)},{...e,pages:o,updatedAt:r}}case G.UPDATE_PAGES:{const n=Array.isArray(t.payload)?{pages:t.payload}:t.payload||{},a=rn(n.pages||[],e.pageSize),o=Array.isArray(n.pageBreaks)?n.pageBreaks:Fe(a);return{...e,pages:a,activePage:Math.min(e.activePage,a.length-1),pageBreaks:o,totalPages:a.length,updatedAt:r}}case G.ADD_PAGE:{const n=typeof t.payload?.index=="number"?Math.min(Math.max(t.payload.index,0),e.pages.length):e.pages.length,a=[...e.pages];a.splice(n,0,Re(n,e.pageSize));const o=a.map((i,f)=>({...i,index:f,size:e.pageSize})),s=Fe(o);return{...e,pages:o,activePage:n,pageBreaks:s,totalPages:o.length,updatedAt:r}}case G.DELETE_PAGE:{const n=t.payload;if(e.pages.length<=1)return e;const a=[...e.pages];a.splice(n,1);const o=a.map((f,l)=>({...f,index:l,size:e.pageSize}));let s=e.activePage;s>=o.length?s=o.length-1:n<=s&&s>0&&(s-=1);const i=Fe(o);return{...e,pages:o,activePage:s,pageBreaks:i,totalPages:o.length,updatedAt:r}}case G.SET_ACTIVE_PAGE:{const n=t.payload;if(n===e.activePage)return e;const a=e.editorMode==="continuous"?e.pageBoundaries.length:e.pages.length;return n<0||n>=a?e:{...e,activePage:n,updatedAt:r}}case G.UPDATE_PAGE_SIZE:{const n=t.payload;if(n===e.pageSize)return e;try{we(n)}catch{return console.warn(`Invalid page size: ${n}`),e}const a=e.pages.map((s,i)=>({...s,index:i,size:n})),o=Fe(a);return{...e,pageSize:n,pages:a,pageBreaks:o,updatedAt:r}}case G.RESET_DOCUMENT:return yt();case G.UPDATE_CONTINUOUS_CONTENT:{const n=$e(t.payload);return n===e.continuousContent?e:{...e,continuousContent:n,updatedAt:r}}case G.UPDATE_PAGE_BOUNDARIES:{const n=Array.isArray(t.payload)?t.payload:[];if(n.length===e.pageBoundaries.length&&n.length>0&&n[0].id===e.pageBoundaries[0]?.id&&n[n.length-1].id===e.pageBoundaries[n.length-1]?.id)return e;const a=e.activePage>=n.length?Math.max(0,n.length-1):e.activePage;return{...e,pageBoundaries:n,totalPages:n.length,activePage:a,updatedAt:r}}case G.ADD_PAGE_BREAK:{const{position:n="end",pageIndex:a}=t.payload||{},o='<page-break data-page-break="true" style="display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;"></page-break>';let s=e.continuousContent;if(n==="end")s=s+o+"<p><br></p>";else if(typeof n=="number"){const i=s.substring(0,n),f=s.substring(n);s=i+o+f}else if(typeof a=="number"&&typeof document<"u"){const i=document.createElement("div");i.innerHTML=s;const f=i.querySelectorAll('page-break, [data-page-break="true"]');if(a===0&&f.length===0)s=s+o+"<p><br></p>";else if(a<f.length){const l=f[a],p=document.createElement("page-break");p.setAttribute("data-page-break","true"),p.setAttribute("style","display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;");const d=document.createElement("p");d.innerHTML="<br>",l.parentNode.insertBefore(p,l.nextSibling),p.parentNode.insertBefore(d,p.nextSibling),s=i.innerHTML}else s=s+o+"<p><br></p>"}return{...e,continuousContent:s,updatedAt:r}}case G.REMOVE_PAGE_BREAK:{const{pageIndex:n}=t.payload||{};if(typeof n!="number"||typeof document>"u")return e;const a=document.createElement("div");a.innerHTML=e.continuousContent;const o=a.querySelectorAll('page-break, [data-page-break="true"]');return o[n]&&o[n].remove(),a.querySelectorAll('page-break, [data-page-break="true"]').forEach((i,f)=>{i.setAttribute("data-page-number",String(f+2))}),{...e,continuousContent:a.innerHTML,updatedAt:r}}case G.SET_EDITOR_MODE:{const n=t.payload;if(n===e.editorMode)return e;let a=e.continuousContent,o=e.pages;return n==="continuous"?a=e.pages.map(i=>i.content).filter(i=>i&&i!==Te).join(`
`)||Te:e.continuousContent&&e.continuousContent!==Te&&(o=[{...Re(0,e.pageSize),content:e.continuousContent}]),{...e,editorMode:n,continuousContent:a,pages:o,updatedAt:r}}case G.SET_ZOOM_LEVEL:{const n=t.payload;return n<ft||n>pt?(console.warn(`Invalid zoom level: ${n}. Must be between ${ft} and ${pt}.`),e):n===e.zoomLevel?e:{...e,zoomLevel:n,updatedAt:r}}case G.ZOOM_IN:{if(!gt(e.zoomLevel))return e;const n=e.zoomLevel+tn;return{...e,zoomLevel:n,updatedAt:r}}case G.ZOOM_OUT:{if(!ht(e.zoomLevel))return e;const n=e.zoomLevel-tn;return{...e,zoomLevel:n,updatedAt:r}}case G.RESET_ZOOM:return e.zoomLevel===dt?e:{...e,zoomLevel:dt,updatedAt:r};case G.UPDATE_PAGE_MARGINS:{const n=t.payload;return n===e.pageMargins?e:{...e,pageMargins:n,updatedAt:r}}case G.RECORD_OPERATION:{const{operation:n,inverseOperation:a}=t.payload;return{...e,undoStack:[...e.undoStack,{operation:n,inverseOperation:a}],redoStack:[],canUndo:!0,canRedo:!1,updatedAt:r}}case G.UNDO:{if(e.undoStack.length===0)return e;const n=e.undoStack[e.undoStack.length-1],a=e.undoStack.slice(0,-1);let o=e;return n.inverseOperation&&(o=bt(e,n.inverseOperation)),{...o,undoStack:a,redoStack:[...e.redoStack,n],canUndo:a.length>0,canRedo:!0,updatedAt:r}}case G.REDO:{if(e.redoStack.length===0)return e;const n=e.redoStack[e.redoStack.length-1],a=e.redoStack.slice(0,-1);let o=e;return n.operation&&(o=bt(e,n.operation)),{...o,undoStack:[...e.undoStack,n],redoStack:a,canUndo:!0,canRedo:a.length>0,updatedAt:r}}case G.CLEAR_UNDO_REDO:return{...e,undoStack:[],redoStack:[],canUndo:!1,canRedo:!1,updatedAt:r};default:return e}},on=c.createContext(null),Pr=({children:e,initialState:t={}})=>{const[r,n]=c.useReducer(bt,yt(t)),a=c.useMemo(()=>({initializeDocument:s=>n({type:G.INITIALIZE_DOCUMENT,payload:s}),updateTitle:s=>n({type:G.UPDATE_TITLE,payload:s}),updatePageContent:s=>n({type:G.UPDATE_PAGE_CONTENT,payload:s}),updatePages:s=>n({type:G.UPDATE_PAGES,payload:s}),addPage:s=>n({type:G.ADD_PAGE,payload:s}),deletePage:s=>n({type:G.DELETE_PAGE,payload:s}),setActivePage:s=>n({type:G.SET_ACTIVE_PAGE,payload:s}),updatePageSize:s=>n({type:G.UPDATE_PAGE_SIZE,payload:s}),resetDocument:()=>n({type:G.RESET_DOCUMENT}),updateContinuousContent:s=>n({type:G.UPDATE_CONTINUOUS_CONTENT,payload:s}),updatePageBoundaries:s=>n({type:G.UPDATE_PAGE_BOUNDARIES,payload:s}),addPageBreak:s=>n({type:G.ADD_PAGE_BREAK,payload:s}),removePageBreak:s=>n({type:G.REMOVE_PAGE_BREAK,payload:s}),setEditorMode:s=>n({type:G.SET_EDITOR_MODE,payload:s}),setZoomLevel:s=>n({type:G.SET_ZOOM_LEVEL,payload:s}),zoomIn:()=>n({type:G.ZOOM_IN}),zoomOut:()=>n({type:G.ZOOM_OUT}),resetZoom:()=>n({type:G.RESET_ZOOM}),updatePageMargins:s=>n({type:G.UPDATE_PAGE_MARGINS,payload:s}),recordOperation:(s,i)=>n({type:G.RECORD_OPERATION,payload:{operation:s,inverseOperation:i}}),undo:()=>n({type:G.UNDO}),redo:()=>n({type:G.REDO}),clearUndoRedo:()=>n({type:G.CLEAR_UNDO_REDO})}),[]),o=c.useMemo(()=>({state:r,actions:a,dispatch:n}),[r,a]);return m.jsx(on.Provider,{value:o,children:e})},Tt=()=>{const e=c.useContext(on);if(!e)throw new Error("useDocument must be used within a DocumentProvider");return e},Et=()=>{const{state:e}=Tt();return e},me=()=>{const{actions:e}=Tt();return e};var Ue={exports:{}},We={exports:{}},ee={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sn;function Mr(){if(sn)return ee;sn=1;var e=typeof Symbol=="function"&&Symbol.for,t=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,n=e?Symbol.for("react.fragment"):60107,a=e?Symbol.for("react.strict_mode"):60108,o=e?Symbol.for("react.profiler"):60114,s=e?Symbol.for("react.provider"):60109,i=e?Symbol.for("react.context"):60110,f=e?Symbol.for("react.async_mode"):60111,l=e?Symbol.for("react.concurrent_mode"):60111,p=e?Symbol.for("react.forward_ref"):60112,d=e?Symbol.for("react.suspense"):60113,g=e?Symbol.for("react.suspense_list"):60120,h=e?Symbol.for("react.memo"):60115,y=e?Symbol.for("react.lazy"):60116,T=e?Symbol.for("react.block"):60121,E=e?Symbol.for("react.fundamental"):60117,A=e?Symbol.for("react.responder"):60118,P=e?Symbol.for("react.scope"):60119;function O(v){if(typeof v=="object"&&v!==null){var b=v.$$typeof;switch(b){case t:switch(v=v.type,v){case f:case l:case n:case o:case a:case d:return v;default:switch(v=v&&v.$$typeof,v){case i:case p:case y:case h:case s:return v;default:return b}}case r:return b}}}function w(v){return O(v)===l}return ee.AsyncMode=f,ee.ConcurrentMode=l,ee.ContextConsumer=i,ee.ContextProvider=s,ee.Element=t,ee.ForwardRef=p,ee.Fragment=n,ee.Lazy=y,ee.Memo=h,ee.Portal=r,ee.Profiler=o,ee.StrictMode=a,ee.Suspense=d,ee.isAsyncMode=function(v){return w(v)||O(v)===f},ee.isConcurrentMode=w,ee.isContextConsumer=function(v){return O(v)===i},ee.isContextProvider=function(v){return O(v)===s},ee.isElement=function(v){return typeof v=="object"&&v!==null&&v.$$typeof===t},ee.isForwardRef=function(v){return O(v)===p},ee.isFragment=function(v){return O(v)===n},ee.isLazy=function(v){return O(v)===y},ee.isMemo=function(v){return O(v)===h},ee.isPortal=function(v){return O(v)===r},ee.isProfiler=function(v){return O(v)===o},ee.isStrictMode=function(v){return O(v)===a},ee.isSuspense=function(v){return O(v)===d},ee.isValidElementType=function(v){return typeof v=="string"||typeof v=="function"||v===n||v===l||v===o||v===a||v===d||v===g||typeof v=="object"&&v!==null&&(v.$$typeof===y||v.$$typeof===h||v.$$typeof===s||v.$$typeof===i||v.$$typeof===p||v.$$typeof===E||v.$$typeof===A||v.$$typeof===P||v.$$typeof===T)},ee.typeOf=O,ee}var te={};/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var an;function Lr(){return an||(an=1,process.env.NODE_ENV!=="production"&&(function(){var e=typeof Symbol=="function"&&Symbol.for,t=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,n=e?Symbol.for("react.fragment"):60107,a=e?Symbol.for("react.strict_mode"):60108,o=e?Symbol.for("react.profiler"):60114,s=e?Symbol.for("react.provider"):60109,i=e?Symbol.for("react.context"):60110,f=e?Symbol.for("react.async_mode"):60111,l=e?Symbol.for("react.concurrent_mode"):60111,p=e?Symbol.for("react.forward_ref"):60112,d=e?Symbol.for("react.suspense"):60113,g=e?Symbol.for("react.suspense_list"):60120,h=e?Symbol.for("react.memo"):60115,y=e?Symbol.for("react.lazy"):60116,T=e?Symbol.for("react.block"):60121,E=e?Symbol.for("react.fundamental"):60117,A=e?Symbol.for("react.responder"):60118,P=e?Symbol.for("react.scope"):60119;function O(H){return typeof H=="string"||typeof H=="function"||H===n||H===l||H===o||H===a||H===d||H===g||typeof H=="object"&&H!==null&&(H.$$typeof===y||H.$$typeof===h||H.$$typeof===s||H.$$typeof===i||H.$$typeof===p||H.$$typeof===E||H.$$typeof===A||H.$$typeof===P||H.$$typeof===T)}function w(H){if(typeof H=="object"&&H!==null){var ce=H.$$typeof;switch(ce){case t:var ke=H.type;switch(ke){case f:case l:case n:case o:case a:case d:return ke;default:var fe=ke&&ke.$$typeof;switch(fe){case i:case p:case y:case h:case s:return fe;default:return ce}}case r:return ce}}}var v=f,b=l,N=i,_=s,M=t,C=p,L=n,Z=y,D=h,U=r,Q=o,V=a,ne=d,oe=!1;function ae(H){return oe||(oe=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),S(H)||w(H)===f}function S(H){return w(H)===l}function u(H){return w(H)===i}function R(H){return w(H)===s}function B(H){return typeof H=="object"&&H!==null&&H.$$typeof===t}function j(H){return w(H)===p}function F(H){return w(H)===n}function W(H){return w(H)===y}function I(H){return w(H)===h}function q(H){return w(H)===r}function X(H){return w(H)===o}function K(H){return w(H)===a}function se(H){return w(H)===d}te.AsyncMode=v,te.ConcurrentMode=b,te.ContextConsumer=N,te.ContextProvider=_,te.Element=M,te.ForwardRef=C,te.Fragment=L,te.Lazy=Z,te.Memo=D,te.Portal=U,te.Profiler=Q,te.StrictMode=V,te.Suspense=ne,te.isAsyncMode=ae,te.isConcurrentMode=S,te.isContextConsumer=u,te.isContextProvider=R,te.isElement=B,te.isForwardRef=j,te.isFragment=F,te.isLazy=W,te.isMemo=I,te.isPortal=q,te.isProfiler=X,te.isStrictMode=K,te.isSuspense=se,te.isValidElementType=O,te.typeOf=w})()),te}var cn;function ln(){return cn||(cn=1,process.env.NODE_ENV==="production"?We.exports=Mr():We.exports=Lr()),We.exports}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var vt,un;function Rr(){if(un)return vt;un=1;var e=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function n(o){if(o==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(o)}function a(){try{if(!Object.assign)return!1;var o=new String("abc");if(o[5]="de",Object.getOwnPropertyNames(o)[0]==="5")return!1;for(var s={},i=0;i<10;i++)s["_"+String.fromCharCode(i)]=i;var f=Object.getOwnPropertyNames(s).map(function(p){return s[p]});if(f.join("")!=="0123456789")return!1;var l={};return"abcdefghijklmnopqrst".split("").forEach(function(p){l[p]=p}),Object.keys(Object.assign({},l)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return vt=a()?Object.assign:function(o,s){for(var i,f=n(o),l,p=1;p<arguments.length;p++){i=Object(arguments[p]);for(var d in i)t.call(i,d)&&(f[d]=i[d]);if(e){l=e(i);for(var g=0;g<l.length;g++)r.call(i,l[g])&&(f[l[g]]=i[l[g]])}}return f},vt}var xt,dn;function wt(){if(dn)return xt;dn=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return xt=e,xt}var Ct,fn;function pn(){return fn||(fn=1,Ct=Function.call.bind(Object.prototype.hasOwnProperty)),Ct}var At,gn;function Ir(){if(gn)return At;gn=1;var e=function(){};if(process.env.NODE_ENV!=="production"){var t=wt(),r={},n=pn();e=function(o){var s="Warning: "+o;typeof console<"u"&&console.error(s);try{throw new Error(s)}catch{}}}function a(o,s,i,f,l){if(process.env.NODE_ENV!=="production"){for(var p in o)if(n(o,p)){var d;try{if(typeof o[p]!="function"){var g=Error((f||"React class")+": "+i+" type `"+p+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof o[p]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw g.name="Invariant Violation",g}d=o[p](s,p,f,i,null,t)}catch(y){d=y}if(d&&!(d instanceof Error)&&e((f||"React class")+": type specification of "+i+" `"+p+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof d+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),d instanceof Error&&!(d.message in r)){r[d.message]=!0;var h=l?l():"";e("Failed "+i+" type: "+d.message+(h??""))}}}}return a.resetWarningCache=function(){process.env.NODE_ENV!=="production"&&(r={})},At=a,At}var _t,hn;function Hr(){if(hn)return _t;hn=1;var e=ln(),t=Rr(),r=wt(),n=pn(),a=Ir(),o=function(){};process.env.NODE_ENV!=="production"&&(o=function(i){var f="Warning: "+i;typeof console<"u"&&console.error(f);try{throw new Error(f)}catch{}});function s(){return null}return _t=function(i,f){var l=typeof Symbol=="function"&&Symbol.iterator,p="@@iterator";function d(S){var u=S&&(l&&S[l]||S[p]);if(typeof u=="function")return u}var g="<<anonymous>>",h={array:A("array"),bigint:A("bigint"),bool:A("boolean"),func:A("function"),number:A("number"),object:A("object"),string:A("string"),symbol:A("symbol"),any:P(),arrayOf:O,element:w(),elementType:v(),instanceOf:b,node:C(),objectOf:_,oneOf:N,oneOfType:M,shape:Z,exact:D};function y(S,u){return S===u?S!==0||1/S===1/u:S!==S&&u!==u}function T(S,u){this.message=S,this.data=u&&typeof u=="object"?u:{},this.stack=""}T.prototype=Error.prototype;function E(S){if(process.env.NODE_ENV!=="production")var u={},R=0;function B(F,W,I,q,X,K,se){if(q=q||g,K=K||I,se!==r){if(f){var H=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw H.name="Invariant Violation",H}else if(process.env.NODE_ENV!=="production"&&typeof console<"u"){var ce=q+":"+I;!u[ce]&&R<3&&(o("You are manually calling a React.PropTypes validation function for the `"+K+"` prop on `"+q+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),u[ce]=!0,R++)}}return W[I]==null?F?W[I]===null?new T("The "+X+" `"+K+"` is marked as required "+("in `"+q+"`, but its value is `null`.")):new T("The "+X+" `"+K+"` is marked as required in "+("`"+q+"`, but its value is `undefined`.")):null:S(W,I,q,X,K)}var j=B.bind(null,!1);return j.isRequired=B.bind(null,!0),j}function A(S){function u(R,B,j,F,W,I){var q=R[B],X=V(q);if(X!==S){var K=ne(q);return new T("Invalid "+F+" `"+W+"` of type "+("`"+K+"` supplied to `"+j+"`, expected ")+("`"+S+"`."),{expectedType:S})}return null}return E(u)}function P(){return E(s)}function O(S){function u(R,B,j,F,W){if(typeof S!="function")return new T("Property `"+W+"` of component `"+j+"` has invalid PropType notation inside arrayOf.");var I=R[B];if(!Array.isArray(I)){var q=V(I);return new T("Invalid "+F+" `"+W+"` of type "+("`"+q+"` supplied to `"+j+"`, expected an array."))}for(var X=0;X<I.length;X++){var K=S(I,X,j,F,W+"["+X+"]",r);if(K instanceof Error)return K}return null}return E(u)}function w(){function S(u,R,B,j,F){var W=u[R];if(!i(W)){var I=V(W);return new T("Invalid "+j+" `"+F+"` of type "+("`"+I+"` supplied to `"+B+"`, expected a single ReactElement."))}return null}return E(S)}function v(){function S(u,R,B,j,F){var W=u[R];if(!e.isValidElementType(W)){var I=V(W);return new T("Invalid "+j+" `"+F+"` of type "+("`"+I+"` supplied to `"+B+"`, expected a single ReactElement type."))}return null}return E(S)}function b(S){function u(R,B,j,F,W){if(!(R[B]instanceof S)){var I=S.name||g,q=ae(R[B]);return new T("Invalid "+F+" `"+W+"` of type "+("`"+q+"` supplied to `"+j+"`, expected ")+("instance of `"+I+"`."))}return null}return E(u)}function N(S){if(!Array.isArray(S))return process.env.NODE_ENV!=="production"&&(arguments.length>1?o("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):o("Invalid argument supplied to oneOf, expected an array.")),s;function u(R,B,j,F,W){for(var I=R[B],q=0;q<S.length;q++)if(y(I,S[q]))return null;var X=JSON.stringify(S,function(se,H){var ce=ne(H);return ce==="symbol"?String(H):H});return new T("Invalid "+F+" `"+W+"` of value `"+String(I)+"` "+("supplied to `"+j+"`, expected one of "+X+"."))}return E(u)}function _(S){function u(R,B,j,F,W){if(typeof S!="function")return new T("Property `"+W+"` of component `"+j+"` has invalid PropType notation inside objectOf.");var I=R[B],q=V(I);if(q!=="object")return new T("Invalid "+F+" `"+W+"` of type "+("`"+q+"` supplied to `"+j+"`, expected an object."));for(var X in I)if(n(I,X)){var K=S(I,X,j,F,W+"."+X,r);if(K instanceof Error)return K}return null}return E(u)}function M(S){if(!Array.isArray(S))return process.env.NODE_ENV!=="production"&&o("Invalid argument supplied to oneOfType, expected an instance of array."),s;for(var u=0;u<S.length;u++){var R=S[u];if(typeof R!="function")return o("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+oe(R)+" at index "+u+"."),s}function B(j,F,W,I,q){for(var X=[],K=0;K<S.length;K++){var se=S[K],H=se(j,F,W,I,q,r);if(H==null)return null;H.data&&n(H.data,"expectedType")&&X.push(H.data.expectedType)}var ce=X.length>0?", expected one of type ["+X.join(", ")+"]":"";return new T("Invalid "+I+" `"+q+"` supplied to "+("`"+W+"`"+ce+"."))}return E(B)}function C(){function S(u,R,B,j,F){return U(u[R])?null:new T("Invalid "+j+" `"+F+"` supplied to "+("`"+B+"`, expected a ReactNode."))}return E(S)}function L(S,u,R,B,j){return new T((S||"React class")+": "+u+" type `"+R+"."+B+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+j+"`.")}function Z(S){function u(R,B,j,F,W){var I=R[B],q=V(I);if(q!=="object")return new T("Invalid "+F+" `"+W+"` of type `"+q+"` "+("supplied to `"+j+"`, expected `object`."));for(var X in S){var K=S[X];if(typeof K!="function")return L(j,F,W,X,ne(K));var se=K(I,X,j,F,W+"."+X,r);if(se)return se}return null}return E(u)}function D(S){function u(R,B,j,F,W){var I=R[B],q=V(I);if(q!=="object")return new T("Invalid "+F+" `"+W+"` of type `"+q+"` "+("supplied to `"+j+"`, expected `object`."));var X=t({},R[B],S);for(var K in X){var se=S[K];if(n(S,K)&&typeof se!="function")return L(j,F,W,K,ne(se));if(!se)return new T("Invalid "+F+" `"+W+"` key `"+K+"` supplied to `"+j+"`.\nBad object: "+JSON.stringify(R[B],null,"  ")+`
Valid keys: `+JSON.stringify(Object.keys(S),null,"  "));var H=se(I,K,j,F,W+"."+K,r);if(H)return H}return null}return E(u)}function U(S){switch(typeof S){case"number":case"string":case"undefined":return!0;case"boolean":return!S;case"object":if(Array.isArray(S))return S.every(U);if(S===null||i(S))return!0;var u=d(S);if(u){var R=u.call(S),B;if(u!==S.entries){for(;!(B=R.next()).done;)if(!U(B.value))return!1}else for(;!(B=R.next()).done;){var j=B.value;if(j&&!U(j[1]))return!1}}else return!1;return!0;default:return!1}}function Q(S,u){return S==="symbol"?!0:u?u["@@toStringTag"]==="Symbol"||typeof Symbol=="function"&&u instanceof Symbol:!1}function V(S){var u=typeof S;return Array.isArray(S)?"array":S instanceof RegExp?"object":Q(u,S)?"symbol":u}function ne(S){if(typeof S>"u"||S===null)return""+S;var u=V(S);if(u==="object"){if(S instanceof Date)return"date";if(S instanceof RegExp)return"regexp"}return u}function oe(S){var u=ne(S);switch(u){case"array":case"object":return"an "+u;case"boolean":case"date":case"regexp":return"a "+u;default:return u}}function ae(S){return!S.constructor||!S.constructor.name?g:S.constructor.name}return h.checkPropTypes=a,h.resetWarningCache=a.resetWarningCache,h.PropTypes=h,h},_t}var St,mn;function Dr(){if(mn)return St;mn=1;var e=wt();function t(){}function r(){}return r.resetWarningCache=t,St=function(){function n(s,i,f,l,p,d){if(d!==e){var g=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw g.name="Invariant Violation",g}}n.isRequired=n;function a(){return n}var o={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:a,element:n,elementType:n,instanceOf:a,node:n,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:r,resetWarningCache:t};return o.PropTypes=o,o},St}var yn;function Br(){if(yn)return Ue.exports;if(yn=1,process.env.NODE_ENV!=="production"){var e=ln(),t=!0;Ue.exports=Hr()(e.isElement,t)}else Ue.exports=Dr()();return Ue.exports}var jr=Br();const x=Tr(jr),kt={"7.5pt":{pt:7.5,px:10,label:"7.5"},"9pt":{pt:9,px:12,label:"9"},"10pt":{pt:10,px:13,label:"10"},"11pt":{pt:11,px:15,label:"11"},"12pt":{pt:12,px:16,label:"12"},"14pt":{pt:14,px:19,label:"14"},"16pt":{pt:16,px:21,label:"16"},"18pt":{pt:18,px:24,label:"18"},"20pt":{pt:20,px:27,label:"20"},"22pt":{pt:22,px:29,label:"22"},"24pt":{pt:24,px:32,label:"24"},"26pt":{pt:26,px:35,label:"26"},"28pt":{pt:28,px:37,label:"28"},"36pt":{pt:36,px:48,label:"36"},"48pt":{pt:48,px:64,label:"48"},"72pt":{pt:72,px:96,label:"72"}},bn=[{value:"10px",label:"7.5",pt:7.5},{value:"12px",label:"9",pt:9},{value:"13px",label:"10",pt:10},{value:"15px",label:"11",pt:11},{value:"16px",label:"12",pt:12},{value:"19px",label:"14",pt:14},{value:"21px",label:"16",pt:16},{value:"24px",label:"18",pt:18},{value:"27px",label:"20",pt:20},{value:"32px",label:"24",pt:24},{value:"37px",label:"28",pt:28},{value:"48px",label:"36",pt:36},{value:"64px",label:"48",pt:48},{value:"96px",label:"72",pt:72}],Ie="16px",Tn=e=>Math.round(e*96/72),En=e=>Math.round(e*72/96*2)/2,zr=e=>{const t=Object.values(kt).find(r=>r.pt===e);return t?`${t.px}px`:`${Tn(e)}px`},$r=e=>{const t=parseInt(e),r=Object.values(kt).find(n=>n.px===t);return r?r.pt:En(t)},Fr=e=>{if(!e)return!1;if(e.endsWith("px")){const t=parseInt(e);return t>=8&&t<=144}if(e.endsWith("pt")){const t=parseFloat(e);return t>=6&&t<=108}return!1},Ur={"10px":"1","12px":"2","13px":"2","15px":"3","16px":"3","19px":"4","21px":"4","24px":"5","27px":"5","32px":"6","37px":"6","48px":"6","64px":"7","96px":"7"},vn={bold:!1,italic:!1,underline:!1,strikethrough:!1,alignLeft:!1,alignCenter:!1,alignRight:!1,alignJustify:!1,fontFamily:"Arial",fontSize:Ie,fontColor:"#000000",headingLevel:"p"},xn=()=>{const[e,t]=c.useState(vn),r=me(),n=c.useCallback((h,y,T=null)=>{try{const E=window.getSelection();if(!E||E.rangeCount===0)return!1;const A=E.getRangeAt(0);if(!A.toString())return t(O=>({...O,[h]:y})),!1;try{const O=document.createElement("span");O.style[h]=y;const w=A.extractContents();return O.appendChild(w),A.insertNode(O),A.selectNodeContents(O),E.removeAllRanges(),E.addRange(A),t(v=>({...v,[h]:y})),!0}catch{if(T){const O=h==="fontSize"?Ur[y]||"3":y;return document.execCommand(T,!1,O),t(w=>({...w,[h]:y})),!0}return!1}}catch(E){return console.warn(`[useFormatting] Style application failed for ${h}:`,E),!1}},[]),a=c.useCallback(h=>n("fontFamily",h,"fontName"),[n]),o=c.useCallback(h=>n("fontSize",h,"fontSize"),[n]),s=c.useCallback(h=>n("color",h,"foreColor"),[n]),i=c.useCallback(h=>{t(y=>({...y,alignLeft:h==="left",alignCenter:h==="center",alignRight:h==="right",alignJustify:h==="justify"}))},[]),f=c.useCallback(h=>{try{const y=window.getSelection();if(!y||y.rangeCount===0)return!1;const T=y.getRangeAt(0),E=T.toString(),P={justifyLeft:"left",justifyCenter:"center",justifyRight:"right",justifyFull:"justify"}[h];if(!P)return!1;if(!E){const w=T.startContainer,v=w.nodeType===Node.TEXT_NODE?w.parentElement:w,b=He(v)||qr();return b&&(b.style.textAlign=P,i(P)),!0}const O=Gr(T);if(O.length===0){const w=document.createElement("p");w.style.textAlign=P;const v=T.extractContents();w.appendChild(v),T.insertNode(w),T.selectNodeContents(w),y.removeAllRanges(),y.addRange(T)}else O.forEach(w=>{w.style.textAlign=P});return i(P),!0}catch(y){return console.warn("[useFormatting] Text alignment failed:",y),!1}},[i]),l=c.useCallback(h=>{try{const y=window.getSelection();if(!y||y.rangeCount===0)return!1;const T=y.getRangeAt(0),E=document.createElement("div");if(E.innerHTML=h,Array.from(E.children).some(P=>["TABLE","UL","OL","BLOCKQUOTE","PRE","DIV","H1","H2","H3","H4","H5","H6"].includes(P.tagName))){const P=T.startContainer,O=P.nodeType===Node.TEXT_NODE?P.parentElement:P,w=He(O);if(w&&["P","H1","H2","H3","H4","H5","H6"].includes(w.tagName)){const v=w.tagName.toLowerCase();if(T.startOffset===0&&(P===w||P.nodeType===Node.TEXT_NODE&&P===w.firstChild))w.parentNode.insertBefore(E,w);else if(T.startOffset===P.textContent?.length&&P===w.lastChild&&T.endOffset===P.textContent?.length){const _=w.nextSibling;_?w.parentNode.insertBefore(E,_):w.parentNode.appendChild(E)}else{const _=T.extractContents(),M=document.createTextNode(""),C=document.createElement(v);C.appendChild(M),C.appendChild(_);const L=w.parentNode;L.insertBefore(E,w.nextSibling),L.insertBefore(C,E.nextSibling),!w.textContent.trim()&&w.children.length===0&&L.removeChild(w)}}else T.insertNode(E);T.setStartAfter(E),T.setEndAfter(E),y.removeAllRanges(),y.addRange(T)}else document.execCommand("insertHTML",!1,h);return!0}catch(y){console.warn("[useFormatting] InsertHTML failed:",y);try{return document.execCommand("insertHTML",!1,h),!0}catch(T){return console.warn("[useFormatting] InsertHTML fallback also failed:",T),!1}}},[]),p=c.useCallback((h,y=null)=>{try{if(h==="undo"){r.undo();return}if(h==="redo"){r.redo();return}if(typeof document.execCommand!="function"){console.warn("[useFormatting] execCommand not supported");return}if(h==="insertHTML"&&y){l(y);return}if(h==="fontSize"){o(y);return}if(h==="fontName"){a(y);return}if(h==="foreColor"){s(y);return}if(["justifyLeft","justifyCenter","justifyRight","justifyFull"].includes(h)){f(h);return}switch(document.execCommand(h,!1,y)||console.warn(`[useFormatting] Command "${h}" failed`),h){case"bold":case"italic":case"underline":case"strikethrough":case"justifyLeft":case"justifyCenter":case"justifyRight":case"justifyFull":case"fontName":case"foreColor":break;case"formatBlock":t(E=>({...E,headingLevel:y}));break;default:break}}catch(T){console.warn(`[useFormatting] Error executing command "${h}":`,T)}},[o,a,f,l,r]),d=c.useCallback(()=>{try{const h=window.getSelection();if(!h||h.rangeCount===0)return;const y=h.getRangeAt(0),T=y.toString();let E=Ie,A="Arial",P="#000000",O="p",w="left";if(T){const b=y.startContainer,N=b.nodeType===Node.TEXT_NODE?b.parentElement:b;if(N){const _=window.getComputedStyle(N),M=_.fontSize,C=_.fontFamily;M&&M.endsWith("px")&&(E=M),C&&C!=="serif"&&(A=C.split(",")[0].replace(/['"]/g,"").trim());const L=_.color;L&&L!=="rgb(0, 0, 0)"&&L!=="#000000"&&(L.startsWith("rgb")?P=Wr(L):P=L);const Z=He(N);if(Z){const D=Z.tagName?.toLowerCase();["h1","h2","h3","h4","h5","h6","p"].includes(D)&&(O=D);const Q=window.getComputedStyle(Z).textAlign;["left","center","right","justify"].includes(Q)&&(w=Q)}}}const v={bold:document.queryCommandState("bold"),italic:document.queryCommandState("italic"),underline:document.queryCommandState("underline"),strikethrough:document.queryCommandState("strikethrough"),alignLeft:w==="left",alignCenter:w==="center",alignRight:w==="right",alignJustify:w==="justify",fontFamily:A,fontSize:E,fontColor:P,headingLevel:O};t(b=>({...b,...v}))}catch(h){console.warn("[useFormatting] Error updating format from selection:",h)}},[]),g=c.useCallback(()=>{t(vn)},[]);return{currentFormat:e,formatText:p,resetFormat:g,updateCurrentFormatFromSelection:d}};function Wr(e){const t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);if(!t)return"#000000";const r=parseInt(t[1],10),n=parseInt(t[2],10),a=parseInt(t[3],10);return`#${((1<<24)+(r<<16)+(n<<8)+a).toString(16).slice(1)}`}function He(e){let t=e;for(;t&&t!==document.body;){const r=t.tagName?.toLowerCase();if(["h1","h2","h3","h4","h5","h6","p"].includes(r))return t;if(t.contentEditable==="true"||t.contentEditable==="")break;t=t.parentElement}return null}function Gr(e){const t=[],r=e.startContainer,n=e.endContainer,a=He(r.nodeType===Node.TEXT_NODE?r.parentElement:r),o=He(n.nodeType===Node.TEXT_NODE?n.parentElement:n);if(a===o&&a)return[a];const s=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_ELEMENT,{acceptNode:f=>{const l=f.tagName?.toLowerCase();return["h1","h2","h3","h4","h5","h6","p"].includes(l)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});let i=s.nextNode();for(;i;)e.intersectsNode(i)&&t.push(i),i=s.nextNode();return t}function qr(){try{const e=window.getSelection();if(!e||e.rangeCount===0)return null;const t=e.getRangeAt(0),r=document.createElement("p");return r.innerHTML="<br>",t.insertNode(r),t.selectNodeContents(r),t.collapse(!0),e.removeAllRanges(),e.addRange(t),r}catch(e){return console.warn("[useFormatting] Failed to create paragraph at cursor:",e),null}}const ye='page-break, [data-page-break="true"]',Zr=(e,t={})=>{if(!e||typeof document>"u")return[];const r=t.pageSize||"A4",n=we(r),a=e.querySelectorAll(ye),o=[];o.push({id:"page-0",pageNumber:1,top:0,height:n.height});const s=e.getBoundingClientRect(),i=e.scrollTop;return a.forEach((f,l)=>{const d=f.getBoundingClientRect().top-s.top+i;o.push({id:`page-${l+1}`,pageNumber:l+2,top:d,height:n.height})}),o},wn=(e,t=100,r=he)=>{const n=we(e),a=Cr(r),o=n.height-a,s=t/100;return o/s},Vr=(e,t)=>{if(!e||!t)return 0;try{const r=t.querySelectorAll(ye);if(r.length===0)return 0;const n=e.getBoundingClientRect(),a=n.top+n.height/2;for(let o=r.length-1;o>=0;o--)if(r[o].getBoundingClientRect().top<a)return o+1;return 0}catch(r){return console.warn("[getCurrentPage] Failed to calculate page:",r),0}},Cn=e=>{if(!e)return[];const t=Array.from(e.children);if(t.length===0)return[];let r=[],n=[];for(const a of t)a.tagName==="PAGE-BREAK"||a.getAttribute("data-page-break")==="true"?n.length>0&&(r.push(n),n=[]):n.push(a);return n.length>0&&r.push(n),r.length===0&&t.length>0&&r.push(t.filter(a=>!(a.tagName==="PAGE-BREAK"||a.getAttribute("data-page-break")==="true"))),r},Yr=e=>{if(!e||!e.getBoundingClientRect)return 0;const t=e.getBoundingClientRect();if(e.tagName==="P"){const r=e.querySelectorAll("img"),n=e.textContent.trim();if(r.length===1&&!n){const o=r[0].getBoundingClientRect(),i=window.getComputedStyle(e).textAlign;if(i==="center"||i==="-webkit-center")return o.height+16}return t.height+16}return e.tagName==="H1"||e.tagName==="H2"||e.tagName==="H3"||e.tagName==="H4"||e.tagName==="H5"||e.tagName==="H6"?t.height+20:e.tagName==="UL"||e.tagName==="OL"?t.height+16:t.height},Kr=(e,t)=>{if(!e)return!1;try{const r=document.createElement("page-break");return r.setAttribute("data-page-break","true"),r.setAttribute("contenteditable","false"),r.setAttribute("data-page-number",t||"2"),e.parentNode.insertBefore(r,e),!0}catch(r){return console.warn("[insertPageBreakBefore] Failed to insert page break:",r),!1}},Xr=(e,t,r,n,a,o,s)=>{if(!e)return!1;try{const f=wn(r,n,a)*(t-1),l=Array.from(e.children);let p=0,d=null;for(let g=0;g<l.length;g++){const h=l[g];if(h.tagName==="PAGE-BREAK"||h.getAttribute("data-page-break")==="true")continue;const y=Yr(h);if(p+y>f){d=h;break}p+=y}if(d){const g=document.createElement("page-break");if(g.setAttribute("data-page-break","true"),g.setAttribute("contenteditable","false"),g.setAttribute("data-page-number",String(t)),d.parentNode.insertBefore(g,d),o){const h=e.innerHTML;o(h)}return s&&setTimeout(()=>{s()},50),!0}else{const g=document.createElement("page-break");g.setAttribute("data-page-break","true"),g.setAttribute("contenteditable","false"),g.setAttribute("data-page-number",String(t)),e.appendChild(g);const h=document.createElement("p");if(h.innerHTML="<br>",e.appendChild(h),o){const y=e.innerHTML;o(y)}return s&&setTimeout(()=>{s()},50),!0}}catch(i){return console.error("[insertPageBreakAtBoundary] Failed to insert page break:",i),!1}},Jr=(e,t,r,n,a,o,s)=>{if(!e)return!1;if(r().length<=1)return console.warn("[removePageAndContent] Cannot delete the only page"),!1;try{const f=Array.from(e.querySelectorAll(ye));if(t>f.length)return console.warn("[removePageAndContent] Invalid page index"),!1;const l=window.getSelection();let p=!1,d=[],g=null;if(t===0){const y=f[0];if(!y)return console.warn("[removePageAndContent] No page break found for first page"),!1;let T=e.firstChild;for(;T&&T!==y;)d.push(T),T=T.nextSibling;g=y}else{const y=f[t-1];if(!y)return console.warn("[removePageAndContent] Page break not found"),!1;const T=f[t];let E=y.nextSibling;for(;E&&E!==T;)d.push(E),E=E.nextSibling;g=y}if(l&&l.rangeCount>0){const T=l.getRangeAt(0).startContainer;for(const E of d)if(E.contains(T)||E===T){p=!0;break}}if(g&&g.parentNode&&g.remove(),d.forEach(y=>{y.parentNode&&y.remove()}),e.querySelectorAll(ye).forEach((y,T)=>{y.setAttribute("data-page-number",String(T+2))}),p&&o&&setTimeout(()=>{o(0)},50),n){const y=e.innerHTML;n(y)}return a&&setTimeout(()=>{a(),s&&setTimeout(()=>{s()},150)},100),!0}catch(f){return console.error("[removePageAndContent] Failed to remove page:",f),!1}},Qr=e=>{if(e)try{e.querySelectorAll(ye).forEach((r,n)=>{r.setAttribute("data-page-number",String(n+2))})}catch(t){console.error("[renumberPageBreaks] Failed to renumber page breaks:",t)}},eo=(e,t,r,n,a)=>{if(!e||!t)return!1;try{if(e.remove(),Qr(t),r){const o=t.innerHTML;r(o)}return n&&setTimeout(()=>{n(),a&&setTimeout(()=>{a()},100)},50),!0}catch(o){return console.error("[removePageBreak] Failed to remove page break:",o),!1}},to=200,no=50,An=3,ro=20,_n=e=>{if(!e||!e.getBoundingClientRect)return 0;const t=e.getBoundingClientRect();if(e.tagName==="P"){const r=e.querySelectorAll("img"),n=e.textContent.trim();if(r.length===1&&!n){const o=r[0].getBoundingClientRect(),i=window.getComputedStyle(e).textAlign;if(i==="center"||i==="-webkit-center")return o.height+16}return t.height+16}return e.tagName==="H1"||e.tagName==="H2"||e.tagName==="H3"||e.tagName==="H4"||e.tagName==="H5"||e.tagName==="H6"?t.height+20:e.tagName==="UL"||e.tagName==="OL"?t.height+16:t.height},oo=(e,t)=>{if(!e||e.length===0)return null;let r=0,n=null;for(let a=0;a<e.length;a++){const o=e[a];if(!o||!o.getBoundingClientRect)continue;const s=_n(o);if(s<1)continue;if(r+s>t)return n===null?a>0?{overflowIndex:a,overflowElement:o,accumulatedHeight:r}:null:{overflowIndex:a,overflowElement:o,accumulatedHeight:r};r+=s,n=o}return null},so=(e,t,r,n,a,o,s,i)=>{if(!e||s.current)return!1;try{s.current=!0;const f=wn(t,r,n);let l=Cn(e),p=!1,d=0;for(let g=0;g<l.length&&d<An;g++){const h=l[g],y=oo(h,f);if(y&&y.overflowIndex>0){let T=0;for(let O=0;O<h.length;O++){const w=h[O];w&&w.getBoundingClientRect&&(T+=_n(w))}if(T-f<ro)continue;const A=g+2;Kr(y.overflowElement,A)&&(p=!0,d++,l=Cn(e))}}if(p){if(a){const g=e.innerHTML;a(g)}setTimeout(()=>{o&&o(),d>=An&&i&&setTimeout(()=>{s.current||i()},100)},no)}return p}catch(f){return console.warn("[checkAndReflow] Reflow failed:",f),!1}finally{s.current=!1}},ao=(e,t,r=to)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{t.current=null,e()},r)},io=400,Sn=(e,t)=>{if(e){e.focus();try{let r=null,n=0;if(t===0)r=e.firstChild,n=0;else{const o=e.querySelectorAll(ye)[t-1];o&&o.nextSibling&&(r=o.nextSibling,n=0)}if(r){const a=document.createRange(),o=window.getSelection();r.nodeType===Node.TEXT_NODE?a.setStart(r,n):a.setStart(r,0),a.collapse(!0),o.removeAllRanges(),o.addRange(a)}}catch(r){console.warn("[positionCursorAtPage] Failed to position cursor:",r)}}},co=(e,t,r,n)=>{if(!e||!t){console.warn("[scrollToPage] Missing refs");return}try{let a=null;if(r===0)a=t;else{const s=t.querySelectorAll(ye)[r-1];if(s)a=s;else{console.warn("[scrollToPage] Page break not found for page",r);return}}if(a){const o=a.getBoundingClientRect(),s=e.getBoundingClientRect(),i=e.scrollTop+(o.top-s.top);e.scrollTo({top:i,behavior:"smooth"}),setTimeout(()=>{n?n(r):Sn(t,r)},io)}}catch(a){console.error("[scrollToPage] Error:",a)}},lo=(e,t,r={},n=300)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{t.current=null,e(r)},Math.max(0,n))},uo=e=>{if(!e)return null;const t=window.getSelection();if(t.rangeCount===0)return null;const r=t.getRangeAt(0);if(!e.contains(r.commonAncestorContainer))return null;let n=1;const a=e.querySelectorAll(ye);for(const p of a)if(r.comparePoint(p,0)>0)n++;else break;const o=document.createRange();o.setStart(e,0),o.setEnd(r.startContainer,r.startOffset);const i=o.toString().replace(/<[^>]*>/g," ").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\s+/g," ").trim(),f=i.length,l=(i.match(/\n/g)||[]).length+1;return{page:n,line:l,charOffset:f}},fo=300,kn=(e,t,r=100,n="NARROW")=>{const a=me(),o=c.useRef(null),s=c.useRef(null),i=c.useRef(e),f=c.useRef(r),l=c.useRef(n),p=c.useRef(!1);c.useEffect(()=>{i.current=e},[e]),c.useEffect(()=>{f.current=r},[r]),c.useEffect(()=>{l.current=n},[n]),c.useEffect(()=>()=>{o.current&&clearTimeout(o.current),s.current&&clearTimeout(s.current)},[]);const d=c.useCallback((b={})=>t?.current?Zr(t.current,b):[],[t]),g=c.useCallback((b={})=>{const N=d(b);return a.updatePageBoundaries(N),N},[d,a]),h=c.useCallback((b={})=>{const N=typeof b.delay=="number"?b.delay:fo;lo(g,o,b,N)},[g]),y=c.useCallback(()=>{t?.current&&so(t.current,i.current,f.current,l.current,a.updateContinuousContent,g,p,y)},[t,a,g]),T=c.useCallback(b=>{ao(y,s,b)},[y]),E=c.useCallback(b=>!b?.current||!t?.current?0:Vr(b.current,t.current),[t]),A=c.useCallback(b=>{t?.current&&Sn(t.current,b)},[t]),P=c.useCallback((b,N)=>{if(!N?.current||!t?.current){console.warn("[scrollToPage] Missing refs");return}co(N.current,t.current,b,A)},[t,A]),O=c.useCallback(async b=>t?.current?Xr(t.current,b,i.current,f.current,l.current,a.updateContinuousContent,g):!1,[t,a,g]),w=c.useCallback(b=>t?.current?Jr(t.current,b,d,a.updateContinuousContent,g,A,y):!1,[t,d,a,g,A,y]),v=c.useCallback(b=>t?.current?eo(b,t.current,a.updateContinuousContent,g,y):!1,[t,a,g,y]);return c.useEffect(()=>()=>{o.current&&clearTimeout(o.current),s.current&&clearTimeout(s.current)},[]),c.useMemo(()=>({calculatePageBoundaries:d,checkAndUpdateBoundaries:h,updateBoundaries:g,getCurrentPage:E,scrollToPage:P,positionCursorAtPage:A,checkAndReflow:y,triggerAutoReflow:T,removePageAndContent:w,removePageBreak:v,insertPageBreakAtBoundary:O,boundaryTimeoutRef:o,reflowTimeoutRef:s}),[d,h,g,E,P,A,y,T,w,v,O])},po=(e,t)=>{const{handleZoomIn:r,handleZoomOut:n,handleZoomReset:a,handleUndo:o,handleRedo:s}=e,{editorRef:i,containerRef:f}=t;c.useEffect(()=>{const l=p=>{if(p.ctrlKey||p.metaKey){["+","=","-","_","0","z","y"].includes(p.key)&&p.preventDefault();const d=document.activeElement===i.current,g=document.activeElement===f.current,h=document.activeElement?.tagName==="INPUT"||document.activeElement?.tagName==="TEXTAREA"||document.activeElement?.isContentEditable===!1;if(d||g||!h)switch(p.key){case"+":case"=":r();break;case"-":case"_":n();break;case"0":a();break;case"z":p.shiftKey||o();break;case"y":s();break}}};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}},[r,n,a,o,s,i,f])},go=({updateCurrentFormatFromSelection:e,editorRef:t})=>{const r=c.useRef(null),n=c.useCallback(()=>{if(!t.current)return;const o=window.getSelection();if(r.current)try{o.removeAllRanges(),o.addRange(r.current);return}catch(i){console.warn("[restoreCursorPosition] Failed to restore cursor:",i)}const s=t.current.lastChild;if(s){const i=document.createRange();s.nodeType===Node.TEXT_NODE?i.setStart(s,s.textContent.length):i.setStartAfter(s),i.collapse(!0),o.removeAllRanges(),o.addRange(i)}},[t]),a=c.useCallback(()=>{if(!t.current)return!1;const o=window.getSelection();if(!o||o.rangeCount===0)return!1;const s=o.getRangeAt(0);return t.current.contains(s.commonAncestorContainer)},[t]);return c.useEffect(()=>{const o=()=>{if(e(),t.current){const i=window.getSelection();if(i.rangeCount>0){const f=i.getRangeAt(0);f.collapsed&&t.current.contains(f.commonAncestorContainer)&&(r.current=f.cloneRange())}}};document.addEventListener("selectionchange",o);const s=()=>{if(setTimeout(e,10),r.current&&t.current)try{const i=window.getSelection();i.removeAllRanges(),i.addRange(r.current)}catch(i){console.warn("[handleFocus] Failed to restore cursor:",i)}};return t.current&&t.current.addEventListener("focus",s),()=>{document.removeEventListener("selectionchange",o),t.current&&t.current.removeEventListener("focus",s)}},[e,t]),{restoreCursorPosition:n,hasActiveCursorSelection:a}},Ee={minWidth:50,minHeight:50,maxWidth:800,maxHeight:600,aspectRatio:!0,preserveAspectRatio:!0,defaultWidth:300,defaultHeight:200},$={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right"};function ho({handler:e,startX:t,startY:r,currentX:n,currentY:a,startWidth:o,startHeight:s,options:i=Ee}){const f=n-t,l=a-r;let p=o,d=s;switch(e){case $.TOP_LEFT:p=Math.max(i.minWidth,o-f),d=Math.max(i.minHeight,s-l);break;case $.TOP_RIGHT:p=Math.max(i.minWidth,o+f),d=Math.max(i.minHeight,s-l);break;case $.BOTTOM_LEFT:p=Math.max(i.minWidth,o-f),d=Math.max(i.minHeight,s+l);break;case $.BOTTOM_RIGHT:p=Math.max(i.minWidth,o+f),d=Math.max(i.minHeight,s+l);break;case $.TOP:d=Math.max(i.minHeight,s-l);break;case $.BOTTOM:d=Math.max(i.minHeight,s+l);break;case $.LEFT:p=Math.max(i.minWidth,o-f);break;case $.RIGHT:p=Math.max(i.minWidth,o+f);break;default:return{width:p,height:d}}if(i.preserveAspectRatio&&i.aspectRatio){const g=o/s;[$.TOP_LEFT,$.TOP_RIGHT,$.BOTTOM_LEFT,$.BOTTOM_RIGHT].includes(e)?p/g>d?d=Math.max(i.minHeight,p/g):p=Math.max(i.minWidth,d*g):[$.TOP,$.BOTTOM].includes(e)?p=d*g:[$.LEFT,$.RIGHT].includes(e)&&(d=p/g)}return i.maxWidth&&p>i.maxWidth&&(p=i.maxWidth,i.preserveAspectRatio&&i.aspectRatio&&(d=p/(o/s))),i.maxHeight&&d>i.maxHeight&&(d=i.maxHeight,i.preserveAspectRatio&&i.aspectRatio&&(p=d*(o/s))),p=Math.max(i.minWidth,p),d=Math.max(i.minHeight,d),{width:Math.round(p),height:Math.round(d)}}function be(e){return e?!!(e.tagName==="IMG"||e.tagName==="DIV"&&e.style.backgroundImage&&e.style.backgroundImage!=="none"):!1}function mo(e){return be(e)?{width:e.offsetWidth,height:e.offsetHeight}:{width:0,height:0}}function yo(e,{width:t,height:r}){be(e)&&(e.tagName==="IMG"?(e.style.width=`${t}px`,e.style.height=`${r}px`,e.width=t,e.height=r):e.tagName==="DIV"&&(e.style.width=`${t}px`,e.style.height=`${r}px`))}function On(e,t=Ee){if(!be(e))return null;const r=document.createElement("div");r.className="image-resize-overlay",r.style.position="fixed",r.style.zIndex="1000",r.style.pointerEvents="none";const n=e.getBoundingClientRect();return r.style.top=`${n.top}px`,r.style.left=`${n.left}px`,r.style.width=`${n.width}px`,r.style.height=`${n.height}px`,Object.values($).forEach(o=>{const s=document.createElement("div");s.className=`resize-handler resize-handler-${o}`,s.dataset.handler=o,s.style.position="absolute",s.style.width="10px",s.style.height="10px",s.style.backgroundColor="#007bff",s.style.border="2px solid white",s.style.borderRadius="50%",s.style.boxShadow="0 0 3px rgba(0,0,0,0.3)",s.style.cursor=bo(o),s.style.pointerEvents="all",Nn(s,o,n.width,n.height),r.appendChild(s)}),r}function bo(e){switch(e){case $.TOP_LEFT:case $.BOTTOM_RIGHT:return"nwse-resize";case $.TOP_RIGHT:case $.BOTTOM_LEFT:return"nesw-resize";case $.TOP:case $.BOTTOM:return"ns-resize";case $.LEFT:case $.RIGHT:return"ew-resize";default:return"default"}}function Nn(e,t,r,n){switch(t){case $.TOP_LEFT:e.style.top="-5px",e.style.left="-5px";break;case $.TOP_RIGHT:e.style.top="-5px",e.style.right="-5px";break;case $.BOTTOM_LEFT:e.style.bottom="-5px",e.style.left="-5px";break;case $.BOTTOM_RIGHT:e.style.bottom="-5px",e.style.right="-5px";break;case $.TOP:e.style.top="-5px",e.style.left=`${r/2+-5}px`;break;case $.BOTTOM:e.style.bottom="-5px",e.style.left=`${r/2+-5}px`;break;case $.LEFT:e.style.top=`${n/2+-5}px`,e.style.left="-5px";break;case $.RIGHT:e.style.top=`${n/2+-5}px`,e.style.right="-5px";break}}function Ge(e,t){if(!e||!t)return;const r=t.getBoundingClientRect();e.style.top=`${r.top}px`,e.style.left=`${r.left}px`,e.style.width=`${r.width}px`,e.style.height=`${r.height}px`,e.querySelectorAll(".resize-handler").forEach(a=>{const o=a.dataset.handler;Nn(a,o,r.width,r.height)})}function qe(e){e&&e.parentNode&&e.parentNode.removeChild(e)}const To="html-editor-storage",Eo=1,ie="images";function vo(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function De(){return new Promise((e,t)=>{const r=indexedDB.open(To,Eo);r.onerror=()=>{t(new Error("Failed to open IndexedDB database"))},r.onsuccess=()=>{e(r.result)},r.onupgradeneeded=n=>{const a=n.target.result;a.objectStoreNames.contains(ie)||a.createObjectStore(ie,{keyPath:"key"}).createIndex("timestamp","timestamp",{unique:!1})}})}function Pn(e){return new Promise((t,r)=>{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(e.type)){r(new Error("Invalid image format. Supported formats: png, jpeg, gif, webp"));return}if(e.size>5*1024*1024){r(new Error("Image exceeds maximum size of 5MB"));return}const a=new FileReader;a.onload=async o=>{const s=o.target.result,f=s.split(",")[1].length*3/4;if(f>5*1024*1024){r(new Error("Image exceeds maximum size of 5MB"));return}try{const l=await De(),p=`editor-image-${vo()}`,g=l.transaction([ie],"readwrite").objectStore(ie),h={key:p,dataUrl:s,size:f,type:e.type,timestamp:Date.now()},y=g.add(h);y.onsuccess=()=>{l.close(),t(p)},y.onerror=()=>{l.close(),r(new Error("Failed to save image to IndexedDB"))}}catch(l){r(l)}},a.onerror=()=>{r(new Error("Error reading image file"))},a.readAsDataURL(e)})}async function Mn(e){try{const t=await De();return new Promise((r,n)=>{const s=t.transaction([ie],"readonly").objectStore(ie).get(e);s.onsuccess=()=>{t.close();const i=s.result;r(i?i.dataUrl:null)},s.onerror=()=>{t.close(),n(new Error("Failed to retrieve image from IndexedDB"))}})}catch(t){return console.error("Error getting image:",t),null}}async function Ln(e){try{const t=await De();return new Promise((r,n)=>{const s=t.transaction([ie],"readwrite").objectStore(ie).delete(e);s.onsuccess=()=>{t.close(),r()},s.onerror=()=>{t.close(),n(new Error("Failed to delete image from IndexedDB"))}})}catch(t){console.error("Error deleting image:",t)}}async function xo(){try{const e=await De();return new Promise((t,r)=>{const o=e.transaction([ie],"readwrite").objectStore(ie).clear();o.onsuccess=()=>{e.close(),t()},o.onerror=()=>{e.close(),r(new Error("Failed to clear images from IndexedDB"))}})}catch(e){console.error("Error clearing images:",e)}}async function wo(){try{const e=await De();return new Promise((t,r)=>{const o=e.transaction([ie],"readonly").objectStore(ie).getAllKeys();o.onsuccess=()=>{e.close(),t(o.result||[])},o.onerror=()=>{e.close(),r(new Error("Failed to get image keys from IndexedDB"))}})}catch(e){return console.error("Error getting image keys:",e),[]}}const Rn=["P","DIV","H1","H2","H3","H4","H5","H6","UL","OL","LI","TABLE","TBODY","TR","TD","TH","THEAD","TFOOT","BLOCKQUOTE","PRE","HR","FIGURE","FIGCAPTION","PAGE-BREAK"],Co=["SPAN","STRONG","EM","B","I","U","S","STRIKE","DEL","INS","SUB","SUP","MARK","SMALL","CODE","KBD","SAMP","VAR","A","ABBR","CITE","DFN","TIME"],Ao=["BR","HR","IMG","INPUT","PAGE-BREAK"];function _o(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function In(e){const t=[];for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];t.push(` ${n.name}="${n.value}"`)}return t.join("")}function Ze(e){if(!e||typeof e!="string")return"<p><br></p>";const t=e.trim();if(!t)return"<p><br></p>";const r=document.createElement("div");return r.innerHTML=t,Be(r)||"<p><br></p>"}function So(e){const t=e.cloneNode(!0);return t.querySelectorAll(":scope > p").forEach(n=>{for(;n.firstChild;)t.insertBefore(n.firstChild,n);n.remove()}),t.innerHTML}function ko(e){const t=Array.from(e.children);return t.length===0?!1:t.every(r=>Rn.includes(r.tagName))}function Oo(e){const t=[];let r=!1;return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===Node.TEXT_NODE)n.textContent.trim()&&(r=!0);else if(n.nodeType===Node.ELEMENT_NODE){const a=n;Rn.includes(a.tagName)?t.push(a.outerHTML):r=!0}}),r?e.outerHTML:t.join("")}function Be(e){const t=[],r=Array.from(e.childNodes);for(let n=0;n<r.length;n++){const a=r[n];if(a.nodeType===Node.TEXT_NODE){const o=a.textContent.trim();o&&t.push(`<p>${_o(o)}</p>`)}else if(a.nodeType===Node.ELEMENT_NODE){const o=a,s=o.tagName,i=s.toLowerCase(),f=In(o);if(s==="DIV"){const l=Be(o);l.trim()?t.push(l):t.push("<p><br></p>")}else if(s==="P")ko(o)?t.push(Oo(o)):t.push(o.outerHTML);else if(["H1","H2","H3","H4","H5","H6"].includes(s)){const l=So(o);t.push(`<${i}${f}>${l}</${i}>`)}else if(s==="BR")t.push("<p><br></p>");else if(s==="IMG")t.push(o.outerHTML);else if(["UL","OL"].includes(s))t.push(No(o));else if(s==="LI")t.push(o.outerHTML);else if(s==="TABLE")t.push(Po(o));else if(["TBODY","THEAD","TFOOT","TR","TD","TH"].includes(s))t.push(o.outerHTML);else if(s==="BLOCKQUOTE"){const l=Be(o);t.push(`<blockquote${f}>${l}</blockquote>`)}else if(s==="PRE")t.push(o.outerHTML);else if(Co.includes(s))t.push(o.outerHTML);else if(s==="PAGE-BREAK"||o.getAttribute("data-page-break")==="true")t.push(o.outerHTML);else if(s==="HR")t.push(o.outerHTML);else if(s==="FIGURE")t.push(o.outerHTML);else if(Ao.includes(s))t.push(o.outerHTML);else{const l=Be(o);t.push(`<${i}${f}>${l}</${i}>`)}}}return t.length===0?"":t.join("")}function No(e){const t=e.tagName.toLowerCase(),r=In(e),n=[];return Array.from(e.children).forEach(a=>{if(a.tagName==="LI")n.push(a.outerHTML);else{const o=Be(a);o.trim()&&n.push(`<li>${o}</li>`)}}),n.length===0?`<${t}${r}><li><br></li></${t}>`:`<${t}${r}>${n.join("")}</${t}>`}function Po(e){return e.outerHTML}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mo=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Lo=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,n)=>n?n.toUpperCase():r.toLowerCase()),Hn=e=>{const t=Lo(e);return t.charAt(0).toUpperCase()+t.slice(1)},Dn=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim(),Ro=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Io={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ho=c.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:a="",children:o,iconNode:s,...i},f)=>c.createElement("svg",{ref:f,...Io,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:Dn("lucide",a),...!o&&!Ro(i)&&{"aria-hidden":"true"},...i},[...s.map(([l,p])=>c.createElement(l,p)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=(e,t)=>{const r=c.forwardRef(({className:n,...a},o)=>c.createElement(Ho,{ref:o,iconNode:t,className:Dn(`lucide-${Mo(Hn(e))}`,`lucide-${e}`,n),...a}));return r.displayName=Hn(e),r};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Do=Y("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bo=Y("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jo=Y("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zo=Y("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $o=Y("bold",[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fo=Y("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uo=Y("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wo=Y("file-check",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=Y("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Go=Y("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qo=Y("heading-1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zo=Y("heading-2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vo=Y("heading-3",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yo=Y("image-upscale",[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M17 21h2a2 2 0 0 0 2-2",key:"130fy9"}],["path",{d:"M21 12v3",key:"1wzk3p"}],["path",{d:"m21 3-5 5",key:"1g5oa7"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2",key:"kk3yz1"}],["path",{d:"m5 21 4.144-4.144a1.21 1.21 0 0 1 1.712 0L13 19",key:"fyekpt"}],["path",{d:"M9 3h3",key:"d52fa"}],["rect",{x:"3",y:"11",width:"10",height:"10",rx:"1",key:"1wpmix"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ko=Y("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xo=Y("italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jo=Y("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qo=Y("list-indent-decrease",[["path",{d:"M21 5H11",key:"us1j55"}],["path",{d:"M21 12H11",key:"wd7e0v"}],["path",{d:"M21 19H11",key:"saa85w"}],["path",{d:"m7 8-4 4 4 4",key:"o5hrat"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=Y("list-indent-increase",[["path",{d:"M21 5H11",key:"us1j55"}],["path",{d:"M21 12H11",key:"wd7e0v"}],["path",{d:"M21 19H11",key:"saa85w"}],["path",{d:"m3 8 4 4-4 4",key:"1a3j6y"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=Y("list-ordered",[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bn=Y("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=Y("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=Y("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=Y("redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=Y("scaling",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M14 15H9v-5",key:"pi4jk9"}],["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M21 3 9 15",key:"15kdhq"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=Y("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=Y("strikethrough",[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=Y("table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=Y("text-align-center",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M17 12H7",key:"16if0g"}],["path",{d:"M19 19H5",key:"vjpgq2"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=Y("text-align-end",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M21 19H7",key:"4cu937"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=Y("text-align-justify",[["path",{d:"M3 5h18",key:"1u36vt"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 19h18",key:"awlh7x"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=Y("text-align-start",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=Y("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=Y("underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=Y("undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=Y("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=Y("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=Y("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),jn=(e,t,r="")=>{if(!e)return[];const n=document.createElement("div");n.innerHTML=e;const a=n.querySelectorAll("h1, h2, h3, h4, h5, h6");return Array.from(a).map((o,s)=>{const i=parseInt(o.tagName.charAt(1)),f=o.textContent.trim();return f?{id:`${r}heading-${s}`,level:i,text:f,page:t||1}:null}).filter(Boolean)},hs=e=>{if(!e)return 0;const t=document.createElement("div");return t.innerHTML=e,(t.textContent||t.innerText||"").trim().split(/\s+/).filter(n=>n.length>0).length},zn=({isCollapsed:e,onToggle:t,wordCount:r,pageCount:n})=>{const a=Et(),{pages:o,activePage:s,continuousContent:i}=a,{wordCount:f,outline:l}=c.useMemo(()=>{if(r!==void 0&&n!==void 0)return{wordCount:r,outline:jn(i,1,"continuous-")};let d=0;const g=[];return o.forEach((h,y)=>{d+=hs(h.content),g.push(...jn(h.content,y+1,`page-${y}-`))}),{wordCount:d,outline:g}},[o,r,n,i]),p=n!==void 0?n:o.length;return m.jsxs("aside",{className:`sidebar ${e?"collapsed":""}`,role:"complementary","aria-label":"Document information","data-testid":"sidebar",children:[m.jsxs("div",{className:"sidebar-header",children:[m.jsxs("div",{className:"sidebar-title",children:[m.jsx(Ve,{size:18}),m.jsx("h2",{children:"Document Info"})]}),m.jsx("button",{className:"sidebar-toggle",onClick:t,"aria-label":e?"Expand sidebar":"Collapse sidebar",title:e?"Expand sidebar":"Collapse sidebar",children:e?m.jsx(Uo,{size:16}):m.jsx(Fo,{size:16})})]}),!e&&m.jsxs("div",{className:"sidebar-content",children:[m.jsxs("div",{className:"sidebar-section",children:[m.jsx("h3",{children:"Statistics"}),m.jsxs("div",{className:"stat-item",children:[m.jsxs("div",{className:"stat-label",children:[m.jsx(Wo,{size:14}),m.jsx("span",{children:"Pages:"})]}),m.jsx("span",{className:"stat-value",children:p})]}),m.jsxs("div",{className:"stat-item","data-testid":"word-count",children:[m.jsxs("div",{className:"stat-label",children:[m.jsx(Go,{size:14}),m.jsx("span",{children:"Words:"})]}),m.jsx("span",{className:"stat-value",children:f.toLocaleString()})]}),m.jsxs("div",{className:"stat-item",children:[m.jsxs("div",{className:"stat-label",children:[m.jsx(Ve,{size:14}),m.jsx("span",{children:"Active Page:"})]}),m.jsx("span",{className:"stat-value",children:s+1})]})]}),l.length>0&&m.jsxs("div",{className:"sidebar-section",children:[m.jsxs("h3",{children:[m.jsx(Bn,{size:14,style:{display:"inline-block",marginRight:"6px",verticalAlign:"middle"}}),"Document Outline"]}),m.jsx("div",{className:"document-outline","data-testid":"outline",children:l.map(d=>{const g=d.level===1?qo:d.level===2?Zo:Vo;return m.jsxs("div",{className:`outline-item outline-level-${d.level}`,style:{marginLeft:`${(d.level-1)*12}px`},children:[m.jsx(g,{size:12,className:"outline-icon"}),m.jsx("span",{className:"outline-text",children:d.text}),m.jsxs("span",{className:"outline-page",children:["p.",d.page]})]},d.id)})})]})]})]})};class $n{constructor(t="Editor"){this.namespace=t}_format(t,r,n){return`[${new Date().toISOString()}] [${this.namespace}] [${t}] ${r}`}info(t,r){}warn(t,r){}error(t,r){}debug(t,r){}}const Fn=new $n("Editor"),Un=new Set(["P","DIV","H1","H2","H3","H4","H5","H6","LI","BLOCKQUOTE","PRE","TABLE"]),Wn=32;function Gn(e,t){if(!e)return;e.dataset||(e.dataset={}),e.style||(e.style={});const r=parseInt(e.dataset.indentLevel||"0",10),n=Math.max(0,t?r-1:r+1);n===0?(e.style.marginLeft="",delete e.dataset.indentLevel):(e.style.marginLeft=`${n*Wn}px`,e.dataset.indentLevel=String(n))}function ms(e,t){Gn(e,t)}function ys(e){let t=e;for(;t;){if(t.nodeType===1&&t.tagName&&Un.has(t.tagName.toUpperCase()))return t;t=t.parentElement||t.parentNode}return null}function bs(){const e=window.getSelection();if(!e||e.rangeCount===0)return[];const t=e.getRangeAt(0),r=new Set;let n=t.commonAncestorContainer;for(n.nodeType===Node.TEXT_NODE&&(n=n.parentElement);n&&n.contentEditable!=="true";)n=n.parentElement;return n?(n.querySelectorAll("p, div, h1, h2, h3, h4, h5, h6, li, blockquote, pre, table").forEach(s=>{document.createRange().selectNodeContents(s),t.intersectsNode(s)&&r.add(s)}),r.size===0&&n.querySelectorAll("img").forEach(i=>{if(document.createRange().selectNode(i),t.intersectsNode(i)){let l=i.parentElement;for(;l&&l!==n;){if(l.tagName&&Un.has(l.tagName.toUpperCase())){r.add(l);break}l=l.parentElement}}}),Array.from(r).filter(s=>{let i=s.parentElement;for(;i;){if(r.has(i))return!1;i=i.parentElement}return!0})):[]}function Ts(e){if(e.style&&e.style.marginLeft&&e.style.marginLeft!==""){const t=parseInt(e.dataset.indentLevel||"0",10),r=Math.max(0,t-1);r===0?(e.style.marginLeft="",delete e.dataset.indentLevel):(e.style.marginLeft=`${r*Wn}px`,e.dataset.indentLevel=String(r));return}if(e.innerHTML.startsWith("&nbsp;&nbsp;&nbsp;&nbsp;")){e.innerHTML=e.innerHTML.replace(/^(&nbsp;){4}/,"");return}try{const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let r=t.nextNode();for(;r;){const n=r.textContent;if(n.startsWith("    ")){r.textContent=n.substring(4);break}r=t.nextNode()}}catch{e.innerHTML=e.innerHTML.replace(/^(&nbsp;){4}/,"")}}function Lt(e=!1){const t=window.getSelection();if(!t||t.rangeCount===0)return!1;let r=bs();const n=t.getRangeAt(0);if(r.length===0){const s=ys(n.startContainer);if(!s)return!1;r=[s]}const a=r[0],o=r[r.length-1];r.forEach(s=>{if((s.tagName?s.tagName.toUpperCase():"")==="LI"){ms(s,e);return}e?Ts(s):Gn(s,!1)});try{const s=document.createRange(),i=d=>d.nodeType===Node.TEXT_NODE?d:document.createTreeWalker(d,NodeFilter.SHOW_TEXT,null).nextNode(),f=d=>{if(d.nodeType===Node.TEXT_NODE)return d;const g=document.createTreeWalker(d,NodeFilter.SHOW_TEXT,null);let h=null,y=g.nextNode();for(;y;)h=y,y=g.nextNode();return h},l=i(a);l?s.setStart(l,0):s.setStart(a,0);const p=f(o);p?s.setEnd(p,p.length):s.setEnd(o,o.childNodes.length),t.removeAllRanges(),t.addRange(s)}catch{try{const i=document.createRange();i.setStartBefore(a),i.setEndAfter(o),t.removeAllRanges(),t.addRange(i)}catch(i){console.warn("Could not restore selection after indentation:",i)}}return!0}function Es(e){if(e.key!=="Tab")return!1;e.preventDefault();const t=e.shiftKey,r=window.getSelection(),n=r&&r.rangeCount>0?r.getRangeAt(0):null;return r&&r.rangeCount>0&&n&&!n.collapsed&&Lt(t)||t||document.execCommand("insertHTML",!1,"&nbsp;&nbsp;&nbsp;&nbsp;"),!0}const Rt=({currentColor:e,onColorSelect:t,title:r="Font Color"})=>{const[n,a]=c.useState(!1),o=c.useRef(null),s=["#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#FFC0CB","#A52A2A","#808080","#FFFFFF"];c.useEffect(()=>{const l=p=>{o.current&&!o.current.contains(p.target)&&a(!1)};return document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[]);const i=l=>{t(l),a(!1)},f=l=>{const p=l.target.value;t(p)};return m.jsxs("div",{className:"color-picker-dropdown",ref:o,children:[m.jsx("button",{onClick:()=>a(!n),className:"color-picker-button",title:r,style:{backgroundColor:e||"#000000",border:"1px solid #ccc",borderRadius:"3px",width:"24px",height:"24px",cursor:"pointer",position:"relative"},children:m.jsx(ns,{size:14,style:{color:e==="#FFFFFF"?"#000":"#FFF"}})}),n&&m.jsxs("div",{className:"color-picker-palette",children:[m.jsx("div",{className:"color-grid",children:s.map(l=>m.jsx("button",{onClick:()=>i(l),className:`color-option ${e===l?"selected":""}`,style:{backgroundColor:l,border:e===l?"2px solid #007acc":"1px solid #ccc",width:"24px",height:"24px",margin:"2px",borderRadius:"3px",cursor:"pointer"},title:l},l))}),m.jsxs("div",{className:"custom-color-section",children:[m.jsx("label",{htmlFor:"custom-color-input",style:{fontSize:"12px",marginBottom:"4px",display:"block"},children:"Custom Color:"}),m.jsx("input",{id:"custom-color-input",type:"color",value:e||"#000000",onChange:f,style:{width:"100%",height:"32px",border:"1px solid #ccc",borderRadius:"3px",cursor:"pointer"}})]})]})]})};Rt.propTypes={currentColor:x.string,onColorSelect:x.func.isRequired,title:x.string};const vs=[{value:"Segoe UI",label:"Segoe UI"},{value:"Arial",label:"Arial"},{value:"Times New Roman",label:"Times New Roman"},{value:"Courier New",label:"Courier New"},{value:"Georgia",label:"Georgia"},{value:"Verdana",label:"Verdana"},{value:"Noto Sans Sinhala",label:"Noto Sans Sinhala"},{value:"Iskoola Pota",label:"Iskoola Pota"},{value:"Noto Sans Tamil",label:"Noto Sans Tamil"},{value:"Noto Sans",label:"Noto Sans"}],xs=[{value:"p",label:"Normal"},{value:"h1",label:"Heading 1"},{value:"h2",label:"Heading 2"},{value:"h3",label:"Heading 3"},{value:"h4",label:"Heading 4"},{value:"h5",label:"Heading 5"},{value:"h6",label:"Heading 6"}],ws='<table border="1"><tr><th>Header 1</th><th>Header 2</th></tr><tr><td>Cell 3</td><td>Cell 4</td></tr></table>',Ye=({currentFormat:e,onFormatText:t,onAddPageBreak:r,onInsertImage:n,canUndo:a=!1,canRedo:o=!1})=>{const s=(h,y,T,E=null,A=!1)=>m.jsx("button",{onClick:h,className:E&&e[E]?"active":"",disabled:A,title:T,style:{opacity:A?.5:1},children:m.jsx(y,{size:16})},T),i=()=>m.jsx("div",{className:"toolbar-separator"}),f=async h=>{try{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(h.type)){alert("Invalid image format. Supported: PNG, JPEG, GIF, WEBP");return}if(h.size>5242880){alert("Image exceeds maximum size of 5MB");return}const T=await Pn(h),E=await Mn(T);if(E&&n){const A=`<img src="${E}" data-key="${T}" alt="Inserted image" />`;n(A)}else Fn.warn("Failed to insert image: missing URL or callback");document.getElementById("image-upload").value=""}catch(y){Fn.error("Error uploading image",y)}},l=()=>{Lt(!1)||document.execCommand("insertHTML",!1,"&nbsp;&nbsp;&nbsp;&nbsp;")},p=()=>{Lt(!0)},d=()=>{const h=prompt("Enter URL:");h&&t("createLink",h)},g=()=>{document.getElementById("image-upload").click()};return m.jsxs("div",{className:"editor-toolbar",children:[s(()=>t("undo"),ds,"Undo",null,!a),s(()=>t("redo"),os,"Redo",null,!o),i(),s(()=>t("bold"),$o,"Bold","bold"),s(()=>t("italic"),Xo,"Italic","italic"),s(()=>t("underline"),us,"Underline","underline"),s(()=>t("strikethrough"),is,"Strikethrough","strikethrough"),i(),s(()=>t("justifyLeft"),Pt,"Align Left","alignLeft"),s(()=>t("justifyCenter"),Ot,"Align Center","alignCenter"),s(()=>t("justifyRight"),Nt,"Align Right","alignRight"),s(()=>t("justifyFull"),ls,"Justify","alignJustify"),i(),m.jsx("select",{onChange:h=>t("fontName",h.target.value),value:e.fontFamily||"Segoe UI",title:"Font Family",children:vs.map(({value:h,label:y})=>m.jsx("option",{value:h,children:y},h))}),m.jsx("select",{onChange:h=>t("fontSize",h.target.value),value:e.fontSize||Ie,title:"Font Size",children:bn.map(({value:h,label:y})=>m.jsx("option",{value:h,children:y},h))}),m.jsx(Rt,{currentColor:e.fontColor,onColorSelect:h=>t("foreColor",h),title:"Font Color"}),m.jsx("select",{onChange:h=>t("formatBlock",h.target.value),value:e.headingLevel||"p",title:"Heading Level",children:xs.map(({value:h,label:y})=>m.jsx("option",{value:h,children:y},h))}),i(),s(()=>t("insertUnorderedList"),Bn,"Bullet List"),s(()=>t("insertOrderedList"),ts,"Numbered List"),i(),m.jsx("button",{onClick:l,title:"Increase Indent (Tab)",children:m.jsx(es,{size:16})}),m.jsx("button",{onClick:p,title:"Decrease Indent (Shift+Tab)",children:m.jsx(Qo,{size:16})}),i(),m.jsx("button",{onClick:d,title:"Insert Link",children:m.jsx(Jo,{size:16})}),s(()=>t("insertHTML",ws),cs,"Insert Table"),r&&s(r,Ve,"Insert Page Break"),i(),m.jsx("input",{type:"file",accept:"image/*",onChange:h=>h.target.files[0]&&f(h.target.files[0]),style:{display:"none"},id:"image-upload"}),m.jsx("button",{onClick:g,title:"Insert Image",children:m.jsx(Ko,{size:16})})]})};Ye.propTypes={currentFormat:x.shape({bold:x.bool,italic:x.bool,underline:x.bool,strikethrough:x.bool,alignLeft:x.bool,alignCenter:x.bool,alignRight:x.bool,alignJustify:x.bool,fontFamily:x.string,fontSize:x.string,fontColor:x.string,headingLevel:x.string}).isRequired,onFormatText:x.func.isRequired,onAddPageBreak:x.func,onInsertImage:x.func,canUndo:x.bool,canRedo:x.bool},Ye.defaultProps={onAddPageBreak:void 0,onInsertImage:void 0,canUndo:!1,canRedo:!1};function Cs(e){return!e||typeof e!="string"?e:Ze(e)}function As(e){e.preventDefault();const t=e.clipboardData||window.clipboardData;if(!t)return null;let r=t.getData("text/html")||t.getData("text/plain");return r?(t.getData("text/html")?r=Cs(r):r=_s(r),document.execCommand("insertHTML",!1,r),r):null}function _s(e){if(!e)return"";const t=e.split(/\n\s*\n/).filter(r=>r.trim());return t.length===0?"<p><br></p>":t.map(r=>{const n=r.split(`
`).filter(o=>o.trim());return n.length===0?"<p><br></p>":`<p>${n.map(o=>Ss(o.trim())).join("<br>")}</p>`}).join("")}function Ss(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}const ks=20,Os=20,qn=20,Zn=-12,Ns={position:"relative",width:"100%",maxWidth:"100%",margin:"40px auto",backgroundColor:"transparent",minHeight:"100vh"},Ps={position:"relative",zIndex:1,backgroundColor:"white",outline:"none",cursor:"text",fontFamily:'"Segoe UI", "Noto Sans Sinhala", "Noto Sans", "Malithi Web", "Iskoola Pota", "Kaputa Unicode", "Helvetica Neue", Arial, "Hiragino Sans GB", "WenQuanYi Micro Hei", "Microsoft YaHei", sans-serif',fontSize:Ie,lineHeight:"1.4",color:"#333",wordWrap:"break-word",whiteSpace:"pre-wrap",overflowWrap:"break-word",border:"1px solid #e0e0e0",boxSizing:"border-box",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},Vn=(e,t=!0)=>{if(!e)return;const r=document.createRange(),n=window.getSelection();t?(r.setStart(e,0),r.collapse(!0)):(r.selectNodeContents(e),r.collapse(!1)),n.removeAllRanges(),n.addRange(r)},Ms=(e,t,r)=>!!((ve(t)||ve(r))&&(e.key.length===1||e.key==="Enter"||e.key===" ")),Ls=(e,t,r)=>!!((e.key==="Backspace"||e.key==="Delete")&&(ve(t)||ve(r))),ve=e=>e?e.nodeType===Node.ELEMENT_NODE?e.tagName==="PAGE-BREAK"||e.getAttribute("data-page-break")==="true":e.parentElement&&ve(e.parentElement):!1,It=({dimensions:e,editorRef:t,onInput:r,onContentChange:n,onKeyDown:a,onClick:o,onScroll:s,onPaste:i,onRemovePageBreak:f,zoomLevel:l=100,pageMargins:p=he})=>{const d=c.useMemo(()=>nn(p),[p]),g=l/100,h=c.useCallback((w,v)=>{if(!w)return!1;const b=w.getBoundingClientRect(),N=v-b.top;return N<d.top||N>b.height-d.bottom},[d.top,d.bottom]),y=c.useCallback((w,v)=>{v.preventDefault();const b=w.getBoundingClientRect(),N=v.clientX-b.left,_=v.clientY-b.top,M=b.width-qn-ks,C=Zn,L=b.width-qn,Z=Zn+Os;N>=M&&N<=L&&_>=C&&_<=Z&&f&&f(w)},[f]),T=c.useCallback(w=>{w.preventDefault();const v=t.current.getBoundingClientRect();if(w.clientY-v.top<d.top){const N=t.current.firstElementChild;N&&N.tagName!=="PAGE-BREAK"&&Vn(N,!0)}else{const N=t.current.lastElementChild;N&&N.tagName!=="PAGE-BREAK"&&Vn(N,!1)}},[t,d.top]),E=c.useCallback(w=>{const v=window.getSelection();if(!v||v.rangeCount===0)return;const b=v.getRangeAt(0),{startContainer:N,endContainer:_}=b;if(Ms(w,N,_))return w.preventDefault(),!1;if(Es(w))return n&&n(),!1;if(Ls(w,N,_))return w.preventDefault(),!1;a&&a(w)},[a,n]),A=c.useCallback(w=>{if(!t.current)return;const v=w.target;if(ve(v)){y(v,w);return}if(h(t.current,w.clientY)){T(w);return}o&&o(w)},[t,o,y,T,h]),P=c.useCallback(w=>{const v=window.getSelection();if(!v||v.rangeCount===0)return;const b=v.getRangeAt(0),{startContainer:N}=b;if(ve(N))return w.preventDefault(),!1},[]),O=c.useCallback(w=>{const v=As(w);i&&i(w,v)},[i]);return m.jsx("div",{className:"continuous-page-container",style:{...Ns,maxWidth:`${e.width}px`,transform:`scale(${g})`,transformOrigin:"top center",transition:"transform 0.2s ease-out"},children:m.jsx("div",{ref:t,contentEditable:!0,suppressContentEditableWarning:!0,className:"continuous-content",style:{...Ps,minHeight:`${e.height}px`,width:`${e.width}px`,padding:`${d.top}px ${d.right}px ${d.bottom}px ${d.left}px`},onInput:r,onKeyDown:E,onBeforeInput:P,onClick:A,onScroll:s,onPaste:O,"data-testid":"continuous-editor"})})};It.propTypes={dimensions:x.shape({width:x.number.isRequired,height:x.number.isRequired}).isRequired,editorRef:x.shape({current:x.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onInput:x.func.isRequired,onContentChange:x.func,onKeyDown:x.func,onClick:x.func,onScroll:x.func,onPaste:x.func,onRemovePageBreak:x.func,zoomLevel:x.number,pageMargins:x.string},It.defaultProps={zoomLevel:100,pageMargins:he};const Yn=c.memo(It),Kn=({pageBoundaries:e=[{id:"page-0",pageNumber:1}],activePage:t=0,pageSize:r="A4",pageMargins:n=he,zoomLevel:a=100,canZoomIn:o=!0,canZoomOut:s=!0,onNavigate:i,onAddPage:f,onDeletePage:l,onPageSizeChange:p,onPageMarginsChange:d,onZoomIn:g,onZoomOut:h,onZoomReset:y}={})=>{const T=Math.max(e?.length||0,1),E=A=>{if(T<=1){console.warn("[PageManager] Cannot delete the only page");return}l?.(A)};return m.jsxs("div",{className:"page-manager",children:[m.jsxs("div",{className:"page-settings-group",children:[m.jsxs("div",{className:"page-settings-header",children:[m.jsx(as,{size:14,style:{marginRight:"4px",verticalAlign:"middle"}}),"Page Settings"]}),m.jsxs("div",{className:"page-settings-controls",children:[m.jsxs("div",{className:"page-setting-item",children:[m.jsx("label",{htmlFor:"page-size-selector",children:"Size:"}),m.jsxs("select",{id:"page-size-selector",role:"combobox","aria-label":"Page size selector",value:r,onChange:A=>p?.(A.target.value),children:[m.jsx("option",{value:"A4",children:"A4"}),m.jsx("option",{value:"Letter",children:"Letter"}),m.jsx("option",{value:"Legal",children:"Legal"})]})]}),m.jsxs("div",{className:"page-setting-item",children:[m.jsx("label",{htmlFor:"page-margins-selector",children:"Margins:"}),m.jsx("select",{id:"page-margins-selector",role:"combobox","aria-label":"Page margins selector",value:n,onChange:A=>d?.(A.target.value),children:Ar().map(A=>m.jsx("option",{value:A,children:_r(A)},A))})]})]})]}),m.jsxs("div",{className:"zoom-controls-compact",children:[m.jsx("button",{type:"button",className:"zoom-button-compact",onClick:h,disabled:!s,"aria-label":"Zoom out",title:"Zoom out (Ctrl + -)",children:m.jsx(gs,{size:12})}),m.jsxs("span",{className:"zoom-level-display",children:[a,"%"]}),m.jsx("button",{type:"button",className:"zoom-button-compact",onClick:g,disabled:!o,"aria-label":"Zoom in",title:"Zoom in (Ctrl + +)",children:m.jsx(ps,{size:12})}),m.jsx("button",{type:"button",className:"zoom-reset-compact",onClick:y,"aria-label":"Reset zoom",title:"Reset zoom to 100% (Ctrl + 0)",children:"Reset"})]}),m.jsx("div",{className:"page-list",children:e.map((A,P)=>m.jsxs("div",{className:"page-item",children:[m.jsxs("button",{type:"button",className:`page-button ${P===t?"active":""}`,onClick:()=>i?.(P),"aria-label":`Go to page ${P+1}`,"aria-current":P===t?"page":void 0,children:[m.jsx(Ve,{size:14}),m.jsxs("span",{children:["Page ",P+1]})]}),T>1&&m.jsx("button",{type:"button",className:"delete-page-button",onClick:O=>{O.stopPropagation(),E(P)},"aria-label":`Delete page ${P+1}`,title:"Delete this page and its content",children:m.jsx(fs,{size:14})})]},A.id||`page-${P}`))}),m.jsxs("button",{type:"button",className:"add-page-button",onClick:()=>f?.(),"aria-label":"Add new page",title:"Add new page at end",children:[m.jsx(rs,{size:16}),m.jsx("span",{children:"Add Page"})]})]})};Kn.propTypes={pageBoundaries:x.arrayOf(x.shape({id:x.string.isRequired,pageNumber:x.number.isRequired,top:x.number,height:x.number})),activePage:x.number,pageSize:x.oneOf(["A4","Letter","Legal"]),pageMargins:x.string,zoomLevel:x.number,canZoomIn:x.bool,canZoomOut:x.bool,onNavigate:x.func,onAddPage:x.func,onDeletePage:x.func,onPageSizeChange:x.func,onPageMarginsChange:x.func,onZoomIn:x.func,onZoomOut:x.func,onZoomReset:x.func};const Xn=c.memo(Kn),Ke=10,Rs=300,Is=200;function Hs(e){switch(e){case $.TOP_LEFT:case $.BOTTOM_RIGHT:return"nwse-resize";case $.TOP_RIGHT:case $.BOTTOM_LEFT:return"nesw-resize";case $.TOP:case $.BOTTOM:return"ns-resize";case $.LEFT:case $.RIGHT:return"ew-resize";default:return"default"}}function Ds(e,t,r,n,a,o){if(!o.preserveAspectRatio)return{width:e,height:t};const s=r/n;return[$.TOP_LEFT,$.TOP_RIGHT,$.BOTTOM_LEFT,$.BOTTOM_RIGHT].includes(a)?e/s>t?t=e/s:e=t*s:[$.TOP,$.BOTTOM].includes(a)?e=t*s:[$.LEFT,$.RIGHT].includes(a)&&(t=e/s),{width:e,height:t}}function Bs({handler:e,startX:t,startY:r,currentX:n,currentY:a,startWidth:o,startHeight:s,options:i=Ee}){const f=n-t,l=a-r;let p=o,d=s;switch(e){case $.TOP_LEFT:p=o-f,d=s-l;break;case $.TOP_RIGHT:p=o+f,d=s-l;break;case $.BOTTOM_LEFT:p=o-f,d=s+l;break;case $.BOTTOM_RIGHT:p=o+f,d=s+l;break;case $.TOP:d=s-l;break;case $.BOTTOM:d=s+l;break;case $.LEFT:p=o-f;break;case $.RIGHT:p=o+f;break;default:return{width:p,height:d}}return{width:p,height:d}=Ds(p,d,o,s,e,i),i.maxWidth&&p>i.maxWidth&&(p=i.maxWidth,i.preserveAspectRatio&&(d=p/(o/s))),i.maxHeight&&d>i.maxHeight&&(d=i.maxHeight,i.preserveAspectRatio&&(p=d*(o/s))),p=Math.max(i.minWidth,Math.min(i.maxWidth||p,p)),d=Math.max(i.minHeight,Math.min(i.maxHeight||d,d)),{width:Math.round(p),height:Math.round(d)}}function Jn(e,{width:t,height:r}){be(e)&&(e.tagName==="IMG"?(e.style.width=`${t}px`,e.style.height=`${r}px`,e.width=t,e.height=r):e.tagName==="DIV"&&(e.style.width=`${t}px`,e.style.height=`${r}px`))}function js(e,t,r){Jn(t,r);const n=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(n)}function zs(e,t,r,n){const{ctrlKey:a,metaKey:o,shiftKey:s,key:i}=e,f=a||o,l=r.offsetWidth,p=r.offsetHeight,g={">":f&&s?()=>({width:Math.min(n.maxWidth||800,l+Ke),height:p}):null,"<":f&&s?()=>({width:Math.max(n.minWidth||50,l-Ke),height:p}):null,"+":f&&s?()=>({width:l,height:Math.min(n.maxHeight||600,p+Ke)}):null,"-":f&&s?()=>({width:l,height:Math.max(n.minHeight||50,p-Ke)}):null,r:f&&!s?()=>({width:Rs,height:Is}):null}[i];if(g){e.preventDefault();const h=g();return js(t,r,h),!0}return!1}const Xe=({editorRef:e,onImageResize:t,onImageSelect:r,onImageDeselect:n,resizeOptions:a=Ee})=>{const o=c.useRef({overlay:null,image:null,start:null,handler:null,isResizing:!1}),s=c.useRef(a),i=me();c.useEffect(()=>{s.current=a},[a]);const f=c.useCallback(E=>{if(!be(E))return;o.current.overlay&&(qe(o.current.overlay),o.current.overlay=null),E.classList.add("selected");const A=On(E,s.current);A&&(o.current.overlay=A,o.current.image=E,document.body.appendChild(A),A.querySelectorAll(".resize-handler").forEach(O=>{O.addEventListener("mousedown",p)}),r&&r(E))},[r]),l=c.useCallback(()=>{o.current.image&&(o.current.image.classList.remove("selected"),o.current.image=null),o.current.overlay&&(qe(o.current.overlay),o.current.overlay=null),o.current.start=null,o.current.handler=null,o.current.isResizing=!1,n&&n()},[n]),p=c.useCallback(E=>{if(E.preventDefault(),E.stopPropagation(),!o.current.image)return;const A=E.currentTarget.dataset.handler,P=o.current.image.getBoundingClientRect(),O=window.pageYOffset||document.documentElement.scrollTop,w=window.pageXOffset||document.documentElement.scrollLeft;o.current.start={x:E.clientX,y:E.clientY,width:o.current.image.offsetWidth,height:o.current.image.offsetHeight,originalWidth:o.current.image.offsetWidth,originalHeight:o.current.image.offsetHeight,offsetX:E.clientX-P.left-w,offsetY:E.clientY-P.top-O},o.current.handler=A,o.current.isResizing=!0,document.body.classList.add("resize-in-progress"),document.body.style.cursor=Hs(A),document.addEventListener("mousemove",d),document.addEventListener("mouseup",g)},[]),d=c.useCallback(E=>{if(!o.current.isResizing||!o.current.image||!o.current.start||!o.current.handler)return;E.preventDefault(),E.stopPropagation();const{x:A,y:P,width:O,height:w}=o.current.start,v=o.current.handler,b=E.clientX,N=E.clientY,_=Bs({handler:v,startX:A,startY:P,currentX:b,currentY:N,startWidth:O,startHeight:w,options:s.current});Jn(o.current.image,_),o.current.overlay&&Ge(o.current.overlay,o.current.image)},[]),g=c.useCallback(E=>{if(o.current.isResizing){if(E.preventDefault(),E.stopPropagation(),o.current.image&&o.current.start){const A={width:o.current.start.originalWidth,height:o.current.start.originalHeight},P={width:o.current.image.offsetWidth,height:o.current.image.offsetHeight};(A.width!==P.width||A.height!==P.height)&&i.recordOperation({type:"IMAGE_RESIZE",payload:{element:o.current.image,state:P}},{type:"IMAGE_RESIZE",payload:{element:o.current.image,state:A}})}if(o.current.start=null,o.current.handler=null,o.current.isResizing=!1,document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",g),document.body.classList.remove("resize-in-progress"),document.body.style.cursor="",o.current.image){const A=new Event("input",{bubbles:!0,cancelable:!0});o.current.image.dispatchEvent(A),t&&t(o.current.image,{width:o.current.image.offsetWidth,height:o.current.image.offsetHeight})}}},[t,i]),h=c.useCallback(E=>{o.current.overlay&&!o.current.overlay.contains(E.target)&&l();const A=E.target;if(be(A)){if(A===o.current.image)return;f(A)}},[f,l]),y=c.useCallback(E=>{if((E.key==="Delete"||E.key==="Backspace")&&o.current.image&&!o.current.isResizing){E.preventDefault();const A=o.current.image;if(A.parentNode){A.parentNode.removeChild(A),l();const P=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(P)}}E.key==="Escape"&&o.current.image&&l(),o.current.image&&!o.current.isResizing&&zs(E,e,o.current.image,s.current)},[e,l]),T=c.useCallback(()=>{o.current.overlay&&o.current.image&&Ge(o.current.overlay,o.current.image)},[]);return c.useEffect(()=>{if(!e.current)return;const A=e.current.closest(".editor-viewport");return A&&(A.addEventListener("scroll",T),window.addEventListener("scroll",T)),()=>{A&&A.removeEventListener("scroll",T),window.removeEventListener("scroll",T)}},[e,T]),c.useEffect(()=>{if(!e.current)return;const E=e.current;return E.addEventListener("click",h),E.addEventListener("keydown",y),window.addEventListener("resize",T),()=>{E.removeEventListener("click",h),E.removeEventListener("keydown",y),window.removeEventListener("resize",T),o.current.isResizing&&(document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",g),document.body.classList.remove("resize-in-progress"),document.body.style.cursor=""),o.current.overlay&&qe(o.current.overlay)}},[e,h,y,T,d,g]),c.useEffect(()=>{if(!e.current)return;const E=new MutationObserver(A=>{A.forEach(P=>{P.type==="childList"&&P.removedNodes.forEach(O=>{O.nodeType===Node.ELEMENT_NODE&&be(O)&&O===o.current.image&&l()})})});return E.observe(e.current,{childList:!0,subtree:!0}),()=>E.disconnect()},[e,l,f]),null};Xe.propTypes={editorRef:x.shape({current:x.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onImageResize:x.func,onImageSelect:x.func,onImageDeselect:x.func,resizeOptions:x.shape({minWidth:x.number,minHeight:x.number,maxWidth:x.number,maxHeight:x.number,aspectRatio:x.bool,preserveAspectRatio:x.bool,defaultWidth:x.number,defaultHeight:x.number})},Xe.defaultProps={onImageResize:void 0,onImageSelect:void 0,onImageDeselect:void 0,resizeOptions:Ee};const Qn={border:"1px solid #ccc",borderRadius:"4px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"28px",height:"28px"},$s={...Qn,background:"transparent",color:"#dc3545",borderColor:"#dc3545"},Ht=e=>({...Qn,background:e?"#007bff":"transparent",color:e?"#fff":"#333"}),Dt=({imageElement:e,onAlignChange:t,onAspectRatioToggle:r,onDelete:n,onClose:a,initialPreserveAspectRatio:o=!0})=>{const[s,i]=c.useState({top:0,left:0}),[f,l]=c.useState(!1),[p,d]=c.useState("top"),[g,h]=c.useState(o),y=c.useRef(null),T=me(),E=C=>{C&&requestAnimationFrame(()=>{const L=document.querySelector(".image-resize-overlay");L&&Ge(L,C)})},A=C=>{if(!C)return null;const L=window.getComputedStyle(C);return{float:L.float||"none",margin:C.style.margin||"",display:L.display||"inline",width:C.style.width||C.width||"",height:C.style.height||C.height||"",aspectRatio:g}},P=c.useCallback(()=>{if(!e)return"left";const C=window.getComputedStyle(e);return C.float==="right"?"right":C.float==="left"?"left":C.display==="block"&&C.margin.includes("auto")?"center":"left"},[e]),[O,w]=c.useState("left");c.useEffect(()=>{e&&w(P())},[e,P]);const v=c.useCallback(()=>{if(!e||!y.current)return;const C=e.getBoundingClientRect(),L=y.current.getBoundingClientRect(),Z=window.innerWidth,D=window.innerHeight,U=C.bottom>=0&&C.top<=D&&C.right>=0&&C.left<=Z;let Q="top",V=0,ne=0;if(U){const S=C.top-L.height-10,u=D-C.bottom-L.height-10;u>S&&u>0?(Q="bottom",V=C.bottom+10):(Q="top",V=C.top-L.height-10)}else Q="top",V=10;ne=C.left+C.width/2-L.width/2;let oe=Math.max(10,Math.min(ne,Z-L.width-10)),ae=Math.max(10,Math.min(V,D-L.height-10));i({top:ae,left:oe}),d(Q),l(!0)},[e]);c.useLayoutEffect(()=>{v();const C=()=>{v()};return window.addEventListener("scroll",C),window.addEventListener("resize",C),()=>{window.removeEventListener("scroll",C),window.removeEventListener("resize",C),l(!1)}},[e,v]),c.useEffect(()=>{const C=L=>{y.current&&!y.current.contains(L.target)&&L.target!==e&&a()};return document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[e,a]);const b={left:{float:"left",margin:"0 10px 10px 0",display:"block"},center:{float:"none",margin:"10px auto",display:"block"},right:{float:"right",margin:"0 0 10px 10px",display:"block"}},N=C=>{if(e&&b[C]){const L=A(e),Z=O,D=b[C];e.style.float=D.float,e.style.margin=D.margin,e.style.display=D.display,w(C),E(e);const U=A(e);T.recordOperation({type:"IMAGE_ALIGN",payload:{element:e,alignment:C,state:U}},{type:"IMAGE_ALIGN",payload:{element:e,alignment:Z,state:L}}),t&&t(C)}},_=()=>{if(e&&e.parentNode){const C={element:e,parent:e.parentNode,nextSibling:e.nextSibling};T.recordOperation({type:"IMAGE_DELETE",payload:{element:e}},{type:"IMAGE_REINSERT",payload:{state:C}}),e.parentNode.removeChild(e),n&&n(),a()}},M=()=>{const C=g,L=!g;h(L),T.recordOperation({type:"IMAGE_ASPECT_RATIO",payload:{element:e,preserveAspectRatio:L}},{type:"IMAGE_ASPECT_RATIO",payload:{element:e,preserveAspectRatio:C}}),r&&r(L)};return!e||typeof document>"u"?null:Xt.createPortal(m.jsxs("div",{ref:y,className:"image-tooltip-menu","data-menu-position":p,"aria-hidden":!f,style:{position:"fixed",top:`${s.top}px`,left:`${s.left}px`,zIndex:999,background:"#fff",border:"1px solid #ddd",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"8px",display:"flex",gap:"2px",alignItems:"center",pointerEvents:f?"auto":"none",minWidth:"140px",minHeight:"32px",opacity:f?1:0,visibility:f?"visible":"hidden",transition:"opacity 0.15s ease, visibility 0.15s ease"},children:[m.jsx("button",{className:`tooltip-button aspect-ratio-toggle ${g?"":"active"}`,onClick:M,title:`Toggle aspect ratio preservation (currently ${g?"ON":"OFF"})`,children:g?m.jsx(ss,{size:14}):m.jsx(Yo,{size:14})}),m.jsx("button",{className:`tooltip-button ${O==="left"?"active":""}`,onClick:()=>N("left"),title:"Align Left",style:Ht(O==="left"),children:m.jsx(Pt,{size:14})}),m.jsx("button",{className:`tooltip-button ${O==="center"?"active":""}`,onClick:()=>N("center"),title:"Align Center",style:Ht(O==="center"),children:m.jsx(Ot,{size:14})}),m.jsx("button",{className:`tooltip-button ${O==="right"?"active":""}`,onClick:()=>N("right"),title:"Align Right",style:Ht(O==="right"),children:m.jsx(Nt,{size:14})}),m.jsx("button",{className:"tooltip-button delete-button",onClick:_,title:"Delete Image",style:$s,children:m.jsx(Mt,{size:14})})]}),document.body)};Dt.propTypes={imageElement:x.instanceOf(typeof Element<"u"?Element:Object),onAlignChange:x.func,onAspectRatioToggle:x.func,onDelete:x.func,onClose:x.func.isRequired,initialPreserveAspectRatio:x.bool},Dt.defaultProps={imageElement:null,onAlignChange:void 0,onAspectRatioToggle:void 0,onDelete:void 0,initialPreserveAspectRatio:!0};const Je=e=>{e.preventDefault(),e.stopPropagation()},Fs=(e,t)=>{const r=Array.isArray(t)?t:[t];document.querySelectorAll(e).forEach(n=>{r.forEach(a=>{n.classList.remove(a)})})},er=(e,t)=>!e||!t?!1:e.contains(t),Us=()=>{window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},Qe={minColumnWidth:10,minRowHeight:8,maxColumnWidth:800,maxRowHeight:600,tableMinWidth:100,tableMinHeight:50,tableMaxWidth:1200,tableMaxHeight:800},J={COLUMN:"column",ROW:"row",TABLE_BOTTOM:"table-bottom",TABLE_RIGHT:"table-right"};function ue(e){return e?e.tagName==="TABLE":!1}function de(e){if(!ue(e))return null;const t=e.getBoundingClientRect(),r=Array.from(e.rows),n=r.length>0?r[0].cells.length:0,a=[],o=e.querySelector("colgroup"),s=o?o.querySelectorAll("col"):[];if(s.length>=n)for(let f=0;f<n;f++){const l=s[f],p=l.style.width?parseInt(l.style.width,10):l.offsetWidth;a.push(p||100)}else if(r.length>0){const f=r[0];for(let l=0;l<f.cells.length;l++){const p=f.cells[l];a.push(p.offsetWidth)}}const i=r.map(f=>(f.style.height?parseInt(f.style.height,10):null)||f.offsetHeight);return{width:t.width,height:t.height,columns:n,rows:r.length,columnWidths:a,rowHeights:i,rect:t}}function tr({type:e,index:t,delta:r,currentStructure:n,options:a=Qe}){const o={columnWidths:[...n.columnWidths],rowHeights:[...n.rowHeights],tableWidth:n.width,tableHeight:n.height},s=(i,f,l,p,d)=>{f>=0&&f<i.length&&(i[f]=Math.max(p,Math.min(d,i[f]+l)))};switch(e){case J.COLUMN:s(o.columnWidths,t,r,a.minColumnWidth,a.maxColumnWidth),o.tableWidth=n.width;break;case J.ROW:s(o.rowHeights,t,r,a.minRowHeight,a.maxRowHeight),o.tableHeight=n.height;break;case J.TABLE_BOTTOM:s(o.rowHeights,n.rows-1,r,a.minRowHeight,a.maxRowHeight);break;case J.TABLE_RIGHT:s(o.columnWidths,n.columns-1,r,a.minColumnWidth,a.maxColumnWidth);break}return o}function xe(e){if(!ue(e))return;const t=Array.from(e.rows);if(t.length===0)return;const r=t[0].cells.length;let n=e.querySelector("colgroup");n||(n=document.createElement("colgroup"),e.insertBefore(n,e.firstChild));const a=n.querySelectorAll("col"),o=a.length;if(o<r)for(let s=o;s<r;s++){const i=document.createElement("col");n.appendChild(i)}else if(o>r)for(let s=o-1;s>=r;s--)n.removeChild(a[s])}function Ce(e,t){if(!ue(e))return;xe(e);const{columnWidths:r,rowHeights:n,tableWidth:a,tableHeight:o}=t,s=r?r.reduce((f,l)=>f+l,0):0,i=n?n.reduce((f,l)=>f+l,0):0;if(a!==void 0?e.style.width=`${a}px`:s>0&&(e.style.width=`${s}px`),o!==void 0?e.style.height=`${o}px`:i>0&&(e.style.height=`${i}px`),r&&r.length>0){e.style.tableLayout="fixed";const f=e.querySelector("colgroup");f&&f.querySelectorAll("col").forEach((p,d)=>{d<r.length&&(p.style.width=`${r[d]}px`)}),e.style.width=`${s}px`}n&&n.length>0&&(Array.from(e.rows).forEach((l,p)=>{p<n.length&&(l.style.height=`${n[p]}px`)}),e.style.height=`${i}px`),e.offsetHeight}function nr(e){if(!ue(e))return null;xe(e);const t=de(e);if(!t)return null;const r=document.createElement("div");r.className="table-resize-overlay",r.style.position="fixed",r.style.zIndex="1000",r.style.pointerEvents="none";const n=e.getBoundingClientRect();r.style.top=`${n.top}px`,r.style.left=`${n.left}px`,r.style.width=`${n.width}px`,r.style.height=`${n.height}px`;for(let s=0;s<t.columns-1;s++){const i=et(J.COLUMN,s,t,n,e);r.appendChild(i)}for(let s=0;s<t.rows-1;s++){const i=et(J.ROW,s,t,n,e);r.appendChild(i)}const a=tt(J.TABLE_BOTTOM,t,n);r.appendChild(a);const o=tt(J.TABLE_RIGHT,t,n);return r.appendChild(o),r}const Ws={[J.COLUMN]:{className:"table-resize-handler table-column-resize-handler",cursor:"col-resize",isVertical:!0},[J.ROW]:{className:"table-resize-handler table-row-resize-handler",cursor:"row-resize",isVertical:!1},[J.TABLE_BOTTOM]:{className:"table-resize-handler table-bottom-resize-handler",cursor:"ns-resize",isVertical:!1},[J.TABLE_RIGHT]:{className:"table-resize-handler table-right-resize-handler",cursor:"ew-resize",isVertical:!0}};function rr(e,t,r){const n=Ws[e];if(!n)return console.warn(`createResizeHandler: Unknown handler type ${e}`),null;const a=document.createElement("div");return a.className=n.className,a.dataset.type=e,a.style.position="absolute",a.style.cursor=n.cursor,a.style.pointerEvents="all",n.isVertical?(a.style.width="4px",a.style.height=`${t}px`):(a.style.width=`${t}px`,a.style.height="4px"),r!=null&&(a.dataset.index=r),a}function et(e,t,r,n,a){const o=e===J.COLUMN?n.height:n.width,s=rr(e,o,t);return _e(s,e,t,r,n,a),s}function tt(e,t,r){const n=e===J.TABLE_RIGHT?r.height:r.width,a=rr(e,n);return _e(a,e,null,t,r,null),a}function nt(e,t){if(!e||!t)return;xe(t);const r=de(t);if(!r)return;const n=t.getBoundingClientRect();e.style.top=`${n.top}px`,e.style.left=`${n.left}px`,e.style.width=`${n.width}px`,e.style.height=`${n.height}px`;const a=e.querySelectorAll(".table-column-resize-handler"),o=e.querySelectorAll(".table-row-resize-handler"),s=e.querySelector(".table-bottom-resize-handler"),i=e.querySelector(".table-right-resize-handler");if(a.length!==r.columns-1||o.length!==r.rows-1||!s||!i){e.innerHTML="";for(let d=0;d<r.columns-1;d++){const g=et(J.COLUMN,d,r,n,t);e.appendChild(g)}for(let d=0;d<r.rows-1;d++){const g=et(J.ROW,d,r,n,t);e.appendChild(g)}const l=tt(J.TABLE_BOTTOM,r,n);e.appendChild(l);const p=tt(J.TABLE_RIGHT,r,n);e.appendChild(p)}else a.forEach((l,p)=>{_e(l,J.COLUMN,p,r,n,t)}),o.forEach((l,p)=>{_e(l,J.ROW,p,r,n,t)}),s&&_e(s,J.TABLE_BOTTOM,null,r,n,null),i&&_e(i,J.TABLE_RIGHT,null,r,n,null)}function Ae(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function Bt(e,t="Operation"){return ue(e)?!0:(console.warn(`${t}: Invalid table element`),!1)}function Gs(e){const t=document.createElement("tr"),r=e.cells.length;for(let n=0;n<r;n++){const a=document.createElement("td");a.innerHTML="&nbsp;",t.appendChild(a)}return t}function or(e,t,r=0){if(!Bt(e,"insertRowAtPosition"))return null;const n=r===-1?t:t+1;if(n<0||n>e.rows.length)return console.warn(`insertRowAtPosition: Invalid row index ${n}, table has ${e.rows.length} rows`),null;const a=e.rows[t];if(!a)return console.warn(`insertRowAtPosition: Could not find reference row at index ${t}`),null;try{const o=Gs(a);n<e.rows.length?e.rows[n].parentNode.insertBefore(o,e.rows[n]):e.rows[e.rows.length-1].parentNode.appendChild(o),xe(e);const s=de(e);return s&&Ce(e,{columnWidths:s.columnWidths,rowHeights:s.rowHeights}),o}catch(o){return console.error("insertRowAtPosition: Failed to insert row",o),null}}function qs(e,t){return or(e,t,-1)}function Zs(e,t){return or(e,t,1)}function Vs(){const e=document.createElement("td");return e.innerHTML="&nbsp;",e}function sr(e,t,r=0){if(!Bt(e,"insertColumnAtPosition"))return!1;if(t<0)return console.warn(`insertColumnAtPosition: Invalid column index ${t}`),!1;const n=Array.from(e.rows);if(n.length===0)return console.warn("insertColumnAtPosition: Table has no rows"),!1;const a=r===-1?t:t+1;if(a>n[0].cells.length)return console.warn(`insertColumnAtPosition: Column index ${a} out of bounds`),!1;try{for(const s of n){const i=Vs();a<s.cells.length?s.insertBefore(i,s.cells[a]):s.appendChild(i)}xe(e);const o=de(e);return o&&Ce(e,{columnWidths:o.columnWidths,rowHeights:o.rowHeights}),!0}catch(o){return console.error("insertColumnAtPosition: Failed to insert column",o),!1}}function Ys(e,t){return sr(e,t,-1)}function Ks(e,t){return sr(e,t,1)}function _e(e,t,r,n,a,o){switch(t){case J.COLUMN:Xs(e,r,n,a,o);break;case J.ROW:Js(e,r,n,a,o);break;case J.TABLE_BOTTOM:Qs(e,n,a);break;case J.TABLE_RIGHT:ea(e,n,a);break}}function Xs(e,t,r,n,a){if(a?.rows.length>0&&a.rows[0].cells.length>t){const s=a.rows[0].cells[t].getBoundingClientRect(),i=a.getBoundingClientRect();e.style.left=`${s.right-i.left-2}px`,e.style.height=`${n.height}px`;return}let o=0;for(let s=0;s<=t;s++)o+=r.columnWidths[s];e.style.left=`${o-2}px`,e.style.height=`${n.height}px`}function Js(e,t,r,n,a){if(a?.rows.length>t&&a.rows[t].cells.length>0){const s=a.rows[t].cells[0].getBoundingClientRect(),i=a.getBoundingClientRect();e.style.top=`${s.bottom-i.top-2}px`,e.style.width=`${n.width}px`;return}let o=0;for(let s=0;s<=t;s++)o+=r.rowHeights[s];e.style.top=`${o-2}px`,e.style.width=`${n.width}px`}function Qs(e,t,r){e.style.bottom="-2px",e.style.left="0px",e.style.width=`${r.width}px`}function ea(e,t,r){e.style.right="-2px",e.style.top="0px",e.style.height=`${r.height}px`}function ar(e,t,r){return Bt(e,`delete${r.charAt(0).toUpperCase()+r.slice(1)}`)?r==="row"?ta(e,t):r==="column"?na(e,t):!1:!1}function ta(e,t){if(t<0||t>=e.rows.length)return console.warn(`deleteRow: Invalid row index ${t}, table has ${e.rows.length} rows`),!1;if(e.rows.length<=1)return console.warn("deleteRow: Cannot delete the last row in the table"),!1;try{const r=e.rows[t];r.parentNode.removeChild(r),xe(e);const n=de(e);return n&&Ce(e,{columnWidths:n.columnWidths,rowHeights:n.rowHeights}),!0}catch(r){return console.error("deleteRow: Failed to delete row",r),!1}}function na(e,t){if(t<0)return console.warn(`deleteColumn: Invalid column index ${t}`),!1;const r=Array.from(e.rows);if(r.length===0)return console.warn("deleteColumn: Table has no rows"),!1;if(t>=r[0].cells.length)return console.warn(`deleteColumn: Column index ${t} out of bounds`),!1;if(r[0].cells.length<=1)return console.warn("deleteColumn: Cannot delete the last column in the table"),!1;try{for(const a of r)a.cells.length>t&&a.removeChild(a.cells[t]);xe(e);const n=de(e);return n&&Ce(e,{columnWidths:n.columnWidths,rowHeights:n.rowHeights}),!0}catch(n){return console.error("deleteColumn: Failed to delete column",n),!1}}function ra(e,t){return ar(e,t,"row")}function oa(e,t){return ar(e,t,"column")}const rt=({editorRef:e,onTableResize:t,onTableSelect:r,onTableDeselect:n,resizeOptions:a=Qe})=>{const o=c.useRef(null),s=c.useRef(null),i=c.useRef(null),f=c.useRef(null),l=c.useRef(null),p=c.useRef(a),d=c.useRef(!1),[g,h]=c.useState(null),y=me();c.useEffect(()=>{p.current=a},[a]);const T=c.useCallback(()=>{s.current&&(s.current.classList.remove("selected"),s.current=null),o.current&&(Ae(o.current),o.current=null),h(null),i.current=null,f.current=null,l.current=null,d.current=!1,n&&n()},[n]),E=c.useCallback(_=>{if(Je(_),!s.current)return;const M=_.currentTarget,C=M.dataset.type,L=parseInt(M.dataset.index,10);s.current.getBoundingClientRect(),window.pageYOffset||document.documentElement.scrollTop,window.pageXOffset||document.documentElement.scrollLeft;const Z=de(s.current);i.current={x:_.clientX,y:_.clientY,structure:{...Z}},f.current=C,l.current=L,d.current=!0,document.body.classList.add("table-resize-in-progress");const U={[J.COLUMN]:"col-resize",[J.ROW]:"row-resize",[J.TABLE_BOTTOM]:"ns-resize",[J.TABLE_RIGHT]:"ew-resize"}[C]||"default";document.body.style.cursor=U,document.addEventListener("mousemove",O),document.addEventListener("mouseup",w)},[]),A=c.useCallback(_=>{const M=nr(_,p.current);return M&&(o.current=M,s.current=_,document.body.appendChild(M),M.querySelectorAll(".table-resize-handler").forEach(L=>{L.addEventListener("mousedown",E)})),M},[E]),P=c.useCallback(_=>{if(!ue(_))return;o.current&&(Ae(o.current),o.current=null),_.classList.add("selected"),A(_)&&(h(_),r&&r(_))},[r,A]),O=c.useCallback(_=>{if(!d.current||!s.current||!i.current||!f.current)return;Je(_);const{x:M,y:C,structure:L}=i.current,Z=f.current,D=l.current,U=_.clientX,Q=_.clientY;let V=0;switch(Z){case J.COLUMN:V=U-M;break;case J.ROW:V=Q-C;break;case J.TABLE_BOTTOM:V=Q-C;break;case J.TABLE_RIGHT:V=U-M;break}const ne=tr({type:Z,index:D,delta:V,currentStructure:L,options:p.current});Ce(s.current,ne),o.current&&nt(o.current,s.current)},[]),w=c.useCallback(_=>{if(d.current){if(Je(_),s.current&&i.current){const M={structure:i.current.structure},C={structure:de(s.current)};(M.structure.width!==C.structure.width||M.structure.height!==C.structure.height||JSON.stringify(M.structure.columnWidths)!==JSON.stringify(C.structure.columnWidths)||JSON.stringify(M.structure.rowHeights)!==JSON.stringify(C.structure.rowHeights))&&y.recordOperation({type:"TABLE_RESIZE",payload:{element:s.current,state:C}},{type:"TABLE_RESIZE",payload:{element:s.current,state:M}})}if(i.current=null,f.current=null,l.current=null,d.current=!1,document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",w),document.body.classList.remove("table-resize-in-progress"),document.body.style.cursor="",s.current){const M=new Event("input",{bubbles:!0,cancelable:!0});s.current.dispatchEvent(M),t&&t(s.current,de(s.current))}}},[t,y]),v=c.useCallback(_=>{o.current&&!o.current.contains(_.target)&&T();const C=_.target.closest("table");if(C&&ue(C)){if(C===s.current)return;P(C)}},[P,T]),b=c.useCallback(_=>{if(_.key==="Delete"&&s.current&&!d.current){_.preventDefault();const M=s.current;if(M.parentNode){M.parentNode.removeChild(M),T();const C=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(C)}}_.key==="Escape"&&s.current&&T()},[e,T]),N=c.useCallback(()=>{o.current&&s.current&&nt(o.current,s.current)},[]);return c.useEffect(()=>{if(!e.current)return;const M=e.current.closest(".editor-viewport");return M&&(M.addEventListener("scroll",N),window.addEventListener("scroll",N)),()=>{M&&M.removeEventListener("scroll",N),window.removeEventListener("scroll",N)}},[e,N]),c.useEffect(()=>{if(!e.current)return;const _=e.current;return _.addEventListener("click",v),_.addEventListener("keydown",b),window.addEventListener("resize",N),()=>{_.removeEventListener("click",v),_.removeEventListener("keydown",b),window.removeEventListener("resize",N),d.current&&(document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",w),document.body.classList.remove("table-resize-in-progress"),document.body.style.cursor=""),o.current&&Ae(o.current)}},[e,v,b,N,O,w]),c.useEffect(()=>{if(!e.current)return;const _=new MutationObserver(M=>{M.forEach(C=>{C.type==="childList"?(C.removedNodes.forEach(L=>{L.nodeType===Node.ELEMENT_NODE&&ue(L)&&L===g&&T()}),C.addedNodes.forEach(L=>{if(L.nodeType!==Node.ELEMENT_NODE)return;if(ue(L)){setTimeout(()=>P(L),50);return}const Z=L.querySelectorAll?.("table")||[];Z.length>0&&setTimeout(()=>P(Z[0]),50)}),g&&[...C.addedNodes,...C.removedNodes].some(Z=>Z.nodeType===Node.ELEMENT_NODE&&Z.tagName==="TR")&&o.current&&s.current&&(Ae(o.current),o.current=null,A(s.current))):C.type==="attributes"&&["colspan","rowspan"].includes(C.attributeName)&&g&&o.current&&s.current&&(Ae(o.current),o.current=null,A(s.current))})});return _.observe(e.current,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["colspan","rowspan"]}),()=>_.disconnect()},[e,g,T,P,A]),null};rt.propTypes={editorRef:x.shape({current:x.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onTableResize:x.func,onTableSelect:x.func,onTableDeselect:x.func,resizeOptions:x.shape({minColumnWidth:x.number,minRowHeight:x.number,maxColumnWidth:x.number,maxRowHeight:x.number,tableMinWidth:x.number,tableMinHeight:x.number,tableMaxWidth:x.number,tableMaxHeight:x.number})},rt.defaultProps={onTableResize:void 0,onTableSelect:void 0,onTableDeselect:void 0,resizeOptions:Qe};const ot={border:"1px solid #ccc",borderRadius:"4px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"28px",height:"28px"},ir={left:{float:"left",margin:"10px 10px 10px 0",marginLeft:"",marginRight:""},center:{float:"none",margin:"10px auto",marginLeft:"auto",marginRight:"auto"},right:{float:"right",margin:"10px 0 10px 10px",marginLeft:"",marginRight:""}},Se={INSERT_ROW_ABOVE:"INSERT_ROW_ABOVE",INSERT_ROW_BELOW:"INSERT_ROW_BELOW",INSERT_COL_LEFT:"INSERT_COL_LEFT",INSERT_COL_RIGHT:"INSERT_COL_RIGHT",DELETE_ROW:"DELETE_ROW",DELETE_COL:"DELETE_COL"},cr=e=>{if(!e)return;const t=r=>{const n=document.querySelector(".table-resize-overlay");n&&nt(n,r)};typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(()=>t(e)):setTimeout(()=>t(e),16)},lr=e=>{if(!e)return null;const t=window.getComputedStyle(e);return{float:t.float||"none",margin:e.style.margin||"",marginLeft:e.style.marginLeft||"",marginRight:e.style.marginRight||"",display:t.display||"table"}},jt=({tableElement:e,onAlignChange:t,onClose:r,selectedRowIndex:n,selectedColIndex:a,editorRef:o})=>{const[s,i]=c.useState({top:0,left:0}),[f,l]=c.useState(!1),[p,d]=c.useState("top"),[g,h]=c.useState("left"),y=c.useRef(null),T=me(),E=c.useCallback(()=>{if(!e)return"left";const D=window.getComputedStyle(e);return D.marginLeft==="auto"&&D.marginRight==="auto"?"center":D.float==="right"?"right":(D.float==="left","left")},[e]);c.useEffect(()=>{e&&h(E())},[e,E]);const A=c.useCallback(()=>{if(!e||!y.current)return;const D=e.getBoundingClientRect(),U=y.current.getBoundingClientRect(),Q=window.visualViewport?window.visualViewport:{width:window.innerWidth,height:window.innerHeight},V=D.bottom>=0&&D.top<=Q.height&&D.right>=0&&D.left<=Q.width;let ne="top",oe=0,ae=0;if(V){const j=D.top-U.height-10,F=Q.height-D.bottom-U.height-10;F>j&&F>0?(ne="bottom",oe=D.bottom+10):(ne="top",oe=D.top-U.height-10)}else ne="top",oe=10;ae=D.left+D.width/2-U.width/2;const S=window.innerWidth,u=window.innerHeight;let R=Math.max(10,Math.min(ae,S-U.width-10)),B=Math.max(10,Math.min(oe,u-U.height-10));i({top:B,left:R}),d(ne),l(!0)},[e]);c.useLayoutEffect(()=>{A();const D=()=>{A()};return window.addEventListener("scroll",D),window.addEventListener("resize",D),()=>{window.removeEventListener("scroll",D),window.removeEventListener("resize",D),l(!1)}},[e,A]),c.useEffect(()=>{const D=U=>{y.current&&!y.current.contains(U.target)&&U.target!==e&&!e.contains(U.target)&&r()};return document.addEventListener("mousedown",D),()=>{document.removeEventListener("mousedown",D)}},[e,r]);const P=c.useCallback(D=>{if(!e||!ir[D])return;const U=lr(e),Q=g,V=ir[D];e.style.float=V.float,e.style.margin=V.margin,e.style.marginLeft=V.marginLeft,e.style.marginRight=V.marginRight,h(D),cr(e);const ne=lr(e);T.recordOperation({type:"TABLE_ALIGN",payload:{element:e,alignment:D,state:ne}},{type:"TABLE_ALIGN",payload:{element:e,alignment:Q,state:U}}),t?.(D)},[e,g,T,t]),O=c.useCallback((D,U)=>()=>{if(!e)return;const Q=D.includes("ROW"),V=Q?n:a;if(V==null||!U(e,V))return;o?.current&&T.updateContinuousContent(o.current.innerHTML);const oe=Q?{element:e,index:V}:{element:e,index:V};T.recordOperation({type:D,payload:oe},{type:D,payload:oe}),cr(e),requestAnimationFrame(()=>A())},[e,n,a,o,T,A]),w=c.useMemo(()=>O(Se.INSERT_ROW_ABOVE,qs),[O]),v=c.useMemo(()=>O(Se.INSERT_ROW_BELOW,Zs),[O]),b=c.useMemo(()=>O(Se.INSERT_COL_LEFT,Ys),[O]),N=c.useMemo(()=>O(Se.INSERT_COL_RIGHT,Ks),[O]),_=c.useMemo(()=>O(Se.DELETE_ROW,ra),[O]),M=c.useMemo(()=>O(Se.DELETE_COL,oa),[O]),C=D=>({...ot,background:D?"#007bff":"transparent",color:D?"#fff":"#333"}),L=c.useMemo(()=>({rowAction:{...ot,background:"#28a745",color:"#fff"},colAction:{...ot,background:"#0056b3",color:"#fff"},delete:{...ot,background:"#dc3545",color:"#fff"},divider:{width:"1px",height:"24px",background:"#ddd",margin:"0 4px"}}),[]),Z=c.useMemo(()=>({position:"fixed",top:`${s.top}px`,left:`${s.left}px`,zIndex:999,background:"#fff",border:"1px solid #ddd",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"8px",display:"flex",gap:"2px",alignItems:"center",pointerEvents:f?"auto":"none",minWidth:"100px",minHeight:"32px",opacity:f?1:0,visibility:f?"visible":"hidden",transition:"opacity 0.15s ease, visibility 0.15s ease"}),[s,f]);return!e||typeof document>"u"?null:Xt.createPortal(m.jsxs("div",{ref:y,className:"table-tooltip-menu","data-menu-position":p,"aria-hidden":!f,style:Z,children:[m.jsx("button",{className:`tooltip-button ${g==="left"?"active":""}`,onClick:()=>P("left"),title:"Align Left",style:C(g==="left"),children:m.jsx(Pt,{size:14})}),m.jsx("button",{className:`tooltip-button ${g==="center"?"active":""}`,onClick:()=>P("center"),title:"Align Center",style:C(g==="center"),children:m.jsx(Ot,{size:14})}),m.jsx("button",{className:`tooltip-button ${g==="right"?"active":""}`,onClick:()=>P("right"),title:"Align Right",style:C(g==="right"),children:m.jsx(Nt,{size:14})}),n!=null&&m.jsxs(m.Fragment,{children:[m.jsx("div",{style:L.divider}),m.jsx("button",{className:"tooltip-button insert-row-above",onClick:w,title:"Insert Row Above",style:L.rowAction,children:m.jsx(zo,{size:14})}),m.jsx("button",{className:"tooltip-button insert-row-below",onClick:v,title:"Insert Row Below",style:L.rowAction,children:m.jsx(Do,{size:14})}),m.jsx("button",{className:"tooltip-button delete-row",onClick:_,title:"Delete Row",style:L.delete,children:m.jsx(Mt,{size:14})})]}),a!=null&&m.jsxs(m.Fragment,{children:[m.jsx("div",{style:L.divider}),m.jsx("button",{className:"tooltip-button insert-column-left",onClick:b,title:"Insert Column Left",style:L.colAction,children:m.jsx(Bo,{size:14})}),m.jsx("button",{className:"tooltip-button insert-column-right",onClick:N,title:"Insert Column Right",style:L.colAction,children:m.jsx(jo,{size:14})}),m.jsx("button",{className:"tooltip-button delete-column",onClick:M,title:"Delete Column",style:L.delete,children:m.jsx(Mt,{size:14})})]})]}),document.body)};jt.propTypes={tableElement:x.instanceOf(typeof Element<"u"?Element:Object),onAlignChange:x.func,onClose:x.func.isRequired,selectedRowIndex:x.number,selectedColIndex:x.number,editorRef:x.shape({current:x.instanceOf(typeof Element<"u"?Element:Object)})},jt.defaultProps={tableElement:null,onAlignChange:void 0,selectedRowIndex:null,selectedColIndex:null,editorRef:null};const sa=".table-cell-selected, .table-row-selected, .table-col-selected",ur=()=>{Fs(sa,["table-cell-selected","table-row-selected","table-col-selected"])},zt=({editorRef:e,onCellSelectionChange:t})=>{const r=c.useRef({selectedCells:new Set,selectionMode:null,selectedRowIndex:null,selectedColIndex:null,currentTable:null,isSelecting:!1,hasDragged:!1,startCell:null}),[n,a]=c.useState(!1),[o,s]=c.useState(!1),[i,f]=c.useState(null),[l,p]=c.useState(null),d=c.useRef(null),g=c.useCallback(()=>{r.current={selectedCells:new Set,selectionMode:null,selectedRowIndex:null,selectedColIndex:null,currentTable:null,isSelecting:!1,hasDragged:!1,startCell:null},a(!1),s(!1),f(null),p(null)},[]),h=c.useCallback(()=>{g(),ur(),d.current!==null&&(d.current=null,t&&t(null))},[t,g]),y=c.useCallback(b=>{const N=b.closest("tr"),_=b.closest("table");if(!N||!_)return null;const M=Array.from(_.rows).indexOf(N),C=Array.from(N.cells).indexOf(b);return{rowIndex:M,cellIndex:C,table:_}},[]),T=c.useCallback(b=>{if(b.size===0)return{mode:null,rowIndex:null,colIndex:null};const N=Array.from(b),_=N[0],M=y(_);if(!M)return{mode:null,rowIndex:null,colIndex:null};const{table:C}=M;return N.filter(D=>{const U=y(D);return U&&U.table===C&&U.rowIndex===M.rowIndex}).length>=2?{mode:"row",rowIndex:M.rowIndex,colIndex:null}:N.filter(D=>{const U=y(D);return U&&U.table===C&&U.cellIndex===M.cellIndex}).length>=2?{mode:"column",rowIndex:null,colIndex:M.cellIndex}:{mode:null,rowIndex:null,colIndex:null}},[y]),E=c.useCallback((b,N,_,M,C)=>{if(ur(),!(!C||!b)){if(b==="row"&&N!==null){const L=C.rows[N];L&&Array.from(L.cells).forEach(Z=>{Z.classList.add("table-row-selected")})}else b==="column"&&_!==null?Array.from(C.rows).forEach(L=>{const Z=L.cells[_];Z&&Z.classList.add("table-col-selected")}):b==="cells"&&M.forEach(L=>{L.classList.add("table-cell-selected")});Us()}},[]),A=c.useCallback((b,N)=>{const _=T(b);r.current.selectedCells=b,r.current.selectionMode=_.mode,r.current.selectedRowIndex=_.rowIndex,r.current.selectedColIndex=_.colIndex,r.current.currentTable=N,p(N),E(_.mode,_.rowIndex,_.colIndex,b,N);const M=_.mode?{mode:_.mode,cells:b,rowIndex:_.rowIndex,colIndex:_.colIndex,table:N}:null;JSON.stringify(d.current)!==JSON.stringify(M)&&(d.current=M,t&&t(M))},[T,E,t]),P=c.useCallback(b=>{const N=b.target.closest("td, th");if(!N)return;const _=y(N);_&&(a(!0),f(N),p(_.table),s(!1))},[y]),O=c.useCallback(b=>{if(!n||!i)return;const N=b.target.closest("td, th");if(!N||!l||!er(l,N))return;s(!0),Je(b);const _=y(i),M=y(N);if(!_||!M||_.table!==M.table)return;const C=Math.min(_.rowIndex,M.rowIndex),L=Math.max(_.rowIndex,M.rowIndex),Z=Math.min(_.cellIndex,M.cellIndex),D=Math.max(_.cellIndex,M.cellIndex),U=new Set;for(let Q=C;Q<=L;Q++){const V=l.rows[Q];if(V)for(let ne=Z;ne<=D;ne++){const oe=V.cells[ne];oe&&U.add(oe)}}A(U,l)},[n,i,l,y,A]),w=c.useCallback(()=>{o||h(),a(!1),f(null)},[o,h]),v=c.useCallback(b=>{const N=b.target.closest("td, th"),_=b.target.closest("table");if(!(N&&l&&er(l,N))){if(_&&_!==l){h();return}_||h()}},[h,l]);return c.useEffect(()=>{if(!e.current)return;const b=e.current,N=M=>{M.target.closest("td, th")&&P(M)},_=M=>{M.target.closest("td, th")&&O(M)};return b.addEventListener("mousedown",N,!0),b.addEventListener("mouseenter",_,!0),document.addEventListener("mouseup",w),document.addEventListener("click",v),()=>{b.removeEventListener("mousedown",N,!0),b.removeEventListener("mouseenter",_,!0),document.removeEventListener("mouseup",w),document.removeEventListener("click",v)}},[e,P,O,w,v]),c.useEffect(()=>{if(!e.current)return;const b=new MutationObserver(N=>{N.forEach(_=>{_.type==="childList"&&l&&!e.current.contains(l)&&h()})});return b.observe(e.current,{childList:!0,subtree:!0}),()=>b.disconnect()},[e,h,l]),null};zt.propTypes={editorRef:x.shape({current:x.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onCellSelectionChange:x.func},zt.defaultProps={onCellSelectionChange:void 0};const aa=50,$t=50,ia=50,ca=100,la=300,st=c.forwardRef(({pageManagerComponent:e=null,onNavigatePage:t,onAddPage:r,onDeletePage:n,onPageSizeChange:a,onPageMarginsChange:o,onChange:s,showSidebar:i=!0,showToolbar:f=!0,showPageManager:l=!0},p)=>{const d=Et(),g=me(),{pageSize:h,pageMargins:y,continuousContent:T,pageBoundaries:E,activePage:A,zoomLevel:P,canUndo:O,canRedo:w}=d,v=c.useRef(null),b=c.useRef(null),{currentFormat:N,formatText:_,updateCurrentFormatFromSelection:M}=xn(),[C,L]=c.useState(!1),[Z,D]=c.useState(null),[U,Q]=c.useState(!0),[V,ne]=c.useState(!1),[oe,ae]=c.useState(null),[S,u]=c.useState(null),[R,B]=c.useState(null),{checkAndUpdateBoundaries:j,getCurrentPage:F,scrollToPage:W,updateBoundaries:I,triggerAutoReflow:q,removePageAndContent:X,removePageBreak:K,insertPageBreakAtBoundary:se}=kn(h,b,P,y),H=c.useMemo(()=>we(h),[h]),[ce,ke]=c.useState(!1),fe=c.useRef(null),at=c.useRef(!1),it=c.useRef(!1),ct=c.useRef(!1),lt=c.useRef(T),Ut=c.useCallback(()=>{at.current=!1;const k=Math.max(0,E.length-1);g.setActivePage(k),setTimeout(()=>{W(k,v)},ia)},[E.length,g,W]);c.useEffect(()=>{if(!b.current||ct.current)return;b.current.innerHTML=T,ct.current=!0,lt.current=T;const k=setTimeout(()=>{I()},aa);return()=>clearTimeout(k)},[]),c.useEffect(()=>{if(!b.current||!ct.current)return;if(b.current.innerHTML!==T){b.current.innerHTML=T;const re=setTimeout(()=>{I(),at.current&&Ut()},$t);return lt.current=T,()=>clearTimeout(re)}},[T,I,Ut]),c.useEffect(()=>{s&&ct.current&&s(T)},[T,s]);const{restoreCursorPosition:Wt,hasActiveCursorSelection:Gt}=go({updateCurrentFormatFromSelection:M,editorRef:b}),ua=c.useCallback(k=>{k!==T&&g.updateContinuousContent(k),b.current&&b.current.innerHTML!==k&&(b.current.innerHTML=k),lt.current=k,setTimeout(()=>{I()},$t)},[T,g,I]),qt=c.useCallback(k=>{if(!b.current||!k)return;Gt()||Wt(),document.execCommand("insertHTML",!1,k);const re=b.current.innerHTML;g.updateContinuousContent(re),lt.current=re,setTimeout(()=>{I(),q(200)},$t)},[Gt,Wt,g,I,q]),dr=c.useMemo(()=>({getHTMLContent:()=>b.current?b.current.innerHTML:T,getSelectedHTMLContent:()=>{if(!b.current)return"";const k=window.getSelection();if(!k||k.rangeCount===0)return"";const re=k.getRangeAt(0);if(!b.current.contains(re.commonAncestorContainer))return"";if(re.collapsed){const pe=re.commonAncestorContainer;return pe.nodeType===Node.TEXT_NODE?pe.parentElement?pe.parentElement.outerHTML:"":pe.outerHTML||""}let le=re.commonAncestorContainer;if(le.nodeType===Node.TEXT_NODE&&(le=le.parentElement),le===b.current){const pe=re.cloneContents(),Oe=document.createElement("div");return Oe.appendChild(pe),Oe.innerHTML}return le?le.outerHTML:""},getPlainText:()=>(b.current?b.current.innerHTML:T).replace(/<[^>]*>/g," ").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\s+/g," ").trim(),getCursorPosition:()=>b.current?uo(b.current):null,setContent:k=>{const re=Ze(k);ua(re)},setPageSize:k=>{g.updatePageSize(k),I({pageSize:k})},setPageMargins:k=>{g.updatePageMargins(k),I({pageMargins:k})},insertContent:k=>{const re=Ze(k);qt(re)}}),[T,g,I,q,Gt,Wt]);c.useImperativeHandle(p,()=>dr,[dr]);const Zt=c.useCallback(()=>{if(!b.current)return;let k=b.current.innerHTML;k=Ze(k),k!==b.current.innerHTML&&(b.current.innerHTML=k);const re=T;if(re!==k){const pe={type:"UPDATE_CONTINUOUS_CONTENT",payload:k},Oe={type:"UPDATE_CONTINUOUS_CONTENT",payload:re};g.recordOperation(pe,Oe)}g.updateContinuousContent(k),j(),q(200);const le=F(v);le!==A&&g.setActivePage(le)},[g,j,F,A,q,v,b,T]),da=c.useCallback(k=>{Zt()},[Zt]),fr=c.useCallback(k=>{g.updatePageSize(k),I({pageSize:k}),a&&a(k)},[g,I,a]),pr=c.useCallback(k=>{g.updatePageMargins(k),I({pageMargins:k}),o&&o(k)},[g,I,o]),gr=c.useCallback(k=>{k<0||k>=E.length||(it.current=!0,g.setActivePage(k),W(k,v),setTimeout(()=>{it.current=!1},la),t&&t(k))},[g,W,t,E.length]),hr=c.useCallback(()=>{const k=E.length+1;se(k)&&(at.current=!0,setTimeout(()=>{at.current&&Ut()},100)),r&&r()},[E.length,se,g,W,r]),fa=c.useCallback(()=>{const k=window.getSelection();if(k&&k.rangeCount>0){if(!b?.current)return;const pe=`<page-break data-page-break="true" contenteditable="false" data-page-number="${b.current.querySelectorAll('page-break, [data-page-break="true"]').length+2}"></page-break><p><br></p>`;document.execCommand("insertHTML",!1,pe),setTimeout(()=>{I();const Oe=F(v);g.setActivePage(Oe)},150)}},[I,F,g,v]),pa=c.useCallback(k=>{qt(k)},[qt]),ga=c.useCallback(k=>{if(!k)return;K(k)&&setTimeout(()=>{const le=F(v);g.setActivePage(le)},200)},[K,F,g,v]),mr=c.useCallback(k=>{if(E.length<=1){console.warn("Cannot delete the only page");return}X(k)&&(g.setActivePage(0),n&&n(k))},[E.length,X,g,n]),ha=c.useMemo(()=>({handleZoomIn:()=>g.zoomIn(),handleZoomOut:()=>g.zoomOut(),handleZoomReset:()=>g.resetZoom(),handleUndo:()=>g.undo(),handleRedo:()=>g.redo()}),[g]),{handleZoomIn:Vt,handleZoomOut:Yt,handleZoomReset:Kt,handleUndo:ma,handleRedo:ya}=ha;po({handleZoomIn:Vt,handleZoomOut:Yt,handleZoomReset:Kt,handleUndo:ma,handleRedo:ya},{editorRef:b,containerRef:v});const ba=c.useCallback(()=>{!v.current||!b.current||it.current||(fe.current&&clearTimeout(fe.current),fe.current=setTimeout(()=>{if(it.current){fe.current=null;return}const k=F(v);k!==A&&k>=0&&g.setActivePage(k),fe.current=null},ca))},[F,A,g]),Ta=c.useMemo(()=>{if(!T)return 0;const re=T.replace(/<[^>]*>/g," ").match(new RegExp("\\p{L}+","gu"));return re?re.length:0},[T]),Ea=E.length||1,va=c.useCallback(k=>{L(!0),D(k)},[]),yr=c.useCallback(()=>{L(!1),D(null)},[]),xa=c.useCallback((k,re)=>{},[]),wa=c.useCallback(k=>{k&&k.mode==="row"?(u(k.rowIndex),B(null)):k&&k.mode==="column"?(B(k.colIndex),u(null)):(u(null),B(null))},[]),Ca=c.useCallback(k=>{ne(!0),ae(k)},[]),br=c.useCallback(()=>{ne(!1),ae(null)},[]),Aa=c.useCallback((k,re)=>{},[]);return c.useEffect(()=>()=>{fe.current&&clearTimeout(fe.current)},[]),m.jsxs("div",{className:"multi-page-editor",children:[f&&m.jsx(Ye,{currentFormat:{...N,imageSelected:C},onFormatText:_,onAddPageBreak:fa,onInsertImage:pa,canUndo:O,canRedo:w}),m.jsxs("div",{className:"editor-container",children:[i&&m.jsx(zn,{editorView:null,isCollapsed:ce,onToggle:()=>ke(k=>!k),wordCount:Ta,pageCount:Ea}),m.jsx("div",{className:"editor-viewport continuous-scroll",ref:v,onScroll:ba,children:m.jsx(Yn,{content:T,dimensions:H,pageSize:h,pageMargins:y,pageBoundaries:E,editorRef:b,onInput:da,onContentChange:Zt,onClick:()=>b.current?.focus(),onRemovePageBreak:ga,zoomLevel:P})}),m.jsx(Xe,{editorRef:b,onImageSelect:va,onImageDeselect:yr,onImageResize:xa,resizeOptions:{...Ee,preserveAspectRatio:U,aspectRatio:U}}),m.jsx(rt,{editorRef:b,onTableSelect:Ca,onTableDeselect:br,onTableResize:Aa}),m.jsx(zt,{editorRef:b,onCellSelectionChange:wa}),C&&Z&&m.jsx(Dt,{imageElement:Z,initialPreserveAspectRatio:U,onAlignChange:k=>{},onAspectRatioToggle:k=>{Q(k)},onDelete:()=>{if(Z){const k=Z.getAttribute("data-key");k&&Ln(k).catch(re=>{console.error("Failed to delete image from IndexedDB:",re)})}},onClose:yr}),V&&oe&&m.jsx(jt,{tableElement:oe,onAlignChange:k=>{},onClose:br,selectedRowIndex:S,selectedColIndex:R,editorRef:b}),l&&m.jsx("div",{className:"page-manager-sidebar",children:e?c.cloneElement(e,{onNavigate:gr,onAddPage:hr,onDeletePage:mr,onPageSizeChange:fr,onPageMarginsChange:pr,zoomLevel:P,canZoomIn:gt(P),canZoomOut:ht(P),onZoomIn:Vt,onZoomOut:Yt,onZoomReset:Kt}):m.jsx(Xn,{pageBoundaries:E,activePage:A,pageSize:h,pageMargins:y,zoomLevel:P,canZoomIn:gt(P),canZoomOut:ht(P),onNavigate:gr,onAddPage:hr,onDeletePage:mr,onPageSizeChange:fr,onPageMarginsChange:pr,onZoomIn:Vt,onZoomOut:Yt,onZoomReset:Kt})})]})]})});st.displayName="HtmlEditor",st.propTypes={pageManagerComponent:x.element,onNavigatePage:x.func,onAddPage:x.func,onDeletePage:x.func,onPageSizeChange:x.func,onPageMarginsChange:x.func,onChange:x.func,showSidebar:x.bool,showToolbar:x.bool,showPageManager:x.bool},st.defaultProps={pageManagerComponent:null,onNavigatePage:void 0,onAddPage:void 0,onDeletePage:void 0,onPageSizeChange:void 0,onPageMarginsChange:void 0,onChange:void 0,showSidebar:!0,showToolbar:!0,showPageManager:!0};class Ft extends c.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,r){console.error("[ErrorBoundary] Caught error:",t),console.error("[ErrorBoundary] Error info:",r),this.setState({error:t,errorInfo:r}),this.props.onError&&this.props.onError(t,r)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onReset&&this.props.onReset()};render(){return this.state.hasError?this.props.fallback?this.props.fallback:m.jsxs("div",{style:{padding:"20px",margin:"20px",border:"2px solid #f44336",borderRadius:"4px",backgroundColor:"#ffebee",color:"#c62828"},children:[m.jsx("h2",{style:{marginTop:0},children:"⚠️ Something went wrong"}),m.jsx("p",{children:"The editor encountered an unexpected error and couldn't continue."}),this.props.showDetails&&this.state.error&&m.jsxs("details",{style:{marginTop:"10px",padding:"10px",backgroundColor:"white",borderRadius:"4px",fontSize:"12px",fontFamily:"monospace"},children:[m.jsx("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Error Details"}),m.jsxs("pre",{style:{marginTop:"10px",overflow:"auto",maxHeight:"200px"},children:[this.state.error.toString(),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}),m.jsx("button",{onClick:this.handleReset,style:{marginTop:"15px",padding:"8px 16px",backgroundColor:"#f44336",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:"Try Again"})]}):this.props.children}}Ft.propTypes={children:x.node.isRequired,fallback:x.node,onError:x.func,onReset:x.func,showDetails:x.bool},Ft.defaultProps={fallback:null,onError:void 0,onReset:void 0,showDetails:process.env.NODE_ENV==="development"},z.COMMON_FONT_SIZES=bn,z.ColorPickerDropdown=Rt,z.DEFAULT_FONT_SIZE=Ie,z.DEFAULT_IMAGE_RESIZE_OPTIONS=Ee,z.DEFAULT_PAGE_SIZE=mt,z.DEFAULT_TABLE_RESIZE_OPTIONS=Qe,z.DocumentProvider=Pr,z.EditorToolbar=Ye,z.ErrorBoundary=Ft,z.FONT_SIZE_MAP=kt,z.HtmlEditor=st,z.ImageResizeHandlers=Xe,z.PAGE_SIZES=Me,z.PageManager=Xn,z.PageView=Yn,z.RESIZE_HANDLERS=$,z.Sidebar=zn,z.TABLE_RESIZE_HANDLERS=J,z.TableResizeHandlers=rt,z.applyImageDimensions=yo,z.applyTableDimensions=Ce,z.calculateResizeDimensions=ho,z.calculateTableResizeDimensions=tr,z.clearImages=xo,z.createResizeOverlay=On,z.createTableResizeOverlay=nr,z.deleteImage=Ln,z.getAllImageKeys=wo,z.getAvailablePageSizes=kr,z.getImage=Mn,z.getImageDimensions=mo,z.getPageDimensions=we,z.getPixelValue=zr,z.getPointValue=$r,z.getTableStructure=de,z.isResizableImage=be,z.isResizableTable=ue,z.isValidFontSize=Fr,z.isValidPageSize=Sr,z.logger=$n,z.pixelsToPoints=En,z.pointsToPixels=Tn,z.removeResizeOverlay=qe,z.removeTableResizeOverlay=Ae,z.saveImage=Pn,z.updateResizeOverlay=Ge,z.updateTableResizeOverlay=nt,z.useContinuousReflow=kn,z.useDocument=Tt,z.useDocumentActions=me,z.useDocumentState=Et,z.useFormatting=xn,Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=htmleditor.umd.cjs.map
