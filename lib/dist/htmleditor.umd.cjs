(function(F,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("react"),require("uuid"),require("react-dom")):typeof define=="function"&&define.amd?define(["exports","react","uuid","react-dom"],c):(F=typeof globalThis<"u"?globalThis:F||self,c(F.HTMLEditor={},F.React,F.uuid,F.ReactDOM))})(this,(function(F,c,ut,Ut){"use strict";function ir(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var $e={exports:{}},Se={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wt;function lr(){if(Wt)return Se;Wt=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function r(n,a,o){var s=null;if(o!==void 0&&(s=""+o),a.key!==void 0&&(s=""+a.key),"key"in a){o={};for(var i in a)i!=="key"&&(o[i]=a[i])}else o=a;return a=o.ref,{$$typeof:e,type:n,key:s,ref:a!==void 0?a:null,props:o}}return Se.Fragment=t,Se.jsx=r,Se.jsxs=r,Se}var Ne={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qt;function cr(){return qt||(qt=1,process.env.NODE_ENV!=="production"&&(function(){function e(p){if(p==null)return null;if(typeof p=="function")return p.$$typeof===q?null:p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case _:return"Fragment";case L:return"Profiler";case z:return"StrictMode";case b:return"Suspense";case I:return"SuspenseList";case G:return"Activity"}if(typeof p=="object")switch(typeof p.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),p.$$typeof){case E:return"Portal";case m:return p.displayName||"Context";case M:return(p._context.displayName||"Context")+".Consumer";case g:var O=p.render;return p=p.displayName,p||(p=O.displayName||O.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case S:return O=p.displayName||null,O!==null?O:e(p.type)||"Memo";case j:O=p._payload,p=p._init;try{return e(p(O))}catch{}}return null}function t(p){return""+p}function r(p){try{t(p);var O=!1}catch{O=!0}if(O){O=console;var H=O.error,R=typeof Symbol=="function"&&Symbol.toStringTag&&p[Symbol.toStringTag]||p.constructor.name||"Object";return H.call(O,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",R),t(p)}}function n(p){if(p===_)return"<>";if(typeof p=="object"&&p!==null&&p.$$typeof===j)return"<...>";try{var O=e(p);return O?"<"+O+">":"<...>"}catch{return"<...>"}}function a(){var p=B.A;return p===null?null:p.getOwner()}function o(){return Error("react-stack-top-frame")}function s(p){if(C.call(p,"key")){var O=Object.getOwnPropertyDescriptor(p,"key").get;if(O&&O.isReactWarning)return!1}return p.key!==void 0}function i(p,O){function H(){P||(P=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",O))}H.isReactWarning=!0,Object.defineProperty(p,"key",{get:H,configurable:!0})}function h(){var p=e(this.type);return V[p]||(V[p]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),p=this.props.ref,p!==void 0?p:null}function u(p,O,H,R,K,Z){var $=H.ref;return p={$$typeof:T,type:p,key:O,props:H,_owner:R},($!==void 0?$:null)!==null?Object.defineProperty(p,"ref",{enumerable:!1,get:h}):Object.defineProperty(p,"ref",{enumerable:!1,value:null}),p._store={},Object.defineProperty(p._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(p,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(p,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:K}),Object.defineProperty(p,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:Z}),Object.freeze&&(Object.freeze(p.props),Object.freeze(p)),p}function l(p,O,H,R,K,Z){var $=O.children;if($!==void 0)if(R)if(N($)){for(R=0;R<$.length;R++)d($[R]);Object.freeze&&Object.freeze($)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else d($);if(C.call(O,"key")){$=e(p);var W=Object.keys(O).filter(function(ee){return ee!=="key"});R=0<W.length?"{key: someKey, "+W.join(": ..., ")+": ...}":"{key: someKey}",x[$+R]||(W=0<W.length?"{"+W.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,R,$,W,$),x[$+R]=!0)}if($=null,H!==void 0&&(r(H),$=""+H),s(O)&&(r(O.key),$=""+O.key),"key"in O){H={};for(var J in O)J!=="key"&&(H[J]=O[J])}else H=O;return $&&i(H,typeof p=="function"?p.displayName||p.name||"Unknown":p),u(p,$,H,a(),K,Z)}function d(p){f(p)?p._store&&(p._store.validated=1):typeof p=="object"&&p!==null&&p.$$typeof===j&&(p._payload.status==="fulfilled"?f(p._payload.value)&&p._payload.value._store&&(p._payload.value._store.validated=1):p._store&&(p._store.validated=1))}function f(p){return typeof p=="object"&&p!==null&&p.$$typeof===T}var v=c,T=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),z=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),M=Symbol.for("react.consumer"),m=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),S=Symbol.for("react.memo"),j=Symbol.for("react.lazy"),G=Symbol.for("react.activity"),q=Symbol.for("react.client.reference"),B=v.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,C=Object.prototype.hasOwnProperty,N=Array.isArray,A=console.createTask?console.createTask:function(){return null};v={react_stack_bottom_frame:function(p){return p()}};var P,V={},re=v.react_stack_bottom_frame.bind(v,o)(),oe=A(n(o)),x={};Ne.Fragment=_,Ne.jsx=function(p,O,H){var R=1e4>B.recentlyCreatedOwnerStacks++;return l(p,O,H,!1,R?Error("react-stack-top-frame"):re,R?A(n(p)):oe)},Ne.jsxs=function(p,O,H){var R=1e4>B.recentlyCreatedOwnerStacks++;return l(p,O,H,!0,R?Error("react-stack-top-frame"):re,R?A(n(p)):oe)}})()),Ne}var Gt;function ur(){return Gt||(Gt=1,process.env.NODE_ENV==="production"?$e.exports=lr():$e.exports=cr()),$e.exports}var y=ur();const dt=100,ft=50,pt=200,Zt=5,gt=e=>e<pt,ht=e=>e>ft,dr=96,ye=e=>Math.round(e*dr),ze={NORMAL:{name:"Normal",label:'Normal (1")',top:1,bottom:1,left:1,right:1},NARROW:{name:"Narrow",label:'Narrow (0.5")',top:.5,bottom:.5,left:.5,right:.5},MODERATE:{name:"Moderate",label:'Moderate (1" / 0.75")',top:1,bottom:1,left:.75,right:.75},WIDE:{name:"Wide",label:'Wide (1" / 2")',top:1,bottom:1,left:2,right:2},OFFICE_2003:{name:"Office 2003",label:'Office 2003 (1" / 1.25")',top:1,bottom:1,left:1.25,right:1.25}},fe="NORMAL",Yt=(e=fe)=>{if(typeof e=="object"&&e!==null&&typeof e.top=="number"&&typeof e.bottom=="number"&&typeof e.left=="number"&&typeof e.right=="number")return{top:ye(e.top),bottom:ye(e.bottom),left:ye(e.left),right:ye(e.right)};const t=ze[e]||ze[fe];return{top:ye(t.top),bottom:ye(t.bottom),left:ye(t.left),right:ye(t.right)}},fr=(e=fe)=>{const t=Yt(e);return t.top+t.bottom},pr=()=>Object.keys(ze),gr=e=>{if(typeof e=="object"&&e!==null&&typeof e.top=="number"&&typeof e.bottom=="number"&&typeof e.left=="number"&&typeof e.right=="number")return`Custom (${e.top}" / ${e.left}")`;const t=ze[e];return t?t.label:"Unknown"},Oe={A4:{name:"A4",width:794,height:1123,widthMm:210,heightMm:297,widthIn:8.27,heightIn:11.69},Letter:{name:"Letter",width:816,height:1056,widthMm:216,heightMm:279,widthIn:8.5,heightIn:11},Legal:{name:"Legal",width:816,height:1344,widthMm:216,heightMm:356,widthIn:8.5,heightIn:14}},mt="A4",_e=e=>{const t=Oe[e]||Oe[mt];return{width:t.width,height:t.height}},hr=e=>Object.keys(Oe).includes(e),mr=()=>Object.keys(Oe),Pe=mt,ve="<p><br></p>",yr="continuous",Me=(e,t=Pe)=>({id:ut.v4(),index:e,size:t,content:ve,images:[],isBreakPoint:!1}),Fe=e=>typeof e!="string"||e.trim()===""?ve:e,Vt=(e,t=Pe)=>(e.length>0?e:[Me(0,t)]).map((n,a)=>({id:n.id||ut.v4(),index:a,size:n.size||t,content:Fe(n.content),images:n.images||[],isBreakPoint:!!n.isBreakPoint})),br=(e=Pe)=>[{id:"page-0",pageNumber:1,top:0,height:_e(e).height}],Ue=e=>e.slice(0,-1).map((t,r)=>({id:`auto-break-${r}`,pageNumber:r+1})),yt=(e={})=>{const t=new Date().toISOString(),r=e.pageSize||Pe,n=Vt(e.pages||[Me(0,r)],r);return{id:ut.v4(),title:e.title||"Untitled Document",createdAt:t,updatedAt:t,pageSize:r,pages:n,activePage:e.activePage&&e.activePage<n.length?e.activePage:0,pageBreaks:e.pageBreaks||[],totalPages:n.length,editorMode:e.editorMode||yr,continuousContent:e.continuousContent||ve,pageBoundaries:e.pageBoundaries||br(r),zoomLevel:e.zoomLevel||dt,pageMargins:e.pageMargins||fe,undoStack:[],redoStack:[],canUndo:!1,canRedo:!1}},Y={INITIALIZE_DOCUMENT:"INITIALIZE_DOCUMENT",UPDATE_TITLE:"UPDATE_TITLE",UPDATE_PAGE_CONTENT:"UPDATE_PAGE_CONTENT",UPDATE_PAGES:"UPDATE_PAGES",ADD_PAGE:"ADD_PAGE",DELETE_PAGE:"DELETE_PAGE",SET_ACTIVE_PAGE:"SET_ACTIVE_PAGE",UPDATE_PAGE_SIZE:"UPDATE_PAGE_SIZE",RESET_DOCUMENT:"RESET_DOCUMENT",UPDATE_CONTINUOUS_CONTENT:"UPDATE_CONTINUOUS_CONTENT",UPDATE_PAGE_BOUNDARIES:"UPDATE_PAGE_BOUNDARIES",ADD_PAGE_BREAK:"ADD_PAGE_BREAK",REMOVE_PAGE_BREAK:"REMOVE_PAGE_BREAK",SET_EDITOR_MODE:"SET_EDITOR_MODE",SET_ZOOM_LEVEL:"SET_ZOOM_LEVEL",ZOOM_IN:"ZOOM_IN",ZOOM_OUT:"ZOOM_OUT",RESET_ZOOM:"RESET_ZOOM",UPDATE_PAGE_MARGINS:"UPDATE_PAGE_MARGINS",RECORD_OPERATION:"RECORD_OPERATION",UNDO:"UNDO",REDO:"REDO",CLEAR_UNDO_REDO:"CLEAR_UNDO_REDO"},bt=(e,t)=>{const r=new Date().toISOString();switch(t.type){case Y.INITIALIZE_DOCUMENT:{const{initialContent:n=ve,pageSize:a=Pe}=t.payload||{},o={...Me(0,a),content:Fe(n)};return yt({title:e.title,pageSize:a,pages:[o]})}case Y.UPDATE_TITLE:return{...e,title:t.payload,updatedAt:r};case Y.UPDATE_PAGE_CONTENT:{const{pageIndex:n,content:a}=t.payload;if(n<0||n>=e.pages.length)return e;const o=[...e.pages];return o[n]={...o[n],content:Fe(a)},{...e,pages:o,updatedAt:r}}case Y.UPDATE_PAGES:{const n=Array.isArray(t.payload)?{pages:t.payload}:t.payload||{},a=Vt(n.pages||[],e.pageSize),o=Array.isArray(n.pageBreaks)?n.pageBreaks:Ue(a);return{...e,pages:a,activePage:Math.min(e.activePage,a.length-1),pageBreaks:o,totalPages:a.length,updatedAt:r}}case Y.ADD_PAGE:{const n=typeof t.payload?.index=="number"?Math.min(Math.max(t.payload.index,0),e.pages.length):e.pages.length,a=[...e.pages];a.splice(n,0,Me(n,e.pageSize));const o=a.map((i,h)=>({...i,index:h,size:e.pageSize})),s=Ue(o);return{...e,pages:o,activePage:n,pageBreaks:s,totalPages:o.length,updatedAt:r}}case Y.DELETE_PAGE:{const n=t.payload;if(e.pages.length<=1)return e;const a=[...e.pages];a.splice(n,1);const o=a.map((h,u)=>({...h,index:u,size:e.pageSize}));let s=e.activePage;s>=o.length?s=o.length-1:n<=s&&s>0&&(s-=1);const i=Ue(o);return{...e,pages:o,activePage:s,pageBreaks:i,totalPages:o.length,updatedAt:r}}case Y.SET_ACTIVE_PAGE:{const n=t.payload;if(n===e.activePage)return e;const a=e.editorMode==="continuous"?e.pageBoundaries.length:e.pages.length;return n<0||n>=a?e:{...e,activePage:n,updatedAt:r}}case Y.UPDATE_PAGE_SIZE:{const n=t.payload;if(n===e.pageSize)return e;try{_e(n)}catch{return console.warn(`Invalid page size: ${n}`),e}const a=e.pages.map((s,i)=>({...s,index:i,size:n})),o=Ue(a);return{...e,pageSize:n,pages:a,pageBreaks:o,updatedAt:r}}case Y.RESET_DOCUMENT:return yt();case Y.UPDATE_CONTINUOUS_CONTENT:{const n=Fe(t.payload);return n===e.continuousContent?e:{...e,continuousContent:n,updatedAt:r}}case Y.UPDATE_PAGE_BOUNDARIES:{const n=Array.isArray(t.payload)?t.payload:[];if(n.length===e.pageBoundaries.length&&n.length>0&&n[0].id===e.pageBoundaries[0]?.id&&n[n.length-1].id===e.pageBoundaries[n.length-1]?.id)return e;const a=e.activePage>=n.length?Math.max(0,n.length-1):e.activePage;return{...e,pageBoundaries:n,totalPages:n.length,activePage:a,updatedAt:r}}case Y.ADD_PAGE_BREAK:{const{position:n="end",pageIndex:a}=t.payload||{},o='<page-break data-page-break="true" style="display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;"></page-break>';let s=e.continuousContent;if(n==="end")s=s+o+"<p><br></p>";else if(typeof n=="number"){const i=s.substring(0,n),h=s.substring(n);s=i+o+h}else if(typeof a=="number"&&typeof document<"u"){const i=document.createElement("div");i.innerHTML=s;const h=i.querySelectorAll('page-break, [data-page-break="true"]');if(a===0&&h.length===0)s=s+o+"<p><br></p>";else if(a<h.length){const u=h[a],l=document.createElement("page-break");l.setAttribute("data-page-break","true"),l.setAttribute("style","display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;");const d=document.createElement("p");d.innerHTML="<br>",u.parentNode.insertBefore(l,u.nextSibling),l.parentNode.insertBefore(d,l.nextSibling),s=i.innerHTML}else s=s+o+"<p><br></p>"}return{...e,continuousContent:s,updatedAt:r}}case Y.REMOVE_PAGE_BREAK:{const{pageIndex:n}=t.payload||{};if(typeof n!="number"||typeof document>"u")return e;const a=document.createElement("div");a.innerHTML=e.continuousContent;const o=a.querySelectorAll('page-break, [data-page-break="true"]');return o[n]&&o[n].remove(),a.querySelectorAll('page-break, [data-page-break="true"]').forEach((i,h)=>{i.setAttribute("data-page-number",String(h+2))}),{...e,continuousContent:a.innerHTML,updatedAt:r}}case Y.SET_EDITOR_MODE:{const n=t.payload;if(n===e.editorMode)return e;let a=e.continuousContent,o=e.pages;return n==="continuous"?a=e.pages.map(i=>i.content).filter(i=>i&&i!==ve).join(`
`)||ve:e.continuousContent&&e.continuousContent!==ve&&(o=[{...Me(0,e.pageSize),content:e.continuousContent}]),{...e,editorMode:n,continuousContent:a,pages:o,updatedAt:r}}case Y.SET_ZOOM_LEVEL:{const n=t.payload;return n<ft||n>pt?(console.warn(`Invalid zoom level: ${n}. Must be between ${ft} and ${pt}.`),e):n===e.zoomLevel?e:{...e,zoomLevel:n,updatedAt:r}}case Y.ZOOM_IN:{if(!gt(e.zoomLevel))return e;const n=e.zoomLevel+Zt;return{...e,zoomLevel:n,updatedAt:r}}case Y.ZOOM_OUT:{if(!ht(e.zoomLevel))return e;const n=e.zoomLevel-Zt;return{...e,zoomLevel:n,updatedAt:r}}case Y.RESET_ZOOM:return e.zoomLevel===dt?e:{...e,zoomLevel:dt,updatedAt:r};case Y.UPDATE_PAGE_MARGINS:{const n=t.payload;return n===e.pageMargins?e:{...e,pageMargins:n,updatedAt:r}}case Y.RECORD_OPERATION:{const{operation:n,inverseOperation:a}=t.payload;return{...e,undoStack:[...e.undoStack,{operation:n,inverseOperation:a}],redoStack:[],canUndo:!0,canRedo:!1,updatedAt:r}}case Y.UNDO:{if(e.undoStack.length===0)return e;const n=e.undoStack[e.undoStack.length-1],a=e.undoStack.slice(0,-1);let o=e;return n.inverseOperation&&(o=bt(e,n.inverseOperation)),{...o,undoStack:a,redoStack:[...e.redoStack,n],canUndo:a.length>0,canRedo:!0,updatedAt:r}}case Y.REDO:{if(e.redoStack.length===0)return e;const n=e.redoStack[e.redoStack.length-1],a=e.redoStack.slice(0,-1);let o=e;return n.operation&&(o=bt(e,n.operation)),{...o,undoStack:[...e.undoStack,n],redoStack:a,canUndo:!0,canRedo:a.length>0,updatedAt:r}}case Y.CLEAR_UNDO_REDO:return{...e,undoStack:[],redoStack:[],canUndo:!1,canRedo:!1,updatedAt:r};default:return e}},Kt=c.createContext(null),Tr=({children:e,initialState:t={}})=>{const[r,n]=c.useReducer(bt,yt(t)),a=c.useMemo(()=>({initializeDocument:s=>n({type:Y.INITIALIZE_DOCUMENT,payload:s}),updateTitle:s=>n({type:Y.UPDATE_TITLE,payload:s}),updatePageContent:s=>n({type:Y.UPDATE_PAGE_CONTENT,payload:s}),updatePages:s=>n({type:Y.UPDATE_PAGES,payload:s}),addPage:s=>n({type:Y.ADD_PAGE,payload:s}),deletePage:s=>n({type:Y.DELETE_PAGE,payload:s}),setActivePage:s=>n({type:Y.SET_ACTIVE_PAGE,payload:s}),updatePageSize:s=>n({type:Y.UPDATE_PAGE_SIZE,payload:s}),resetDocument:()=>n({type:Y.RESET_DOCUMENT}),updateContinuousContent:s=>n({type:Y.UPDATE_CONTINUOUS_CONTENT,payload:s}),updatePageBoundaries:s=>n({type:Y.UPDATE_PAGE_BOUNDARIES,payload:s}),addPageBreak:s=>n({type:Y.ADD_PAGE_BREAK,payload:s}),removePageBreak:s=>n({type:Y.REMOVE_PAGE_BREAK,payload:s}),setEditorMode:s=>n({type:Y.SET_EDITOR_MODE,payload:s}),setZoomLevel:s=>n({type:Y.SET_ZOOM_LEVEL,payload:s}),zoomIn:()=>n({type:Y.ZOOM_IN}),zoomOut:()=>n({type:Y.ZOOM_OUT}),resetZoom:()=>n({type:Y.RESET_ZOOM}),updatePageMargins:s=>n({type:Y.UPDATE_PAGE_MARGINS,payload:s}),recordOperation:(s,i)=>n({type:Y.RECORD_OPERATION,payload:{operation:s,inverseOperation:i}}),undo:()=>n({type:Y.UNDO}),redo:()=>n({type:Y.REDO}),clearUndoRedo:()=>n({type:Y.CLEAR_UNDO_REDO})}),[]),o=c.useMemo(()=>({state:r,actions:a,dispatch:n}),[r,a]);return y.jsx(Kt.Provider,{value:o,children:e})},Tt=()=>{const e=c.useContext(Kt);if(!e)throw new Error("useDocument must be used within a DocumentProvider");return e},vt=()=>{const{state:e}=Tt();return e},pe=()=>{const{actions:e}=Tt();return e};var We={exports:{}},qe={exports:{}},te={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xt;function vr(){if(Xt)return te;Xt=1;var e=typeof Symbol=="function"&&Symbol.for,t=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,n=e?Symbol.for("react.fragment"):60107,a=e?Symbol.for("react.strict_mode"):60108,o=e?Symbol.for("react.profiler"):60114,s=e?Symbol.for("react.provider"):60109,i=e?Symbol.for("react.context"):60110,h=e?Symbol.for("react.async_mode"):60111,u=e?Symbol.for("react.concurrent_mode"):60111,l=e?Symbol.for("react.forward_ref"):60112,d=e?Symbol.for("react.suspense"):60113,f=e?Symbol.for("react.suspense_list"):60120,v=e?Symbol.for("react.memo"):60115,T=e?Symbol.for("react.lazy"):60116,E=e?Symbol.for("react.block"):60121,_=e?Symbol.for("react.fundamental"):60117,z=e?Symbol.for("react.responder"):60118,L=e?Symbol.for("react.scope"):60119;function M(g){if(typeof g=="object"&&g!==null){var b=g.$$typeof;switch(b){case t:switch(g=g.type,g){case h:case u:case n:case o:case a:case d:return g;default:switch(g=g&&g.$$typeof,g){case i:case l:case T:case v:case s:return g;default:return b}}case r:return b}}}function m(g){return M(g)===u}return te.AsyncMode=h,te.ConcurrentMode=u,te.ContextConsumer=i,te.ContextProvider=s,te.Element=t,te.ForwardRef=l,te.Fragment=n,te.Lazy=T,te.Memo=v,te.Portal=r,te.Profiler=o,te.StrictMode=a,te.Suspense=d,te.isAsyncMode=function(g){return m(g)||M(g)===h},te.isConcurrentMode=m,te.isContextConsumer=function(g){return M(g)===i},te.isContextProvider=function(g){return M(g)===s},te.isElement=function(g){return typeof g=="object"&&g!==null&&g.$$typeof===t},te.isForwardRef=function(g){return M(g)===l},te.isFragment=function(g){return M(g)===n},te.isLazy=function(g){return M(g)===T},te.isMemo=function(g){return M(g)===v},te.isPortal=function(g){return M(g)===r},te.isProfiler=function(g){return M(g)===o},te.isStrictMode=function(g){return M(g)===a},te.isSuspense=function(g){return M(g)===d},te.isValidElementType=function(g){return typeof g=="string"||typeof g=="function"||g===n||g===u||g===o||g===a||g===d||g===f||typeof g=="object"&&g!==null&&(g.$$typeof===T||g.$$typeof===v||g.$$typeof===s||g.$$typeof===i||g.$$typeof===l||g.$$typeof===_||g.$$typeof===z||g.$$typeof===L||g.$$typeof===E)},te.typeOf=M,te}var ne={};/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jt;function Er(){return Jt||(Jt=1,process.env.NODE_ENV!=="production"&&(function(){var e=typeof Symbol=="function"&&Symbol.for,t=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,n=e?Symbol.for("react.fragment"):60107,a=e?Symbol.for("react.strict_mode"):60108,o=e?Symbol.for("react.profiler"):60114,s=e?Symbol.for("react.provider"):60109,i=e?Symbol.for("react.context"):60110,h=e?Symbol.for("react.async_mode"):60111,u=e?Symbol.for("react.concurrent_mode"):60111,l=e?Symbol.for("react.forward_ref"):60112,d=e?Symbol.for("react.suspense"):60113,f=e?Symbol.for("react.suspense_list"):60120,v=e?Symbol.for("react.memo"):60115,T=e?Symbol.for("react.lazy"):60116,E=e?Symbol.for("react.block"):60121,_=e?Symbol.for("react.fundamental"):60117,z=e?Symbol.for("react.responder"):60118,L=e?Symbol.for("react.scope"):60119;function M(D){return typeof D=="string"||typeof D=="function"||D===n||D===u||D===o||D===a||D===d||D===f||typeof D=="object"&&D!==null&&(D.$$typeof===T||D.$$typeof===v||D.$$typeof===s||D.$$typeof===i||D.$$typeof===l||D.$$typeof===_||D.$$typeof===z||D.$$typeof===L||D.$$typeof===E)}function m(D){if(typeof D=="object"&&D!==null){var de=D.$$typeof;switch(de){case t:var ke=D.type;switch(ke){case h:case u:case n:case o:case a:case d:return ke;default:var nt=ke&&ke.$$typeof;switch(nt){case i:case l:case T:case v:case s:return nt;default:return de}}case r:return de}}}var g=h,b=u,I=i,S=s,j=t,G=l,q=n,B=T,C=v,N=r,A=o,P=a,V=d,re=!1;function oe(D){return re||(re=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),x(D)||m(D)===h}function x(D){return m(D)===u}function p(D){return m(D)===i}function O(D){return m(D)===s}function H(D){return typeof D=="object"&&D!==null&&D.$$typeof===t}function R(D){return m(D)===l}function K(D){return m(D)===n}function Z(D){return m(D)===T}function $(D){return m(D)===v}function W(D){return m(D)===r}function J(D){return m(D)===o}function ee(D){return m(D)===a}function ie(D){return m(D)===d}ne.AsyncMode=g,ne.ConcurrentMode=b,ne.ContextConsumer=I,ne.ContextProvider=S,ne.Element=j,ne.ForwardRef=G,ne.Fragment=q,ne.Lazy=B,ne.Memo=C,ne.Portal=N,ne.Profiler=A,ne.StrictMode=P,ne.Suspense=V,ne.isAsyncMode=oe,ne.isConcurrentMode=x,ne.isContextConsumer=p,ne.isContextProvider=O,ne.isElement=H,ne.isForwardRef=R,ne.isFragment=K,ne.isLazy=Z,ne.isMemo=$,ne.isPortal=W,ne.isProfiler=J,ne.isStrictMode=ee,ne.isSuspense=ie,ne.isValidElementType=M,ne.typeOf=m})()),ne}var Qt;function en(){return Qt||(Qt=1,process.env.NODE_ENV==="production"?qe.exports=vr():qe.exports=Er()),qe.exports}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Et,tn;function wr(){if(tn)return Et;tn=1;var e=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function n(o){if(o==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(o)}function a(){try{if(!Object.assign)return!1;var o=new String("abc");if(o[5]="de",Object.getOwnPropertyNames(o)[0]==="5")return!1;for(var s={},i=0;i<10;i++)s["_"+String.fromCharCode(i)]=i;var h=Object.getOwnPropertyNames(s).map(function(l){return s[l]});if(h.join("")!=="0123456789")return!1;var u={};return"abcdefghijklmnopqrst".split("").forEach(function(l){u[l]=l}),Object.keys(Object.assign({},u)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return Et=a()?Object.assign:function(o,s){for(var i,h=n(o),u,l=1;l<arguments.length;l++){i=Object(arguments[l]);for(var d in i)t.call(i,d)&&(h[d]=i[d]);if(e){u=e(i);for(var f=0;f<u.length;f++)r.call(i,u[f])&&(h[u[f]]=i[u[f]])}}return h},Et}var wt,nn;function xt(){if(nn)return wt;nn=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return wt=e,wt}var Ct,rn;function on(){return rn||(rn=1,Ct=Function.call.bind(Object.prototype.hasOwnProperty)),Ct}var At,sn;function xr(){if(sn)return At;sn=1;var e=function(){};if(process.env.NODE_ENV!=="production"){var t=xt(),r={},n=on();e=function(o){var s="Warning: "+o;typeof console<"u"&&console.error(s);try{throw new Error(s)}catch{}}}function a(o,s,i,h,u){if(process.env.NODE_ENV!=="production"){for(var l in o)if(n(o,l)){var d;try{if(typeof o[l]!="function"){var f=Error((h||"React class")+": "+i+" type `"+l+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof o[l]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw f.name="Invariant Violation",f}d=o[l](s,l,h,i,null,t)}catch(T){d=T}if(d&&!(d instanceof Error)&&e((h||"React class")+": type specification of "+i+" `"+l+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof d+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),d instanceof Error&&!(d.message in r)){r[d.message]=!0;var v=u?u():"";e("Failed "+i+" type: "+d.message+(v??""))}}}}return a.resetWarningCache=function(){process.env.NODE_ENV!=="production"&&(r={})},At=a,At}var _t,an;function Cr(){if(an)return _t;an=1;var e=en(),t=wr(),r=xt(),n=on(),a=xr(),o=function(){};process.env.NODE_ENV!=="production"&&(o=function(i){var h="Warning: "+i;typeof console<"u"&&console.error(h);try{throw new Error(h)}catch{}});function s(){return null}return _t=function(i,h){var u=typeof Symbol=="function"&&Symbol.iterator,l="@@iterator";function d(x){var p=x&&(u&&x[u]||x[l]);if(typeof p=="function")return p}var f="<<anonymous>>",v={array:z("array"),bigint:z("bigint"),bool:z("boolean"),func:z("function"),number:z("number"),object:z("object"),string:z("string"),symbol:z("symbol"),any:L(),arrayOf:M,element:m(),elementType:g(),instanceOf:b,node:G(),objectOf:S,oneOf:I,oneOfType:j,shape:B,exact:C};function T(x,p){return x===p?x!==0||1/x===1/p:x!==x&&p!==p}function E(x,p){this.message=x,this.data=p&&typeof p=="object"?p:{},this.stack=""}E.prototype=Error.prototype;function _(x){if(process.env.NODE_ENV!=="production")var p={},O=0;function H(K,Z,$,W,J,ee,ie){if(W=W||f,ee=ee||$,ie!==r){if(h){var D=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw D.name="Invariant Violation",D}else if(process.env.NODE_ENV!=="production"&&typeof console<"u"){var de=W+":"+$;!p[de]&&O<3&&(o("You are manually calling a React.PropTypes validation function for the `"+ee+"` prop on `"+W+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),p[de]=!0,O++)}}return Z[$]==null?K?Z[$]===null?new E("The "+J+" `"+ee+"` is marked as required "+("in `"+W+"`, but its value is `null`.")):new E("The "+J+" `"+ee+"` is marked as required in "+("`"+W+"`, but its value is `undefined`.")):null:x(Z,$,W,J,ee)}var R=H.bind(null,!1);return R.isRequired=H.bind(null,!0),R}function z(x){function p(O,H,R,K,Z,$){var W=O[H],J=P(W);if(J!==x){var ee=V(W);return new E("Invalid "+K+" `"+Z+"` of type "+("`"+ee+"` supplied to `"+R+"`, expected ")+("`"+x+"`."),{expectedType:x})}return null}return _(p)}function L(){return _(s)}function M(x){function p(O,H,R,K,Z){if(typeof x!="function")return new E("Property `"+Z+"` of component `"+R+"` has invalid PropType notation inside arrayOf.");var $=O[H];if(!Array.isArray($)){var W=P($);return new E("Invalid "+K+" `"+Z+"` of type "+("`"+W+"` supplied to `"+R+"`, expected an array."))}for(var J=0;J<$.length;J++){var ee=x($,J,R,K,Z+"["+J+"]",r);if(ee instanceof Error)return ee}return null}return _(p)}function m(){function x(p,O,H,R,K){var Z=p[O];if(!i(Z)){var $=P(Z);return new E("Invalid "+R+" `"+K+"` of type "+("`"+$+"` supplied to `"+H+"`, expected a single ReactElement."))}return null}return _(x)}function g(){function x(p,O,H,R,K){var Z=p[O];if(!e.isValidElementType(Z)){var $=P(Z);return new E("Invalid "+R+" `"+K+"` of type "+("`"+$+"` supplied to `"+H+"`, expected a single ReactElement type."))}return null}return _(x)}function b(x){function p(O,H,R,K,Z){if(!(O[H]instanceof x)){var $=x.name||f,W=oe(O[H]);return new E("Invalid "+K+" `"+Z+"` of type "+("`"+W+"` supplied to `"+R+"`, expected ")+("instance of `"+$+"`."))}return null}return _(p)}function I(x){if(!Array.isArray(x))return process.env.NODE_ENV!=="production"&&(arguments.length>1?o("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):o("Invalid argument supplied to oneOf, expected an array.")),s;function p(O,H,R,K,Z){for(var $=O[H],W=0;W<x.length;W++)if(T($,x[W]))return null;var J=JSON.stringify(x,function(ie,D){var de=V(D);return de==="symbol"?String(D):D});return new E("Invalid "+K+" `"+Z+"` of value `"+String($)+"` "+("supplied to `"+R+"`, expected one of "+J+"."))}return _(p)}function S(x){function p(O,H,R,K,Z){if(typeof x!="function")return new E("Property `"+Z+"` of component `"+R+"` has invalid PropType notation inside objectOf.");var $=O[H],W=P($);if(W!=="object")return new E("Invalid "+K+" `"+Z+"` of type "+("`"+W+"` supplied to `"+R+"`, expected an object."));for(var J in $)if(n($,J)){var ee=x($,J,R,K,Z+"."+J,r);if(ee instanceof Error)return ee}return null}return _(p)}function j(x){if(!Array.isArray(x))return process.env.NODE_ENV!=="production"&&o("Invalid argument supplied to oneOfType, expected an instance of array."),s;for(var p=0;p<x.length;p++){var O=x[p];if(typeof O!="function")return o("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+re(O)+" at index "+p+"."),s}function H(R,K,Z,$,W){for(var J=[],ee=0;ee<x.length;ee++){var ie=x[ee],D=ie(R,K,Z,$,W,r);if(D==null)return null;D.data&&n(D.data,"expectedType")&&J.push(D.data.expectedType)}var de=J.length>0?", expected one of type ["+J.join(", ")+"]":"";return new E("Invalid "+$+" `"+W+"` supplied to "+("`"+Z+"`"+de+"."))}return _(H)}function G(){function x(p,O,H,R,K){return N(p[O])?null:new E("Invalid "+R+" `"+K+"` supplied to "+("`"+H+"`, expected a ReactNode."))}return _(x)}function q(x,p,O,H,R){return new E((x||"React class")+": "+p+" type `"+O+"."+H+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+R+"`.")}function B(x){function p(O,H,R,K,Z){var $=O[H],W=P($);if(W!=="object")return new E("Invalid "+K+" `"+Z+"` of type `"+W+"` "+("supplied to `"+R+"`, expected `object`."));for(var J in x){var ee=x[J];if(typeof ee!="function")return q(R,K,Z,J,V(ee));var ie=ee($,J,R,K,Z+"."+J,r);if(ie)return ie}return null}return _(p)}function C(x){function p(O,H,R,K,Z){var $=O[H],W=P($);if(W!=="object")return new E("Invalid "+K+" `"+Z+"` of type `"+W+"` "+("supplied to `"+R+"`, expected `object`."));var J=t({},O[H],x);for(var ee in J){var ie=x[ee];if(n(x,ee)&&typeof ie!="function")return q(R,K,Z,ee,V(ie));if(!ie)return new E("Invalid "+K+" `"+Z+"` key `"+ee+"` supplied to `"+R+"`.\nBad object: "+JSON.stringify(O[H],null,"  ")+`
Valid keys: `+JSON.stringify(Object.keys(x),null,"  "));var D=ie($,ee,R,K,Z+"."+ee,r);if(D)return D}return null}return _(p)}function N(x){switch(typeof x){case"number":case"string":case"undefined":return!0;case"boolean":return!x;case"object":if(Array.isArray(x))return x.every(N);if(x===null||i(x))return!0;var p=d(x);if(p){var O=p.call(x),H;if(p!==x.entries){for(;!(H=O.next()).done;)if(!N(H.value))return!1}else for(;!(H=O.next()).done;){var R=H.value;if(R&&!N(R[1]))return!1}}else return!1;return!0;default:return!1}}function A(x,p){return x==="symbol"?!0:p?p["@@toStringTag"]==="Symbol"||typeof Symbol=="function"&&p instanceof Symbol:!1}function P(x){var p=typeof x;return Array.isArray(x)?"array":x instanceof RegExp?"object":A(p,x)?"symbol":p}function V(x){if(typeof x>"u"||x===null)return""+x;var p=P(x);if(p==="object"){if(x instanceof Date)return"date";if(x instanceof RegExp)return"regexp"}return p}function re(x){var p=V(x);switch(p){case"array":case"object":return"an "+p;case"boolean":case"date":case"regexp":return"a "+p;default:return p}}function oe(x){return!x.constructor||!x.constructor.name?f:x.constructor.name}return v.checkPropTypes=a,v.resetWarningCache=a.resetWarningCache,v.PropTypes=v,v},_t}var kt,ln;function Ar(){if(ln)return kt;ln=1;var e=xt();function t(){}function r(){}return r.resetWarningCache=t,kt=function(){function n(s,i,h,u,l,d){if(d!==e){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}n.isRequired=n;function a(){return n}var o={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:a,element:n,elementType:n,instanceOf:a,node:n,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:r,resetWarningCache:t};return o.PropTypes=o,o},kt}var cn;function _r(){if(cn)return We.exports;if(cn=1,process.env.NODE_ENV!=="production"){var e=en(),t=!0;We.exports=Cr()(e.isElement,t)}else We.exports=Ar()();return We.exports}var kr=_r();const w=ir(kr),St={"7.5pt":{pt:7.5,px:10,label:"7.5"},"9pt":{pt:9,px:12,label:"9"},"10pt":{pt:10,px:13,label:"10"},"11pt":{pt:11,px:15,label:"11"},"12pt":{pt:12,px:16,label:"12"},"14pt":{pt:14,px:19,label:"14"},"16pt":{pt:16,px:21,label:"16"},"18pt":{pt:18,px:24,label:"18"},"20pt":{pt:20,px:27,label:"20"},"22pt":{pt:22,px:29,label:"22"},"24pt":{pt:24,px:32,label:"24"},"26pt":{pt:26,px:35,label:"26"},"28pt":{pt:28,px:37,label:"28"},"36pt":{pt:36,px:48,label:"36"},"48pt":{pt:48,px:64,label:"48"},"72pt":{pt:72,px:96,label:"72"}},un=[{value:"10px",label:"7.5",pt:7.5},{value:"12px",label:"9",pt:9},{value:"13px",label:"10",pt:10},{value:"15px",label:"11",pt:11},{value:"16px",label:"12",pt:12},{value:"19px",label:"14",pt:14},{value:"21px",label:"16",pt:16},{value:"24px",label:"18",pt:18},{value:"27px",label:"20",pt:20},{value:"32px",label:"24",pt:24},{value:"37px",label:"28",pt:28},{value:"48px",label:"36",pt:36},{value:"64px",label:"48",pt:48},{value:"96px",label:"72",pt:72}],Le="16px",dn=e=>Math.round(e*96/72),fn=e=>Math.round(e*72/96*2)/2,Sr=e=>{const t=Object.values(St).find(r=>r.pt===e);return t?`${t.px}px`:`${dn(e)}px`},Nr=e=>{const t=parseInt(e),r=Object.values(St).find(n=>n.px===t);return r?r.pt:fn(t)},Or=e=>{if(!e)return!1;if(e.endsWith("px")){const t=parseInt(e);return t>=8&&t<=144}if(e.endsWith("pt")){const t=parseFloat(e);return t>=6&&t<=108}return!1},Pr={"10px":"1","12px":"2","13px":"2","15px":"3","16px":"3","19px":"4","21px":"4","24px":"5","27px":"5","32px":"6","37px":"6","48px":"6","64px":"7","96px":"7"},pn={bold:!1,italic:!1,underline:!1,strikethrough:!1,alignLeft:!1,alignCenter:!1,alignRight:!1,alignJustify:!1,fontFamily:"Arial",fontSize:Le,fontColor:"#000000",headingLevel:"p"},gn=()=>{const[e,t]=c.useState(pn),r=pe(),n=c.useCallback((v,T,E=null)=>{try{const _=window.getSelection();if(!_||_.rangeCount===0)return!1;const z=_.getRangeAt(0);if(!z.toString())return t(M=>({...M,[v]:T})),!1;try{const M=document.createElement("span");M.style[v]=T;const m=z.extractContents();return M.appendChild(m),z.insertNode(M),z.selectNodeContents(M),_.removeAllRanges(),_.addRange(z),t(g=>({...g,[v]:T})),!0}catch{if(E){const M=v==="fontSize"?Pr[T]||"3":T;return document.execCommand(E,!1,M),t(m=>({...m,[v]:T})),!0}return!1}}catch(_){return console.warn(`[useFormatting] Style application failed for ${v}:`,_),!1}},[]),a=c.useCallback(v=>n("fontFamily",v,"fontName"),[n]),o=c.useCallback(v=>n("fontSize",v,"fontSize"),[n]),s=c.useCallback(v=>n("color",v,"foreColor"),[n]),i=c.useCallback(v=>{t(T=>({...T,alignLeft:v==="left",alignCenter:v==="center",alignRight:v==="right",alignJustify:v==="justify"}))},[]),h=c.useCallback(v=>{try{const T=window.getSelection();if(!T||T.rangeCount===0)return!1;const E=T.getRangeAt(0),_=E.toString(),L={justifyLeft:"left",justifyCenter:"center",justifyRight:"right",justifyFull:"justify"}[v];if(!L)return!1;if(!_){const m=E.startContainer,g=m.nodeType===Node.TEXT_NODE?m.parentElement:m,b=Re(g)||Rr();return b&&(b.style.textAlign=L,i(L)),!0}const M=Lr(E);if(M.length===0){const m=document.createElement("p");m.style.textAlign=L;const g=E.extractContents();m.appendChild(g),E.insertNode(m),E.selectNodeContents(m),T.removeAllRanges(),T.addRange(E)}else M.forEach(m=>{m.style.textAlign=L});return i(L),!0}catch(T){return console.warn("[useFormatting] Text alignment failed:",T),!1}},[i]),u=c.useCallback(v=>{try{const T=window.getSelection();if(!T||T.rangeCount===0)return!1;const E=T.getRangeAt(0),_=document.createElement("div");if(_.innerHTML=v,Array.from(_.children).some(L=>["TABLE","UL","OL","BLOCKQUOTE","PRE","DIV","H1","H2","H3","H4","H5","H6"].includes(L.tagName))){const L=E.startContainer,M=L.nodeType===Node.TEXT_NODE?L.parentElement:L,m=Re(M);if(m&&["P","H1","H2","H3","H4","H5","H6"].includes(m.tagName)){const g=m.tagName.toLowerCase();if(E.startOffset===0&&(L===m||L.nodeType===Node.TEXT_NODE&&L===m.firstChild))m.parentNode.insertBefore(_,m);else if(E.startOffset===L.textContent?.length&&L===m.lastChild&&E.endOffset===L.textContent?.length){const S=m.nextSibling;S?m.parentNode.insertBefore(_,S):m.parentNode.appendChild(_)}else{const S=E.extractContents(),j=document.createTextNode(""),G=document.createElement(g);G.appendChild(j),G.appendChild(S);const q=m.parentNode;q.insertBefore(_,m.nextSibling),q.insertBefore(G,_.nextSibling),!m.textContent.trim()&&m.children.length===0&&q.removeChild(m)}}else E.insertNode(_);E.setStartAfter(_),E.setEndAfter(_),T.removeAllRanges(),T.addRange(E)}else document.execCommand("insertHTML",!1,v);return!0}catch(T){console.warn("[useFormatting] InsertHTML failed:",T);try{return document.execCommand("insertHTML",!1,v),!0}catch(E){return console.warn("[useFormatting] InsertHTML fallback also failed:",E),!1}}},[]),l=c.useCallback((v,T=null)=>{try{if(v==="undo"){r.undo();return}if(v==="redo"){r.redo();return}if(typeof document.execCommand!="function"){console.warn("[useFormatting] execCommand not supported");return}if(v==="insertHTML"&&T){u(T);return}if(v==="fontSize"){o(T);return}if(v==="fontName"){a(T);return}if(v==="foreColor"){s(T);return}if(["justifyLeft","justifyCenter","justifyRight","justifyFull"].includes(v)){h(v);return}switch(document.execCommand(v,!1,T)||console.warn(`[useFormatting] Command "${v}" failed`),v){case"bold":case"italic":case"underline":case"strikethrough":case"justifyLeft":case"justifyCenter":case"justifyRight":case"justifyFull":case"fontName":case"foreColor":break;case"formatBlock":t(_=>({..._,headingLevel:T}));break;default:break}}catch(E){console.warn(`[useFormatting] Error executing command "${v}":`,E)}},[o,a,h,u,r]),d=c.useCallback(()=>{try{const v=window.getSelection();if(!v||v.rangeCount===0)return;const T=v.getRangeAt(0),E=T.toString();let _=Le,z="Arial",L="#000000",M="p",m="left";if(E){const b=T.startContainer,I=b.nodeType===Node.TEXT_NODE?b.parentElement:b;if(I){const S=window.getComputedStyle(I),j=S.fontSize,G=S.fontFamily;j&&j.endsWith("px")&&(_=j),G&&G!=="serif"&&(z=G.split(",")[0].replace(/['"]/g,"").trim());const q=S.color;q&&q!=="rgb(0, 0, 0)"&&q!=="#000000"&&(q.startsWith("rgb")?L=Mr(q):L=q);const B=Re(I);if(B){const C=B.tagName?.toLowerCase();["h1","h2","h3","h4","h5","h6","p"].includes(C)&&(M=C);const A=window.getComputedStyle(B).textAlign;["left","center","right","justify"].includes(A)&&(m=A)}}}const g={bold:document.queryCommandState("bold"),italic:document.queryCommandState("italic"),underline:document.queryCommandState("underline"),strikethrough:document.queryCommandState("strikethrough"),alignLeft:m==="left",alignCenter:m==="center",alignRight:m==="right",alignJustify:m==="justify",fontFamily:z,fontSize:_,fontColor:L,headingLevel:M};t(b=>({...b,...g}))}catch(v){console.warn("[useFormatting] Error updating format from selection:",v)}},[]),f=c.useCallback(()=>{t(pn)},[]);return{currentFormat:e,formatText:l,resetFormat:f,updateCurrentFormatFromSelection:d}};function Mr(e){const t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);if(!t)return"#000000";const r=parseInt(t[1],10),n=parseInt(t[2],10),a=parseInt(t[3],10);return`#${((1<<24)+(r<<16)+(n<<8)+a).toString(16).slice(1)}`}function Re(e){let t=e;for(;t&&t!==document.body;){const r=t.tagName?.toLowerCase();if(["h1","h2","h3","h4","h5","h6","p"].includes(r))return t;if(t.contentEditable==="true"||t.contentEditable==="")break;t=t.parentElement}return null}function Lr(e){const t=[],r=e.startContainer,n=e.endContainer,a=Re(r.nodeType===Node.TEXT_NODE?r.parentElement:r),o=Re(n.nodeType===Node.TEXT_NODE?n.parentElement:n);if(a===o&&a)return[a];const s=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_ELEMENT,{acceptNode:h=>{const u=h.tagName?.toLowerCase();return["h1","h2","h3","h4","h5","h6","p"].includes(u)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});let i=s.nextNode();for(;i;)e.intersectsNode(i)&&t.push(i),i=s.nextNode();return t}function Rr(){try{const e=window.getSelection();if(!e||e.rangeCount===0)return null;const t=e.getRangeAt(0),r=document.createElement("p");return r.innerHTML="<br>",t.insertNode(r),t.selectNodeContents(r),t.collapse(!0),e.removeAllRanges(),e.addRange(t),r}catch(e){return console.warn("[useFormatting] Failed to create paragraph at cursor:",e),null}}const be='page-break, [data-page-break="true"]',Ir=(e,t={})=>{if(!e||typeof document>"u")return[];const r=t.pageSize||"A4",n=_e(r),a=e.querySelectorAll(be),o=[];o.push({id:"page-0",pageNumber:1,top:0,height:n.height});const s=e.getBoundingClientRect(),i=e.scrollTop;return a.forEach((h,u)=>{const d=h.getBoundingClientRect().top-s.top+i;o.push({id:`page-${u+1}`,pageNumber:u+2,top:d,height:n.height})}),o},hn=(e,t=100,r=fe)=>{const n=_e(e),a=fr(r),o=n.height-a,s=t/100;return o/s},Hr=(e,t)=>{if(!e||!t)return 0;try{const r=t.querySelectorAll(be);if(r.length===0)return 0;const n=e.getBoundingClientRect(),a=n.top+n.height/2;for(let o=r.length-1;o>=0;o--)if(r[o].getBoundingClientRect().top<a)return o+1;return 0}catch(r){return console.warn("[getCurrentPage] Failed to calculate page:",r),0}},mn=e=>{if(!e)return[];const t=Array.from(e.children);if(t.length===0)return[];let r=[],n=[];for(const a of t)a.tagName==="PAGE-BREAK"||a.getAttribute("data-page-break")==="true"?n.length>0&&(r.push(n),n=[]):n.push(a);return n.length>0&&r.push(n),r.length===0&&t.length>0&&r.push(t.filter(a=>!(a.tagName==="PAGE-BREAK"||a.getAttribute("data-page-break")==="true"))),r},Dr=e=>{if(!e||!e.getBoundingClientRect)return 0;const t=e.getBoundingClientRect();if(e.tagName==="P"){const r=e.querySelectorAll("img"),n=e.textContent.trim();if(r.length===1&&!n){const o=r[0].getBoundingClientRect(),i=window.getComputedStyle(e).textAlign;if(i==="center"||i==="-webkit-center")return o.height+16}return t.height+16}return e.tagName==="H1"||e.tagName==="H2"||e.tagName==="H3"||e.tagName==="H4"||e.tagName==="H5"||e.tagName==="H6"?t.height+20:e.tagName==="UL"||e.tagName==="OL"?t.height+16:t.height},jr=(e,t)=>{if(!e)return!1;try{const r=document.createElement("page-break");return r.setAttribute("data-page-break","true"),r.setAttribute("contenteditable","false"),r.setAttribute("data-page-number",t||"2"),e.parentNode.insertBefore(r,e),!0}catch(r){return console.warn("[insertPageBreakBefore] Failed to insert page break:",r),!1}},Br=(e,t,r,n,a,o,s)=>{if(!e)return!1;try{const h=hn(r,n,a)*(t-1),u=Array.from(e.children);let l=0,d=null;for(let f=0;f<u.length;f++){const v=u[f];if(v.tagName==="PAGE-BREAK"||v.getAttribute("data-page-break")==="true")continue;const T=Dr(v);if(l+T>h){d=v;break}l+=T}if(d){const f=document.createElement("page-break");if(f.setAttribute("data-page-break","true"),f.setAttribute("contenteditable","false"),f.setAttribute("data-page-number",String(t)),d.parentNode.insertBefore(f,d),o){const v=e.innerHTML;o(v)}return s&&setTimeout(()=>{s()},50),!0}else{const f=document.createElement("page-break");f.setAttribute("data-page-break","true"),f.setAttribute("contenteditable","false"),f.setAttribute("data-page-number",String(t)),e.appendChild(f);const v=document.createElement("p");if(v.innerHTML="<br>",e.appendChild(v),o){const T=e.innerHTML;o(T)}return s&&setTimeout(()=>{s()},50),!0}}catch(i){return console.error("[insertPageBreakAtBoundary] Failed to insert page break:",i),!1}},$r=(e,t,r,n,a,o,s)=>{if(!e)return!1;if(r().length<=1)return console.warn("[removePageAndContent] Cannot delete the only page"),!1;try{const h=Array.from(e.querySelectorAll(be));if(t>h.length)return console.warn("[removePageAndContent] Invalid page index"),!1;const u=window.getSelection();let l=!1,d=[],f=null;if(t===0){const T=h[0];if(!T)return console.warn("[removePageAndContent] No page break found for first page"),!1;let E=e.firstChild;for(;E&&E!==T;)d.push(E),E=E.nextSibling;f=T}else{const T=h[t-1];if(!T)return console.warn("[removePageAndContent] Page break not found"),!1;const E=h[t];let _=T.nextSibling;for(;_&&_!==E;)d.push(_),_=_.nextSibling;f=T}if(u&&u.rangeCount>0){const E=u.getRangeAt(0).startContainer;for(const _ of d)if(_.contains(E)||_===E){l=!0;break}}if(f&&f.parentNode&&f.remove(),d.forEach(T=>{T.parentNode&&T.remove()}),e.querySelectorAll(be).forEach((T,E)=>{T.setAttribute("data-page-number",String(E+2))}),l&&o&&setTimeout(()=>{o(0)},50),n){const T=e.innerHTML;n(T)}return a&&setTimeout(()=>{a(),s&&setTimeout(()=>{s()},150)},100),!0}catch(h){return console.error("[removePageAndContent] Failed to remove page:",h),!1}},zr=e=>{if(e)try{e.querySelectorAll(be).forEach((r,n)=>{r.setAttribute("data-page-number",String(n+2))})}catch(t){console.error("[renumberPageBreaks] Failed to renumber page breaks:",t)}},Fr=(e,t,r,n,a)=>{if(!e||!t)return!1;try{if(e.remove(),zr(t),r){const o=t.innerHTML;r(o)}return n&&setTimeout(()=>{n(),a&&setTimeout(()=>{a()},100)},50),!0}catch(o){return console.error("[removePageBreak] Failed to remove page break:",o),!1}},Ur=200,Wr=50,yn=3,qr=20,bn=e=>{if(!e||!e.getBoundingClientRect)return 0;const t=e.getBoundingClientRect();if(e.tagName==="P"){const r=e.querySelectorAll("img"),n=e.textContent.trim();if(r.length===1&&!n){const o=r[0].getBoundingClientRect(),i=window.getComputedStyle(e).textAlign;if(i==="center"||i==="-webkit-center")return o.height+16}return t.height+16}return e.tagName==="H1"||e.tagName==="H2"||e.tagName==="H3"||e.tagName==="H4"||e.tagName==="H5"||e.tagName==="H6"?t.height+20:e.tagName==="UL"||e.tagName==="OL"?t.height+16:t.height},Gr=(e,t)=>{if(!e||e.length===0)return null;let r=0,n=null;for(let a=0;a<e.length;a++){const o=e[a];if(!o||!o.getBoundingClientRect)continue;const s=bn(o);if(s<1)continue;if(r+s>t)return n===null?a>0?{overflowIndex:a,overflowElement:o,accumulatedHeight:r}:null:{overflowIndex:a,overflowElement:o,accumulatedHeight:r};r+=s,n=o}return null},Zr=(e,t,r,n,a,o,s,i)=>{if(!e||s.current)return!1;try{s.current=!0;const h=hn(t,r,n);let u=mn(e),l=!1,d=0;for(let f=0;f<u.length&&d<yn;f++){const v=u[f],T=Gr(v,h);if(T&&T.overflowIndex>0){let E=0;for(let M=0;M<v.length;M++){const m=v[M];m&&m.getBoundingClientRect&&(E+=bn(m))}if(E-h<qr)continue;const z=f+2;jr(T.overflowElement,z)&&(l=!0,d++,u=mn(e))}}if(l){if(a){const f=e.innerHTML;a(f)}setTimeout(()=>{o&&o(),d>=yn&&i&&setTimeout(()=>{s.current||i()},100)},Wr)}return l}catch(h){return console.warn("[checkAndReflow] Reflow failed:",h),!1}finally{s.current=!1}},Yr=(e,t,r=Ur)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{t.current=null,e()},r)},Vr=400,Tn=(e,t)=>{if(e){e.focus();try{let r=null,n=0;if(t===0)r=e.firstChild,n=0;else{const o=e.querySelectorAll(be)[t-1];o&&o.nextSibling&&(r=o.nextSibling,n=0)}if(r){const a=document.createRange(),o=window.getSelection();r.nodeType===Node.TEXT_NODE?a.setStart(r,n):a.setStart(r,0),a.collapse(!0),o.removeAllRanges(),o.addRange(a)}}catch(r){console.warn("[positionCursorAtPage] Failed to position cursor:",r)}}},Kr=(e,t,r,n)=>{if(!e||!t){console.warn("[scrollToPage] Missing refs");return}try{let a=null;if(r===0)a=t;else{const s=t.querySelectorAll(be)[r-1];if(s)a=s;else{console.warn("[scrollToPage] Page break not found for page",r);return}}if(a){const o=a.getBoundingClientRect(),s=e.getBoundingClientRect(),i=e.scrollTop+(o.top-s.top);e.scrollTo({top:i,behavior:"smooth"}),setTimeout(()=>{n?n(r):Tn(t,r)},Vr)}}catch(a){console.error("[scrollToPage] Error:",a)}},Xr=(e,t,r={},n=300)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{t.current=null,e(r)},Math.max(0,n))},Jr=e=>{if(!e)return null;const t=window.getSelection();if(t.rangeCount===0)return null;const r=t.getRangeAt(0);if(!e.contains(r.commonAncestorContainer))return null;let n=1;const a=e.querySelectorAll(be);for(const l of a)if(r.comparePoint(l,0)>0)n++;else break;const o=document.createRange();o.setStart(e,0),o.setEnd(r.startContainer,r.startOffset);const i=o.toString().replace(/<[^>]*>/g," ").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\s+/g," ").trim(),h=i.length,u=(i.match(/\n/g)||[]).length+1;return{page:n,line:u,charOffset:h}},Qr=300,vn=(e,t,r=100,n="NARROW")=>{const a=pe(),o=c.useRef(null),s=c.useRef(null),i=c.useRef(e),h=c.useRef(r),u=c.useRef(n),l=c.useRef(!1);c.useEffect(()=>{i.current=e},[e]),c.useEffect(()=>{h.current=r},[r]),c.useEffect(()=>{u.current=n},[n]),c.useEffect(()=>()=>{o.current&&clearTimeout(o.current),s.current&&clearTimeout(s.current)},[]);const d=c.useCallback((b={})=>t?.current?Ir(t.current,b):[],[t]),f=c.useCallback((b={})=>{const I=d(b);return a.updatePageBoundaries(I),I},[d,a]),v=c.useCallback((b={})=>{const I=typeof b.delay=="number"?b.delay:Qr;Xr(f,o,b,I)},[f]),T=c.useCallback(()=>{t?.current&&Zr(t.current,i.current,h.current,u.current,a.updateContinuousContent,f,l,T)},[t,a,f]),E=c.useCallback(b=>{Yr(T,s,b)},[T]),_=c.useCallback(b=>!b?.current||!t?.current?0:Hr(b.current,t.current),[t]),z=c.useCallback(b=>{t?.current&&Tn(t.current,b)},[t]),L=c.useCallback((b,I)=>{if(!I?.current||!t?.current){console.warn("[scrollToPage] Missing refs");return}Kr(I.current,t.current,b,z)},[t,z]),M=c.useCallback(async b=>t?.current?Br(t.current,b,i.current,h.current,u.current,a.updateContinuousContent,f):!1,[t,a,f]),m=c.useCallback(b=>t?.current?$r(t.current,b,d,a.updateContinuousContent,f,z,T):!1,[t,d,a,f,z,T]),g=c.useCallback(b=>t?.current?Fr(b,t.current,a.updateContinuousContent,f,T):!1,[t,a,f,T]);return c.useEffect(()=>()=>{o.current&&clearTimeout(o.current),s.current&&clearTimeout(s.current)},[]),c.useMemo(()=>({calculatePageBoundaries:d,checkAndUpdateBoundaries:v,updateBoundaries:f,getCurrentPage:_,scrollToPage:L,positionCursorAtPage:z,checkAndReflow:T,triggerAutoReflow:E,removePageAndContent:m,removePageBreak:g,insertPageBreakAtBoundary:M,boundaryTimeoutRef:o,reflowTimeoutRef:s}),[d,v,f,_,L,z,T,E,m,g,M])},Ee={minWidth:50,minHeight:50,maxWidth:800,maxHeight:600,aspectRatio:!0,preserveAspectRatio:!0,defaultWidth:300,defaultHeight:200},U={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right"};function eo({handler:e,startX:t,startY:r,currentX:n,currentY:a,startWidth:o,startHeight:s,options:i=Ee}){const h=n-t,u=a-r;let l=o,d=s;switch(e){case U.TOP_LEFT:l=Math.max(i.minWidth,o-h),d=Math.max(i.minHeight,s-u);break;case U.TOP_RIGHT:l=Math.max(i.minWidth,o+h),d=Math.max(i.minHeight,s-u);break;case U.BOTTOM_LEFT:l=Math.max(i.minWidth,o-h),d=Math.max(i.minHeight,s+u);break;case U.BOTTOM_RIGHT:l=Math.max(i.minWidth,o+h),d=Math.max(i.minHeight,s+u);break;case U.TOP:d=Math.max(i.minHeight,s-u);break;case U.BOTTOM:d=Math.max(i.minHeight,s+u);break;case U.LEFT:l=Math.max(i.minWidth,o-h);break;case U.RIGHT:l=Math.max(i.minWidth,o+h);break;default:return{width:l,height:d}}if(i.preserveAspectRatio&&i.aspectRatio){const f=o/s;[U.TOP_LEFT,U.TOP_RIGHT,U.BOTTOM_LEFT,U.BOTTOM_RIGHT].includes(e)?l/f>d?d=Math.max(i.minHeight,l/f):l=Math.max(i.minWidth,d*f):[U.TOP,U.BOTTOM].includes(e)?l=d*f:[U.LEFT,U.RIGHT].includes(e)&&(d=l/f)}return i.maxWidth&&l>i.maxWidth&&(l=i.maxWidth,i.preserveAspectRatio&&i.aspectRatio&&(d=l/(o/s))),i.maxHeight&&d>i.maxHeight&&(d=i.maxHeight,i.preserveAspectRatio&&i.aspectRatio&&(l=d*(o/s))),l=Math.max(i.minWidth,l),d=Math.max(i.minHeight,d),{width:Math.round(l),height:Math.round(d)}}function ge(e){return e?!!(e.tagName==="IMG"||e.tagName==="DIV"&&e.style.backgroundImage&&e.style.backgroundImage!=="none"):!1}function to(e){return ge(e)?{width:e.offsetWidth,height:e.offsetHeight}:{width:0,height:0}}function no(e,{width:t,height:r}){ge(e)&&(e.tagName==="IMG"?(e.style.width=`${t}px`,e.style.height=`${r}px`,e.width=t,e.height=r):e.tagName==="DIV"&&(e.style.width=`${t}px`,e.style.height=`${r}px`))}function En(e,t=Ee){if(!ge(e))return null;const r=document.createElement("div");r.className="image-resize-overlay",r.style.position="fixed",r.style.zIndex="1000",r.style.pointerEvents="none";const n=e.getBoundingClientRect();return r.style.top=`${n.top}px`,r.style.left=`${n.left}px`,r.style.width=`${n.width}px`,r.style.height=`${n.height}px`,Object.values(U).forEach(o=>{const s=document.createElement("div");s.className=`resize-handler resize-handler-${o}`,s.dataset.handler=o,s.style.position="absolute",s.style.width="10px",s.style.height="10px",s.style.backgroundColor="#007bff",s.style.border="2px solid white",s.style.borderRadius="50%",s.style.boxShadow="0 0 3px rgba(0,0,0,0.3)",s.style.cursor=ro(o),s.style.pointerEvents="all",wn(s,o,n.width,n.height),r.appendChild(s)}),r}function ro(e){switch(e){case U.TOP_LEFT:case U.BOTTOM_RIGHT:return"nwse-resize";case U.TOP_RIGHT:case U.BOTTOM_LEFT:return"nesw-resize";case U.TOP:case U.BOTTOM:return"ns-resize";case U.LEFT:case U.RIGHT:return"ew-resize";default:return"default"}}function wn(e,t,r,n){switch(t){case U.TOP_LEFT:e.style.top="-5px",e.style.left="-5px";break;case U.TOP_RIGHT:e.style.top="-5px",e.style.right="-5px";break;case U.BOTTOM_LEFT:e.style.bottom="-5px",e.style.left="-5px";break;case U.BOTTOM_RIGHT:e.style.bottom="-5px",e.style.right="-5px";break;case U.TOP:e.style.top="-5px",e.style.left=`${r/2+-5}px`;break;case U.BOTTOM:e.style.bottom="-5px",e.style.left=`${r/2+-5}px`;break;case U.LEFT:e.style.top=`${n/2+-5}px`,e.style.left="-5px";break;case U.RIGHT:e.style.top=`${n/2+-5}px`,e.style.right="-5px";break}}function Ge(e,t){if(!e||!t)return;const r=t.getBoundingClientRect();e.style.top=`${r.top}px`,e.style.left=`${r.left}px`,e.style.width=`${r.width}px`,e.style.height=`${r.height}px`,e.querySelectorAll(".resize-handler").forEach(a=>{const o=a.dataset.handler;wn(a,o,r.width,r.height)})}function Ze(e){e&&e.parentNode&&e.parentNode.removeChild(e)}const oo="html-editor-storage",so=1,ce="images";function ao(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function Ie(){return new Promise((e,t)=>{const r=indexedDB.open(oo,so);r.onerror=()=>{t(new Error("Failed to open IndexedDB database"))},r.onsuccess=()=>{e(r.result)},r.onupgradeneeded=n=>{const a=n.target.result;a.objectStoreNames.contains(ce)||a.createObjectStore(ce,{keyPath:"key"}).createIndex("timestamp","timestamp",{unique:!1})}})}function xn(e){return new Promise((t,r)=>{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(e.type)){r(new Error("Invalid image format. Supported formats: png, jpeg, gif, webp"));return}if(e.size>5*1024*1024){r(new Error("Image exceeds maximum size of 5MB"));return}const a=new FileReader;a.onload=async o=>{const s=o.target.result,h=s.split(",")[1].length*3/4;if(h>5*1024*1024){r(new Error("Image exceeds maximum size of 5MB"));return}try{const u=await Ie(),l=`editor-image-${ao()}`,f=u.transaction([ce],"readwrite").objectStore(ce),v={key:l,dataUrl:s,size:h,type:e.type,timestamp:Date.now()},T=f.add(v);T.onsuccess=()=>{u.close(),t(l)},T.onerror=()=>{u.close(),r(new Error("Failed to save image to IndexedDB"))}}catch(u){r(u)}},a.onerror=()=>{r(new Error("Error reading image file"))},a.readAsDataURL(e)})}async function Cn(e){try{const t=await Ie();return new Promise((r,n)=>{const s=t.transaction([ce],"readonly").objectStore(ce).get(e);s.onsuccess=()=>{t.close();const i=s.result;r(i?i.dataUrl:null)},s.onerror=()=>{t.close(),n(new Error("Failed to retrieve image from IndexedDB"))}})}catch(t){return console.error("Error getting image:",t),null}}async function An(e){try{const t=await Ie();return new Promise((r,n)=>{const s=t.transaction([ce],"readwrite").objectStore(ce).delete(e);s.onsuccess=()=>{t.close(),r()},s.onerror=()=>{t.close(),n(new Error("Failed to delete image from IndexedDB"))}})}catch(t){console.error("Error deleting image:",t)}}async function io(){try{const e=await Ie();return new Promise((t,r)=>{const o=e.transaction([ce],"readwrite").objectStore(ce).clear();o.onsuccess=()=>{e.close(),t()},o.onerror=()=>{e.close(),r(new Error("Failed to clear images from IndexedDB"))}})}catch(e){console.error("Error clearing images:",e)}}async function lo(){try{const e=await Ie();return new Promise((t,r)=>{const o=e.transaction([ce],"readonly").objectStore(ce).getAllKeys();o.onsuccess=()=>{e.close(),t(o.result||[])},o.onerror=()=>{e.close(),r(new Error("Failed to get image keys from IndexedDB"))}})}catch(e){return console.error("Error getting image keys:",e),[]}}const _n=["P","DIV","H1","H2","H3","H4","H5","H6","UL","OL","LI","TABLE","TBODY","TR","TD","TH","THEAD","TFOOT","BLOCKQUOTE","PRE","HR","FIGURE","FIGCAPTION","PAGE-BREAK"],co=["SPAN","STRONG","EM","B","I","U","S","STRIKE","DEL","INS","SUB","SUP","MARK","SMALL","CODE","KBD","SAMP","VAR","A","ABBR","CITE","DFN","TIME"],uo=["BR","HR","IMG","INPUT","PAGE-BREAK"];function fo(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function kn(e){const t=[];for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];t.push(` ${n.name}="${n.value}"`)}return t.join("")}function Ye(e){if(!e||typeof e!="string")return"<p><br></p>";const t=e.trim();if(!t)return"<p><br></p>";const r=document.createElement("div");return r.innerHTML=t,He(r)||"<p><br></p>"}function po(e){const t=e.cloneNode(!0);return t.querySelectorAll(":scope > p").forEach(n=>{for(;n.firstChild;)t.insertBefore(n.firstChild,n);n.remove()}),t.innerHTML}function go(e){const t=Array.from(e.children);return t.length===0?!1:t.every(r=>_n.includes(r.tagName))}function ho(e){const t=[];let r=!1;return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===Node.TEXT_NODE)n.textContent.trim()&&(r=!0);else if(n.nodeType===Node.ELEMENT_NODE){const a=n;_n.includes(a.tagName)?t.push(a.outerHTML):r=!0}}),r?e.outerHTML:t.join("")}function He(e){const t=[],r=Array.from(e.childNodes);for(let n=0;n<r.length;n++){const a=r[n];if(a.nodeType===Node.TEXT_NODE){const o=a.textContent.trim();o&&t.push(`<p>${fo(o)}</p>`)}else if(a.nodeType===Node.ELEMENT_NODE){const o=a,s=o.tagName,i=s.toLowerCase(),h=kn(o);if(s==="DIV"){const u=He(o);u.trim()?t.push(u):t.push("<p><br></p>")}else if(s==="P")go(o)?t.push(ho(o)):t.push(o.outerHTML);else if(["H1","H2","H3","H4","H5","H6"].includes(s)){const u=po(o);t.push(`<${i}${h}>${u}</${i}>`)}else if(s==="BR")t.push("<p><br></p>");else if(s==="IMG")t.push(o.outerHTML);else if(["UL","OL"].includes(s))t.push(mo(o));else if(s==="LI")t.push(o.outerHTML);else if(s==="TABLE")t.push(yo(o));else if(["TBODY","THEAD","TFOOT","TR","TD","TH"].includes(s))t.push(o.outerHTML);else if(s==="BLOCKQUOTE"){const u=He(o);t.push(`<blockquote${h}>${u}</blockquote>`)}else if(s==="PRE")t.push(o.outerHTML);else if(co.includes(s))t.push(o.outerHTML);else if(s==="PAGE-BREAK"||o.getAttribute("data-page-break")==="true")t.push(o.outerHTML);else if(s==="HR")t.push(o.outerHTML);else if(s==="FIGURE")t.push(o.outerHTML);else if(uo.includes(s))t.push(o.outerHTML);else{const u=He(o);t.push(`<${i}${h}>${u}</${i}>`)}}}return t.length===0?"":t.join("")}function mo(e){const t=e.tagName.toLowerCase(),r=kn(e),n=[];return Array.from(e.children).forEach(a=>{if(a.tagName==="LI")n.push(a.outerHTML);else{const o=He(a);o.trim()&&n.push(`<li>${o}</li>`)}}),n.length===0?`<${t}${r}><li><br></li></${t}>`:`<${t}${r}>${n.join("")}</${t}>`}function yo(e){return e.outerHTML}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bo=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),To=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,n)=>n?n.toUpperCase():r.toLowerCase()),Sn=e=>{const t=To(e);return t.charAt(0).toUpperCase()+t.slice(1)},Nn=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim(),vo=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Eo={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wo=c.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:a="",children:o,iconNode:s,...i},h)=>c.createElement("svg",{ref:h,...Eo,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:Nn("lucide",a),...!o&&!vo(i)&&{"aria-hidden":"true"},...i},[...s.map(([u,l])=>c.createElement(u,l)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=(e,t)=>{const r=c.forwardRef(({className:n,...a},o)=>c.createElement(wo,{ref:o,iconNode:t,className:Nn(`lucide-${bo(Sn(e))}`,`lucide-${e}`,n),...a}));return r.displayName=Sn(e),r};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xo=Q("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Co=Q("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ao=Q("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _o=Q("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ko=Q("bold",[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const So=Q("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const No=Q("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oo=Q("file-check",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=Q("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Po=Q("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mo=Q("heading-1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lo=Q("heading-2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ro=Q("heading-3",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Io=Q("image-upscale",[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M17 21h2a2 2 0 0 0 2-2",key:"130fy9"}],["path",{d:"M21 12v3",key:"1wzk3p"}],["path",{d:"m21 3-5 5",key:"1g5oa7"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2",key:"kk3yz1"}],["path",{d:"m5 21 4.144-4.144a1.21 1.21 0 0 1 1.712 0L13 19",key:"fyekpt"}],["path",{d:"M9 3h3",key:"d52fa"}],["rect",{x:"3",y:"11",width:"10",height:"10",rx:"1",key:"1wpmix"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ho=Q("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Do=Q("italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jo=Q("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bo=Q("list-indent-decrease",[["path",{d:"M21 5H11",key:"us1j55"}],["path",{d:"M21 12H11",key:"wd7e0v"}],["path",{d:"M21 19H11",key:"saa85w"}],["path",{d:"m7 8-4 4 4 4",key:"o5hrat"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $o=Q("list-indent-increase",[["path",{d:"M21 5H11",key:"us1j55"}],["path",{d:"M21 12H11",key:"wd7e0v"}],["path",{d:"M21 19H11",key:"saa85w"}],["path",{d:"m3 8 4 4-4 4",key:"1a3j6y"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zo=Q("list-ordered",[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const On=Q("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fo=Q("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uo=Q("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wo=Q("redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qo=Q("scaling",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M14 15H9v-5",key:"pi4jk9"}],["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M21 3 9 15",key:"15kdhq"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Go=Q("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zo=Q("strikethrough",[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yo=Q("table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=Q("text-align-center",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M17 12H7",key:"16if0g"}],["path",{d:"M19 19H5",key:"vjpgq2"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=Q("text-align-end",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M21 19H7",key:"4cu937"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vo=Q("text-align-justify",[["path",{d:"M3 5h18",key:"1u36vt"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 19h18",key:"awlh7x"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=Q("text-align-start",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=Q("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ko=Q("underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xo=Q("undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jo=Q("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qo=Q("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=Q("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Pn=(e,t,r="")=>{if(!e)return[];const n=document.createElement("div");n.innerHTML=e;const a=n.querySelectorAll("h1, h2, h3, h4, h5, h6");return Array.from(a).map((o,s)=>{const i=parseInt(o.tagName.charAt(1)),h=o.textContent.trim();return h?{id:`${r}heading-${s}`,level:i,text:h,page:t||1}:null}).filter(Boolean)},ts=e=>{if(!e)return 0;const t=document.createElement("div");return t.innerHTML=e,(t.textContent||t.innerText||"").trim().split(/\s+/).filter(n=>n.length>0).length},Mn=({isCollapsed:e,onToggle:t,wordCount:r,pageCount:n})=>{const a=vt(),{pages:o,activePage:s,continuousContent:i}=a,{wordCount:h,outline:u}=c.useMemo(()=>{if(r!==void 0&&n!==void 0)return{wordCount:r,outline:Pn(i,1,"continuous-")};let d=0;const f=[];return o.forEach((v,T)=>{d+=ts(v.content),f.push(...Pn(v.content,T+1,`page-${T}-`))}),{wordCount:d,outline:f}},[o,r,n,i]),l=n!==void 0?n:o.length;return y.jsxs("aside",{className:`sidebar ${e?"collapsed":""}`,role:"complementary","aria-label":"Document information","data-testid":"sidebar",children:[y.jsxs("div",{className:"sidebar-header",children:[y.jsxs("div",{className:"sidebar-title",children:[y.jsx(Ve,{size:18}),y.jsx("h2",{children:"Document Info"})]}),y.jsx("button",{className:"sidebar-toggle",onClick:t,"aria-label":e?"Expand sidebar":"Collapse sidebar",title:e?"Expand sidebar":"Collapse sidebar",children:e?y.jsx(No,{size:16}):y.jsx(So,{size:16})})]}),!e&&y.jsxs("div",{className:"sidebar-content",children:[y.jsxs("div",{className:"sidebar-section",children:[y.jsx("h3",{children:"Statistics"}),y.jsxs("div",{className:"stat-item",children:[y.jsxs("div",{className:"stat-label",children:[y.jsx(Oo,{size:14}),y.jsx("span",{children:"Pages:"})]}),y.jsx("span",{className:"stat-value",children:l})]}),y.jsxs("div",{className:"stat-item","data-testid":"word-count",children:[y.jsxs("div",{className:"stat-label",children:[y.jsx(Po,{size:14}),y.jsx("span",{children:"Words:"})]}),y.jsx("span",{className:"stat-value",children:h.toLocaleString()})]}),y.jsxs("div",{className:"stat-item",children:[y.jsxs("div",{className:"stat-label",children:[y.jsx(Ve,{size:14}),y.jsx("span",{children:"Active Page:"})]}),y.jsx("span",{className:"stat-value",children:s+1})]})]}),u.length>0&&y.jsxs("div",{className:"sidebar-section",children:[y.jsxs("h3",{children:[y.jsx(On,{size:14,style:{display:"inline-block",marginRight:"6px",verticalAlign:"middle"}}),"Document Outline"]}),y.jsx("div",{className:"document-outline","data-testid":"outline",children:u.map(d=>{const f=d.level===1?Mo:d.level===2?Lo:Ro;return y.jsxs("div",{className:`outline-item outline-level-${d.level}`,style:{marginLeft:`${(d.level-1)*12}px`},children:[y.jsx(f,{size:12,className:"outline-icon"}),y.jsx("span",{className:"outline-text",children:d.text}),y.jsxs("span",{className:"outline-page",children:["p.",d.page]})]},d.id)})})]})]})]})};class Ln{constructor(t="Editor"){this.namespace=t}_format(t,r,n){return`[${new Date().toISOString()}] [${this.namespace}] [${t}] ${r}`}info(t,r){}warn(t,r){}error(t,r){}debug(t,r){}}const we=new Ln("Editor"),Rn=new Set(["P","DIV","H1","H2","H3","H4","H5","H6","LI","BLOCKQUOTE","PRE","TABLE"]),In=32;function Hn(e,t){if(!e)return;e.dataset||(e.dataset={}),e.style||(e.style={});const r=parseInt(e.dataset.indentLevel||"0",10),n=Math.max(0,t?r-1:r+1);n===0?(e.style.marginLeft="",delete e.dataset.indentLevel):(e.style.marginLeft=`${n*In}px`,e.dataset.indentLevel=String(n))}function ns(e,t){Hn(e,t)}function rs(e){let t=e;for(;t;){if(t.nodeType===1&&t.tagName&&Rn.has(t.tagName.toUpperCase()))return t;t=t.parentElement||t.parentNode}return null}function os(){const e=window.getSelection();if(!e||e.rangeCount===0)return[];const t=e.getRangeAt(0),r=new Set;let n=t.commonAncestorContainer;for(n.nodeType===Node.TEXT_NODE&&(n=n.parentElement);n&&n.contentEditable!=="true";)n=n.parentElement;return n?(n.querySelectorAll("p, div, h1, h2, h3, h4, h5, h6, li, blockquote, pre, table").forEach(s=>{document.createRange().selectNodeContents(s),t.intersectsNode(s)&&r.add(s)}),r.size===0&&n.querySelectorAll("img").forEach(i=>{if(document.createRange().selectNode(i),t.intersectsNode(i)){let u=i.parentElement;for(;u&&u!==n;){if(u.tagName&&Rn.has(u.tagName.toUpperCase())){r.add(u);break}u=u.parentElement}}}),Array.from(r).filter(s=>{let i=s.parentElement;for(;i;){if(r.has(i))return!1;i=i.parentElement}return!0})):[]}function ss(e){if(e.style&&e.style.marginLeft&&e.style.marginLeft!==""){const t=parseInt(e.dataset.indentLevel||"0",10),r=Math.max(0,t-1);r===0?(e.style.marginLeft="",delete e.dataset.indentLevel):(e.style.marginLeft=`${r*In}px`,e.dataset.indentLevel=String(r));return}if(e.innerHTML.startsWith("&nbsp;&nbsp;&nbsp;&nbsp;")){e.innerHTML=e.innerHTML.replace(/^(&nbsp;){4}/,"");return}try{const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let r=t.nextNode();for(;r;){const n=r.textContent;if(n.startsWith("    ")){r.textContent=n.substring(4);break}r=t.nextNode()}}catch{e.innerHTML=e.innerHTML.replace(/^(&nbsp;){4}/,"")}}function Lt(e=!1){const t=window.getSelection();if(!t||t.rangeCount===0)return!1;let r=os();const n=t.getRangeAt(0);if(r.length===0){const s=rs(n.startContainer);if(!s)return!1;r=[s]}const a=r[0],o=r[r.length-1];r.forEach(s=>{if((s.tagName?s.tagName.toUpperCase():"")==="LI"){ns(s,e);return}e?ss(s):Hn(s,!1)});try{const s=document.createRange(),i=d=>d.nodeType===Node.TEXT_NODE?d:document.createTreeWalker(d,NodeFilter.SHOW_TEXT,null).nextNode(),h=d=>{if(d.nodeType===Node.TEXT_NODE)return d;const f=document.createTreeWalker(d,NodeFilter.SHOW_TEXT,null);let v=null,T=f.nextNode();for(;T;)v=T,T=f.nextNode();return v},u=i(a);u?s.setStart(u,0):s.setStart(a,0);const l=h(o);l?s.setEnd(l,l.length):s.setEnd(o,o.childNodes.length),t.removeAllRanges(),t.addRange(s)}catch{try{const i=document.createRange();i.setStartBefore(a),i.setEndAfter(o),t.removeAllRanges(),t.addRange(i)}catch(i){console.warn("Could not restore selection after indentation:",i)}}return!0}function as(e){if(e.key!=="Tab")return!1;e.preventDefault();const t=e.shiftKey,r=window.getSelection(),n=r&&r.rangeCount>0?r.getRangeAt(0):null;return r&&r.rangeCount>0&&n&&!n.collapsed&&Lt(t)||t||document.execCommand("insertHTML",!1,"&nbsp;&nbsp;&nbsp;&nbsp;"),!0}const Rt=({currentColor:e,onColorSelect:t,title:r="Font Color"})=>{const[n,a]=c.useState(!1),o=c.useRef(null),s=["#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#FFC0CB","#A52A2A","#808080","#FFFFFF"];c.useEffect(()=>{const u=l=>{o.current&&!o.current.contains(l.target)&&a(!1)};return document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u)}},[]);const i=u=>{t(u),a(!1)},h=u=>{const l=u.target.value;t(l)};return y.jsxs("div",{className:"color-picker-dropdown",ref:o,children:[y.jsx("button",{onClick:()=>a(!n),className:"color-picker-button",title:r,style:{backgroundColor:e||"#000000",border:"1px solid #ccc",borderRadius:"3px",width:"24px",height:"24px",cursor:"pointer",position:"relative"},children:y.jsx(Fo,{size:14,style:{color:e==="#FFFFFF"?"#000":"#FFF"}})}),n&&y.jsxs("div",{className:"color-picker-palette",children:[y.jsx("div",{className:"color-grid",children:s.map(u=>y.jsx("button",{onClick:()=>i(u),className:`color-option ${e===u?"selected":""}`,style:{backgroundColor:u,border:e===u?"2px solid #007acc":"1px solid #ccc",width:"24px",height:"24px",margin:"2px",borderRadius:"3px",cursor:"pointer"},title:u},u))}),y.jsxs("div",{className:"custom-color-section",children:[y.jsx("label",{htmlFor:"custom-color-input",style:{fontSize:"12px",marginBottom:"4px",display:"block"},children:"Custom Color:"}),y.jsx("input",{id:"custom-color-input",type:"color",value:e||"#000000",onChange:h,style:{width:"100%",height:"32px",border:"1px solid #ccc",borderRadius:"3px",cursor:"pointer"}})]})]})]})};Rt.propTypes={currentColor:w.string,onColorSelect:w.func.isRequired,title:w.string};const is=[{value:"Segoe UI",label:"Segoe UI"},{value:"Arial",label:"Arial"},{value:"Times New Roman",label:"Times New Roman"},{value:"Courier New",label:"Courier New"},{value:"Georgia",label:"Georgia"},{value:"Verdana",label:"Verdana"},{value:"Noto Sans Sinhala",label:"Noto Sans Sinhala"},{value:"Iskoola Pota",label:"Iskoola Pota"},{value:"Noto Sans Tamil",label:"Noto Sans Tamil"},{value:"Noto Sans",label:"Noto Sans"}],ls=[{value:"p",label:"Normal"},{value:"h1",label:"Heading 1"},{value:"h2",label:"Heading 2"},{value:"h3",label:"Heading 3"},{value:"h4",label:"Heading 4"},{value:"h5",label:"Heading 5"},{value:"h6",label:"Heading 6"}],cs='<table border="1"><tr><th>Header 1</th><th>Header 2</th></tr><tr><td>Cell 3</td><td>Cell 4</td></tr></table>',Ke=({currentFormat:e,onFormatText:t,onAddPageBreak:r,onInsertImage:n,canUndo:a=!1,canRedo:o=!1})=>{const s=async l=>{try{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(l.type)){alert("Invalid image format. Supported: PNG, JPEG, GIF, WEBP");return}if(l.size>5242880){alert("Image exceeds maximum size of 5MB");return}we.info("Starting image upload",{fileName:l.name,fileSize:l.size});const f=await xn(l);we.info("Image saved to IndexedDB",{key:f});const v=await Cn(f);if(we.info("Image retrieved from IndexedDB",{key:f,hasUrl:!!v}),v&&n){const E=`<img src="${v}" data-key="${f}" alt="Inserted image" />`;we.info("Calling onInsertImage with HTML",{imageHtml:E.substring(0,100)}),n(E),we.info("Image inserted",{key:f})}else we.warn("Image not inserted: missing imageUrl or onInsertImage callback",{hasUrl:!!v,hasCallback:!!n});const T=document.getElementById("image-upload");T&&(T.value="")}catch(d){we.error("Error uploading image",d)}},i=(l,d,f,v)=>y.jsx("button",{onClick:()=>t(l),className:e[d]?"active":"",title:v,children:y.jsx(f,{size:16})},l),h=(l,d,f,v=!1)=>y.jsx("button",{onClick:l,disabled:v,title:f,style:{opacity:v?.5:1},children:y.jsx(d,{size:16})},f),u=()=>y.jsx("div",{className:"toolbar-separator"});return y.jsxs("div",{className:"editor-toolbar",children:[h(()=>t("undo"),Xo,"Undo",!a),h(()=>t("redo"),Wo,"Redo",!o),u(),i("bold","bold",ko,"Bold"),i("italic","italic",Do,"Italic"),i("underline","underline",Ko,"Underline"),i("strikethrough","strikethrough",Zo,"Strikethrough"),u(),i("justifyLeft","alignLeft",Pt,"Align Left"),i("justifyCenter","alignCenter",Nt,"Align Center"),i("justifyRight","alignRight",Ot,"Align Right"),i("justifyFull","alignJustify",Vo,"Justify"),u(),y.jsx("select",{onChange:l=>t("fontName",l.target.value),value:e.fontFamily||"Segoe UI",title:"Font Family",children:is.map(({value:l,label:d})=>y.jsx("option",{value:l,children:d},l))}),y.jsx("select",{onChange:l=>t("fontSize",l.target.value),value:e.fontSize||Le,title:"Font Size",children:un.map(({value:l,label:d})=>y.jsx("option",{value:l,children:d},l))}),y.jsx(Rt,{currentColor:e.fontColor,onColorSelect:l=>t("foreColor",l),title:"Font Color"}),y.jsx("select",{onChange:l=>t("formatBlock",l.target.value),value:e.headingLevel||"p",title:"Heading Level",children:ls.map(({value:l,label:d})=>y.jsx("option",{value:l,children:d},l))}),u(),h(()=>t("insertUnorderedList"),On,"Bullet List"),h(()=>t("insertOrderedList"),zo,"Numbered List"),u(),y.jsx("button",{onClick:()=>{Lt(!1)||document.execCommand("insertHTML",!1,"&nbsp;&nbsp;&nbsp;&nbsp;")},title:"Increase Indent (Tab)",children:y.jsx($o,{size:16})}),y.jsx("button",{onClick:()=>{Lt(!0)},title:"Decrease Indent (Shift+Tab)",children:y.jsx(Bo,{size:16})}),u(),y.jsx("button",{onClick:()=>{const l=prompt("Enter URL:");l&&t("createLink",l)},title:"Insert Link",children:y.jsx(jo,{size:16})}),h(()=>t("insertHTML",cs),Yo,"Insert Table"),r&&h(r,Ve,"Insert Page Break"),u(),y.jsx("input",{type:"file",accept:"image/*",onChange:l=>l.target.files[0]&&s(l.target.files[0]),style:{display:"none"},id:"image-upload"}),y.jsx("button",{onClick:()=>document.getElementById("image-upload").click(),title:"Insert Image",children:y.jsx(Ho,{size:16})})]})};Ke.propTypes={currentFormat:w.shape({bold:w.bool,italic:w.bool,underline:w.bool,strikethrough:w.bool,alignLeft:w.bool,alignCenter:w.bool,alignRight:w.bool,alignJustify:w.bool,fontFamily:w.string,fontSize:w.string,fontColor:w.string,headingLevel:w.string}).isRequired,onFormatText:w.func.isRequired,onAddPageBreak:w.func,onInsertImage:w.func,canUndo:w.bool,canRedo:w.bool},Ke.defaultProps={onAddPageBreak:void 0,onInsertImage:void 0,canUndo:!1,canRedo:!1};function us(e){return!e||typeof e!="string"?e:Ye(e)}function ds(e){e.preventDefault();const t=e.clipboardData||window.clipboardData;if(!t)return null;let r=t.getData("text/html")||t.getData("text/plain");return r?(t.getData("text/html")?r=us(r):r=fs(r),document.execCommand("insertHTML",!1,r),r):null}function fs(e){if(!e)return"";const t=e.split(/\n\s*\n/).filter(r=>r.trim());return t.length===0?"<p><br></p>":t.map(r=>{const n=r.split(`
`).filter(o=>o.trim());return n.length===0?"<p><br></p>":`<p>${n.map(o=>ps(o.trim())).join("<br>")}</p>`}).join("")}function ps(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}const xe=e=>e?e.nodeType===Node.ELEMENT_NODE?e.tagName==="PAGE-BREAK"||e.getAttribute("data-page-break")==="true":e.parentElement&&xe(e.parentElement):!1,It=({dimensions:e,editorRef:t,onInput:r,onContentChange:n,onKeyDown:a,onClick:o,onScroll:s,onPaste:i,onRemovePageBreak:h,zoomLevel:u=100,pageMargins:l=fe})=>{const d=c.useMemo(()=>Yt(l),[l]),f=u/100,v=c.useCallback((m,g)=>{if(!m)return!1;const b=m.getBoundingClientRect(),I=g-b.top;return I<d.top||I>b.height-d.bottom},[d.top,d.bottom]),T=c.useCallback((m,g)=>{g.preventDefault();const b=m.getBoundingClientRect(),I=g.clientX-b.left,S=g.clientY-b.top,j=b.width-40,G=-12,q=b.width-20;I>=j&&I<=q&&S>=G&&S<=8&&h&&h(m)},[h]),E=c.useCallback(m=>{m.preventDefault();const g=t.current.getBoundingClientRect();if(m.clientY-g.top<d.top){const I=t.current.firstElementChild;if(I&&I.tagName!=="PAGE-BREAK"){const S=document.createRange(),j=window.getSelection();S.setStart(I,0),S.collapse(!0),j.removeAllRanges(),j.addRange(S)}}else{const I=t.current.lastElementChild;if(I&&I.tagName!=="PAGE-BREAK"){const S=document.createRange(),j=window.getSelection();S.selectNodeContents(I),S.collapse(!1),j.removeAllRanges(),j.addRange(S)}}},[t,d.top]),_=c.useCallback(m=>{const g=window.getSelection();if(!g||g.rangeCount===0)return;const b=g.getRangeAt(0),{startContainer:I,endContainer:S}=b;if((xe(I)||xe(S))&&(m.key.length===1||m.key==="Enter"||m.key===" "))return m.preventDefault(),!1;if(as(m))return n&&n(),!1;if((m.key==="Backspace"||m.key==="Delete")&&(xe(I)||xe(S)))return m.preventDefault(),!1;a&&a(m)},[a,n]),z=c.useCallback(m=>{if(!t.current)return;const g=m.target;if(xe(g)){T(g,m);return}if(v(t.current,m.clientY)){E(m);return}o&&o(m)},[t,o,T,E,v]),L=c.useCallback(m=>{const g=window.getSelection();if(!g||g.rangeCount===0)return;const b=g.getRangeAt(0),{startContainer:I}=b;if(xe(I))return m.preventDefault(),!1},[]),M=c.useCallback(m=>{const g=ds(m);i&&i(m,g)},[i]);return y.jsx("div",{className:"continuous-page-container",style:{position:"relative",width:"100%",maxWidth:`${e.width}px`,margin:"40px auto",backgroundColor:"transparent",minHeight:"100vh",transform:`scale(${f})`,transformOrigin:"top center",transition:"transform 0.2s ease-out"},children:y.jsx("div",{ref:t,contentEditable:!0,suppressContentEditableWarning:!0,className:"continuous-content",style:{position:"relative",zIndex:1,minHeight:`${e.height}px`,width:`${e.width}px`,backgroundColor:"white",padding:`${d.top}px ${d.right}px ${d.bottom}px ${d.left}px`,boxSizing:"border-box",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",outline:"none",cursor:"text",fontFamily:'"Segoe UI", "Noto Sans Sinhala", "Noto Sans", "Malithi Web", "Iskoola Pota", "Kaputa Unicode", "Helvetica Neue", Arial, "Hiragino Sans GB", "WenQuanYi Micro Hei", "Microsoft YaHei", sans-serif',fontSize:Le,lineHeight:"1.4",color:"#333",wordWrap:"break-word",whiteSpace:"pre-wrap",overflowWrap:"break-word",border:"1px solid #e0e0e0"},onInput:r,onKeyDown:_,onBeforeInput:L,onClick:z,onScroll:s,onPaste:M,"data-testid":"continuous-editor"})})};It.propTypes={dimensions:w.shape({width:w.number.isRequired,height:w.number.isRequired}).isRequired,editorRef:w.shape({current:w.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onInput:w.func.isRequired,onContentChange:w.func,onKeyDown:w.func,onClick:w.func,onScroll:w.func,onPaste:w.func,onRemovePageBreak:w.func,zoomLevel:w.number,pageMargins:w.string},It.defaultProps={onContentChange:void 0,onKeyDown:void 0,onClick:void 0,onScroll:void 0,onPaste:void 0,onRemovePageBreak:void 0,zoomLevel:100,pageMargins:fe};const Dn=c.memo(It),Ht=({pageBoundaries:e=[{id:"page-0",pageNumber:1}],activePage:t=0,pageSize:r="A4",pageMargins:n=fe,zoomLevel:a=100,canZoomIn:o=!0,canZoomOut:s=!0,onNavigate:i,onAddPage:h,onDeletePage:u,onPageSizeChange:l,onPageMarginsChange:d,onZoomIn:f,onZoomOut:v,onZoomReset:T}={})=>{const E=Math.max(e?.length||0,1),_=g=>{i&&i(g)},z=()=>{h&&h()},L=g=>{if(E<=1){console.warn("[PageManager] Cannot delete the only page");return}u&&u(g)},M=g=>{l&&l(g)},m=g=>{d&&d(g)};return y.jsxs("div",{className:"page-manager",children:[y.jsxs("div",{className:"page-settings-group",children:[y.jsxs("div",{className:"page-settings-header",children:[y.jsx(Go,{size:14,style:{marginRight:"4px",verticalAlign:"middle"}}),"Page Settings"]}),y.jsxs("div",{className:"page-settings-controls",children:[y.jsxs("div",{className:"page-setting-item",children:[y.jsx("label",{htmlFor:"page-size-selector",children:"Size:"}),y.jsxs("select",{id:"page-size-selector",role:"combobox","aria-label":"Page size selector",value:r,onChange:g=>M(g.target.value),children:[y.jsx("option",{value:"A4",children:"A4"}),y.jsx("option",{value:"Letter",children:"Letter"}),y.jsx("option",{value:"Legal",children:"Legal"})]})]}),y.jsxs("div",{className:"page-setting-item",children:[y.jsx("label",{htmlFor:"page-margins-selector",children:"Margins:"}),y.jsx("select",{id:"page-margins-selector",role:"combobox","aria-label":"Page margins selector",value:n,onChange:g=>m(g.target.value),children:pr().map(g=>y.jsx("option",{value:g,children:gr(g)},g))})]})]})]}),y.jsxs("div",{className:"zoom-controls-compact",children:[y.jsx("button",{type:"button",className:"zoom-button-compact",onClick:v,disabled:!s,"aria-label":"Zoom out",title:"Zoom out (Ctrl + -)",children:y.jsx(es,{size:12})}),y.jsxs("span",{className:"zoom-level-display",children:[a,"%"]}),y.jsx("button",{type:"button",className:"zoom-button-compact",onClick:f,disabled:!o,"aria-label":"Zoom in",title:"Zoom in (Ctrl + +)",children:y.jsx(Qo,{size:12})}),y.jsx("button",{type:"button",className:"zoom-reset-compact",onClick:T,"aria-label":"Reset zoom",title:"Reset zoom to 100% (Ctrl + 0)",children:"Reset"})]}),y.jsx("div",{className:"page-list",children:e.map((g,b)=>y.jsxs("div",{className:"page-item",children:[y.jsxs("button",{type:"button",className:`page-button ${b===t?"active":""}`,onClick:()=>_(b),"aria-label":`Go to page ${b+1}`,"aria-current":b===t?"page":void 0,children:[y.jsx(Ve,{size:14}),y.jsxs("span",{children:["Page ",b+1]})]}),E>1&&y.jsx("button",{type:"button",className:"delete-page-button",onClick:I=>{I.stopPropagation(),L(b)},"aria-label":`Delete page ${b+1}`,title:"Delete this page and its content",children:y.jsx(Jo,{size:14})})]},g.id||`page-${b}`))}),y.jsxs("button",{type:"button",className:"add-page-button",onClick:z,"aria-label":"Add new page",title:"Add new page at end",children:[y.jsx(Uo,{size:16}),y.jsx("span",{children:"Add Page"})]})]})};Ht.propTypes={pageBoundaries:w.arrayOf(w.shape({id:w.string.isRequired,pageNumber:w.number.isRequired,top:w.number,height:w.number})),activePage:w.number,pageSize:w.oneOf(["A4","Letter","Legal"]),pageMargins:w.string,zoomLevel:w.number,canZoomIn:w.bool,canZoomOut:w.bool,onNavigate:w.func,onAddPage:w.func,onDeletePage:w.func,onPageSizeChange:w.func,onPageMarginsChange:w.func,onZoomIn:w.func,onZoomOut:w.func,onZoomReset:w.func},Ht.defaultProps={pageBoundaries:[{id:"page-0",pageNumber:1}],activePage:0,pageSize:"A4",pageMargins:fe,zoomLevel:100,canZoomIn:!0,canZoomOut:!0,onNavigate:void 0,onAddPage:void 0,onDeletePage:void 0,onPageSizeChange:void 0,onPageMarginsChange:void 0,onZoomIn:void 0,onZoomOut:void 0,onZoomReset:void 0};const jn=c.memo(Ht);function gs(e){switch(e){case U.TOP_LEFT:case U.BOTTOM_RIGHT:return"nwse-resize";case U.TOP_RIGHT:case U.BOTTOM_LEFT:return"nesw-resize";case U.TOP:case U.BOTTOM:return"ns-resize";case U.LEFT:case U.RIGHT:return"ew-resize";default:return"default"}}function hs({handler:e,startX:t,startY:r,currentX:n,currentY:a,startWidth:o,startHeight:s,options:i=Ee}){const h=n-t,u=a-r;let l=o,d=s;switch(e){case U.TOP_LEFT:l=Math.max(i.minWidth,o-h),d=Math.max(i.minHeight,s-u);break;case U.TOP_RIGHT:l=Math.max(i.minWidth,o+h),d=Math.max(i.minHeight,s-u);break;case U.BOTTOM_LEFT:l=Math.max(i.minWidth,o-h),d=Math.max(i.minHeight,s+u);break;case U.BOTTOM_RIGHT:l=Math.max(i.minWidth,o+h),d=Math.max(i.minHeight,s+u);break;case U.TOP:d=Math.max(i.minHeight,s-u);break;case U.BOTTOM:d=Math.max(i.minHeight,s+u);break;case U.LEFT:l=Math.max(i.minWidth,o-h);break;case U.RIGHT:l=Math.max(i.minWidth,o+h);break;default:return{width:l,height:d}}if(i.preserveAspectRatio&&i.aspectRatio){const f=o/s;[U.TOP_LEFT,U.TOP_RIGHT,U.BOTTOM_LEFT,U.BOTTOM_RIGHT].includes(e)?l/f>d?d=Math.max(i.minHeight,l/f):l=Math.max(i.minWidth,d*f):[U.TOP,U.BOTTOM].includes(e)?l=d*f:[U.LEFT,U.RIGHT].includes(e)&&(d=l/f)}return i.maxWidth&&l>i.maxWidth&&(l=i.maxWidth,i.preserveAspectRatio&&i.aspectRatio&&(d=l/(o/s))),i.maxHeight&&d>i.maxHeight&&(d=i.maxHeight,i.preserveAspectRatio&&i.aspectRatio&&(l=d*(o/s))),l=Math.max(i.minWidth,l),d=Math.max(i.minHeight,d),{width:Math.round(l),height:Math.round(d)}}function Bn(e,{width:t,height:r}){ge(e)&&(e.tagName==="IMG"?(e.style.width=`${t}px`,e.style.height=`${r}px`,e.width=t,e.height=r):e.tagName==="DIV"&&(e.style.width=`${t}px`,e.style.height=`${r}px`))}function ms(e,t,r){Bn(t,r);const n=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(n)}function ys(e,t,r,n){const{ctrlKey:a,metaKey:o,shiftKey:s,key:i}=e,h=a||o,u=r.offsetWidth,l=r.offsetHeight,f={">":h&&s?()=>({width:Math.min(n.maxWidth||800,u+10),height:l}):null,"<":h&&s?()=>({width:Math.max(n.minWidth||50,u-10),height:l}):null,"+":h&&s?()=>({width:u,height:Math.min(n.maxHeight||600,l+10)}):null,"-":h&&s?()=>({width:u,height:Math.max(n.minHeight||50,l-10)}):null,r:h&&!s?()=>({width:300,height:200}):null}[i];if(f){e.preventDefault();const v=f();return ms(t,r,v),!0}return!1}const Xe=({editorRef:e,onImageResize:t,onImageSelect:r,onImageDeselect:n,resizeOptions:a=Ee})=>{const o=c.useRef(null),s=c.useRef(null),i=c.useRef(null),h=c.useRef(null),u=c.useRef(a),l=c.useRef(!1),d=pe();c.useEffect(()=>{u.current=a},[a]);const f=c.useCallback(m=>{if(!ge(m))return;o.current&&(Ze(o.current),o.current=null),m.classList.add("selected");const g=En(m,u.current);g&&(o.current=g,s.current=m,document.body.appendChild(g),g.querySelectorAll(".resize-handler").forEach(I=>{I.addEventListener("mousedown",T)}),r&&r(m))},[r]),v=c.useCallback(()=>{s.current&&(s.current.classList.remove("selected"),s.current=null),o.current&&(Ze(o.current),o.current=null),i.current=null,h.current=null,l.current=!1,n&&n()},[n]),T=c.useCallback(m=>{if(m.preventDefault(),m.stopPropagation(),!s.current)return;const g=m.currentTarget.dataset.handler,b=s.current.getBoundingClientRect(),I=window.pageYOffset||document.documentElement.scrollTop,S=window.pageXOffset||document.documentElement.scrollLeft;i.current={x:m.clientX,y:m.clientY,width:s.current.offsetWidth,height:s.current.offsetHeight,originalWidth:s.current.offsetWidth,originalHeight:s.current.offsetHeight,offsetX:m.clientX-b.left-S,offsetY:m.clientY-b.top-I},h.current=g,l.current=!0,document.body.classList.add("resize-in-progress"),document.body.style.cursor=gs(g),document.addEventListener("mousemove",E),document.addEventListener("mouseup",_)},[]),E=c.useCallback(m=>{if(!l.current||!s.current||!i.current||!h.current)return;m.preventDefault(),m.stopPropagation();const{x:g,y:b,width:I,height:S}=i.current,j=h.current,G=m.clientX,q=m.clientY,B=hs({handler:j,startX:g,startY:b,currentX:G,currentY:q,startWidth:I,startHeight:S,options:u.current});Bn(s.current,B),o.current&&Ge(o.current,s.current)},[]),_=c.useCallback(m=>{if(l.current){if(m.preventDefault(),m.stopPropagation(),s.current&&i.current){const g={width:i.current.originalWidth,height:i.current.originalHeight},b={width:s.current.offsetWidth,height:s.current.offsetHeight};(g.width!==b.width||g.height!==b.height)&&d.recordOperation({type:"IMAGE_RESIZE",payload:{element:s.current,state:b}},{type:"IMAGE_RESIZE",payload:{element:s.current,state:g}})}if(i.current=null,h.current=null,l.current=!1,document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",_),document.body.classList.remove("resize-in-progress"),document.body.style.cursor="",s.current){const g=new Event("input",{bubbles:!0,cancelable:!0});s.current.dispatchEvent(g),t&&t(s.current,{width:s.current.offsetWidth,height:s.current.offsetHeight})}}},[t,d]),z=c.useCallback(m=>{o.current&&!o.current.contains(m.target)&&v();const g=m.target;if(ge(g)){if(g===s.current)return;f(g)}},[f,v]),L=c.useCallback(m=>{if((m.key==="Delete"||m.key==="Backspace")&&s.current&&!l.current){m.preventDefault();const g=s.current;if(g.parentNode){g.parentNode.removeChild(g),v();const b=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(b)}}m.key==="Escape"&&s.current&&v(),s.current&&!l.current&&ys(m,e,s.current,u.current)},[e,v]),M=c.useCallback(()=>{o.current&&s.current&&Ge(o.current,s.current)},[]);return c.useEffect(()=>{if(!e.current)return;const g=e.current.closest(".editor-viewport");return g&&(g.addEventListener("scroll",M),window.addEventListener("scroll",M)),()=>{g&&g.removeEventListener("scroll",M),window.removeEventListener("scroll",M)}},[e,M]),c.useEffect(()=>{if(!e.current)return;const m=e.current;return m.addEventListener("click",z),m.addEventListener("keydown",L),window.addEventListener("resize",M),()=>{m.removeEventListener("click",z),m.removeEventListener("keydown",L),window.removeEventListener("resize",M),l.current&&(document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",_),document.body.classList.remove("resize-in-progress"),document.body.style.cursor=""),o.current&&Ze(o.current)}},[e,z,L,M,E,_]),c.useEffect(()=>{if(!e.current)return;const m=new MutationObserver(g=>{g.forEach(b=>{b.type==="childList"&&(b.removedNodes.forEach(I=>{I.nodeType===Node.ELEMENT_NODE&&ge(I)&&I===s.current&&v()}),b.addedNodes.forEach(I=>{if(I.nodeType!==Node.ELEMENT_NODE)return;if(ge(I)){setTimeout(()=>f(I),50);return}const S=I.querySelectorAll?.("img")||[];S.length>0&&setTimeout(()=>f(S[0]),50)}))})});return m.observe(e.current,{childList:!0,subtree:!0}),()=>m.disconnect()},[e,v,f]),null};Xe.propTypes={editorRef:w.shape({current:w.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onImageResize:w.func,onImageSelect:w.func,onImageDeselect:w.func,resizeOptions:w.shape({minWidth:w.number,minHeight:w.number,maxWidth:w.number,maxHeight:w.number,aspectRatio:w.bool,preserveAspectRatio:w.bool,defaultWidth:w.number,defaultHeight:w.number})},Xe.defaultProps={onImageResize:void 0,onImageSelect:void 0,onImageDeselect:void 0,resizeOptions:Ee};const Dt=({imageElement:e,onAlignChange:t,onAspectRatioToggle:r,onDelete:n,onClose:a,initialPreserveAspectRatio:o=!0})=>{const[s,i]=c.useState({top:0,left:0}),[h,u]=c.useState(!1),[l,d]=c.useState("top"),[f,v]=c.useState(o),T=c.useRef(null),E=c.useRef(null),_=pe(),z=C=>{if(!C)return;(typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame:A=>setTimeout(A,16))(()=>{const A=document.querySelector(".image-resize-overlay");A&&Ge(A,C)})},L=C=>{if(!C)return null;const N=window.getComputedStyle(C);return{float:N.float||"none",margin:C.style.margin||"",display:N.display||"inline",width:C.style.width||C.width||"",height:C.style.height||C.height||"",aspectRatio:f}},M=c.useCallback(()=>{if(!e)return"left";const C=window.getComputedStyle(e);return C.float==="right"?"right":C.float==="left"?"left":C.display==="block"&&C.margin.includes("auto")?"center":"left"},[e]),[m,g]=c.useState("left");c.useEffect(()=>{e&&g(M())},[e,M]);const b=c.useCallback(()=>{if(!e||!T.current)return;const C=e.getBoundingClientRect(),N=T.current.getBoundingClientRect(),A=window.visualViewport?window.visualViewport:{width:window.innerWidth,height:window.innerHeight},P=C.bottom>=0&&C.top<=A.height&&C.right>=0&&C.left<=A.width;let V="top",re=0,oe=0;if(P){const R=C.top-N.height-10,K=A.height-C.bottom-N.height-10;K>R&&K>0?(V="bottom",re=C.bottom+10):(V="top",re=C.top-N.height-10)}else V="top",re=10;oe=C.left+C.width/2-N.width/2;const x=window.innerWidth,p=window.innerHeight;let O=Math.max(10,Math.min(oe,x-N.width-10)),H=Math.max(10,Math.min(re,p-N.height-10));i({top:H,left:O}),d(V),u(!0)},[e]);c.useLayoutEffect(()=>{b();const C=()=>{b()},N=E.current;return N&&N.addEventListener("scroll",C),window.addEventListener("scroll",C),window.addEventListener("resize",C),()=>{N&&N.removeEventListener("scroll",C),window.removeEventListener("scroll",C),window.removeEventListener("resize",C),u(!1)}},[e,b]),c.useEffect(()=>{const C=N=>{T.current&&!T.current.contains(N.target)&&N.target!==e&&a()};return document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[e,a]);const I={left:{float:"left",margin:"0 10px 10px 0",display:"block"},center:{float:"none",margin:"10px auto",display:"block"},right:{float:"right",margin:"0 0 10px 10px",display:"block"}},S=C=>{if(e&&I[C]){const N=L(e),A=m,P=I[C];e.style.float=P.float,e.style.margin=P.margin,e.style.display=P.display,g(C),z(e);const V=L(e);_.recordOperation({type:"IMAGE_ALIGN",payload:{element:e,alignment:C,state:V}},{type:"IMAGE_ALIGN",payload:{element:e,alignment:A,state:N}}),t&&t(C)}},j=()=>{if(e&&e.parentNode){const C={element:e,parent:e.parentNode,nextSibling:e.nextSibling};_.recordOperation({type:"IMAGE_DELETE",payload:{element:e}},{type:"IMAGE_REINSERT",payload:{state:C}}),e.parentNode.removeChild(e),n&&n(),a()}},G=()=>{const C=f,N=!f;v(N),_.recordOperation({type:"IMAGE_ASPECT_RATIO",payload:{element:e,preserveAspectRatio:N}},{type:"IMAGE_ASPECT_RATIO",payload:{element:e,preserveAspectRatio:C}}),r&&r(N)},q={border:"1px solid #ccc",borderRadius:"4px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"28px",height:"28px"},B=C=>({...q,background:C?"#007bff":"transparent",color:C?"#fff":"#333"});return!e||typeof document>"u"?null:Ut.createPortal(y.jsxs("div",{ref:T,className:"image-tooltip-menu","data-menu-position":l,"aria-hidden":!h,style:{position:"fixed",top:`${s.top}px`,left:`${s.left}px`,zIndex:999,background:"#fff",border:"1px solid #ddd",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"8px",display:"flex",gap:"2px",alignItems:"center",pointerEvents:h?"auto":"none",minWidth:"140px",minHeight:"32px",opacity:h?1:0,visibility:h?"visible":"hidden",transition:"opacity 0.15s ease, visibility 0.15s ease"},children:[y.jsx("button",{className:`tooltip-button aspect-ratio-toggle ${f?"":"active"}`,onClick:G,title:`Toggle aspect ratio preservation (currently ${f?"ON":"OFF"})`,children:f?y.jsx(qo,{size:14}):y.jsx(Io,{size:14})}),y.jsx("button",{className:`tooltip-button ${m==="left"?"active":""}`,onClick:()=>S("left"),title:"Align Left",style:B(m==="left"),children:y.jsx(Pt,{size:14})}),y.jsx("button",{className:`tooltip-button ${m==="center"?"active":""}`,onClick:()=>S("center"),title:"Align Center",style:B(m==="center"),children:y.jsx(Nt,{size:14})}),y.jsx("button",{className:`tooltip-button ${m==="right"?"active":""}`,onClick:()=>S("right"),title:"Align Right",style:B(m==="right"),children:y.jsx(Ot,{size:14})}),y.jsx("button",{className:"tooltip-button delete-button",onClick:j,title:"Delete Image",style:{background:"transparent",color:"#dc3545",border:"1px solid #dc3545",borderRadius:"4px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"28px",height:"28px"},children:y.jsx(Mt,{size:14})})]}),document.body)};Dt.propTypes={imageElement:w.instanceOf(typeof Element<"u"?Element:Object),onAlignChange:w.func,onAspectRatioToggle:w.func,onDelete:w.func,onClose:w.func.isRequired,initialPreserveAspectRatio:w.bool},Dt.defaultProps={imageElement:null,onAlignChange:void 0,onAspectRatioToggle:void 0,onDelete:void 0,initialPreserveAspectRatio:!0};const De={minColumnWidth:10,minRowHeight:8,maxColumnWidth:800,maxRowHeight:600,tableMinWidth:100,tableMinHeight:50,tableMaxWidth:1200,tableMaxHeight:800},ae={COLUMN:"column",ROW:"row",TABLE_BOTTOM:"table-bottom",TABLE_RIGHT:"table-right"};function le(e){return e?e.tagName==="TABLE":!1}function ue(e){if(!le(e))return null;const t=e.getBoundingClientRect(),r=Array.from(e.rows),n=r.length>0?r[0].cells.length:0,a=[],o=e.querySelector("colgroup"),s=o?o.querySelectorAll("col"):[];if(s.length>=n)for(let h=0;h<n;h++){const u=s[h],l=u.style.width?parseInt(u.style.width,10):u.offsetWidth;a.push(l||100)}else if(r.length>0){const h=r[0];for(let u=0;u<h.cells.length;u++){const l=h.cells[u];a.push(l.offsetWidth)}}const i=r.map(h=>(h.style.height?parseInt(h.style.height,10):null)||h.offsetHeight);return{width:t.width,height:t.height,columns:n,rows:r.length,columnWidths:a,rowHeights:i,rect:t}}function $n({type:e,index:t,delta:r,currentStructure:n,options:a=De}){const o={columnWidths:[...n.columnWidths],rowHeights:[...n.rowHeights],tableWidth:n.width,tableHeight:n.height},s=(i,h,u,l,d)=>{h>=0&&h<i.length&&(i[h]=Math.max(l,Math.min(d,i[h]+u)))};switch(e){case ae.COLUMN:s(o.columnWidths,t,r,a.minColumnWidth,a.maxColumnWidth),o.tableWidth=n.width;break;case ae.ROW:s(o.rowHeights,t,r,a.minRowHeight,a.maxRowHeight),o.tableHeight=n.height;break;case ae.TABLE_BOTTOM:s(o.rowHeights,n.rows-1,r,a.minRowHeight,a.maxRowHeight);break;case ae.TABLE_RIGHT:s(o.columnWidths,n.columns-1,r,a.minColumnWidth,a.maxColumnWidth);break}return o}function he(e){if(!le(e))return;const t=Array.from(e.rows);if(t.length===0)return;const r=t[0].cells.length;let n=e.querySelector("colgroup");n||(n=document.createElement("colgroup"),e.insertBefore(n,e.firstChild));const a=n.querySelectorAll("col"),o=a.length;if(o<r)for(let s=o;s<r;s++){const i=document.createElement("col");n.appendChild(i)}else if(o>r)for(let s=o-1;s>=r;s--)n.removeChild(a[s])}function Te(e,t,r){if(!le(e))return;he(e);const{columnWidths:n,rowHeights:a,tableWidth:o,tableHeight:s}=t,i=n?n.reduce((u,l)=>u+l,0):0,h=a?a.reduce((u,l)=>u+l,0):0;if(o!==void 0?e.style.width=`${o}px`:i>0&&(e.style.width=`${i}px`),s!==void 0?e.style.height=`${s}px`:h>0&&(e.style.height=`${h}px`),n&&n.length>0){e.style.tableLayout="fixed";const u=e.querySelector("colgroup");u&&u.querySelectorAll("col").forEach((d,f)=>{f<n.length&&(d.style.width=`${n[f]}px`)}),e.style.width=`${i}px`}a&&a.length>0&&(Array.from(e.rows).forEach((l,d)=>{d<a.length&&(l.style.height=`${a[d]}px`)}),e.style.height=`${h}px`),e.offsetHeight}function zn(e,t=De){if(!le(e))return null;he(e);const r=ue(e);if(!r)return null;const n=document.createElement("div");n.className="table-resize-overlay",n.style.position="fixed",n.style.zIndex="1000",n.style.pointerEvents="none";const a=e.getBoundingClientRect();n.style.top=`${a.top}px`,n.style.left=`${a.left}px`,n.style.width=`${a.width}px`,n.style.height=`${a.height}px`;for(let i=0;i<r.columns-1;i++){const h=Fn(i,r,a,e);n.appendChild(h)}for(let i=0;i<r.rows-1;i++){const h=Un(i,r,a,e);n.appendChild(h)}const o=Wn(r,a);n.appendChild(o);const s=qn(r,a);return n.appendChild(s),n}function Fn(e,t,r,n){const a=document.createElement("div");return a.className="table-resize-handler table-column-resize-handler",a.dataset.type=ae.COLUMN,a.dataset.index=e,a.style.position="absolute",a.style.width="4px",a.style.height=`${r.height}px`,a.style.cursor="col-resize",a.style.pointerEvents="all",Gn(a,e,t,r,n),a}function Un(e,t,r,n){const a=document.createElement("div");return a.className="table-resize-handler table-row-resize-handler",a.dataset.type=ae.ROW,a.dataset.index=e,a.style.position="absolute",a.style.width=`${r.width}px`,a.style.height="4px",a.style.cursor="row-resize",a.style.pointerEvents="all",Zn(a,e,t,r,n),a}function Wn(e,t){const r=document.createElement("div");return r.className="table-resize-handler table-bottom-resize-handler",r.dataset.type=ae.TABLE_BOTTOM,r.style.position="absolute",r.style.width=`${t.width}px`,r.style.height="4px",r.style.cursor="ns-resize",r.style.pointerEvents="all",Yn(r,e,t),r}function qn(e,t){const r=document.createElement("div");return r.className="table-resize-handler table-right-resize-handler",r.dataset.type=ae.TABLE_RIGHT,r.style.position="absolute",r.style.width="4px",r.style.height=`${t.height}px`,r.style.cursor="ew-resize",r.style.pointerEvents="all",Vn(r,e,t),r}function Je(e,t){if(!e||!t)return;he(t);const r=ue(t);if(!r)return;const n=t.getBoundingClientRect();e.style.top=`${n.top}px`,e.style.left=`${n.left}px`,e.style.width=`${n.width}px`,e.style.height=`${n.height}px`;const a=e.querySelectorAll(".table-column-resize-handler"),o=e.querySelectorAll(".table-row-resize-handler"),s=e.querySelector(".table-bottom-resize-handler"),i=e.querySelector(".table-right-resize-handler");if(a.length!==r.columns-1||o.length!==r.rows-1||!s||!i){e.innerHTML="";for(let d=0;d<r.columns-1;d++){const f=Fn(d,r,n,t);e.appendChild(f)}for(let d=0;d<r.rows-1;d++){const f=Un(d,r,n,t);e.appendChild(f)}const u=Wn(r,n);e.appendChild(u);const l=qn(r,n);e.appendChild(l)}else a.forEach((u,l)=>{Gn(u,l,r,n,t)}),o.forEach((u,l)=>{Zn(u,l,r,n,t)}),s&&Yn(s,r,n),i&&Vn(i,r,n)}function je(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function bs(e,t){if(!le(e))return console.warn("insertRowAbove: Invalid table element"),null;if(t<0||t>e.rows.length)return console.warn(`insertRowAbove: Invalid row index ${t}, table has ${e.rows.length} rows`),null;const r=e.rows[t];if(!r)return console.warn(`insertRowAbove: Could not find reference row at index ${t}`),null;const n=document.createElement("tr"),a=r.cells.length;for(let s=0;s<a;s++){const i=document.createElement("td");i.innerHTML="&nbsp;",n.appendChild(i)}try{r.parentNode.insertBefore(n,r)}catch(s){return console.error("insertRowAbove: Failed to insert row",s),null}he(e);const o=ue(e);return o&&Te(e,{columnWidths:o.columnWidths,rowHeights:o.rowHeights}),n}function Ts(e,t){if(!le(e))return console.warn("insertRowBelow: Invalid table element"),null;if(t<0||t>=e.rows.length)return console.warn(`insertRowBelow: Invalid row index ${t}, table has ${e.rows.length} rows`),null;const r=e.rows[t];if(!r)return console.warn(`insertRowBelow: Could not find reference row at index ${t}`),null;const n=document.createElement("tr"),a=r.cells.length;for(let i=0;i<a;i++){const h=document.createElement("td");h.innerHTML="&nbsp;",n.appendChild(h)}const o=r.nextSibling;try{o?r.parentNode.insertBefore(n,o):r.parentNode.appendChild(n)}catch(i){return console.error("insertRowBelow: Failed to insert row",i),null}he(e);const s=ue(e);return s&&Te(e,{columnWidths:s.columnWidths,rowHeights:s.rowHeights}),n}function Gn(e,t,r,n,a){if(a&&a.rows.length>0){const s=a.rows[0];if(s.cells.length>t){const h=s.cells[t].getBoundingClientRect(),u=a.getBoundingClientRect(),l=h.right-u.left-2;e.style.left=`${l}px`,e.style.height=`${n.height}px`;return}}let o=0;for(let s=0;s<=t;s++)o+=r.columnWidths[s];e.style.left=`${o-2}px`,e.style.height=`${n.height}px`}function Zn(e,t,r,n,a){if(a&&a.rows.length>t){const s=a.rows[t];if(s.cells.length>0){const h=s.cells[0].getBoundingClientRect(),u=a.getBoundingClientRect(),l=h.bottom-u.top-2;e.style.top=`${l}px`,e.style.width=`${n.width}px`;return}}let o=0;for(let s=0;s<=t;s++)o+=r.rowHeights[s];e.style.top=`${o-2}px`,e.style.width=`${n.width}px`}function Yn(e,t,r){e.style.bottom="-2px",e.style.left="0px",e.style.width=`${r.width}px`}function Vn(e,t,r){e.style.right="-2px",e.style.top="0px",e.style.height=`${r.height}px`}function vs(e,t){if(!le(e))return console.warn("insertColumnLeft: Invalid table element"),!1;if(t<0)return console.warn(`insertColumnLeft: Invalid column index ${t}`),!1;const r=Array.from(e.rows);if(r.length===0)return console.warn("insertColumnLeft: Table has no rows"),!1;if(t>r[0].cells.length)return console.warn(`insertColumnLeft: Column index ${t} out of bounds`),!1;try{for(const a of r){const o=document.createElement("td");o.innerHTML="&nbsp;",t<a.cells.length?a.insertBefore(o,a.cells[t]):a.appendChild(o)}he(e);const n=ue(e);return n&&Te(e,{columnWidths:n.columnWidths,rowHeights:n.rowHeights}),!0}catch(n){return console.error("insertColumnLeft: Failed to insert column",n),!1}}function Es(e,t){if(!le(e))return console.warn("insertColumnRight: Invalid table element"),!1;if(t<0)return console.warn(`insertColumnRight: Invalid column index ${t}`),!1;const r=Array.from(e.rows);if(r.length===0)return console.warn("insertColumnRight: Table has no rows"),!1;if(t>=r[0].cells.length)return console.warn(`insertColumnRight: Column index ${t} out of bounds`),!1;try{for(const a of r){const o=document.createElement("td");o.innerHTML="&nbsp;";const s=a.cells[t+1];s?a.insertBefore(o,s):a.appendChild(o)}he(e);const n=ue(e);return n&&Te(e,{columnWidths:n.columnWidths,rowHeights:n.rowHeights}),!0}catch(n){return console.error("insertColumnRight: Failed to insert column",n),!1}}function ws(e,t){if(!le(e))return console.warn("deleteRow: Invalid table element"),!1;if(t<0||t>=e.rows.length)return console.warn(`deleteRow: Invalid row index ${t}, table has ${e.rows.length} rows`),!1;if(e.rows.length<=1)return console.warn("deleteRow: Cannot delete the last row in the table"),!1;try{const r=e.rows[t];r.parentNode.removeChild(r),he(e);const n=ue(e);return n&&Te(e,{columnWidths:n.columnWidths,rowHeights:n.rowHeights}),!0}catch(r){return console.error("deleteRow: Failed to delete row",r),!1}}function xs(e,t){if(!le(e))return console.warn("deleteColumn: Invalid table element"),!1;if(t<0)return console.warn(`deleteColumn: Invalid column index ${t}`),!1;const r=Array.from(e.rows);if(r.length===0)return console.warn("deleteColumn: Table has no rows"),!1;if(t>=r[0].cells.length)return console.warn(`deleteColumn: Column index ${t} out of bounds`),!1;if(r[0].cells.length<=1)return console.warn("deleteColumn: Cannot delete the last column in the table"),!1;try{for(const a of r)a.cells.length>t&&a.removeChild(a.cells[t]);he(e);const n=ue(e);return n&&Te(e,{columnWidths:n.columnWidths,rowHeights:n.rowHeights}),!0}catch(n){return console.error("deleteColumn: Failed to delete column",n),!1}}const Qe=({editorRef:e,onTableResize:t,onTableSelect:r,onTableDeselect:n,resizeOptions:a=De})=>{const o=c.useRef(null),s=c.useRef(null),i=c.useRef(null),h=c.useRef(null),u=c.useRef(null),l=c.useRef(a),d=c.useRef(!1),[f,v]=c.useState(null),T=pe();c.useEffect(()=>{l.current=a},[a]);const E=c.useCallback(()=>{s.current&&(s.current.classList.remove("selected"),s.current=null),o.current&&(je(o.current),o.current=null),v(null),i.current=null,h.current=null,u.current=null,d.current=!1,n&&n()},[n]),_=c.useCallback(S=>{if(S.preventDefault(),S.stopPropagation(),!s.current)return;const j=S.currentTarget,G=j.dataset.type,q=parseInt(j.dataset.index,10);s.current.getBoundingClientRect(),window.pageYOffset||document.documentElement.scrollTop,window.pageXOffset||document.documentElement.scrollLeft;const B=ue(s.current);i.current={x:S.clientX,y:S.clientY,structure:{...B}},h.current=G,u.current=q,d.current=!0,document.body.classList.add("table-resize-in-progress");const C={[ae.COLUMN]:"col-resize",[ae.ROW]:"row-resize",[ae.TABLE_BOTTOM]:"ns-resize",[ae.TABLE_RIGHT]:"ew-resize"};document.body.style.cursor=C[G]||"default",document.addEventListener("mousemove",M),document.addEventListener("mouseup",m)},[]),z=c.useCallback(S=>{const j=zn(S,l.current);return j&&(o.current=j,s.current=S,document.body.appendChild(j),j.querySelectorAll(".table-resize-handler").forEach(q=>{q.addEventListener("mousedown",_)})),j},[_]),L=c.useCallback(S=>{if(!le(S))return;o.current&&(je(o.current),o.current=null),S.classList.add("selected"),z(S)&&(v(S),r&&r(S))},[r,z]),M=c.useCallback(S=>{if(!d.current||!s.current||!i.current||!h.current)return;S.preventDefault(),S.stopPropagation();const{x:j,y:G,structure:q}=i.current,B=h.current,C=u.current,N=S.clientX,A=S.clientY;let P=0;switch(B){case ae.COLUMN:P=N-j;break;case ae.ROW:P=A-G;break;case ae.TABLE_BOTTOM:P=A-G;break;case ae.TABLE_RIGHT:P=N-j;break}const V=$n({type:B,index:C,delta:P,currentStructure:q,options:l.current});Te(s.current,V),o.current&&Je(o.current,s.current)},[]),m=c.useCallback(S=>{if(d.current){if(S.preventDefault(),S.stopPropagation(),s.current&&i.current){const j={structure:i.current.structure},G={structure:ue(s.current)};(j.structure.width!==G.structure.width||j.structure.height!==G.structure.height||JSON.stringify(j.structure.columnWidths)!==JSON.stringify(G.structure.columnWidths)||JSON.stringify(j.structure.rowHeights)!==JSON.stringify(G.structure.rowHeights))&&T.recordOperation({type:"TABLE_RESIZE",payload:{element:s.current,state:G}},{type:"TABLE_RESIZE",payload:{element:s.current,state:j}})}if(i.current=null,h.current=null,u.current=null,d.current=!1,document.removeEventListener("mousemove",M),document.removeEventListener("mouseup",m),document.body.classList.remove("table-resize-in-progress"),document.body.style.cursor="",s.current){const j=new Event("input",{bubbles:!0,cancelable:!0});s.current.dispatchEvent(j),t&&t(s.current,ue(s.current))}}},[t,T]),g=c.useCallback(S=>{o.current&&!o.current.contains(S.target)&&E();const G=S.target.closest("table");if(G&&le(G)){if(G===s.current)return;L(G)}},[L,E]),b=c.useCallback(S=>{if(S.key==="Delete"&&s.current&&!d.current){S.preventDefault();const j=s.current;if(j.parentNode){j.parentNode.removeChild(j),E();const G=new Event("input",{bubbles:!0,cancelable:!0});e.current.dispatchEvent(G)}}S.key==="Escape"&&s.current&&E()},[e,E]),I=c.useCallback(()=>{o.current&&s.current&&Je(o.current,s.current)},[]);return c.useEffect(()=>{if(!e.current)return;const j=e.current.closest(".editor-viewport");return j&&(j.addEventListener("scroll",I),window.addEventListener("scroll",I)),()=>{j&&j.removeEventListener("scroll",I),window.removeEventListener("scroll",I)}},[e,I]),c.useEffect(()=>{if(!e.current)return;const S=e.current;return S.addEventListener("click",g),S.addEventListener("keydown",b),window.addEventListener("resize",I),()=>{S.removeEventListener("click",g),S.removeEventListener("keydown",b),window.removeEventListener("resize",I),d.current&&(document.removeEventListener("mousemove",M),document.removeEventListener("mouseup",m),document.body.classList.remove("table-resize-in-progress"),document.body.style.cursor=""),o.current&&je(o.current)}},[e,g,b,I,M,m]),c.useEffect(()=>{if(!e.current)return;const S=new MutationObserver(j=>{j.forEach(G=>{G.type==="childList"&&(G.removedNodes.forEach(q=>{q.nodeType===Node.ELEMENT_NODE&&le(q)&&q===f&&E()}),G.addedNodes.forEach(q=>{if(q.nodeType!==Node.ELEMENT_NODE)return;if(le(q)){setTimeout(()=>L(q),50);return}const B=q.querySelectorAll?.("table")||[];B.length>0&&setTimeout(()=>L(B[0]),50)}))})});return S.observe(e.current,{childList:!0,subtree:!0}),()=>S.disconnect()},[e,E,L]),c.useEffect(()=>{if(!f)return;const S=new MutationObserver(j=>{j.some(q=>{if(q.type==="childList"){if([...q.addedNodes,...q.removedNodes].some(C=>C.nodeType===Node.ELEMENT_NODE&&C.tagName==="TR"))return!0}else if(q.type==="attributes"&&["colspan","rowspan"].includes(q.attributeName))return!0;return!1})&&o.current&&s.current&&(je(o.current),o.current=null,z(s.current))});return S.observe(f,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["colspan","rowspan"]}),()=>S.disconnect()},[f,z]),null};Qe.propTypes={editorRef:w.shape({current:w.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onTableResize:w.func,onTableSelect:w.func,onTableDeselect:w.func,resizeOptions:w.shape({minColumnWidth:w.number,minRowHeight:w.number,maxColumnWidth:w.number,maxRowHeight:w.number,tableMinWidth:w.number,tableMinHeight:w.number,tableMaxWidth:w.number,tableMaxHeight:w.number})},Qe.defaultProps={onTableResize:void 0,onTableSelect:void 0,onTableDeselect:void 0,resizeOptions:De};const jt=({tableElement:e,onAlignChange:t,onClose:r,selectedRowIndex:n,selectedColIndex:a,editorRef:o})=>{const[s,i]=c.useState({top:0,left:0}),[h,u]=c.useState(!1),[l,d]=c.useState("top"),f=c.useRef(null),v=c.useRef(null),T=pe(),E=A=>{if(!A)return;(typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame:V=>setTimeout(V,16))(()=>{const V=document.querySelector(".table-resize-overlay");V&&Je(V,A)})},_=A=>{if(!A)return null;const P=window.getComputedStyle(A);return{float:P.float||"none",margin:A.style.margin||"",marginLeft:A.style.marginLeft||"",marginRight:A.style.marginRight||"",display:P.display||"table"}},z=c.useCallback(()=>{if(!e)return"left";const A=window.getComputedStyle(e);return A.marginLeft==="auto"&&A.marginRight==="auto"?"center":A.float==="right"?"right":(A.float==="left","left")},[e]),[L,M]=c.useState("left");c.useEffect(()=>{e&&M(z())},[e,z]);const m=c.useCallback(()=>{if(!e||!f.current)return;const A=e.getBoundingClientRect(),P=f.current.getBoundingClientRect(),V=window.visualViewport?window.visualViewport:{width:window.innerWidth,height:window.innerHeight},re=A.bottom>=0&&A.top<=V.height&&A.right>=0&&A.left<=V.width;let oe="top",x=0,p=0;if(re){const Z=A.top-P.height-10,$=V.height-A.bottom-P.height-10;$>Z&&$>0?(oe="bottom",x=A.bottom+10):(oe="top",x=A.top-P.height-10)}else oe="top",x=10;p=A.left+A.width/2-P.width/2;const O=window.innerWidth,H=window.innerHeight;let R=Math.max(10,Math.min(p,O-P.width-10)),K=Math.max(10,Math.min(x,H-P.height-10));i({top:K,left:R}),d(oe),u(!0)},[e]);c.useLayoutEffect(()=>{m();const A=()=>{m()},P=v.current;return P&&P.addEventListener("scroll",A),window.addEventListener("scroll",A),window.addEventListener("resize",A),()=>{P&&P.removeEventListener("scroll",A),window.removeEventListener("scroll",A),window.removeEventListener("resize",A),u(!1)}},[e,m]),c.useEffect(()=>{const A=P=>{f.current&&!f.current.contains(P.target)&&P.target!==e&&!e.contains(P.target)&&r()};return document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)}},[e,r]);const g={left:{float:"left",margin:"10px 10px 10px 0",marginLeft:"",marginRight:""},center:{float:"none",margin:"10px auto",marginLeft:"auto",marginRight:"auto"},right:{float:"right",margin:"10px 0 10px 10px",marginLeft:"",marginRight:""}},b=A=>{if(e&&g[A]){const P=_(e),V=L,re=g[A];e.style.float=re.float,e.style.margin=re.margin,e.style.marginLeft=re.marginLeft,e.style.marginRight=re.marginRight,M(A),E(e);const oe=_(e);T.recordOperation({type:"TABLE_ALIGN",payload:{element:e,alignment:A,state:oe}},{type:"TABLE_ALIGN",payload:{element:e,alignment:V,state:P}}),t&&t(A)}},I=()=>{if(console.log("handleInsertRowAbove called",{selectedRowIndex:n,tableElement:e,hasEditorRef:!!o}),!e){console.warn("handleInsertRowAbove: No table element");return}if(n==null){console.warn("handleInsertRowAbove: No row selected");return}console.log(`Inserting row above index ${n}`);const A=bs(e,n);if(A){if(console.log("Row inserted successfully, updating content"),o&&o.current){const P=o.current.innerHTML;console.log("Updated content length:",P.length),T.updateContinuousContent(P)}else console.warn("No editor ref available to update content");T.recordOperation({type:"INSERT_ROW",payload:{element:e,row:A,position:"above",index:n}},{type:"DELETE_ROW",payload:{element:e,index:n}}),E(e),requestAnimationFrame(()=>m())}else console.error("Failed to insert row above")},S=()=>{if(console.log("handleInsertRowBelow called",{selectedRowIndex:n,tableElement:e,hasEditorRef:!!o}),!e){console.warn("handleInsertRowBelow: No table element");return}if(n==null){console.warn("handleInsertRowBelow: No row selected");return}console.log(`Inserting row below index ${n}`);const A=Ts(e,n);if(A){if(console.log("Row inserted successfully, updating content"),o&&o.current){const P=o.current.innerHTML;console.log("Updated content length:",P.length),T.updateContinuousContent(P)}else console.warn("No editor ref available to update content");T.recordOperation({type:"INSERT_ROW",payload:{element:e,row:A,position:"below",index:n}},{type:"DELETE_ROW",payload:{element:e,index:n+1}}),E(e),requestAnimationFrame(()=>m())}else console.error("Failed to insert row below")},j=()=>{if(console.log("handleInsertColumnLeft called",{selectedColIndex:a,tableElement:e,hasEditorRef:!!o}),!e){console.warn("handleInsertColumnLeft: No table element");return}if(a==null){console.warn("handleInsertColumnLeft: No column selected");return}if(console.log(`Inserting column left of index ${a}`),vs(e,a)){if(console.log("Column inserted successfully, updating content"),o&&o.current){const P=o.current.innerHTML;console.log("Updated content length:",P.length),T.updateContinuousContent(P)}else console.warn("No editor ref available to update content");T.recordOperation({type:"INSERT_COLUMN",payload:{element:e,position:"left",index:a}},{type:"DELETE_COLUMN",payload:{element:e,index:a}}),E(e),requestAnimationFrame(()=>m())}else console.error("Failed to insert column left")},G=()=>{if(console.log("handleInsertColumnRight called",{selectedColIndex:a,tableElement:e,hasEditorRef:!!o}),!e){console.warn("handleInsertColumnRight: No table element");return}if(a==null){console.warn("handleInsertColumnRight: No column selected");return}if(console.log(`Inserting column right of index ${a}`),Es(e,a)){if(console.log("Column inserted successfully, updating content"),o&&o.current){const P=o.current.innerHTML;console.log("Updated content length:",P.length),T.updateContinuousContent(P)}else console.warn("No editor ref available to update content");T.recordOperation({type:"INSERT_COLUMN",payload:{element:e,position:"right",index:a}},{type:"DELETE_COLUMN",payload:{element:e,index:a+1}}),E(e),requestAnimationFrame(()=>m())}else console.error("Failed to insert column right")},q=()=>{if(console.log("handleDeleteRow called",{selectedRowIndex:n,tableElement:e,hasEditorRef:!!o}),!e){console.warn("handleDeleteRow: No table element");return}if(n==null){console.warn("handleDeleteRow: No row selected");return}if(console.log(`Deleting row at index ${n}`),ws(e,n)){if(console.log("Row deleted successfully, updating content"),o&&o.current){const P=o.current.innerHTML;console.log("Updated content length:",P.length),T.updateContinuousContent(P)}else console.warn("No editor ref available to update content");T.recordOperation({type:"DELETE_ROW",payload:{element:e,index:n}},{type:"INSERT_ROW",payload:{element:e,position:"at",index:n}}),E(e),requestAnimationFrame(()=>m())}else console.error("Failed to delete row")},B=()=>{if(console.log("handleDeleteColumn called",{selectedColIndex:a,tableElement:e,hasEditorRef:!!o}),!e){console.warn("handleDeleteColumn: No table element");return}if(a==null){console.warn("handleDeleteColumn: No column selected");return}if(console.log(`Deleting column at index ${a}`),xs(e,a)){if(console.log("Column deleted successfully, updating content"),o&&o.current){const P=o.current.innerHTML;console.log("Updated content length:",P.length),T.updateContinuousContent(P)}else console.warn("No editor ref available to update content");T.recordOperation({type:"DELETE_COLUMN",payload:{element:e,index:a}},{type:"INSERT_COLUMN",payload:{element:e,position:"at",index:a}}),E(e),requestAnimationFrame(()=>m())}else console.error("Failed to delete column")},C={border:"1px solid #ccc",borderRadius:"4px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"28px",height:"28px"},N=A=>({...C,background:A?"#007bff":"transparent",color:A?"#fff":"#333"});return!e||typeof document>"u"?null:Ut.createPortal(y.jsxs("div",{ref:f,className:"table-tooltip-menu","data-menu-position":l,"aria-hidden":!h,style:{position:"fixed",top:`${s.top}px`,left:`${s.left}px`,zIndex:999,background:"#fff",border:"1px solid #ddd",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"8px",display:"flex",gap:"2px",alignItems:"center",pointerEvents:h?"auto":"none",minWidth:"100px",minHeight:"32px",opacity:h?1:0,visibility:h?"visible":"hidden",transition:"opacity 0.15s ease, visibility 0.15s ease"},children:[y.jsx("button",{className:`tooltip-button ${L==="left"?"active":""}`,onClick:()=>b("left"),title:"Align Left",style:N(L==="left"),children:y.jsx(Pt,{size:14})}),y.jsx("button",{className:`tooltip-button ${L==="center"?"active":""}`,onClick:()=>b("center"),title:"Align Center",style:N(L==="center"),children:y.jsx(Nt,{size:14})}),y.jsx("button",{className:`tooltip-button ${L==="right"?"active":""}`,onClick:()=>b("right"),title:"Align Right",style:N(L==="right"),children:y.jsx(Ot,{size:14})}),n!=null&&y.jsxs(y.Fragment,{children:[y.jsx("div",{style:{width:"1px",height:"24px",background:"#ddd",margin:"0 4px"}}),y.jsx("button",{className:"tooltip-button insert-row-above",onClick:I,title:"Insert Row Above",style:{...C,background:"#28a745",color:"#fff"},disabled:n==null,children:y.jsx(_o,{size:14})}),y.jsx("button",{className:"tooltip-button insert-row-below",onClick:S,title:"Insert Row Below",style:{...C,background:"#28a745",color:"#fff"},disabled:n==null,children:y.jsx(xo,{size:14})}),y.jsx("button",{className:"tooltip-button delete-row",onClick:q,title:"Delete Row",style:{...C,background:"#dc3545",color:"#fff"},disabled:n==null,children:y.jsx(Mt,{size:14})})]}),a!=null&&y.jsxs(y.Fragment,{children:[y.jsx("div",{style:{width:"1px",height:"24px",background:"#ddd",margin:"0 4px"}}),y.jsx("button",{className:"tooltip-button insert-column-left",onClick:j,title:"Insert Column Left",style:{...C,background:"#0056b3",color:"#fff"},disabled:a==null,children:y.jsx(Co,{size:14})}),y.jsx("button",{className:"tooltip-button insert-column-right",onClick:G,title:"Insert Column Right",style:{...C,background:"#0056b3",color:"#fff"},disabled:a==null,children:y.jsx(Ao,{size:14})}),y.jsx("button",{className:"tooltip-button delete-column",onClick:B,title:"Delete Column",style:{...C,background:"#dc3545",color:"#fff"},disabled:a==null,children:y.jsx(Mt,{size:14})})]})]}),document.body)};jt.propTypes={tableElement:w.instanceOf(typeof Element<"u"?Element:Object),onAlignChange:w.func,onClose:w.func.isRequired,selectedRowIndex:w.number,selectedColIndex:w.number,editorRef:w.shape({current:w.instanceOf(typeof Element<"u"?Element:Object)})},jt.defaultProps={tableElement:null,onAlignChange:void 0,selectedRowIndex:null,selectedColIndex:null,editorRef:null};const Bt=({editorRef:e,onCellSelectionChange:t})=>{const[r,n]=c.useState(new Set),[a,o]=c.useState(null),[s,i]=c.useState(null),[h,u]=c.useState(null),[l,d]=c.useState(!1),[f,v]=c.useState(!1),[T,E]=c.useState(null),[_,z]=c.useState(null);pe(),c.useRef(null);const L=c.useRef(null),M=c.useCallback(()=>{n(new Set),o(null),i(null),u(null),E(null),z(null),d(!1),v(!1),document.querySelectorAll(".table-cell-selected, .table-row-selected, .table-col-selected").forEach(B=>{B.classList.remove("table-cell-selected","table-row-selected","table-col-selected")}),L.current!==null&&(L.current=null,t&&t(null))},[t]),m=c.useCallback(B=>{const C=B.closest("tr"),N=B.closest("table");if(!C||!N)return null;const A=Array.from(N.rows).indexOf(C),P=Array.from(C.cells).indexOf(B);return{rowIndex:A,cellIndex:P,table:N}},[]),g=c.useCallback(B=>{if(B.size===0)return{mode:null,rowIndex:null,colIndex:null};const C=Array.from(B),N=C[0],A=m(N);if(!A)return{mode:null,rowIndex:null,colIndex:null};const{table:P}=A;return C.filter(oe=>{const x=m(oe);return x&&x.table===P&&x.rowIndex===A.rowIndex}).length>=2?{mode:"row",rowIndex:A.rowIndex,colIndex:null}:C.filter(oe=>{const x=m(oe);return x&&x.table===P&&x.cellIndex===A.cellIndex}).length>=2?{mode:"column",rowIndex:null,colIndex:A.cellIndex}:{mode:null,rowIndex:null,colIndex:null}},[m]),b=c.useCallback((B,C,N,A,P)=>{if(document.querySelectorAll(".table-cell-selected, .table-row-selected, .table-col-selected").forEach(V=>{V.classList.remove("table-cell-selected","table-row-selected","table-col-selected")}),!(!P||!B)){if(B==="row"&&C!==null){const V=P.rows[C];V&&Array.from(V.cells).forEach(re=>{re.classList.add("table-row-selected")})}else B==="column"&&N!==null?Array.from(P.rows).forEach(V=>{const re=V.cells[N];re&&re.classList.add("table-col-selected")}):B==="cells"&&A.forEach(V=>{V.classList.add("table-cell-selected")});window.getSelection&&window.getSelection().removeAllRanges()}},[]),I=c.useCallback((B,C)=>{const N=g(B);n(B),o(N.mode),i(N.rowIndex),u(N.colIndex),z(C),b(N.mode,N.rowIndex,N.colIndex,B,C);const A=N.mode?{mode:N.mode,cells:B,rowIndex:N.rowIndex,colIndex:N.colIndex,table:C}:null;JSON.stringify(L.current)!==JSON.stringify(A)&&(L.current=A,t&&t(A))},[g,b,t]),S=c.useCallback(B=>{const C=B.target.closest("td, th");if(!C)return;const N=m(C);N&&(d(!0),E(C),z(N.table),v(!1))},[m]),j=c.useCallback(B=>{if(!l||!T)return;const C=B.target.closest("td, th");if(!C||!_||!_.contains(C))return;v(!0),B.preventDefault();const N=m(T),A=m(C);if(!N||!A||N.table!==A.table)return;const P=Math.min(N.rowIndex,A.rowIndex),V=Math.max(N.rowIndex,A.rowIndex),re=Math.min(N.cellIndex,A.cellIndex),oe=Math.max(N.cellIndex,A.cellIndex),x=new Set;for(let p=P;p<=V;p++){const O=_.rows[p];if(O)for(let H=re;H<=oe;H++){const R=O.cells[H];R&&x.add(R)}}I(x,_)},[l,m]),G=c.useCallback(()=>{f||M(),d(!1),E(null)},[f,M]),q=c.useCallback(B=>{const C=B.target.closest("td, th"),N=B.target.closest("table");if(!(C&&_&&_.contains(C))){if(N&&N!==_){M();return}N||M()}},[M,_]);return c.useEffect(()=>{if(!e.current)return;const B=e.current,C=A=>{A.target.closest("td, th")&&S(A)},N=A=>{A.target.closest("td, th")&&j(A)};return B.addEventListener("mousedown",C,!0),B.addEventListener("mouseenter",N,!0),document.addEventListener("mouseup",G),document.addEventListener("click",q),()=>{B.removeEventListener("mousedown",C,!0),B.removeEventListener("mouseenter",N,!0),document.removeEventListener("mouseup",G),document.removeEventListener("click",q)}},[e,S,j,G,q]),c.useEffect(()=>{if(!e.current)return;const B=new MutationObserver(C=>{C.forEach(N=>{N.type==="childList"&&_&&!e.current.contains(_)&&M()})});return B.observe(e.current,{childList:!0,subtree:!0}),()=>B.disconnect()},[e,M]),null};Bt.propTypes={editorRef:w.shape({current:w.instanceOf(typeof Element<"u"?Element:Object)}).isRequired,onCellSelectionChange:w.func},Bt.defaultProps={onCellSelectionChange:void 0};const Cs=50,et=50,As=50,_s=100,ks=300,tt=c.forwardRef(({pageManagerComponent:e=null,onNavigatePage:t,onAddPage:r,onDeletePage:n,onPageSizeChange:a,onPageMarginsChange:o,onChange:s,showSidebar:i=!0,showToolbar:h=!0,showPageManager:u=!0},l)=>{const d=vt(),f=pe(),{pageSize:v,pageMargins:T,continuousContent:E,pageBoundaries:_,activePage:z,zoomLevel:L,canUndo:M,canRedo:m}=d,g=c.useRef(null),b=c.useRef(null),{currentFormat:I,formatText:S,updateCurrentFormatFromSelection:j}=gn(),[G,q]=c.useState(!1),[B,C]=c.useState(null),[N,A]=c.useState(!0),[P,V]=c.useState(!1),[re,oe]=c.useState(null),[x,p]=c.useState(null),[O,H]=c.useState(null),R=c.useRef(null),{checkAndUpdateBoundaries:K,getCurrentPage:Z,scrollToPage:$,updateBoundaries:W,triggerAutoReflow:J,removePageAndContent:ee,removePageBreak:ie,insertPageBreakAtBoundary:D}=vn(v,b,L,T),de=c.useMemo(()=>_e(v),[v]),[ke,nt]=c.useState(!1),Ce=c.useRef(null),rt=c.useRef(!1),ot=c.useRef(!1),zt=c.useRef(!1),Ae=c.useRef(E);c.useEffect(()=>{if(b.current){if(!zt.current){b.current.innerHTML=E,zt.current=!0,Ae.current=E;const k=setTimeout(()=>{W()},Cs);return()=>clearTimeout(k)}if(Ae.current!==E){if(b.current.innerHTML!==E){b.current.innerHTML=E;const X=setTimeout(()=>{W(),rt.current&&Xn()},et);return Ae.current=E,()=>clearTimeout(X)}Ae.current=E}}},[E,W,_.length,f,$]),c.useEffect(()=>{s&&zt.current&&s(E)},[E,s]);const st=c.useCallback(()=>{if(!b.current)return;const k=window.getSelection();if(R.current)try{k.removeAllRanges(),k.addRange(R.current);return}catch(se){console.warn("[restoreCursorPosition] Failed to restore cursor:",se)}const X=b.current.lastChild;if(X){const se=document.createRange();X.nodeType===Node.TEXT_NODE?se.setStart(X,X.textContent.length):se.setStartAfter(X),se.collapse(!0),k.removeAllRanges(),k.addRange(se)}},[]),at=c.useCallback(()=>{if(!b.current)return!1;const k=window.getSelection();if(!k||k.rangeCount===0)return!1;const X=k.getRangeAt(0);return b.current.contains(X.commonAncestorContainer)},[]),Kn=c.useMemo(()=>({getHTMLContent:()=>b.current?b.current.innerHTML:E,getPlainText:()=>(b.current?b.current.innerHTML:E).replace(/<[^>]*>/g," ").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\s+/g," ").trim(),getCursorPosition:()=>b.current?Jr(b.current):null,setContent:k=>{const X=Ye(k);X!==E&&f.updateContinuousContent(X),b.current&&b.current.innerHTML!==X&&(b.current.innerHTML=X),Ae.current=X,b.current&&setTimeout(()=>{W()},et)},setPageSize:k=>{f.updatePageSize(k),W({pageSize:k})},setPageMargins:k=>{f.updatePageMargins(k),W({pageMargins:k})},insertContent:k=>{if(!b.current||!k)return;const X=Ye(k);at()||st(),document.execCommand("insertHTML",!1,X);const se=b.current.innerHTML;f.updateContinuousContent(se),Ae.current=se,setTimeout(()=>{W(),J(200)},et)}}),[E,f,W,J,at,st]);c.useImperativeHandle(l,()=>Kn,[Kn]),c.useEffect(()=>{const k=()=>{if(j(),b.current){const se=window.getSelection();if(se.rangeCount>0){const me=se.getRangeAt(0);me.collapsed&&b.current.contains(me.commonAncestorContainer)&&(R.current=me.cloneRange())}}};document.addEventListener("selectionchange",k);const X=()=>{if(setTimeout(j,10),R.current&&b.current)try{const se=window.getSelection();se.removeAllRanges(),se.addRange(R.current)}catch(se){console.warn("[handleFocus] Failed to restore cursor:",se)}};return b.current&&b.current.addEventListener("focus",X),()=>{document.removeEventListener("selectionchange",k),b.current&&b.current.removeEventListener("focus",X)}},[j]);const Xn=c.useCallback(()=>{rt.current=!1;const k=Math.max(0,_.length-1);f.setActivePage(k),setTimeout(()=>{$(k,g)},As)},[_.length,f,$]),Ft=c.useCallback(()=>{if(!b.current)return;let k=b.current.innerHTML;k=Ye(k),k!==b.current.innerHTML&&(b.current.innerHTML=k);const X=E;if(X!==k){const me={type:"UPDATE_CONTINUOUS_CONTENT",payload:k},Be={type:"UPDATE_CONTINUOUS_CONTENT",payload:X};f.recordOperation(me,Be)}f.updateContinuousContent(k),K(),J(200);const se=Z(g);se!==z&&f.setActivePage(se)},[f,K,Z,z,J,g,b,E]),Ss=c.useCallback(k=>{Ft()},[Ft]),Jn=c.useCallback(k=>{f.updatePageSize(k),W({pageSize:k}),a&&a(k)},[f,W,a]),Qn=c.useCallback(k=>{f.updatePageMargins(k),W({pageMargins:k}),o&&o(k)},[f,W,o]),er=c.useCallback(k=>{k<0||k>=_.length||(ot.current=!0,f.setActivePage(k),$(k,g),setTimeout(()=>{ot.current=!1},ks),t&&t(k))},[f,$,t,_.length]),tr=c.useCallback(()=>{const k=_.length+1;D(k)&&(rt.current=!0,setTimeout(()=>{rt.current&&Xn()},100)),r&&r()},[_.length,D,f,$,r]),Ns=c.useCallback(()=>{const k=window.getSelection();if(k&&k.rangeCount>0){if(!b?.current)return;const me=`<page-break data-page-break="true" contenteditable="false" data-page-number="${b.current.querySelectorAll('page-break, [data-page-break="true"]').length+2}"></page-break><p><br></p>`;document.execCommand("insertHTML",!1,me),setTimeout(()=>{W();const Be=Z(g);f.setActivePage(Be)},150)}},[W,Z,f,g]),Os=c.useCallback(k=>{if(!b.current||!k)return;at()||st(),document.execCommand("insertHTML",!1,k);const X=b.current.innerHTML;f.updateContinuousContent(X),Ae.current=X,setTimeout(()=>{W(),J(200)},et)},[f,W,J,at,st]),Ps=c.useCallback(k=>{if(!k)return;ie(k)&&setTimeout(()=>{const se=Z(g);f.setActivePage(se)},200)},[ie,Z,f,g]),nr=c.useCallback(k=>{if(_.length<=1){console.warn("Cannot delete the only page");return}ee(k)&&(f.setActivePage(0),n&&n(k))},[_.length,ee,f,n]),it=c.useCallback(()=>{f.zoomIn()},[f]),lt=c.useCallback(()=>{f.zoomOut()},[f]),ct=c.useCallback(()=>{f.resetZoom()},[f]),rr=c.useCallback(()=>{f.undo()},[f]),or=c.useCallback(()=>{f.redo()},[f]);c.useEffect(()=>{const k=X=>{if(X.ctrlKey||X.metaKey){["+","=","-","_","0","z","y"].includes(X.key)&&X.preventDefault();const se=document.activeElement===b.current,me=document.activeElement===g.current,Be=document.activeElement?.tagName==="INPUT"||document.activeElement?.tagName==="TEXTAREA"||document.activeElement?.isContentEditable===!1;if(se||me||!Be)switch(X.key){case"+":case"=":it();break;case"-":case"_":lt();break;case"0":ct();break;case"z":X.shiftKey||rr();break;case"y":or();break}}};return window.addEventListener("keydown",k),()=>{window.removeEventListener("keydown",k)}},[it,lt,ct,rr,or]);const Ms=c.useCallback(()=>{!g.current||!b.current||ot.current||(Ce.current&&clearTimeout(Ce.current),Ce.current=setTimeout(()=>{if(ot.current){Ce.current=null;return}const k=Z(g);k!==z&&k>=0&&f.setActivePage(k),Ce.current=null},_s))},[Z,z,f]),Ls=c.useMemo(()=>{if(!E)return 0;const X=E.replace(/<[^>]*>/g," ").match(new RegExp("\\p{L}+","gu"));return X?X.length:0},[E]),Rs=_.length||1,Is=c.useCallback(k=>{q(!0),C(k)},[]),sr=c.useCallback(()=>{q(!1),C(null)},[]),Hs=c.useCallback((k,X)=>{},[]),Ds=c.useCallback(k=>{k&&k.mode==="row"?(p(k.rowIndex),H(null)):k&&k.mode==="column"?(H(k.colIndex),p(null)):(p(null),H(null))},[]),js=c.useCallback(k=>{V(!0),oe(k)},[]),ar=c.useCallback(()=>{V(!1),oe(null)},[]),Bs=c.useCallback((k,X)=>{},[]);return c.useEffect(()=>()=>{Ce.current&&clearTimeout(Ce.current)},[]),y.jsxs("div",{className:"multi-page-editor",children:[h&&y.jsx(Ke,{currentFormat:{...I,imageSelected:G},onFormatText:S,onAddPageBreak:Ns,onInsertImage:Os,canUndo:M,canRedo:m}),y.jsxs("div",{className:"editor-container",children:[i&&y.jsx(Mn,{editorView:null,isCollapsed:ke,onToggle:()=>nt(k=>!k),wordCount:Ls,pageCount:Rs}),y.jsx("div",{className:"editor-viewport continuous-scroll",ref:g,onScroll:Ms,children:y.jsx(Dn,{content:E,dimensions:de,pageSize:v,pageMargins:T,pageBoundaries:_,editorRef:b,onInput:Ss,onContentChange:Ft,onClick:()=>b.current?.focus(),onRemovePageBreak:Ps,zoomLevel:L})}),y.jsx(Xe,{editorRef:b,onImageSelect:Is,onImageDeselect:sr,onImageResize:Hs,resizeOptions:{...Ee,preserveAspectRatio:N,aspectRatio:N}}),y.jsx(Qe,{editorRef:b,onTableSelect:js,onTableDeselect:ar,onTableResize:Bs}),y.jsx(Bt,{editorRef:b,onCellSelectionChange:Ds}),G&&B&&y.jsx(Dt,{imageElement:B,initialPreserveAspectRatio:N,onAlignChange:k=>{},onAspectRatioToggle:k=>{A(k)},onDelete:()=>{if(B){const k=B.getAttribute("data-key");k&&An(k).catch(X=>{console.error("Failed to delete image from IndexedDB:",X)})}},onClose:sr}),P&&re&&y.jsx(jt,{tableElement:re,onAlignChange:k=>{},onClose:ar,selectedRowIndex:x,selectedColIndex:O,editorRef:b}),u&&y.jsx("div",{className:"page-manager-sidebar",children:e?c.cloneElement(e,{onNavigate:er,onAddPage:tr,onDeletePage:nr,onPageSizeChange:Jn,onPageMarginsChange:Qn,zoomLevel:L,canZoomIn:gt(L),canZoomOut:ht(L),onZoomIn:it,onZoomOut:lt,onZoomReset:ct}):y.jsx(jn,{pageBoundaries:_,activePage:z,pageSize:v,pageMargins:T,zoomLevel:L,canZoomIn:gt(L),canZoomOut:ht(L),onNavigate:er,onAddPage:tr,onDeletePage:nr,onPageSizeChange:Jn,onPageMarginsChange:Qn,onZoomIn:it,onZoomOut:lt,onZoomReset:ct})})]})]})});tt.displayName="HtmlEditor",tt.propTypes={pageManagerComponent:w.element,onNavigatePage:w.func,onAddPage:w.func,onDeletePage:w.func,onPageSizeChange:w.func,onPageMarginsChange:w.func,onChange:w.func,showSidebar:w.bool,showToolbar:w.bool,showPageManager:w.bool},tt.defaultProps={pageManagerComponent:null,onNavigatePage:void 0,onAddPage:void 0,onDeletePage:void 0,onPageSizeChange:void 0,onPageMarginsChange:void 0,onChange:void 0,showSidebar:!0,showToolbar:!0,showPageManager:!0};class $t extends c.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,r){console.error("[ErrorBoundary] Caught error:",t),console.error("[ErrorBoundary] Error info:",r),this.setState({error:t,errorInfo:r}),this.props.onError&&this.props.onError(t,r)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onReset&&this.props.onReset()};render(){return this.state.hasError?this.props.fallback?this.props.fallback:y.jsxs("div",{style:{padding:"20px",margin:"20px",border:"2px solid #f44336",borderRadius:"4px",backgroundColor:"#ffebee",color:"#c62828"},children:[y.jsx("h2",{style:{marginTop:0},children:"⚠️ Something went wrong"}),y.jsx("p",{children:"The editor encountered an unexpected error and couldn't continue."}),this.props.showDetails&&this.state.error&&y.jsxs("details",{style:{marginTop:"10px",padding:"10px",backgroundColor:"white",borderRadius:"4px",fontSize:"12px",fontFamily:"monospace"},children:[y.jsx("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Error Details"}),y.jsxs("pre",{style:{marginTop:"10px",overflow:"auto",maxHeight:"200px"},children:[this.state.error.toString(),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}),y.jsx("button",{onClick:this.handleReset,style:{marginTop:"15px",padding:"8px 16px",backgroundColor:"#f44336",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:"Try Again"})]}):this.props.children}}$t.propTypes={children:w.node.isRequired,fallback:w.node,onError:w.func,onReset:w.func,showDetails:w.bool},$t.defaultProps={fallback:null,onError:void 0,onReset:void 0,showDetails:process.env.NODE_ENV==="development"},F.COMMON_FONT_SIZES=un,F.ColorPickerDropdown=Rt,F.DEFAULT_FONT_SIZE=Le,F.DEFAULT_IMAGE_RESIZE_OPTIONS=Ee,F.DEFAULT_PAGE_SIZE=mt,F.DEFAULT_TABLE_RESIZE_OPTIONS=De,F.DocumentProvider=Tr,F.EditorToolbar=Ke,F.ErrorBoundary=$t,F.FONT_SIZE_MAP=St,F.HtmlEditor=tt,F.ImageResizeHandlers=Xe,F.PAGE_SIZES=Oe,F.PageManager=jn,F.PageView=Dn,F.RESIZE_HANDLERS=U,F.Sidebar=Mn,F.TABLE_RESIZE_HANDLERS=ae,F.TableResizeHandlers=Qe,F.applyImageDimensions=no,F.applyTableDimensions=Te,F.calculateResizeDimensions=eo,F.calculateTableResizeDimensions=$n,F.clearImages=io,F.createResizeOverlay=En,F.createTableResizeOverlay=zn,F.deleteImage=An,F.getAllImageKeys=lo,F.getAvailablePageSizes=mr,F.getImage=Cn,F.getImageDimensions=to,F.getPageDimensions=_e,F.getPixelValue=Sr,F.getPointValue=Nr,F.getTableStructure=ue,F.isResizableImage=ge,F.isResizableTable=le,F.isValidFontSize=Or,F.isValidPageSize=hr,F.logger=Ln,F.pixelsToPoints=fn,F.pointsToPixels=dn,F.removeResizeOverlay=Ze,F.removeTableResizeOverlay=je,F.saveImage=xn,F.updateResizeOverlay=Ge,F.updateTableResizeOverlay=Je,F.useContinuousReflow=vn,F.useDocument=Tt,F.useDocumentActions=pe,F.useDocumentState=vt,F.useFormatting=gn,Object.defineProperty(F,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=htmleditor.umd.cjs.map
