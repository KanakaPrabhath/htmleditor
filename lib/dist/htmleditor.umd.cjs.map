{"version":3,"file":"htmleditor.umd.cjs","sources":["../../node_modules/react/cjs/react-jsx-runtime.production.js","../../node_modules/react/cjs/react-jsx-runtime.development.js","../../node_modules/react/jsx-runtime.js","../src/lib/editor/zoom-utils.js","../src/lib/editor/margin-utils.js","../src/lib/editor/page-sizes.js","../src/context/DocumentContext.jsx","../src/lib/editor/font-sizes.js","../src/hooks/useFormatting.js","../src/lib/editor/page-boundary-utils.js","../src/lib/editor/page-break-utils.js","../src/lib/editor/content-reflow-utils.js","../src/lib/editor/cursor-scroll-utils.js","../src/hooks/useContinuousReflow.js","../src/hooks/useKeyboardShortcuts.js","../src/hooks/useSelectionHandling.js","../src/lib/editor/image-resize-utils.js","../src/lib/storage/index-db.js","../src/lib/editor/content-normalize-utils.js","../../node_modules/lucide-react/dist/esm/shared/src/utils.js","../../node_modules/lucide-react/dist/esm/defaultAttributes.js","../../node_modules/lucide-react/dist/esm/Icon.js","../../node_modules/lucide-react/dist/esm/createLucideIcon.js","../../node_modules/lucide-react/dist/esm/icons/arrow-down.js","../../node_modules/lucide-react/dist/esm/icons/arrow-left.js","../../node_modules/lucide-react/dist/esm/icons/arrow-right.js","../../node_modules/lucide-react/dist/esm/icons/arrow-up.js","../../node_modules/lucide-react/dist/esm/icons/chevron-left.js","../../node_modules/lucide-react/dist/esm/icons/chevron-right.js","../../node_modules/lucide-react/dist/esm/icons/file-check.js","../../node_modules/lucide-react/dist/esm/icons/file-text.js","../../node_modules/lucide-react/dist/esm/icons/hash.js","../../node_modules/lucide-react/dist/esm/icons/heading-1.js","../../node_modules/lucide-react/dist/esm/icons/heading-2.js","../../node_modules/lucide-react/dist/esm/icons/heading-3.js","../../node_modules/lucide-react/dist/esm/icons/image-upscale.js","../../node_modules/lucide-react/dist/esm/icons/list.js","../../node_modules/lucide-react/dist/esm/icons/palette.js","../../node_modules/lucide-react/dist/esm/icons/plus.js","../../node_modules/lucide-react/dist/esm/icons/scaling.js","../../node_modules/lucide-react/dist/esm/icons/settings.js","../../node_modules/lucide-react/dist/esm/icons/text-align-center.js","../../node_modules/lucide-react/dist/esm/icons/text-align-end.js","../../node_modules/lucide-react/dist/esm/icons/text-align-start.js","../../node_modules/lucide-react/dist/esm/icons/trash-2.js","../../node_modules/lucide-react/dist/esm/icons/x.js","../../node_modules/lucide-react/dist/esm/icons/zoom-in.js","../../node_modules/lucide-react/dist/esm/icons/zoom-out.js","../src/components/editor/Sidebar.jsx","../src/components/editor/icons.jsx","../src/lib/editor/utils/logger.js","../src/lib/editor/indentation-utils.js","../src/components/editor/ColorPickerDropdown.jsx","../src/components/editor/EditorToolbar.jsx","../src/lib/editor/paste-utils.js","../src/components/editor/PageView.jsx","../src/components/editor/PageManager.jsx","../src/components/editor/ImageResizeHandlers.jsx","../src/components/editor/ImageTooltipMenu.jsx","../src/lib/editor/dom-utils.js","../src/lib/editor/table-resize-utils.js","../src/components/editor/TableResizeHandlers.jsx","../src/components/editor/TableTooltipMenu.jsx","../src/components/editor/TableCellSelection.jsx","../src/components/editor/HtmlEditor.jsx","../src/components/ErrorBoundary.jsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\nvar REACT_ELEMENT_TYPE = Symbol.for(\"react.transitional.element\"),\n  REACT_FRAGMENT_TYPE = Symbol.for(\"react.fragment\");\nfunction jsxProd(type, config, maybeKey) {\n  var key = null;\n  void 0 !== maybeKey && (key = \"\" + maybeKey);\n  void 0 !== config.key && (key = \"\" + config.key);\n  if (\"key\" in config) {\n    maybeKey = {};\n    for (var propName in config)\n      \"key\" !== propName && (maybeKey[propName] = config[propName]);\n  } else maybeKey = config;\n  config = maybeKey.ref;\n  return {\n    $$typeof: REACT_ELEMENT_TYPE,\n    type: type,\n    key: key,\n    ref: void 0 !== config ? config : null,\n    props: maybeKey\n  };\n}\nexports.Fragment = REACT_FRAGMENT_TYPE;\nexports.jsx = jsxProd;\nexports.jsxs = jsxProd;\n","/**\n * @license React\n * react-jsx-runtime.development.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\n\"production\" !== process.env.NODE_ENV &&\n  (function () {\n    function getComponentNameFromType(type) {\n      if (null == type) return null;\n      if (\"function\" === typeof type)\n        return type.$$typeof === REACT_CLIENT_REFERENCE\n          ? null\n          : type.displayName || type.name || null;\n      if (\"string\" === typeof type) return type;\n      switch (type) {\n        case REACT_FRAGMENT_TYPE:\n          return \"Fragment\";\n        case REACT_PROFILER_TYPE:\n          return \"Profiler\";\n        case REACT_STRICT_MODE_TYPE:\n          return \"StrictMode\";\n        case REACT_SUSPENSE_TYPE:\n          return \"Suspense\";\n        case REACT_SUSPENSE_LIST_TYPE:\n          return \"SuspenseList\";\n        case REACT_ACTIVITY_TYPE:\n          return \"Activity\";\n      }\n      if (\"object\" === typeof type)\n        switch (\n          (\"number\" === typeof type.tag &&\n            console.error(\n              \"Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue.\"\n            ),\n          type.$$typeof)\n        ) {\n          case REACT_PORTAL_TYPE:\n            return \"Portal\";\n          case REACT_CONTEXT_TYPE:\n            return type.displayName || \"Context\";\n          case REACT_CONSUMER_TYPE:\n            return (type._context.displayName || \"Context\") + \".Consumer\";\n          case REACT_FORWARD_REF_TYPE:\n            var innerType = type.render;\n            type = type.displayName;\n            type ||\n              ((type = innerType.displayName || innerType.name || \"\"),\n              (type = \"\" !== type ? \"ForwardRef(\" + type + \")\" : \"ForwardRef\"));\n            return type;\n          case REACT_MEMO_TYPE:\n            return (\n              (innerType = type.displayName || null),\n              null !== innerType\n                ? innerType\n                : getComponentNameFromType(type.type) || \"Memo\"\n            );\n          case REACT_LAZY_TYPE:\n            innerType = type._payload;\n            type = type._init;\n            try {\n              return getComponentNameFromType(type(innerType));\n            } catch (x) {}\n        }\n      return null;\n    }\n    function testStringCoercion(value) {\n      return \"\" + value;\n    }\n    function checkKeyStringCoercion(value) {\n      try {\n        testStringCoercion(value);\n        var JSCompiler_inline_result = !1;\n      } catch (e) {\n        JSCompiler_inline_result = !0;\n      }\n      if (JSCompiler_inline_result) {\n        JSCompiler_inline_result = console;\n        var JSCompiler_temp_const = JSCompiler_inline_result.error;\n        var JSCompiler_inline_result$jscomp$0 =\n          (\"function\" === typeof Symbol &&\n            Symbol.toStringTag &&\n            value[Symbol.toStringTag]) ||\n          value.constructor.name ||\n          \"Object\";\n        JSCompiler_temp_const.call(\n          JSCompiler_inline_result,\n          \"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.\",\n          JSCompiler_inline_result$jscomp$0\n        );\n        return testStringCoercion(value);\n      }\n    }\n    function getTaskName(type) {\n      if (type === REACT_FRAGMENT_TYPE) return \"<>\";\n      if (\n        \"object\" === typeof type &&\n        null !== type &&\n        type.$$typeof === REACT_LAZY_TYPE\n      )\n        return \"<...>\";\n      try {\n        var name = getComponentNameFromType(type);\n        return name ? \"<\" + name + \">\" : \"<...>\";\n      } catch (x) {\n        return \"<...>\";\n      }\n    }\n    function getOwner() {\n      var dispatcher = ReactSharedInternals.A;\n      return null === dispatcher ? null : dispatcher.getOwner();\n    }\n    function UnknownOwner() {\n      return Error(\"react-stack-top-frame\");\n    }\n    function hasValidKey(config) {\n      if (hasOwnProperty.call(config, \"key\")) {\n        var getter = Object.getOwnPropertyDescriptor(config, \"key\").get;\n        if (getter && getter.isReactWarning) return !1;\n      }\n      return void 0 !== config.key;\n    }\n    function defineKeyPropWarningGetter(props, displayName) {\n      function warnAboutAccessingKey() {\n        specialPropKeyWarningShown ||\n          ((specialPropKeyWarningShown = !0),\n          console.error(\n            \"%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)\",\n            displayName\n          ));\n      }\n      warnAboutAccessingKey.isReactWarning = !0;\n      Object.defineProperty(props, \"key\", {\n        get: warnAboutAccessingKey,\n        configurable: !0\n      });\n    }\n    function elementRefGetterWithDeprecationWarning() {\n      var componentName = getComponentNameFromType(this.type);\n      didWarnAboutElementRef[componentName] ||\n        ((didWarnAboutElementRef[componentName] = !0),\n        console.error(\n          \"Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.\"\n        ));\n      componentName = this.props.ref;\n      return void 0 !== componentName ? componentName : null;\n    }\n    function ReactElement(type, key, props, owner, debugStack, debugTask) {\n      var refProp = props.ref;\n      type = {\n        $$typeof: REACT_ELEMENT_TYPE,\n        type: type,\n        key: key,\n        props: props,\n        _owner: owner\n      };\n      null !== (void 0 !== refProp ? refProp : null)\n        ? Object.defineProperty(type, \"ref\", {\n            enumerable: !1,\n            get: elementRefGetterWithDeprecationWarning\n          })\n        : Object.defineProperty(type, \"ref\", { enumerable: !1, value: null });\n      type._store = {};\n      Object.defineProperty(type._store, \"validated\", {\n        configurable: !1,\n        enumerable: !1,\n        writable: !0,\n        value: 0\n      });\n      Object.defineProperty(type, \"_debugInfo\", {\n        configurable: !1,\n        enumerable: !1,\n        writable: !0,\n        value: null\n      });\n      Object.defineProperty(type, \"_debugStack\", {\n        configurable: !1,\n        enumerable: !1,\n        writable: !0,\n        value: debugStack\n      });\n      Object.defineProperty(type, \"_debugTask\", {\n        configurable: !1,\n        enumerable: !1,\n        writable: !0,\n        value: debugTask\n      });\n      Object.freeze && (Object.freeze(type.props), Object.freeze(type));\n      return type;\n    }\n    function jsxDEVImpl(\n      type,\n      config,\n      maybeKey,\n      isStaticChildren,\n      debugStack,\n      debugTask\n    ) {\n      var children = config.children;\n      if (void 0 !== children)\n        if (isStaticChildren)\n          if (isArrayImpl(children)) {\n            for (\n              isStaticChildren = 0;\n              isStaticChildren < children.length;\n              isStaticChildren++\n            )\n              validateChildKeys(children[isStaticChildren]);\n            Object.freeze && Object.freeze(children);\n          } else\n            console.error(\n              \"React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.\"\n            );\n        else validateChildKeys(children);\n      if (hasOwnProperty.call(config, \"key\")) {\n        children = getComponentNameFromType(type);\n        var keys = Object.keys(config).filter(function (k) {\n          return \"key\" !== k;\n        });\n        isStaticChildren =\n          0 < keys.length\n            ? \"{key: someKey, \" + keys.join(\": ..., \") + \": ...}\"\n            : \"{key: someKey}\";\n        didWarnAboutKeySpread[children + isStaticChildren] ||\n          ((keys =\n            0 < keys.length ? \"{\" + keys.join(\": ..., \") + \": ...}\" : \"{}\"),\n          console.error(\n            'A props object containing a \"key\" prop is being spread into JSX:\\n  let props = %s;\\n  <%s {...props} />\\nReact keys must be passed directly to JSX without using spread:\\n  let props = %s;\\n  <%s key={someKey} {...props} />',\n            isStaticChildren,\n            children,\n            keys,\n            children\n          ),\n          (didWarnAboutKeySpread[children + isStaticChildren] = !0));\n      }\n      children = null;\n      void 0 !== maybeKey &&\n        (checkKeyStringCoercion(maybeKey), (children = \"\" + maybeKey));\n      hasValidKey(config) &&\n        (checkKeyStringCoercion(config.key), (children = \"\" + config.key));\n      if (\"key\" in config) {\n        maybeKey = {};\n        for (var propName in config)\n          \"key\" !== propName && (maybeKey[propName] = config[propName]);\n      } else maybeKey = config;\n      children &&\n        defineKeyPropWarningGetter(\n          maybeKey,\n          \"function\" === typeof type\n            ? type.displayName || type.name || \"Unknown\"\n            : type\n        );\n      return ReactElement(\n        type,\n        children,\n        maybeKey,\n        getOwner(),\n        debugStack,\n        debugTask\n      );\n    }\n    function validateChildKeys(node) {\n      isValidElement(node)\n        ? node._store && (node._store.validated = 1)\n        : \"object\" === typeof node &&\n          null !== node &&\n          node.$$typeof === REACT_LAZY_TYPE &&\n          (\"fulfilled\" === node._payload.status\n            ? isValidElement(node._payload.value) &&\n              node._payload.value._store &&\n              (node._payload.value._store.validated = 1)\n            : node._store && (node._store.validated = 1));\n    }\n    function isValidElement(object) {\n      return (\n        \"object\" === typeof object &&\n        null !== object &&\n        object.$$typeof === REACT_ELEMENT_TYPE\n      );\n    }\n    var React = require(\"react\"),\n      REACT_ELEMENT_TYPE = Symbol.for(\"react.transitional.element\"),\n      REACT_PORTAL_TYPE = Symbol.for(\"react.portal\"),\n      REACT_FRAGMENT_TYPE = Symbol.for(\"react.fragment\"),\n      REACT_STRICT_MODE_TYPE = Symbol.for(\"react.strict_mode\"),\n      REACT_PROFILER_TYPE = Symbol.for(\"react.profiler\"),\n      REACT_CONSUMER_TYPE = Symbol.for(\"react.consumer\"),\n      REACT_CONTEXT_TYPE = Symbol.for(\"react.context\"),\n      REACT_FORWARD_REF_TYPE = Symbol.for(\"react.forward_ref\"),\n      REACT_SUSPENSE_TYPE = Symbol.for(\"react.suspense\"),\n      REACT_SUSPENSE_LIST_TYPE = Symbol.for(\"react.suspense_list\"),\n      REACT_MEMO_TYPE = Symbol.for(\"react.memo\"),\n      REACT_LAZY_TYPE = Symbol.for(\"react.lazy\"),\n      REACT_ACTIVITY_TYPE = Symbol.for(\"react.activity\"),\n      REACT_CLIENT_REFERENCE = Symbol.for(\"react.client.reference\"),\n      ReactSharedInternals =\n        React.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,\n      hasOwnProperty = Object.prototype.hasOwnProperty,\n      isArrayImpl = Array.isArray,\n      createTask = console.createTask\n        ? console.createTask\n        : function () {\n            return null;\n          };\n    React = {\n      react_stack_bottom_frame: function (callStackForError) {\n        return callStackForError();\n      }\n    };\n    var specialPropKeyWarningShown;\n    var didWarnAboutElementRef = {};\n    var unknownOwnerDebugStack = React.react_stack_bottom_frame.bind(\n      React,\n      UnknownOwner\n    )();\n    var unknownOwnerDebugTask = createTask(getTaskName(UnknownOwner));\n    var didWarnAboutKeySpread = {};\n    exports.Fragment = REACT_FRAGMENT_TYPE;\n    exports.jsx = function (type, config, maybeKey) {\n      var trackActualOwner =\n        1e4 > ReactSharedInternals.recentlyCreatedOwnerStacks++;\n      return jsxDEVImpl(\n        type,\n        config,\n        maybeKey,\n        !1,\n        trackActualOwner\n          ? Error(\"react-stack-top-frame\")\n          : unknownOwnerDebugStack,\n        trackActualOwner ? createTask(getTaskName(type)) : unknownOwnerDebugTask\n      );\n    };\n    exports.jsxs = function (type, config, maybeKey) {\n      var trackActualOwner =\n        1e4 > ReactSharedInternals.recentlyCreatedOwnerStacks++;\n      return jsxDEVImpl(\n        type,\n        config,\n        maybeKey,\n        !0,\n        trackActualOwner\n          ? Error(\"react-stack-top-frame\")\n          : unknownOwnerDebugStack,\n        trackActualOwner ? createTask(getTaskName(type)) : unknownOwnerDebugTask\n      );\n    };\n  })();\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","/**\r\n * Zoom utilities for the HTML editor\r\n * Provides constants and helper functions for zoom functionality\r\n */\r\n\r\n/**\r\n * Allowed zoom levels in percentage\r\n * Range: 50% to 200% in 5% increments\r\n */\r\nexport const ZOOM_LEVELS = [\r\n  50, 55, 60, 65, 70, 75, 80, 85, 90, 95,\r\n  100, 105, 110, 115, 120, 125, 130, 135, 140, 145,\r\n  150, 155, 160, 165, 170, 175, 180, 185, 190, 195, 200\r\n];\r\n\r\n/**\r\n * Default zoom level\r\n */\r\nexport const DEFAULT_ZOOM = 100;\r\n\r\n/**\r\n * Minimum zoom level\r\n */\r\nexport const MIN_ZOOM = 50;\r\n\r\n/**\r\n * Maximum zoom level\r\n */\r\nexport const MAX_ZOOM = 200;\r\n\r\n/**\r\n * Zoom increment/decrement step\r\n */\r\nexport const ZOOM_STEP = 5;\r\n\r\n/**\r\n * Check if zoom can be increased\r\n * @param {number} currentZoom - Current zoom level\r\n * @returns {boolean} True if zoom can be increased\r\n */\r\nexport const canZoomIn = (currentZoom) => {\r\n  return currentZoom < MAX_ZOOM;\r\n};\r\n\r\n/**\r\n * Check if zoom can be decreased\r\n * @param {number} currentZoom - Current zoom level\r\n * @returns {boolean} True if zoom can be decreased\r\n */\r\nexport const canZoomOut = (currentZoom) => {\r\n  return currentZoom > MIN_ZOOM;\r\n};\r\n\r\n/**\r\n * Get next zoom level (zoom in)\r\n * @param {number} currentZoom - Current zoom level\r\n * @returns {number} Next zoom level or current if at max\r\n */\r\nexport const getNextZoomLevel = (currentZoom) => {\r\n  if (!canZoomIn(currentZoom)) return currentZoom;\r\n  \r\n  const nextLevel = currentZoom + ZOOM_STEP;\r\n  return nextLevel <= MAX_ZOOM ? nextLevel : currentZoom;\r\n};\r\n\r\n/**\r\n * Get previous zoom level (zoom out)\r\n * @param {number} currentZoom - Current zoom level\r\n * @returns {number} Previous zoom level or current if at min\r\n */\r\nexport const getPreviousZoomLevel = (currentZoom) => {\r\n  if (!canZoomOut(currentZoom)) return currentZoom;\r\n  \r\n  const prevLevel = currentZoom - ZOOM_STEP;\r\n  return prevLevel >= MIN_ZOOM ? prevLevel : currentZoom;\r\n};\r\n\r\n/**\r\n * Validate if a zoom level is allowed\r\n * @param {number} zoom - Zoom level to validate\r\n * @returns {boolean} True if zoom level is valid\r\n */\r\nexport const isValidZoomLevel = (zoom) => {\r\n  return zoom >= MIN_ZOOM && zoom <= MAX_ZOOM;\r\n};\r\n\r\n/**\r\n * Get zoom as decimal multiplier\r\n * @param {number} zoom - Zoom percentage\r\n * @returns {number} Decimal multiplier (e.g., 100 -> 1.0, 150 -> 1.5)\r\n */\r\nexport const getZoomMultiplier = (zoom) => {\r\n  return zoom / 100;\r\n};\r\n","/**\r\n * Page Margin Utilities\r\n * \r\n * Provides margin presets and conversion utilities for page margins.\r\n * Margins are defined in inches and converted to pixels at 96 DPI (CSS standard).\r\n * \r\n * DPI Conversion: 1 inch = 96 pixels (CSS/Web standard)\r\n * \r\n * Common margin presets similar to Microsoft Word:\r\n * - Normal: 1\" all sides (most common)\r\n * - Narrow: 0.5\" all sides (minimal margins)\r\n * - Moderate: 1\" top/bottom, 0.75\" left/right\r\n * - Wide: 1\" top/bottom, 2\" left/right\r\n * - Mirrored: For two-sided printing\r\n */\r\n\r\n// DPI constant for CSS/Web (96 DPI is the standard)\r\nexport const CSS_DPI = 96;\r\n\r\n// Convert inches to pixels at 96 DPI\r\nexport const inchesToPixels = (inches) => Math.round(inches * CSS_DPI);\r\n\r\n// Convert pixels to inches\r\nexport const pixelsToInches = (pixels) => pixels / CSS_DPI;\r\n\r\n// Margin preset definitions (in inches)\r\nexport const MARGIN_PRESETS = {\r\n  NORMAL: {\r\n    name: 'Normal',\r\n    label: 'Normal (1\")',\r\n    top: 1,\r\n    bottom: 1,\r\n    left: 1,\r\n    right: 1\r\n  },\r\n  NARROW: {\r\n    name: 'Narrow',\r\n    label: 'Narrow (0.5\")',\r\n    top: 0.5,\r\n    bottom: 0.5,\r\n    left: 0.5,\r\n    right: 0.5\r\n  },\r\n  MODERATE: {\r\n    name: 'Moderate',\r\n    label: 'Moderate (1\" / 0.75\")',\r\n    top: 1,\r\n    bottom: 1,\r\n    left: 0.75,\r\n    right: 0.75\r\n  },\r\n  WIDE: {\r\n    name: 'Wide',\r\n    label: 'Wide (1\" / 2\")',\r\n    top: 1,\r\n    bottom: 1,\r\n    left: 2,\r\n    right: 2\r\n  },\r\n  OFFICE_2003: {\r\n    name: 'Office 2003',\r\n    label: 'Office 2003 (1\" / 1.25\")',\r\n    top: 1,\r\n    bottom: 1,\r\n    left: 1.25,\r\n    right: 1.25\r\n  }\r\n};\r\n\r\n// Default margin preset\r\nexport const DEFAULT_MARGIN_PRESET = 'NORMAL';\r\n\r\n/**\r\n * Convert margin preset to pixel values\r\n * @param {string|Object} marginInput - Name of the preset (e.g., 'NORMAL', 'NARROW') or custom margin object {top, bottom, left, right} in inches\r\n * @returns {Object} Margin object with top, bottom, left, right in pixels\r\n */\r\nexport const getMarginPixels = (marginInput = DEFAULT_MARGIN_PRESET) => {\r\n  // Check if it's a custom margin object\r\n  if (typeof marginInput === 'object' && marginInput !== null && \r\n      typeof marginInput.top === 'number' && \r\n      typeof marginInput.bottom === 'number' && \r\n      typeof marginInput.left === 'number' && \r\n      typeof marginInput.right === 'number') {\r\n    // Custom margins provided in inches\r\n    return {\r\n      top: inchesToPixels(marginInput.top),\r\n      bottom: inchesToPixels(marginInput.bottom),\r\n      left: inchesToPixels(marginInput.left),\r\n      right: inchesToPixels(marginInput.right)\r\n    };\r\n  }\r\n  \r\n  // Otherwise, treat as preset name\r\n  const preset = MARGIN_PRESETS[marginInput] || MARGIN_PRESETS[DEFAULT_MARGIN_PRESET];\r\n  \r\n  return {\r\n    top: inchesToPixels(preset.top),\r\n    bottom: inchesToPixels(preset.bottom),\r\n    left: inchesToPixels(preset.left),\r\n    right: inchesToPixels(preset.right)\r\n  };\r\n};\r\n\r\n/**\r\n * Get total vertical margins (top + bottom)\r\n * @param {string|Object} marginInput - Name of the preset or custom margin object\r\n * @returns {number} Total vertical margins in pixels\r\n */\r\nexport const getTotalVerticalMargins = (marginInput = DEFAULT_MARGIN_PRESET) => {\r\n  const margins = getMarginPixels(marginInput);\r\n  return margins.top + margins.bottom;\r\n};\r\n\r\n/**\r\n * Get total horizontal margins (left + right)\r\n * @param {string|Object} marginInput - Name of the preset or custom margin object\r\n * @returns {number} Total horizontal margins in pixels\r\n */\r\nexport const getTotalHorizontalMargins = (marginInput = DEFAULT_MARGIN_PRESET) => {\r\n  const margins = getMarginPixels(marginInput);\r\n  return margins.left + margins.right;\r\n};\r\n\r\n/**\r\n * Get all available margin preset names\r\n * @returns {Array<string>} Array of preset names\r\n */\r\nexport const getMarginPresetNames = () => {\r\n  return Object.keys(MARGIN_PRESETS);\r\n};\r\n\r\n/**\r\n * Get margin preset label for display\r\n * @param {string|Object} marginInput - Name of the preset or custom margin object\r\n * @returns {string} Display label\r\n */\r\nexport const getMarginPresetLabel = (marginInput) => {\r\n  // Check if it's a custom margin object\r\n  if (typeof marginInput === 'object' && marginInput !== null && \r\n      typeof marginInput.top === 'number' && \r\n      typeof marginInput.bottom === 'number' && \r\n      typeof marginInput.left === 'number' && \r\n      typeof marginInput.right === 'number') {\r\n    // Custom margins - format as \"Custom (top/bottom x left/right)\"\r\n    return `Custom (${marginInput.top}\" / ${marginInput.left}\")`;\r\n  }\r\n  \r\n  // Otherwise, treat as preset name\r\n  const preset = MARGIN_PRESETS[marginInput];\r\n  return preset ? preset.label : 'Unknown';\r\n};\r\n\r\n/**\r\n * Check if margins are custom (not a preset)\r\n * @param {string|Object} marginInput - Margin input to check\r\n * @returns {boolean} True if custom margins\r\n */\r\nexport const isCustomMargins = (marginInput) => {\r\n  return typeof marginInput === 'object' && marginInput !== null && \r\n         typeof marginInput.top === 'number' && \r\n         typeof marginInput.bottom === 'number' && \r\n         typeof marginInput.left === 'number' && \r\n         typeof marginInput.right === 'number';\r\n};\r\n\r\n/**\r\n * Validate if a preset name exists\r\n * @param {string} presetName - Name to validate\r\n * @returns {boolean} True if valid\r\n */\r\nexport const isValidMarginPreset = (presetName) => {\r\n  return presetName in MARGIN_PRESETS;\r\n};\r\n\r\nexport default {\r\n  CSS_DPI,\r\n  inchesToPixels,\r\n  pixelsToInches,\r\n  MARGIN_PRESETS,\r\n  DEFAULT_MARGIN_PRESET,\r\n  getMarginPixels,\r\n  getTotalVerticalMargins,\r\n  getTotalHorizontalMargins,\r\n  getMarginPresetNames,\r\n  getMarginPresetLabel,\r\n  isValidMarginPreset,\r\n  isCustomMargins\r\n};\r\n","/**\r\n * Page size constants with real-world dimensions\r\n * Dimensions calculated at 96 DPI (Microsoft Word standard for screen display)\r\n */\r\n\r\n/**\r\n * Page size configurations\r\n * All dimensions in pixels at 96 DPI (matching Microsoft Word)\r\n * \r\n * Conversion: 1 inch = 96 pixels, 1 mm = 96/25.4 pixels\r\n */\r\nexport const PAGE_SIZES = {\r\n  A4: {\r\n    name: 'A4',\r\n    width: 794,  // 210mm = 210 * 96 / 25.4 ≈ 794px (Word A4 width)\r\n    height: 1123, // 297mm = 297 * 96 / 25.4 ≈ 1123px (Word A4 height)\r\n    widthMm: 210,\r\n    heightMm: 297,\r\n    widthIn: 8.27,\r\n    heightIn: 11.69\r\n  },\r\n  Letter: {\r\n    name: 'Letter',\r\n    width: 816,  // 8.5 inches = 8.5 * 96 = 816px (Word Letter width)\r\n    height: 1056, // 11 inches = 11 * 96 = 1056px (Word Letter height)\r\n    widthMm: 216,\r\n    heightMm: 279,\r\n    widthIn: 8.5,\r\n    heightIn: 11\r\n  },\r\n  Legal: {\r\n    name: 'Legal',\r\n    width: 816,  // 8.5 inches = 8.5 * 96 = 816px (Word Legal width)\r\n    height: 1344, // 14 inches = 14 * 96 = 1344px (Word Legal height)\r\n    widthMm: 216,\r\n    heightMm: 356,\r\n    widthIn: 8.5,\r\n    heightIn: 14\r\n  }\r\n};\r\n\r\n/**\r\n * Default page size\r\n */\r\nexport const DEFAULT_PAGE_SIZE = 'A4';\r\n\r\n/**\r\n * Get page dimensions for a given size\r\n * @param {string} size - Page size ('A4', 'Letter', 'Legal')\r\n * @returns {Object} Dimensions object with width and height\r\n */\r\nexport const getPageDimensions = (size) => {\r\n  const pageSize = PAGE_SIZES[size] || PAGE_SIZES[DEFAULT_PAGE_SIZE];\r\n  return {\r\n    width: pageSize.width,\r\n    height: pageSize.height\r\n  };\r\n};\r\n\r\n/**\r\n * Validate if a page size is supported\r\n * @param {string} size - Page size to validate\r\n * @returns {boolean} True if page size is valid\r\n */\r\nexport const isValidPageSize = (size) => {\r\n  return Object.keys(PAGE_SIZES).includes(size);\r\n};\r\n\r\n/**\r\n * Get all available page sizes\r\n * @returns {string[]} Array of page size names\r\n */\r\nexport const getAvailablePageSizes = () => {\r\n  return Object.keys(PAGE_SIZES);\r\n};\r\n","import React, { createContext, useContext, useReducer, useCallback, useMemo } from 'react';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { DEFAULT_ZOOM, MIN_ZOOM, MAX_ZOOM, ZOOM_STEP, canZoomIn as checkCanZoomIn, canZoomOut as checkCanZoomOut } from '../lib/editor/zoom-utils.js';\r\nimport { DEFAULT_MARGIN_PRESET } from '../lib/editor/margin-utils.js';\r\nimport { getPageDimensions, DEFAULT_PAGE_SIZE as PAGE_SIZE_DEFAULT } from '../lib/editor/page-sizes.js';\r\n\r\n// Constants moved outside for performance\r\nconst DEFAULT_PAGE_SIZE = PAGE_SIZE_DEFAULT;\r\nconst EMPTY_PARAGRAPH = '<p><br></p>';\r\nconst DEFAULT_EDITOR_MODE = 'continuous';\r\n\r\n// Helper functions moved outside reducer for better performance and reusability\r\nconst createEmptyPage = (index, size = DEFAULT_PAGE_SIZE) => ({\r\n  id: uuidv4(),\r\n  index,\r\n  size,\r\n  content: EMPTY_PARAGRAPH,\r\n  images: [],\r\n  isBreakPoint: false\r\n});\r\n\r\nconst sanitizeContent = (html) => {\r\n  if (typeof html !== 'string' || html.trim() === '') {\r\n    return EMPTY_PARAGRAPH;\r\n  }\r\n  return html;\r\n};\r\n\r\nconst withMinimumPage = (pages, pageSize = DEFAULT_PAGE_SIZE) => {\r\n  const nextPages = pages.length > 0 ? pages : [createEmptyPage(0, pageSize)];\r\n  return nextPages.map((page, index) => ({\r\n    id: page.id || uuidv4(),\r\n    index,\r\n    size: page.size || pageSize,\r\n    content: sanitizeContent(page.content),\r\n    images: page.images || [],\r\n    isBreakPoint: Boolean(page.isBreakPoint)\r\n  }));\r\n};\r\n\r\nconst createDefaultBoundary = (pageSize = DEFAULT_PAGE_SIZE) => {\r\n  const dimensions = getPageDimensions(pageSize);\r\n  return [{\r\n    id: 'page-0',\r\n    pageNumber: 1,\r\n    top: 0,\r\n    height: dimensions.height\r\n  }];\r\n};\r\n\r\nconst generatePageBreaks = (pages) => {\r\n  return pages.slice(0, -1).map((_, index) => ({\r\n    id: `auto-break-${index}`,\r\n    pageNumber: index + 1\r\n  }));\r\n};\r\n\r\nconst buildInitialState = (overrides = {}) => {\r\n  const now = new Date().toISOString();\r\n  const pageSize = overrides.pageSize || DEFAULT_PAGE_SIZE;\r\n  const pages = withMinimumPage(overrides.pages || [createEmptyPage(0, pageSize)], pageSize);\r\n\r\n  return {\r\n    id: uuidv4(),\r\n    title: overrides.title || 'Untitled Document',\r\n    createdAt: now,\r\n    updatedAt: now,\r\n    pageSize,\r\n    pages,\r\n    activePage: overrides.activePage && overrides.activePage < pages.length ? overrides.activePage : 0,\r\n    pageBreaks: overrides.pageBreaks || [],\r\n    totalPages: pages.length,\r\n    editorMode: overrides.editorMode || DEFAULT_EDITOR_MODE,\r\n    continuousContent: overrides.continuousContent || EMPTY_PARAGRAPH,\r\n    pageBoundaries: overrides.pageBoundaries || createDefaultBoundary(pageSize),\r\n    zoomLevel: overrides.zoomLevel || DEFAULT_ZOOM,\r\n    pageMargins: overrides.pageMargins || DEFAULT_MARGIN_PRESET,\r\n    // Undo/Redo state\r\n    undoStack: [],\r\n    redoStack: [],\r\n    canUndo: false,\r\n    canRedo: false\r\n  };\r\n};\r\n\r\n// Action types\r\nconst ActionTypes = {\r\n  INITIALIZE_DOCUMENT: 'INITIALIZE_DOCUMENT',\r\n  UPDATE_TITLE: 'UPDATE_TITLE',\r\n  UPDATE_PAGE_CONTENT: 'UPDATE_PAGE_CONTENT',\r\n  UPDATE_PAGES: 'UPDATE_PAGES',\r\n  ADD_PAGE: 'ADD_PAGE',\r\n  DELETE_PAGE: 'DELETE_PAGE',\r\n  SET_ACTIVE_PAGE: 'SET_ACTIVE_PAGE',\r\n  UPDATE_PAGE_SIZE: 'UPDATE_PAGE_SIZE',\r\n  RESET_DOCUMENT: 'RESET_DOCUMENT',\r\n  UPDATE_CONTINUOUS_CONTENT: 'UPDATE_CONTINUOUS_CONTENT',\r\n  UPDATE_PAGE_BOUNDARIES: 'UPDATE_PAGE_BOUNDARIES',\r\n  ADD_PAGE_BREAK: 'ADD_PAGE_BREAK',\r\n  REMOVE_PAGE_BREAK: 'REMOVE_PAGE_BREAK',\r\n  SET_EDITOR_MODE: 'SET_EDITOR_MODE',\r\n  SET_ZOOM_LEVEL: 'SET_ZOOM_LEVEL',\r\n  ZOOM_IN: 'ZOOM_IN',\r\n  ZOOM_OUT: 'ZOOM_OUT',\r\n  RESET_ZOOM: 'RESET_ZOOM',\r\n  UPDATE_PAGE_MARGINS: 'UPDATE_PAGE_MARGINS',\r\n  // Undo/Redo actions\r\n  RECORD_OPERATION: 'RECORD_OPERATION',\r\n  UNDO: 'UNDO',\r\n  REDO: 'REDO',\r\n  CLEAR_UNDO_REDO: 'CLEAR_UNDO_REDO'\r\n};\r\n\r\n// Reducer\r\nconst documentReducer = (state, action) => {\r\n  const now = new Date().toISOString();\r\n\r\n  switch (action.type) {\r\n    case ActionTypes.INITIALIZE_DOCUMENT: {\r\n      const { initialContent = EMPTY_PARAGRAPH, pageSize = DEFAULT_PAGE_SIZE } = action.payload || {};\r\n      const page = { ...createEmptyPage(0, pageSize), content: sanitizeContent(initialContent) };\r\n      return buildInitialState({\r\n        title: state.title,\r\n        pageSize,\r\n        pages: [page]\r\n      });\r\n    }\r\n\r\n    case ActionTypes.UPDATE_TITLE:\r\n      return {\r\n        ...state,\r\n        title: action.payload,\r\n        updatedAt: now\r\n      };\r\n\r\n    case ActionTypes.UPDATE_PAGE_CONTENT: {\r\n      const { pageIndex, content } = action.payload;\r\n      if (pageIndex < 0 || pageIndex >= state.pages.length) {\r\n        return state;\r\n      }\r\n\r\n      const newPages = [...state.pages];\r\n      newPages[pageIndex] = {\r\n        ...newPages[pageIndex],\r\n        content: sanitizeContent(content)\r\n      };\r\n\r\n      return {\r\n        ...state,\r\n        pages: newPages,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.UPDATE_PAGES: {\r\n      const payload = Array.isArray(action.payload)\r\n        ? { pages: action.payload }\r\n        : action.payload || {};\r\n\r\n      const nextPages = withMinimumPage(payload.pages || [], state.pageSize);\r\n      const pageBreaks = Array.isArray(payload.pageBreaks)\r\n        ? payload.pageBreaks\r\n        : generatePageBreaks(nextPages);\r\n\r\n      return {\r\n        ...state,\r\n        pages: nextPages,\r\n        activePage: Math.min(state.activePage, nextPages.length - 1),\r\n        pageBreaks,\r\n        totalPages: nextPages.length,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.ADD_PAGE: {\r\n      const insertIndex = typeof action.payload?.index === 'number'\r\n        ? Math.min(Math.max(action.payload.index, 0), state.pages.length)\r\n        : state.pages.length;\r\n\r\n      const newPages = [...state.pages];\r\n      newPages.splice(insertIndex, 0, createEmptyPage(insertIndex, state.pageSize));\r\n      \r\n      const updatedPages = newPages.map((page, index) => ({\r\n        ...page,\r\n        index,\r\n        size: state.pageSize\r\n      }));\r\n\r\n      const pageBreaks = generatePageBreaks(updatedPages);\r\n\r\n      return {\r\n        ...state,\r\n        pages: updatedPages,\r\n        activePage: insertIndex,\r\n        pageBreaks,\r\n        totalPages: updatedPages.length,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.DELETE_PAGE: {\r\n      const pageIndex = action.payload;\r\n      if (state.pages.length <= 1) {\r\n        return state;\r\n      }\r\n\r\n      const newPages = [...state.pages];\r\n      newPages.splice(pageIndex, 1);\r\n      \r\n      const updatedPages = newPages.map((page, index) => ({\r\n        ...page,\r\n        index,\r\n        size: state.pageSize\r\n      }));\r\n\r\n      let newActivePage = state.activePage;\r\n      if (newActivePage >= updatedPages.length) {\r\n        newActivePage = updatedPages.length - 1;\r\n      } else if (pageIndex <= newActivePage && newActivePage > 0) {\r\n        newActivePage -= 1;\r\n      }\r\n\r\n      const pageBreaks = generatePageBreaks(updatedPages);\r\n\r\n      return {\r\n        ...state,\r\n        pages: updatedPages,\r\n        activePage: newActivePage,\r\n        pageBreaks,\r\n        totalPages: updatedPages.length,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ACTIVE_PAGE: {\r\n      const pageIndex = action.payload;\r\n      \r\n      // Early exit if same page\r\n      if (pageIndex === state.activePage) {\r\n        return state;\r\n      }\r\n      \r\n      const maxPage = state.editorMode === 'continuous' \r\n        ? state.pageBoundaries.length \r\n        : state.pages.length;\r\n      \r\n      // Validate page index\r\n      if (pageIndex < 0 || pageIndex >= maxPage) {\r\n        return state;\r\n      }\r\n      \r\n      return {\r\n        ...state,\r\n        activePage: pageIndex,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.UPDATE_PAGE_SIZE: {\r\n      const newSize = action.payload;\r\n      \r\n      // Early exit if size hasn't changed\r\n      if (newSize === state.pageSize) {\r\n        return state;\r\n      }\r\n      \r\n      // Validate page size using getPageDimensions\r\n      try {\r\n        getPageDimensions(newSize);\r\n      } catch {\r\n        console.warn(`Invalid page size: ${newSize}`);\r\n        return state;\r\n      }\r\n      \r\n      const updatedPages = state.pages.map((page, index) => ({\r\n        ...page,\r\n        index,\r\n        size: newSize\r\n      }));\r\n\r\n      const pageBreaks = generatePageBreaks(updatedPages);\r\n\r\n      return {\r\n        ...state,\r\n        pageSize: newSize,\r\n        pages: updatedPages,\r\n        pageBreaks,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.RESET_DOCUMENT:\r\n      return buildInitialState();\r\n\r\n    case ActionTypes.UPDATE_CONTINUOUS_CONTENT: {\r\n      const newContent = sanitizeContent(action.payload);\r\n      // Early exit if content hasn't changed\r\n      if (newContent === state.continuousContent) {\r\n        return state;\r\n      }\r\n      return {\r\n        ...state,\r\n        continuousContent: newContent,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.UPDATE_PAGE_BOUNDARIES: {\r\n      const boundaries = Array.isArray(action.payload) ? action.payload : [];\r\n      \r\n      // Early exit if boundaries haven't changed (deep comparison on length and first/last)\r\n      if (boundaries.length === state.pageBoundaries.length && \r\n          boundaries.length > 0 &&\r\n          boundaries[0].id === state.pageBoundaries[0]?.id &&\r\n          boundaries[boundaries.length - 1].id === state.pageBoundaries[boundaries.length - 1]?.id) {\r\n        return state;\r\n      }\r\n      \r\n      const newActivePage = state.activePage >= boundaries.length \r\n        ? Math.max(0, boundaries.length - 1)\r\n        : state.activePage;\r\n\r\n      return {\r\n        ...state,\r\n        pageBoundaries: boundaries,\r\n        totalPages: boundaries.length,\r\n        activePage: newActivePage,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.ADD_PAGE_BREAK: {\r\n      const { position = 'end', pageIndex } = action.payload || {};\r\n      const pageBreakTag = '<page-break data-page-break=\"true\" style=\"display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;\"></page-break>';\r\n      \r\n      let newContent = state.continuousContent;\r\n\r\n      if (position === 'end') {\r\n        newContent = newContent + pageBreakTag + '<p><br></p>';\r\n      } else if (typeof position === 'number') {\r\n        const before = newContent.substring(0, position);\r\n        const after = newContent.substring(position);\r\n        newContent = before + pageBreakTag + after;\r\n      } else if (typeof pageIndex === 'number' && typeof document !== 'undefined') {\r\n        const tempDiv = document.createElement('div');\r\n        tempDiv.innerHTML = newContent;\r\n        \r\n        const pageBreaks = tempDiv.querySelectorAll('page-break, [data-page-break=\"true\"]');\r\n        \r\n        if (pageIndex === 0 && pageBreaks.length === 0) {\r\n          newContent = newContent + pageBreakTag + '<p><br></p>';\r\n        } else if (pageIndex < pageBreaks.length) {\r\n          const targetBreak = pageBreaks[pageIndex];\r\n          const newBreak = document.createElement('page-break');\r\n          newBreak.setAttribute('data-page-break', 'true');\r\n          newBreak.setAttribute('style', 'display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;');\r\n          \r\n          const newParagraph = document.createElement('p');\r\n          newParagraph.innerHTML = '<br>';\r\n          \r\n          targetBreak.parentNode.insertBefore(newBreak, targetBreak.nextSibling);\r\n          newBreak.parentNode.insertBefore(newParagraph, newBreak.nextSibling);\r\n          \r\n          newContent = tempDiv.innerHTML;\r\n        } else {\r\n          newContent = newContent + pageBreakTag + '<p><br></p>';\r\n        }\r\n      }\r\n      \r\n      return {\r\n        ...state,\r\n        continuousContent: newContent,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.REMOVE_PAGE_BREAK: {\r\n      const { pageIndex } = action.payload || {};\r\n      \r\n      if (typeof pageIndex !== 'number' || typeof document === 'undefined') {\r\n        return state;\r\n      }\r\n      \r\n      const tempDiv = document.createElement('div');\r\n      tempDiv.innerHTML = state.continuousContent;\r\n      \r\n      const pageBreaks = tempDiv.querySelectorAll('page-break, [data-page-break=\"true\"]');\r\n      \r\n      if (pageBreaks[pageIndex]) {\r\n        pageBreaks[pageIndex].remove();\r\n      }\r\n      \r\n      const remainingBreaks = tempDiv.querySelectorAll('page-break, [data-page-break=\"true\"]');\r\n      remainingBreaks.forEach((breakEl, index) => {\r\n        breakEl.setAttribute('data-page-number', String(index + 2));\r\n      });\r\n      \r\n      return {\r\n        ...state,\r\n        continuousContent: tempDiv.innerHTML,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_EDITOR_MODE: {\r\n      const newMode = action.payload;\r\n      if (newMode === state.editorMode) {\r\n        return state;\r\n      }\r\n\r\n      let newContent = state.continuousContent;\r\n      let newPages = state.pages;\r\n\r\n      if (newMode === 'continuous') {\r\n        const allContent = state.pages\r\n          .map(page => page.content)\r\n          .filter(content => content && content !== EMPTY_PARAGRAPH)\r\n          .join('\\n');\r\n        newContent = allContent || EMPTY_PARAGRAPH;\r\n      } else {\r\n        if (state.continuousContent && state.continuousContent !== EMPTY_PARAGRAPH) {\r\n          newPages = [{ ...createEmptyPage(0, state.pageSize), content: state.continuousContent }];\r\n        }\r\n      }\r\n      \r\n      return {\r\n        ...state,\r\n        editorMode: newMode,\r\n        continuousContent: newContent,\r\n        pages: newPages,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ZOOM_LEVEL: {\r\n      const newZoomLevel = action.payload;\r\n      \r\n      // Validate zoom level is within bounds\r\n      if (newZoomLevel < MIN_ZOOM || newZoomLevel > MAX_ZOOM) {\r\n        console.warn(`Invalid zoom level: ${newZoomLevel}. Must be between ${MIN_ZOOM} and ${MAX_ZOOM}.`);\r\n        return state;\r\n      }\r\n      \r\n      // Early exit if zoom hasn't changed\r\n      if (newZoomLevel === state.zoomLevel) {\r\n        return state;\r\n      }\r\n      \r\n      return {\r\n        ...state,\r\n        zoomLevel: newZoomLevel,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.ZOOM_IN: {\r\n      if (!checkCanZoomIn(state.zoomLevel)) {\r\n        return state;\r\n      }\r\n      \r\n      const newZoomLevel = state.zoomLevel + ZOOM_STEP;\r\n      return {\r\n        ...state,\r\n        zoomLevel: newZoomLevel,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.ZOOM_OUT: {\r\n      if (!checkCanZoomOut(state.zoomLevel)) {\r\n        return state;\r\n      }\r\n      \r\n      const newZoomLevel = state.zoomLevel - ZOOM_STEP;\r\n      return {\r\n        ...state,\r\n        zoomLevel: newZoomLevel,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.RESET_ZOOM: {\r\n      if (state.zoomLevel === DEFAULT_ZOOM) {\r\n        return state;\r\n      }\r\n      \r\n      return {\r\n        ...state,\r\n        zoomLevel: DEFAULT_ZOOM,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.UPDATE_PAGE_MARGINS: {\r\n      const newMargins = action.payload;\r\n      \r\n      // Early exit if margins haven't changed\r\n      if (newMargins === state.pageMargins) {\r\n        return state;\r\n      }\r\n      \r\n      return {\r\n        ...state,\r\n        pageMargins: newMargins,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.RECORD_OPERATION: {\r\n      const { operation, inverseOperation } = action.payload;\r\n      \r\n      return {\r\n        ...state,\r\n        undoStack: [...state.undoStack, { operation, inverseOperation }],\r\n        redoStack: [], // Clear redo stack when new operation is recorded\r\n        canUndo: true,\r\n        canRedo: false,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.UNDO: {\r\n      if (state.undoStack.length === 0) {\r\n        return state;\r\n      }\r\n\r\n      const lastOperation = state.undoStack[state.undoStack.length - 1];\r\n      const newUndoStack = state.undoStack.slice(0, -1);\r\n      \r\n      // Apply the inverse operation\r\n      let newState = state;\r\n      if (lastOperation.inverseOperation) {\r\n        newState = documentReducer(state, lastOperation.inverseOperation);\r\n      }\r\n\r\n      return {\r\n        ...newState,\r\n        undoStack: newUndoStack,\r\n        redoStack: [...state.redoStack, lastOperation],\r\n        canUndo: newUndoStack.length > 0,\r\n        canRedo: true,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.REDO: {\r\n      if (state.redoStack.length === 0) {\r\n        return state;\r\n      }\r\n\r\n      const operationToRedo = state.redoStack[state.redoStack.length - 1];\r\n      const newRedoStack = state.redoStack.slice(0, -1);\r\n      \r\n      // Apply the original operation\r\n      let newState = state;\r\n      if (operationToRedo.operation) {\r\n        newState = documentReducer(state, operationToRedo.operation);\r\n      }\r\n\r\n      return {\r\n        ...newState,\r\n        undoStack: [...state.undoStack, operationToRedo],\r\n        redoStack: newRedoStack,\r\n        canUndo: true,\r\n        canRedo: newRedoStack.length > 0,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    case ActionTypes.CLEAR_UNDO_REDO: {\r\n      return {\r\n        ...state,\r\n        undoStack: [],\r\n        redoStack: [],\r\n        canUndo: false,\r\n        canRedo: false,\r\n        updatedAt: now\r\n      };\r\n    }\r\n\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\n// Context\r\nconst DocumentContext = createContext(null);\r\n\r\n// Provider Component\r\nexport const DocumentProvider = ({ children, initialState = {} }) => {\r\n  const [state, dispatch] = useReducer(documentReducer, buildInitialState(initialState));\r\n\r\n  // Action creators wrapped in useCallback for performance\r\n  const actions = useMemo(() => ({\r\n    initializeDocument: (payload) => dispatch({ type: ActionTypes.INITIALIZE_DOCUMENT, payload }),\r\n    updateTitle: (title) => dispatch({ type: ActionTypes.UPDATE_TITLE, payload: title }),\r\n    updatePageContent: (payload) => dispatch({ type: ActionTypes.UPDATE_PAGE_CONTENT, payload }),\r\n    updatePages: (payload) => dispatch({ type: ActionTypes.UPDATE_PAGES, payload }),\r\n    addPage: (payload) => dispatch({ type: ActionTypes.ADD_PAGE, payload }),\r\n    deletePage: (pageIndex) => dispatch({ type: ActionTypes.DELETE_PAGE, payload: pageIndex }),\r\n    setActivePage: (pageIndex) => dispatch({ type: ActionTypes.SET_ACTIVE_PAGE, payload: pageIndex }),\r\n    updatePageSize: (size) => dispatch({ type: ActionTypes.UPDATE_PAGE_SIZE, payload: size }),\r\n    resetDocument: () => dispatch({ type: ActionTypes.RESET_DOCUMENT }),\r\n    updateContinuousContent: (content) => dispatch({ type: ActionTypes.UPDATE_CONTINUOUS_CONTENT, payload: content }),\r\n    updatePageBoundaries: (boundaries) => dispatch({ type: ActionTypes.UPDATE_PAGE_BOUNDARIES, payload: boundaries }),\r\n    addPageBreak: (payload) => dispatch({ type: ActionTypes.ADD_PAGE_BREAK, payload }),\r\n    removePageBreak: (payload) => dispatch({ type: ActionTypes.REMOVE_PAGE_BREAK, payload }),\r\n    setEditorMode: (mode) => dispatch({ type: ActionTypes.SET_EDITOR_MODE, payload: mode }),\r\n    setZoomLevel: (level) => dispatch({ type: ActionTypes.SET_ZOOM_LEVEL, payload: level }),\r\n    zoomIn: () => dispatch({ type: ActionTypes.ZOOM_IN }),\r\n    zoomOut: () => dispatch({ type: ActionTypes.ZOOM_OUT }),\r\n    resetZoom: () => dispatch({ type: ActionTypes.RESET_ZOOM }),\r\n    updatePageMargins: (margins) => dispatch({ type: ActionTypes.UPDATE_PAGE_MARGINS, payload: margins }),\r\n    // Undo/Redo actions\r\n    recordOperation: (operation, inverseOperation) => dispatch({ \r\n      type: ActionTypes.RECORD_OPERATION, \r\n      payload: { operation, inverseOperation } \r\n    }),\r\n    undo: () => dispatch({ type: ActionTypes.UNDO }),\r\n    redo: () => dispatch({ type: ActionTypes.REDO }),\r\n    clearUndoRedo: () => dispatch({ type: ActionTypes.CLEAR_UNDO_REDO })\r\n  }), []);\r\n\r\n  const value = useMemo(() => ({\r\n    state,\r\n    actions,\r\n    dispatch\r\n  }), [state, actions]);\r\n\r\n  return (\r\n    <DocumentContext.Provider value={value}>\r\n      {children}\r\n    </DocumentContext.Provider>\r\n  );\r\n};\r\n\r\n// Custom hook to use document context\r\nexport const useDocument = () => {\r\n  const context = useContext(DocumentContext);\r\n  if (!context) {\r\n    throw new Error('useDocument must be used within a DocumentProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\n// Selector hooks for specific state values\r\nexport const useDocumentState = () => {\r\n  const { state } = useDocument();\r\n  return state;\r\n};\r\n\r\nexport const useDocumentActions = () => {\r\n  const { actions } = useDocument();\r\n  return actions;\r\n};\r\n\r\nexport default DocumentContext;\r\n","/**\r\n * Font size constants and conversions\r\n * Approximate conversions from Points (pt) to Pixels (px) at 96 DPI\r\n * \r\n * Standard conversion: 1 pt = 1.333... px (at 96 DPI)\r\n * These values match Microsoft Word's font size rendering\r\n */\r\n\r\n/**\r\n * Font size mapping from points to pixels\r\n * Based on 96 DPI (Microsoft Word standard)\r\n */\r\nexport const FONT_SIZE_MAP = {\r\n  '7.5pt': { pt: 7.5, px: 10, label: '7.5' },\r\n  '9pt': { pt: 9, px: 12, label: '9' },\r\n  '10pt': { pt: 10, px: 13, label: '10' },\r\n  '11pt': { pt: 11, px: 15, label: '11' },\r\n  '12pt': { pt: 12, px: 16, label: '12' },\r\n  '14pt': { pt: 14, px: 19, label: '14' },\r\n  '16pt': { pt: 16, px: 21, label: '16' },\r\n  '18pt': { pt: 18, px: 24, label: '18' },\r\n  '20pt': { pt: 20, px: 27, label: '20' },\r\n  '22pt': { pt: 22, px: 29, label: '22' },\r\n  '24pt': { pt: 24, px: 32, label: '24' },\r\n  '26pt': { pt: 26, px: 35, label: '26' },\r\n  '28pt': { pt: 28, px: 37, label: '28' },\r\n  '36pt': { pt: 36, px: 48, label: '36' },\r\n  '48pt': { pt: 48, px: 64, label: '48' },\r\n  '72pt': { pt: 72, px: 96, label: '72' }\r\n};\r\n\r\n/**\r\n * Common font sizes for editor dropdown\r\n * Values in pixels matching Word's point sizes\r\n */\r\nexport const COMMON_FONT_SIZES = [\r\n  { value: '10px', label: '7.5', pt: 7.5 },   // 7.5 pt ≈ 10 px\r\n  { value: '12px', label: '9', pt: 9 },       // 9 pt ≈ 12 px\r\n  { value: '13px', label: '10', pt: 10 },     // 10 pt ≈ 13 px\r\n  { value: '15px', label: '11', pt: 11 },     // 11 pt ≈ 15 px (default in Word)\r\n  { value: '16px', label: '12', pt: 12 },     // 12 pt ≈ 16 px\r\n  { value: '19px', label: '14', pt: 14 },     // 14 pt ≈ 19 px\r\n  { value: '21px', label: '16', pt: 16 },     // 16 pt ≈ 21 px\r\n  { value: '24px', label: '18', pt: 18 },     // 18 pt ≈ 24 px\r\n  { value: '27px', label: '20', pt: 20 },     // 20 pt ≈ 27 px\r\n  { value: '32px', label: '24', pt: 24 },     // 24 pt ≈ 32 px\r\n  { value: '37px', label: '28', pt: 28 },     // 28 pt ≈ 37 px\r\n  { value: '48px', label: '36', pt: 36 },     // 36 pt ≈ 48 px\r\n  { value: '64px', label: '48', pt: 48 },     // 48 pt ≈ 64 px\r\n  { value: '96px', label: '72', pt: 72 }      // 72 pt ≈ 96 px\r\n];\r\n\r\n/**\r\n * Default font size (9 pt in Word, which is 12px at 96 DPI)\r\n */\r\nexport const DEFAULT_FONT_SIZE = '16px';\r\n\r\n/**\r\n * Convert points to pixels at 96 DPI\r\n * @param {number} points - Font size in points\r\n * @returns {number} Font size in pixels\r\n */\r\nexport const pointsToPixels = (points) => {\r\n  return Math.round(points * 96 / 72);\r\n};\r\n\r\n/**\r\n * Convert pixels to points at 96 DPI\r\n * @param {number} pixels - Font size in pixels\r\n * @returns {number} Font size in points\r\n */\r\nexport const pixelsToPoints = (pixels) => {\r\n  return Math.round((pixels * 72 / 96) * 2) / 2; // Round to nearest 0.5\r\n};\r\n\r\n/**\r\n * Get pixel value from point size\r\n * @param {number} pt - Point size\r\n * @returns {string} Pixel value with 'px' suffix\r\n */\r\nexport const getPixelValue = (pt) => {\r\n  const fontSize = Object.values(FONT_SIZE_MAP).find(size => size.pt === pt);\r\n  return fontSize ? `${fontSize.px}px` : `${pointsToPixels(pt)}px`;\r\n};\r\n\r\n/**\r\n * Get point value from pixel size\r\n * @param {string} px - Pixel size (e.g., '16px')\r\n * @returns {number} Point value\r\n */\r\nexport const getPointValue = (px) => {\r\n  const pixelValue = parseInt(px);\r\n  const fontSize = Object.values(FONT_SIZE_MAP).find(size => size.px === pixelValue);\r\n  return fontSize ? fontSize.pt : pixelsToPoints(pixelValue);\r\n};\r\n\r\n/**\r\n * Validate if a font size is valid\r\n * @param {string} size - Font size to validate (e.g., '16px' or '12pt')\r\n * @returns {boolean} True if valid\r\n */\r\nexport const isValidFontSize = (size) => {\r\n  if (!size) return false;\r\n  \r\n  if (size.endsWith('px')) {\r\n    const px = parseInt(size);\r\n    return px >= 8 && px <= 144; // Min 6pt, Max 108pt\r\n  }\r\n  \r\n  if (size.endsWith('pt')) {\r\n    const pt = parseFloat(size);\r\n    return pt >= 6 && pt <= 108;\r\n  }\r\n  \r\n  return false;\r\n};\r\n","import { useState, useCallback } from 'react';\r\nimport { DEFAULT_FONT_SIZE } from '../lib/editor/font-sizes';\r\nimport { useDocumentActions } from '../context/DocumentContext';\r\n\r\n// Constants for better maintainability\r\n// Font size mapping for execCommand (legacy HTML font sizes 1-7)\r\nconst FONT_SIZE_MAP = {\r\n  '10px': '1',   // 7.5 pt\r\n  '12px': '2',   // 9 pt\r\n  '13px': '2',   // 10 pt\r\n  '15px': '3',   // 11 pt (Word default)\r\n  '16px': '3',   // 12 pt\r\n  '19px': '4',   // 14 pt\r\n  '21px': '4',   // 16 pt\r\n  '24px': '5',   // 18 pt\r\n  '27px': '5',   // 20 pt\r\n  '32px': '6',   // 24 pt\r\n  '37px': '6',   // 28 pt\r\n  '48px': '6',   // 36 pt\r\n  '64px': '7',   // 48 pt\r\n  '96px': '7'    // 72 pt\r\n};\r\n\r\nconst DEFAULT_FORMAT = {\r\n  bold: false,\r\n  italic: false,\r\n  underline: false,\r\n  strikethrough: false,\r\n  alignLeft: false,\r\n  alignCenter: false,\r\n  alignRight: false,\r\n  alignJustify: false,\r\n  fontFamily: 'Arial',\r\n  fontSize: DEFAULT_FONT_SIZE,\r\n  fontColor: '#000000', // Add font color tracking\r\n  headingLevel: 'p' // Add heading level tracking\r\n};\r\n\r\n/**\r\n * useFormatting - Hook for managing text formatting state and commands\r\n * Handles document.execCommand for rich text formatting\r\n * Optimized with better selection handling and error recovery\r\n */\r\nexport const useFormatting = () => {\r\n  const [currentFormat, setCurrentFormat] = useState(DEFAULT_FORMAT);\r\n  const actions = useDocumentActions();\r\n\r\n  /**\r\n   * Helper function to apply a style to the current selection\r\n   */\r\n  const applyStyleToSelection = useCallback((styleProperty, value, fallbackCommand = null) => {\r\n    try {\r\n      // Save current selection\r\n      const selection = window.getSelection();\r\n      if (!selection || selection.rangeCount === 0) {\r\n        return false;\r\n      }\r\n\r\n      const range = selection.getRangeAt(0);\r\n      const selectedText = range.toString();\r\n\r\n      if (!selectedText) {\r\n        // No text selected - just update state for next input\r\n        setCurrentFormat(prev => ({ ...prev, [styleProperty]: value }));\r\n        return false;\r\n      }\r\n\r\n      // Try modern approach first - wrap in span with style\r\n      try {\r\n        const span = document.createElement('span');\r\n        span.style[styleProperty] = value;\r\n\r\n        // Extract contents and wrap\r\n        const fragment = range.extractContents();\r\n        span.appendChild(fragment);\r\n        range.insertNode(span);\r\n\r\n        // Restore selection\r\n        range.selectNodeContents(span);\r\n        selection.removeAllRanges();\r\n        selection.addRange(range);\r\n\r\n        setCurrentFormat(prev => ({ ...prev, [styleProperty]: value }));\r\n        return true;\r\n      } catch {\r\n        // Fallback to execCommand if provided\r\n        if (fallbackCommand) {\r\n          const mappedValue = styleProperty === 'fontSize' ? (FONT_SIZE_MAP[value] || '3') : value;\r\n          document.execCommand(fallbackCommand, false, mappedValue);\r\n          setCurrentFormat(prev => ({ ...prev, [styleProperty]: value }));\r\n          return true;\r\n        }\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      console.warn(`[useFormatting] Style application failed for ${styleProperty}:`, error);\r\n      return false;\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Handle font family with improved reliability\r\n   */\r\n  const handleFontName = useCallback((value) => {\r\n    return applyStyleToSelection('fontFamily', value, 'fontName');\r\n  }, [applyStyleToSelection]);\r\n\r\n  /**\r\n   * Handle font size with improved reliability\r\n   */\r\n  const handleFontSize = useCallback((value) => {\r\n    return applyStyleToSelection('fontSize', value, 'fontSize');\r\n  }, [applyStyleToSelection]);\r\n\r\n  /**\r\n   * Handle font color with improved reliability\r\n   */\r\n  const handleFontColor = useCallback((value) => {\r\n    return applyStyleToSelection('color', value, 'foreColor');\r\n  }, [applyStyleToSelection]);\r\n\r\n  /**\r\n   * Update alignment state based on text-align value\r\n   */\r\n  const updateAlignmentState = useCallback((textAlign) => {\r\n    setCurrentFormat(prev => ({\r\n      ...prev,\r\n      alignLeft: textAlign === 'left',\r\n      alignCenter: textAlign === 'center',\r\n      alignRight: textAlign === 'right',\r\n      alignJustify: textAlign === 'justify'\r\n    }));\r\n  }, []);\r\n\r\n  /**\r\n   * Handle text alignment by applying styles directly to paragraph elements\r\n   * instead of wrapping content in divs with text-align\r\n   */\r\n  const handleTextAlignment = useCallback((command) => {\r\n    try {\r\n      const selection = window.getSelection();\r\n      if (!selection || selection.rangeCount === 0) {\r\n        return false;\r\n      }\r\n\r\n      const range = selection.getRangeAt(0);\r\n      const selectedText = range.toString();\r\n\r\n      // Map command to CSS text-align value\r\n      const alignMap = {\r\n        justifyLeft: 'left',\r\n        justifyCenter: 'center',\r\n        justifyRight: 'right',\r\n        justifyFull: 'justify'\r\n      };\r\n\r\n      const textAlign = alignMap[command];\r\n      if (!textAlign) {\r\n        return false;\r\n      }\r\n\r\n      if (!selectedText) {\r\n        // No text selected - apply to current paragraph or create new one\r\n        const startContainer = range.startContainer;\r\n        const element = startContainer.nodeType === Node.TEXT_NODE\r\n          ? startContainer.parentElement\r\n          : startContainer;\r\n\r\n        const blockElement = findNearestBlockElement(element) || createParagraphAtCursor();\r\n        if (blockElement) {\r\n          blockElement.style.textAlign = textAlign;\r\n          // Update format state\r\n          updateAlignmentState(textAlign);\r\n        }\r\n        return true;\r\n      }\r\n\r\n      // Text is selected - find all block elements in the selection and apply alignment\r\n      const blockElements = findBlockElementsInRange(range);\r\n      \r\n      if (blockElements.length === 0) {\r\n        // No block elements found, wrap selection in a paragraph with alignment\r\n        const p = document.createElement('p');\r\n        p.style.textAlign = textAlign;\r\n        \r\n        const fragment = range.extractContents();\r\n        p.appendChild(fragment);\r\n        range.insertNode(p);\r\n        \r\n        // Restore selection\r\n        range.selectNodeContents(p);\r\n        selection.removeAllRanges();\r\n        selection.addRange(range);\r\n      } else {\r\n        // Apply alignment to all block elements in the selection\r\n        blockElements.forEach(block => {\r\n          block.style.textAlign = textAlign;\r\n        });\r\n      }\r\n\r\n      // Update format state\r\n      updateAlignmentState(textAlign);\r\n      return true;\r\n    } catch (error) {\r\n      console.warn('[useFormatting] Text alignment failed:', error);\r\n      return false;\r\n    }\r\n  }, [updateAlignmentState]);\r\n\r\n  /**\r\n   * Handle insertHTML command with special handling for block elements like tables\r\n   * Ensures tables and other block elements are not wrapped in paragraphs\r\n   */\r\n  const handleInsertHTML = useCallback((html) => {\r\n    try {\r\n      const selection = window.getSelection();\r\n      if (!selection || selection.rangeCount === 0) {\r\n        return false;\r\n      }\r\n\r\n      const range = selection.getRangeAt(0);\r\n\r\n      // Check if the HTML contains block elements that shouldn't be wrapped in paragraphs\r\n      const tempDiv = document.createElement('div');\r\n      tempDiv.innerHTML = html;\r\n      const hasBlockElements = Array.from(tempDiv.children).some(child =>\r\n        ['TABLE', 'UL', 'OL', 'BLOCKQUOTE', 'PRE', 'DIV', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6'].includes(child.tagName)\r\n      );\r\n\r\n      if (hasBlockElements) {\r\n        // For block elements, we need to ensure they're inserted outside of any paragraph context\r\n        const startContainer = range.startContainer;\r\n        const startElement = startContainer.nodeType === Node.TEXT_NODE\r\n          ? startContainer.parentElement\r\n          : startContainer;\r\n\r\n        // Find the nearest block element (paragraph, heading, etc.)\r\n        const blockElement = findNearestBlockElement(startElement);\r\n\r\n        if (blockElement && ['P', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6'].includes(blockElement.tagName)) {\r\n          // We're inside a paragraph or heading - we need to split it or insert after it\r\n          const blockTagName = blockElement.tagName.toLowerCase();\r\n\r\n          // Check if cursor is at the beginning of the block\r\n          const isAtStart = range.startOffset === 0 &&\r\n            (startContainer === blockElement ||\r\n             (startContainer.nodeType === Node.TEXT_NODE && startContainer === blockElement.firstChild));\r\n\r\n          if (isAtStart) {\r\n            // Insert before the current block element\r\n            blockElement.parentNode.insertBefore(tempDiv, blockElement);\r\n          } else {\r\n            // Check if cursor is at the end of the block\r\n            const isAtEnd = range.startOffset === startContainer.textContent?.length &&\r\n              startContainer === blockElement.lastChild &&\r\n              range.endOffset === startContainer.textContent?.length;\r\n\r\n            if (isAtEnd) {\r\n              // Insert after the current block element\r\n              const nextSibling = blockElement.nextSibling;\r\n              if (nextSibling) {\r\n                blockElement.parentNode.insertBefore(tempDiv, nextSibling);\r\n              } else {\r\n                blockElement.parentNode.appendChild(tempDiv);\r\n              }\r\n            } else {\r\n              // Split the block element at cursor position\r\n              const fragment = range.extractContents();\r\n              const remainingText = document.createTextNode('');\r\n\r\n              // Create new block element for remaining content\r\n              const newBlock = document.createElement(blockTagName);\r\n              newBlock.appendChild(remainingText);\r\n              newBlock.appendChild(fragment);\r\n\r\n              // Insert the HTML and new block after current block\r\n              const parent = blockElement.parentNode;\r\n              parent.insertBefore(tempDiv, blockElement.nextSibling);\r\n              parent.insertBefore(newBlock, tempDiv.nextSibling);\r\n\r\n              // If original block is now empty, remove it\r\n              if (!blockElement.textContent.trim() && blockElement.children.length === 0) {\r\n                parent.removeChild(blockElement);\r\n              }\r\n            }\r\n          }\r\n        } else {\r\n          // Not inside a paragraph/heading, insert normally\r\n          range.insertNode(tempDiv);\r\n        }\r\n\r\n        // Move cursor after the inserted content\r\n        range.setStartAfter(tempDiv);\r\n        range.setEndAfter(tempDiv);\r\n        selection.removeAllRanges();\r\n        selection.addRange(range);\r\n      } else {\r\n        // For inline content, use standard execCommand\r\n        document.execCommand('insertHTML', false, html);\r\n      }\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.warn('[useFormatting] InsertHTML failed:', error);\r\n      // Fallback to standard execCommand\r\n      try {\r\n        document.execCommand('insertHTML', false, html);\r\n        return true;\r\n      } catch (fallbackError) {\r\n        console.warn('[useFormatting] InsertHTML fallback also failed:', fallbackError);\r\n        return false;\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Format text using document.execCommand or custom undo/redo\r\n   * Optimized with better error handling and selection management\r\n   */\r\n  const formatText = useCallback((command, value = null) => {\r\n    try {\r\n      // Handle undo/redo commands using custom system\r\n      if (command === 'undo') {\r\n        actions.undo();\r\n        return;\r\n      }\r\n      \r\n      if (command === 'redo') {\r\n        actions.redo();\r\n        return;\r\n      }\r\n\r\n      // Check if document.execCommand is supported\r\n      if (typeof document.execCommand !== 'function') {\r\n        console.warn('[useFormatting] execCommand not supported');\r\n        return;\r\n      }\r\n\r\n      // Handle insertHTML specially for block elements like tables\r\n      if (command === 'insertHTML' && value) {\r\n        handleInsertHTML(value);\r\n        return;\r\n      }\r\n\r\n      // Handle fontSize separately for better control\r\n      if (command === 'fontSize') {\r\n        handleFontSize(value);\r\n        return;\r\n      }\r\n\r\n      // Handle fontName separately for better control\r\n      if (command === 'fontName') {\r\n        handleFontName(value);\r\n        return;\r\n      }\r\n\r\n      // Handle foreColor separately for better control\r\n      if (command === 'foreColor') {\r\n        handleFontColor(value);\r\n        return;\r\n      }\r\n\r\n      // Handle alignment commands specially to apply to paragraph elements instead of wrapping in divs\r\n      if (['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'].includes(command)) {\r\n        handleTextAlignment(command);\r\n        return;\r\n      }\r\n\r\n      // Execute the command\r\n      const success = document.execCommand(command, false, value);\r\n      \r\n      if (!success) {\r\n        console.warn(`[useFormatting] Command \"${command}\" failed`);\r\n      }\r\n\r\n      // Update format state based on command - but let selection change handle the actual state\r\n      // This is kept for immediate feedback but will be overridden by selection change\r\n      switch (command) {\r\n        case 'bold':\r\n        case 'italic':\r\n        case 'underline':\r\n        case 'strikethrough':\r\n        case 'justifyLeft':\r\n        case 'justifyCenter':\r\n        case 'justifyRight':\r\n        case 'justifyFull':\r\n        case 'fontName':\r\n        case 'foreColor':\r\n          // These will be updated by the selection change listener\r\n          break;\r\n        case 'formatBlock':\r\n          setCurrentFormat(prev => ({ ...prev, headingLevel: value }));\r\n          break;\r\n        default:\r\n          // Commands like insertUnorderedList, createLink, etc. don't need state updates\r\n          break;\r\n      }\r\n    } catch (error) {\r\n      console.warn(`[useFormatting] Error executing command \"${command}\":`, error);\r\n    }\r\n  }, [handleFontSize, handleFontName, handleTextAlignment, handleInsertHTML, actions]);\r\n\r\n  /**\r\n   * Update current format state based on current selection\r\n   */\r\n  const updateCurrentFormatFromSelection = useCallback(() => {\r\n    try {\r\n      const selection = window.getSelection();\r\n      if (!selection || selection.rangeCount === 0) {\r\n        return;\r\n      }\r\n\r\n      // Get the current selection range\r\n      const range = selection.getRangeAt(0);\r\n      const selectedText = range.toString();\r\n\r\n      let fontSize = DEFAULT_FONT_SIZE;\r\n      let fontFamily = 'Arial';\r\n      let fontColor = '#000000'; // Default font color\r\n      let headingLevel = 'p';\r\n      let textAlign = 'left'; // Default alignment\r\n\r\n      if (selectedText) {\r\n        // Try to get font size from computed style of selected element\r\n        const startContainer = range.startContainer;\r\n        const element = startContainer.nodeType === Node.TEXT_NODE\r\n          ? startContainer.parentElement\r\n          : startContainer;\r\n\r\n        if (element) {\r\n          const computedStyle = window.getComputedStyle(element);\r\n          const computedFontSize = computedStyle.fontSize;\r\n          const computedFontFamily = computedStyle.fontFamily;\r\n\r\n          // Convert computed font size to our format (e.g., \"16px\" -> \"16px\")\r\n          if (computedFontSize && computedFontSize.endsWith('px')) {\r\n            fontSize = computedFontSize;\r\n          }\r\n\r\n          if (computedFontFamily && computedFontFamily !== 'serif') {\r\n            fontFamily = computedFontFamily.split(',')[0].replace(/['\"]/g, '').trim();\r\n          }\r\n\r\n          // Get font color from computed style\r\n          const computedFontColor = computedStyle.color;\r\n          if (computedFontColor && computedFontColor !== 'rgb(0, 0, 0)' && computedFontColor !== '#000000') {\r\n            // Convert rgb to hex if needed\r\n            if (computedFontColor.startsWith('rgb')) {\r\n              fontColor = rgbToHex(computedFontColor);\r\n            } else {\r\n              fontColor = computedFontColor;\r\n            }\r\n          }\r\n\r\n          // Find the nearest block-level element (heading or paragraph)\r\n          const blockElement = findNearestBlockElement(element);\r\n          if (blockElement) {\r\n            const tagName = blockElement.tagName?.toLowerCase();\r\n            if (['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p'].includes(tagName)) {\r\n              headingLevel = tagName;\r\n            }\r\n            \r\n            // Get text alignment from the block element's style\r\n            const blockComputedStyle = window.getComputedStyle(blockElement);\r\n            const computedTextAlign = blockComputedStyle.textAlign;\r\n            if (['left', 'center', 'right', 'justify'].includes(computedTextAlign)) {\r\n              textAlign = computedTextAlign;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Fallback to execCommand for other formatting (bold, italic, etc.)\r\n      const formatState = {\r\n        bold: document.queryCommandState('bold'),\r\n        italic: document.queryCommandState('italic'),\r\n        underline: document.queryCommandState('underline'),\r\n        strikethrough: document.queryCommandState('strikethrough'),\r\n        alignLeft: textAlign === 'left',\r\n        alignCenter: textAlign === 'center',\r\n        alignRight: textAlign === 'right',\r\n        alignJustify: textAlign === 'justify',\r\n        fontFamily: fontFamily,\r\n        fontSize: fontSize,\r\n        fontColor: fontColor,\r\n        headingLevel: headingLevel\r\n      };\r\n\r\n      setCurrentFormat(prev => ({\r\n        ...prev,\r\n        ...formatState\r\n      }));\r\n    } catch (error) {\r\n      console.warn('[useFormatting] Error updating format from selection:', error);\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Reset formatting to default\r\n   */\r\n  const resetFormat = useCallback(() => {\r\n    setCurrentFormat(DEFAULT_FORMAT);\r\n  }, []);\r\n\r\n  return {\r\n    currentFormat,\r\n    formatText,\r\n    resetFormat,\r\n    updateCurrentFormatFromSelection\r\n  };\r\n};\r\n\r\n/**\r\n * Helper function to convert RGB color to hex\r\n */\r\nfunction rgbToHex(rgb) {\r\n  const result = rgb.match(/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/);\r\n  if (!result) return '#000000';\r\n  \r\n  const r = parseInt(result[1], 10);\r\n  const g = parseInt(result[2], 10);\r\n  const b = parseInt(result[3], 10);\r\n  \r\n  return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;\r\n}\r\n\r\n/**\r\n * Helper function to find the nearest block-level element (heading or paragraph)\r\n * Walks up the DOM tree from the given element\r\n */\r\nfunction findNearestBlockElement(element) {\r\n  let current = element;\r\n  \r\n  // Walk up the DOM tree until we find a block element or reach the contenteditable root\r\n  while (current && current !== document.body) {\r\n    const tagName = current.tagName?.toLowerCase();\r\n    \r\n    // Check if this is a block-level element we're interested in\r\n    if (['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p'].includes(tagName)) {\r\n      return current;\r\n    }\r\n    \r\n    // Stop if we reach the contenteditable container\r\n    if (current.contentEditable === 'true' || current.contentEditable === '') {\r\n      break;\r\n    }\r\n    \r\n    current = current.parentElement;\r\n  }\r\n  \r\n  return null;\r\n}\r\n\r\n/**\r\n * Helper function to find all block elements within a range\r\n */\r\nfunction findBlockElementsInRange(range) {\r\n  const blockElements = [];\r\n  const startContainer = range.startContainer;\r\n  const endContainer = range.endContainer;\r\n  \r\n  // If range is within a single block element\r\n  const startBlock = findNearestBlockElement(\r\n    startContainer.nodeType === Node.TEXT_NODE ? startContainer.parentElement : startContainer\r\n  );\r\n  const endBlock = findNearestBlockElement(\r\n    endContainer.nodeType === Node.TEXT_NODE ? endContainer.parentElement : endContainer\r\n  );\r\n  \r\n  if (startBlock === endBlock && startBlock) {\r\n    return [startBlock];\r\n  }\r\n  \r\n  // Find all block elements in the range\r\n  const walker = document.createTreeWalker(\r\n    range.commonAncestorContainer,\r\n    NodeFilter.SHOW_ELEMENT,\r\n    {\r\n      acceptNode: (node) => {\r\n        const tagName = node.tagName?.toLowerCase();\r\n        return ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p'].includes(tagName) \r\n          ? NodeFilter.FILTER_ACCEPT \r\n          : NodeFilter.FILTER_SKIP;\r\n      }\r\n    }\r\n  );\r\n  \r\n  let current = walker.nextNode();\r\n  while (current) {\r\n    // Check if this block element intersects with the range\r\n    if (range.intersectsNode(current)) {\r\n      blockElements.push(current);\r\n    }\r\n    current = walker.nextNode();\r\n  }\r\n  \r\n  return blockElements;\r\n}\r\n\r\n/**\r\n * Helper function to create a paragraph element at cursor position\r\n */\r\nfunction createParagraphAtCursor() {\r\n  try {\r\n    const selection = window.getSelection();\r\n    if (!selection || selection.rangeCount === 0) {\r\n      return null;\r\n    }\r\n\r\n    const range = selection.getRangeAt(0);\r\n    const p = document.createElement('p');\r\n    p.innerHTML = '<br>';\r\n    \r\n    // Insert the paragraph\r\n    range.insertNode(p);\r\n    \r\n    // Move cursor into the paragraph\r\n    range.selectNodeContents(p);\r\n    range.collapse(true);\r\n    selection.removeAllRanges();\r\n    selection.addRange(range);\r\n    \r\n    return p;\r\n  } catch (error) {\r\n    console.warn('[useFormatting] Failed to create paragraph at cursor:', error);\r\n    return null;\r\n  }\r\n}\r\n","/**\r\n * Page boundary calculation utilities\r\n * Handles calculating page boundaries based on page breaks and content\r\n */\r\n\r\nimport { getPageDimensions } from './page-sizes.js';\r\nimport { getTotalVerticalMargins, DEFAULT_MARGIN_PRESET } from './margin-utils.js';\r\n\r\n// Content padding constants\r\nexport const CONTENT_PADDING = {\r\n  top: 40,\r\n  bottom: 40,\r\n  left: 40,\r\n  right: 40\r\n};\r\n\r\n// Page break selector\r\nexport const PAGE_BREAK_SELECTOR = 'page-break, [data-page-break=\"true\"]';\r\n\r\n/**\r\n * Calculate visual page boundaries based on <page-break> tags in content\r\n * Returns array of boundary objects with top positions\r\n * @param {HTMLElement} editor - The editor element\r\n * @param {Object} options - Options for boundary calculation\r\n * @param {string} options.pageSize - The page size to use\r\n * @returns {Array} Array of boundary objects\r\n */\r\nexport const calculatePageBoundaries = (editor, options = {}) => {\r\n  if (!editor || typeof document === 'undefined') {\r\n    return [];\r\n  }\r\n\r\n  const targetPageSize = options.pageSize || 'A4';\r\n  const dimensions = getPageDimensions(targetPageSize);\r\n  \r\n  // Find all <page-break> elements\r\n  const pageBreakElements = editor.querySelectorAll(PAGE_BREAK_SELECTOR);\r\n  \r\n  const boundaries = [];\r\n  \r\n  // Always have at least one page (page 1)\r\n  boundaries.push({\r\n    id: 'page-0',\r\n    pageNumber: 1,\r\n    top: 0,\r\n    height: dimensions.height\r\n  });\r\n\r\n  // Add boundaries for each page break\r\n  const editorRect = editor.getBoundingClientRect();\r\n  const editorScrollTop = editor.scrollTop;\r\n  \r\n  pageBreakElements.forEach((breakEl, index) => {\r\n    const rect = breakEl.getBoundingClientRect();\r\n    const relativeTop = rect.top - editorRect.top + editorScrollTop;\r\n    \r\n    boundaries.push({\r\n      id: `page-${index + 1}`,\r\n      pageNumber: index + 2,\r\n      top: relativeTop,\r\n      height: dimensions.height\r\n    });\r\n  });\r\n\r\n  return boundaries;\r\n};\r\n\r\n/**\r\n * Calculate maximum content height for a page accounting for zoom and margins\r\n * This is the height available for actual content INSIDE the contenteditable div\r\n * The contenteditable div itself has padding applied via getMarginPixels\r\n * So we need to subtract both the margins AND the padding from the page height\r\n * @param {string} pageSize - The page size\r\n * @param {number} zoomLevel - Current zoom level percentage\r\n * @param {string} pageMargins - The margin preset name\r\n * @returns {number} Maximum content height in pixels (actual content area inside padding)\r\n */\r\nexport const calculateMaxContentHeight = (pageSize, zoomLevel = 100, pageMargins = DEFAULT_MARGIN_PRESET) => {\r\n  const dimensions = getPageDimensions(pageSize);\r\n  const verticalMargins = getTotalVerticalMargins(pageMargins);\r\n  \r\n  // The page has total height = dimensions.height\r\n  // The contenteditable div has padding applied via getMarginPixels (which are the same as margins)\r\n  // So the actual content area height = page height - (top margin + bottom margin) = dimensions.height - verticalMargins\r\n  // This is already the max height for content inside the padding\r\n  const baseMaxHeight = dimensions.height - verticalMargins;\r\n  const zoomMultiplier = zoomLevel / 100;\r\n  return baseMaxHeight / zoomMultiplier;\r\n};\r\n\r\n/**\r\n * Get current page number based on viewport scroll position\r\n * @param {HTMLElement} container - The scroll container element\r\n * @param {HTMLElement} editor - The editor element\r\n * @returns {number} Current page index (0-based)\r\n */\r\nexport const getCurrentPage = (container, editor) => {\r\n  if (!container || !editor) {\r\n    return 0;\r\n  }\r\n\r\n  try {\r\n    // Get all page breaks\r\n    const pageBreaks = editor.querySelectorAll(PAGE_BREAK_SELECTOR);\r\n    \r\n    if (pageBreaks.length === 0) {\r\n      return 0; // Only one page\r\n    }\r\n    \r\n    // Get viewport center position\r\n    const containerRect = container.getBoundingClientRect();\r\n    const viewportCenter = containerRect.top + (containerRect.height / 2);\r\n    \r\n    // Check each page break to find which page we're on\r\n    // Start from the last break and work backwards\r\n    for (let i = pageBreaks.length - 1; i >= 0; i--) {\r\n      const breakElement = pageBreaks[i];\r\n      const breakRect = breakElement.getBoundingClientRect();\r\n      \r\n      // If the break is above the viewport center, we're on the page after it\r\n      if (breakRect.top < viewportCenter) {\r\n        return i + 1; // Page index (0-based)\r\n      }\r\n    }\r\n    \r\n    // If we're above all breaks, we're on page 0\r\n    return 0;\r\n  } catch (error) {\r\n    console.warn('[getCurrentPage] Failed to calculate page:', error);\r\n    return 0;\r\n  }\r\n};\r\n\r\n/**\r\n * Split content into pages based on existing page breaks\r\n * @param {HTMLElement} editor - The editor element\r\n * @returns {Array} Array of page element arrays\r\n */\r\nexport const splitContentIntoPages = (editor) => {\r\n  if (!editor) {\r\n    return [];\r\n  }\r\n\r\n  const allChildren = Array.from(editor.children);\r\n  \r\n  if (allChildren.length === 0) {\r\n    return [];\r\n  }\r\n  \r\n  // Split content into pages based on existing breaks\r\n  let pages = [];\r\n  let currentPage = [];\r\n  \r\n  for (const child of allChildren) {\r\n    if (child.tagName === 'PAGE-BREAK' || child.getAttribute('data-page-break') === 'true') {\r\n      if (currentPage.length > 0) {\r\n        pages.push(currentPage);\r\n        currentPage = [];\r\n      }\r\n    } else {\r\n      currentPage.push(child);\r\n    }\r\n  }\r\n  \r\n  // Add the last page\r\n  if (currentPage.length > 0) {\r\n    pages.push(currentPage);\r\n  }\r\n  \r\n  // If no pages, all elements are on one page\r\n  if (pages.length === 0 && allChildren.length > 0) {\r\n    pages.push(allChildren.filter(el => \r\n      !(el.tagName === 'PAGE-BREAK' || el.getAttribute('data-page-break') === 'true')\r\n    ));\r\n  }\r\n  \r\n  return pages;\r\n};","/**\r\n * Page break utilities\r\n * Handles creating, inserting, and managing page breaks\r\n */\r\n\r\nimport { PAGE_BREAK_SELECTOR, calculateMaxContentHeight } from './page-boundary-utils.js';\r\n\r\n/**\r\n * Get the total height of an element including its margins\r\n * Optimized to use known CSS margins instead of getComputedStyle\r\n * Based on MultiPageEditor.css: .continuous-content p { margin: 0 0 16px 0; }\r\n * Also handles images within center-aligned paragraphs\r\n * @param {HTMLElement} element - The element to measure\r\n * @returns {number} Total height including margins\r\n */\r\nconst getElementTotalHeight = (element) => {\r\n  if (!element || !element.getBoundingClientRect) {\r\n    return 0;\r\n  }\r\n  \r\n  const rect = element.getBoundingClientRect();\r\n  \r\n  // Check if element contains only an image (center-aligned images)\r\n  // These images may have float: none and their height needs special handling\r\n  if (element.tagName === 'P') {\r\n    const images = element.querySelectorAll('img');\r\n    const textContent = element.textContent.trim();\r\n    \r\n    // If paragraph contains only an image (no text content)\r\n    if (images.length === 1 && !textContent) {\r\n      const img = images[0];\r\n      const imgRect = img.getBoundingClientRect();\r\n      const computedStyle = window.getComputedStyle(element);\r\n      const textAlign = computedStyle.textAlign;\r\n      \r\n      // For center-aligned images, use actual image height plus paragraph margin\r\n      if (textAlign === 'center' || textAlign === '-webkit-center') {\r\n        return imgRect.height + 16; // Image height + paragraph bottom margin\r\n      }\r\n    }\r\n    \r\n    // Regular paragraph with 16px bottom margin\r\n    return rect.height + 16;  // Add known bottom margin\r\n  }\r\n  \r\n  // For other block elements (headings, lists), use a conservative estimate\r\n  if (element.tagName === 'H1' || element.tagName === 'H2' || element.tagName === 'H3' || \r\n      element.tagName === 'H4' || element.tagName === 'H5' || element.tagName === 'H6') {\r\n    return rect.height + 20;  // Headings typically have larger margins\r\n  }\r\n  \r\n  if (element.tagName === 'UL' || element.tagName === 'OL') {\r\n    return rect.height + 16;  // Lists have similar margins to paragraphs\r\n  }\r\n  \r\n  // For other elements, just return the rect height\r\n  return rect.height;\r\n};\r\n\r\n/**\r\n * Insert a page break element before the specified element\r\n * @param {HTMLElement} targetElement - The element to insert the page break before\r\n * @param {number} pageNumber - The page number for this break\r\n * @returns {boolean} Success status\r\n */\r\nexport const insertPageBreakBefore = (targetElement, pageNumber) => {\r\n  if (!targetElement) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const pageBreak = document.createElement('page-break');\r\n    pageBreak.setAttribute('data-page-break', 'true');\r\n    pageBreak.setAttribute('contenteditable', 'false');\r\n    pageBreak.setAttribute('data-page-number', pageNumber || '2');\r\n    \r\n    // Insert before the target element\r\n    targetElement.parentNode.insertBefore(pageBreak, targetElement);\r\n    \r\n    return true;\r\n  } catch (error) {\r\n    console.warn('[insertPageBreakBefore] Failed to insert page break:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Insert a page break at a specific page boundary based on content height\r\n * @param {HTMLElement} editor - The editor element\r\n * @param {number} pageNumber - The page number where the break should be inserted (1-based)\r\n * @param {string} pageSize - The page size\r\n * @param {number} zoomLevel - Current zoom level percentage\r\n * @param {string} pageMargins - The margin preset name\r\n * @param {Function} updateContentCallback - Callback to update content in context\r\n * @param {Function} updateBoundariesCallback - Callback to update boundaries\r\n * @returns {boolean} Success status\r\n */\r\nexport const insertPageBreakAtBoundary = (\r\n  editor,\r\n  pageNumber,\r\n  pageSize,\r\n  zoomLevel,\r\n  pageMargins,\r\n  updateContentCallback,\r\n  updateBoundariesCallback\r\n) => {\r\n  if (!editor) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    // Calculate max content height accounting for zoom, padding, and margins\r\n    const maxHeight = calculateMaxContentHeight(pageSize, zoomLevel, pageMargins);\r\n    \r\n    // Target height for the page break insertion\r\n    const targetHeight = maxHeight * (pageNumber - 1);\r\n    \r\n    // Get all children and find where to insert the break\r\n    const allChildren = Array.from(editor.children);\r\n    let accumulatedHeight = 0;\r\n    let insertBeforeElement = null;\r\n    \r\n    for (let i = 0; i < allChildren.length; i++) {\r\n      const child = allChildren[i];\r\n      \r\n      // Skip existing page breaks\r\n      if (child.tagName === 'PAGE-BREAK' || child.getAttribute('data-page-break') === 'true') {\r\n        continue;\r\n      }\r\n      \r\n      const childHeight = getElementTotalHeight(child);\r\n      \r\n      // Check if adding this element would exceed the target height\r\n      if (accumulatedHeight + childHeight > targetHeight) {\r\n        insertBeforeElement = child;\r\n        break;\r\n      }\r\n      \r\n      accumulatedHeight += childHeight;\r\n    }\r\n    \r\n    // If we found an insertion point, insert the page break\r\n    if (insertBeforeElement) {\r\n      const pageBreak = document.createElement('page-break');\r\n      pageBreak.setAttribute('data-page-break', 'true');\r\n      pageBreak.setAttribute('contenteditable', 'false');\r\n      pageBreak.setAttribute('data-page-number', String(pageNumber));\r\n      \r\n      insertBeforeElement.parentNode.insertBefore(pageBreak, insertBeforeElement);\r\n      \r\n      // Update content in Context\r\n      if (updateContentCallback) {\r\n        const updatedHTML = editor.innerHTML;\r\n        updateContentCallback(updatedHTML);\r\n      }\r\n      \r\n      // Update boundaries\r\n      if (updateBoundariesCallback) {\r\n        setTimeout(() => {\r\n          updateBoundariesCallback();\r\n        }, 50);\r\n      }\r\n      \r\n      return true;\r\n    } else {\r\n      // If no insertion point found, insert at the end\r\n      const pageBreak = document.createElement('page-break');\r\n      pageBreak.setAttribute('data-page-break', 'true');\r\n      pageBreak.setAttribute('contenteditable', 'false');\r\n      pageBreak.setAttribute('data-page-number', String(pageNumber));\r\n      \r\n      editor.appendChild(pageBreak);\r\n      \r\n      // Add an empty paragraph after the break\r\n      const emptyParagraph = document.createElement('p');\r\n      emptyParagraph.innerHTML = '<br>';\r\n      editor.appendChild(emptyParagraph);\r\n      \r\n      // Update content in Context\r\n      if (updateContentCallback) {\r\n        const updatedHTML = editor.innerHTML;\r\n        updateContentCallback(updatedHTML);\r\n      }\r\n      \r\n      // Update boundaries\r\n      if (updateBoundariesCallback) {\r\n        setTimeout(() => {\r\n          updateBoundariesCallback();\r\n        }, 50);\r\n      }\r\n      \r\n      return true;\r\n    }\r\n  } catch (error) {\r\n    console.error('[insertPageBreakAtBoundary] Failed to insert page break:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Remove a page and its content from the continuous editor\r\n * Removes the page break and all content between the page boundaries\r\n * @param {HTMLElement} editor - The editor element\r\n * @param {number} pageIndex - The index of the page to remove (0-based)\r\n * @param {Function} calculateBoundariesCallback - Callback to calculate boundaries\r\n * @param {Function} updateContentCallback - Callback to update content in context\r\n * @param {Function} updateBoundariesCallback - Callback to update boundaries\r\n * @param {Function} positionCursorCallback - Callback to position cursor\r\n * @param {Function} checkReflowCallback - Callback to trigger reflow\r\n * @returns {boolean} Success status\r\n */\r\nexport const removePageAndContent = (\r\n  editor, \r\n  pageIndex, \r\n  calculateBoundariesCallback, \r\n  updateContentCallback, \r\n  updateBoundariesCallback, \r\n  positionCursorCallback, \r\n  checkReflowCallback\r\n) => {\r\n  if (!editor) {\r\n    return false;\r\n  }\r\n\r\n  const boundaries = calculateBoundariesCallback();\r\n\r\n  // Cannot delete if only one page\r\n  if (boundaries.length <= 1) {\r\n    console.warn('[removePageAndContent] Cannot delete the only page');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    // Find all page breaks in the editor\r\n    const pageBreaks = Array.from(editor.querySelectorAll(PAGE_BREAK_SELECTOR));\r\n    \r\n    if (pageIndex > pageBreaks.length) {\r\n      console.warn('[removePageAndContent] Invalid page index');\r\n      return false;\r\n    }\r\n\r\n    // Save cursor position before deletion\r\n    const selection = window.getSelection();\r\n    let cursorWasInDeletedContent = false;\r\n    \r\n    let nodesToRemove = [];\r\n    let pageBreakToRemove = null;\r\n\r\n    // Special handling for first page (pageIndex === 0)\r\n    if (pageIndex === 0) {\r\n      // For the first page, remove all content before the first page break\r\n      const firstPageBreak = pageBreaks[0];\r\n      \r\n      if (!firstPageBreak) {\r\n        console.warn('[removePageAndContent] No page break found for first page');\r\n        return false;\r\n      }\r\n\r\n      // Collect all nodes before the first page break\r\n      let currentNode = editor.firstChild;\r\n      while (currentNode && currentNode !== firstPageBreak) {\r\n        nodesToRemove.push(currentNode);\r\n        currentNode = currentNode.nextSibling;\r\n      }\r\n\r\n      // The first page break itself should also be removed\r\n      pageBreakToRemove = firstPageBreak;\r\n\r\n    } else {\r\n      // For pages 1 and onwards, remove content between page breaks\r\n      // The page break that starts this page is at index (pageIndex - 1)\r\n      // because page 0 has no break, page 1 has break[0], page 2 has break[1], etc.\r\n      const pageBreakElement = pageBreaks[pageIndex - 1];\r\n      \r\n      if (!pageBreakElement) {\r\n        console.warn('[removePageAndContent] Page break not found');\r\n        return false;\r\n      }\r\n\r\n      // Find the next page break (if any) to determine the end of this page\r\n      const nextPageBreakElement = pageBreaks[pageIndex];\r\n\r\n      // Collect all nodes between the current page break and the next one (or end)\r\n      let currentNode = pageBreakElement.nextSibling;\r\n\r\n      while (currentNode) {\r\n        // Stop if we reach the next page break\r\n        if (currentNode === nextPageBreakElement) {\r\n          break;\r\n        }\r\n        \r\n        nodesToRemove.push(currentNode);\r\n        currentNode = currentNode.nextSibling;\r\n      }\r\n\r\n      pageBreakToRemove = pageBreakElement;\r\n    }\r\n\r\n    // Check if cursor is in the content being deleted\r\n    if (selection && selection.rangeCount > 0) {\r\n      const range = selection.getRangeAt(0);\r\n      const cursorNode = range.startContainer;\r\n      \r\n      for (const node of nodesToRemove) {\r\n        if (node.contains(cursorNode) || node === cursorNode) {\r\n          cursorWasInDeletedContent = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Remove the page break element\r\n    if (pageBreakToRemove && pageBreakToRemove.parentNode) {\r\n      pageBreakToRemove.remove();\r\n    }\r\n\r\n    // Remove all content nodes\r\n    nodesToRemove.forEach(node => {\r\n      if (node.parentNode) {\r\n        node.remove();\r\n      }\r\n    });\r\n\r\n    // Renumber remaining page breaks\r\n    const remainingBreaks = editor.querySelectorAll(PAGE_BREAK_SELECTOR);\r\n    remainingBreaks.forEach((breakEl, index) => {\r\n      breakEl.setAttribute('data-page-number', String(index + 2));\r\n    });\r\n\r\n    // Position cursor appropriately after deletion\r\n    if (cursorWasInDeletedContent && positionCursorCallback) {\r\n      // Position cursor at the start of the first remaining page (page 0)\r\n      setTimeout(() => {\r\n        positionCursorCallback(0);\r\n      }, 50);\r\n    }\r\n\r\n    // Update content in Context\r\n    if (updateContentCallback) {\r\n      const updatedHTML = editor.innerHTML;\r\n      updateContentCallback(updatedHTML);\r\n    }\r\n\r\n    // Update boundaries after deletion\r\n    if (updateBoundariesCallback) {\r\n      setTimeout(() => {\r\n        updateBoundariesCallback();\r\n        \r\n        // Trigger auto reflow to handle any overflow from content redistribution\r\n        if (checkReflowCallback) {\r\n          setTimeout(() => {\r\n            checkReflowCallback();\r\n          }, 150);\r\n        }\r\n      }, 100);\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    console.error('[removePageAndContent] Failed to remove page:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Renumber all page breaks in the editor\r\n * @param {HTMLElement} editor - The editor element\r\n */\r\nexport const renumberPageBreaks = (editor) => {\r\n  if (!editor) {\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const pageBreaks = editor.querySelectorAll(PAGE_BREAK_SELECTOR);\r\n    pageBreaks.forEach((breakEl, index) => {\r\n      breakEl.setAttribute('data-page-number', String(index + 2));\r\n    });\r\n  } catch (error) {\r\n    console.error('[renumberPageBreaks] Failed to renumber page breaks:', error);\r\n  }\r\n};\r\n\r\n/**\r\n * Remove a single page break element\r\n * This removes just the page break, allowing content to reflow naturally\r\n * @param {HTMLElement} pageBreakElement - The page break element to remove\r\n * @param {HTMLElement} editor - The editor element\r\n * @param {Function} updateContentCallback - Callback to update content in context\r\n * @param {Function} updateBoundariesCallback - Callback to update boundaries\r\n * @param {Function} checkReflowCallback - Callback to trigger reflow\r\n * @returns {boolean} Success status\r\n */\r\nexport const removePageBreak = (\r\n  pageBreakElement,\r\n  editor,\r\n  updateContentCallback,\r\n  updateBoundariesCallback,\r\n  checkReflowCallback\r\n) => {\r\n  if (!pageBreakElement || !editor) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    // Remove the page break element\r\n    pageBreakElement.remove();\r\n\r\n    // Renumber remaining page breaks\r\n    renumberPageBreaks(editor);\r\n\r\n    // Update content in Context\r\n    if (updateContentCallback) {\r\n      const updatedHTML = editor.innerHTML;\r\n      updateContentCallback(updatedHTML);\r\n    }\r\n\r\n    // Update boundaries after deletion\r\n    if (updateBoundariesCallback) {\r\n      setTimeout(() => {\r\n        updateBoundariesCallback();\r\n        \r\n        // Trigger auto reflow to re-add page breaks in correct positions\r\n        if (checkReflowCallback) {\r\n          setTimeout(() => {\r\n            checkReflowCallback();\r\n          }, 100);\r\n        }\r\n      }, 50);\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    console.error('[removePageBreak] Failed to remove page break:', error);\r\n    return false;\r\n  }\r\n};\r\n","/**\r\n * Content reflow utilities\r\n * Handles detecting content overflow and managing reflow operations\r\n */\r\n\r\nimport { calculateMaxContentHeight, splitContentIntoPages } from './page-boundary-utils.js';\r\nimport { insertPageBreakBefore } from './page-break-utils.js';\r\n\r\n// Performance constants\r\nexport const DEFAULT_REFLOW_DELAY = 200; // Reduced from 500ms for better typing responsiveness\r\nexport const BOUNDARY_UPDATE_DELAY = 50;\r\nexport const MAX_PAGES_PER_REFLOW = 3; // Process up to 3 pages per reflow cycle\r\nexport const MIN_OVERFLOW_THRESHOLD = 20; // Minimum pixels of overflow before breaking\r\n\r\n/**\r\n * Get the total height of an element including its margins\r\n * Optimized to use known CSS margins instead of getComputedStyle\r\n * Based on MultiPageEditor.css: .continuous-content p { margin: 0 0 16px 0; }\r\n * Also handles images within center-aligned paragraphs\r\n * @param {HTMLElement} element - The element to measure\r\n * @returns {number} Total height including margins\r\n */\r\nconst getElementTotalHeight = (element) => {\r\n  if (!element || !element.getBoundingClientRect) {\r\n    return 0;\r\n  }\r\n  \r\n  const rect = element.getBoundingClientRect();\r\n  \r\n  // Check if element contains only an image (center-aligned images)\r\n  // These images may have float: none and their height needs special handling\r\n  if (element.tagName === 'P') {\r\n    const images = element.querySelectorAll('img');\r\n    const textContent = element.textContent.trim();\r\n    \r\n    // If paragraph contains only an image (no text content)\r\n    if (images.length === 1 && !textContent) {\r\n      const img = images[0];\r\n      const imgRect = img.getBoundingClientRect();\r\n      const computedStyle = window.getComputedStyle(element);\r\n      const textAlign = computedStyle.textAlign;\r\n      \r\n      // For center-aligned images, use actual image height plus paragraph margin\r\n      if (textAlign === 'center' || textAlign === '-webkit-center') {\r\n        return imgRect.height + 16; // Image height + paragraph bottom margin\r\n      }\r\n    }\r\n    \r\n    // Regular paragraph with 16px bottom margin\r\n    return rect.height + 16;  // Add known bottom margin\r\n  }\r\n  \r\n  // For other block elements (headings, lists), use a conservative estimate\r\n  if (element.tagName === 'H1' || element.tagName === 'H2' || element.tagName === 'H3' || \r\n      element.tagName === 'H4' || element.tagName === 'H5' || element.tagName === 'H6') {\r\n    return rect.height + 20;  // Headings typically have larger margins\r\n  }\r\n  \r\n  if (element.tagName === 'UL' || element.tagName === 'OL') {\r\n    return rect.height + 16;  // Lists have similar margins to paragraphs\r\n  }\r\n  \r\n  // For other elements, just return the rect height\r\n  return rect.height;\r\n};\r\n\r\n/**\r\n * Check if content in a page section exceeds the maximum height\r\n * Returns the element where overflow occurs\r\n * Optimized for performance with early exit\r\n * @param {Array} pageElements - Array of elements in the page\r\n * @param {number} maxHeight - Maximum height for the page\r\n * @returns {Object|null} Overflow information or null if no overflow\r\n */\r\nexport const findOverflowPoint = (pageElements, maxHeight) => {\r\n  if (!pageElements || pageElements.length === 0) {\r\n    return null;\r\n  }\r\n  \r\n  let currentHeight = 0;\r\n  let lastValidElement = null;\r\n  \r\n  for (let i = 0; i < pageElements.length; i++) {\r\n    const element = pageElements[i];\r\n    if (!element || !element.getBoundingClientRect) {\r\n      continue;\r\n    }\r\n    \r\n    const elementHeight = getElementTotalHeight(element);\r\n    \r\n    // Skip empty elements (like empty <p> tags from Enter key)\r\n    if (elementHeight < 1) {\r\n      continue;\r\n    }\r\n    \r\n    const potentialHeight = currentHeight + elementHeight;\r\n    \r\n    // Check if adding this element would exceed the page height\r\n    if (potentialHeight > maxHeight) {\r\n      // If we haven't added any elements yet (first element is too large)\r\n      if (lastValidElement === null) {\r\n        // Element is larger than page - must break anyway\r\n        // But only if it's not the very first element on the page\r\n        if (i > 0) {\r\n          return { \r\n            overflowIndex: i, \r\n            overflowElement: element, \r\n            accumulatedHeight: currentHeight \r\n          };\r\n        }\r\n        // If it's the first element and it's too large, let it overflow (unbreakable content)\r\n        return null;\r\n      }\r\n      \r\n      // We have overflow - return the current element as the break point\r\n      return { \r\n        overflowIndex: i, \r\n        overflowElement: element, \r\n        accumulatedHeight: currentHeight \r\n      };\r\n    }\r\n    \r\n    // Element fits, add it to current height\r\n    currentHeight += elementHeight;\r\n    lastValidElement = element;\r\n  }\r\n  \r\n  return null; // No overflow\r\n};\r\n\r\n/**\r\n * Automatic reflow: Insert page breaks when content exceeds page height\r\n * Optimized with performance guards and single-page-at-a-time processing\r\n * Accounts for current zoom level and margins when calculating max height\r\n * @param {HTMLElement} editor - The editor element\r\n * @param {string} pageSize - The page size\r\n * @param {number} zoomLevel - Current zoom level percentage\r\n * @param {string} pageMargins - The margin preset name\r\n * @param {Function} updateContentCallback - Callback to update content in context\r\n * @param {Function} updateBoundariesCallback - Callback to update boundaries\r\n * @param {boolean} isReflowingRef - Reference to track if reflow is in progress\r\n * @param {Function} checkAndReflowCallback - Callback to trigger additional reflow if needed\r\n * @returns {boolean} True if reflow was performed, false otherwise\r\n */\r\nexport const checkAndReflow = (\r\n  editor, \r\n  pageSize, \r\n  zoomLevel, \r\n  pageMargins,\r\n  updateContentCallback, \r\n  updateBoundariesCallback, \r\n  isReflowingRef, \r\n  checkAndReflowCallback\r\n) => {\r\n  // Performance guard: prevent concurrent reflows\r\n  if (!editor || isReflowingRef.current) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    isReflowingRef.current = true;\r\n    \r\n    const maxHeight = calculateMaxContentHeight(pageSize, zoomLevel, pageMargins);\r\n    \r\n    // Split content into pages based on existing breaks\r\n    let pages = splitContentIntoPages(editor);\r\n    \r\n    // Check each page for overflow (process ALL pages for better typing support)\r\n    let insertedBreaks = false;\r\n    let pagesProcessed = 0;\r\n    \r\n    for (let pageIndex = 0; pageIndex < pages.length && pagesProcessed < MAX_PAGES_PER_REFLOW; pageIndex++) {\r\n      const pageElements = pages[pageIndex];\r\n      const overflow = findOverflowPoint(pageElements, maxHeight);\r\n      \r\n      // Only insert break if we have actual overflow and not on first element\r\n      // Also check that the overflow is significant (not just a pixel or two)\r\n      if (overflow && overflow.overflowIndex > 0) {\r\n        // Calculate actual overflow amount\r\n        let totalPageHeight = 0;\r\n        for (let i = 0; i < pageElements.length; i++) {\r\n          const el = pageElements[i];\r\n          if (el && el.getBoundingClientRect) {\r\n            totalPageHeight += getElementTotalHeight(el);\r\n          }\r\n        }\r\n        \r\n        // Only break if overflow is significant\r\n        const overflowAmount = totalPageHeight - maxHeight;\r\n        if (overflowAmount < MIN_OVERFLOW_THRESHOLD) {\r\n          continue; // Skip this page, overflow is too small\r\n        }\r\n        \r\n        const pageNumber = pageIndex + 2;\r\n        const inserted = insertPageBreakBefore(overflow.overflowElement, pageNumber);\r\n        \r\n        if (inserted) {\r\n          insertedBreaks = true;\r\n          pagesProcessed++;\r\n          \r\n          // Re-query pages after insertion to continue checking\r\n          const updatedPages = splitContentIntoPages(editor);\r\n          pages = updatedPages;\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Update boundaries if we inserted breaks\r\n    if (insertedBreaks) {\r\n      // Trigger content update to Context\r\n      if (updateContentCallback) {\r\n        const html = editor.innerHTML;\r\n        updateContentCallback(html);\r\n      }\r\n      \r\n      // Recalculate boundaries with slight delay for DOM update\r\n      setTimeout(() => {\r\n        if (updateBoundariesCallback) {\r\n          updateBoundariesCallback();\r\n        }\r\n        \r\n        // If we processed the max number of pages, schedule another reflow check\r\n        // to handle any remaining overflows from typing\r\n        if (pagesProcessed >= MAX_PAGES_PER_REFLOW && checkAndReflowCallback) {\r\n          setTimeout(() => {\r\n            if (!isReflowingRef.current) {\r\n              checkAndReflowCallback();\r\n            }\r\n          }, 100);\r\n        }\r\n      }, BOUNDARY_UPDATE_DELAY);\r\n    }\r\n    \r\n    return insertedBreaks;\r\n  } catch (error) {\r\n    console.warn('[checkAndReflow] Reflow failed:', error);\r\n    return false;\r\n  } finally {\r\n    isReflowingRef.current = false;\r\n  }\r\n};\r\n\r\n/**\r\n * Debounced automatic reflow check\r\n * Optimized to prevent excessive reflow operations\r\n * @param {Function} checkAndReflowCallback - The reflow function to call\r\n * @param {Object} timeoutRef - Reference to store the timeout\r\n * @param {number} delay - Delay in milliseconds\r\n */\r\nexport const triggerAutoReflow = (checkAndReflowCallback, timeoutRef, delay = DEFAULT_REFLOW_DELAY) => {\r\n  if (timeoutRef.current) {\r\n    clearTimeout(timeoutRef.current);\r\n  }\r\n\r\n  timeoutRef.current = setTimeout(() => {\r\n    timeoutRef.current = null;\r\n    checkAndReflowCallback();\r\n  }, delay);\r\n};","/**\r\n * Cursor and scroll utilities\r\n * Handles cursor positioning and scroll operations for page navigation\r\n */\r\n\r\nimport { PAGE_BREAK_SELECTOR } from './page-boundary-utils.js';\r\n\r\n// Performance constants\r\nexport const CURSOR_POSITION_DELAY = 400;\r\nexport const SCROLL_POSITION_DELAY = 50;\r\n\r\n/**\r\n * Position cursor at the start of a specific page\r\n * @param {HTMLElement} editor - The editor element\r\n * @param {number} pageNumber - The page number (0-based)\r\n */\r\nexport const positionCursorAtPage = (editor, pageNumber) => {\r\n  if (!editor) {\r\n    return;\r\n  }\r\n\r\n  editor.focus();\r\n\r\n  try {\r\n    let targetNode = null;\r\n    let targetOffset = 0;\r\n\r\n    if (pageNumber === 0) {\r\n      // First page - position at start\r\n      targetNode = editor.firstChild;\r\n      targetOffset = 0;\r\n    } else {\r\n      // Find the page break element for this page\r\n      const pageBreaks = editor.querySelectorAll(PAGE_BREAK_SELECTOR);\r\n      const breakElement = pageBreaks[pageNumber - 1];\r\n      \r\n      if (breakElement && breakElement.nextSibling) {\r\n        targetNode = breakElement.nextSibling;\r\n        targetOffset = 0;\r\n      }\r\n    }\r\n\r\n    if (targetNode) {\r\n      const range = document.createRange();\r\n      const selection = window.getSelection();\r\n      \r\n      // If target is a text node, use it directly\r\n      if (targetNode.nodeType === Node.TEXT_NODE) {\r\n        range.setStart(targetNode, targetOffset);\r\n      } else {\r\n        // If it's an element, position at its start\r\n        range.setStart(targetNode, 0);\r\n      }\r\n      \r\n      range.collapse(true);\r\n      selection.removeAllRanges();\r\n      selection.addRange(range);\r\n    }\r\n  } catch (error) {\r\n    console.warn('[positionCursorAtPage] Failed to position cursor:', error);\r\n  }\r\n};\r\n\r\n/**\r\n * Scroll to a specific page and position cursor at the start of that page\r\n * @param {HTMLElement} container - The scroll container element\r\n * @param {HTMLElement} editor - The editor element\r\n * @param {number} pageNumber - The page number (0-based)\r\n * @param {Function} positionCursorCallback - Callback to position cursor\r\n */\r\nexport const scrollToPage = (container, editor, pageNumber, positionCursorCallback) => {\r\n  if (!container || !editor) {\r\n    console.warn('[scrollToPage] Missing refs');\r\n    return;\r\n  }\r\n  \r\n  try {\r\n    let targetElement = null;\r\n    \r\n    if (pageNumber === 0) {\r\n      // First page - scroll to top of editor\r\n      targetElement = editor;\r\n    } else {\r\n      // Find the page break for this page\r\n      const pageBreaks = editor.querySelectorAll(PAGE_BREAK_SELECTOR);\r\n      const targetBreak = pageBreaks[pageNumber - 1];\r\n      \r\n      if (targetBreak) {\r\n        targetElement = targetBreak;\r\n      } else {\r\n        console.warn('[scrollToPage] Page break not found for page', pageNumber);\r\n        return;\r\n      }\r\n    }\r\n    \r\n    if (targetElement) {\r\n      // Get the element's position relative to the container\r\n      const elementRect = targetElement.getBoundingClientRect();\r\n      const containerRect = container.getBoundingClientRect();\r\n      \r\n      // Calculate scroll position: current scroll + element position relative to container\r\n      const scrollTop = container.scrollTop + (elementRect.top - containerRect.top);\r\n      \r\n      // Scroll to the page\r\n      container.scrollTo({\r\n        top: scrollTop,\r\n        behavior: 'smooth'\r\n      });\r\n      \r\n      // Position cursor after scroll completes\r\n      setTimeout(() => {\r\n        if (positionCursorCallback) {\r\n          positionCursorCallback(pageNumber);\r\n        } else {\r\n          positionCursorAtPage(editor, pageNumber);\r\n        }\r\n      }, CURSOR_POSITION_DELAY);\r\n    }\r\n  } catch (error) {\r\n    console.error('[scrollToPage] Error:', error);\r\n  }\r\n};\r\n\r\n/**\r\n * Debounced boundary calculation\r\n * Triggers after content changes to recalculate page boundaries\r\n * Optimized with configurable delay\r\n * @param {Function} updateBoundariesCallback - Callback to update boundaries\r\n * @param {Object} timeoutRef - Reference to store the timeout\r\n * @param {Object} options - Options for boundary calculation\r\n * @param {number} delay - Delay in milliseconds\r\n */\r\nexport const checkAndUpdateBoundaries = (\r\n  updateBoundariesCallback, \r\n  timeoutRef, \r\n  options = {}, \r\n  delay = 300\r\n) => {\r\n  if (timeoutRef.current) {\r\n    clearTimeout(timeoutRef.current);\r\n  }\r\n\r\n  timeoutRef.current = setTimeout(() => {\r\n    timeoutRef.current = null;\r\n    updateBoundariesCallback(options);\r\n  }, Math.max(0, delay));\r\n};\r\n\r\n/**\r\n * Get the current cursor position in the editor\r\n * @param {HTMLElement} editor - The editor element\r\n * @returns {Object|null} An object with page number, line number, and character offset, or null if no selection\r\n */\r\nexport const getCursorPosition = (editor) => {\r\n  if (!editor) return null;\r\n  \r\n  const selection = window.getSelection();\r\n  if (selection.rangeCount === 0) return null;\r\n  \r\n  const range = selection.getRangeAt(0);\r\n  if (!editor.contains(range.commonAncestorContainer)) return null; // Ensure range is inside editor\r\n  \r\n  // Calculate page number: Count <page-break> elements before the caret\r\n  let pageNumber = 1; // Default to page 1\r\n  const pageBreaks = editor.querySelectorAll(PAGE_BREAK_SELECTOR);\r\n  for (const breakEl of pageBreaks) {\r\n    if (range.comparePoint(breakEl, 0) > 0) { // Caret is after this break\r\n      pageNumber++;\r\n    } else {\r\n      break; // No need to check further\r\n    }\r\n  }\r\n  \r\n  // Calculate character offset and line number: Get text length and newline count from start of editor to caret\r\n  const tempRange = document.createRange();\r\n  tempRange.setStart(editor, 0);\r\n  tempRange.setEnd(range.startContainer, range.startOffset);\r\n  const htmlBeforeCaret = tempRange.toString(); // HTML fragment as text\r\n  const plainTextBeforeCaret = htmlBeforeCaret\r\n    .replace(/<[^>]*>/g, ' ') // Strip tags\r\n    .replace(/&nbsp;/g, ' ')\r\n    .replace(/&amp;/g, '&')\r\n    .replace(/&lt;/g, '<')\r\n    .replace(/&gt;/g, '>')\r\n    .replace(/&quot;/g, '\"')\r\n    .replace(/&#39;/g, \"'\")\r\n    .replace(/\\s+/g, ' ') // Normalize whitespace\r\n    .trim();\r\n  const charOffset = plainTextBeforeCaret.length;\r\n  const lineNumber = (plainTextBeforeCaret.match(/\\n/g) || []).length + 1; // Count \\n and add 1 for 1-based indexing\r\n  \r\n  return {\r\n    page: pageNumber,\r\n    line: lineNumber,\r\n    charOffset\r\n  };\r\n};","import { useCallback, useRef, useEffect, useMemo } from 'react';\r\nimport { useDocumentActions } from '../context/DocumentContext';\r\nimport { \r\n  calculatePageBoundaries, \r\n  getCurrentPage,\r\n  calculateMaxContentHeight\r\n} from '../lib/editor/page-boundary-utils.js';\r\nimport { \r\n  insertPageBreakAtBoundary, \r\n  removePageAndContent,\r\n  removePageBreak\r\n} from '../lib/editor/page-break-utils.js';\r\nimport { \r\n  checkAndReflow, \r\n  triggerAutoReflow \r\n} from '../lib/editor/content-reflow-utils.js';\r\nimport { \r\n  positionCursorAtPage, \r\n  scrollToPage, \r\n  checkAndUpdateBoundaries \r\n} from '../lib/editor/cursor-scroll-utils.js';\r\n\r\n// Performance constants\r\nconst DEFAULT_BOUNDARY_DELAY = 300;\r\n\r\n/**\r\n * useContinuousReflow - Automatically insert page breaks based on content height\r\n * Monitors content height and inserts <page-break> tags when content exceeds page dimensions\r\n * Content remains in a single continuous contenteditable surface\r\n * @param {string} pageSize - The page size (A4, Letter, Legal)\r\n * @param {React.RefObject} editorRef - Reference to the editor element\r\n * @param {number} zoomLevel - Current zoom level percentage (50-200)\r\n * @param {string} pageMargins - The margin preset name\r\n */\r\nexport const useContinuousReflow = (pageSize, editorRef, zoomLevel = 100, pageMargins = 'NARROW') => {\r\n  const actions = useDocumentActions();\r\n  const boundaryTimeoutRef = useRef(null);\r\n  const reflowTimeoutRef = useRef(null);\r\n  const latestPageSizeRef = useRef(pageSize);\r\n  const latestZoomLevelRef = useRef(zoomLevel);\r\n  const latestPageMarginsRef = useRef(pageMargins);\r\n  const isReflowingRef = useRef(false);\r\n\r\n  useEffect(() => {\r\n    latestPageSizeRef.current = pageSize;\r\n  }, [pageSize]);\r\n\r\n  useEffect(() => {\r\n    latestZoomLevelRef.current = zoomLevel;\r\n  }, [zoomLevel]);\r\n\r\n  useEffect(() => {\r\n    latestPageMarginsRef.current = pageMargins;\r\n  }, [pageMargins]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (boundaryTimeoutRef.current) {\r\n        clearTimeout(boundaryTimeoutRef.current);\r\n      }\r\n      if (reflowTimeoutRef.current) {\r\n        clearTimeout(reflowTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // ============================================================================\r\n  // BOUNDARY MANAGEMENT\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Calculate visual page boundaries based on <page-break> tags in content\r\n   * Returns array of boundary objects with top positions\r\n   * Optimized with cached selectors and better null checks\r\n   */\r\n  const calculatePageBoundariesCallback = useCallback((options = {}) => {\r\n    if (!editorRef?.current) {\r\n      return [];\r\n    }\r\n    return calculatePageBoundaries(editorRef.current, options);\r\n  }, [editorRef]);\r\n\r\n  /**\r\n   * Update page boundaries in Context state\r\n   */\r\n  const updateBoundaries = useCallback((options = {}) => {\r\n    const boundaries = calculatePageBoundariesCallback(options);\r\n    actions.updatePageBoundaries(boundaries);\r\n    return boundaries;\r\n  }, [calculatePageBoundariesCallback, actions]);\r\n\r\n  /**\r\n   * Debounced boundary calculation\r\n   * Triggers after content changes to recalculate page boundaries\r\n   * Optimized with configurable delay\r\n   */\r\n  const checkAndUpdateBoundariesCallback = useCallback((options = {}) => {\r\n    const delay = typeof options.delay === 'number' ? options.delay : DEFAULT_BOUNDARY_DELAY;\r\n    checkAndUpdateBoundaries(updateBoundaries, boundaryTimeoutRef, options, delay);\r\n  }, [updateBoundaries]);\r\n\r\n  // ============================================================================\r\n  // REFLOW MANAGEMENT\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Automatic reflow: Insert page breaks when content exceeds page height\r\n   * Optimized with performance guards and single-page-at-a-time processing\r\n   * Accounts for current zoom level and margins when calculating max height\r\n   */\r\n  const checkAndReflowCallback = useCallback(() => {\r\n    if (!editorRef?.current) {\r\n      return;\r\n    }\r\n\r\n    checkAndReflow(\r\n      editorRef.current,\r\n      latestPageSizeRef.current,\r\n      latestZoomLevelRef.current,\r\n      latestPageMarginsRef.current,\r\n      actions.updateContinuousContent,\r\n      updateBoundaries,\r\n      isReflowingRef,\r\n      checkAndReflowCallback\r\n    );\r\n  }, [editorRef, actions, updateBoundaries]);\r\n\r\n  /**\r\n   * Debounced automatic reflow check\r\n   * Optimized to prevent excessive reflow operations\r\n   */\r\n  const triggerAutoReflowCallback = useCallback((delay) => {\r\n    triggerAutoReflow(checkAndReflowCallback, reflowTimeoutRef, delay);\r\n  }, [checkAndReflowCallback]);\r\n\r\n  // ============================================================================\r\n  // NAVIGATION\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Get current page number based on viewport scroll position\r\n   * @param {React.RefObject} containerRef - The scroll container element\r\n   */\r\n  const getCurrentPageCallback = useCallback((containerRef) => {\r\n    if (!containerRef?.current || !editorRef?.current) {\r\n      return 0;\r\n    }\r\n    return getCurrentPage(containerRef.current, editorRef.current);\r\n  }, [editorRef]);\r\n\r\n  /**\r\n   * Position cursor at the start of a specific page\r\n   */\r\n  const positionCursorAtPageCallback = useCallback((pageNumber) => {\r\n    if (!editorRef?.current) {\r\n      return;\r\n    }\r\n    positionCursorAtPage(editorRef.current, pageNumber);\r\n  }, [editorRef]);\r\n\r\n  /**\r\n   * Scroll to a specific page and position cursor at the start of that page\r\n   */\r\n  const scrollToPageCallback = useCallback((pageNumber, containerRef) => {\r\n    if (!containerRef?.current || !editorRef?.current) {\r\n      console.warn('[scrollToPage] Missing refs');\r\n      return;\r\n    }\r\n    scrollToPage(containerRef.current, editorRef.current, pageNumber, positionCursorAtPageCallback);\r\n  }, [editorRef, positionCursorAtPageCallback]);\r\n\r\n  // ============================================================================\r\n  // PAGE MANAGEMENT\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Insert a page break at a specific page boundary based on content height\r\n   * This is used when manually adding pages to insert them at the correct location\r\n   * @param {number} pageNumber - The page number where the break should be inserted (1-based)\r\n   * @returns {Promise<boolean>} - Success status\r\n   */\r\n  const insertPageBreakAtBoundaryCallback = useCallback(async (pageNumber) => {\r\n    if (!editorRef?.current) {\r\n      return false;\r\n    }\r\n\r\n    return insertPageBreakAtBoundary(\r\n      editorRef.current,\r\n      pageNumber,\r\n      latestPageSizeRef.current,\r\n      latestZoomLevelRef.current,\r\n      latestPageMarginsRef.current,\r\n      actions.updateContinuousContent,\r\n      updateBoundaries\r\n    );\r\n  }, [editorRef, actions, updateBoundaries]);\r\n\r\n  /**\r\n   * Remove a page and its content from the continuous editor\r\n   * Removes the page break and all content between the page boundaries\r\n   * @param {number} pageIndex - The index of the page to remove (0-based)\r\n   */\r\n  const removePageAndContentCallback = useCallback((pageIndex) => {\r\n    if (!editorRef?.current) {\r\n      return false;\r\n    }\r\n\r\n    return removePageAndContent(\r\n      editorRef.current,\r\n      pageIndex,\r\n      calculatePageBoundariesCallback,\r\n      actions.updateContinuousContent,\r\n      updateBoundaries,\r\n      positionCursorAtPageCallback,\r\n      checkAndReflowCallback\r\n    );\r\n  }, [editorRef, calculatePageBoundariesCallback, actions, updateBoundaries, positionCursorAtPageCallback, checkAndReflowCallback]);\r\n\r\n  /**\r\n   * Remove a single page break element\r\n   * This removes just the page break, allowing content to reflow naturally\r\n   * @param {HTMLElement} pageBreakElement - The page break element to remove\r\n   */\r\n  const removePageBreakCallback = useCallback((pageBreakElement) => {\r\n    if (!editorRef?.current) {\r\n      return false;\r\n    }\r\n\r\n    return removePageBreak(\r\n      pageBreakElement,\r\n      editorRef.current,\r\n      actions.updateContinuousContent,\r\n      updateBoundaries,\r\n      checkAndReflowCallback\r\n    );\r\n  }, [editorRef, actions, updateBoundaries, checkAndReflowCallback]);\r\n\r\n  // ============================================================================\r\n  // CLEANUP & PERFORMANCE\r\n  // ============================================================================\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (boundaryTimeoutRef.current) {\r\n        clearTimeout(boundaryTimeoutRef.current);\r\n      }\r\n      if (reflowTimeoutRef.current) {\r\n        clearTimeout(reflowTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Memoize the return object to prevent unnecessary re-renders in consuming components\r\n  return useMemo(() => ({\r\n    calculatePageBoundaries: calculatePageBoundariesCallback,\r\n    checkAndUpdateBoundaries: checkAndUpdateBoundariesCallback,\r\n    updateBoundaries,\r\n    getCurrentPage: getCurrentPageCallback,\r\n    scrollToPage: scrollToPageCallback,\r\n    positionCursorAtPage: positionCursorAtPageCallback,\r\n    checkAndReflow: checkAndReflowCallback,\r\n    triggerAutoReflow: triggerAutoReflowCallback,\r\n    removePageAndContent: removePageAndContentCallback,\r\n    removePageBreak: removePageBreakCallback,\r\n    insertPageBreakAtBoundary: insertPageBreakAtBoundaryCallback,\r\n    boundaryTimeoutRef,\r\n    reflowTimeoutRef\r\n  }), [\r\n    calculatePageBoundariesCallback,\r\n    checkAndUpdateBoundariesCallback,\r\n    updateBoundaries,\r\n    getCurrentPageCallback,\r\n    scrollToPageCallback,\r\n    positionCursorAtPageCallback,\r\n    checkAndReflowCallback,\r\n    triggerAutoReflowCallback,\r\n    removePageAndContentCallback,\r\n    removePageBreakCallback,\r\n    insertPageBreakAtBoundaryCallback\r\n  ]);\r\n};\r\n\r\n  // ============================================================================\r\n  // REFLOW MANAGEMENT\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Automatic reflow: Insert page breaks when content exceeds page height\r\n   * Optimized with performance guards and single-page-at-a-time processing\r\n   * Accounts for current zoom level and margins when calculating max height\r\n   */\r\n  const checkAndReflowCallback = useCallback(() => {\r\n    if (!editorRef?.current) {\r\n      return;\r\n    }\r\n\r\n    checkAndReflow(\r\n      editorRef.current,\r\n      latestPageSizeRef.current,\r\n      latestZoomLevelRef.current,\r\n      latestPageMarginsRef.current,\r\n      actions.updateContinuousContent,\r\n      updateBoundaries,\r\n      isReflowingRef,\r\n      checkAndReflowCallback\r\n    );\r\n  }, [editorRef, actions, updateBoundaries]);\r\n\r\n  /**\r\n   * Debounced automatic reflow check\r\n   * Optimized to prevent excessive reflow operations\r\n   */\r\n  const triggerAutoReflowCallback = useCallback((delay) => {\r\n    triggerAutoReflow(checkAndReflowCallback, reflowTimeoutRef, delay);\r\n  }, [checkAndReflowCallback]);\r\n\r\n  // ============================================================================\r\n  // NAVIGATION\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Get current page number based on viewport scroll position\r\n   * @param {React.RefObject} containerRef - The scroll container element\r\n   */\r\n  const getCurrentPageCallback = useCallback((containerRef) => {\r\n    if (!containerRef?.current || !editorRef?.current) {\r\n      return 0;\r\n    }\r\n    return getCurrentPage(containerRef.current, editorRef.current);\r\n  }, [editorRef]);\r\n\r\n  /**\r\n   * Position cursor at the start of a specific page\r\n   */\r\n  const positionCursorAtPageCallback = useCallback((pageNumber) => {\r\n    if (!editorRef?.current) {\r\n      return;\r\n    }\r\n    positionCursorAtPage(editorRef.current, pageNumber);\r\n  }, [editorRef]);\r\n\r\n  /**\r\n   * Scroll to a specific page and position cursor at the start of that page\r\n   */\r\n  const scrollToPageCallback = useCallback((pageNumber, containerRef) => {\r\n    if (!containerRef?.current || !editorRef?.current) {\r\n      console.warn('[scrollToPage] Missing refs');\r\n      return;\r\n    }\r\n    scrollToPage(containerRef.current, editorRef.current, pageNumber, positionCursorAtPageCallback);\r\n  }, [editorRef, positionCursorAtPageCallback]);\r\n\r\n  // ============================================================================\r\n  // PAGE MANAGEMENT\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Insert a page break at a specific page boundary based on content height\r\n   * This is used when manually adding pages to insert them at the correct location\r\n   * @param {number} pageNumber - The page number where the break should be inserted (1-based)\r\n   * @returns {Promise<boolean>} - Success status\r\n   */\r\n  const insertPageBreakAtBoundaryCallback = useCallback(async (pageNumber) => {\r\n    if (!editorRef?.current) {\r\n      return false;\r\n    }\r\n\r\n    return insertPageBreakAtBoundary(\r\n      editorRef.current,\r\n      pageNumber,\r\n      latestPageSizeRef.current,\r\n      latestZoomLevelRef.current,\r\n      latestPageMarginsRef.current,\r\n      actions.updateContinuousContent,\r\n      updateBoundaries\r\n    );\r\n  }, [editorRef, actions, updateBoundaries]);\r\n\r\n  /**\r\n   * Remove a page and its content from the continuous editor\r\n   * Removes the page break and all content between the page boundaries\r\n   * @param {number} pageIndex - The index of the page to remove (0-based)\r\n   */\r\n  const removePageAndContentCallback = useCallback((pageIndex) => {\r\n    if (!editorRef?.current) {\r\n      return false;\r\n    }\r\n\r\n    return removePageAndContent(\r\n      editorRef.current,\r\n      pageIndex,\r\n      calculatePageBoundariesCallback,\r\n      actions.updateContinuousContent,\r\n      updateBoundaries,\r\n      positionCursorAtPageCallback,\r\n      checkAndReflowCallback\r\n    );\r\n  }, [editorRef, calculatePageBoundariesCallback, actions, updateBoundaries, positionCursorAtPageCallback, checkAndReflowCallback]);\r\n\r\n  /**\r\n   * Remove a single page break element\r\n   * This removes just the page break, allowing content to reflow naturally\r\n   * @param {HTMLElement} pageBreakElement - The page break element to remove\r\n   */\r\n  const removePageBreakCallback = useCallback((pageBreakElement) => {\r\n    if (!editorRef?.current) {\r\n      return false;\r\n    }\r\n\r\n    return removePageBreak(\r\n      pageBreakElement,\r\n      editorRef.current,\r\n      actions.updateContinuousContent,\r\n      updateBoundaries,\r\n      checkAndReflowCallback\r\n    );\r\n  }, [editorRef, actions, updateBoundaries, checkAndReflowCallback]);\r\n","import { useEffect } from 'react';\r\n\r\n/**\r\n * Custom hook for handling keyboard shortcuts in the HTML editor\r\n * @param {Object} handlers - Object containing handler functions\r\n * @param {Function} handlers.handleZoomIn - Zoom in handler\r\n * @param {Function} handlers.handleZoomOut - Zoom out handler\r\n * @param {Function} handlers.handleZoomReset - Zoom reset handler\r\n * @param {Function} handlers.handleUndo - Undo handler\r\n * @param {Function} handlers.handleRedo - Redo handler\r\n * @param {Object} refs - Object containing refs\r\n * @param {React.RefObject} refs.editorRef - Editor ref\r\n * @param {React.RefObject} refs.containerRef - Container ref\r\n */\r\nexport const useKeyboardShortcuts = (handlers, refs) => {\r\n  const { handleZoomIn, handleZoomOut, handleZoomReset, handleUndo, handleRedo } = handlers;\r\n  const { editorRef, containerRef } = refs;\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (event) => {\r\n      // Check if Ctrl key (or Cmd on Mac) is pressed\r\n      if (event.ctrlKey || event.metaKey) {\r\n        // Prevent default browser behavior for our shortcuts\r\n        if (['+', '=', '-', '_', '0', 'z', 'y'].includes(event.key)) {\r\n          event.preventDefault();\r\n        }\r\n\r\n        // Only handle shortcuts when editor or its container has focus\r\n        // or when no specific input elements are focused\r\n        const isEditorFocused = document.activeElement === editorRef.current;\r\n        const isContainerFocused = document.activeElement === containerRef.current;\r\n        const isInputFocused = document.activeElement?.tagName === 'INPUT' ||\r\n                               document.activeElement?.tagName === 'TEXTAREA' ||\r\n                               document.activeElement?.isContentEditable === false;\r\n\r\n        if (isEditorFocused || isContainerFocused || !isInputFocused) {\r\n          switch (event.key) {\r\n            case '+':\r\n            case '=':\r\n              handleZoomIn();\r\n              break;\r\n            case '-':\r\n            case '_':\r\n              handleZoomOut();\r\n              break;\r\n            case '0':\r\n              handleZoomReset();\r\n              break;\r\n            case 'z':\r\n              if (!event.shiftKey) {\r\n                handleUndo();\r\n              }\r\n              break;\r\n            case 'y':\r\n              handleRedo();\r\n              break;\r\n            default:\r\n              break;\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyDown);\r\n    };\r\n  }, [handleZoomIn, handleZoomOut, handleZoomReset, handleUndo, handleRedo, editorRef, containerRef]);\r\n};","import { useCallback, useEffect, useRef } from 'react';\r\n\r\n/**\r\n * Custom hook for handling selection changes and cursor position management\r\n * @param {Object} params\r\n * @param {Function} params.updateCurrentFormatFromSelection - Function to update format from selection\r\n * @param {React.RefObject} params.editorRef - Editor ref\r\n * @returns {Object} - Returns cursor management functions\r\n */\r\nexport const useSelectionHandling = ({ updateCurrentFormatFromSelection, editorRef }) => {\r\n  const lastCursorPositionRef = useRef(null);\r\n\r\n  // Helper to restore cursor position or position at editor end\r\n  const restoreCursorPosition = useCallback(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const selection = window.getSelection();\r\n    if (lastCursorPositionRef.current) {\r\n      try {\r\n        selection.removeAllRanges();\r\n        selection.addRange(lastCursorPositionRef.current);\r\n        return;\r\n      } catch (error) {\r\n        console.warn('[restoreCursorPosition] Failed to restore cursor:', error);\r\n      }\r\n    }\r\n\r\n    // Fallback: position at end of editor\r\n    const lastChild = editorRef.current.lastChild;\r\n    if (lastChild) {\r\n      const range = document.createRange();\r\n      if (lastChild.nodeType === Node.TEXT_NODE) {\r\n        range.setStart(lastChild, lastChild.textContent.length);\r\n      } else {\r\n        range.setStartAfter(lastChild);\r\n      }\r\n      range.collapse(true);\r\n      selection.removeAllRanges();\r\n      selection.addRange(range);\r\n    }\r\n  }, [editorRef]);\r\n\r\n  // Helper to check if there's an active selection in the editor\r\n  const hasActiveCursorSelection = useCallback(() => {\r\n    if (!editorRef.current) return false;\r\n\r\n    const selection = window.getSelection();\r\n    if (!selection || selection.rangeCount === 0) return false;\r\n\r\n    const activeRange = selection.getRangeAt(0);\r\n    return editorRef.current.contains(activeRange.commonAncestorContainer);\r\n  }, [editorRef]);\r\n\r\n  // Update format state when selection changes\r\n  useEffect(() => {\r\n    const handleSelectionChange = () => {\r\n      updateCurrentFormatFromSelection();\r\n\r\n      // Update last cursor position (only for caret/collapsed selections)\r\n      if (editorRef.current) {\r\n        const selection = window.getSelection();\r\n        if (selection.rangeCount > 0) {\r\n          const range = selection.getRangeAt(0);\r\n          if (range.collapsed && editorRef.current.contains(range.commonAncestorContainer)) {\r\n            lastCursorPositionRef.current = range.cloneRange(); // Clone to store\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    // Listen for selection changes\r\n    document.addEventListener('selectionchange', handleSelectionChange);\r\n\r\n    // Also update when editor gets focus\r\n    const handleFocus = () => {\r\n      setTimeout(updateCurrentFormatFromSelection, 10);\r\n\r\n      // Restore cursor to last position if available\r\n      if (lastCursorPositionRef.current && editorRef.current) {\r\n        try {\r\n          const selection = window.getSelection();\r\n          selection.removeAllRanges();\r\n          selection.addRange(lastCursorPositionRef.current);\r\n        } catch (error) {\r\n          console.warn('[handleFocus] Failed to restore cursor:', error);\r\n        }\r\n      }\r\n    };\r\n\r\n    if (editorRef.current) {\r\n      editorRef.current.addEventListener('focus', handleFocus);\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener('selectionchange', handleSelectionChange);\r\n      if (editorRef.current) {\r\n        editorRef.current.removeEventListener('focus', handleFocus);\r\n      }\r\n    };\r\n  }, [updateCurrentFormatFromSelection, editorRef]);\r\n\r\n  return {\r\n    restoreCursorPosition,\r\n    hasActiveCursorSelection\r\n  };\r\n};","/**\r\n * Image Resize Utilities for HTML Editor\r\n * Provides functionality for resizing images with handlers\r\n */\r\n\r\n/**\r\n * Default image resize options\r\n */\r\nexport const DEFAULT_IMAGE_RESIZE_OPTIONS = {\r\n  minWidth: 50,\r\n  minHeight: 50,\r\n  maxWidth: 800,\r\n  maxHeight: 600,\r\n  aspectRatio: true,\r\n  preserveAspectRatio: true,\r\n  defaultWidth: 300,\r\n  defaultHeight: 200\r\n};\r\n\r\n/**\r\n * Image resize handler positions\r\n */\r\nexport const RESIZE_HANDLERS = {\r\n  TOP_LEFT: 'top-left',\r\n  TOP_RIGHT: 'top-right',\r\n  BOTTOM_LEFT: 'bottom-left',\r\n  BOTTOM_RIGHT: 'bottom-right',\r\n  TOP: 'top',\r\n  BOTTOM: 'bottom',\r\n  LEFT: 'left',\r\n  RIGHT: 'right'\r\n};\r\n\r\n/**\r\n * Calculate new dimensions based on resize handler and mouse movement\r\n * @param {Object} params - Resize parameters\r\n * @param {string} params.handler - Resize handler position\r\n * @param {number} params.startX - Initial mouse X position\r\n * @param {number} params.startY - Initial mouse Y position\r\n * @param {number} params.currentX - Current mouse X position\r\n * @param {number} params.currentY - Current mouse Y position\r\n * @param {number} params.startWidth - Initial image width\r\n * @param {number} params.startHeight - Initial image height\r\n * @param {Object} params.options - Resize options\r\n * @returns {Object} New width and height\r\n */\r\nexport function calculateResizeDimensions({\r\n  handler,\r\n  startX,\r\n  startY,\r\n  currentX,\r\n  currentY,\r\n  startWidth,\r\n  startHeight,\r\n  options = DEFAULT_IMAGE_RESIZE_OPTIONS\r\n}) {\r\n  const deltaX = currentX - startX;\r\n  const deltaY = currentY - startY;\r\n  \r\n  let newWidth = startWidth;\r\n  let newHeight = startHeight;\r\n  \r\n  // Calculate based on handler position\r\n  switch (handler) {\r\n    case RESIZE_HANDLERS.TOP_LEFT:\r\n      newWidth = Math.max(options.minWidth, startWidth - deltaX);\r\n      newHeight = Math.max(options.minHeight, startHeight - deltaY);\r\n      break;\r\n      \r\n    case RESIZE_HANDLERS.TOP_RIGHT:\r\n      newWidth = Math.max(options.minWidth, startWidth + deltaX);\r\n      newHeight = Math.max(options.minHeight, startHeight - deltaY);\r\n      break;\r\n      \r\n    case RESIZE_HANDLERS.BOTTOM_LEFT:\r\n      newWidth = Math.max(options.minWidth, startWidth - deltaX);\r\n      newHeight = Math.max(options.minHeight, startHeight + deltaY);\r\n      break;\r\n      \r\n    case RESIZE_HANDLERS.BOTTOM_RIGHT:\r\n      newWidth = Math.max(options.minWidth, startWidth + deltaX);\r\n      newHeight = Math.max(options.minHeight, startHeight + deltaY);\r\n      break;\r\n      \r\n    case RESIZE_HANDLERS.TOP:\r\n      newHeight = Math.max(options.minHeight, startHeight - deltaY);\r\n      break;\r\n      \r\n    case RESIZE_HANDLERS.BOTTOM:\r\n      newHeight = Math.max(options.minHeight, startHeight + deltaY);\r\n      break;\r\n      \r\n    case RESIZE_HANDLERS.LEFT:\r\n      newWidth = Math.max(options.minWidth, startWidth - deltaX);\r\n      break;\r\n      \r\n    case RESIZE_HANDLERS.RIGHT:\r\n      newWidth = Math.max(options.minWidth, startWidth + deltaX);\r\n      break;\r\n      \r\n    default:\r\n      return { width: newWidth, height: newHeight };\r\n  }\r\n  \r\n  // Apply aspect ratio if needed\r\n  if (options.preserveAspectRatio && options.aspectRatio) {\r\n    const aspectRatio = startWidth / startHeight;\r\n    \r\n    // For corner handlers, maintain aspect ratio\r\n    if ([RESIZE_HANDLERS.TOP_LEFT, RESIZE_HANDLERS.TOP_RIGHT, \r\n         RESIZE_HANDLERS.BOTTOM_LEFT, RESIZE_HANDLERS.BOTTOM_RIGHT].includes(handler)) {\r\n      // Use the larger dimension to maintain aspect ratio\r\n      if (newWidth / aspectRatio > newHeight) {\r\n        newHeight = Math.max(options.minHeight, newWidth / aspectRatio);\r\n      } else {\r\n        newWidth = Math.max(options.minWidth, newHeight * aspectRatio);\r\n      }\r\n    }\r\n    // For edge handlers, maintain aspect ratio\r\n    else if ([RESIZE_HANDLERS.TOP, RESIZE_HANDLERS.BOTTOM].includes(handler)) {\r\n      newWidth = newHeight * aspectRatio;\r\n    } else if ([RESIZE_HANDLERS.LEFT, RESIZE_HANDLERS.RIGHT].includes(handler)) {\r\n      newHeight = newWidth / aspectRatio;\r\n    }\r\n  }\r\n  \r\n  // Apply max dimensions\r\n  if (options.maxWidth && newWidth > options.maxWidth) {\r\n    newWidth = options.maxWidth;\r\n    if (options.preserveAspectRatio && options.aspectRatio) {\r\n      newHeight = newWidth / (startWidth / startHeight);\r\n    }\r\n  }\r\n  \r\n  if (options.maxHeight && newHeight > options.maxHeight) {\r\n    newHeight = options.maxHeight;\r\n    if (options.preserveAspectRatio && options.aspectRatio) {\r\n      newWidth = newHeight * (startWidth / startHeight);\r\n    }\r\n  }\r\n  \r\n  // Ensure minimum dimensions\r\n  newWidth = Math.max(options.minWidth, newWidth);\r\n  newHeight = Math.max(options.minHeight, newHeight);\r\n  \r\n  return {\r\n    width: Math.round(newWidth),\r\n    height: Math.round(newHeight)\r\n  };\r\n}\r\n\r\n/**\r\n * Check if an element is an image that can be resized\r\n * @param {HTMLElement} element - Element to check\r\n * @returns {boolean} Whether the element is a resizable image\r\n */\r\nexport function isResizableImage(element) {\r\n  if (!element) return false;\r\n  \r\n  // Check if it's an img element\r\n  if (element.tagName === 'IMG') {\r\n    return true;\r\n  }\r\n  \r\n  // Check if it's a div with background image that should be resizable\r\n  if (element.tagName === 'DIV' &&\r\n      element.style.backgroundImage &&\r\n      element.style.backgroundImage !== 'none') {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Get image dimensions from an element\r\n * @param {HTMLElement} element - Image element\r\n * @returns {Object} Width and height\r\n */\r\nexport function getImageDimensions(element) {\r\n  if (!isResizableImage(element)) {\r\n    return { width: 0, height: 0 };\r\n  }\r\n  \r\n  return {\r\n    width: element.offsetWidth,\r\n    height: element.offsetHeight\r\n  };\r\n}\r\n\r\n/**\r\n * Apply image dimensions to an element\r\n * @param {HTMLElement} element - Image element\r\n * @param {Object} dimensions - Width and height\r\n * @param {number} dimensions.width - New width\r\n * @param {number} dimensions.height - New height\r\n */\r\nexport function applyImageDimensions(element, { width, height }) {\r\n  if (!isResizableImage(element)) return;\r\n  \r\n  // For img elements\r\n  if (element.tagName === 'IMG') {\r\n    element.style.width = `${width}px`;\r\n    element.style.height = `${height}px`;\r\n    element.width = width;\r\n    element.height = height;\r\n  }\r\n  // For div elements with background images\r\n  else if (element.tagName === 'DIV') {\r\n    element.style.width = `${width}px`;\r\n    element.style.height = `${height}px`;\r\n  }\r\n}\r\n\r\n/**\r\n * Create resize overlay for an image\r\n * @param {HTMLElement} imageElement - Image element to resize\r\n * @param {Object} options - Resize options\r\n * @returns {HTMLElement} Resize overlay element\r\n */\r\nexport function createResizeOverlay(imageElement, options = DEFAULT_IMAGE_RESIZE_OPTIONS) {\r\n  if (!isResizableImage(imageElement)) return null;\r\n  \r\n  // Create overlay container\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'image-resize-overlay';\r\n  overlay.style.position = 'fixed'; // Changed to fixed for viewport positioning\r\n  overlay.style.zIndex = '1000';\r\n  overlay.style.pointerEvents = 'none';\r\n  \r\n  // Position overlay over the image using viewport coordinates\r\n  const rect = imageElement.getBoundingClientRect();\r\n  \r\n  overlay.style.top = `${rect.top}px`;\r\n  overlay.style.left = `${rect.left}px`;\r\n  overlay.style.width = `${rect.width}px`;\r\n  overlay.style.height = `${rect.height}px`;\r\n  \r\n  // Create resize handlers\r\n  const handlers = Object.values(RESIZE_HANDLERS);\r\n  handlers.forEach(handler => {\r\n    const handlerElement = document.createElement('div');\r\n    handlerElement.className = `resize-handler resize-handler-${handler}`;\r\n    handlerElement.dataset.handler = handler;\r\n    handlerElement.style.position = 'absolute';\r\n    handlerElement.style.width = '10px';\r\n    handlerElement.style.height = '10px';\r\n    handlerElement.style.backgroundColor = '#007bff';\r\n    handlerElement.style.border = '2px solid white';\r\n    handlerElement.style.borderRadius = '50%';\r\n    handlerElement.style.boxShadow = '0 0 3px rgba(0,0,0,0.3)';\r\n    handlerElement.style.cursor = getCursorForHandler(handler);\r\n    handlerElement.style.pointerEvents = 'all';\r\n    \r\n    // Position handler\r\n    positionHandler(handlerElement, handler, rect.width, rect.height);\r\n    \r\n    overlay.appendChild(handlerElement);\r\n  });\r\n  \r\n  return overlay;\r\n}\r\n\r\n/**\r\n * Get cursor style for a resize handler\r\n * @param {string} handler - Handler position\r\n * @returns {string} CSS cursor value\r\n */\r\nfunction getCursorForHandler(handler) {\r\n  switch (handler) {\r\n    case RESIZE_HANDLERS.TOP_LEFT:\r\n    case RESIZE_HANDLERS.BOTTOM_RIGHT:\r\n      return 'nwse-resize';\r\n    case RESIZE_HANDLERS.TOP_RIGHT:\r\n    case RESIZE_HANDLERS.BOTTOM_LEFT:\r\n      return 'nesw-resize';\r\n    case RESIZE_HANDLERS.TOP:\r\n    case RESIZE_HANDLERS.BOTTOM:\r\n      return 'ns-resize';\r\n    case RESIZE_HANDLERS.LEFT:\r\n    case RESIZE_HANDLERS.RIGHT:\r\n      return 'ew-resize';\r\n    default:\r\n      return 'default';\r\n  }\r\n}\r\n\r\n/**\r\n * Position a resize handler\r\n * @param {HTMLElement} handler - Handler element\r\n * @param {string} position - Handler position\r\n * @param {number} width - Container width\r\n * @param {number} height - Container height\r\n */\r\nfunction positionHandler(handler, position, width, height) {\r\n  const offset = -5; // Half of handler size to center it\r\n  \r\n  switch (position) {\r\n    case RESIZE_HANDLERS.TOP_LEFT:\r\n      handler.style.top = `${offset}px`;\r\n      handler.style.left = `${offset}px`;\r\n      break;\r\n    case RESIZE_HANDLERS.TOP_RIGHT:\r\n      handler.style.top = `${offset}px`;\r\n      handler.style.right = `${offset}px`;\r\n      break;\r\n    case RESIZE_HANDLERS.BOTTOM_LEFT:\r\n      handler.style.bottom = `${offset}px`;\r\n      handler.style.left = `${offset}px`;\r\n      break;\r\n    case RESIZE_HANDLERS.BOTTOM_RIGHT:\r\n      handler.style.bottom = `${offset}px`;\r\n      handler.style.right = `${offset}px`;\r\n      break;\r\n    case RESIZE_HANDLERS.TOP:\r\n      handler.style.top = `${offset}px`;\r\n      handler.style.left = `${width / 2 + offset}px`;\r\n      break;\r\n    case RESIZE_HANDLERS.BOTTOM:\r\n      handler.style.bottom = `${offset}px`;\r\n      handler.style.left = `${width / 2 + offset}px`;\r\n      break;\r\n    case RESIZE_HANDLERS.LEFT:\r\n      handler.style.top = `${height / 2 + offset}px`;\r\n      handler.style.left = `${offset}px`;\r\n      break;\r\n    case RESIZE_HANDLERS.RIGHT:\r\n      handler.style.top = `${height / 2 + offset}px`;\r\n      handler.style.right = `${offset}px`;\r\n      break;\r\n  }\r\n}\r\n\r\n/**\r\n * Update resize overlay position and size\r\n * @param {HTMLElement} overlay - Resize overlay\r\n * @param {HTMLElement} imageElement - Image element\r\n */\r\nexport function updateResizeOverlay(overlay, imageElement) {\r\n  if (!overlay || !imageElement) return;\r\n  \r\n  const rect = imageElement.getBoundingClientRect();\r\n  \r\n  overlay.style.top = `${rect.top}px`;\r\n  overlay.style.left = `${rect.left}px`;\r\n  overlay.style.width = `${rect.width}px`;\r\n  overlay.style.height = `${rect.height}px`;\r\n  \r\n  // Update handler positions\r\n  const handlers = overlay.querySelectorAll('.resize-handler');\r\n  handlers.forEach(handler => {\r\n    const position = handler.dataset.handler;\r\n    positionHandler(handler, position, rect.width, rect.height);\r\n  });\r\n}\r\n\r\n/**\r\n * Remove resize overlay\r\n * @param {HTMLElement} overlay - Resize overlay to remove\r\n */\r\nexport function removeResizeOverlay(overlay) {\r\n  if (overlay && overlay.parentNode) {\r\n    overlay.parentNode.removeChild(overlay);\r\n  }\r\n}\r\n","/**\r\n * IndexedDB storage service for handling image persistence in the editor\r\n * Stores images as base64 data URLs with better scalability than localStorage\r\n * Supports storing many large images without quota limitations\r\n */\r\n\r\nconst DB_NAME = 'html-editor-storage';\r\nconst DB_VERSION = 1;\r\nconst STORE_NAME = 'images';\r\n\r\n/**\r\n * Generates a UUID v4 string for unique image keys\r\n * @returns {string} UUID string\r\n */\r\nfunction generateUUID() {\r\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\r\n    const r = Math.random() * 16 | 0;\r\n    const v = c === 'x' ? r : (r & 0x3 | 0x8);\r\n    return v.toString(16);\r\n  });\r\n}\r\n\r\n/**\r\n * Opens the IndexedDB database\r\n * @returns {Promise<IDBDatabase>} Promise resolving to database instance\r\n */\r\nfunction openDatabase() {\r\n  return new Promise((resolve, reject) => {\r\n    const request = indexedDB.open(DB_NAME, DB_VERSION);\r\n\r\n    request.onerror = () => {\r\n      reject(new Error('Failed to open IndexedDB database'));\r\n    };\r\n\r\n    request.onsuccess = () => {\r\n      resolve(request.result);\r\n    };\r\n\r\n    request.onupgradeneeded = (event) => {\r\n      const db = event.target.result;\r\n      \r\n      // Create object store if it doesn't exist\r\n      if (!db.objectStoreNames.contains(STORE_NAME)) {\r\n        const objectStore = db.createObjectStore(STORE_NAME, { keyPath: 'key' });\r\n        objectStore.createIndex('timestamp', 'timestamp', { unique: false });\r\n      }\r\n    };\r\n  });\r\n}\r\n\r\n/**\r\n * Saves an image file to IndexedDB\r\n * @param {File} file - Image file to store\r\n * @returns {Promise<string>} Promise resolving to storage key\r\n * @throws {Error} When image validation fails or storage operation fails\r\n */\r\nexport function saveImage(file) {\r\n  return new Promise((resolve, reject) => {\r\n    // Validate file type\r\n    const validTypes = ['image/png', 'image/jpeg', 'image/gif', 'image/webp'];\r\n    if (!validTypes.includes(file.type)) {\r\n      reject(new Error('Invalid image format. Supported formats: png, jpeg, gif, webp'));\r\n      return;\r\n    }\r\n\r\n    // Check file size (5MB limit per image - can be increased as needed)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      reject(new Error('Image exceeds maximum size of 5MB'));\r\n      return;\r\n    }\r\n\r\n    const reader = new FileReader();\r\n    \r\n    reader.onload = async (event) => {\r\n      const dataUrl = event.target.result;\r\n      \r\n      // Calculate base64 size (3 bytes for every 4 characters)\r\n      const base64String = dataUrl.split(',')[1];\r\n      const sizeInBytes = (base64String.length * 3) / 4;\r\n      \r\n      if (sizeInBytes > 5 * 1024 * 1024) {\r\n        reject(new Error('Image exceeds maximum size of 5MB'));\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const db = await openDatabase();\r\n        const key = `editor-image-${generateUUID()}`;\r\n        \r\n        const transaction = db.transaction([STORE_NAME], 'readwrite');\r\n        const objectStore = transaction.objectStore(STORE_NAME);\r\n        \r\n        const imageData = {\r\n          key,\r\n          dataUrl,\r\n          size: sizeInBytes,\r\n          type: file.type,\r\n          timestamp: Date.now()\r\n        };\r\n        \r\n        const request = objectStore.add(imageData);\r\n        \r\n        request.onsuccess = () => {\r\n          db.close();\r\n          resolve(key);\r\n        };\r\n        \r\n        request.onerror = () => {\r\n          db.close();\r\n          reject(new Error('Failed to save image to IndexedDB'));\r\n        };\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    };\r\n\r\n    reader.onerror = () => {\r\n      reject(new Error('Error reading image file'));\r\n    };\r\n\r\n    reader.readAsDataURL(file);\r\n  });\r\n}\r\n\r\n/**\r\n * Retrieves an image from IndexedDB by key\r\n * @param {string} key - Storage key for the image\r\n * @returns {Promise<string|null>} Promise resolving to data URL of the image or null if not found\r\n */\r\nexport async function getImage(key) {\r\n  try {\r\n    const db = await openDatabase();\r\n    \r\n    return new Promise((resolve, reject) => {\r\n      const transaction = db.transaction([STORE_NAME], 'readonly');\r\n      const objectStore = transaction.objectStore(STORE_NAME);\r\n      const request = objectStore.get(key);\r\n      \r\n      request.onsuccess = () => {\r\n        db.close();\r\n        const result = request.result;\r\n        resolve(result ? result.dataUrl : null);\r\n      };\r\n      \r\n      request.onerror = () => {\r\n        db.close();\r\n        reject(new Error('Failed to retrieve image from IndexedDB'));\r\n      };\r\n    });\r\n  } catch (error) {\r\n    console.error('Error getting image:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Deletes an image from IndexedDB\r\n * @param {string} key - Storage key for the image\r\n * @returns {Promise<void>}\r\n */\r\nexport async function deleteImage(key) {\r\n  try {\r\n    const db = await openDatabase();\r\n    \r\n    return new Promise((resolve, reject) => {\r\n      const transaction = db.transaction([STORE_NAME], 'readwrite');\r\n      const objectStore = transaction.objectStore(STORE_NAME);\r\n      const request = objectStore.delete(key);\r\n      \r\n      request.onsuccess = () => {\r\n        db.close();\r\n        resolve();\r\n      };\r\n      \r\n      request.onerror = () => {\r\n        db.close();\r\n        reject(new Error('Failed to delete image from IndexedDB'));\r\n      };\r\n    });\r\n  } catch (error) {\r\n    console.error('Error deleting image:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clears all editor images from IndexedDB\r\n * @returns {Promise<void>}\r\n */\r\nexport async function clearImages() {\r\n  try {\r\n    const db = await openDatabase();\r\n    \r\n    return new Promise((resolve, reject) => {\r\n      const transaction = db.transaction([STORE_NAME], 'readwrite');\r\n      const objectStore = transaction.objectStore(STORE_NAME);\r\n      const request = objectStore.clear();\r\n      \r\n      request.onsuccess = () => {\r\n        db.close();\r\n        resolve();\r\n      };\r\n      \r\n      request.onerror = () => {\r\n        db.close();\r\n        reject(new Error('Failed to clear images from IndexedDB'));\r\n      };\r\n    });\r\n  } catch (error) {\r\n    console.error('Error clearing images:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Gets all stored image keys\r\n * @returns {Promise<string[]>} Promise resolving to array of image storage keys\r\n */\r\nexport async function getAllImageKeys() {\r\n  try {\r\n    const db = await openDatabase();\r\n    \r\n    return new Promise((resolve, reject) => {\r\n      const transaction = db.transaction([STORE_NAME], 'readonly');\r\n      const objectStore = transaction.objectStore(STORE_NAME);\r\n      const request = objectStore.getAllKeys();\r\n      \r\n      request.onsuccess = () => {\r\n        db.close();\r\n        resolve(request.result || []);\r\n      };\r\n      \r\n      request.onerror = () => {\r\n        db.close();\r\n        reject(new Error('Failed to get image keys from IndexedDB'));\r\n      };\r\n    });\r\n  } catch (error) {\r\n    console.error('Error getting image keys:', error);\r\n    return [];\r\n  }\r\n}\r\n","/**\r\n * Content normalization utilities\r\n * Handles comprehensive HTML content normalization including:\r\n * - Paragraphs, headings, lists, tables\r\n * - Images with alignment\r\n * - Font formatting and sizes\r\n * - Indentation\r\n * - Page breaks\r\n */\r\n\r\n// Block-level elements that should not be wrapped in paragraphs\r\nconst BLOCK_ELEMENTS = [\r\n  'P', 'DIV', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6',\r\n  'UL', 'OL', 'LI', 'TABLE', 'TBODY', 'TR', 'TD', 'TH', 'THEAD', 'TFOOT',\r\n  'BLOCKQUOTE', 'PRE', 'HR', 'FIGURE', 'FIGCAPTION',\r\n  'PAGE-BREAK'\r\n];\r\n\r\n// Inline formatting elements that should be preserved\r\nconst INLINE_FORMATTING_ELEMENTS = [\r\n  'SPAN', 'STRONG', 'EM', 'B', 'I', 'U', 'S', 'STRIKE', 'DEL', 'INS',\r\n  'SUB', 'SUP', 'MARK', 'SMALL', 'CODE', 'KBD', 'SAMP', 'VAR',\r\n  'A', 'ABBR', 'CITE', 'DFN', 'TIME'\r\n];\r\n\r\n// Self-closing elements\r\nconst VOID_ELEMENTS = ['BR', 'HR', 'IMG', 'INPUT', 'PAGE-BREAK'];\r\n\r\n/**\r\n * Escapes HTML special characters\r\n * @param {string} text - Text to escape\r\n * @returns {string} Escaped HTML text\r\n */\r\nfunction escapeHtml(text) {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Gets element attributes as a string\r\n * @param {HTMLElement} element - The element to get attributes from\r\n * @returns {string} Attributes string for HTML\r\n */\r\nfunction getElementAttributes(element) {\r\n  const attributes = [];\r\n  for (let i = 0; i < element.attributes.length; i++) {\r\n    const attr = element.attributes[i];\r\n    // Preserve all attributes including style, class, data-*, align, etc.\r\n    attributes.push(` ${attr.name}=\"${attr.value}\"`);\r\n  }\r\n  return attributes.join('');\r\n}\r\n\r\n/**\r\n * Normalizes HTML content with comprehensive support for all content types\r\n * Handles: paragraphs, headings, images, lists, tables, indentation,\r\n * image alignment, fonts, font sizes, and page breaks\r\n * @param {string} htmlContent - The HTML content to normalize\r\n * @returns {string} Normalized HTML content with proper structure\r\n */\r\nexport function normalizeContent(htmlContent) {\r\n  if (!htmlContent || typeof htmlContent !== 'string') {\r\n    return '<p><br></p>';\r\n  }\r\n\r\n  const trimmed = htmlContent.trim();\r\n  if (!trimmed) {\r\n    return '<p><br></p>';\r\n  }\r\n\r\n  // Create a temporary DOM element to parse the HTML\r\n  const tempDiv = document.createElement('div');\r\n  tempDiv.innerHTML = trimmed;\r\n\r\n  // Process the content to ensure proper structure\r\n  const normalizedContent = normalizeElement(tempDiv);\r\n\r\n  return normalizedContent || '<p><br></p>';\r\n}\r\n\r\n/**\r\n * Removes nested paragraph tags from heading elements\r\n * @param {HTMLElement} headingElement - The heading element to clean\r\n * @returns {string} Cleaned inner HTML without nested paragraphs\r\n */\r\nfunction removeNestedParagraphs(headingElement) {\r\n  const clonedElement = headingElement.cloneNode(true);\r\n  \r\n  // Find all p tags that are direct children of the heading\r\n  const nestedParagraphs = clonedElement.querySelectorAll(':scope > p');\r\n  \r\n  // Remove the p tags and move their content to the heading level\r\n  nestedParagraphs.forEach(p => {\r\n    // Move all child nodes of the p tag to the heading level\r\n    while (p.firstChild) {\r\n      clonedElement.insertBefore(p.firstChild, p);\r\n    }\r\n    // Remove the empty p tag\r\n    p.remove();\r\n  });\r\n  \r\n  return clonedElement.innerHTML;\r\n}\r\n\r\n/**\r\n * Checks if a paragraph element contains only block elements and should be unwrapped\r\n * @param {HTMLElement} paragraphElement - The paragraph element to check\r\n * @returns {boolean} True if the paragraph should be unwrapped\r\n */\r\nfunction shouldUnwrapParagraph(paragraphElement) {\r\n  const childElements = Array.from(paragraphElement.children);\r\n  \r\n  // If paragraph has no child elements, don't unwrap\r\n  if (childElements.length === 0) {\r\n    return false;\r\n  }\r\n  \r\n  // Check if all child elements are block elements\r\n  return childElements.every(child => BLOCK_ELEMENTS.includes(child.tagName));\r\n}\r\n\r\n/**\r\n * Unwraps block elements from inside a paragraph\r\n * @param {HTMLElement} paragraphElement - The paragraph element to unwrap\r\n * @returns {string} HTML string with block elements unwrapped\r\n */\r\nfunction unwrapParagraphBlockElements(paragraphElement) {\r\n  const blockElements = [];\r\n  let hasNonBlockContent = false;\r\n  \r\n  Array.from(paragraphElement.childNodes).forEach(node => {\r\n    if (node.nodeType === Node.TEXT_NODE) {\r\n      const text = node.textContent.trim();\r\n      if (text) {\r\n        hasNonBlockContent = true;\r\n      }\r\n    } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n      const element = node;\r\n      if (BLOCK_ELEMENTS.includes(element.tagName)) {\r\n        blockElements.push(element.outerHTML);\r\n      } else {\r\n        hasNonBlockContent = true;\r\n      }\r\n    }\r\n  });\r\n  \r\n  // If paragraph has non-block content, we shouldn't unwrap\r\n  if (hasNonBlockContent) {\r\n    return paragraphElement.outerHTML;\r\n  }\r\n  \r\n  // Return unwrapped block elements\r\n  return blockElements.join('');\r\n}\r\n\r\n/**\r\n * Normalizes an element and its children\r\n * @param {HTMLElement} container - Container element with content\r\n * @returns {string} HTML string with proper structure\r\n */\r\nfunction normalizeElement(container) {\r\n  const fragments = [];\r\n  const childNodes = Array.from(container.childNodes);\r\n\r\n  for (let i = 0; i < childNodes.length; i++) {\r\n    const node = childNodes[i];\r\n\r\n    if (node.nodeType === Node.TEXT_NODE) {\r\n      // Handle text nodes - wrap in p if not empty\r\n      const text = node.textContent.trim();\r\n      if (text) {\r\n        fragments.push(`<p>${escapeHtml(text)}</p>`);\r\n      }\r\n    } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n      const element = node;\r\n      const tagName = element.tagName;\r\n      const lowerTagName = tagName.toLowerCase();\r\n      const attributes = getElementAttributes(element);\r\n\r\n      // Handle different element types\r\n      if (tagName === 'DIV') {\r\n        // Convert div content to proper structure\r\n        const innerContent = normalizeElement(element);\r\n        if (innerContent.trim()) {\r\n          fragments.push(innerContent);\r\n        } else {\r\n          fragments.push('<p><br></p>');\r\n        }\r\n      } else if (tagName === 'P') {\r\n        // Check if paragraph contains only block elements that should be unwrapped\r\n        if (shouldUnwrapParagraph(element)) {\r\n          fragments.push(unwrapParagraphBlockElements(element));\r\n        } else {\r\n          // Preserve paragraphs with all their attributes (style, class, etc.)\r\n          fragments.push(element.outerHTML);\r\n        }\r\n      } else if (['H1', 'H2', 'H3', 'H4', 'H5', 'H6'].includes(tagName)) {\r\n        // Handle heading elements - remove any nested p tags, preserve attributes\r\n        const headingContent = removeNestedParagraphs(element);\r\n        fragments.push(`<${lowerTagName}${attributes}>${headingContent}</${lowerTagName}>`);\r\n      } else if (tagName === 'BR') {\r\n        // Handle line breaks - convert to paragraph break\r\n        fragments.push('<p><br></p>');\r\n      } else if (tagName === 'IMG') {\r\n        // Preserve images with all attributes (src, alt, style, align, width, height, etc.)\r\n        fragments.push(element.outerHTML);\r\n      } else if (['UL', 'OL'].includes(tagName)) {\r\n        // Preserve lists with proper structure\r\n        fragments.push(normalizeList(element));\r\n      } else if (tagName === 'LI') {\r\n        // Preserve list items with attributes\r\n        fragments.push(element.outerHTML);\r\n      } else if (tagName === 'TABLE') {\r\n        // Preserve tables with all structure and attributes\r\n        fragments.push(normalizeTable(element));\r\n      } else if (['TBODY', 'THEAD', 'TFOOT', 'TR', 'TD', 'TH'].includes(tagName)) {\r\n        // Preserve table elements with attributes\r\n        fragments.push(element.outerHTML);\r\n      } else if (tagName === 'BLOCKQUOTE') {\r\n        // Preserve blockquotes with attributes\r\n        const innerContent = normalizeElement(element);\r\n        fragments.push(`<blockquote${attributes}>${innerContent}</blockquote>`);\r\n      } else if (tagName === 'PRE') {\r\n        // Preserve preformatted text exactly as-is\r\n        fragments.push(element.outerHTML);\r\n      } else if (INLINE_FORMATTING_ELEMENTS.includes(tagName)) {\r\n        // Preserve inline formatting elements with attributes (including font styles)\r\n        fragments.push(element.outerHTML);\r\n      } else if (tagName === 'PAGE-BREAK' || element.getAttribute('data-page-break') === 'true') {\r\n        // Preserve page breaks as-is\r\n        fragments.push(element.outerHTML);\r\n      } else if (tagName === 'HR') {\r\n        // Preserve horizontal rules\r\n        fragments.push(element.outerHTML);\r\n      } else if (tagName === 'FIGURE') {\r\n        // Preserve figure elements (for images with captions)\r\n        fragments.push(element.outerHTML);\r\n      } else {\r\n        // For any other elements, preserve them with their attributes\r\n        if (VOID_ELEMENTS.includes(tagName)) {\r\n          fragments.push(element.outerHTML);\r\n        } else {\r\n          const innerContent = normalizeElement(element);\r\n          fragments.push(`<${lowerTagName}${attributes}>${innerContent}</${lowerTagName}>`);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // If no content was processed, return empty string (let parent decide default)\r\n  if (fragments.length === 0) {\r\n    return '';\r\n  }\r\n\r\n  return fragments.join('');\r\n}\r\n\r\n/**\r\n * Normalizes list elements (UL/OL)\r\n * @param {HTMLElement} listElement - The list element to normalize\r\n * @returns {string} Normalized list HTML\r\n */\r\nfunction normalizeList(listElement) {\r\n  const tagName = listElement.tagName.toLowerCase();\r\n  const attributes = getElementAttributes(listElement);\r\n  const items = [];\r\n\r\n  Array.from(listElement.children).forEach(child => {\r\n    if (child.tagName === 'LI') {\r\n      items.push(child.outerHTML);\r\n    } else {\r\n      // Wrap non-LI content in LI\r\n      const content = normalizeElement(child);\r\n      if (content.trim()) {\r\n        items.push(`<li>${content}</li>`);\r\n      }\r\n    }\r\n  });\r\n\r\n  if (items.length === 0) {\r\n    return `<${tagName}${attributes}><li><br></li></${tagName}>`;\r\n  }\r\n\r\n  return `<${tagName}${attributes}>${items.join('')}</${tagName}>`;\r\n}\r\n\r\n/**\r\n * Normalizes table elements\r\n * @param {HTMLElement} tableElement - The table element to normalize\r\n * @returns {string} Normalized table HTML\r\n */\r\nfunction normalizeTable(tableElement) {\r\n  // Preserve tables exactly as-is with all their attributes and structure\r\n  // Tables are complex and should maintain their exact structure\r\n  return tableElement.outerHTML;\r\n}","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nconst toKebabCase = (string) => string.replace(/([a-z0-9])([A-Z])/g, \"$1-$2\").toLowerCase();\nconst toCamelCase = (string) => string.replace(\n  /^([A-Z])|[\\s-_]+(\\w)/g,\n  (match, p1, p2) => p2 ? p2.toUpperCase() : p1.toLowerCase()\n);\nconst toPascalCase = (string) => {\n  const camelCase = toCamelCase(string);\n  return camelCase.charAt(0).toUpperCase() + camelCase.slice(1);\n};\nconst mergeClasses = (...classes) => classes.filter((className, index, array) => {\n  return Boolean(className) && className.trim() !== \"\" && array.indexOf(className) === index;\n}).join(\" \").trim();\nconst hasA11yProp = (props) => {\n  for (const prop in props) {\n    if (prop.startsWith(\"aria-\") || prop === \"role\" || prop === \"title\") {\n      return true;\n    }\n  }\n};\n\nexport { hasA11yProp, mergeClasses, toCamelCase, toKebabCase, toPascalCase };\n//# sourceMappingURL=utils.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nvar defaultAttributes = {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  width: 24,\n  height: 24,\n  viewBox: \"0 0 24 24\",\n  fill: \"none\",\n  stroke: \"currentColor\",\n  strokeWidth: 2,\n  strokeLinecap: \"round\",\n  strokeLinejoin: \"round\"\n};\n\nexport { defaultAttributes as default };\n//# sourceMappingURL=defaultAttributes.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport { forwardRef, createElement } from 'react';\nimport defaultAttributes from './defaultAttributes.js';\nimport { mergeClasses, hasA11yProp } from './shared/src/utils.js';\n\nconst Icon = forwardRef(\n  ({\n    color = \"currentColor\",\n    size = 24,\n    strokeWidth = 2,\n    absoluteStrokeWidth,\n    className = \"\",\n    children,\n    iconNode,\n    ...rest\n  }, ref) => createElement(\n    \"svg\",\n    {\n      ref,\n      ...defaultAttributes,\n      width: size,\n      height: size,\n      stroke: color,\n      strokeWidth: absoluteStrokeWidth ? Number(strokeWidth) * 24 / Number(size) : strokeWidth,\n      className: mergeClasses(\"lucide\", className),\n      ...!children && !hasA11yProp(rest) && { \"aria-hidden\": \"true\" },\n      ...rest\n    },\n    [\n      ...iconNode.map(([tag, attrs]) => createElement(tag, attrs)),\n      ...Array.isArray(children) ? children : [children]\n    ]\n  )\n);\n\nexport { Icon as default };\n//# sourceMappingURL=Icon.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport { forwardRef, createElement } from 'react';\nimport { mergeClasses, toKebabCase, toPascalCase } from './shared/src/utils.js';\nimport Icon from './Icon.js';\n\nconst createLucideIcon = (iconName, iconNode) => {\n  const Component = forwardRef(\n    ({ className, ...props }, ref) => createElement(Icon, {\n      ref,\n      iconNode,\n      className: mergeClasses(\n        `lucide-${toKebabCase(toPascalCase(iconName))}`,\n        `lucide-${iconName}`,\n        className\n      ),\n      ...props\n    })\n  );\n  Component.displayName = toPascalCase(iconName);\n  return Component;\n};\n\nexport { createLucideIcon as default };\n//# sourceMappingURL=createLucideIcon.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 5v14\", key: \"s699le\" }],\n  [\"path\", { d: \"m19 12-7 7-7-7\", key: \"1idqje\" }]\n];\nconst ArrowDown = createLucideIcon(\"arrow-down\", __iconNode);\n\nexport { __iconNode, ArrowDown as default };\n//# sourceMappingURL=arrow-down.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m12 19-7-7 7-7\", key: \"1l729n\" }],\n  [\"path\", { d: \"M19 12H5\", key: \"x3x0zl\" }]\n];\nconst ArrowLeft = createLucideIcon(\"arrow-left\", __iconNode);\n\nexport { __iconNode, ArrowLeft as default };\n//# sourceMappingURL=arrow-left.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M5 12h14\", key: \"1ays0h\" }],\n  [\"path\", { d: \"m12 5 7 7-7 7\", key: \"xquz4c\" }]\n];\nconst ArrowRight = createLucideIcon(\"arrow-right\", __iconNode);\n\nexport { __iconNode, ArrowRight as default };\n//# sourceMappingURL=arrow-right.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m5 12 7-7 7 7\", key: \"hav0vg\" }],\n  [\"path\", { d: \"M12 19V5\", key: \"x0mq9r\" }]\n];\nconst ArrowUp = createLucideIcon(\"arrow-up\", __iconNode);\n\nexport { __iconNode, ArrowUp as default };\n//# sourceMappingURL=arrow-up.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [[\"path\", { d: \"m15 18-6-6 6-6\", key: \"1wnfg3\" }]];\nconst ChevronLeft = createLucideIcon(\"chevron-left\", __iconNode);\n\nexport { __iconNode, ChevronLeft as default };\n//# sourceMappingURL=chevron-left.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [[\"path\", { d: \"m9 18 6-6-6-6\", key: \"mthhwq\" }]];\nconst ChevronRight = createLucideIcon(\"chevron-right\", __iconNode);\n\nexport { __iconNode, ChevronRight as default };\n//# sourceMappingURL=chevron-right.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z\", key: \"1rqfz7\" }],\n  [\"path\", { d: \"M14 2v4a2 2 0 0 0 2 2h4\", key: \"tnqrlb\" }],\n  [\"path\", { d: \"m9 15 2 2 4-4\", key: \"1grp1n\" }]\n];\nconst FileCheck = createLucideIcon(\"file-check\", __iconNode);\n\nexport { __iconNode, FileCheck as default };\n//# sourceMappingURL=file-check.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z\", key: \"1rqfz7\" }],\n  [\"path\", { d: \"M14 2v4a2 2 0 0 0 2 2h4\", key: \"tnqrlb\" }],\n  [\"path\", { d: \"M10 9H8\", key: \"b1mrlr\" }],\n  [\"path\", { d: \"M16 13H8\", key: \"t4e002\" }],\n  [\"path\", { d: \"M16 17H8\", key: \"z1uh3a\" }]\n];\nconst FileText = createLucideIcon(\"file-text\", __iconNode);\n\nexport { __iconNode, FileText as default };\n//# sourceMappingURL=file-text.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"line\", { x1: \"4\", x2: \"20\", y1: \"9\", y2: \"9\", key: \"4lhtct\" }],\n  [\"line\", { x1: \"4\", x2: \"20\", y1: \"15\", y2: \"15\", key: \"vyu0kd\" }],\n  [\"line\", { x1: \"10\", x2: \"8\", y1: \"3\", y2: \"21\", key: \"1ggp8o\" }],\n  [\"line\", { x1: \"16\", x2: \"14\", y1: \"3\", y2: \"21\", key: \"weycgp\" }]\n];\nconst Hash = createLucideIcon(\"hash\", __iconNode);\n\nexport { __iconNode, Hash as default };\n//# sourceMappingURL=hash.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M4 12h8\", key: \"17cfdx\" }],\n  [\"path\", { d: \"M4 18V6\", key: \"1rz3zl\" }],\n  [\"path\", { d: \"M12 18V6\", key: \"zqpxq5\" }],\n  [\"path\", { d: \"m17 12 3-2v8\", key: \"1hhhft\" }]\n];\nconst Heading1 = createLucideIcon(\"heading-1\", __iconNode);\n\nexport { __iconNode, Heading1 as default };\n//# sourceMappingURL=heading-1.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M4 12h8\", key: \"17cfdx\" }],\n  [\"path\", { d: \"M4 18V6\", key: \"1rz3zl\" }],\n  [\"path\", { d: \"M12 18V6\", key: \"zqpxq5\" }],\n  [\"path\", { d: \"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1\", key: \"9jr5yi\" }]\n];\nconst Heading2 = createLucideIcon(\"heading-2\", __iconNode);\n\nexport { __iconNode, Heading2 as default };\n//# sourceMappingURL=heading-2.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M4 12h8\", key: \"17cfdx\" }],\n  [\"path\", { d: \"M4 18V6\", key: \"1rz3zl\" }],\n  [\"path\", { d: \"M12 18V6\", key: \"zqpxq5\" }],\n  [\"path\", { d: \"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2\", key: \"68ncm8\" }],\n  [\"path\", { d: \"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2\", key: \"1ejuhz\" }]\n];\nconst Heading3 = createLucideIcon(\"heading-3\", __iconNode);\n\nexport { __iconNode, Heading3 as default };\n//# sourceMappingURL=heading-3.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 3h5v5\", key: \"1806ms\" }],\n  [\"path\", { d: \"M17 21h2a2 2 0 0 0 2-2\", key: \"130fy9\" }],\n  [\"path\", { d: \"M21 12v3\", key: \"1wzk3p\" }],\n  [\"path\", { d: \"m21 3-5 5\", key: \"1g5oa7\" }],\n  [\"path\", { d: \"M3 7V5a2 2 0 0 1 2-2\", key: \"kk3yz1\" }],\n  [\"path\", { d: \"m5 21 4.144-4.144a1.21 1.21 0 0 1 1.712 0L13 19\", key: \"fyekpt\" }],\n  [\"path\", { d: \"M9 3h3\", key: \"d52fa\" }],\n  [\"rect\", { x: \"3\", y: \"11\", width: \"10\", height: \"10\", rx: \"1\", key: \"1wpmix\" }]\n];\nconst ImageUpscale = createLucideIcon(\"image-upscale\", __iconNode);\n\nexport { __iconNode, ImageUpscale as default };\n//# sourceMappingURL=image-upscale.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 5h.01\", key: \"18ugdj\" }],\n  [\"path\", { d: \"M3 12h.01\", key: \"nlz23k\" }],\n  [\"path\", { d: \"M3 19h.01\", key: \"noohij\" }],\n  [\"path\", { d: \"M8 5h13\", key: \"1pao27\" }],\n  [\"path\", { d: \"M8 12h13\", key: \"1za7za\" }],\n  [\"path\", { d: \"M8 19h13\", key: \"m83p4d\" }]\n];\nconst List = createLucideIcon(\"list\", __iconNode);\n\nexport { __iconNode, List as default };\n//# sourceMappingURL=list.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z\",\n      key: \"e79jfc\"\n    }\n  ],\n  [\"circle\", { cx: \"13.5\", cy: \"6.5\", r: \".5\", fill: \"currentColor\", key: \"1okk4w\" }],\n  [\"circle\", { cx: \"17.5\", cy: \"10.5\", r: \".5\", fill: \"currentColor\", key: \"f64h9f\" }],\n  [\"circle\", { cx: \"6.5\", cy: \"12.5\", r: \".5\", fill: \"currentColor\", key: \"qy21gx\" }],\n  [\"circle\", { cx: \"8.5\", cy: \"7.5\", r: \".5\", fill: \"currentColor\", key: \"fotxhn\" }]\n];\nconst Palette = createLucideIcon(\"palette\", __iconNode);\n\nexport { __iconNode, Palette as default };\n//# sourceMappingURL=palette.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M5 12h14\", key: \"1ays0h\" }],\n  [\"path\", { d: \"M12 5v14\", key: \"s699le\" }]\n];\nconst Plus = createLucideIcon(\"plus\", __iconNode);\n\nexport { __iconNode, Plus as default };\n//# sourceMappingURL=plus.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\", key: \"1m0v6g\" }],\n  [\"path\", { d: \"M14 15H9v-5\", key: \"pi4jk9\" }],\n  [\"path\", { d: \"M16 3h5v5\", key: \"1806ms\" }],\n  [\"path\", { d: \"M21 3 9 15\", key: \"15kdhq\" }]\n];\nconst Scaling = createLucideIcon(\"scaling\", __iconNode);\n\nexport { __iconNode, Scaling as default };\n//# sourceMappingURL=scaling.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915\",\n      key: \"1i5ecw\"\n    }\n  ],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"3\", key: \"1v7zrd\" }]\n];\nconst Settings = createLucideIcon(\"settings\", __iconNode);\n\nexport { __iconNode, Settings as default };\n//# sourceMappingURL=settings.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M21 5H3\", key: \"1fi0y6\" }],\n  [\"path\", { d: \"M17 12H7\", key: \"16if0g\" }],\n  [\"path\", { d: \"M19 19H5\", key: \"vjpgq2\" }]\n];\nconst TextAlignCenter = createLucideIcon(\"text-align-center\", __iconNode);\n\nexport { __iconNode, TextAlignCenter as default };\n//# sourceMappingURL=text-align-center.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M21 5H3\", key: \"1fi0y6\" }],\n  [\"path\", { d: \"M21 12H9\", key: \"dn1m92\" }],\n  [\"path\", { d: \"M21 19H7\", key: \"4cu937\" }]\n];\nconst TextAlignEnd = createLucideIcon(\"text-align-end\", __iconNode);\n\nexport { __iconNode, TextAlignEnd as default };\n//# sourceMappingURL=text-align-end.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M21 5H3\", key: \"1fi0y6\" }],\n  [\"path\", { d: \"M15 12H3\", key: \"6jk70r\" }],\n  [\"path\", { d: \"M17 19H3\", key: \"z6ezky\" }]\n];\nconst TextAlignStart = createLucideIcon(\"text-align-start\", __iconNode);\n\nexport { __iconNode, TextAlignStart as default };\n//# sourceMappingURL=text-align-start.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M10 11v6\", key: \"nco0om\" }],\n  [\"path\", { d: \"M14 11v6\", key: \"outv1u\" }],\n  [\"path\", { d: \"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6\", key: \"miytrc\" }],\n  [\"path\", { d: \"M3 6h18\", key: \"d0wm0j\" }],\n  [\"path\", { d: \"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\", key: \"e791ji\" }]\n];\nconst Trash2 = createLucideIcon(\"trash-2\", __iconNode);\n\nexport { __iconNode, Trash2 as default };\n//# sourceMappingURL=trash-2.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M18 6 6 18\", key: \"1bl5f8\" }],\n  [\"path\", { d: \"m6 6 12 12\", key: \"d8bk6v\" }]\n];\nconst X = createLucideIcon(\"x\", __iconNode);\n\nexport { __iconNode, X as default };\n//# sourceMappingURL=x.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"11\", cy: \"11\", r: \"8\", key: \"4ej97u\" }],\n  [\"line\", { x1: \"21\", x2: \"16.65\", y1: \"21\", y2: \"16.65\", key: \"13gj7c\" }],\n  [\"line\", { x1: \"11\", x2: \"11\", y1: \"8\", y2: \"14\", key: \"1vmskp\" }],\n  [\"line\", { x1: \"8\", x2: \"14\", y1: \"11\", y2: \"11\", key: \"durymu\" }]\n];\nconst ZoomIn = createLucideIcon(\"zoom-in\", __iconNode);\n\nexport { __iconNode, ZoomIn as default };\n//# sourceMappingURL=zoom-in.js.map\n","/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"11\", cy: \"11\", r: \"8\", key: \"4ej97u\" }],\n  [\"line\", { x1: \"21\", x2: \"16.65\", y1: \"21\", y2: \"16.65\", key: \"13gj7c\" }],\n  [\"line\", { x1: \"8\", x2: \"14\", y1: \"11\", y2: \"11\", key: \"durymu\" }]\n];\nconst ZoomOut = createLucideIcon(\"zoom-out\", __iconNode);\n\nexport { __iconNode, ZoomOut as default };\n//# sourceMappingURL=zoom-out.js.map\n","import React, { useState, useEffect, useMemo } from 'react';\r\nimport { useDocumentState } from '../../context/DocumentContext';\r\nimport { \r\n  FileText, \r\n  Hash, \r\n  FileCheck, \r\n  ChevronLeft, \r\n  ChevronRight,\r\n  Heading1,\r\n  Heading2,\r\n  Heading3,\r\n  List\r\n} from 'lucide-react';\r\nimport './Sidebar.css';\r\n\r\n/**\r\n * Extracts headings from HTML content\r\n * @param {string} htmlContent - The HTML content to parse\r\n * @param {number|null} pageNumber - The page number for headings, or null for continuous mode\r\n * @param {string} prefix - Prefix for heading IDs\r\n * @returns {Array} Array of heading objects\r\n */\r\nconst extractHeadings = (htmlContent, pageNumber, prefix = '') => {\r\n  if (!htmlContent) return [];\r\n  \r\n  const tempDiv = document.createElement('div');\r\n  tempDiv.innerHTML = htmlContent;\r\n  const headingElements = tempDiv.querySelectorAll('h1, h2, h3, h4, h5, h6');\r\n  \r\n  return Array.from(headingElements).map((heading, index) => {\r\n    const level = parseInt(heading.tagName.charAt(1));\r\n    const text = heading.textContent.trim();\r\n    return text ? {\r\n      id: `${prefix}heading-${index}`,\r\n      level,\r\n      text,\r\n      page: pageNumber || 1\r\n    } : null;\r\n  }).filter(Boolean);\r\n};\r\n\r\n/**\r\n * Calculates word count from HTML content\r\n * @param {string} htmlContent - The HTML content to parse\r\n * @returns {number} Word count\r\n */\r\nconst calculateWordCount = (htmlContent) => {\r\n  if (!htmlContent) return 0;\r\n  \r\n  const tempDiv = document.createElement('div');\r\n  tempDiv.innerHTML = htmlContent;\r\n  const text = tempDiv.textContent || tempDiv.innerText || '';\r\n  return text.trim().split(/\\s+/).filter(word => word.length > 0).length;\r\n};\r\n\r\n/**\r\n * Sidebar Component\r\n * Displays document information, outline, and word count\r\n * @param {Object} props\r\n * @param {boolean} props.isCollapsed - Whether sidebar is collapsed\r\n * @param {Function} props.onToggle - Callback for collapse toggle\r\n * @param {number} props.wordCount - Optional word count (for continuous mode)\r\n * @param {number} props.pageCount - Optional page count (for continuous mode)\r\n */\r\nexport const Sidebar = ({ isCollapsed, onToggle, wordCount: propWordCount, pageCount: propPageCount }) => {\r\n  const documentState = useDocumentState();\r\n  const { pages, activePage, continuousContent } = documentState;\r\n\r\n  // Memoize word count and outline calculations for better performance\r\n  const { wordCount, outline } = useMemo(() => {\r\n    // Use prop values if provided (continuous mode)\r\n    if (propWordCount !== undefined && propPageCount !== undefined) {\r\n      return {\r\n        wordCount: propWordCount,\r\n        outline: extractHeadings(continuousContent, 1, 'continuous-')\r\n      };\r\n    }\r\n\r\n    // Paged mode: Calculate from pages array\r\n    let totalWords = 0;\r\n    const headings = [];\r\n\r\n    pages.forEach((page, pageIndex) => {\r\n      totalWords += calculateWordCount(page.content);\r\n      headings.push(...extractHeadings(page.content, pageIndex + 1, `page-${pageIndex}-`));\r\n    });\r\n\r\n    return { wordCount: totalWords, outline: headings };\r\n  }, [pages, propWordCount, propPageCount, continuousContent]);\r\n\r\n  const displayPageCount = propPageCount !== undefined ? propPageCount : pages.length;\r\n\r\n  return (\r\n    <aside \r\n      className={`sidebar ${isCollapsed ? 'collapsed' : ''}`} \r\n      role=\"complementary\"\r\n      aria-label=\"Document information\"\r\n      data-testid=\"sidebar\"\r\n    >\r\n      <div className=\"sidebar-header\">\r\n        <div className=\"sidebar-title\">\r\n          <FileText size={18} />\r\n          <h2>Document Info</h2>\r\n        </div>\r\n        <button\r\n          className=\"sidebar-toggle\"\r\n          onClick={onToggle}\r\n          aria-label={isCollapsed ? \"Expand sidebar\" : \"Collapse sidebar\"}\r\n          title={isCollapsed ? \"Expand sidebar\" : \"Collapse sidebar\"}\r\n        >\r\n          {isCollapsed ? <ChevronRight size={16} /> : <ChevronLeft size={16} />}\r\n        </button>\r\n      </div>\r\n\r\n      {!isCollapsed && (\r\n        <div className=\"sidebar-content\">\r\n          <div className=\"sidebar-section\">\r\n            <h3>Statistics</h3>\r\n            <div className=\"stat-item\">\r\n              <div className=\"stat-label\">\r\n                <FileCheck size={14} />\r\n                <span>Pages:</span>\r\n              </div>\r\n              <span className=\"stat-value\">{displayPageCount}</span>\r\n            </div>\r\n            <div className=\"stat-item\" data-testid=\"word-count\">\r\n              <div className=\"stat-label\">\r\n                <Hash size={14} />\r\n                <span>Words:</span>\r\n              </div>\r\n              <span className=\"stat-value\">{wordCount.toLocaleString()}</span>\r\n            </div>\r\n            <div className=\"stat-item\">\r\n              <div className=\"stat-label\">\r\n                <FileText size={14} />\r\n                <span>Active Page:</span>\r\n              </div>\r\n              <span className=\"stat-value\">{activePage + 1}</span>\r\n            </div>\r\n          </div>\r\n\r\n          {outline.length > 0 && (\r\n            <div className=\"sidebar-section\">\r\n              <h3>\r\n                <List size={14} style={{ display: 'inline-block', marginRight: '6px', verticalAlign: 'middle' }} />\r\n                Document Outline\r\n              </h3>\r\n              <div className=\"document-outline\" data-testid=\"outline\">\r\n                {outline.map((heading) => {\r\n                  const HeadingIcon = heading.level === 1 ? Heading1 : heading.level === 2 ? Heading2 : Heading3;\r\n                  return (\r\n                    <div \r\n                      key={heading.id}\r\n                      className={`outline-item outline-level-${heading.level}`}\r\n                      style={{ marginLeft: `${(heading.level - 1) * 12}px` }}\r\n                    >\r\n                      <HeadingIcon size={12} className=\"outline-icon\" />\r\n                      <span className=\"outline-text\">{heading.text}</span>\r\n                      <span className=\"outline-page\">p.{heading.page}</span>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </aside>\r\n  );\r\n};\r\n\r\nexport default Sidebar;\r\n","// Inline SVG icons to replace lucide-react dependency\r\n// These are simplified versions of the lucide-react icons\r\n\r\nexport const Bold = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <path d=\"M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z\"/>\r\n    <path d=\"M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z\"/>\r\n  </svg>\r\n);\r\n\r\nexport const Italic = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <line x1=\"19\" y1=\"4\" x2=\"10\" y2=\"4\"/>\r\n    <line x1=\"14\" y1=\"20\" x2=\"5\" y2=\"20\"/>\r\n    <line x1=\"15\" y1=\"4\" x2=\"9\" y2=\"20\"/>\r\n  </svg>\r\n);\r\n\r\nexport const Underline = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <path d=\"M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3\"/>\r\n    <line x1=\"4\" y1=\"21\" x2=\"20\" y2=\"21\"/>\r\n  </svg>\r\n);\r\n\r\nexport const Strikethrough = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <path d=\"M16 4H9a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h7\"/>\r\n    <path d=\"M14 4H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h7\"/>\r\n    <line x1=\"4\" y1=\"12\" x2=\"20\" y2=\"12\"/>\r\n  </svg>\r\n);\r\n\r\nexport const AlignLeft = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <line x1=\"21\" y1=\"6\" x2=\"3\" y2=\"6\"/>\r\n    <line x1=\"15\" y1=\"12\" x2=\"3\" y2=\"12\"/>\r\n    <line x1=\"17\" y1=\"18\" x2=\"3\" y2=\"18\"/>\r\n  </svg>\r\n);\r\n\r\nexport const AlignCenter = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <line x1=\"21\" y1=\"6\" x2=\"3\" y2=\"6\"/>\r\n    <line x1=\"17\" y1=\"12\" x2=\"7\" y2=\"12\"/>\r\n    <line x1=\"19\" y1=\"18\" x2=\"5\" y2=\"18\"/>\r\n  </svg>\r\n);\r\n\r\nexport const AlignRight = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <line x1=\"21\" y1=\"6\" x2=\"3\" y2=\"6\"/>\r\n    <line x1=\"21\" y1=\"12\" x2=\"9\" y2=\"12\"/>\r\n    <line x1=\"21\" y1=\"18\" x2=\"7\" y2=\"18\"/>\r\n  </svg>\r\n);\r\n\r\nexport const AlignJustify = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <line x1=\"21\" y1=\"6\" x2=\"3\" y2=\"6\"/>\r\n    <line x1=\"21\" y1=\"12\" x2=\"3\" y2=\"12\"/>\r\n    <line x1=\"21\" y1=\"18\" x2=\"3\" y2=\"18\"/>\r\n  </svg>\r\n);\r\n\r\nexport const List = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <line x1=\"8\" y1=\"6\" x2=\"21\" y2=\"6\"/>\r\n    <line x1=\"8\" y1=\"12\" x2=\"21\" y2=\"12\"/>\r\n    <line x1=\"8\" y1=\"18\" x2=\"21\" y2=\"18\"/>\r\n    <line x1=\"3\" y1=\"6\" x2=\"3.01\" y2=\"6\"/>\r\n    <line x1=\"3\" y1=\"12\" x2=\"3.01\" y2=\"12\"/>\r\n    <line x1=\"3\" y1=\"18\" x2=\"3.01\" y2=\"18\"/>\r\n  </svg>\r\n);\r\n\r\nexport const ListOrdered = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <line x1=\"10\" y1=\"6\" x2=\"21\" y2=\"6\"/>\r\n    <line x1=\"10\" y1=\"12\" x2=\"21\" y2=\"12\"/>\r\n    <line x1=\"10\" y1=\"18\" x2=\"21\" y2=\"18\"/>\r\n    <path d=\"M4 6h1.5\"/>\r\n    <path d=\"M4 12h1.5\"/>\r\n    <path d=\"M4 18h1.5\"/>\r\n    <path d=\"M6 6v0\"/>\r\n    <path d=\"M6 12v0\"/>\r\n    <path d=\"M6 18v0\"/>\r\n  </svg>\r\n);\r\n\r\nexport const Link = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"/>\r\n    <path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"/>\r\n  </svg>\r\n);\r\n\r\nexport const Table = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <path d=\"M3 6h18\"/>\r\n    <path d=\"M3 10h18\"/>\r\n    <path d=\"M3 14h18\"/>\r\n    <path d=\"M3 18h18\"/>\r\n    <path d=\"M9 6v12\"/>\r\n    <path d=\"M15 6v12\"/>\r\n  </svg>\r\n);\r\n\r\nexport const FileText = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <path d=\"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z\"/>\r\n    <polyline points=\"14,2 14,8 20,8\"/>\r\n    <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"/>\r\n    <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"/>\r\n    <line x1=\"10\" y1=\"9\" x2=\"8\" y2=\"9\"/>\r\n  </svg>\r\n);\r\n\r\nexport const Undo = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <path d=\"M3 7v6h6\"/>\r\n    <path d=\"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13\"/>\r\n  </svg>\r\n);\r\n\r\nexport const Redo = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <path d=\"M21 7v6h-6\"/>\r\n    <path d=\"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3L21 13\"/>\r\n  </svg>\r\n);\r\n\r\nexport const Image = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"/>\r\n    <circle cx=\"9\" cy=\"9\" r=\"2\"/>\r\n    <path d=\"M21 15l-3.086-3.086a2 2 0 0 0-2.828 0L6 21\"/>\r\n  </svg>\r\n);\r\n\r\nexport const Indent = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <polyline points=\"3,8 7,12 3,16\"/>\r\n    <line x1=\"21\" y1=\"12\" x2=\"11\" y2=\"12\"/>\r\n    <line x1=\"21\" y1=\"6\" x2=\"11\" y2=\"6\"/>\r\n    <line x1=\"21\" y1=\"18\" x2=\"11\" y2=\"18\"/>\r\n  </svg>\r\n);\r\n\r\nexport const Outdent = ({ size = 16, ...props }) => (\r\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\r\n    <polyline points=\"7,8 3,12 7,16\"/>\r\n    <line x1=\"21\" y1=\"12\" x2=\"11\" y2=\"12\"/>\r\n    <line x1=\"21\" y1=\"6\" x2=\"11\" y2=\"6\"/>\r\n    <line x1=\"21\" y1=\"18\" x2=\"11\" y2=\"18\"/>\r\n  </svg>\r\n);","/**\r\n * Logger utility for the editor\r\n * Provides consistent logging across the application\r\n * Disabled in production for performance\r\n */\r\n\r\nconst isDevelopment = import.meta.env.MODE === 'development';\r\n\r\n/**\r\n * Logger class for structured logging\r\n */\r\nclass Logger {\r\n  constructor(namespace = 'Editor') {\r\n    this.namespace = namespace;\r\n  }\r\n\r\n  /**\r\n   * Formats log message with namespace\r\n   * @param {string} level - Log level\r\n   * @param {string} message - Log message\r\n   * @param {any} data - Optional data to log\r\n   * @returns {string} Formatted message\r\n   */\r\n  _format(level, message, data) {\r\n    const timestamp = new Date().toISOString();\r\n    return `[${timestamp}] [${this.namespace}] [${level}] ${message}`;\r\n  }\r\n\r\n  /**\r\n   * Info level logging\r\n   * @param {string} message - Info message\r\n   * @param {any} data - Optional data\r\n   */\r\n  info(message, data) {\r\n    if (!isDevelopment) return;\r\n    \r\n    console.log(this._format('INFO', message));\r\n    if (data) console.log(data);\r\n  }\r\n\r\n  /**\r\n   * Warning level logging\r\n   * @param {string} message - Warning message\r\n   * @param {any} data - Optional data\r\n   */\r\n  warn(message, data) {\r\n    if (!isDevelopment) return;\r\n    \r\n    console.warn(this._format('WARN', message));\r\n    if (data) console.warn(data);\r\n  }\r\n\r\n  /**\r\n   * Error level logging\r\n   * @param {string} message - Error message\r\n   * @param {Error|any} error - Error object or data\r\n   */\r\n  error(message, error) {\r\n    if (!isDevelopment) return;\r\n    \r\n    console.error(this._format('ERROR', message));\r\n    if (error) {\r\n      if (error instanceof Error) {\r\n        console.error(error.message);\r\n        console.error(error.stack);\r\n      } else {\r\n        console.error(error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Debug level logging\r\n   * @param {string} message - Debug message\r\n   * @param {any} data - Optional data\r\n   */\r\n  debug(message, data) {\r\n    if (!isDevelopment) return;\r\n    \r\n    console.debug(this._format('DEBUG', message));\r\n    if (data) console.debug(data);\r\n  }\r\n}\r\n\r\n// Create default logger instance\r\nexport const logger = new Logger('Editor');\r\n\r\n// Export Logger class for custom instances\r\nexport default Logger;\r\n","/**\r\n * Indentation utilities for contenteditable editor\r\n * Handles tab indentation for selected text similar to Microsoft Word\r\n */\r\n\r\n/**\r\n * Set of block-level tags we treat as indentation targets.\r\n */\r\nconst BLOCK_TAGS = new Set(['P', 'DIV', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'LI', 'BLOCKQUOTE', 'PRE', 'TABLE']);\r\nconst LIST_INDENT_STEP = 32; // px per indent level for lists\r\n\r\n/**\r\n * Adjusts inline margin for block element indentation, tracking level in data attribute.\r\n * @param {Element} block\r\n * @param {boolean} isOutdent\r\n */\r\nfunction adjustBlockIndentation(block, isOutdent) {\r\n  if (!block) return;\r\n\r\n  if (!block.dataset) {\r\n    block.dataset = {};\r\n  }\r\n  if (!block.style) {\r\n    block.style = {};\r\n  }\r\n\r\n  const currentLevel = parseInt(block.dataset.indentLevel || '0', 10);\r\n  const nextLevel = Math.max(0, isOutdent ? currentLevel - 1 : currentLevel + 1);\r\n\r\n  if (nextLevel === 0) {\r\n    block.style.marginLeft = '';\r\n    delete block.dataset.indentLevel;\r\n  } else {\r\n    block.style.marginLeft = `${nextLevel * LIST_INDENT_STEP}px`;\r\n    block.dataset.indentLevel = String(nextLevel);\r\n  }\r\n}\r\n\r\n/**\r\n * Adjust inline margin for list indentation, tracking level in data attribute.\r\n * @param {Element} listItem\r\n * @param {boolean} isOutdent\r\n */\r\nfunction adjustListIndentation(listItem, isOutdent) {\r\n  adjustBlockIndentation(listItem, isOutdent);\r\n}\r\n\r\n/**\r\n * Walks up the DOM tree to find the closest block element ancestor.\r\n * @param {Node} node\r\n * @returns {Element|null}\r\n */\r\nfunction findClosestBlockElement(node) {\r\n  let current = node;\r\n  while (current) {\r\n    if (current.nodeType === 1 && current.tagName && BLOCK_TAGS.has(current.tagName.toUpperCase())) {\r\n      return current;\r\n    }\r\n    current = current.parentElement || current.parentNode;\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Gets all block elements (paragraphs) that intersect with the current selection\r\n * @returns {Element[]} Array of block elements in the selection\r\n */\r\nfunction getSelectedBlocks() {\r\n  const selection = window.getSelection();\r\n  if (!selection || selection.rangeCount === 0) return [];\r\n\r\n  const range = selection.getRangeAt(0);\r\n  const blocks = new Set();\r\n\r\n  // Find the contenteditable container\r\n  let container = range.commonAncestorContainer;\r\n  if (container.nodeType === Node.TEXT_NODE) {\r\n    container = container.parentElement;\r\n  }\r\n  while (container && container.contentEditable !== 'true') {\r\n    container = container.parentElement;\r\n  }\r\n  if (!container) return [];\r\n\r\n  // Get all block elements in the container\r\n  const allBlocks = container.querySelectorAll('p, div, h1, h2, h3, h4, h5, h6, li, blockquote, pre, table');\r\n\r\n  // Find blocks that intersect with the selection\r\n  allBlocks.forEach(block => {\r\n    const blockRange = document.createRange();\r\n    blockRange.selectNodeContents(block);\r\n\r\n    if (range.intersectsNode(block)) {\r\n      blocks.add(block);\r\n    }\r\n  });\r\n\r\n  // If no blocks found but there are images in the selection, find their containers\r\n  if (blocks.size === 0) {\r\n    const images = container.querySelectorAll('img');\r\n    images.forEach(img => {\r\n      const imgRange = document.createRange();\r\n      imgRange.selectNode(img);\r\n\r\n      if (range.intersectsNode(img)) {\r\n        // Find the containing block element\r\n        let parent = img.parentElement;\r\n        while (parent && parent !== container) {\r\n          if (parent.tagName && BLOCK_TAGS.has(parent.tagName.toUpperCase())) {\r\n            blocks.add(parent);\r\n            break;\r\n          }\r\n          parent = parent.parentElement;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  const uniqueBlocks = Array.from(blocks).filter(block => {\r\n    let parent = block.parentElement;\r\n    while (parent) {\r\n      if (blocks.has(parent)) {\r\n        return false;\r\n      }\r\n      parent = parent.parentElement;\r\n    }\r\n    return true;\r\n  });\r\n\r\n  return uniqueBlocks;\r\n}\r\n\r\n/**\r\n * Removes leading indentation (&nbsp;&nbsp;&nbsp;&nbsp;) from a block element or reduces margin-left\r\n * Handles cases where indentation might be inside formatted text or stored as margin-left\r\n * @param {Element} block - The block element to outdent\r\n */\r\nfunction removeLeadingIndentation(block) {\r\n  // First check if block has margin-left indentation (new approach)\r\n  if (block.style && block.style.marginLeft && block.style.marginLeft !== '') {\r\n    const currentLevel = parseInt(block.dataset.indentLevel || '0', 10);\r\n    const nextLevel = Math.max(0, currentLevel - 1);\r\n    if (nextLevel === 0) {\r\n      block.style.marginLeft = '';\r\n      delete block.dataset.indentLevel;\r\n    } else {\r\n      block.style.marginLeft = `${nextLevel * LIST_INDENT_STEP}px`;\r\n      block.dataset.indentLevel = String(nextLevel);\r\n    }\r\n    return;\r\n  }\r\n\r\n  // Fallback to old &nbsp; approach for backward compatibility\r\n  // First try to remove from innerHTML if it's at the start (for backward compatibility and tests)\r\n  if (block.innerHTML.startsWith('&nbsp;&nbsp;&nbsp;&nbsp;')) {\r\n    block.innerHTML = block.innerHTML.replace(/^(&nbsp;){4}/, '');\r\n    return;\r\n  }\r\n\r\n  // If not at the start of innerHTML, try to find it in text nodes\r\n  try {\r\n    // Walk through all text nodes in the block\r\n    const walker = document.createTreeWalker(\r\n      block,\r\n      NodeFilter.SHOW_TEXT,\r\n      null\r\n    );\r\n\r\n    let node = walker.nextNode();\r\n    while (node) {\r\n      // Check if this text node starts with indentation\r\n      const text = node.textContent;\r\n      if (text.startsWith('\\u00A0\\u00A0\\u00A0\\u00A0')) { // \\u00A0 is non-breaking space\r\n        node.textContent = text.substring(4);\r\n        break; // Only remove from the first text node that has indentation\r\n      }\r\n      node = walker.nextNode();\r\n    }\r\n  } catch (error) {\r\n    // Fallback for environments without createTreeWalker (like tests)\r\n    // Try regex replacement on innerHTML\r\n    block.innerHTML = block.innerHTML.replace(/^(&nbsp;){4}/, '');\r\n  }\r\n}\r\n\r\n/**\r\n * Indents or outdents selected paragraphs\r\n * @param {boolean} isOutdent - Whether to outdent (true) or indent (false)\r\n * @returns {boolean} True if operation was performed, false otherwise\r\n */\r\nexport function indentSelectedBlocks(isOutdent = false) {\r\n  const selection = window.getSelection();\r\n  if (!selection || selection.rangeCount === 0) return false;\r\n\r\n  let blocks = getSelectedBlocks();\r\n  const range = selection.getRangeAt(0);\r\n\r\n  if (blocks.length === 0) {\r\n    const fallbackBlock = findClosestBlockElement(range.startContainer);\r\n    if (!fallbackBlock) return false;\r\n    blocks = [fallbackBlock];\r\n  }\r\n\r\n  // Save the position of the selection relative to the container\r\n  const firstBlock = blocks[0];\r\n  const lastBlock = blocks[blocks.length - 1];\r\n\r\n  // Modify the blocks\r\n  blocks.forEach(block => {\r\n    const tagName = block.tagName ? block.tagName.toUpperCase() : '';\r\n\r\n    if (tagName === 'LI') {\r\n      adjustListIndentation(block, isOutdent);\r\n      return;\r\n    }\r\n\r\n    // For all other block elements, use margin-left approach\r\n    if (isOutdent) {\r\n      // For outdent, remove leading indentation from text content or reduce margin\r\n      removeLeadingIndentation(block);\r\n    } else {\r\n      // For indent, add indentation using margin-left\r\n      adjustBlockIndentation(block, false);\r\n    }\r\n  });\r\n\r\n  // Restore selection by recreating range with the same blocks\r\n  // Since we only modified innerHTML, the block elements themselves are still valid\r\n  try {\r\n    const newRange = document.createRange();\r\n    \r\n    // Helper function to get the deepest first text node\r\n    const getFirstTextNode = (element) => {\r\n      if (element.nodeType === Node.TEXT_NODE) {\r\n        return element;\r\n      }\r\n      \r\n      const walker = document.createTreeWalker(\r\n        element,\r\n        NodeFilter.SHOW_TEXT,\r\n        null\r\n      );\r\n      return walker.nextNode();\r\n    };\r\n    \r\n    // Helper function to get the deepest last text node\r\n    const getLastTextNode = (element) => {\r\n      if (element.nodeType === Node.TEXT_NODE) {\r\n        return element;\r\n      }\r\n      \r\n      const walker = document.createTreeWalker(\r\n        element,\r\n        NodeFilter.SHOW_TEXT,\r\n        null\r\n      );\r\n      \r\n      let lastNode = null;\r\n      let currentNode = walker.nextNode();\r\n      while (currentNode) {\r\n        lastNode = currentNode;\r\n        currentNode = walker.nextNode();\r\n      }\r\n      return lastNode;\r\n    };\r\n    \r\n    // Set start of selection\r\n    const firstTextNode = getFirstTextNode(firstBlock);\r\n    if (firstTextNode) {\r\n      newRange.setStart(firstTextNode, 0);\r\n    } else {\r\n      newRange.setStart(firstBlock, 0);\r\n    }\r\n    \r\n    // Set end of selection\r\n    const lastTextNode = getLastTextNode(lastBlock);\r\n    if (lastTextNode) {\r\n      newRange.setEnd(lastTextNode, lastTextNode.length);\r\n    } else {\r\n      newRange.setEnd(lastBlock, lastBlock.childNodes.length);\r\n    }\r\n    \r\n    selection.removeAllRanges();\r\n    selection.addRange(newRange);\r\n  } catch (error) {\r\n    // Fallback: select the entire range of modified blocks\r\n    try {\r\n      const fallbackRange = document.createRange();\r\n      fallbackRange.setStartBefore(firstBlock);\r\n      fallbackRange.setEndAfter(lastBlock);\r\n      selection.removeAllRanges();\r\n      selection.addRange(fallbackRange);\r\n    } catch (fallbackError) {\r\n      // If even the fallback fails, do nothing\r\n      console.warn('Could not restore selection after indentation:', fallbackError);\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Handles tab key press for indentation\r\n * @param {KeyboardEvent} event - The keydown event\r\n * @returns {boolean} True if event was handled, false otherwise\r\n */\r\nexport function handleTabIndentation(event) {\r\n  if (event.key !== 'Tab') return false;\r\n\r\n  event.preventDefault();\r\n\r\n  const isOutdent = event.shiftKey;\r\n  const selection = window.getSelection();\r\n  const range = selection && selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\r\n\r\n  // If there's a selection, try to indent/outdent the selected blocks\r\n  if (selection && selection.rangeCount > 0 && range && !range.collapsed) {\r\n    const success = indentSelectedBlocks(isOutdent);\r\n    if (success) return true;\r\n    // Fall through to cursor insertion if no blocks were found\r\n  }\r\n\r\n  // No selection or no blocks found - insert indentation at cursor (only for Tab, not Shift+Tab)\r\n  if (!isOutdent) {\r\n    document.execCommand('insertHTML', false, '&nbsp;&nbsp;&nbsp;&nbsp;');\r\n  }\r\n\r\n  return true;\r\n}","import React, { useState, useRef, useEffect } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Palette } from 'lucide-react';\r\n\r\n/**\r\n * ColorPickerDropdown - A dropdown component for selecting font colors\r\n * Provides a palette of basic colors with a custom color picker option\r\n */\r\nconst ColorPickerDropdown = ({ currentColor, onColorSelect, title = \"Font Color\" }) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const dropdownRef = useRef(null);\r\n\r\n  // Basic color palette\r\n  const colorPalette = [\r\n    '#000000', // Black\r\n    '#FF0000', // Red\r\n    '#00FF00', // Green\r\n    '#0000FF', // Blue\r\n    '#FFFF00', // Yellow\r\n    '#FF00FF', // Magenta\r\n    '#00FFFF', // Cyan\r\n    '#FFA500', // Orange\r\n    '#800080', // Purple\r\n    '#FFC0CB', // Pink\r\n    '#A52A2A', // Brown\r\n    '#808080', // Gray\r\n    '#FFFFFF', // White\r\n  ];\r\n\r\n  // Close dropdown when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\r\n        setIsOpen(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, []);\r\n\r\n  const handleColorClick = (color) => {\r\n    onColorSelect(color);\r\n    setIsOpen(false);\r\n  };\r\n\r\n  const handleCustomColorChange = (event) => {\r\n    const color = event.target.value;\r\n    onColorSelect(color);\r\n  };\r\n\r\n  return (\r\n    <div className=\"color-picker-dropdown\" ref={dropdownRef}>\r\n      <button\r\n        onClick={() => setIsOpen(!isOpen)}\r\n        className=\"color-picker-button\"\r\n        title={title}\r\n        style={{\r\n          backgroundColor: currentColor || '#000000',\r\n          border: '1px solid #ccc',\r\n          borderRadius: '3px',\r\n          width: '24px',\r\n          height: '24px',\r\n          cursor: 'pointer',\r\n          position: 'relative'\r\n        }}\r\n      >\r\n        <Palette size={14} style={{ color: currentColor === '#FFFFFF' ? '#000' : '#FFF' }} />\r\n      </button>\r\n\r\n      {isOpen && (\r\n        <div className=\"color-picker-palette\">\r\n          <div className=\"color-grid\">\r\n            {colorPalette.map((color) => (\r\n              <button\r\n                key={color}\r\n                onClick={() => handleColorClick(color)}\r\n                className={`color-option ${currentColor === color ? 'selected' : ''}`}\r\n                style={{\r\n                  backgroundColor: color,\r\n                  border: currentColor === color ? '2px solid #007acc' : '1px solid #ccc',\r\n                  width: '24px',\r\n                  height: '24px',\r\n                  margin: '2px',\r\n                  borderRadius: '3px',\r\n                  cursor: 'pointer'\r\n                }}\r\n                title={color}\r\n              />\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"custom-color-section\">\r\n            <label htmlFor=\"custom-color-input\" style={{ fontSize: '12px', marginBottom: '4px', display: 'block' }}>\r\n              Custom Color:\r\n            </label>\r\n            <input\r\n              id=\"custom-color-input\"\r\n              type=\"color\"\r\n              value={currentColor || '#000000'}\r\n              onChange={handleCustomColorChange}\r\n              style={{\r\n                width: '100%',\r\n                height: '32px',\r\n                border: '1px solid #ccc',\r\n                borderRadius: '3px',\r\n                cursor: 'pointer'\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nColorPickerDropdown.propTypes = {\r\n  currentColor: PropTypes.string,\r\n  onColorSelect: PropTypes.func.isRequired,\r\n  title: PropTypes.string\r\n};\r\n\r\nexport default ColorPickerDropdown;","import PropTypes from 'prop-types';\r\nimport { \r\n  Bold, \r\n  Italic, \r\n  Underline, \r\n  Strikethrough,\r\n  AlignLeft,\r\n  AlignCenter,\r\n  AlignRight,\r\n  AlignJustify,\r\n  List,\r\n  ListOrdered,\r\n  Link,\r\n  Table,\r\n  FileText,\r\n  Undo,\r\n  Redo,\r\n  Image as ImageIcon,\r\n  Indent,\r\n  Outdent\r\n} from './icons.jsx';\r\nimport { deleteImage, saveImage, getImage } from '../../lib/storage/index-db';\r\nimport { logger } from '../../lib/editor/utils/logger';\r\nimport { COMMON_FONT_SIZES, DEFAULT_FONT_SIZE } from '../../lib/editor/font-sizes';\r\nimport { indentSelectedBlocks } from '../../lib/editor/indentation-utils';\r\nimport ColorPickerDropdown from './ColorPickerDropdown';\r\n\r\n// Constants for toolbar options\r\nconst FONT_FAMILIES = [\r\n  // English Fonts\r\n  { value: 'Segoe UI', label: 'Segoe UI' },\r\n  { value: 'Arial', label: 'Arial' },\r\n  { value: 'Times New Roman', label: 'Times New Roman' },\r\n  { value: 'Courier New', label: 'Courier New' },\r\n  { value: 'Georgia', label: 'Georgia' },\r\n  { value: 'Verdana', label: 'Verdana' },\r\n  // Sinhala Fonts\r\n  { value: 'Noto Sans Sinhala', label: 'Noto Sans Sinhala' },\r\n  { value: 'Iskoola Pota', label: 'Iskoola Pota' },\r\n  // Tamil Fonts\r\n  { value: 'Noto Sans Tamil', label: 'Noto Sans Tamil' },\r\n  // Unicode Fonts\r\n  { value: 'Noto Sans', label: 'Noto Sans' }\r\n];\r\n\r\nconst HEADING_LEVELS = [\r\n  { value: 'p', label: 'Normal' },\r\n  { value: 'h1', label: 'Heading 1' },\r\n  { value: 'h2', label: 'Heading 2' },\r\n  { value: 'h3', label: 'Heading 3' },\r\n  { value: 'h4', label: 'Heading 4' },\r\n  { value: 'h5', label: 'Heading 5' },\r\n  { value: 'h6', label: 'Heading 6' }\r\n];\r\n\r\nconst DEFAULT_TABLE_HTML = '<table border=\"1\"><tr><th>Header 1</th><th>Header 2</th></tr><tr><td>Cell 3</td><td>Cell 4</td></tr></table>';\r\n\r\n/**\r\n * EditorToolbar - Formatting toolbar for the multi-page editor\r\n * Provides text formatting, alignment, lists, links, tables, and image insertion\r\n */\r\nconst EditorToolbar = ({ \r\n  currentFormat, \r\n  onFormatText, \r\n  onAddPageBreak,\r\n  onInsertImage,\r\n  canUndo = false,\r\n  canRedo = false\r\n}) => {\r\n  /**\r\n   * Render a button with optional active state\r\n   */\r\n  const renderButton = (onClick, Icon, title, formatKey = null, disabled = false) => (\r\n    <button \r\n      key={title}\r\n      onClick={onClick} \r\n      className={formatKey && currentFormat[formatKey] ? 'active' : ''} \r\n      disabled={disabled}\r\n      title={title}\r\n      style={{ opacity: disabled ? 0.5 : 1 }}\r\n    >\r\n      <Icon size={16} />\r\n    </button>\r\n  );\r\n\r\n  /**\r\n   * Render a separator\r\n   */\r\n  const renderSeparator = () => <div className=\"toolbar-separator\" />;\r\n\r\n  /**\r\n   * Handle image upload\r\n   */\r\n  const handleImageUpload = async (file) => {\r\n    try {\r\n      const validTypes = ['image/png', 'image/jpeg', 'image/gif', 'image/webp'];\r\n      if (!validTypes.includes(file.type)) {\r\n        alert('Invalid image format. Supported: PNG, JPEG, GIF, WEBP');\r\n        return;\r\n      }\r\n\r\n      if (file.size > 5 * 1024 * 1024) {\r\n        alert('Image exceeds maximum size of 5MB');\r\n        return;\r\n      }\r\n\r\n      const key = await saveImage(file);\r\n      const imageUrl = await getImage(key);\r\n      \r\n      if (imageUrl && onInsertImage) {\r\n        const imageHtml = `<img src=\"${imageUrl}\" data-key=\"${key}\" alt=\"Inserted image\" />`;\r\n        onInsertImage(imageHtml);\r\n      } else {\r\n        logger.warn('Failed to insert image: missing URL or callback');\r\n      }\r\n      \r\n      // Reset file input to allow re-uploading the same file\r\n      document.getElementById('image-upload').value = '';\r\n    } catch (error) {\r\n      logger.error('Error uploading image', error);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle indent button click\r\n   */\r\n  const handleIndent = () => {\r\n    const success = indentSelectedBlocks(false);\r\n    if (!success) {\r\n      // If no blocks selected, insert indentation at cursor\r\n      document.execCommand('insertHTML', false, '&nbsp;&nbsp;&nbsp;&nbsp;');\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle outdent button click\r\n   */\r\n  const handleOutdent = () => {\r\n    indentSelectedBlocks(true);\r\n  };\r\n\r\n  /**\r\n   * Handle link insertion\r\n   */\r\n  const handleInsertLink = () => {\r\n    const url = prompt('Enter URL:');\r\n    if (url) onFormatText('createLink', url);\r\n  };\r\n\r\n  /**\r\n   * Handle image button click\r\n   */\r\n  const handleImageButtonClick = () => {\r\n    document.getElementById('image-upload').click();\r\n  };\r\n\r\n  return (\r\n    <div className=\"editor-toolbar\">\r\n      {/* Undo/Redo */}\r\n      {renderButton(() => onFormatText('undo'), Undo, 'Undo', null, !canUndo)}\r\n      {renderButton(() => onFormatText('redo'), Redo, 'Redo', null, !canRedo)}\r\n      \r\n      {renderSeparator()}\r\n      \r\n      {/* Text Formatting */}\r\n      {renderButton(() => onFormatText('bold'), Bold, 'Bold', 'bold')}\r\n      {renderButton(() => onFormatText('italic'), Italic, 'Italic', 'italic')}\r\n      {renderButton(() => onFormatText('underline'), Underline, 'Underline', 'underline')}\r\n      {renderButton(() => onFormatText('strikethrough'), Strikethrough, 'Strikethrough', 'strikethrough')}\r\n      \r\n      {renderSeparator()}\r\n      \r\n      {/* Alignment */}\r\n      {renderButton(() => onFormatText('justifyLeft'), AlignLeft, 'Align Left', 'alignLeft')}\r\n      {renderButton(() => onFormatText('justifyCenter'), AlignCenter, 'Align Center', 'alignCenter')}\r\n      {renderButton(() => onFormatText('justifyRight'), AlignRight, 'Align Right', 'alignRight')}\r\n      {renderButton(() => onFormatText('justifyFull'), AlignJustify, 'Justify', 'alignJustify')}\r\n      \r\n      {renderSeparator()}\r\n      \r\n      {/* Font Controls */}\r\n      <select \r\n        onChange={(e) => onFormatText('fontName', e.target.value)}\r\n        value={currentFormat.fontFamily || 'Segoe UI'}\r\n        title=\"Font Family\"\r\n      >\r\n        {FONT_FAMILIES.map(({ value, label }) => (\r\n          <option key={value} value={value}>\r\n            {label}\r\n          </option>\r\n        ))}\r\n      </select>\r\n      \r\n      <select \r\n        onChange={(e) => onFormatText('fontSize', e.target.value)}\r\n        value={currentFormat.fontSize || DEFAULT_FONT_SIZE}\r\n        title=\"Font Size\"\r\n      >\r\n        {COMMON_FONT_SIZES.map(({ value, label }) => (\r\n          <option key={value} value={value}>\r\n            {label}\r\n          </option>\r\n        ))}\r\n      </select>\r\n      \r\n      <ColorPickerDropdown\r\n        currentColor={currentFormat.fontColor}\r\n        onColorSelect={(color) => onFormatText('foreColor', color)}\r\n        title=\"Font Color\"\r\n      />\r\n      \r\n      <select \r\n        onChange={(e) => onFormatText('formatBlock', e.target.value)}\r\n        value={currentFormat.headingLevel || 'p'}\r\n        title=\"Heading Level\"\r\n      >\r\n        {HEADING_LEVELS.map(({ value, label }) => (\r\n          <option key={value} value={value}>\r\n            {label}\r\n          </option>\r\n        ))}\r\n      </select>\r\n      \r\n      {renderSeparator()}\r\n      \r\n      {/* Lists */}\r\n      {renderButton(() => onFormatText('insertUnorderedList'), List, 'Bullet List')}\r\n      {renderButton(() => onFormatText('insertOrderedList'), ListOrdered, 'Numbered List')}\r\n      \r\n      {renderSeparator()}\r\n      \r\n      {/* Indentation */}\r\n      <button \r\n        onClick={handleIndent} \r\n        title=\"Increase Indent (Tab)\"\r\n      >\r\n        <Indent size={16} />\r\n      </button>\r\n      <button \r\n        onClick={handleOutdent} \r\n        title=\"Decrease Indent (Shift+Tab)\"\r\n      >\r\n        <Outdent size={16} />\r\n      </button>\r\n      \r\n      {renderSeparator()}\r\n      \r\n      {/* Links and Tables */}\r\n      <button \r\n        onClick={handleInsertLink} \r\n        title=\"Insert Link\"\r\n      >\r\n        <Link size={16} />\r\n      </button>\r\n      {renderButton(() => onFormatText('insertHTML', DEFAULT_TABLE_HTML), Table, 'Insert Table')}\r\n      \r\n      {onAddPageBreak && renderButton(onAddPageBreak, FileText, 'Insert Page Break')}\r\n      \r\n      {renderSeparator()}\r\n      \r\n      {/* Images */}\r\n      <input \r\n        type=\"file\" \r\n        accept=\"image/*\" \r\n        onChange={(e) => e.target.files[0] && handleImageUpload(e.target.files[0])}\r\n        style={{ display: 'none' }}\r\n        id=\"image-upload\"\r\n      />\r\n      <button \r\n        onClick={handleImageButtonClick} \r\n        title=\"Insert Image\"\r\n      >\r\n        <ImageIcon size={16} />\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nEditorToolbar.propTypes = {\r\n  currentFormat: PropTypes.shape({\r\n    bold: PropTypes.bool,\r\n    italic: PropTypes.bool,\r\n    underline: PropTypes.bool,\r\n    strikethrough: PropTypes.bool,\r\n    alignLeft: PropTypes.bool,\r\n    alignCenter: PropTypes.bool,\r\n    alignRight: PropTypes.bool,\r\n    alignJustify: PropTypes.bool,\r\n    fontFamily: PropTypes.string,\r\n    fontSize: PropTypes.string,\r\n    fontColor: PropTypes.string,\r\n    headingLevel: PropTypes.string\r\n  }).isRequired,\r\n  onFormatText: PropTypes.func.isRequired,\r\n  onAddPageBreak: PropTypes.func,\r\n  onInsertImage: PropTypes.func,\r\n  canUndo: PropTypes.bool,\r\n  canRedo: PropTypes.bool\r\n};\r\n\r\nEditorToolbar.defaultProps = {\r\n  onAddPageBreak: undefined,\r\n  onInsertImage: undefined,\r\n  canUndo: false,\r\n  canRedo: false\r\n};\r\n\r\nexport default EditorToolbar;\r\n","/**\r\n * Paste utilities for processing pasted content in the HTML editor\r\n * Handles conversion of div tags to p tags and proper paragraph structure\r\n */\r\n\r\nimport { normalizeContent } from './content-normalize-utils.js';\r\n\r\n/**\r\n * Processes pasted HTML content to ensure proper paragraph structure\r\n * Converts div tags to p tags and handles line breaks appropriately\r\n * @param {string} htmlContent - The raw HTML content from clipboard\r\n * @returns {string} Processed HTML content with proper paragraph tags\r\n */\r\nexport function processPastedContent(htmlContent) {\r\n  if (!htmlContent || typeof htmlContent !== 'string') {\r\n    return htmlContent;\r\n  }\r\n\r\n  // Use the comprehensive normalizeContent function for proper HTML structure\r\n  return normalizeContent(htmlContent);\r\n}\r\n\r\n/**\r\n * Handles paste event for contenteditable\r\n * @param {ClipboardEvent} event - The paste event\r\n * @returns {string|null} Processed HTML content to insert, or null to allow default behavior\r\n */\r\nexport function handlePaste(event) {\r\n  // Prevent default paste behavior\r\n  event.preventDefault();\r\n\r\n  // Get pasted content\r\n  const clipboardData = event.clipboardData || window.clipboardData;\r\n  if (!clipboardData) {\r\n    return null;\r\n  }\r\n\r\n  // Try to get HTML content first, fall back to plain text\r\n  let pastedContent = clipboardData.getData('text/html') || clipboardData.getData('text/plain');\r\n\r\n  if (!pastedContent) {\r\n    return null;\r\n  }\r\n\r\n  // If we got plain text, convert it to HTML with proper paragraph structure\r\n  if (!clipboardData.getData('text/html')) {\r\n    pastedContent = convertPlainTextToHtml(pastedContent);\r\n  } else {\r\n    // Process HTML content using comprehensive normalization\r\n    pastedContent = processPastedContent(pastedContent);\r\n  }\r\n\r\n  // Insert the processed content\r\n  document.execCommand('insertHTML', false, pastedContent);\r\n\r\n  return pastedContent;\r\n}\r\n\r\n/**\r\n * Converts plain text to HTML with proper paragraph structure\r\n * @param {string} text - Plain text content\r\n * @returns {string} HTML content with paragraphs\r\n */\r\nfunction convertPlainTextToHtml(text) {\r\n  if (!text) return '';\r\n\r\n  // Split by double newlines (paragraph breaks) and single newlines\r\n  const paragraphs = text.split(/\\n\\s*\\n/).filter(p => p.trim());\r\n\r\n  if (paragraphs.length === 0) {\r\n    return '<p><br></p>';\r\n  }\r\n\r\n  return paragraphs.map(paragraph => {\r\n    // Handle single lines within paragraphs\r\n    const lines = paragraph.split('\\n').filter(line => line.trim());\r\n    if (lines.length === 0) {\r\n      return '<p><br></p>';\r\n    }\r\n\r\n    // Join lines with line breaks, but wrap in paragraph\r\n    const content = lines.map(line => escapeHtml(line.trim())).join('<br>');\r\n    return `<p>${content}</p>`;\r\n  }).join('');\r\n}\r\n\r\n/**\r\n * Escapes HTML special characters\r\n * @param {string} text - Text to escape\r\n * @returns {string} Escaped HTML text\r\n */\r\nfunction escapeHtml(text) {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}","import { useCallback, useMemo, memo } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { DEFAULT_FONT_SIZE } from '../../lib/editor/font-sizes';\r\nimport { getMarginPixels, DEFAULT_MARGIN_PRESET } from '../../lib/editor/margin-utils';\r\nimport { handlePaste as processPasteEvent } from '../../lib/editor/paste-utils';\r\nimport { handleTabIndentation } from '../../lib/editor/indentation-utils';\r\n\r\n// Constants for page break remove button dimensions\r\nconst REMOVE_BUTTON_WIDTH = 20;\r\nconst REMOVE_BUTTON_HEIGHT = 20;\r\nconst REMOVE_BUTTON_OFFSET_RIGHT = 20;\r\nconst REMOVE_BUTTON_OFFSET_TOP = -12;\r\n\r\n// Style constants\r\nconst EDITOR_CONTAINER_STYLE = {\r\n  position: 'relative',\r\n  width: '100%',\r\n  maxWidth: '100%',\r\n  margin: '40px auto',\r\n  backgroundColor: 'transparent',\r\n  minHeight: '100vh'\r\n};\r\n\r\nconst CONTENT_EDITABLE_STYLE = {\r\n  position: 'relative',\r\n  zIndex: 1,\r\n  backgroundColor: 'white',\r\n  outline: 'none',\r\n  cursor: 'text',\r\n  fontFamily: '\"Segoe UI\", \"Noto Sans Sinhala\", \"Noto Sans\", \"Malithi Web\", \"Iskoola Pota\", \"Kaputa Unicode\", \"Helvetica Neue\", Arial, \"Hiragino Sans GB\", \"WenQuanYi Micro Hei\", \"Microsoft YaHei\", sans-serif',\r\n  fontSize: DEFAULT_FONT_SIZE,\r\n  lineHeight: '1.4',\r\n  color: '#333',\r\n  wordWrap: 'break-word',\r\n  whiteSpace: 'pre-wrap',\r\n  overflowWrap: 'break-word',\r\n  border: '1px solid #e0e0e0',\r\n  boxSizing: 'border-box',\r\n  boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)'\r\n};\r\n\r\n/**\r\n * Helper function to set cursor position at the start or end of an element\r\n */\r\nconst setCursorAtElement = (element, atStart = true) => {\r\n  if (!element) return;\r\n  \r\n  const range = document.createRange();\r\n  const sel = window.getSelection();\r\n  \r\n  if (atStart) {\r\n    range.setStart(element, 0);\r\n    range.collapse(true);\r\n  } else {\r\n    range.selectNodeContents(element);\r\n    range.collapse(false);\r\n  }\r\n  \r\n  sel.removeAllRanges();\r\n  sel.addRange(range);\r\n};\r\n\r\n/**\r\n * Check if typing should be prevented on page-break elements\r\n */\r\nconst shouldPreventTypingOnPageBreak = (event, startContainer, endContainer) => {\r\n  if (isPageBreakElement(startContainer) || isPageBreakElement(endContainer)) {\r\n    if (event.key.length === 1 || event.key === 'Enter' || event.key === ' ') {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\n/**\r\n * Check if deletion should be prevented on page-break elements\r\n */\r\nconst shouldPreventDeletionOnPageBreak = (event, startContainer, endContainer) => {\r\n  if (event.key === 'Backspace' || event.key === 'Delete') {\r\n    if (isPageBreakElement(startContainer) || isPageBreakElement(endContainer)) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\n/**\r\n * Helper function to check if element is or contains a page-break\r\n */\r\nconst isPageBreakElement = (node) => {\r\n  if (!node) return false;\r\n  if (node.nodeType === Node.ELEMENT_NODE) {\r\n    return node.tagName === 'PAGE-BREAK' || node.getAttribute('data-page-break') === 'true';\r\n  }\r\n  return node.parentElement && isPageBreakElement(node.parentElement);\r\n};\r\n\r\n/**\r\n * PageView - MS Word-like continuous contenteditable surface\r\n * Single contenteditable div with manual page breaks using <page-break> tags\r\n * Content flows continuously with explicit page boundaries\r\n * Supports zoom scaling via CSS transform\r\n */\r\nconst PageView = ({ \r\n  dimensions, \r\n  editorRef,\r\n  onInput,\r\n  onContentChange,\r\n  onKeyDown,\r\n  onClick,\r\n  onScroll,\r\n  onPaste,\r\n  onRemovePageBreak,\r\n  zoomLevel = 100,\r\n  pageMargins = DEFAULT_MARGIN_PRESET\r\n}) => {\r\n  // Memoize padding calculation\r\n  const padding = useMemo(() => getMarginPixels(pageMargins), [pageMargins]);\r\n\r\n  // Calculate zoom multiplier\r\n  const zoomMultiplier = zoomLevel / 100;\r\n\r\n  // Helper function to check if cursor is in padding area\r\n  const isInPaddingArea = useCallback((element, clientY) => {\r\n    if (!element) return false;\r\n    \r\n    const rect = element.getBoundingClientRect();\r\n    const relativeY = clientY - rect.top;\r\n    \r\n    // Check if in top or bottom padding\r\n    if (relativeY < padding.top || relativeY > (rect.height - padding.bottom)) {\r\n      return true;\r\n    }\r\n    \r\n    return false;\r\n  }, [padding.top, padding.bottom]);\r\n\r\n  // Handle page-break click logic\r\n  const handlePageBreakClick = useCallback((clickedElement, event) => {\r\n    event.preventDefault();\r\n    \r\n    // Check if click is in the remove button area (top-right corner)\r\n    const rect = clickedElement.getBoundingClientRect();\r\n    const relativeX = event.clientX - rect.left;\r\n    const relativeY = event.clientY - rect.top;\r\n    \r\n    // Remove button dimensions and positioning\r\n    const removeButtonLeft = rect.width - REMOVE_BUTTON_OFFSET_RIGHT - REMOVE_BUTTON_WIDTH;\r\n    const removeButtonTop = REMOVE_BUTTON_OFFSET_TOP;\r\n    const removeButtonRight = rect.width - REMOVE_BUTTON_OFFSET_RIGHT;\r\n    const removeButtonBottom = REMOVE_BUTTON_OFFSET_TOP + REMOVE_BUTTON_HEIGHT;\r\n    \r\n    // Check if click is within the remove button area\r\n    if (relativeX >= removeButtonLeft && \r\n        relativeX <= removeButtonRight && \r\n        relativeY >= removeButtonTop && \r\n        relativeY <= removeButtonBottom) {\r\n      // Click is on remove button\r\n      if (onRemovePageBreak) {\r\n        onRemovePageBreak(clickedElement);\r\n      }\r\n    }\r\n  }, [onRemovePageBreak]);\r\n\r\n  // Handle padding click logic\r\n  const handlePaddingClick = useCallback((event) => {\r\n    event.preventDefault();\r\n    \r\n    // Move cursor to the nearest valid content area\r\n    const rect = editorRef.current.getBoundingClientRect();\r\n    const relativeY = event.clientY - rect.top;\r\n    \r\n    if (relativeY < padding.top) {\r\n      // Click was in top padding - move to first content element\r\n      const firstChild = editorRef.current.firstElementChild;\r\n      if (firstChild && firstChild.tagName !== 'PAGE-BREAK') {\r\n        setCursorAtElement(firstChild, true);\r\n      }\r\n    } else {\r\n      // Click was in bottom padding - move to last content element\r\n      const lastChild = editorRef.current.lastElementChild;\r\n      if (lastChild && lastChild.tagName !== 'PAGE-BREAK') {\r\n        setCursorAtElement(lastChild, false);\r\n      }\r\n    }\r\n  }, [editorRef, padding.top]);\r\n\r\n  // Prevent deletion of page-break elements and handle Tab key\r\n  const handleKeyDown = useCallback((event) => {\r\n    const selection = window.getSelection();\r\n    if (!selection || selection.rangeCount === 0) return;\r\n\r\n    const range = selection.getRangeAt(0);\r\n    const { startContainer, endContainer } = range;\r\n\r\n    // Prevent typing on page-break elements\r\n    if (shouldPreventTypingOnPageBreak(event, startContainer, endContainer)) {\r\n      event.preventDefault();\r\n      return false;\r\n    }\r\n\r\n    // Handle Tab key for indentation (multi-line or single line)\r\n    if (handleTabIndentation(event)) {\r\n      // Update content after indentation\r\n      if (onContentChange) {\r\n        onContentChange();\r\n      }\r\n      return false;\r\n    }\r\n\r\n    // Prevent deletion of page-break elements\r\n    if (shouldPreventDeletionOnPageBreak(event, startContainer, endContainer)) {\r\n      event.preventDefault();\r\n      return false;\r\n    }\r\n\r\n    if (onKeyDown) {\r\n      onKeyDown(event);\r\n    }\r\n  }, [onKeyDown, onContentChange]);\r\n\r\n  // Handle click events to prevent cursor placement in padding areas\r\n  const handleClick = useCallback((event) => {\r\n    if (!editorRef.current) return;\r\n\r\n    const clickedElement = event.target;\r\n    \r\n    // Check if click is on a page-break element\r\n    if (isPageBreakElement(clickedElement)) {\r\n      handlePageBreakClick(clickedElement, event);\r\n      return;\r\n    }\r\n\r\n    // Check if click is in padding area\r\n    if (isInPaddingArea(editorRef.current, event.clientY)) {\r\n      handlePaddingClick(event);\r\n      return;\r\n    }\r\n\r\n    if (onClick) {\r\n      onClick(event);\r\n    }\r\n  }, [editorRef, onClick, handlePageBreakClick, handlePaddingClick, isInPaddingArea]);\r\n\r\n  // Prevent input in padding areas and on page breaks\r\n  const handleBeforeInput = useCallback((event) => {\r\n    const selection = window.getSelection();\r\n    if (!selection || selection.rangeCount === 0) return;\r\n\r\n    const range = selection.getRangeAt(0);\r\n    const { startContainer } = range;\r\n\r\n    // Prevent input on page-break elements\r\n    if (isPageBreakElement(startContainer)) {\r\n      event.preventDefault();\r\n      return false;\r\n    }\r\n  }, []);\r\n\r\n  // Handle paste events with custom processing\r\n  const handlePaste = useCallback((event) => {\r\n    // Use the custom paste handler from utils\r\n    const processedContent = processPasteEvent(event);\r\n    \r\n    // Call parent onPaste callback if provided\r\n    if (onPaste) {\r\n      onPaste(event, processedContent);\r\n    }\r\n  }, [onPaste]);\r\n\r\n  return (\r\n    <div \r\n      className=\"continuous-page-container\"\r\n      style={{\r\n        ...EDITOR_CONTAINER_STYLE,\r\n        maxWidth: `${dimensions.width}px`,\r\n        transform: `scale(${zoomMultiplier})`,\r\n        transformOrigin: 'top center',\r\n        transition: 'transform 0.2s ease-out'\r\n      }}\r\n    >\r\n      {/* Continuous contenteditable surface with page styling */}\r\n      <div\r\n        ref={editorRef}\r\n        contentEditable={true}\r\n        suppressContentEditableWarning={true}\r\n        className=\"continuous-content\"\r\n        style={{\r\n          ...CONTENT_EDITABLE_STYLE,\r\n          minHeight: `${dimensions.height}px`,\r\n          width: `${dimensions.width}px`,\r\n          padding: `${padding.top}px ${padding.right}px ${padding.bottom}px ${padding.left}px`\r\n        }}\r\n        onInput={onInput}\r\n        onKeyDown={handleKeyDown}\r\n        onBeforeInput={handleBeforeInput}\r\n        onClick={handleClick}\r\n        onScroll={onScroll}\r\n        onPaste={handlePaste}\r\n        data-testid=\"continuous-editor\"\r\n      >\r\n        {/* Content is set via innerHTML in parent component */}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nPageView.propTypes = {\r\n  dimensions: PropTypes.shape({\r\n    width: PropTypes.number.isRequired,\r\n    height: PropTypes.number.isRequired\r\n  }).isRequired,\r\n  editorRef: PropTypes.shape({\r\n    current: PropTypes.instanceOf(typeof Element !== 'undefined' ? Element : Object)\r\n  }).isRequired,\r\n  onInput: PropTypes.func.isRequired,\r\n  onContentChange: PropTypes.func,\r\n  onKeyDown: PropTypes.func,\r\n  onClick: PropTypes.func,\r\n  onScroll: PropTypes.func,\r\n  onPaste: PropTypes.func,\r\n  onRemovePageBreak: PropTypes.func,\r\n  zoomLevel: PropTypes.number,\r\n  pageMargins: PropTypes.string\r\n};\r\n\r\nPageView.defaultProps = {\r\n  zoomLevel: 100,\r\n  pageMargins: DEFAULT_MARGIN_PRESET\r\n};\r\n\r\nexport default memo(PageView);\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { FileText, Plus, X, Settings, ZoomIn, ZoomOut } from 'lucide-react';\r\nimport { MARGIN_PRESETS, getMarginPresetNames, getMarginPresetLabel, DEFAULT_MARGIN_PRESET } from '../../lib/editor/margin-utils';\r\n\r\n/**\r\n * PageManager Component - Standalone Component\r\n * \r\n * COMPLETELY INDEPENDENT - can be used with or without the editor\r\n * Accepts all state as props, uses callbacks for all actions\r\n * Perfect for external apps that want to provide their own PageManager UI\r\n * \r\n * @param {Object} props - Component props\r\n * @param {Array} props.pageBoundaries - Array of page boundary objects [{id, pageNumber, top, height}, ...]\r\n * @param {number} props.activePage - Current active page index (0-based)\r\n * @param {string} props.pageSize - Current page size ('A4', 'Letter', or 'Legal')\r\n * @param {string} props.pageMargins - Current page margin preset ('NORMAL', 'NARROW', etc.)\r\n * @param {number} props.zoomLevel - Current zoom level (50-200)\r\n * @param {boolean} props.canZoomIn - Whether zoom in is allowed\r\n * @param {boolean} props.canZoomOut - Whether zoom out is allowed\r\n * @param {Function} props.onNavigate - Callback when page changes (pageIndex)\r\n * @param {Function} props.onAddPage - Callback when page is added\r\n * @param {Function} props.onDeletePage - Callback when page is deleted (pageIndex)\r\n * @param {Function} props.onPageSizeChange - Callback when page size changes (newSize)\r\n * @param {Function} props.onPageMarginsChange - Callback when page margins change (newMargins)\r\n * @param {Function} props.onZoomIn - Callback when zoom in is clicked\r\n * @param {Function} props.onZoomOut - Callback when zoom out is clicked\r\n * @param {Function} props.onZoomReset - Callback when zoom reset is clicked\r\n */\r\nexport const PageManager = ({ \r\n  pageBoundaries = [{ id: 'page-0', pageNumber: 1 }],\r\n  activePage = 0,\r\n  pageSize = 'A4',\r\n  pageMargins = DEFAULT_MARGIN_PRESET,\r\n  zoomLevel = 100,\r\n  canZoomIn = true,\r\n  canZoomOut = true,\r\n  onNavigate, \r\n  onAddPage,\r\n  onDeletePage,\r\n  onPageSizeChange,\r\n  onPageMarginsChange,\r\n  onZoomIn,\r\n  onZoomOut,\r\n  onZoomReset\r\n} = {}) => {\r\n  // Ensure we always have at least one page\r\n  const totalPages = Math.max(pageBoundaries?.length || 0, 1);\r\n\r\n  const handleDeletePage = (pageIndex) => {\r\n    if (totalPages <= 1) {\r\n      console.warn('[PageManager] Cannot delete the only page');\r\n      return;\r\n    }\r\n    \r\n    // Delegate to parent callback\r\n    onDeletePage?.(pageIndex);\r\n  };\r\n\r\n  return (\r\n    <div className=\"page-manager\">\r\n      {/* Page Settings Group - Size and Margins together */}\r\n      <div className=\"page-settings-group\">\r\n        <div className=\"page-settings-header\">\r\n          <Settings size={14} style={{ marginRight: '4px', verticalAlign: 'middle' }} />\r\n          Page Settings\r\n        </div>\r\n        <div className=\"page-settings-controls\">\r\n          <div className=\"page-setting-item\">\r\n            <label htmlFor=\"page-size-selector\">Size:</label>\r\n            <select\r\n              id=\"page-size-selector\"\r\n              role=\"combobox\"\r\n              aria-label=\"Page size selector\"\r\n              value={pageSize}\r\n              onChange={(e) => onPageSizeChange?.(e.target.value)}\r\n            >\r\n              <option value=\"A4\">A4</option>\r\n              <option value=\"Letter\">Letter</option>\r\n              <option value=\"Legal\">Legal</option>\r\n            </select>\r\n          </div>\r\n          <div className=\"page-setting-item\">\r\n            <label htmlFor=\"page-margins-selector\">Margins:</label>\r\n            <select\r\n              id=\"page-margins-selector\"\r\n              role=\"combobox\"\r\n              aria-label=\"Page margins selector\"\r\n              value={pageMargins}\r\n              onChange={(e) => onPageMarginsChange?.(e.target.value)}\r\n            >\r\n              {getMarginPresetNames().map((presetName) => (\r\n                <option key={presetName} value={presetName}>\r\n                  {getMarginPresetLabel(presetName)}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Compact Zoom Controls */}\r\n      <div className=\"zoom-controls-compact\">\r\n        <button\r\n          type=\"button\"\r\n          className=\"zoom-button-compact\"\r\n          onClick={onZoomOut}\r\n          disabled={!canZoomOut}\r\n          aria-label=\"Zoom out\"\r\n          title=\"Zoom out (Ctrl + -)\"\r\n        >\r\n          <ZoomOut size={12} />\r\n        </button>\r\n        <span className=\"zoom-level-display\">{zoomLevel}%</span>\r\n        <button\r\n          type=\"button\"\r\n          className=\"zoom-button-compact\"\r\n          onClick={onZoomIn}\r\n          disabled={!canZoomIn}\r\n          aria-label=\"Zoom in\"\r\n          title=\"Zoom in (Ctrl + +)\"\r\n        >\r\n          <ZoomIn size={12} />\r\n        </button>\r\n        <button\r\n          type=\"button\"\r\n          className=\"zoom-reset-compact\"\r\n          onClick={onZoomReset}\r\n          aria-label=\"Reset zoom\"\r\n          title=\"Reset zoom to 100% (Ctrl + 0)\"\r\n        >\r\n          Reset\r\n        </button>\r\n      </div>\r\n\r\n      {/* Page List */}\r\n      <div className=\"page-list\">\r\n        {pageBoundaries.map((boundary, index) => (\r\n          <div key={boundary.id || `page-${index}`} className=\"page-item\">\r\n            <button\r\n              type=\"button\"\r\n              className={`page-button ${index === activePage ? 'active' : ''}`}\r\n              onClick={() => onNavigate?.(index)}\r\n              aria-label={`Go to page ${index + 1}`}\r\n              aria-current={index === activePage ? 'page' : undefined}\r\n            >\r\n              <FileText size={14} />\r\n              <span>Page {index + 1}</span>\r\n            </button>\r\n            {/* Show delete button for all pages when more than 1 page exists */}\r\n            {totalPages > 1 && (\r\n              <button\r\n                type=\"button\"\r\n                className=\"delete-page-button\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  handleDeletePage(index);\r\n                }}\r\n                aria-label={`Delete page ${index + 1}`}\r\n                title=\"Delete this page and its content\"\r\n              >\r\n                <X size={14} />\r\n              </button>\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n      \r\n      {/* Add Page Button */}\r\n      <button\r\n        type=\"button\"\r\n        className=\"add-page-button\"\r\n        onClick={() => onAddPage?.()}\r\n        aria-label=\"Add new page\"\r\n        title=\"Add new page at end\"\r\n      >\r\n        <Plus size={16} />\r\n        <span>Add Page</span>\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nPageManager.propTypes = {\r\n  pageBoundaries: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      id: PropTypes.string.isRequired,\r\n      pageNumber: PropTypes.number.isRequired,\r\n      top: PropTypes.number,\r\n      height: PropTypes.number\r\n    })\r\n  ),\r\n  activePage: PropTypes.number,\r\n  pageSize: PropTypes.oneOf(['A4', 'Letter', 'Legal']),\r\n  pageMargins: PropTypes.string,\r\n  zoomLevel: PropTypes.number,\r\n  canZoomIn: PropTypes.bool,\r\n  canZoomOut: PropTypes.bool,\r\n  onNavigate: PropTypes.func,\r\n  onAddPage: PropTypes.func,\r\n  onDeletePage: PropTypes.func,\r\n  onPageSizeChange: PropTypes.func,\r\n  onPageMarginsChange: PropTypes.func,\r\n  onZoomIn: PropTypes.func,\r\n  onZoomOut: PropTypes.func,\r\n  onZoomReset: PropTypes.func\r\n};\r\n\r\nexport default React.memo(PageManager);","import React, { useEffect, useRef, useCallback } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useDocumentActions } from '../../context/DocumentContext';\r\nimport {\r\n  isResizableImage,\r\n  createResizeOverlay,\r\n  removeResizeOverlay,\r\n  updateResizeOverlay,\r\n  RESIZE_HANDLERS,\r\n  DEFAULT_IMAGE_RESIZE_OPTIONS\r\n} from '../../lib/editor/image-resize-utils';\r\n\r\n// Constants for keyboard shortcuts and defaults\r\nconst KEYBOARD_RESIZE_STEP = 10;\r\nconst DEFAULT_RESET_WIDTH = 300;\r\nconst DEFAULT_RESET_HEIGHT = 200;\r\nconst MUTATION_OBSERVER_DELAY = 50;\r\n\r\n/**\r\n * Helper function to get cursor for handler\r\n */\r\nfunction getCursorForHandler(handler) {\r\n  switch (handler) {\r\n    case RESIZE_HANDLERS.TOP_LEFT:\r\n    case RESIZE_HANDLERS.BOTTOM_RIGHT:\r\n      return 'nwse-resize';\r\n    case RESIZE_HANDLERS.TOP_RIGHT:\r\n    case RESIZE_HANDLERS.BOTTOM_LEFT:\r\n      return 'nesw-resize';\r\n    case RESIZE_HANDLERS.TOP:\r\n    case RESIZE_HANDLERS.BOTTOM:\r\n      return 'ns-resize';\r\n    case RESIZE_HANDLERS.LEFT:\r\n    case RESIZE_HANDLERS.RIGHT:\r\n      return 'ew-resize';\r\n    default:\r\n      return 'default';\r\n  }\r\n}\r\n\r\n/**\r\n * Apply aspect ratio constraints to dimensions\r\n */\r\nfunction applyAspectRatioConstraints(newWidth, newHeight, startWidth, startHeight, handler, options) {\r\n  if (!options.preserveAspectRatio) return { width: newWidth, height: newHeight };\r\n\r\n  const aspectRatio = startWidth / startHeight;\r\n\r\n  // For corner handlers, maintain aspect ratio\r\n  if ([RESIZE_HANDLERS.TOP_LEFT, RESIZE_HANDLERS.TOP_RIGHT,\r\n       RESIZE_HANDLERS.BOTTOM_LEFT, RESIZE_HANDLERS.BOTTOM_RIGHT].includes(handler)) {\r\n    // Use the larger dimension to maintain aspect ratio\r\n    if (newWidth / aspectRatio > newHeight) {\r\n      newHeight = newWidth / aspectRatio;\r\n    } else {\r\n      newWidth = newHeight * aspectRatio;\r\n    }\r\n  }\r\n  // For edge handlers, maintain aspect ratio\r\n  else if ([RESIZE_HANDLERS.TOP, RESIZE_HANDLERS.BOTTOM].includes(handler)) {\r\n    newWidth = newHeight * aspectRatio;\r\n  } else if ([RESIZE_HANDLERS.LEFT, RESIZE_HANDLERS.RIGHT].includes(handler)) {\r\n    newHeight = newWidth / aspectRatio;\r\n  }\r\n\r\n  return { width: newWidth, height: newHeight };\r\n}\r\n\r\n/**\r\n * Helper function to calculate resize dimensions\r\n */\r\nfunction calculateResizeDimensions({\r\n  handler,\r\n  startX,\r\n  startY,\r\n  currentX,\r\n  currentY,\r\n  startWidth,\r\n  startHeight,\r\n  options = DEFAULT_IMAGE_RESIZE_OPTIONS\r\n}) {\r\n  const deltaX = currentX - startX;\r\n  const deltaY = currentY - startY;\r\n\r\n  let newWidth = startWidth;\r\n  let newHeight = startHeight;\r\n\r\n  // Calculate based on handler position\r\n  switch (handler) {\r\n    case RESIZE_HANDLERS.TOP_LEFT:\r\n      newWidth = startWidth - deltaX;\r\n      newHeight = startHeight - deltaY;\r\n      break;\r\n    case RESIZE_HANDLERS.TOP_RIGHT:\r\n      newWidth = startWidth + deltaX;\r\n      newHeight = startHeight - deltaY;\r\n      break;\r\n    case RESIZE_HANDLERS.BOTTOM_LEFT:\r\n      newWidth = startWidth - deltaX;\r\n      newHeight = startHeight + deltaY;\r\n      break;\r\n    case RESIZE_HANDLERS.BOTTOM_RIGHT:\r\n      newWidth = startWidth + deltaX;\r\n      newHeight = startHeight + deltaY;\r\n      break;\r\n    case RESIZE_HANDLERS.TOP:\r\n      newHeight = startHeight - deltaY;\r\n      break;\r\n    case RESIZE_HANDLERS.BOTTOM:\r\n      newHeight = startHeight + deltaY;\r\n      break;\r\n    case RESIZE_HANDLERS.LEFT:\r\n      newWidth = startWidth - deltaX;\r\n      break;\r\n    case RESIZE_HANDLERS.RIGHT:\r\n      newWidth = startWidth + deltaX;\r\n      break;\r\n    default:\r\n      return { width: newWidth, height: newHeight };\r\n  }\r\n\r\n  // Apply aspect ratio constraints\r\n  ({ width: newWidth, height: newHeight } = applyAspectRatioConstraints(\r\n    newWidth, newHeight, startWidth, startHeight, handler, options\r\n  ));\r\n\r\n  // Apply max dimensions\r\n  if (options.maxWidth && newWidth > options.maxWidth) {\r\n    newWidth = options.maxWidth;\r\n    if (options.preserveAspectRatio) {\r\n      newHeight = newWidth / (startWidth / startHeight);\r\n    }\r\n  }\r\n\r\n  if (options.maxHeight && newHeight > options.maxHeight) {\r\n    newHeight = options.maxHeight;\r\n    if (options.preserveAspectRatio) {\r\n      newWidth = newHeight * (startWidth / startHeight);\r\n    }\r\n  }\r\n\r\n  // Ensure minimum and maximum dimensions\r\n  newWidth = Math.max(options.minWidth, Math.min(options.maxWidth || newWidth, newWidth));\r\n  newHeight = Math.max(options.minHeight, Math.min(options.maxHeight || newHeight, newHeight));\r\n\r\n  return {\r\n    width: Math.round(newWidth),\r\n    height: Math.round(newHeight)\r\n  };\r\n}\r\n\r\n/**\r\n * Helper function to apply image dimensions\r\n */\r\nfunction applyImageDimensions(element, { width, height }) {\r\n  if (!isResizableImage(element)) return;\r\n\r\n  // For img elements\r\n  if (element.tagName === 'IMG') {\r\n    element.style.width = `${width}px`;\r\n    element.style.height = `${height}px`;\r\n    element.width = width;\r\n    element.height = height;\r\n  }\r\n  // For div elements with background images\r\n  else if (element.tagName === 'DIV') {\r\n    element.style.width = `${width}px`;\r\n    element.style.height = `${height}px`;\r\n  }\r\n}\r\n\r\n/**\r\n * Helper function to apply dimensions and trigger input event\r\n */\r\nfunction applyDimensionsAndTriggerInput(editorRef, imageElement, dimensions) {\r\n  applyImageDimensions(imageElement, dimensions);\r\n  // Trigger input event to update document state\r\n  const inputEvent = new Event('input', { bubbles: true, cancelable: true });\r\n  editorRef.current.dispatchEvent(inputEvent);\r\n}\r\n\r\n/**\r\n * Helper function to handle keyboard shortcuts for image resizing\r\n */\r\nfunction handleImageKeyboardShortcut(event, editorRef, imageElement, options) {\r\n  const { ctrlKey, metaKey, shiftKey, key } = event;\r\n  const isModifierPressed = ctrlKey || metaKey;\r\n  const currentWidth = imageElement.offsetWidth;\r\n  const currentHeight = imageElement.offsetHeight;\r\n\r\n  const shortcuts = {\r\n    // Increase width\r\n    '>': isModifierPressed && shiftKey ? () => ({\r\n      width: Math.min(options.maxWidth || 800, currentWidth + KEYBOARD_RESIZE_STEP),\r\n      height: currentHeight\r\n    }) : null,\r\n\r\n    // Decrease width\r\n    '<': isModifierPressed && shiftKey ? () => ({\r\n      width: Math.max(options.minWidth || 50, currentWidth - KEYBOARD_RESIZE_STEP),\r\n      height: currentHeight\r\n    }) : null,\r\n\r\n    // Increase height\r\n    '+': isModifierPressed && shiftKey ? () => ({\r\n      width: currentWidth,\r\n      height: Math.min(options.maxHeight || 600, currentHeight + KEYBOARD_RESIZE_STEP)\r\n    }) : null,\r\n\r\n    // Decrease height\r\n    '-': isModifierPressed && shiftKey ? () => ({\r\n      width: currentWidth,\r\n      height: Math.max(options.minHeight || 50, currentHeight - KEYBOARD_RESIZE_STEP)\r\n    }) : null,\r\n\r\n    // Reset to default\r\n    'r': isModifierPressed && !shiftKey ? () => ({ width: DEFAULT_RESET_WIDTH, height: DEFAULT_RESET_HEIGHT }) : null\r\n  };\r\n\r\n  const action = shortcuts[key];\r\n  if (action) {\r\n    event.preventDefault();\r\n    const dimensions = action();\r\n    applyDimensionsAndTriggerInput(editorRef, imageElement, dimensions);\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * ImageResizeHandlers - Component for handling image resize operations\r\n * Provides resize handlers, selection, and resize functionality for images\r\n * \r\n * Features:\r\n * - Visual resize handles around selected images\r\n * - Mouse-based resizing with aspect ratio preservation\r\n * - Keyboard shortcuts for quick resizing\r\n * - Automatic overlay positioning on scroll\r\n * - Undo/redo support for resize operations\r\n * \r\n * @param {Object} props - Component props\r\n * @param {React.RefObject} props.editorRef - Reference to the editor element\r\n * @param {Function} props.onImageResize - Callback when image is resized\r\n * @param {Function} props.onImageSelect - Callback when image is selected\r\n * @param {Function} props.onImageDeselect - Callback when image selection is cleared\r\n * @param {Object} props.resizeOptions - Resize configuration options\r\n */\r\nconst ImageResizeHandlers = ({\r\n  editorRef,\r\n  onImageResize,\r\n  onImageSelect,\r\n  onImageDeselect,\r\n  resizeOptions = DEFAULT_IMAGE_RESIZE_OPTIONS\r\n}) => {\r\n  const resizeStateRef = useRef({\r\n    overlay: null,\r\n    image: null,\r\n    start: null,\r\n    handler: null,\r\n    isResizing: false\r\n  });\r\n  const resizeOptionsRef = useRef(resizeOptions);\r\n  const actions = useDocumentActions();\r\n\r\n  // Update resize options when they change\r\n  useEffect(() => {\r\n    resizeOptionsRef.current = resizeOptions;\r\n  }, [resizeOptions]);\r\n\r\n  /**\r\n   * Handle image selection by creating resize overlay and handlers\r\n   * @param {HTMLElement} imageElement - The image element to select\r\n   */\r\n  const handleImageSelection = useCallback((imageElement) => {\r\n    if (!isResizableImage(imageElement)) return;\r\n\r\n    // Clear any existing resize overlay\r\n    if (resizeStateRef.current.overlay) {\r\n      removeResizeOverlay(resizeStateRef.current.overlay);\r\n      resizeStateRef.current.overlay = null;\r\n    }\r\n\r\n    // Mark image as selected\r\n    imageElement.classList.add('selected');\r\n\r\n    // Create resize overlay\r\n    const overlay = createResizeOverlay(imageElement, resizeOptionsRef.current);\r\n    if (overlay) {\r\n      resizeStateRef.current.overlay = overlay;\r\n      resizeStateRef.current.image = imageElement;\r\n      \r\n      // Add overlay to document body\r\n      document.body.appendChild(overlay);\r\n      \r\n      // Add event listeners to handlers\r\n      const handlers = overlay.querySelectorAll('.resize-handler');\r\n      handlers.forEach(handler => {\r\n        handler.addEventListener('mousedown', handleResizeStart);\r\n      });\r\n      \r\n      // Notify parent\r\n      if (onImageSelect) {\r\n        onImageSelect(imageElement);\r\n      }\r\n    }\r\n  }, [onImageSelect]);\r\n\r\n  /**\r\n   * Clear current image selection and remove resize overlay\r\n   */\r\n  const clearImageSelection = useCallback(() => {\r\n    if (resizeStateRef.current.image) {\r\n      resizeStateRef.current.image.classList.remove('selected');\r\n      resizeStateRef.current.image = null;\r\n    }\r\n\r\n    if (resizeStateRef.current.overlay) {\r\n      removeResizeOverlay(resizeStateRef.current.overlay);\r\n      resizeStateRef.current.overlay = null;\r\n    }\r\n\r\n    resizeStateRef.current.start = null;\r\n    resizeStateRef.current.handler = null;\r\n    resizeStateRef.current.isResizing = false;\r\n\r\n    // Notify parent\r\n    if (onImageDeselect) {\r\n      onImageDeselect();\r\n    }\r\n  }, [onImageDeselect]);\r\n\r\n  /**\r\n   * Start image resize operation when user clicks on a resize handler\r\n   * @param {MouseEvent} event - The mousedown event\r\n   */\r\n  const handleResizeStart = useCallback((event) => {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    \r\n    if (!resizeStateRef.current.image) return;\r\n\r\n    const handler = event.currentTarget.dataset.handler;\r\n    const rect = resizeStateRef.current.image.getBoundingClientRect();\r\n    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\r\n    const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;\r\n\r\n    // Store the original dimensions for undo\r\n    resizeStateRef.current.start = {\r\n      x: event.clientX,\r\n      y: event.clientY,\r\n      width: resizeStateRef.current.image.offsetWidth,\r\n      height: resizeStateRef.current.image.offsetHeight,\r\n      originalWidth: resizeStateRef.current.image.offsetWidth,\r\n      originalHeight: resizeStateRef.current.image.offsetHeight,\r\n      offsetX: event.clientX - rect.left - scrollLeft,\r\n      offsetY: event.clientY - rect.top - scrollTop\r\n    };\r\n\r\n    resizeStateRef.current.handler = handler;\r\n    resizeStateRef.current.isResizing = true;\r\n\r\n    // Add resize class to prevent text selection\r\n    document.body.classList.add('resize-in-progress');\r\n\r\n    // Update cursor based on handler\r\n    document.body.style.cursor = getCursorForHandler(handler);\r\n\r\n    // Add global event listeners\r\n    document.addEventListener('mousemove', handleResizeMove);\r\n    document.addEventListener('mouseup', handleResizeEnd);\r\n  }, []);\r\n\r\n  /**\r\n   * Perform image resize operation during mouse move\r\n   * @param {MouseEvent} event - The mousemove event\r\n   */\r\n  const handleResizeMove = useCallback((event) => {\r\n    if (!resizeStateRef.current.isResizing || !resizeStateRef.current.image || !resizeStateRef.current.start || !resizeStateRef.current.handler) return;\r\n\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n\r\n    const { x: startX, y: startY, width: startWidth, height: startHeight } = resizeStateRef.current.start;\r\n    const handler = resizeStateRef.current.handler;\r\n    const currentX = event.clientX;\r\n    const currentY = event.clientY;\r\n\r\n    // Calculate new dimensions\r\n    const newDimensions = calculateResizeDimensions({\r\n      handler,\r\n      startX,\r\n      startY,\r\n      currentX,\r\n      currentY,\r\n      startWidth,\r\n      startHeight,\r\n      options: resizeOptionsRef.current\r\n    });\r\n\r\n    // Apply new dimensions to the image\r\n    applyImageDimensions(resizeStateRef.current.image, newDimensions);\r\n\r\n    // Update resize overlay\r\n    if (resizeStateRef.current.overlay) {\r\n      updateResizeOverlay(resizeStateRef.current.overlay, resizeStateRef.current.image);\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * End image resize operation and record for undo/redo\r\n   * @param {MouseEvent} event - The mouseup event\r\n   */\r\n  const handleResizeEnd = useCallback((event) => {\r\n    if (!resizeStateRef.current.isResizing) return;\r\n\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n\r\n    // Record the resize operation for undo before clearing refs\r\n    if (resizeStateRef.current.image && resizeStateRef.current.start) {\r\n      const beforeState = {\r\n        width: resizeStateRef.current.start.originalWidth,\r\n        height: resizeStateRef.current.start.originalHeight\r\n      };\r\n      const afterState = {\r\n        width: resizeStateRef.current.image.offsetWidth,\r\n        height: resizeStateRef.current.image.offsetHeight\r\n      };\r\n\r\n      // Only record if dimensions actually changed\r\n      if (beforeState.width !== afterState.width || beforeState.height !== afterState.height) {\r\n        actions.recordOperation(\r\n          { type: 'IMAGE_RESIZE', payload: { element: resizeStateRef.current.image, state: afterState } },\r\n          { type: 'IMAGE_RESIZE', payload: { element: resizeStateRef.current.image, state: beforeState } }\r\n        );\r\n      }\r\n    }\r\n\r\n    resizeStateRef.current.start = null;\r\n    resizeStateRef.current.handler = null;\r\n    resizeStateRef.current.isResizing = false;\r\n\r\n    // Remove global event listeners\r\n    document.removeEventListener('mousemove', handleResizeMove);\r\n    document.removeEventListener('mouseup', handleResizeEnd);\r\n\r\n    // Remove resize classes\r\n    document.body.classList.remove('resize-in-progress');\r\n    document.body.style.cursor = '';\r\n\r\n    // Update content in document context\r\n    if (resizeStateRef.current.image) {\r\n      // Trigger input event to update document state\r\n      const inputEvent = new Event('input', { bubbles: true, cancelable: true });\r\n      resizeStateRef.current.image.dispatchEvent(inputEvent);\r\n\r\n      // Notify parent about resize\r\n      if (onImageResize) {\r\n        onImageResize(resizeStateRef.current.image, {\r\n          width: resizeStateRef.current.image.offsetWidth,\r\n          height: resizeStateRef.current.image.offsetHeight\r\n        });\r\n      }\r\n    }\r\n  }, [onImageResize, actions]);\r\n\r\n  /**\r\n   * Handle click on editor to select images\r\n   */\r\n  const handleEditorClick = useCallback((event) => {\r\n    \r\n    // Clear selection if clicking outside an image\r\n    if (resizeStateRef.current.overlay && !resizeStateRef.current.overlay.contains(event.target)) {\r\n      clearImageSelection();\r\n    }\r\n\r\n    // Check if clicked on an image\r\n    const target = event.target;\r\n    if (isResizableImage(target)) {\r\n      // If already selected, don't reselect\r\n      if (target === resizeStateRef.current.image) {\r\n        return;\r\n      }\r\n      \r\n      // Select the new image\r\n      handleImageSelection(target);\r\n    }\r\n  }, [handleImageSelection, clearImageSelection]);\r\n\r\n  /**\r\n   * Handle keydown events (for deleting selected images, etc.)\r\n   */\r\n  const handleKeyDown = useCallback((event) => {\r\n    // Delete selected image with Delete or Backspace key\r\n    if ((event.key === 'Delete' || event.key === 'Backspace') && \r\n        resizeStateRef.current.image && \r\n        !resizeStateRef.current.isResizing) {\r\n      \r\n      // Prevent default behavior\r\n      event.preventDefault();\r\n      \r\n      // Remove the image\r\n      const imageToRemove = resizeStateRef.current.image;\r\n      if (imageToRemove.parentNode) {\r\n        imageToRemove.parentNode.removeChild(imageToRemove);\r\n        \r\n        // Clear selection\r\n        clearImageSelection();\r\n        \r\n        // Trigger input event to update document state\r\n        const inputEvent = new Event('input', { bubbles: true, cancelable: true });\r\n        editorRef.current.dispatchEvent(inputEvent);\r\n      }\r\n    }\r\n    \r\n    // Escape key to clear selection\r\n    if (event.key === 'Escape' && resizeStateRef.current.image) {\r\n      clearImageSelection();\r\n    }\r\n    \r\n    // Add keyboard shortcuts for image operations\r\n    if (resizeStateRef.current.image && !resizeStateRef.current.isResizing) {\r\n      handleImageKeyboardShortcut(event, editorRef, resizeStateRef.current.image, resizeOptionsRef.current);\r\n    }\r\n  }, [editorRef, clearImageSelection]);\r\n\r\n  /**\r\n   * Handle scroll events to update overlay position\r\n   */\r\n  const handleScroll = useCallback(() => {\r\n    if (resizeStateRef.current.overlay && resizeStateRef.current.image) {\r\n      updateResizeOverlay(resizeStateRef.current.overlay, resizeStateRef.current.image);\r\n    }\r\n  }, []);\r\n\r\n  // Add scroll listener to editor viewport\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const editor = editorRef.current;\r\n    const viewport = editor.closest('.editor-viewport');\r\n    \r\n    if (viewport) {\r\n      // Add scroll listener to viewport\r\n      viewport.addEventListener('scroll', handleScroll);\r\n      \r\n      // Also listen to window scroll in case of nested scrolling\r\n      window.addEventListener('scroll', handleScroll);\r\n    }\r\n\r\n    // Cleanup\r\n    return () => {\r\n      if (viewport) {\r\n        viewport.removeEventListener('scroll', handleScroll);\r\n      }\r\n      window.removeEventListener('scroll', handleScroll);\r\n    };\r\n  }, [editorRef, handleScroll]);\r\n\r\n  // Add event listeners when editor is available\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const editor = editorRef.current;\r\n    \r\n    // Add event listeners\r\n    editor.addEventListener('click', handleEditorClick);\r\n    editor.addEventListener('keydown', handleKeyDown);\r\n    \r\n    // Add window resize listener\r\n    window.addEventListener('resize', handleScroll);\r\n\r\n    // Cleanup\r\n    return () => {\r\n      editor.removeEventListener('click', handleEditorClick);\r\n      editor.removeEventListener('keydown', handleKeyDown);\r\n      \r\n      window.removeEventListener('resize', handleScroll);\r\n      \r\n      // Clean up any active resize operations\r\n      if (resizeStateRef.current.isResizing) {\r\n        document.removeEventListener('mousemove', handleResizeMove);\r\n        document.removeEventListener('mouseup', handleResizeEnd);\r\n        document.body.classList.remove('resize-in-progress');\r\n        document.body.style.cursor = '';\r\n      }\r\n      \r\n      // Remove overlay\r\n      if (resizeStateRef.current.overlay) {\r\n        removeResizeOverlay(resizeStateRef.current.overlay);\r\n      }\r\n    };\r\n  }, [editorRef, handleEditorClick, handleKeyDown, handleScroll, handleResizeMove, handleResizeEnd]);\r\n\r\n  // Add a mutation observer to detect when images are added/removed\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const observer = new MutationObserver((mutations) => {\r\n      mutations.forEach((mutation) => {\r\n        if (mutation.type !== 'childList') return;\r\n\r\n        // Handle removed images\r\n        mutation.removedNodes.forEach(node => {\r\n          if (node.nodeType === Node.ELEMENT_NODE && isResizableImage(node) && node === resizeStateRef.current.image) {\r\n            clearImageSelection();\r\n          }\r\n        });\r\n      });\r\n    });\r\n\r\n    observer.observe(editorRef.current, {\r\n      childList: true,\r\n      subtree: true\r\n    });\r\n\r\n    return () => observer.disconnect();\r\n  }, [editorRef, clearImageSelection, handleImageSelection]);\r\n\r\n  // This component doesn't render anything visible - it just manages the resize functionality\r\n  return null;\r\n};\r\n\r\nImageResizeHandlers.propTypes = {\r\n  editorRef: PropTypes.shape({\r\n    current: PropTypes.instanceOf(typeof Element !== 'undefined' ? Element : Object)\r\n  }).isRequired,\r\n  onImageResize: PropTypes.func,\r\n  onImageSelect: PropTypes.func,\r\n  onImageDeselect: PropTypes.func,\r\n  resizeOptions: PropTypes.shape({\r\n    minWidth: PropTypes.number,\r\n    minHeight: PropTypes.number,\r\n    maxWidth: PropTypes.number,\r\n    maxHeight: PropTypes.number,\r\n    aspectRatio: PropTypes.bool,\r\n    preserveAspectRatio: PropTypes.bool,\r\n    defaultWidth: PropTypes.number,\r\n    defaultHeight: PropTypes.number\r\n  })\r\n};\r\n\r\nImageResizeHandlers.defaultProps = {\r\n  onImageResize: undefined,\r\n  onImageSelect: undefined,\r\n  onImageDeselect: undefined,\r\n  resizeOptions: DEFAULT_IMAGE_RESIZE_OPTIONS\r\n};\r\n\r\nexport default ImageResizeHandlers;\r\n","import React, { useState, useEffect, useRef, useLayoutEffect, useCallback } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { AlignLeft, AlignCenter, AlignRight, Trash2, Scaling, ImageUpscale } from 'lucide-react';\r\nimport PropTypes from 'prop-types';\r\nimport { useDocumentActions } from '../../context/DocumentContext';\r\nimport { updateResizeOverlay } from '../../lib/editor/image-resize-utils';\r\n\r\n// Button style constants\r\nconst buttonBaseStyle = {\r\n  border: '1px solid #ccc',\r\n  borderRadius: '4px',\r\n  padding: '4px',\r\n  cursor: 'pointer',\r\n  display: 'flex',\r\n  alignItems: 'center',\r\n  justifyContent: 'center',\r\n  minWidth: '28px',\r\n  height: '28px'\r\n};\r\n\r\nconst deleteButtonStyle = {\r\n  ...buttonBaseStyle,\r\n  background: 'transparent',\r\n  color: '#dc3545',\r\n  borderColor: '#dc3545'\r\n};\r\n\r\nconst getAlignmentButtonStyle = (isActive) => ({\r\n  ...buttonBaseStyle,\r\n  background: isActive ? '#007bff' : 'transparent',\r\n  color: isActive ? '#fff' : '#333'\r\n});\r\n\r\n/**\r\n * ImageTooltipMenu - Component for image tooltip menu with alignment, aspect ratio, and delete options\r\n */\r\nconst ImageTooltipMenu = ({\r\n  imageElement,\r\n  onAlignChange,\r\n  onAspectRatioToggle,\r\n  onDelete,\r\n  onClose,\r\n  initialPreserveAspectRatio = true\r\n}) => {\r\n  const [position, setPosition] = useState({ top: 0, left: 0 });\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const [menuPosition, setMenuPosition] = useState('top'); // 'top' or 'bottom'\r\n  const [preserveAspectRatio, setPreserveAspectRatio] = useState(initialPreserveAspectRatio);\r\n  const menuRef = useRef(null);\r\n  const actions = useDocumentActions();\r\n\r\n  const syncResizeOverlayPosition = (element) => {\r\n    if (!element) {\r\n      return;\r\n    }\r\n\r\n    requestAnimationFrame(() => {\r\n      const overlay = document.querySelector('.image-resize-overlay');\r\n      if (overlay) {\r\n        updateResizeOverlay(overlay, element);\r\n      }\r\n    });\r\n  };\r\n\r\n  // Helper function to get current image state for undo operations\r\n  const getImageState = (element) => {\r\n    if (!element) return null;\r\n    const style = window.getComputedStyle(element);\r\n    return {\r\n      float: style.float || 'none',\r\n      margin: element.style.margin || '',\r\n      display: style.display || 'inline',\r\n      width: element.style.width || element.width || '',\r\n      height: element.style.height || element.height || '',\r\n      aspectRatio: preserveAspectRatio\r\n    };\r\n  };\r\n\r\n  // Get current alignment of the image\r\n  const getCurrentAlignment = useCallback(() => {\r\n    if (!imageElement) return 'left';\r\n    const style = window.getComputedStyle(imageElement);\r\n    if (style.float === 'right') return 'right';\r\n    if (style.float === 'left') return 'left';\r\n    if (style.display === 'block' && style.margin.includes('auto')) return 'center';\r\n    return 'left';\r\n  }, [imageElement]);\r\n\r\n  const [currentAlignment, setCurrentAlignment] = useState('left');\r\n\r\n  // Update current alignment when image element changes\r\n  useEffect(() => {\r\n    if (imageElement) {\r\n      setCurrentAlignment(getCurrentAlignment());\r\n    }\r\n  }, [imageElement, getCurrentAlignment]);\r\n\r\n  const calculateMenuPosition = useCallback(() => {\r\n    if (!imageElement || !menuRef.current) return;\r\n\r\n    const imageRect = imageElement.getBoundingClientRect();\r\n    const menuRect = menuRef.current.getBoundingClientRect();\r\n\r\n    const viewportWidth = window.innerWidth;\r\n    const viewportHeight = window.innerHeight;\r\n\r\n    // Check if image is visible in viewport\r\n    const isImageInViewport = (\r\n      imageRect.bottom >= 0 &&\r\n      imageRect.top <= viewportHeight &&\r\n      imageRect.right >= 0 &&\r\n      imageRect.left <= viewportWidth\r\n    );\r\n\r\n    let menuPosition = 'top';\r\n    let top = 0;\r\n    let left = 0;\r\n\r\n    if (isImageInViewport) {\r\n      const spaceAbove = imageRect.top - menuRect.height - 10;\r\n      const spaceBelow = viewportHeight - imageRect.bottom - menuRect.height - 10;\r\n\r\n      if (spaceBelow > spaceAbove && spaceBelow > 0) {\r\n        menuPosition = 'bottom';\r\n        top = imageRect.bottom + 10;\r\n      } else {\r\n        menuPosition = 'top';\r\n        top = imageRect.top - menuRect.height - 10;\r\n      }\r\n    } else {\r\n      menuPosition = 'top';\r\n      top = 10;\r\n    }\r\n\r\n    left = imageRect.left + (imageRect.width / 2) - (menuRect.width / 2);\r\n\r\n    // Ensure the menu stays within viewport\r\n    let adjustedLeft = Math.max(10, Math.min(left, viewportWidth - menuRect.width - 10));\r\n    let adjustedTop = Math.max(10, Math.min(top, viewportHeight - menuRect.height - 10));\r\n\r\n    setPosition({ top: adjustedTop, left: adjustedLeft });\r\n    setMenuPosition(menuPosition);\r\n    setIsVisible(true);\r\n  }, [imageElement]);\r\n\r\n  // Position the tooltip menu\r\n  useLayoutEffect(() => {\r\n    // Initial positioning\r\n    calculateMenuPosition();\r\n\r\n    // Add scroll listener to update position on scroll\r\n    const handleScroll = () => {\r\n      calculateMenuPosition();\r\n    };\r\n\r\n    // Also add window scroll listener for safety\r\n    window.addEventListener('scroll', handleScroll);\r\n    window.addEventListener('resize', handleScroll);\r\n\r\n    return () => {\r\n      window.removeEventListener('scroll', handleScroll);\r\n      window.removeEventListener('resize', handleScroll);\r\n      setIsVisible(false);\r\n    };\r\n  }, [imageElement, calculateMenuPosition]);\r\n\r\n  // Close menu when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (menuRef.current && !menuRef.current.contains(event.target) &&\r\n          event.target !== imageElement) {\r\n        onClose();\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, [imageElement, onClose]);\r\n\r\n  const alignmentStyles = {\r\n    left: { float: 'left', margin: '0 10px 10px 0', display: 'block' },\r\n    center: { float: 'none', margin: '10px auto', display: 'block' },\r\n    right: { float: 'right', margin: '0 0 10px 10px', display: 'block' }\r\n  };\r\n\r\n  const handleAlign = (alignment) => {\r\n    if (imageElement && alignmentStyles[alignment]) {\r\n      const beforeState = getImageState(imageElement);\r\n      const oldAlignment = currentAlignment;\r\n\r\n      const styles = alignmentStyles[alignment];\r\n      imageElement.style.float = styles.float;\r\n      imageElement.style.margin = styles.margin;\r\n      imageElement.style.display = styles.display;\r\n      setCurrentAlignment(alignment);\r\n      syncResizeOverlayPosition(imageElement);\r\n\r\n      const afterState = getImageState(imageElement);\r\n\r\n      // Record operation for undo\r\n      actions.recordOperation(\r\n        { type: 'IMAGE_ALIGN', payload: { element: imageElement, alignment, state: afterState } },\r\n        { type: 'IMAGE_ALIGN', payload: { element: imageElement, alignment: oldAlignment, state: beforeState } }\r\n      );\r\n\r\n      onAlignChange && onAlignChange(alignment);\r\n    }\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    if (imageElement && imageElement.parentNode) {\r\n      const beforeState = {\r\n        element: imageElement,\r\n        parent: imageElement.parentNode,\r\n        nextSibling: imageElement.nextSibling\r\n      };\r\n      \r\n      // Record operation for undo (re-insert the image)\r\n      actions.recordOperation(\r\n        { type: 'IMAGE_DELETE', payload: { element: imageElement } },\r\n        { type: 'IMAGE_REINSERT', payload: { state: beforeState } }\r\n      );\r\n      \r\n      imageElement.parentNode.removeChild(imageElement);\r\n      onDelete && onDelete();\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  const handleAspectRatioToggle = () => {\r\n    const oldPreserveRatio = preserveAspectRatio;\r\n    const newPreserveRatio = !preserveAspectRatio;\r\n    setPreserveAspectRatio(newPreserveRatio);\r\n\r\n    // Record operation for undo\r\n    actions.recordOperation(\r\n      { type: 'IMAGE_ASPECT_RATIO', payload: { element: imageElement, preserveAspectRatio: newPreserveRatio } },\r\n      { type: 'IMAGE_ASPECT_RATIO', payload: { element: imageElement, preserveAspectRatio: oldPreserveRatio } }\r\n    );\r\n\r\n    // Call the parent callback if provided\r\n    if (onAspectRatioToggle) {\r\n      onAspectRatioToggle(newPreserveRatio);\r\n    }\r\n  };\r\n\r\n  if (!imageElement) return null;\r\n\r\n  if (typeof document === 'undefined') {\r\n    return null;\r\n  }\r\n\r\n  return createPortal(\r\n    <div\r\n      ref={menuRef}\r\n      className=\"image-tooltip-menu\"\r\n      data-menu-position={menuPosition}\r\n      aria-hidden={!isVisible}\r\n      style={{\r\n        position: 'fixed',\r\n        top: `${position.top}px`,\r\n        left: `${position.left}px`,\r\n        zIndex: 999,\r\n        background: '#fff',\r\n        border: '1px solid #ddd',\r\n        borderRadius: '6px',\r\n        boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\r\n        padding: '8px',\r\n        display: 'flex',\r\n        gap: '2px',\r\n        alignItems: 'center',\r\n        pointerEvents: isVisible ? 'auto' : 'none',\r\n        minWidth: '140px',\r\n        minHeight: '32px',\r\n        opacity: isVisible ? 1 : 0,\r\n        visibility: isVisible ? 'visible' : 'hidden',\r\n        transition: 'opacity 0.15s ease, visibility 0.15s ease'\r\n      }}\r\n    >\r\n      {/* Aspect Ratio Toggle */}\r\n      <button\r\n        className={`tooltip-button aspect-ratio-toggle ${!preserveAspectRatio ? 'active' : ''}`}\r\n        onClick={handleAspectRatioToggle}\r\n        title={`Toggle aspect ratio preservation (currently ${preserveAspectRatio ? 'ON' : 'OFF'})`}\r\n      >\r\n        {preserveAspectRatio ? <Scaling size={14} /> : <ImageUpscale size={14} />}\r\n      </button>\r\n\r\n      {/* Alignment buttons */}\r\n      <button\r\n        className={`tooltip-button ${currentAlignment === 'left' ? 'active' : ''}`}\r\n        onClick={() => handleAlign('left')}\r\n        title=\"Align Left\"\r\n        style={getAlignmentButtonStyle(currentAlignment === 'left')}\r\n      >\r\n        <AlignLeft size={14} />\r\n      </button>\r\n      \r\n      <button\r\n        className={`tooltip-button ${currentAlignment === 'center' ? 'active' : ''}`}\r\n        onClick={() => handleAlign('center')}\r\n        title=\"Align Center\"\r\n        style={getAlignmentButtonStyle(currentAlignment === 'center')}\r\n      >\r\n        <AlignCenter size={14} />\r\n      </button>\r\n      \r\n      <button\r\n        className={`tooltip-button ${currentAlignment === 'right' ? 'active' : ''}`}\r\n        onClick={() => handleAlign('right')}\r\n        title=\"Align Right\"\r\n        style={getAlignmentButtonStyle(currentAlignment === 'right')}\r\n      >\r\n        <AlignRight size={14} />\r\n      </button>\r\n\r\n      {/* Delete button */}\r\n      <button\r\n        className=\"tooltip-button delete-button\"\r\n        onClick={handleDelete}\r\n        title=\"Delete Image\"\r\n        style={deleteButtonStyle}\r\n      >\r\n        <Trash2 size={14} />\r\n      </button>\r\n    </div>,\r\n    document.body\r\n  );\r\n};\r\n\r\nImageTooltipMenu.propTypes = {\r\n  imageElement: PropTypes.instanceOf(typeof Element !== 'undefined' ? Element : Object),\r\n  onAlignChange: PropTypes.func,\r\n  onAspectRatioToggle: PropTypes.func,\r\n  onDelete: PropTypes.func,\r\n  onClose: PropTypes.func.isRequired,\r\n  initialPreserveAspectRatio: PropTypes.bool\r\n};\r\n\r\nImageTooltipMenu.defaultProps = {\r\n  imageElement: null,\r\n  onAlignChange: undefined,\r\n  onAspectRatioToggle: undefined,\r\n  onDelete: undefined,\r\n  initialPreserveAspectRatio: true\r\n};\r\n\r\nexport default ImageTooltipMenu;","/**\r\n * DOM manipulation utilities for common patterns across components\r\n * Reduces code duplication and improves maintainability\r\n * Optimized to export only actively used functions\r\n */\r\n\r\n/**\r\n * Prevent default event behavior and stop propagation\r\n * Common pattern in resize handlers and event listeners\r\n * @param {Event} event - The event to suppress\r\n */\r\nexport const suppressEvent = (event) => {\r\n  event.preventDefault();\r\n  event.stopPropagation();\r\n};\r\n\r\n/**\r\n * Clear multiple classes from elements matching a selector\r\n * Efficiently removes one or more classes from all matching elements\r\n * @param {string} selector - CSS selector for elements\r\n * @param {string|string[]} classes - Class or classes to remove\r\n */\r\nexport const clearClasses = (selector, classes) => {\r\n  const classArray = Array.isArray(classes) ? classes : [classes];\r\n  document.querySelectorAll(selector).forEach(el => {\r\n    classArray.forEach(className => {\r\n      el.classList.remove(className);\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * Check if element is within another element\r\n * @param {Element} parent - Potential parent element\r\n * @param {Element} child - Potential child element\r\n * @returns {boolean} True if child is within parent\r\n */\r\nexport const isWithin = (parent, child) => {\r\n  if (!parent || !child) return false;\r\n  return parent.contains(child);\r\n};\r\n\r\n/**\r\n * Clear text selection\r\n * Cross-browser compatible method to deselect all selected text\r\n */\r\nexport const clearTextSelection = () => {\r\n  if (window.getSelection) {\r\n    window.getSelection().removeAllRanges();\r\n  } else if (document.selection) {\r\n    document.selection.empty();\r\n  }\r\n};\r\n","/**\r\n * Table Resize Utilities for HTML Editor\r\n * Provides functionality for resizing table columns, rows, and overall table size\r\n */\r\n\r\n/**\r\n * Default table resize options\r\n */\r\nexport const DEFAULT_TABLE_RESIZE_OPTIONS = {\r\n  minColumnWidth: 10,\r\n  minRowHeight: 8,\r\n  maxColumnWidth: 800,\r\n  maxRowHeight: 600,\r\n  tableMinWidth: 100,\r\n  tableMinHeight: 50,\r\n  tableMaxWidth: 1200,\r\n  tableMaxHeight: 800\r\n};\r\n\r\n/**\r\n * Table resize handler types\r\n */\r\nexport const TABLE_RESIZE_HANDLERS = {\r\n  COLUMN: 'column',\r\n  ROW: 'row',\r\n  TABLE_BOTTOM: 'table-bottom',\r\n  TABLE_RIGHT: 'table-right'\r\n};\r\n\r\n/**\r\n * Check if an element is a table that can be resized\r\n * @param {HTMLElement} element - Element to check\r\n * @returns {boolean} Whether the element is a resizable table\r\n */\r\nexport function isResizableTable(element) {\r\n  if (!element) return false;\r\n  return element.tagName === 'TABLE';\r\n}\r\n\r\n/**\r\n * Get table dimensions and structure\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @returns {Object} Table structure information\r\n */\r\nexport function getTableStructure(tableElement) {\r\n  if (!isResizableTable(tableElement)) {\r\n    return null;\r\n  }\r\n\r\n  const rect = tableElement.getBoundingClientRect();\r\n  const rows = Array.from(tableElement.rows);\r\n  const columns = rows.length > 0 ? rows[0].cells.length : 0;\r\n\r\n  // Get column widths - first try colgroup, then fall back to measuring cells\r\n  const columnWidths = [];\r\n  const colgroup = tableElement.querySelector('colgroup');\r\n  const cols = colgroup ? colgroup.querySelectorAll('col') : [];\r\n\r\n  if (cols.length >= columns) {\r\n    // Use colgroup widths if available and sufficient\r\n    for (let i = 0; i < columns; i++) {\r\n      const col = cols[i];\r\n      const width = col.style.width ? parseInt(col.style.width, 10) : col.offsetWidth;\r\n      columnWidths.push(width || 100); // Default width if not set\r\n    }\r\n  } else {\r\n    // Fall back to measuring first row cells\r\n    if (rows.length > 0) {\r\n      const firstRow = rows[0];\r\n      for (let i = 0; i < firstRow.cells.length; i++) {\r\n        const cell = firstRow.cells[i];\r\n        columnWidths.push(cell.offsetWidth);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Get row heights\r\n  const rowHeights = rows.map(row => {\r\n    // Use explicit height if set, otherwise measure\r\n    const explicitHeight = row.style.height ? parseInt(row.style.height, 10) : null;\r\n    return explicitHeight || row.offsetHeight;\r\n  });\r\n\r\n  return {\r\n    width: rect.width,\r\n    height: rect.height,\r\n    columns,\r\n    rows: rows.length,\r\n    columnWidths,\r\n    rowHeights,\r\n    rect\r\n  };\r\n}\r\n\r\n/**\r\n * Calculate new dimensions for table resize operations\r\n * @param {Object} params - Resize parameters\r\n * @param {string} params.type - Type of resize (column, row, table)\r\n * @param {number} params.index - Index of column/row being resized\r\n * @param {number} params.delta - Change in size\r\n * @param {Object} params.currentStructure - Current table structure\r\n * @param {Object} params.options - Resize options\r\n * @returns {Object} New dimensions\r\n */\r\nexport function calculateTableResizeDimensions({\r\n  type,\r\n  index,\r\n  delta,\r\n  currentStructure,\r\n  options = DEFAULT_TABLE_RESIZE_OPTIONS\r\n}) {\r\n  const result = {\r\n    columnWidths: [...currentStructure.columnWidths],\r\n    rowHeights: [...currentStructure.rowHeights],\r\n    tableWidth: currentStructure.width,\r\n    tableHeight: currentStructure.height\r\n  };\r\n\r\n  // Helper function to apply resize with bounds checking\r\n  const applyResize = (array, arrayIndex, delta, min, max) => {\r\n    if (arrayIndex >= 0 && arrayIndex < array.length) {\r\n      array[arrayIndex] = Math.max(min, Math.min(max, array[arrayIndex] + delta));\r\n    }\r\n  };\r\n\r\n  switch (type) {\r\n    case TABLE_RESIZE_HANDLERS.COLUMN:\r\n      applyResize(result.columnWidths, index, delta, options.minColumnWidth, options.maxColumnWidth);\r\n      result.tableWidth = currentStructure.width;\r\n      break;\r\n\r\n    case TABLE_RESIZE_HANDLERS.ROW:\r\n      applyResize(result.rowHeights, index, delta, options.minRowHeight, options.maxRowHeight);\r\n      result.tableHeight = currentStructure.height;\r\n      break;\r\n\r\n    case TABLE_RESIZE_HANDLERS.TABLE_BOTTOM:\r\n      applyResize(result.rowHeights, currentStructure.rows - 1, delta, options.minRowHeight, options.maxRowHeight);\r\n      break;\r\n\r\n    case TABLE_RESIZE_HANDLERS.TABLE_RIGHT:\r\n      applyResize(result.columnWidths, currentStructure.columns - 1, delta, options.minColumnWidth, options.maxColumnWidth);\r\n      break;\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Synchronize colgroup with actual table structure\r\n * @param {HTMLTableElement} tableElement - Table element\r\n */\r\nexport function synchronizeTableColgroup(tableElement) {\r\n  if (!isResizableTable(tableElement)) return;\r\n\r\n  const rows = Array.from(tableElement.rows);\r\n  if (rows.length === 0) return;\r\n\r\n  const columnCount = rows[0].cells.length;\r\n\r\n  // Get or create colgroup\r\n  let colgroup = tableElement.querySelector('colgroup');\r\n  if (!colgroup) {\r\n    colgroup = document.createElement('colgroup');\r\n    tableElement.insertBefore(colgroup, tableElement.firstChild);\r\n  }\r\n\r\n  // Ensure colgroup has the right number of col elements\r\n  const existingCols = colgroup.querySelectorAll('col');\r\n  const currentColCount = existingCols.length;\r\n\r\n  if (currentColCount < columnCount) {\r\n    // Add missing col elements\r\n    for (let i = currentColCount; i < columnCount; i++) {\r\n      const col = document.createElement('col');\r\n      colgroup.appendChild(col);\r\n    }\r\n  } else if (currentColCount > columnCount) {\r\n    // Remove extra col elements\r\n    for (let i = currentColCount - 1; i >= columnCount; i--) {\r\n      colgroup.removeChild(existingCols[i]);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Apply table dimensions to table element\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {Object} dimensions - New dimensions\r\n * @param {string} resizeType - Type of resize operation (optional)\r\n */\r\nexport function applyTableDimensions(tableElement, dimensions) {\r\n  if (!isResizableTable(tableElement)) return;\r\n\r\n  // First synchronize colgroup with table structure\r\n  synchronizeTableColgroup(tableElement);\r\n\r\n  const { columnWidths, rowHeights, tableWidth, tableHeight } = dimensions;\r\n\r\n  // Calculate sums once\r\n  const sumWidth = columnWidths ? columnWidths.reduce((sum, w) => sum + w, 0) : 0;\r\n  const sumHeight = rowHeights ? rowHeights.reduce((sum, h) => sum + h, 0) : 0;\r\n\r\n  // Apply table size\r\n  if (tableWidth !== undefined) {\r\n    tableElement.style.width = `${tableWidth}px`;\r\n  } else if (sumWidth > 0) {\r\n    tableElement.style.width = `${sumWidth}px`;\r\n  }\r\n\r\n  if (tableHeight !== undefined) {\r\n    tableElement.style.height = `${tableHeight}px`;\r\n  } else if (sumHeight > 0) {\r\n    tableElement.style.height = `${sumHeight}px`;\r\n  }\r\n\r\n  // Apply column widths\r\n  if (columnWidths && columnWidths.length > 0) {\r\n    // Set table-layout to fixed to ensure colgroup widths are respected\r\n    tableElement.style.tableLayout = 'fixed';\r\n\r\n    const colgroup = tableElement.querySelector('colgroup');\r\n    if (colgroup) {\r\n      const cols = colgroup.querySelectorAll('col');\r\n      cols.forEach((col, index) => {\r\n        if (index < columnWidths.length) {\r\n          col.style.width = `${columnWidths[index]}px`;\r\n        }\r\n      });\r\n    }\r\n\r\n    // Ensure table width is set to sum of column widths\r\n    tableElement.style.width = `${sumWidth}px`;\r\n  }\r\n\r\n  // Apply row heights\r\n  if (rowHeights && rowHeights.length > 0) {\r\n    const rows = Array.from(tableElement.rows);\r\n    rows.forEach((row, index) => {\r\n      if (index < rowHeights.length) {\r\n        row.style.height = `${rowHeights[index]}px`;\r\n      }\r\n    });\r\n\r\n    // Ensure table height is set to sum of row heights\r\n    tableElement.style.height = `${sumHeight}px`;\r\n  }\r\n\r\n  // Force a reflow to ensure dimensions are applied immediately\r\n  tableElement.offsetHeight;\r\n}\r\n\r\n/**\r\n * Create resize overlay for a table\r\n * @param {HTMLTableElement} tableElement - Table element to resize\r\n * @param {Object} options - Resize options\r\n * @returns {HTMLElement} Resize overlay element\r\n */\r\nexport function createTableResizeOverlay(tableElement) {\r\n  if (!isResizableTable(tableElement)) return null;\r\n\r\n  // Ensure colgroup is synchronized before creating overlay\r\n  synchronizeTableColgroup(tableElement);\r\n\r\n  const structure = getTableStructure(tableElement);\r\n  if (!structure) return null;\r\n\r\n  // Create overlay container\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'table-resize-overlay';\r\n  overlay.style.position = 'fixed';\r\n  overlay.style.zIndex = '1000';\r\n  overlay.style.pointerEvents = 'none';\r\n\r\n  // Position overlay over the table\r\n  const rect = tableElement.getBoundingClientRect();\r\n  overlay.style.top = `${rect.top}px`;\r\n  overlay.style.left = `${rect.left}px`;\r\n  overlay.style.width = `${rect.width}px`;\r\n  overlay.style.height = `${rect.height}px`;\r\n\r\n  // Create column resize handlers (one less than column count)\r\n  for (let i = 0; i < structure.columns - 1; i++) {\r\n    const handler = createIndexedResizeHandler(TABLE_RESIZE_HANDLERS.COLUMN, i, structure, rect, tableElement);\r\n    overlay.appendChild(handler);\r\n  }\r\n\r\n  // Create row resize handlers (one less than row count)\r\n  for (let i = 0; i < structure.rows - 1; i++) {\r\n    const handler = createIndexedResizeHandler(TABLE_RESIZE_HANDLERS.ROW, i, structure, rect, tableElement);\r\n    overlay.appendChild(handler);\r\n  }\r\n\r\n  // Create table bottom and right resize handlers\r\n  const bottomHandler = createBoundaryResizeHandler(TABLE_RESIZE_HANDLERS.TABLE_BOTTOM, structure, rect);\r\n  overlay.appendChild(bottomHandler);\r\n\r\n  const rightHandler = createBoundaryResizeHandler(TABLE_RESIZE_HANDLERS.TABLE_RIGHT, structure, rect);\r\n  overlay.appendChild(rightHandler);\r\n\r\n  return overlay;\r\n}\r\n\r\n/**\r\n * Handler configuration mapping for different resize types\r\n */\r\nconst HANDLER_CONFIG = {\r\n  [TABLE_RESIZE_HANDLERS.COLUMN]: {\r\n    className: 'table-resize-handler table-column-resize-handler',\r\n    cursor: 'col-resize',\r\n    isVertical: true\r\n  },\r\n  [TABLE_RESIZE_HANDLERS.ROW]: {\r\n    className: 'table-resize-handler table-row-resize-handler',\r\n    cursor: 'row-resize',\r\n    isVertical: false\r\n  },\r\n  [TABLE_RESIZE_HANDLERS.TABLE_BOTTOM]: {\r\n    className: 'table-resize-handler table-bottom-resize-handler',\r\n    cursor: 'ns-resize',\r\n    isVertical: false\r\n  },\r\n  [TABLE_RESIZE_HANDLERS.TABLE_RIGHT]: {\r\n    className: 'table-resize-handler table-right-resize-handler',\r\n    cursor: 'ew-resize',\r\n    isVertical: true\r\n  }\r\n};\r\n\r\n/**\r\n * Create a resize handler with optimized factory pattern\r\n * @param {string} type - Handler type from TABLE_RESIZE_HANDLERS\r\n * @param {number} primarySize - Width or height depending on type\r\n * @param {number} index - Index for column/row handlers (optional)\r\n * @returns {HTMLElement} Handler element\r\n */\r\nfunction createResizeHandler(type, primarySize, index) {\r\n  const config = HANDLER_CONFIG[type];\r\n  if (!config) {\r\n    console.warn(`createResizeHandler: Unknown handler type ${type}`);\r\n    return null;\r\n  }\r\n\r\n  const handler = document.createElement('div');\r\n  handler.className = config.className;\r\n  handler.dataset.type = type;\r\n  handler.style.position = 'absolute';\r\n  handler.style.cursor = config.cursor;\r\n  handler.style.pointerEvents = 'all';\r\n\r\n  if (config.isVertical) {\r\n    handler.style.width = '4px';\r\n    handler.style.height = `${primarySize}px`;\r\n  } else {\r\n    handler.style.width = `${primarySize}px`;\r\n    handler.style.height = '4px';\r\n  }\r\n\r\n  if (index !== undefined && index !== null) {\r\n    handler.dataset.index = index;\r\n  }\r\n\r\n  return handler;\r\n}\r\n\r\n/**\r\n * Factory function to create column and row handlers\r\n * @param {string} type - Handler type (column or row)\r\n * @param {number} index - Index of the column/row\r\n * @param {Object} structure - Table structure\r\n * @param {DOMRect} rect - Table bounding rect\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @returns {HTMLElement} Resize handler\r\n */\r\nfunction createIndexedResizeHandler(type, index, structure, rect, tableElement) {\r\n  const primarySize = type === TABLE_RESIZE_HANDLERS.COLUMN ? rect.height : rect.width;\r\n  const handler = createResizeHandler(type, primarySize, index);\r\n  positionResizeHandler(handler, type, index, structure, rect, tableElement);\r\n  return handler;\r\n}\r\n\r\n/**\r\n * Factory function to create table boundary handlers\r\n * @param {string} type - Handler type (table-bottom or table-right)\r\n * @param {Object} structure - Table structure\r\n * @param {DOMRect} rect - Table bounding rect\r\n * @returns {HTMLElement} Resize handler\r\n */\r\nfunction createBoundaryResizeHandler(type, structure, rect) {\r\n  const primarySize = type === TABLE_RESIZE_HANDLERS.TABLE_RIGHT ? rect.height : rect.width;\r\n  const handler = createResizeHandler(type, primarySize);\r\n  positionResizeHandler(handler, type, null, structure, rect, null);\r\n  return handler;\r\n}\r\n\r\n/**\r\n * Update table resize overlay position and size\r\n * @param {HTMLElement} overlay - Resize overlay\r\n * @param {HTMLTableElement} tableElement - Table element\r\n */\r\nexport function updateTableResizeOverlay(overlay, tableElement) {\r\n  if (!overlay || !tableElement) return;\r\n\r\n  // Ensure colgroup is synchronized\r\n  synchronizeTableColgroup(tableElement);\r\n\r\n  const structure = getTableStructure(tableElement);\r\n  if (!structure) return;\r\n\r\n  const rect = tableElement.getBoundingClientRect();\r\n\r\n  overlay.style.top = `${rect.top}px`;\r\n  overlay.style.left = `${rect.left}px`;\r\n  overlay.style.width = `${rect.width}px`;\r\n  overlay.style.height = `${rect.height}px`;\r\n\r\n  // Check if handler counts match current structure\r\n  const columnHandlers = overlay.querySelectorAll('.table-column-resize-handler');\r\n  const rowHandlers = overlay.querySelectorAll('.table-row-resize-handler');\r\n  const bottomHandler = overlay.querySelector('.table-bottom-resize-handler');\r\n  const rightHandler = overlay.querySelector('.table-right-resize-handler');\r\n\r\n  const needsRecreate = columnHandlers.length !== structure.columns - 1 ||\r\n                       rowHandlers.length !== structure.rows - 1 ||\r\n                       !bottomHandler ||\r\n                       !rightHandler;\r\n\r\n  if (needsRecreate) {\r\n    // Remove existing handlers\r\n    overlay.innerHTML = '';\r\n\r\n    // Recreate all handlers using new factory functions\r\n    for (let i = 0; i < structure.columns - 1; i++) {\r\n      const handler = createIndexedResizeHandler(TABLE_RESIZE_HANDLERS.COLUMN, i, structure, rect, tableElement);\r\n      overlay.appendChild(handler);\r\n    }\r\n\r\n    for (let i = 0; i < structure.rows - 1; i++) {\r\n      const handler = createIndexedResizeHandler(TABLE_RESIZE_HANDLERS.ROW, i, structure, rect, tableElement);\r\n      overlay.appendChild(handler);\r\n    }\r\n\r\n    const newBottomHandler = createBoundaryResizeHandler(TABLE_RESIZE_HANDLERS.TABLE_BOTTOM, structure, rect);\r\n    overlay.appendChild(newBottomHandler);\r\n\r\n    const newRightHandler = createBoundaryResizeHandler(TABLE_RESIZE_HANDLERS.TABLE_RIGHT, structure, rect);\r\n    overlay.appendChild(newRightHandler);\r\n  } else {\r\n    // Just update positions\r\n    columnHandlers.forEach((handler, index) => {\r\n      positionResizeHandler(handler, TABLE_RESIZE_HANDLERS.COLUMN, index, structure, rect, tableElement);\r\n    });\r\n\r\n    rowHandlers.forEach((handler, index) => {\r\n      positionResizeHandler(handler, TABLE_RESIZE_HANDLERS.ROW, index, structure, rect, tableElement);\r\n    });\r\n\r\n    if (bottomHandler) {\r\n      positionResizeHandler(bottomHandler, TABLE_RESIZE_HANDLERS.TABLE_BOTTOM, null, structure, rect, null);\r\n    }\r\n\r\n    if (rightHandler) {\r\n      positionResizeHandler(rightHandler, TABLE_RESIZE_HANDLERS.TABLE_RIGHT, null, structure, rect, null);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Remove table resize overlay\r\n * @param {HTMLElement} overlay - Resize overlay to remove\r\n */\r\nexport function removeTableResizeOverlay(overlay) {\r\n  if (overlay && overlay.parentNode) {\r\n    overlay.parentNode.removeChild(overlay);\r\n  }\r\n}\r\n\r\n/**\r\n * Validate table element\r\n * @param {HTMLTableElement} tableElement - Table element to validate\r\n * @param {string} operationName - Name of the operation (for error messages)\r\n * @returns {boolean} Whether validation passed\r\n */\r\nfunction validateTable(tableElement, operationName = 'Operation') {\r\n  if (!isResizableTable(tableElement)) {\r\n    console.warn(`${operationName}: Invalid table element`);\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\n/**\r\n * Create new row with cells matching a reference row\r\n * @param {HTMLTableRowElement} referenceRow - Row to match cell count\r\n * @returns {HTMLTableRowElement} New row\r\n */\r\nfunction createRowWithCells(referenceRow) {\r\n  const newRow = document.createElement('tr');\r\n  const cellCount = referenceRow.cells.length;\r\n  \r\n  for (let i = 0; i < cellCount; i++) {\r\n    const newCell = document.createElement('td');\r\n    newCell.innerHTML = '&nbsp;';\r\n    newRow.appendChild(newCell);\r\n  }\r\n  \r\n  return newRow;\r\n}\r\n\r\n/**\r\n * Insert a new row at specified position\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} rowIndex - Index of the row\r\n * @param {number} offset - Offset from rowIndex (-1 for above, 1 for below)\r\n * @returns {HTMLTableRowElement} The newly created row, or null if failed\r\n */\r\nfunction insertRowAtPosition(tableElement, rowIndex, offset = 0) {\r\n  if (!validateTable(tableElement, 'insertRowAtPosition')) {\r\n    return null;\r\n  }\r\n\r\n  const targetIndex = offset === -1 ? rowIndex : rowIndex + 1;\r\n\r\n  if (targetIndex < 0 || targetIndex > tableElement.rows.length) {\r\n    console.warn(`insertRowAtPosition: Invalid row index ${targetIndex}, table has ${tableElement.rows.length} rows`);\r\n    return null;\r\n  }\r\n\r\n  const referenceRow = tableElement.rows[offset === -1 ? rowIndex : rowIndex];\r\n  if (!referenceRow) {\r\n    console.warn(`insertRowAtPosition: Could not find reference row at index ${rowIndex}`);\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    const newRow = createRowWithCells(referenceRow);\r\n    \r\n    if (targetIndex < tableElement.rows.length) {\r\n      tableElement.rows[targetIndex].parentNode.insertBefore(newRow, tableElement.rows[targetIndex]);\r\n    } else {\r\n      tableElement.rows[tableElement.rows.length - 1].parentNode.appendChild(newRow);\r\n    }\r\n\r\n    synchronizeTableColgroup(tableElement);\r\n    const structure = getTableStructure(tableElement);\r\n    if (structure) {\r\n      applyTableDimensions(tableElement, {\r\n        columnWidths: structure.columnWidths,\r\n        rowHeights: structure.rowHeights\r\n      });\r\n    }\r\n\r\n    return newRow;\r\n  } catch (error) {\r\n    console.error('insertRowAtPosition: Failed to insert row', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Insert a new row above the specified row index\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} rowIndex - Index of the row to insert above\r\n * @returns {HTMLTableRowElement} The newly created row, or null if failed\r\n */\r\nexport function insertRowAbove(tableElement, rowIndex) {\r\n  return insertRowAtPosition(tableElement, rowIndex, -1);\r\n}\r\n\r\n/**\r\n * Insert a new row below the specified row index\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} rowIndex - Index of the row to insert below\r\n * @returns {HTMLTableRowElement} The newly created row, or null if failed\r\n */\r\nexport function insertRowBelow(tableElement, rowIndex) {\r\n  return insertRowAtPosition(tableElement, rowIndex, 1);\r\n}\r\n\r\n/**\r\n * Create new column cell for table row\r\n * @returns {HTMLTableCellElement} New cell\r\n */\r\nfunction createColumnCell() {\r\n  const newCell = document.createElement('td');\r\n  newCell.innerHTML = '&nbsp;';\r\n  return newCell;\r\n}\r\n\r\n/**\r\n * Insert a new column at specified position\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} columnIndex - Index of the column\r\n * @param {number} offset - Offset from columnIndex (-1 for left, 1 for right)\r\n * @returns {boolean} Whether the operation was successful\r\n */\r\nfunction insertColumnAtPosition(tableElement, columnIndex, offset = 0) {\r\n  if (!validateTable(tableElement, 'insertColumnAtPosition')) {\r\n    return false;\r\n  }\r\n\r\n  if (columnIndex < 0) {\r\n    console.warn(`insertColumnAtPosition: Invalid column index ${columnIndex}`);\r\n    return false;\r\n  }\r\n\r\n  const rows = Array.from(tableElement.rows);\r\n  if (rows.length === 0) {\r\n    console.warn('insertColumnAtPosition: Table has no rows');\r\n    return false;\r\n  }\r\n\r\n  const targetIndex = offset === -1 ? columnIndex : columnIndex + 1;\r\n\r\n  // Check if column index is valid\r\n  if (targetIndex > rows[0].cells.length) {\r\n    console.warn(`insertColumnAtPosition: Column index ${targetIndex} out of bounds`);\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    // Insert a cell in each row at the specified column index\r\n    for (const row of rows) {\r\n      const newCell = createColumnCell();\r\n\r\n      if (targetIndex < row.cells.length) {\r\n        row.insertBefore(newCell, row.cells[targetIndex]);\r\n      } else {\r\n        row.appendChild(newCell);\r\n      }\r\n    }\r\n\r\n    synchronizeTableColgroup(tableElement);\r\n    const structure = getTableStructure(tableElement);\r\n    if (structure) {\r\n      applyTableDimensions(tableElement, {\r\n        columnWidths: structure.columnWidths,\r\n        rowHeights: structure.rowHeights\r\n      });\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    console.error('insertColumnAtPosition: Failed to insert column', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Insert a new column to the left of the specified column index\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} columnIndex - Index of the column to insert to the left of\r\n * @returns {boolean} Whether the operation was successful\r\n */\r\nexport function insertColumnLeft(tableElement, columnIndex) {\r\n  return insertColumnAtPosition(tableElement, columnIndex, -1);\r\n}\r\n\r\n/**\r\n * Insert a new column to the right of the specified column index\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} columnIndex - Index of the column to insert to the right of\r\n * @returns {boolean} Whether the operation was successful\r\n */\r\nexport function insertColumnRight(tableElement, columnIndex) {\r\n  return insertColumnAtPosition(tableElement, columnIndex, 1);\r\n}\r\n\r\n/**\r\n * Unified positioning function for all resize handlers\r\n * @param {HTMLElement} handler - Handler element to position\r\n * @param {string} type - Handler type\r\n * @param {number} index - Index for indexed handlers (column/row)\r\n * @param {Object} structure - Table structure\r\n * @param {DOMRect} rect - Table bounding rect\r\n * @param {HTMLTableElement} tableElement - Table element\r\n */\r\nfunction positionResizeHandler(handler, type, index, structure, rect, tableElement) {\r\n  switch (type) {\r\n    case TABLE_RESIZE_HANDLERS.COLUMN:\r\n      positionColumnHandler(handler, index, structure, rect, tableElement);\r\n      break;\r\n    case TABLE_RESIZE_HANDLERS.ROW:\r\n      positionRowHandler(handler, index, structure, rect, tableElement);\r\n      break;\r\n    case TABLE_RESIZE_HANDLERS.TABLE_BOTTOM:\r\n      positionBottomHandler(handler, structure, rect);\r\n      break;\r\n    case TABLE_RESIZE_HANDLERS.TABLE_RIGHT:\r\n      positionRightHandler(handler, structure, rect);\r\n      break;\r\n  }\r\n}\r\n\r\n/**\r\n * Position a column resize handler\r\n * @param {HTMLElement} handler - Handler element\r\n * @param {number} columnIndex - Index of the column\r\n * @param {Object} structure - Table structure\r\n * @param {DOMRect} rect - Table bounding rect\r\n * @param {HTMLTableElement} tableElement - Table element\r\n */\r\nfunction positionColumnHandler(handler, columnIndex, structure, rect, tableElement) {\r\n  // Get the actual position of the column border by measuring cells\r\n  if (tableElement?.rows.length > 0 && tableElement.rows[0].cells.length > columnIndex) {\r\n    const cellRect = tableElement.rows[0].cells[columnIndex].getBoundingClientRect();\r\n    const tableRect = tableElement.getBoundingClientRect();\r\n    handler.style.left = `${cellRect.right - tableRect.left - 2}px`;\r\n    handler.style.height = `${rect.height}px`;\r\n    return;\r\n  }\r\n\r\n  // Fallback to cumulative width calculation\r\n  let left = 0;\r\n  for (let i = 0; i <= columnIndex; i++) {\r\n    left += structure.columnWidths[i];\r\n  }\r\n  handler.style.left = `${left - 2}px`;\r\n  handler.style.height = `${rect.height}px`;\r\n}\r\n\r\n/**\r\n * Position a row resize handler\r\n * @param {HTMLElement} handler - Handler element\r\n * @param {number} rowIndex - Index of the row\r\n * @param {Object} structure - Table structure\r\n * @param {DOMRect} rect - Table bounding rect\r\n * @param {HTMLTableElement} tableElement - Table element\r\n */\r\nfunction positionRowHandler(handler, rowIndex, structure, rect, tableElement) {\r\n  // Get the actual position of the row border by measuring cells\r\n  if (tableElement?.rows.length > rowIndex && tableElement.rows[rowIndex].cells.length > 0) {\r\n    const cellRect = tableElement.rows[rowIndex].cells[0].getBoundingClientRect();\r\n    const tableRect = tableElement.getBoundingClientRect();\r\n    handler.style.top = `${cellRect.bottom - tableRect.top - 2}px`;\r\n    handler.style.width = `${rect.width}px`;\r\n    return;\r\n  }\r\n\r\n  // Fallback to cumulative height calculation\r\n  let top = 0;\r\n  for (let i = 0; i <= rowIndex; i++) {\r\n    top += structure.rowHeights[i];\r\n  }\r\n  handler.style.top = `${top - 2}px`;\r\n  handler.style.width = `${rect.width}px`;\r\n}\r\n\r\n/**\r\n * Position the bottom resize handler\r\n * @param {HTMLElement} handler - Handler element\r\n * @param {Object} structure - Table structure\r\n * @param {DOMRect} rect - Table bounding rect\r\n */\r\nfunction positionBottomHandler(handler, structure, rect) {\r\n  handler.style.bottom = '-2px';\r\n  handler.style.left = '0px';\r\n  handler.style.width = `${rect.width}px`;\r\n}\r\n\r\n/**\r\n * Position the right resize handler\r\n * @param {HTMLElement} handler - Handler element\r\n * @param {Object} structure - Table structure\r\n * @param {DOMRect} rect - Table bounding rect\r\n */\r\nfunction positionRightHandler(handler, structure, rect) {\r\n  handler.style.right = '-2px';\r\n  handler.style.top = '0px';\r\n  handler.style.height = `${rect.height}px`;\r\n}\r\n\r\n\r\n\r\n/**\r\n * Delete a row or column at specified index\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} index - Index of row/column to delete\r\n * @param {string} type - Type of deletion ('row' or 'column')\r\n * @returns {boolean} Whether the operation was successful\r\n */\r\nfunction deleteTableElement(tableElement, index, type) {\r\n  if (!validateTable(tableElement, `delete${type.charAt(0).toUpperCase() + type.slice(1)}`)) {\r\n    return false;\r\n  }\r\n\r\n  if (type === 'row') {\r\n    return deleteRowInternal(tableElement, index);\r\n  } else if (type === 'column') {\r\n    return deleteColumnInternal(tableElement, index);\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Internal row deletion logic\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} rowIndex - Index of the row to delete\r\n * @returns {boolean} Whether the operation was successful\r\n */\r\nfunction deleteRowInternal(tableElement, rowIndex) {\r\n  if (rowIndex < 0 || rowIndex >= tableElement.rows.length) {\r\n    console.warn(`deleteRow: Invalid row index ${rowIndex}, table has ${tableElement.rows.length} rows`);\r\n    return false;\r\n  }\r\n\r\n  // Don't allow deleting the last row\r\n  if (tableElement.rows.length <= 1) {\r\n    console.warn('deleteRow: Cannot delete the last row in the table');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const row = tableElement.rows[rowIndex];\r\n    row.parentNode.removeChild(row);\r\n\r\n    synchronizeTableColgroup(tableElement);\r\n    const structure = getTableStructure(tableElement);\r\n    if (structure) {\r\n      applyTableDimensions(tableElement, {\r\n        columnWidths: structure.columnWidths,\r\n        rowHeights: structure.rowHeights\r\n      });\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    console.error('deleteRow: Failed to delete row', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Internal column deletion logic\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} columnIndex - Index of the column to delete\r\n * @returns {boolean} Whether the operation was successful\r\n */\r\nfunction deleteColumnInternal(tableElement, columnIndex) {\r\n  if (columnIndex < 0) {\r\n    console.warn(`deleteColumn: Invalid column index ${columnIndex}`);\r\n    return false;\r\n  }\r\n\r\n  const rows = Array.from(tableElement.rows);\r\n  if (rows.length === 0) {\r\n    console.warn('deleteColumn: Table has no rows');\r\n    return false;\r\n  }\r\n\r\n  // Check if column index is valid\r\n  if (columnIndex >= rows[0].cells.length) {\r\n    console.warn(`deleteColumn: Column index ${columnIndex} out of bounds`);\r\n    return false;\r\n  }\r\n\r\n  // Don't allow deleting if it's the last column\r\n  if (rows[0].cells.length <= 1) {\r\n    console.warn('deleteColumn: Cannot delete the last column in the table');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    // Delete the cell at the specified column index from each row\r\n    for (const row of rows) {\r\n      if (row.cells.length > columnIndex) {\r\n        row.removeChild(row.cells[columnIndex]);\r\n      }\r\n    }\r\n\r\n    synchronizeTableColgroup(tableElement);\r\n    const structure = getTableStructure(tableElement);\r\n    if (structure) {\r\n      applyTableDimensions(tableElement, {\r\n        columnWidths: structure.columnWidths,\r\n        rowHeights: structure.rowHeights\r\n      });\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    console.error('deleteColumn: Failed to delete column', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete a row at the specified row index\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} rowIndex - Index of the row to delete\r\n * @returns {boolean} Whether the operation was successful\r\n */\r\nexport function deleteRow(tableElement, rowIndex) {\r\n  return deleteTableElement(tableElement, rowIndex, 'row');\r\n}\r\n\r\n/**\r\n * Delete a column at the specified column index\r\n * @param {HTMLTableElement} tableElement - Table element\r\n * @param {number} columnIndex - Index of the column to delete\r\n * @returns {boolean} Whether the operation was successful\r\n */\r\nexport function deleteColumn(tableElement, columnIndex) {\r\n  return deleteTableElement(tableElement, columnIndex, 'column');\r\n}","import React, { useEffect, useRef, useCallback, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useDocumentActions } from '../../context/DocumentContext';\r\nimport { suppressEvent } from '../../lib/editor/dom-utils';\r\nimport {\r\n  isResizableTable,\r\n  createTableResizeOverlay,\r\n  removeTableResizeOverlay,\r\n  updateTableResizeOverlay,\r\n  calculateTableResizeDimensions,\r\n  getTableStructure,\r\n  applyTableDimensions,\r\n  TABLE_RESIZE_HANDLERS,\r\n  DEFAULT_TABLE_RESIZE_OPTIONS\r\n} from '../../lib/editor/table-resize-utils';\r\n\r\n/**\r\n * TableResizeHandlers - Component for handling table resize operations\r\n * Provides resize handlers for table columns, rows, and overall table size\r\n */\r\nconst TableResizeHandlers = ({\r\n  editorRef,\r\n  onTableResize,\r\n  onTableSelect,\r\n  onTableDeselect,\r\n  resizeOptions = DEFAULT_TABLE_RESIZE_OPTIONS\r\n}) => {\r\n  const resizeOverlayRef = useRef(null);\r\n  const resizeTableRef = useRef(null);\r\n  const resizeStartRef = useRef(null);\r\n  const resizeTypeRef = useRef(null);\r\n  const resizeIndexRef = useRef(null);\r\n  const resizeOptionsRef = useRef(resizeOptions);\r\n  const isResizingRef = useRef(false);\r\n  const [selectedTable, setSelectedTable] = useState(null);\r\n  const actions = useDocumentActions();\r\n\r\n  // Update resize options when they change\r\n  useEffect(() => {\r\n    resizeOptionsRef.current = resizeOptions;\r\n  }, [resizeOptions]);\r\n\r\n  /**\r\n   * Clear table selection\r\n   */\r\n  const clearTableSelection = useCallback(() => {\r\n    if (resizeTableRef.current) {\r\n      resizeTableRef.current.classList.remove('selected');\r\n      resizeTableRef.current = null;\r\n    }\r\n\r\n    if (resizeOverlayRef.current) {\r\n      removeTableResizeOverlay(resizeOverlayRef.current);\r\n      resizeOverlayRef.current = null;\r\n    }\r\n\r\n    setSelectedTable(null);\r\n    resizeStartRef.current = null;\r\n    resizeTypeRef.current = null;\r\n    resizeIndexRef.current = null;\r\n    isResizingRef.current = false;\r\n\r\n    // Notify parent\r\n    if (onTableDeselect) {\r\n      onTableDeselect();\r\n    }\r\n  }, [onTableDeselect]);\r\n\r\n  /**\r\n   * Start table resize operation\r\n   */\r\n  const handleResizeStart = useCallback((event) => {\r\n    suppressEvent(event);\r\n\r\n    if (!resizeTableRef.current) return;\r\n\r\n    const handler = event.currentTarget;\r\n    const type = handler.dataset.type;\r\n    const index = parseInt(handler.dataset.index, 10);\r\n\r\n    const tableRect = resizeTableRef.current.getBoundingClientRect();\r\n    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\r\n    const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;\r\n\r\n    // Store the original state for undo\r\n    const structure = getTableStructure(resizeTableRef.current);\r\n    resizeStartRef.current = {\r\n      x: event.clientX,\r\n      y: event.clientY,\r\n      structure: { ...structure }\r\n    };\r\n\r\n    resizeTypeRef.current = type;\r\n    resizeIndexRef.current = index;\r\n    isResizingRef.current = true;\r\n\r\n    // Add resize class to prevent text selection\r\n    document.body.classList.add('table-resize-in-progress');\r\n\r\n    // Update cursor based on resize type\r\n    const cursorMap = {\r\n      [TABLE_RESIZE_HANDLERS.COLUMN]: 'col-resize',\r\n      [TABLE_RESIZE_HANDLERS.ROW]: 'row-resize',\r\n      [TABLE_RESIZE_HANDLERS.TABLE_BOTTOM]: 'ns-resize',\r\n      [TABLE_RESIZE_HANDLERS.TABLE_RIGHT]: 'ew-resize'\r\n    };\r\n    const cursor = cursorMap[type] || 'default';\r\n    document.body.style.cursor = cursor;\r\n\r\n    // Add global event listeners\r\n    document.addEventListener('mousemove', handleResizeMove);\r\n    document.addEventListener('mouseup', handleResizeEnd);\r\n  }, []);\r\n\r\n  /**\r\n   * Create and attach resize overlay for a table\r\n   */\r\n  const createAndAttachOverlay = useCallback((tableElement) => {\r\n    const overlay = createTableResizeOverlay(tableElement, resizeOptionsRef.current);\r\n    if (overlay) {\r\n      resizeOverlayRef.current = overlay;\r\n      resizeTableRef.current = tableElement;\r\n\r\n      // Add overlay to document body\r\n      document.body.appendChild(overlay);\r\n\r\n      // Add event listeners to handlers\r\n      const handlers = overlay.querySelectorAll('.table-resize-handler');\r\n      handlers.forEach(handler => {\r\n        handler.addEventListener('mousedown', handleResizeStart);\r\n      });\r\n    }\r\n    return overlay;\r\n  }, [handleResizeStart]);\r\n\r\n  /**\r\n   * Handle table selection\r\n   */\r\n  const handleTableSelection = useCallback((tableElement) => {\r\n    if (!isResizableTable(tableElement)) return;\r\n\r\n    // Clear any existing resize overlay\r\n    if (resizeOverlayRef.current) {\r\n      removeTableResizeOverlay(resizeOverlayRef.current);\r\n      resizeOverlayRef.current = null;\r\n    }\r\n\r\n    // Mark table as selected\r\n    tableElement.classList.add('selected');\r\n\r\n    // Create resize overlay\r\n    const overlay = createAndAttachOverlay(tableElement);\r\n    if (overlay) {\r\n      setSelectedTable(tableElement);\r\n      // Notify parent\r\n      if (onTableSelect) {\r\n        onTableSelect(tableElement);\r\n      }\r\n    }\r\n  }, [onTableSelect, createAndAttachOverlay]);\r\n\r\n  /**\r\n   * Perform table resize operation\r\n   */\r\n  const handleResizeMove = useCallback((event) => {\r\n    if (!isResizingRef.current || !resizeTableRef.current || !resizeStartRef.current || !resizeTypeRef.current) return;\r\n\r\n    suppressEvent(event);\r\n\r\n    const { x: startX, y: startY, structure: startStructure } = resizeStartRef.current;\r\n    const type = resizeTypeRef.current;\r\n    const index = resizeIndexRef.current;\r\n    const currentX = event.clientX;\r\n    const currentY = event.clientY;\r\n\r\n    // Calculate delta based on resize type\r\n    let delta = 0;\r\n    switch (type) {\r\n      case TABLE_RESIZE_HANDLERS.COLUMN:\r\n        delta = currentX - startX;\r\n        break;\r\n      case TABLE_RESIZE_HANDLERS.ROW:\r\n        delta = currentY - startY;\r\n        break;\r\n      case TABLE_RESIZE_HANDLERS.TABLE_BOTTOM:\r\n        delta = currentY - startY;\r\n        break;\r\n      case TABLE_RESIZE_HANDLERS.TABLE_RIGHT:\r\n        delta = currentX - startX;\r\n        break;\r\n    }\r\n\r\n    // Calculate new dimensions\r\n    const newDimensions = calculateTableResizeDimensions({\r\n      type,\r\n      index,\r\n      delta,\r\n      currentStructure: startStructure,\r\n      options: resizeOptionsRef.current\r\n    });\r\n\r\n    // Apply new dimensions to the table\r\n    applyTableDimensions(resizeTableRef.current, newDimensions, type);\r\n\r\n    // Update resize overlay\r\n    if (resizeOverlayRef.current) {\r\n      updateTableResizeOverlay(resizeOverlayRef.current, resizeTableRef.current);\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * End table resize operation\r\n   */\r\n  const handleResizeEnd = useCallback((event) => {\r\n    if (!isResizingRef.current) return;\r\n\r\n    suppressEvent(event);\r\n\r\n    // Record the resize operation for undo before clearing refs\r\n    if (resizeTableRef.current && resizeStartRef.current) {\r\n      const beforeState = {\r\n        structure: resizeStartRef.current.structure\r\n      };\r\n      const afterState = {\r\n        structure: getTableStructure(resizeTableRef.current)\r\n      };\r\n\r\n      // Only record if dimensions actually changed\r\n      const hasChanged =\r\n        beforeState.structure.width !== afterState.structure.width ||\r\n        beforeState.structure.height !== afterState.structure.height ||\r\n        JSON.stringify(beforeState.structure.columnWidths) !== JSON.stringify(afterState.structure.columnWidths) ||\r\n        JSON.stringify(beforeState.structure.rowHeights) !== JSON.stringify(afterState.structure.rowHeights);\r\n\r\n      if (hasChanged) {\r\n        actions.recordOperation(\r\n          { type: 'TABLE_RESIZE', payload: { element: resizeTableRef.current, state: afterState } },\r\n          { type: 'TABLE_RESIZE', payload: { element: resizeTableRef.current, state: beforeState } }\r\n        );\r\n      }\r\n    }\r\n\r\n    resizeStartRef.current = null;\r\n    resizeTypeRef.current = null;\r\n    resizeIndexRef.current = null;\r\n    isResizingRef.current = false;\r\n\r\n    // Remove global event listeners\r\n    document.removeEventListener('mousemove', handleResizeMove);\r\n    document.removeEventListener('mouseup', handleResizeEnd);\r\n\r\n    // Remove resize classes\r\n    document.body.classList.remove('table-resize-in-progress');\r\n    document.body.style.cursor = '';\r\n\r\n    // Update content in document context\r\n    if (resizeTableRef.current) {\r\n      // Trigger input event to update document state\r\n      const inputEvent = new Event('input', { bubbles: true, cancelable: true });\r\n      resizeTableRef.current.dispatchEvent(inputEvent);\r\n\r\n      // Notify parent about resize\r\n      if (onTableResize) {\r\n        onTableResize(resizeTableRef.current, getTableStructure(resizeTableRef.current));\r\n      }\r\n    }\r\n  }, [onTableResize, actions]);\r\n\r\n  /**\r\n   * Handle click on editor to select tables\r\n   */\r\n  const handleEditorClick = useCallback((event) => {\r\n    // Clear selection if clicking outside a table\r\n    if (resizeOverlayRef.current && !resizeOverlayRef.current.contains(event.target)) {\r\n      clearTableSelection();\r\n    }\r\n\r\n    // Check if clicked on a table\r\n    const target = event.target;\r\n    const tableElement = target.closest('table');\r\n\r\n    if (tableElement && isResizableTable(tableElement)) {\r\n      // If already selected, don't reselect\r\n      if (tableElement === resizeTableRef.current) {\r\n        return;\r\n      }\r\n\r\n      // Select the new table\r\n      handleTableSelection(tableElement);\r\n    }\r\n  }, [handleTableSelection, clearTableSelection]);\r\n\r\n  /**\r\n   * Handle keydown events (for deleting selected tables, etc.)\r\n   */\r\n  const handleKeyDown = useCallback((event) => {\r\n    // Delete selected table with Delete key only\r\n    if (event.key === 'Delete' &&\r\n        resizeTableRef.current &&\r\n        !isResizingRef.current) {\r\n\r\n      // Prevent default behavior\r\n      event.preventDefault();\r\n\r\n      // Remove the table\r\n      const tableToRemove = resizeTableRef.current;\r\n      if (tableToRemove.parentNode) {\r\n        tableToRemove.parentNode.removeChild(tableToRemove);\r\n\r\n        // Clear selection\r\n        clearTableSelection();\r\n\r\n        // Trigger input event to update document state\r\n        const inputEvent = new Event('input', { bubbles: true, cancelable: true });\r\n        editorRef.current.dispatchEvent(inputEvent);\r\n      }\r\n    }\r\n\r\n    // For Backspace key, allow normal text editing behavior in cells\r\n    // Don't prevent default - let the browser handle text deletion in cells\r\n\r\n    // Escape key to clear selection\r\n    if (event.key === 'Escape' && resizeTableRef.current) {\r\n      clearTableSelection();\r\n    }\r\n  }, [editorRef, clearTableSelection]);\r\n\r\n  /**\r\n   * Handle scroll events to update overlay position\r\n   */\r\n  const handleScroll = useCallback(() => {\r\n    if (resizeOverlayRef.current && resizeTableRef.current) {\r\n      updateTableResizeOverlay(resizeOverlayRef.current, resizeTableRef.current);\r\n    }\r\n  }, []);\r\n\r\n  // Add scroll listener to editor viewport\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const editor = editorRef.current;\r\n    const viewport = editor.closest('.editor-viewport');\r\n\r\n    if (viewport) {\r\n      // Add scroll listener to viewport\r\n      viewport.addEventListener('scroll', handleScroll);\r\n\r\n      // Also listen to window scroll in case of nested scrolling\r\n      window.addEventListener('scroll', handleScroll);\r\n    }\r\n\r\n    // Cleanup\r\n    return () => {\r\n      if (viewport) {\r\n        viewport.removeEventListener('scroll', handleScroll);\r\n      }\r\n      window.removeEventListener('scroll', handleScroll);\r\n    };\r\n  }, [editorRef, handleScroll]);\r\n\r\n  // Add event listeners when editor is available\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const editor = editorRef.current;\r\n\r\n    // Add event listeners\r\n    editor.addEventListener('click', handleEditorClick);\r\n    editor.addEventListener('keydown', handleKeyDown);\r\n\r\n    // Add window resize listener\r\n    window.addEventListener('resize', handleScroll);\r\n\r\n    // Cleanup\r\n    return () => {\r\n      editor.removeEventListener('click', handleEditorClick);\r\n      editor.removeEventListener('keydown', handleKeyDown);\r\n\r\n      window.removeEventListener('resize', handleScroll);\r\n\r\n      // Clean up any active resize operations\r\n      if (isResizingRef.current) {\r\n        document.removeEventListener('mousemove', handleResizeMove);\r\n        document.removeEventListener('mouseup', handleResizeEnd);\r\n        document.body.classList.remove('table-resize-in-progress');\r\n        document.body.style.cursor = '';\r\n      }\r\n\r\n      // Remove overlay\r\n      if (resizeOverlayRef.current) {\r\n        removeTableResizeOverlay(resizeOverlayRef.current);\r\n      }\r\n    };\r\n  }, [editorRef, handleEditorClick, handleKeyDown, handleScroll, handleResizeMove, handleResizeEnd]);\r\n\r\n  // Add a mutation observer to detect when tables are added/removed or structure changes\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const observer = new MutationObserver((mutations) => {\r\n      mutations.forEach((mutation) => {\r\n        if (mutation.type === 'childList') {\r\n          // Handle removed tables\r\n          mutation.removedNodes.forEach(node => {\r\n            if (node.nodeType === Node.ELEMENT_NODE && isResizableTable(node) && node === selectedTable) {\r\n              clearTableSelection();\r\n            }\r\n          });\r\n\r\n          // Handle added tables - auto-select the first one\r\n          mutation.addedNodes.forEach(node => {\r\n            if (node.nodeType !== Node.ELEMENT_NODE) return;\r\n\r\n            // Check if node itself is a table\r\n            if (isResizableTable(node)) {\r\n              setTimeout(() => handleTableSelection(node), 50);\r\n              return;\r\n            }\r\n\r\n            // Check if node contains tables\r\n            const tables = node.querySelectorAll?.('table') || [];\r\n            if (tables.length > 0) {\r\n              setTimeout(() => handleTableSelection(tables[0]), 50);\r\n            }\r\n          });\r\n\r\n          // Check for row changes in selected table\r\n          if (selectedTable) {\r\n            const hasRowChanges = [...mutation.addedNodes, ...mutation.removedNodes].some(node =>\r\n              node.nodeType === Node.ELEMENT_NODE && node.tagName === 'TR'\r\n            );\r\n            if (hasRowChanges && resizeOverlayRef.current && resizeTableRef.current) {\r\n              removeTableResizeOverlay(resizeOverlayRef.current);\r\n              resizeOverlayRef.current = null;\r\n              createAndAttachOverlay(resizeTableRef.current);\r\n            }\r\n          }\r\n        } else if (mutation.type === 'attributes' && ['colspan', 'rowspan'].includes(mutation.attributeName)) {\r\n          // Handle colspan/rowspan changes on selected table\r\n          if (selectedTable && resizeOverlayRef.current && resizeTableRef.current) {\r\n            removeTableResizeOverlay(resizeOverlayRef.current);\r\n            resizeOverlayRef.current = null;\r\n            createAndAttachOverlay(resizeTableRef.current);\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    observer.observe(editorRef.current, {\r\n      childList: true,\r\n      subtree: true,\r\n      attributes: true,\r\n      attributeFilter: ['colspan', 'rowspan']\r\n    });\r\n\r\n    return () => observer.disconnect();\r\n  }, [editorRef, selectedTable, clearTableSelection, handleTableSelection, createAndAttachOverlay]);\r\n\r\n  // This component doesn't render anything visible - it just manages the resize functionality\r\n  return null;\r\n};\r\n\r\nTableResizeHandlers.propTypes = {\r\n  editorRef: PropTypes.shape({\r\n    current: PropTypes.instanceOf(typeof Element !== 'undefined' ? Element : Object)\r\n  }).isRequired,\r\n  onTableResize: PropTypes.func,\r\n  onTableSelect: PropTypes.func,\r\n  onTableDeselect: PropTypes.func,\r\n  resizeOptions: PropTypes.shape({\r\n    minColumnWidth: PropTypes.number,\r\n    minRowHeight: PropTypes.number,\r\n    maxColumnWidth: PropTypes.number,\r\n    maxRowHeight: PropTypes.number,\r\n    tableMinWidth: PropTypes.number,\r\n    tableMinHeight: PropTypes.number,\r\n    tableMaxWidth: PropTypes.number,\r\n    tableMaxHeight: PropTypes.number\r\n  })\r\n};\r\n\r\nTableResizeHandlers.defaultProps = {\r\n  onTableResize: undefined,\r\n  onTableSelect: undefined,\r\n  onTableDeselect: undefined,\r\n  resizeOptions: DEFAULT_TABLE_RESIZE_OPTIONS\r\n};\r\n\r\nexport default TableResizeHandlers;","import React, { useState, useEffect, useRef, useLayoutEffect, useCallback, useMemo } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { AlignLeft, AlignCenter, AlignRight, ArrowUp, ArrowDown, ArrowLeft, ArrowRight, Trash2 } from 'lucide-react';\r\nimport PropTypes from 'prop-types';\r\nimport { useDocumentActions } from '../../context/DocumentContext';\r\nimport { \r\n  updateTableResizeOverlay, \r\n  insertRowAbove, \r\n  insertRowBelow, \r\n  insertColumnLeft, \r\n  insertColumnRight, \r\n  deleteRow, \r\n  deleteColumn \r\n} from '../../lib/editor/table-resize-utils';\r\n\r\n// Constants for button styling and operation types\r\nconst BUTTON_BASE_STYLE = {\r\n  border: '1px solid #ccc',\r\n  borderRadius: '4px',\r\n  padding: '4px',\r\n  cursor: 'pointer',\r\n  display: 'flex',\r\n  alignItems: 'center',\r\n  justifyContent: 'center',\r\n  minWidth: '28px',\r\n  height: '28px'\r\n};\r\n\r\nconst ALIGNMENT_STYLES = {\r\n  left: { float: 'left', margin: '10px 10px 10px 0', marginLeft: '', marginRight: '' },\r\n  center: { float: 'none', margin: '10px auto', marginLeft: 'auto', marginRight: 'auto' },\r\n  right: { float: 'right', margin: '10px 0 10px 10px', marginLeft: '', marginRight: '' }\r\n};\r\n\r\nconst OPERATION_TYPES = {\r\n  INSERT_ROW_ABOVE: 'INSERT_ROW_ABOVE',\r\n  INSERT_ROW_BELOW: 'INSERT_ROW_BELOW',\r\n  INSERT_COL_LEFT: 'INSERT_COL_LEFT',\r\n  INSERT_COL_RIGHT: 'INSERT_COL_RIGHT',\r\n  DELETE_ROW: 'DELETE_ROW',\r\n  DELETE_COL: 'DELETE_COL'\r\n};\r\n\r\n/**\r\n * Helper utility to sync resize overlay position\r\n */\r\nconst syncResizeOverlay = (element) => {\r\n  if (!element) return;\r\n  \r\n  const callback = (el) => {\r\n    const overlay = document.querySelector('.table-resize-overlay');\r\n    if (overlay) {\r\n      updateTableResizeOverlay(overlay, el);\r\n    }\r\n  };\r\n\r\n  if (typeof window !== 'undefined' && window.requestAnimationFrame) {\r\n    window.requestAnimationFrame(() => callback(element));\r\n  } else {\r\n    setTimeout(() => callback(element), 16);\r\n  }\r\n};\r\n\r\n/**\r\n * Helper utility to get current table alignment state\r\n */\r\nconst getTableAlignmentState = (element) => {\r\n  if (!element) return null;\r\n  const style = window.getComputedStyle(element);\r\n  return {\r\n    float: style.float || 'none',\r\n    margin: element.style.margin || '',\r\n    marginLeft: element.style.marginLeft || '',\r\n    marginRight: element.style.marginRight || '',\r\n    display: style.display || 'table'\r\n  };\r\n};\r\n\r\n/**\r\n * TableTooltipMenu - Component for table tooltip menu with alignment options and row/column manipulation\r\n */\r\nconst TableTooltipMenu = ({\r\n  tableElement,\r\n  onAlignChange,\r\n  onClose,\r\n  selectedRowIndex,\r\n  selectedColIndex,\r\n  editorRef\r\n}) => {\r\n  const [position, setPosition] = useState({ top: 0, left: 0 });\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const [menuPosition, setMenuPosition] = useState('top'); // 'top' or 'bottom'\r\n  const [currentAlignment, setCurrentAlignment] = useState('left');\r\n  const menuRef = useRef(null);\r\n  const actions = useDocumentActions();\r\n\r\n  // Determine current alignment of the table\r\n  const getCurrentAlignment = useCallback(() => {\r\n    if (!tableElement) return 'left';\r\n    const style = window.getComputedStyle(tableElement);\r\n\r\n    // Check for center alignment (margin auto)\r\n    if (style.marginLeft === 'auto' && style.marginRight === 'auto') return 'center';\r\n\r\n    // Check for float alignment\r\n    if (style.float === 'right') return 'right';\r\n    if (style.float === 'left') return 'left';\r\n\r\n    return 'left';\r\n  }, [tableElement]);\r\n\r\n  // Update current alignment when table element changes\r\n  useEffect(() => {\r\n    if (tableElement) {\r\n      setCurrentAlignment(getCurrentAlignment());\r\n    }\r\n  }, [tableElement, getCurrentAlignment]);\r\n\r\n  const calculateMenuPosition = useCallback(() => {\r\n    if (!tableElement || !menuRef.current) return;\r\n\r\n    const tableRect = tableElement.getBoundingClientRect();\r\n    const menuRect = menuRef.current.getBoundingClientRect();\r\n\r\n    const viewportRect = window.visualViewport ? window.visualViewport : {\r\n      width: window.innerWidth,\r\n      height: window.innerHeight,\r\n      offsetTop: 0,\r\n      offsetLeft: 0\r\n    };\r\n\r\n    // Check if table is visible in viewport\r\n    const isTableInViewport = (\r\n      tableRect.bottom >= 0 &&\r\n      tableRect.top <= viewportRect.height &&\r\n      tableRect.right >= 0 &&\r\n      tableRect.left <= viewportRect.width\r\n    );\r\n\r\n    let menuPosition = 'top';\r\n    let top = 0;\r\n    let left = 0;\r\n\r\n    if (isTableInViewport) {\r\n      const spaceAbove = tableRect.top - menuRect.height - 10;\r\n      const spaceBelow = viewportRect.height - tableRect.bottom - menuRect.height - 10;\r\n\r\n      if (spaceBelow > spaceAbove && spaceBelow > 0) {\r\n        menuPosition = 'bottom';\r\n        top = tableRect.bottom + 10;\r\n      } else {\r\n        menuPosition = 'top';\r\n        top = tableRect.top - menuRect.height - 10;\r\n      }\r\n    } else {\r\n      menuPosition = 'top';\r\n      top = 10;\r\n    }\r\n\r\n    left = tableRect.left + (tableRect.width / 2) - (menuRect.width / 2);\r\n\r\n    // Ensure the menu stays within viewport\r\n    const viewportWidth = window.innerWidth;\r\n    const viewportHeight = window.innerHeight;\r\n\r\n    let adjustedLeft = Math.max(10, Math.min(left, viewportWidth - menuRect.width - 10));\r\n    let adjustedTop = Math.max(10, Math.min(top, viewportHeight - menuRect.height - 10));\r\n\r\n    setPosition({ top: adjustedTop, left: adjustedLeft });\r\n    setMenuPosition(menuPosition);\r\n    setIsVisible(true);\r\n  }, [tableElement]);\r\n\r\n  // Position the tooltip menu\r\n  useLayoutEffect(() => {\r\n    // Initial positioning\r\n    calculateMenuPosition();\r\n\r\n    // Add scroll listener to update position on scroll\r\n    const handleScroll = () => {\r\n      calculateMenuPosition();\r\n    };\r\n\r\n    // Add window scroll listener for safety\r\n    window.addEventListener('scroll', handleScroll);\r\n    window.addEventListener('resize', handleScroll);\r\n\r\n    return () => {\r\n      window.removeEventListener('scroll', handleScroll);\r\n      window.removeEventListener('resize', handleScroll);\r\n      setIsVisible(false);\r\n    };\r\n  }, [tableElement, calculateMenuPosition]);\r\n\r\n  // Close menu when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (menuRef.current && !menuRef.current.contains(event.target) &&\r\n          event.target !== tableElement && !tableElement.contains(event.target)) {\r\n        onClose();\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, [tableElement, onClose]);\r\n\r\n  // Handle table alignment\r\n  const handleAlign = useCallback((alignment) => {\r\n    if (!tableElement || !ALIGNMENT_STYLES[alignment]) return;\r\n\r\n    const beforeState = getTableAlignmentState(tableElement);\r\n    const oldAlignment = currentAlignment;\r\n    const styles = ALIGNMENT_STYLES[alignment];\r\n\r\n    tableElement.style.float = styles.float;\r\n    tableElement.style.margin = styles.margin;\r\n    tableElement.style.marginLeft = styles.marginLeft;\r\n    tableElement.style.marginRight = styles.marginRight;\r\n\r\n    setCurrentAlignment(alignment);\r\n    syncResizeOverlay(tableElement);\r\n\r\n    const afterState = getTableAlignmentState(tableElement);\r\n\r\n    // Record operation for undo\r\n    actions.recordOperation(\r\n      { type: 'TABLE_ALIGN', payload: { element: tableElement, alignment, state: afterState } },\r\n      { type: 'TABLE_ALIGN', payload: { element: tableElement, alignment: oldAlignment, state: beforeState } }\r\n    );\r\n\r\n    onAlignChange?.(alignment);\r\n  }, [tableElement, currentAlignment, actions, onAlignChange]);\r\n\r\n  // Factory function to create table operation handlers\r\n  const createTableOperationHandler = useCallback((operationType, operationFn) => {\r\n    return () => {\r\n      if (!tableElement) return;\r\n\r\n      const isRowOperation = operationType.includes('ROW');\r\n      const selectedIndex = isRowOperation ? selectedRowIndex : selectedColIndex;\r\n\r\n      if (selectedIndex === null || selectedIndex === undefined) return;\r\n\r\n      const result = operationFn(tableElement, selectedIndex);\r\n      if (!result) return;\r\n\r\n      // Update editor content\r\n      if (editorRef?.current) {\r\n        actions.updateContinuousContent(editorRef.current.innerHTML);\r\n      }\r\n\r\n      // Record for undo\r\n      const payload = isRowOperation \r\n        ? { element: tableElement, index: selectedIndex }\r\n        : { element: tableElement, index: selectedIndex };\r\n\r\n      actions.recordOperation(\r\n        { type: operationType, payload },\r\n        { type: operationType, payload } // Reverse operation would be same type\r\n      );\r\n\r\n      syncResizeOverlay(tableElement);\r\n      requestAnimationFrame(() => calculateMenuPosition());\r\n    };\r\n  }, [tableElement, selectedRowIndex, selectedColIndex, editorRef, actions, calculateMenuPosition]);\r\n\r\n  // Create handlers using the factory pattern\r\n  const handleInsertRowAbove = useMemo(\r\n    () => createTableOperationHandler(OPERATION_TYPES.INSERT_ROW_ABOVE, insertRowAbove),\r\n    [createTableOperationHandler]\r\n  );\r\n\r\n  const handleInsertRowBelow = useMemo(\r\n    () => createTableOperationHandler(OPERATION_TYPES.INSERT_ROW_BELOW, insertRowBelow),\r\n    [createTableOperationHandler]\r\n  );\r\n\r\n  const handleInsertColumnLeft = useMemo(\r\n    () => createTableOperationHandler(OPERATION_TYPES.INSERT_COL_LEFT, insertColumnLeft),\r\n    [createTableOperationHandler]\r\n  );\r\n\r\n  const handleInsertColumnRight = useMemo(\r\n    () => createTableOperationHandler(OPERATION_TYPES.INSERT_COL_RIGHT, insertColumnRight),\r\n    [createTableOperationHandler]\r\n  );\r\n\r\n  const handleDeleteRow = useMemo(\r\n    () => createTableOperationHandler(OPERATION_TYPES.DELETE_ROW, deleteRow),\r\n    [createTableOperationHandler]\r\n  );\r\n\r\n  const handleDeleteColumn = useMemo(\r\n    () => createTableOperationHandler(OPERATION_TYPES.DELETE_COL, deleteColumn),\r\n    [createTableOperationHandler]\r\n  );\r\n\r\n  // Reusable button style helper\r\n  const getAlignmentButtonStyle = (isActive) => ({\r\n    ...BUTTON_BASE_STYLE,\r\n    background: isActive ? '#007bff' : 'transparent',\r\n    color: isActive ? '#fff' : '#333'\r\n  });\r\n\r\n  // Action button styles\r\n  const ACTION_BUTTON_STYLES = useMemo(() => ({\r\n    rowAction: { ...BUTTON_BASE_STYLE, background: '#28a745', color: '#fff' },\r\n    colAction: { ...BUTTON_BASE_STYLE, background: '#0056b3', color: '#fff' },\r\n    delete: { ...BUTTON_BASE_STYLE, background: '#dc3545', color: '#fff' },\r\n    divider: { width: '1px', height: '24px', background: '#ddd', margin: '0 4px' }\r\n  }), []);\r\n\r\n  // Menu container styles\r\n  const MENU_CONTAINER_STYLE = useMemo(() => ({\r\n    position: 'fixed',\r\n    top: `${position.top}px`,\r\n    left: `${position.left}px`,\r\n    zIndex: 999,\r\n    background: '#fff',\r\n    border: '1px solid #ddd',\r\n    borderRadius: '6px',\r\n    boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\r\n    padding: '8px',\r\n    display: 'flex',\r\n    gap: '2px',\r\n    alignItems: 'center',\r\n    pointerEvents: isVisible ? 'auto' : 'none',\r\n    minWidth: '100px',\r\n    minHeight: '32px',\r\n    opacity: isVisible ? 1 : 0,\r\n    visibility: isVisible ? 'visible' : 'hidden',\r\n    transition: 'opacity 0.15s ease, visibility 0.15s ease'\r\n  }), [position, isVisible]);\r\n\r\n  if (!tableElement) return null;\r\n\r\n  if (typeof document === 'undefined') {\r\n    return null;\r\n  }\r\n\r\n  return createPortal(\r\n    <div\r\n      ref={menuRef}\r\n      className=\"table-tooltip-menu\"\r\n      data-menu-position={menuPosition}\r\n      aria-hidden={!isVisible}\r\n      style={MENU_CONTAINER_STYLE}\r\n    >\r\n      {/* Alignment buttons */}\r\n      <button\r\n        className={`tooltip-button ${currentAlignment === 'left' ? 'active' : ''}`}\r\n        onClick={() => handleAlign('left')}\r\n        title=\"Align Left\"\r\n        style={getAlignmentButtonStyle(currentAlignment === 'left')}\r\n      >\r\n        <AlignLeft size={14} />\r\n      </button>\r\n\r\n      <button\r\n        className={`tooltip-button ${currentAlignment === 'center' ? 'active' : ''}`}\r\n        onClick={() => handleAlign('center')}\r\n        title=\"Align Center\"\r\n        style={getAlignmentButtonStyle(currentAlignment === 'center')}\r\n      >\r\n        <AlignCenter size={14} />\r\n      </button>\r\n\r\n      <button\r\n        className={`tooltip-button ${currentAlignment === 'right' ? 'active' : ''}`}\r\n        onClick={() => handleAlign('right')}\r\n        title=\"Align Right\"\r\n        style={getAlignmentButtonStyle(currentAlignment === 'right')}\r\n      >\r\n        <AlignRight size={14} />\r\n      </button>\r\n\r\n      {/* Row operations section */}\r\n      {selectedRowIndex !== null && selectedRowIndex !== undefined && (\r\n        <>\r\n          <div style={ACTION_BUTTON_STYLES.divider} />\r\n\r\n          <button\r\n            className=\"tooltip-button insert-row-above\"\r\n            onClick={handleInsertRowAbove}\r\n            title=\"Insert Row Above\"\r\n            style={ACTION_BUTTON_STYLES.rowAction}\r\n          >\r\n            <ArrowUp size={14} />\r\n          </button>\r\n\r\n          <button\r\n            className=\"tooltip-button insert-row-below\"\r\n            onClick={handleInsertRowBelow}\r\n            title=\"Insert Row Below\"\r\n            style={ACTION_BUTTON_STYLES.rowAction}\r\n          >\r\n            <ArrowDown size={14} />\r\n          </button>\r\n\r\n          <button\r\n            className=\"tooltip-button delete-row\"\r\n            onClick={handleDeleteRow}\r\n            title=\"Delete Row\"\r\n            style={ACTION_BUTTON_STYLES.delete}\r\n          >\r\n            <Trash2 size={14} />\r\n          </button>\r\n        </>\r\n      )}\r\n\r\n      {/* Column operations section */}\r\n      {selectedColIndex !== null && selectedColIndex !== undefined && (\r\n        <>\r\n          <div style={ACTION_BUTTON_STYLES.divider} />\r\n\r\n          <button\r\n            className=\"tooltip-button insert-column-left\"\r\n            onClick={handleInsertColumnLeft}\r\n            title=\"Insert Column Left\"\r\n            style={ACTION_BUTTON_STYLES.colAction}\r\n          >\r\n            <ArrowLeft size={14} />\r\n          </button>\r\n\r\n          <button\r\n            className=\"tooltip-button insert-column-right\"\r\n            onClick={handleInsertColumnRight}\r\n            title=\"Insert Column Right\"\r\n            style={ACTION_BUTTON_STYLES.colAction}\r\n          >\r\n            <ArrowRight size={14} />\r\n          </button>\r\n\r\n          <button\r\n            className=\"tooltip-button delete-column\"\r\n            onClick={handleDeleteColumn}\r\n            title=\"Delete Column\"\r\n            style={ACTION_BUTTON_STYLES.delete}\r\n          >\r\n            <Trash2 size={14} />\r\n          </button>\r\n        </>\r\n      )}\r\n    </div>,\r\n    document.body\r\n  );\r\n};\r\n\r\nTableTooltipMenu.propTypes = {\r\n  tableElement: PropTypes.instanceOf(typeof Element !== 'undefined' ? Element : Object),\r\n  onAlignChange: PropTypes.func,\r\n  onClose: PropTypes.func.isRequired,\r\n  selectedRowIndex: PropTypes.number,\r\n  selectedColIndex: PropTypes.number,\r\n  editorRef: PropTypes.shape({\r\n    current: PropTypes.instanceOf(typeof Element !== 'undefined' ? Element : Object)\r\n  })\r\n};\r\n\r\nTableTooltipMenu.defaultProps = {\r\n  tableElement: null,\r\n  onAlignChange: undefined,\r\n  selectedRowIndex: null,\r\n  selectedColIndex: null,\r\n  editorRef: null\r\n};\r\n\r\nexport default TableTooltipMenu;","import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { clearClasses, clearTextSelection, suppressEvent, isWithin } from '../../lib/editor/dom-utils';\r\n\r\n/**\r\n * TableCellSelection - Component for handling table cell selection with automatic row/column expansion\r\n * Features:\r\n * - Cell selection with mouse drag\r\n * - Auto-select entire row when >2 cells selected horizontally\r\n * - Auto-select entire column when 2 cells selected vertically\r\n * - Visual feedback for selections\r\n */\r\n\r\n// Selection class constants\r\nconst SELECTION_CLASSES = '.table-cell-selected, .table-row-selected, .table-col-selected';\r\n\r\n/**\r\n * Clear visual selection from all cells\r\n * Extracted as a helper to avoid duplicate code\r\n */\r\nconst clearVisualSelection = () => {\r\n  clearClasses(SELECTION_CLASSES, ['table-cell-selected', 'table-row-selected', 'table-col-selected']);\r\n};\r\n\r\nconst TableCellSelection = ({\r\n  editorRef,\r\n  onCellSelectionChange\r\n}) => {\r\n  // Selection state - consolidated into a ref since this is a headless component (renders null)\r\n  // and these values don't affect rendering, only internal logic\r\n  const selectionStateRef = useRef({\r\n    selectedCells: new Set(),\r\n    selectionMode: null,\r\n    selectedRowIndex: null,\r\n    selectedColIndex: null,\r\n    currentTable: null,\r\n    isSelecting: false,\r\n    hasDragged: false,\r\n    startCell: null\r\n  });\r\n\r\n  const [isSelecting, setIsSelecting] = useState(false);\r\n  const [hasDragged, setHasDragged] = useState(false);\r\n  const [startCell, setStartCell] = useState(null);\r\n  const [currentTable, setCurrentTable] = useState(null);\r\n\r\n  const lastSelectionRef = useRef(null); // Track last selection to avoid unnecessary callbacks\r\n\r\n  /**\r\n   * Reset all selection state\r\n   */\r\n  const resetSelectionState = useCallback(() => {\r\n    selectionStateRef.current = {\r\n      selectedCells: new Set(),\r\n      selectionMode: null,\r\n      selectedRowIndex: null,\r\n      selectedColIndex: null,\r\n      currentTable: null,\r\n      isSelecting: false,\r\n      hasDragged: false,\r\n      startCell: null\r\n    };\r\n    setIsSelecting(false);\r\n    setHasDragged(false);\r\n    setStartCell(null);\r\n    setCurrentTable(null);\r\n  }, []);\r\n\r\n  // Clear all selections\r\n  const clearSelection = useCallback(() => {\r\n    resetSelectionState();\r\n    clearVisualSelection();\r\n\r\n    // Only call callback if selection actually changed\r\n    if (lastSelectionRef.current !== null) {\r\n      lastSelectionRef.current = null;\r\n      if (onCellSelectionChange) {\r\n        onCellSelectionChange(null);\r\n      }\r\n    }\r\n  }, [onCellSelectionChange, resetSelectionState]);\r\n\r\n  // Get cell coordinates within table\r\n  const getCellCoordinates = useCallback((cell) => {\r\n    const row = cell.closest('tr');\r\n    const table = cell.closest('table');\r\n\r\n    if (!row || !table) return null;\r\n\r\n    const rowIndex = Array.from(table.rows).indexOf(row);\r\n    const cellIndex = Array.from(row.cells).indexOf(cell);\r\n\r\n    return { rowIndex, cellIndex, table };\r\n  }, []);\r\n\r\n  // Check if selection should expand to row or column\r\n  const checkSelectionExpansion = useCallback((cells) => {\r\n    if (cells.size === 0) return { mode: null, rowIndex: null, colIndex: null };\r\n\r\n    const cellArray = Array.from(cells);\r\n    const firstCell = cellArray[0];\r\n    const coords = getCellCoordinates(firstCell);\r\n\r\n    if (!coords) return { mode: null, rowIndex: null, colIndex: null };\r\n\r\n    const { table } = coords;\r\n\r\n    // Check for horizontal selection (same row, multiple cells)\r\n    const sameRowCells = cellArray.filter(cell => {\r\n      const cellCoords = getCellCoordinates(cell);\r\n      return cellCoords && cellCoords.table === table && cellCoords.rowIndex === coords.rowIndex;\r\n    });\r\n\r\n    if (sameRowCells.length >= 2) {\r\n      // 2 or more cells in same row - select entire row\r\n      return { mode: 'row', rowIndex: coords.rowIndex, colIndex: null };\r\n    }\r\n\r\n    // Check for vertical selection (same column, 2 or more cells)\r\n    const sameColCells = cellArray.filter(cell => {\r\n      const cellCoords = getCellCoordinates(cell);\r\n      return cellCoords && cellCoords.table === table && cellCoords.cellIndex === coords.cellIndex;\r\n    });\r\n\r\n    if (sameColCells.length >= 2) {\r\n      // 2 or more cells in same column - select entire column\r\n      return { mode: 'column', rowIndex: null, colIndex: coords.cellIndex };\r\n    }\r\n\r\n    // Single cell - no selection (allow editing)\r\n    return { mode: null, rowIndex: null, colIndex: null };\r\n  }, [getCellCoordinates]);\r\n\r\n  /**\r\n   * Apply visual selection based on selection mode\r\n   */\r\n  const applyVisualSelection = useCallback((mode, rowIndex, colIndex, cells, table) => {\r\n    clearVisualSelection();\r\n\r\n    if (!table || !mode) return;\r\n\r\n    if (mode === 'row' && rowIndex !== null) {\r\n      // Select entire row\r\n      const row = table.rows[rowIndex];\r\n      if (row) {\r\n        Array.from(row.cells).forEach(cell => {\r\n          cell.classList.add('table-row-selected');\r\n        });\r\n      }\r\n    } else if (mode === 'column' && colIndex !== null) {\r\n      // Select entire column\r\n      Array.from(table.rows).forEach(row => {\r\n        const cell = row.cells[colIndex];\r\n        if (cell) {\r\n          cell.classList.add('table-col-selected');\r\n        }\r\n      });\r\n    } else if (mode === 'cells') {\r\n      // Select individual cells\r\n      cells.forEach(cell => {\r\n        cell.classList.add('table-cell-selected');\r\n      });\r\n    }\r\n\r\n    // Clear any text selection when applying visual selection\r\n    clearTextSelection();\r\n  }, []);\r\n\r\n  // Update selection based on current state\r\n  const updateSelection = useCallback((newCells, table) => {\r\n    const expansion = checkSelectionExpansion(newCells);\r\n\r\n    // Update ref cache\r\n    selectionStateRef.current.selectedCells = newCells;\r\n    selectionStateRef.current.selectionMode = expansion.mode;\r\n    selectionStateRef.current.selectedRowIndex = expansion.rowIndex;\r\n    selectionStateRef.current.selectedColIndex = expansion.colIndex;\r\n    selectionStateRef.current.currentTable = table;\r\n\r\n    // Only update component state if needed for event listeners\r\n    setCurrentTable(table);\r\n\r\n    applyVisualSelection(expansion.mode, expansion.rowIndex, expansion.colIndex, newCells, table);\r\n\r\n    // Only call callback if selection actually changed\r\n    const newSelection = expansion.mode ? {\r\n      mode: expansion.mode,\r\n      cells: newCells,\r\n      rowIndex: expansion.rowIndex,\r\n      colIndex: expansion.colIndex,\r\n      table\r\n    } : null;\r\n\r\n    const hasChanged = JSON.stringify(lastSelectionRef.current) !== JSON.stringify(newSelection);\r\n    if (hasChanged) {\r\n      lastSelectionRef.current = newSelection;\r\n      if (onCellSelectionChange) {\r\n        onCellSelectionChange(newSelection);\r\n      }\r\n    }\r\n  }, [checkSelectionExpansion, applyVisualSelection, onCellSelectionChange]);\r\n\r\n  // Handle mouse down on table cell\r\n  const handleMouseDown = useCallback((event) => {\r\n    const cell = event.target.closest('td, th');\r\n    if (!cell) return;\r\n\r\n    const coords = getCellCoordinates(cell);\r\n    if (!coords) return;\r\n\r\n    setIsSelecting(true);\r\n    setStartCell(cell);\r\n    setCurrentTable(coords.table);\r\n    setHasDragged(false);\r\n  }, [getCellCoordinates]);\r\n\r\n  // Handle mouse enter on table cell (for drag selection)\r\n  const handleMouseEnter = useCallback((event) => {\r\n    if (!isSelecting || !startCell) return;\r\n\r\n    const cell = event.target.closest('td, th');\r\n    if (!cell || !currentTable || !isWithin(currentTable, cell)) return;\r\n\r\n    // Mark that we've started dragging\r\n    setHasDragged(true);\r\n\r\n    // Prevent default to avoid text selection during drag\r\n    suppressEvent(event);\r\n\r\n    const startCoords = getCellCoordinates(startCell);\r\n    const currentCoords = getCellCoordinates(cell);\r\n\r\n    if (!startCoords || !currentCoords || startCoords.table !== currentCoords.table) return;\r\n\r\n    // Create rectangular selection from start to current cell\r\n    const minRow = Math.min(startCoords.rowIndex, currentCoords.rowIndex);\r\n    const maxRow = Math.max(startCoords.rowIndex, currentCoords.rowIndex);\r\n    const minCol = Math.min(startCoords.cellIndex, currentCoords.cellIndex);\r\n    const maxCol = Math.max(startCoords.cellIndex, currentCoords.cellIndex);\r\n\r\n    const newCells = new Set();\r\n\r\n    for (let row = minRow; row <= maxRow; row++) {\r\n      const tableRow = currentTable.rows[row];\r\n      if (tableRow) {\r\n        for (let col = minCol; col <= maxCol; col++) {\r\n          const tableCell = tableRow.cells[col];\r\n          if (tableCell) {\r\n            newCells.add(tableCell);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    updateSelection(newCells, currentTable);\r\n  }, [isSelecting, startCell, currentTable, getCellCoordinates, updateSelection]);\r\n\r\n  // Handle mouse up\r\n  const handleMouseUp = useCallback(() => {\r\n    // If dragging occurred, keep the selection\r\n    // If no dragging occurred, it was a single click - don't apply any selection\r\n    if (!hasDragged) {\r\n      clearSelection();\r\n    }\r\n\r\n    setIsSelecting(false);\r\n    setStartCell(null);\r\n  }, [hasDragged, clearSelection]);\r\n\r\n  // Handle click outside to clear selection\r\n  const handleClickOutside = useCallback((event) => {\r\n    const cell = event.target.closest('td, th');\r\n    const table = event.target.closest('table');\r\n\r\n    // If clicking on a cell in the same table, don't clear\r\n    if (cell && currentTable && isWithin(currentTable, cell)) return;\r\n\r\n    // If clicking on a different table, clear selection\r\n    if (table && table !== currentTable) {\r\n      clearSelection();\r\n      return;\r\n    }\r\n\r\n    // If clicking outside any table, clear selection\r\n    if (!table) {\r\n      clearSelection();\r\n    }\r\n  }, [clearSelection, currentTable]);\r\n\r\n  // Add event listeners\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const editor = editorRef.current;\r\n\r\n    // Add cell selection event listeners\r\n    const handleMouseDownCapture = (event) => {\r\n      const cell = event.target.closest('td, th');\r\n      if (cell) {\r\n        handleMouseDown(event);\r\n      }\r\n    };\r\n\r\n    const handleMouseEnterCapture = (event) => {\r\n      const cell = event.target.closest('td, th');\r\n      if (cell) {\r\n        handleMouseEnter(event);\r\n      }\r\n    };\r\n\r\n    editor.addEventListener('mousedown', handleMouseDownCapture, true);\r\n    editor.addEventListener('mouseenter', handleMouseEnterCapture, true);\r\n    document.addEventListener('mouseup', handleMouseUp);\r\n    document.addEventListener('click', handleClickOutside);\r\n\r\n    return () => {\r\n      editor.removeEventListener('mousedown', handleMouseDownCapture, true);\r\n      editor.removeEventListener('mouseenter', handleMouseEnterCapture, true);\r\n      document.removeEventListener('mouseup', handleMouseUp);\r\n      document.removeEventListener('click', handleClickOutside);\r\n    };\r\n  }, [editorRef, handleMouseDown, handleMouseEnter, handleMouseUp, handleClickOutside]);\r\n\r\n  // Clear selection when table is deleted or changed\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const observer = new MutationObserver((mutations) => {\r\n      mutations.forEach((mutation) => {\r\n        if (mutation.type === 'childList') {\r\n          // Check if our selected table was removed\r\n          if (currentTable && !editorRef.current.contains(currentTable)) {\r\n            clearSelection();\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    observer.observe(editorRef.current, {\r\n      childList: true,\r\n      subtree: true\r\n    });\r\n\r\n    return () => observer.disconnect();\r\n  }, [editorRef, clearSelection, currentTable]);\r\n\r\n  // This component doesn't render anything visible - it just manages cell selection\r\n  return null;\r\n};\r\n\r\nTableCellSelection.propTypes = {\r\n  editorRef: PropTypes.shape({\r\n    current: PropTypes.instanceOf(typeof Element !== 'undefined' ? Element : Object)\r\n  }).isRequired,\r\n  onCellSelectionChange: PropTypes.func\r\n};\r\n\r\nTableCellSelection.defaultProps = {\r\n  onCellSelectionChange: undefined\r\n};\r\n\r\nexport default TableCellSelection;","import React, { useCallback, useEffect, useRef, useState, useMemo, forwardRef, useImperativeHandle } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useDocumentState, useDocumentActions } from '../../context/DocumentContext';\r\nimport { useFormatting, useContinuousReflow, useKeyboardShortcuts, useSelectionHandling } from '../../hooks';\r\nimport { canZoomIn, canZoomOut } from '../../lib/editor/zoom-utils';\r\nimport { getPageDimensions } from '../../lib/editor/page-sizes';\r\nimport { DEFAULT_IMAGE_RESIZE_OPTIONS } from '../../lib/editor/image-resize-utils';\r\nimport { deleteImage } from '../../lib/storage/index-db';\r\nimport { normalizeContent } from '../../lib/editor/content-normalize-utils';\r\nimport { getCursorPosition } from '../../lib/editor/cursor-scroll-utils';\r\nimport Sidebar from './Sidebar';\r\nimport EditorToolbar from './EditorToolbar';\r\nimport PageView from './PageView';\r\nimport PageManager from './PageManager';\r\nimport ImageResizeHandlers from './ImageResizeHandlers';\r\nimport ImageTooltipMenu from './ImageTooltipMenu';\r\nimport TableResizeHandlers from './TableResizeHandlers';\r\nimport TableTooltipMenu from './TableTooltipMenu';\r\nimport TableCellSelection from './TableCellSelection';\r\nimport './MultiPageEditor.css';\r\n\r\nconst INITIAL_BOUNDARY_DELAY = 50;\r\nconst BOUNDARY_UPDATE_DELAY = 50;\r\nconst NAVIGATION_DELAY = 50;\r\nconst SCROLL_DEBOUNCE = 100;\r\nconst NAVIGATION_LOCK_TIMEOUT = 300;\r\n\r\n/**\r\n * HtmlEditor - Main WYSIWYG HTML Editor Component\r\n * \r\n * Exposed methods via ref:\r\n * - getHTMLContent() - Returns the current HTML content as a string\r\n * - getSelectedHTMLContent() - Returns the selected HTML content as a string (supports images and tables)\r\n * - getPlainText() - Returns the plain text content (HTML stripped)\r\n * - setContent(html) - Sets the editor content programmatically\r\n * - setPageSize(size) - Sets the page size ('A4', 'Letter', 'Legal')\r\n * - setPageMargins(margins) - Sets the page margins ('NORMAL', 'NARROW', 'MODERATE', 'WIDE', 'OFFICE_2003') or custom {top, bottom, left, right} in inches\r\n * - insertContent(html) - Inserts content at the current cursor position without replacing existing content\r\n * \r\n * @param {Object} props\r\n * @param {React.ReactNode} props.pageManagerComponent - Optional custom PageManager component from parent app\r\n * @param {Function} props.onNavigatePage - Optional callback when navigating to a page (pageIndex)\r\n * @param {Function} props.onAddPage - Optional callback when adding a page\r\n * @param {Function} props.onDeletePage - Optional callback when deleting a page (pageIndex)\r\n * @param {Function} props.onPageSizeChange - Optional callback when page size changes (newSize)\r\n * @param {Function} props.onPageMarginsChange - Optional callback when page margins change (newMargins)\r\n * @param {Function} props.onChange - Optional callback when content changes (htmlContent)\r\n * @param {boolean} props.showSidebar - Whether to show the sidebar (default: true)\r\n * @param {boolean} props.showToolbar - Whether to show the toolbar (default: true)\r\n * @param {boolean} props.showPageManager - Whether to show the PageManager component (default: true)\r\n * @param {React.Ref} ref - Forwarded ref to access editor methods\r\n */\r\nconst HtmlEditor = forwardRef(({\r\n  pageManagerComponent = null,\r\n  onNavigatePage,\r\n  onAddPage,\r\n  onDeletePage,\r\n  onPageSizeChange: onPageSizeChangeCallback,\r\n  onPageMarginsChange: onPageMarginsChangeCallback,\r\n  onChange,\r\n  showSidebar = true,\r\n  showToolbar = true,\r\n  showPageManager = true\r\n}, ref) => {\r\n  const documentState = useDocumentState();\r\n  const actions = useDocumentActions();\r\n  const { pageSize, pageMargins, continuousContent, pageBoundaries, activePage, zoomLevel, canUndo, canRedo } = documentState;\r\n\r\n  const containerRef = useRef(null);\r\n  const editorRef = useRef(null);\r\n\r\n  const { currentFormat, formatText, updateCurrentFormatFromSelection } = useFormatting();\r\n  const [imageSelected, setImageSelected] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState(null);\r\n  const [preserveAspectRatio, setPreserveAspectRatio] = useState(true);\r\n  const [tableSelected, setTableSelected] = useState(false);\r\n  const [selectedTable, setSelectedTable] = useState(null);\r\n  const [selectedRowIndex, setSelectedRowIndex] = useState(null);\r\n  const [selectedColIndex, setSelectedColIndex] = useState(null);\r\n  const {\r\n    checkAndUpdateBoundaries,\r\n    getCurrentPage,\r\n    scrollToPage,\r\n    updateBoundaries,\r\n    triggerAutoReflow,\r\n    removePageAndContent,\r\n    removePageBreak,\r\n    insertPageBreakAtBoundary\r\n  } = useContinuousReflow(pageSize, editorRef, zoomLevel, pageMargins);\r\n\r\n  const dimensions = useMemo(() => getPageDimensions(pageSize), [pageSize]);\r\n  const [sidebarCollapsed, setSidebarCollapsed] = useState(false);\r\n  const scrollTimeoutRef = useRef(null);\r\n  const addingPageRef = useRef(false);\r\n  const isNavigatingRef = useRef(false);\r\n\r\n  // Initialize editor content and sync programmatic updates\r\n  const contentSetRef = useRef(false);\r\n  const lastContentRef = useRef(continuousContent);\r\n\r\n  const navigateToNewPage = useCallback(() => {\r\n    addingPageRef.current = false;\r\n    const newPageIndex = Math.max(0, pageBoundaries.length - 1);\r\n    actions.setActivePage(newPageIndex);\r\n    setTimeout(() => {\r\n      scrollToPage(newPageIndex, containerRef);\r\n    }, NAVIGATION_DELAY);\r\n  }, [pageBoundaries.length, actions, scrollToPage]);\r\n\r\n  // Initialize editor content on mount\r\n  useEffect(() => {\r\n    if (!editorRef.current || contentSetRef.current) return;\r\n\r\n    editorRef.current.innerHTML = continuousContent;\r\n    contentSetRef.current = true;\r\n    lastContentRef.current = continuousContent;\r\n\r\n    const timer = setTimeout(() => {\r\n      updateBoundaries();\r\n    }, INITIAL_BOUNDARY_DELAY);\r\n    return () => clearTimeout(timer);\r\n  }, []); // Empty dependency array - only run once on mount\r\n\r\n  // Sync programmatic content changes to DOM\r\n  useEffect(() => {\r\n    if (!editorRef.current || !contentSetRef.current) return;\r\n\r\n    const currentDOMContent = editorRef.current.innerHTML;\r\n\r\n    // Only update if DOM is out of sync (prevents user input loops)\r\n    if (currentDOMContent !== continuousContent) {\r\n      editorRef.current.innerHTML = continuousContent;\r\n\r\n      const timer = setTimeout(() => {\r\n        updateBoundaries();\r\n\r\n        if (addingPageRef.current) {\r\n          navigateToNewPage();\r\n        }\r\n      }, BOUNDARY_UPDATE_DELAY);\r\n\r\n      lastContentRef.current = continuousContent;\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [continuousContent, updateBoundaries, navigateToNewPage]);\r\n\r\n  // Notify parent app when content changes\r\n  useEffect(() => {\r\n    if (onChange && contentSetRef.current) {\r\n      onChange(continuousContent);\r\n    }\r\n  }, [continuousContent, onChange]);\r\n\r\n  const { restoreCursorPosition, hasActiveCursorSelection } = useSelectionHandling({\r\n    updateCurrentFormatFromSelection,\r\n    editorRef\r\n  });\r\n\r\n  // Helper function to update content and trigger boundary updates\r\n  const updateContentAndBoundaries = useCallback((html) => {\r\n    // Sync state only when the new content differs to avoid redundant updates\r\n    if (html !== continuousContent) {\r\n      actions.updateContinuousContent(html);\r\n    }\r\n\r\n    if (editorRef.current && editorRef.current.innerHTML !== html) {\r\n      editorRef.current.innerHTML = html;\r\n    }\r\n\r\n    lastContentRef.current = html;\r\n\r\n    // Update boundaries after a delay\r\n    setTimeout(() => {\r\n      updateBoundaries();\r\n    }, BOUNDARY_UPDATE_DELAY);\r\n  }, [continuousContent, actions, updateBoundaries]);\r\n\r\n  // Helper function for inserting HTML content with cursor restoration\r\n  const insertHtmlWithCursorRestore = useCallback((html) => {\r\n    if (!editorRef.current || !html) return;\r\n\r\n    // If no active selection, restore the last cursor position\r\n    if (!hasActiveCursorSelection()) {\r\n      restoreCursorPosition();\r\n    }\r\n\r\n    // Insert using execCommand for proper cursor handling\r\n    document.execCommand('insertHTML', false, html);\r\n\r\n    // Update content state with the new content\r\n    const updatedContent = editorRef.current.innerHTML;\r\n    actions.updateContinuousContent(updatedContent);\r\n    lastContentRef.current = updatedContent;\r\n\r\n    // Update boundaries and trigger reflow\r\n    setTimeout(() => {\r\n      updateBoundaries();\r\n      triggerAutoReflow(200);\r\n    }, BOUNDARY_UPDATE_DELAY);\r\n  }, [hasActiveCursorSelection, restoreCursorPosition, actions, updateBoundaries, triggerAutoReflow]);\r\n\r\n  // Exposed methods for parent component via ref\r\n  const exposedMethods = useMemo(() => ({\r\n    /**\r\n     * Get the current HTML content from the editor\r\n     * Returns the actual DOM content to ensure latest changes (like indentation) are captured\r\n     * @returns {string} The HTML content with page breaks\r\n     */\r\n    getHTMLContent: () => {\r\n      // Return current DOM content if available (ensures we get the latest changes)\r\n      if (editorRef.current) {\r\n        return editorRef.current.innerHTML;\r\n      }\r\n      // Fallback to state if DOM not available\r\n      return continuousContent;\r\n    },\r\n    /**\r\n     * Get the selected HTML content from the editor\r\n     * Returns the HTML content of the selected element or the common ancestor of the selection\r\n     * Supports images and table content\r\n     * @returns {string} The selected HTML content\r\n     */\r\n    getSelectedHTMLContent: () => {\r\n      if (!editorRef.current) return '';\r\n\r\n      const selection = window.getSelection();\r\n      if (!selection || selection.rangeCount === 0) return '';\r\n\r\n      const range = selection.getRangeAt(0);\r\n      if (!editorRef.current.contains(range.commonAncestorContainer)) return '';\r\n\r\n      // If selection is collapsed (just cursor), get the element at cursor\r\n      if (range.collapsed) {\r\n        const element = range.commonAncestorContainer;\r\n        if (element.nodeType === Node.TEXT_NODE) {\r\n          // If it's a text node, get its parent element\r\n          return element.parentElement ? element.parentElement.outerHTML : '';\r\n        } else {\r\n          // If it's an element, return its HTML\r\n          return element.outerHTML || '';\r\n        }\r\n      }\r\n\r\n      // For non-collapsed selections, get the common ancestor element\r\n      let commonAncestor = range.commonAncestorContainer;\r\n      if (commonAncestor.nodeType === Node.TEXT_NODE) {\r\n        commonAncestor = commonAncestor.parentElement;\r\n      }\r\n\r\n      // If the common ancestor is the editor itself, clone the contents\r\n      if (commonAncestor === editorRef.current) {\r\n        const clonedContents = range.cloneContents();\r\n        const tempDiv = document.createElement('div');\r\n        tempDiv.appendChild(clonedContents);\r\n        return tempDiv.innerHTML;\r\n      }\r\n\r\n      // Otherwise, return the HTML of the common ancestor\r\n      return commonAncestor ? commonAncestor.outerHTML : '';\r\n    },\r\n    /**\r\n     * Get the plain text content (HTML stripped)\r\n     * @returns {string} Plain text content\r\n     */\r\n    getPlainText: () => {\r\n      // Get the most current content from DOM or state\r\n      const htmlContent = editorRef.current ? editorRef.current.innerHTML : continuousContent;\r\n      \r\n      // Strip HTML tags and normalize whitespace, preserving Unicode characters\r\n      return htmlContent\r\n        .replace(/<[^>]*>/g, ' ')\r\n        .replace(/&nbsp;/g, ' ')\r\n        .replace(/&amp;/g, '&')\r\n        .replace(/&lt;/g, '<')\r\n        .replace(/&gt;/g, '>')\r\n        .replace(/&quot;/g, '\"')\r\n        .replace(/&#39;/g, \"'\")\r\n        .replace(/\\s+/g, ' ')\r\n        .trim();\r\n    },\r\n    /**\r\n     * Get the current cursor position in the editor\r\n     * @returns {Object|null} An object with page number, line number, and character offset, or null if no selection\r\n     */\r\n    getCursorPosition: () => {\r\n      if (!editorRef.current) return null;\r\n      return getCursorPosition(editorRef.current);\r\n    },\r\n    /**\r\n     * Set the editor content programmatically\r\n     * @param {string} html - HTML content to set\r\n     */\r\n    setContent: (html) => {\r\n      const normalizedHtml = normalizeContent(html);\r\n      updateContentAndBoundaries(normalizedHtml);\r\n    },\r\n    /**\r\n     * Set the page size programmatically\r\n     * @param {string} size - Page size ('A4', 'Letter', 'Legal')\r\n     */\r\n    setPageSize: (size) => {\r\n      actions.updatePageSize(size);\r\n      // Recalculate boundaries with new page size (debounced in hook)\r\n      updateBoundaries({ pageSize: size });\r\n    },\r\n    /**\r\n     * Set the page margins programmatically\r\n     * @param {string|Object} margins - Margin preset name ('NORMAL', 'NARROW', 'MODERATE', 'WIDE', 'OFFICE_2003') or custom margin object {top, bottom, left, right} in inches\r\n     */\r\n    setPageMargins: (margins) => {\r\n      actions.updatePageMargins(margins);\r\n      // Recalculate boundaries with new margins (debounced in hook)\r\n      updateBoundaries({ pageMargins: margins });\r\n    },\r\n    /**\r\n     * Insert content at the current cursor position without replacing existing content\r\n     * Falls back to the last cursor position if no active selection in the editor\r\n     * @param {string} html - HTML content to insert\r\n     */\r\n    insertContent: (html) => {\r\n      const normalizedHtml = normalizeContent(html);\r\n      insertHtmlWithCursorRestore(normalizedHtml);\r\n    }\r\n  }), [continuousContent, actions, updateBoundaries, triggerAutoReflow, hasActiveCursorSelection, restoreCursorPosition]);\r\n\r\n  // Expose methods to parent component via ref\r\n  useImperativeHandle(ref, () => exposedMethods, [exposedMethods]);\r\n\r\n  // Extract content update logic for reuse\r\n  const updateContent = useCallback(() => {\r\n    if (!editorRef.current) return;\r\n    \r\n    let html = editorRef.current.innerHTML;\r\n    \r\n    // Normalize paragraph structure to ensure proper <p> tags\r\n    html = normalizeContent(html);\r\n    \r\n    // Update the DOM with normalized content if it changed\r\n    if (html !== editorRef.current.innerHTML) {\r\n      editorRef.current.innerHTML = html;\r\n    }\r\n    \r\n    // Record the content change for undo/redo\r\n    const previousContent = continuousContent;\r\n    if (previousContent !== html) {\r\n      // Create the operation to update content\r\n      const updateOperation = {\r\n        type: 'UPDATE_CONTINUOUS_CONTENT',\r\n        payload: html\r\n      };\r\n      \r\n      // Create the inverse operation to restore previous content\r\n      const inverseOperation = {\r\n        type: 'UPDATE_CONTINUOUS_CONTENT',\r\n        payload: previousContent\r\n      };\r\n      \r\n      // Record the operation\r\n      actions.recordOperation(updateOperation, inverseOperation);\r\n    }\r\n    \r\n    actions.updateContinuousContent(html);\r\n    \r\n    // Update page boundaries after content change (already debounced in hook)\r\n    checkAndUpdateBoundaries();\r\n    \r\n    // Trigger automatic reflow with shorter delay for typing (200ms instead of default 500ms)\r\n    triggerAutoReflow(200);\r\n    \r\n    // Update active page based on viewport scroll position\r\n    const currentPage = getCurrentPage(containerRef);\r\n    if (currentPage !== activePage) {\r\n      actions.setActivePage(currentPage);\r\n    }\r\n  }, [actions, checkAndUpdateBoundaries, getCurrentPage, activePage, triggerAutoReflow, containerRef, editorRef, continuousContent]);\r\n\r\n  const handleInput = useCallback((_event) => {\r\n    updateContent();\r\n  }, [updateContent]);\r\n\r\n  const handlePageSizeChange = useCallback((newSize) => {\r\n    actions.updatePageSize(newSize);\r\n    // Recalculate boundaries with new page size (debounced in hook)\r\n    updateBoundaries({ pageSize: newSize });\r\n    \r\n    // Call parent callback if provided\r\n    if (onPageSizeChangeCallback) {\r\n      onPageSizeChangeCallback(newSize);\r\n    }\r\n  }, [actions, updateBoundaries, onPageSizeChangeCallback]);\r\n\r\n  const handlePageMarginsChange = useCallback((newMargins) => {\r\n    actions.updatePageMargins(newMargins);\r\n    // Recalculate boundaries with new margins (debounced in hook)\r\n    updateBoundaries({ pageMargins: newMargins });\r\n    \r\n    // Call parent callback if provided\r\n    if (onPageMarginsChangeCallback) {\r\n      onPageMarginsChangeCallback(newMargins);\r\n    }\r\n  }, [actions, updateBoundaries, onPageMarginsChangeCallback]);\r\n\r\n  const handleNavigatePage = useCallback((pageIndex) => {\r\n    // Validate page index\r\n    if (pageIndex < 0 || pageIndex >= pageBoundaries.length) {\r\n      return;\r\n    }\r\n    \r\n    // Set flag to prevent handleScroll from interfering during navigation\r\n    isNavigatingRef.current = true;\r\n    \r\n    // Set active page immediately\r\n    actions.setActivePage(pageIndex);\r\n    \r\n    // Scroll to the page\r\n    scrollToPage(pageIndex, containerRef);\r\n    \r\n    // Clear the navigation flag after scroll completes\r\n    setTimeout(() => {\r\n      isNavigatingRef.current = false;\r\n    }, NAVIGATION_LOCK_TIMEOUT);\r\n    \r\n    // Call parent callback if provided\r\n    if (onNavigatePage) {\r\n      onNavigatePage(pageIndex);\r\n    }\r\n  }, [actions, scrollToPage, onNavigatePage, pageBoundaries.length]);\r\n\r\n  const handleAddPage = useCallback(() => {\r\n    // Calculate which page number we're adding (next page after current boundaries)\r\n    const nextPageNumber = pageBoundaries.length + 1;\r\n    \r\n    // Use the smart insertion function to insert at the correct boundary\r\n    const success = insertPageBreakAtBoundary(nextPageNumber);\r\n    \r\n    if (success) {\r\n      // Set flag to indicate we're adding a page for navigation\r\n      addingPageRef.current = true;\r\n      \r\n      // The insertPageBreakAtBoundary already updates content and boundaries\r\n      // We just need to handle navigation after a delay\r\n      setTimeout(() => {\r\n        if (addingPageRef.current) {\r\n          navigateToNewPage();\r\n        }\r\n      }, 100);\r\n    }\r\n    \r\n    // Call parent callback if provided\r\n    if (onAddPage) {\r\n      onAddPage();\r\n    }\r\n  }, [pageBoundaries.length, insertPageBreakAtBoundary, actions, scrollToPage, onAddPage]);\r\n\r\n  const handleAddPageBreak = useCallback(() => {\r\n    // Insert page break at current cursor position\r\n    const selection = window.getSelection();\r\n    if (selection && selection.rangeCount > 0) {\r\n      if (!editorRef?.current) return;\r\n      \r\n      // Count existing page breaks to determine the page number\r\n      const existingBreaks = editorRef.current.querySelectorAll('page-break, [data-page-break=\"true\"]');\r\n      const pageNumber = existingBreaks.length + 2; // +2 because we're creating a break for the next page\r\n      \r\n      const pageBreakHTML = `<page-break data-page-break=\"true\" contenteditable=\"false\" data-page-number=\"${pageNumber}\"></page-break><p><br></p>`;\r\n      \r\n      // Insert the page break\r\n      document.execCommand('insertHTML', false, pageBreakHTML);\r\n      \r\n      // Update boundaries after a short delay and ensure PageManager updates\r\n      setTimeout(() => {\r\n        updateBoundaries();\r\n        // Get current page based on scroll position and stay on it\r\n        const currentPage = getCurrentPage(containerRef);\r\n        actions.setActivePage(currentPage);\r\n      }, 150);\r\n    }\r\n  }, [updateBoundaries, getCurrentPage, actions, containerRef]);\r\n\r\n  const handleInsertImage = useCallback((imageHtml) => {\r\n    insertHtmlWithCursorRestore(imageHtml);\r\n  }, [insertHtmlWithCursorRestore]);\r\n\r\n  const handleRemovePageBreak = useCallback((pageBreakElement) => {\r\n    if (!pageBreakElement) return;\r\n    \r\n    // Use the removePageBreak function from the hook\r\n    // This will remove the page break and trigger reflow to re-add breaks in correct positions\r\n    const success = removePageBreak(pageBreakElement);\r\n    \r\n    if (success) {\r\n      // Update active page based on current scroll position\r\n      setTimeout(() => {\r\n        const currentPage = getCurrentPage(containerRef);\r\n        actions.setActivePage(currentPage);\r\n      }, 200);\r\n    }\r\n  }, [removePageBreak, getCurrentPage, actions, containerRef]);\r\n\r\n  const handleDeletePage = useCallback((pageIndex) => {\r\n    if (pageBoundaries.length <= 1) {\r\n      console.warn('Cannot delete the only page');\r\n      return;\r\n    }\r\n    \r\n    // Use the new removePageAndContent function from the hook\r\n    // This will remove both the page break and all content within that page\r\n    const success = removePageAndContent(pageIndex);\r\n    \r\n    if (success) {\r\n      // Set active page to the first page after deletion\r\n      actions.setActivePage(0);\r\n      \r\n      // Call parent callback if provided\r\n      if (onDeletePage) {\r\n        onDeletePage(pageIndex);\r\n      }\r\n    }\r\n  }, [pageBoundaries.length, removePageAndContent, actions, onDeletePage]);\r\n\r\n  // Action handlers object for zoom and undo/redo operations\r\n  const actionHandlers = useMemo(() => ({\r\n    handleZoomIn: () => actions.zoomIn(),\r\n    handleZoomOut: () => actions.zoomOut(),\r\n    handleZoomReset: () => actions.resetZoom(),\r\n    handleUndo: () => actions.undo(),\r\n    handleRedo: () => actions.redo()\r\n  }), [actions]);\r\n\r\n  // Extract individual handlers for use in components\r\n  const { handleZoomIn, handleZoomOut, handleZoomReset, handleUndo, handleRedo } = actionHandlers;\r\n\r\n  // Keyboard shortcuts for zoom, undo, redo\r\n  useKeyboardShortcuts(\r\n    { handleZoomIn, handleZoomOut, handleZoomReset, handleUndo, handleRedo },\r\n    { editorRef, containerRef }\r\n  );\r\n\r\n  const handleScroll = useCallback(() => {\r\n    // Early exit if refs not ready or navigating\r\n    if (!containerRef.current || !editorRef.current || isNavigatingRef.current) {\r\n      return;\r\n    }\r\n\r\n    // Clear existing timeout for debouncing\r\n    if (scrollTimeoutRef.current) {\r\n      clearTimeout(scrollTimeoutRef.current);\r\n    }\r\n\r\n    scrollTimeoutRef.current = setTimeout(() => {\r\n      // Double-check navigation state after debounce\r\n      if (isNavigatingRef.current) {\r\n        scrollTimeoutRef.current = null;\r\n        return;\r\n      }\r\n      \r\n      const currentPage = getCurrentPage(containerRef);\r\n      \r\n      // Only update if page actually changed\r\n      if (currentPage !== activePage && currentPage >= 0) {\r\n        actions.setActivePage(currentPage);\r\n      }\r\n      \r\n      scrollTimeoutRef.current = null;\r\n    }, SCROLL_DEBOUNCE);\r\n  }, [getCurrentPage, activePage, actions]);\r\n\r\n  // Word count for sidebar - memoized to prevent expensive regex on every render\r\n  const wordCount = useMemo(() => {\r\n    if (!continuousContent) return 0;\r\n    const text = continuousContent.replace(/<[^>]*>/g, ' ');\r\n    // Use Unicode-aware word matching that supports various scripts\r\n    const words = text.match(/\\p{L}+/gu);\r\n    return words ? words.length : 0;\r\n  }, [continuousContent]);\r\n\r\n  const totalPages = pageBoundaries.length || 1;\r\n\r\n  // Image resize handlers callbacks\r\n  const handleImageSelect = useCallback((imageElement) => {\r\n    setImageSelected(true);\r\n    setSelectedImage(imageElement);\r\n  }, []);\r\n\r\n  const handleImageDeselect = useCallback(() => {\r\n    setImageSelected(false);\r\n    setSelectedImage(null);\r\n  }, []);\r\n\r\n  const handleImageResize = useCallback((_, __) => {\r\n    // Image resize completed - content will be updated by the ImageResizeHandlers component\r\n    // We can add any additional handling here if needed\r\n  }, []);\r\n\r\n  // Table cell selection callback - memoized to prevent unnecessary re-renders\r\n  const handleCellSelectionChange = useCallback((selection) => {\r\n    if (selection && selection.mode === 'row') {\r\n      // Row is selected\r\n      setSelectedRowIndex(selection.rowIndex);\r\n      setSelectedColIndex(null);\r\n    } else if (selection && selection.mode === 'column') {\r\n      // Column is selected\r\n      setSelectedColIndex(selection.colIndex);\r\n      setSelectedRowIndex(null);\r\n    } else {\r\n      // No row or column selected\r\n      setSelectedRowIndex(null);\r\n      setSelectedColIndex(null);\r\n    }\r\n  }, []);\r\n\r\n  // Table resize handlers callbacks\r\n  const handleTableSelect = useCallback((tableElement) => {\r\n    setTableSelected(true);\r\n    setSelectedTable(tableElement);\r\n  }, []);\r\n\r\n  const handleTableDeselect = useCallback(() => {\r\n    setTableSelected(false);\r\n    setSelectedTable(null);\r\n  }, []);\r\n\r\n  const handleTableResize = useCallback((_, __) => {\r\n    // Table resize completed - content will be updated by the TableResizeHandlers component\r\n    // We can add any additional handling here if needed\r\n  }, []);\r\n\r\n  // Cleanup scroll timeout on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (scrollTimeoutRef.current) {\r\n        clearTimeout(scrollTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"multi-page-editor\">\r\n      {showToolbar && (\r\n        <EditorToolbar\r\n          currentFormat={{\r\n            ...currentFormat,\r\n            imageSelected\r\n          }}\r\n          onFormatText={formatText}\r\n          onAddPageBreak={handleAddPageBreak}\r\n          onInsertImage={handleInsertImage}\r\n          canUndo={canUndo}\r\n          canRedo={canRedo}\r\n        />\r\n      )}\r\n\r\n      <div className=\"editor-container\">\r\n        {showSidebar && (\r\n          <Sidebar\r\n            editorView={null}\r\n            isCollapsed={sidebarCollapsed}\r\n            onToggle={() => setSidebarCollapsed((prev) => !prev)}\r\n            wordCount={wordCount}\r\n            pageCount={totalPages}\r\n          />\r\n        )}\r\n\r\n        <div\r\n          className=\"editor-viewport continuous-scroll\"\r\n          ref={containerRef}\r\n          onScroll={handleScroll}\r\n        >\r\n          <PageView\r\n            content={continuousContent}\r\n            dimensions={dimensions}\r\n            pageSize={pageSize}\r\n            pageMargins={pageMargins}\r\n            pageBoundaries={pageBoundaries}\r\n            editorRef={editorRef}\r\n            onInput={handleInput}\r\n            onContentChange={updateContent}\r\n            onClick={() => editorRef.current?.focus()}\r\n            onRemovePageBreak={handleRemovePageBreak}\r\n            zoomLevel={zoomLevel}\r\n          />\r\n        </div>\r\n\r\n        {/* Image Resize Handlers - manages image selection and resizing */}\r\n        <ImageResizeHandlers\r\n          editorRef={editorRef}\r\n          onImageSelect={handleImageSelect}\r\n          onImageDeselect={handleImageDeselect}\r\n          onImageResize={handleImageResize}\r\n          resizeOptions={{\r\n            ...DEFAULT_IMAGE_RESIZE_OPTIONS,\r\n            preserveAspectRatio,\r\n            aspectRatio: preserveAspectRatio\r\n          }}\r\n        />\r\n\r\n        {/* Table Resize Handlers - manages table selection and resizing */}\r\n        <TableResizeHandlers\r\n          editorRef={editorRef}\r\n          onTableSelect={handleTableSelect}\r\n          onTableDeselect={handleTableDeselect}\r\n          onTableResize={handleTableResize}\r\n        />\r\n\r\n        {/* Table Cell Selection - manages cell selection within tables */}\r\n        <TableCellSelection\r\n          editorRef={editorRef}\r\n          onCellSelectionChange={handleCellSelectionChange}\r\n        />\r\n\r\n        {/* Image Tooltip Menu - shows when an image is selected */}\r\n        {imageSelected && selectedImage && (\r\n          <ImageTooltipMenu\r\n            imageElement={selectedImage}\r\n            initialPreserveAspectRatio={preserveAspectRatio}\r\n            onAlignChange={(_alignment) => {\r\n              // Handle alignment change if needed\r\n            }}\r\n            onAspectRatioToggle={(newPreserveRatio) => {\r\n              setPreserveAspectRatio(newPreserveRatio);\r\n            }}\r\n            onDelete={() => {\r\n              // Handle image deletion from IndexedDB and DOM\r\n              if (selectedImage) {\r\n                const imageKey = selectedImage.getAttribute('data-key');\r\n                if (imageKey) {\r\n                  // Delete from IndexedDB\r\n                  deleteImage(imageKey).catch(error => {\r\n                    console.error('Failed to delete image from IndexedDB:', error);\r\n                  });\r\n                }\r\n                // Remove from DOM (handled by ImageTooltipMenu)\r\n              }\r\n            }}\r\n            onClose={handleImageDeselect}\r\n          />\r\n        )}\r\n\r\n        {/* Table Tooltip Menu - shows when a table is selected */}\r\n        {tableSelected && selectedTable && (\r\n          <TableTooltipMenu\r\n            tableElement={selectedTable}\r\n            onAlignChange={(_alignment) => {\r\n              // Handle alignment change if needed\r\n            }}\r\n            onClose={handleTableDeselect}\r\n            selectedRowIndex={selectedRowIndex}\r\n            selectedColIndex={selectedColIndex}\r\n            editorRef={editorRef}\r\n          />\r\n        )}\r\n\r\n        {/* Render PageManager only if showPageManager is true */}\r\n        {showPageManager && (\r\n          <div className=\"page-manager-sidebar\">\r\n            {pageManagerComponent ? (\r\n              React.cloneElement(pageManagerComponent, {\r\n                onNavigate: handleNavigatePage,\r\n                onAddPage: handleAddPage,\r\n                onDeletePage: handleDeletePage,\r\n                onPageSizeChange: handlePageSizeChange,\r\n                onPageMarginsChange: handlePageMarginsChange,\r\n                zoomLevel,\r\n                canZoomIn: canZoomIn(zoomLevel),\r\n                canZoomOut: canZoomOut(zoomLevel),\r\n                onZoomIn: handleZoomIn,\r\n                onZoomOut: handleZoomOut,\r\n                onZoomReset: handleZoomReset\r\n              })\r\n            ) : (\r\n              <PageManager\r\n                pageBoundaries={pageBoundaries}\r\n                activePage={activePage}\r\n                pageSize={pageSize}\r\n                pageMargins={pageMargins}\r\n                zoomLevel={zoomLevel}\r\n                canZoomIn={canZoomIn(zoomLevel)}\r\n                canZoomOut={canZoomOut(zoomLevel)}\r\n                onNavigate={handleNavigatePage}\r\n                onAddPage={handleAddPage}\r\n                onDeletePage={handleDeletePage}\r\n                onPageSizeChange={handlePageSizeChange}\r\n                onPageMarginsChange={handlePageMarginsChange}\r\n                onZoomIn={handleZoomIn}\r\n                onZoomOut={handleZoomOut}\r\n                onZoomReset={handleZoomReset}\r\n              />\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nHtmlEditor.displayName = 'HtmlEditor';\r\n\r\nHtmlEditor.propTypes = {\r\n  pageManagerComponent: PropTypes.element,\r\n  onNavigatePage: PropTypes.func,\r\n  onAddPage: PropTypes.func,\r\n  onDeletePage: PropTypes.func,\r\n  onPageSizeChange: PropTypes.func,\r\n  onPageMarginsChange: PropTypes.func,\r\n  onChange: PropTypes.func,\r\n  showSidebar: PropTypes.bool,\r\n  showToolbar: PropTypes.bool,\r\n  showPageManager: PropTypes.bool\r\n};\r\n\r\nHtmlEditor.defaultProps = {\r\n  pageManagerComponent: null,\r\n  onNavigatePage: undefined,\r\n  onAddPage: undefined,\r\n  onDeletePage: undefined,\r\n  onPageSizeChange: undefined,\r\n  onPageMarginsChange: undefined,\r\n  onChange: undefined,\r\n  showSidebar: true,\r\n  showToolbar: true,\r\n  showPageManager: true\r\n};\r\n\r\nexport default HtmlEditor;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\n/**\r\n * ErrorBoundary - Catches React errors and displays a fallback UI\r\n * Prevents the entire app from crashing due to component errors\r\n * \r\n * Usage:\r\n * <ErrorBoundary fallback={<div>Something went wrong</div>}>\r\n *   <YourComponent />\r\n * </ErrorBoundary>\r\n */\r\nclass ErrorBoundary extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      hasError: false,\r\n      error: null,\r\n      errorInfo: null\r\n    };\r\n  }\r\n\r\n  static getDerivedStateFromError(error) {\r\n    // Update state so the next render will show the fallback UI\r\n    return { hasError: true };\r\n  }\r\n\r\n  componentDidCatch(error, errorInfo) {\r\n    // Log error details for debugging\r\n    console.error('[ErrorBoundary] Caught error:', error);\r\n    console.error('[ErrorBoundary] Error info:', errorInfo);\r\n\r\n    this.setState({\r\n      error,\r\n      errorInfo\r\n    });\r\n\r\n    // Call optional error callback\r\n    if (this.props.onError) {\r\n      this.props.onError(error, errorInfo);\r\n    }\r\n  }\r\n\r\n  handleReset = () => {\r\n    this.setState({\r\n      hasError: false,\r\n      error: null,\r\n      errorInfo: null\r\n    });\r\n\r\n    if (this.props.onReset) {\r\n      this.props.onReset();\r\n    }\r\n  };\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      // Custom fallback UI\r\n      if (this.props.fallback) {\r\n        return this.props.fallback;\r\n      }\r\n\r\n      // Default fallback UI\r\n      return (\r\n        <div style={{\r\n          padding: '20px',\r\n          margin: '20px',\r\n          border: '2px solid #f44336',\r\n          borderRadius: '4px',\r\n          backgroundColor: '#ffebee',\r\n          color: '#c62828'\r\n        }}>\r\n          <h2 style={{ marginTop: 0 }}>⚠️ Something went wrong</h2>\r\n          <p>The editor encountered an unexpected error and couldn't continue.</p>\r\n          \r\n          {this.props.showDetails && this.state.error && (\r\n            <details style={{ \r\n              marginTop: '10px', \r\n              padding: '10px', \r\n              backgroundColor: 'white',\r\n              borderRadius: '4px',\r\n              fontSize: '12px',\r\n              fontFamily: 'monospace'\r\n            }}>\r\n              <summary style={{ cursor: 'pointer', fontWeight: 'bold' }}>\r\n                Error Details\r\n              </summary>\r\n              <pre style={{ \r\n                marginTop: '10px', \r\n                overflow: 'auto',\r\n                maxHeight: '200px'\r\n              }}>\r\n                {this.state.error.toString()}\r\n                {this.state.errorInfo && this.state.errorInfo.componentStack}\r\n              </pre>\r\n            </details>\r\n          )}\r\n          \r\n          <button\r\n            onClick={this.handleReset}\r\n            style={{\r\n              marginTop: '15px',\r\n              padding: '8px 16px',\r\n              backgroundColor: '#f44336',\r\n              color: 'white',\r\n              border: 'none',\r\n              borderRadius: '4px',\r\n              cursor: 'pointer',\r\n              fontWeight: 'bold'\r\n            }}\r\n          >\r\n            Try Again\r\n          </button>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\nErrorBoundary.propTypes = {\r\n  children: PropTypes.node.isRequired,\r\n  fallback: PropTypes.node,\r\n  onError: PropTypes.func,\r\n  onReset: PropTypes.func,\r\n  showDetails: PropTypes.bool\r\n};\r\n\r\nErrorBoundary.defaultProps = {\r\n  fallback: null,\r\n  onError: undefined,\r\n  onReset: undefined,\r\n  showDetails: process.env.NODE_ENV === 'development'\r\n};\r\n\r\nexport default ErrorBoundary;\r\n"],"names":["REACT_ELEMENT_TYPE","REACT_FRAGMENT_TYPE","jsxProd","type","config","maybeKey","key","propName","reactJsxRuntime_production","getComponentNameFromType","REACT_CLIENT_REFERENCE","REACT_PROFILER_TYPE","REACT_STRICT_MODE_TYPE","REACT_SUSPENSE_TYPE","REACT_SUSPENSE_LIST_TYPE","REACT_ACTIVITY_TYPE","REACT_PORTAL_TYPE","REACT_CONTEXT_TYPE","REACT_CONSUMER_TYPE","REACT_FORWARD_REF_TYPE","innerType","REACT_MEMO_TYPE","REACT_LAZY_TYPE","testStringCoercion","value","checkKeyStringCoercion","JSCompiler_inline_result","JSCompiler_temp_const","JSCompiler_inline_result$jscomp$0","getTaskName","name","getOwner","dispatcher","ReactSharedInternals","UnknownOwner","hasValidKey","hasOwnProperty","getter","defineKeyPropWarningGetter","props","displayName","warnAboutAccessingKey","specialPropKeyWarningShown","elementRefGetterWithDeprecationWarning","componentName","didWarnAboutElementRef","ReactElement","owner","debugStack","debugTask","refProp","jsxDEVImpl","isStaticChildren","children","isArrayImpl","validateChildKeys","keys","k","didWarnAboutKeySpread","node","isValidElement","object","React","require$$0","createTask","callStackForError","unknownOwnerDebugStack","unknownOwnerDebugTask","reactJsxRuntime_development","trackActualOwner","jsxRuntimeModule","require$$1","DEFAULT_ZOOM","MIN_ZOOM","MAX_ZOOM","ZOOM_STEP","canZoomIn","currentZoom","canZoomOut","CSS_DPI","inchesToPixels","inches","MARGIN_PRESETS","DEFAULT_MARGIN_PRESET","getMarginPixels","marginInput","preset","getTotalVerticalMargins","margins","getMarginPresetNames","getMarginPresetLabel","PAGE_SIZES","DEFAULT_PAGE_SIZE","getPageDimensions","size","pageSize","isValidPageSize","getAvailablePageSizes","PAGE_SIZE_DEFAULT","EMPTY_PARAGRAPH","DEFAULT_EDITOR_MODE","createEmptyPage","index","uuidv4","sanitizeContent","html","withMinimumPage","pages","page","createDefaultBoundary","generatePageBreaks","_","buildInitialState","overrides","now","ActionTypes","documentReducer","state","action","initialContent","pageIndex","content","newPages","payload","nextPages","pageBreaks","insertIndex","updatedPages","newActivePage","maxPage","newSize","newContent","boundaries","position","pageBreakTag","before","after","tempDiv","targetBreak","newBreak","newParagraph","breakEl","newMode","newZoomLevel","checkCanZoomIn","checkCanZoomOut","newMargins","operation","inverseOperation","lastOperation","newUndoStack","newState","operationToRedo","newRedoStack","DocumentContext","createContext","DocumentProvider","initialState","dispatch","useReducer","actions","useMemo","title","mode","level","jsx","useDocument","context","useContext","useDocumentState","useDocumentActions","FONT_SIZE_MAP","COMMON_FONT_SIZES","DEFAULT_FONT_SIZE","pointsToPixels","points","pixelsToPoints","pixels","getPixelValue","pt","fontSize","getPointValue","px","pixelValue","isValidFontSize","DEFAULT_FORMAT","useFormatting","currentFormat","setCurrentFormat","useState","applyStyleToSelection","useCallback","styleProperty","fallbackCommand","selection","range","prev","span","fragment","mappedValue","error","handleFontName","handleFontSize","handleFontColor","updateAlignmentState","textAlign","handleTextAlignment","command","selectedText","startContainer","element","blockElement","findNearestBlockElement","createParagraphAtCursor","blockElements","findBlockElementsInRange","p","block","handleInsertHTML","child","startElement","blockTagName","nextSibling","remainingText","newBlock","parent","fallbackError","formatText","updateCurrentFormatFromSelection","fontFamily","fontColor","headingLevel","computedStyle","computedFontSize","computedFontFamily","computedFontColor","rgbToHex","tagName","computedTextAlign","formatState","resetFormat","rgb","result","r","g","b","current","endContainer","startBlock","endBlock","walker","PAGE_BREAK_SELECTOR","calculatePageBoundaries","editor","options","targetPageSize","dimensions","pageBreakElements","editorRect","editorScrollTop","relativeTop","calculateMaxContentHeight","zoomLevel","pageMargins","verticalMargins","baseMaxHeight","zoomMultiplier","getCurrentPage","container","containerRect","viewportCenter","i","splitContentIntoPages","allChildren","currentPage","el","getElementTotalHeight","rect","images","textContent","imgRect","insertPageBreakBefore","targetElement","pageNumber","pageBreak","insertPageBreakAtBoundary","updateContentCallback","updateBoundariesCallback","targetHeight","accumulatedHeight","insertBeforeElement","childHeight","updatedHTML","emptyParagraph","removePageAndContent","calculateBoundariesCallback","positionCursorCallback","checkReflowCallback","cursorWasInDeletedContent","nodesToRemove","pageBreakToRemove","firstPageBreak","currentNode","pageBreakElement","nextPageBreakElement","cursorNode","renumberPageBreaks","removePageBreak","DEFAULT_REFLOW_DELAY","BOUNDARY_UPDATE_DELAY","MAX_PAGES_PER_REFLOW","MIN_OVERFLOW_THRESHOLD","findOverflowPoint","pageElements","maxHeight","currentHeight","lastValidElement","elementHeight","checkAndReflow","isReflowingRef","checkAndReflowCallback","insertedBreaks","pagesProcessed","overflow","totalPageHeight","triggerAutoReflow","timeoutRef","delay","CURSOR_POSITION_DELAY","positionCursorAtPage","targetNode","targetOffset","breakElement","scrollToPage","elementRect","scrollTop","checkAndUpdateBoundaries","getCursorPosition","tempRange","plainTextBeforeCaret","charOffset","lineNumber","DEFAULT_BOUNDARY_DELAY","useContinuousReflow","editorRef","boundaryTimeoutRef","useRef","reflowTimeoutRef","latestPageSizeRef","latestZoomLevelRef","latestPageMarginsRef","useEffect","calculatePageBoundariesCallback","updateBoundaries","checkAndUpdateBoundariesCallback","triggerAutoReflowCallback","getCurrentPageCallback","containerRef","positionCursorAtPageCallback","scrollToPageCallback","insertPageBreakAtBoundaryCallback","removePageAndContentCallback","removePageBreakCallback","useKeyboardShortcuts","handlers","refs","handleZoomIn","handleZoomOut","handleZoomReset","handleUndo","handleRedo","handleKeyDown","event","isEditorFocused","isContainerFocused","isInputFocused","useSelectionHandling","lastCursorPositionRef","restoreCursorPosition","lastChild","hasActiveCursorSelection","activeRange","handleSelectionChange","handleFocus","DEFAULT_IMAGE_RESIZE_OPTIONS","RESIZE_HANDLERS","calculateResizeDimensions","handler","startX","startY","currentX","currentY","startWidth","startHeight","deltaX","deltaY","newWidth","newHeight","aspectRatio","isResizableImage","getImageDimensions","applyImageDimensions","width","height","createResizeOverlay","imageElement","overlay","handlerElement","getCursorForHandler","positionHandler","updateResizeOverlay","removeResizeOverlay","DB_NAME","DB_VERSION","STORE_NAME","generateUUID","c","openDatabase","resolve","reject","request","db","saveImage","file","reader","dataUrl","sizeInBytes","objectStore","imageData","getImage","deleteImage","clearImages","getAllImageKeys","BLOCK_ELEMENTS","INLINE_FORMATTING_ELEMENTS","VOID_ELEMENTS","escapeHtml","text","div","getElementAttributes","attributes","attr","normalizeContent","htmlContent","trimmed","normalizeElement","removeNestedParagraphs","headingElement","clonedElement","shouldUnwrapParagraph","paragraphElement","childElements","unwrapParagraphBlockElements","hasNonBlockContent","fragments","childNodes","lowerTagName","innerContent","headingContent","normalizeList","normalizeTable","listElement","items","tableElement","toKebabCase","string","toCamelCase","match","p1","p2","toPascalCase","camelCase","mergeClasses","classes","className","array","hasA11yProp","prop","defaultAttributes","Icon","forwardRef","color","strokeWidth","absoluteStrokeWidth","iconNode","rest","ref","createElement","tag","attrs","createLucideIcon","iconName","Component","ArrowDown","ArrowLeft","ArrowRight","ArrowUp","ChevronLeft","ChevronRight","FileCheck","FileText","Hash","Heading1","Heading2","Heading3","ImageUpscale","List","Palette","Plus","Scaling","Settings","TextAlignCenter","TextAlignEnd","TextAlignStart","Trash2","X","ZoomIn","ZoomOut","extractHeadings","prefix","headingElements","heading","calculateWordCount","word","Sidebar","isCollapsed","onToggle","propWordCount","propPageCount","documentState","activePage","continuousContent","wordCount","outline","totalWords","headings","displayPageCount","jsxs","HeadingIcon","Bold","Italic","Underline","Strikethrough","AlignLeft","AlignCenter","AlignRight","AlignJustify","ListOrdered","Link","Table","Undo","Redo","Image","Indent","Outdent","Logger","namespace","message","data","logger","BLOCK_TAGS","LIST_INDENT_STEP","adjustBlockIndentation","isOutdent","currentLevel","nextLevel","adjustListIndentation","listItem","findClosestBlockElement","getSelectedBlocks","blocks","img","removeLeadingIndentation","indentSelectedBlocks","fallbackBlock","firstBlock","lastBlock","newRange","getFirstTextNode","getLastTextNode","lastNode","firstTextNode","lastTextNode","fallbackRange","handleTabIndentation","ColorPickerDropdown","currentColor","onColorSelect","isOpen","setIsOpen","dropdownRef","colorPalette","handleClickOutside","handleColorClick","handleCustomColorChange","PropTypes","FONT_FAMILIES","HEADING_LEVELS","DEFAULT_TABLE_HTML","EditorToolbar","onFormatText","onAddPageBreak","onInsertImage","canUndo","canRedo","renderButton","onClick","formatKey","disabled","renderSeparator","handleImageUpload","imageUrl","imageHtml","handleIndent","handleOutdent","handleInsertLink","url","handleImageButtonClick","e","label","ImageIcon","processPastedContent","handlePaste","clipboardData","pastedContent","convertPlainTextToHtml","paragraphs","paragraph","lines","line","REMOVE_BUTTON_WIDTH","REMOVE_BUTTON_HEIGHT","REMOVE_BUTTON_OFFSET_RIGHT","REMOVE_BUTTON_OFFSET_TOP","EDITOR_CONTAINER_STYLE","CONTENT_EDITABLE_STYLE","setCursorAtElement","atStart","sel","shouldPreventTypingOnPageBreak","isPageBreakElement","shouldPreventDeletionOnPageBreak","PageView","onInput","onContentChange","onKeyDown","onScroll","onPaste","onRemovePageBreak","padding","isInPaddingArea","clientY","relativeY","handlePageBreakClick","clickedElement","relativeX","removeButtonLeft","removeButtonTop","removeButtonRight","removeButtonBottom","handlePaddingClick","firstChild","handleClick","handleBeforeInput","processedContent","processPasteEvent","PageView$1","memo","PageManager","pageBoundaries","onNavigate","onAddPage","onDeletePage","onPageSizeChange","onPageMarginsChange","onZoomIn","onZoomOut","onZoomReset","totalPages","handleDeletePage","presetName","boundary","PageManager$1","KEYBOARD_RESIZE_STEP","DEFAULT_RESET_WIDTH","DEFAULT_RESET_HEIGHT","applyAspectRatioConstraints","applyDimensionsAndTriggerInput","inputEvent","handleImageKeyboardShortcut","ctrlKey","metaKey","shiftKey","isModifierPressed","currentWidth","ImageResizeHandlers","onImageResize","onImageSelect","onImageDeselect","resizeOptions","resizeStateRef","resizeOptionsRef","handleImageSelection","handleResizeStart","clearImageSelection","scrollLeft","handleResizeMove","handleResizeEnd","newDimensions","beforeState","afterState","handleEditorClick","target","imageToRemove","handleScroll","viewport","observer","mutations","mutation","buttonBaseStyle","deleteButtonStyle","getAlignmentButtonStyle","isActive","ImageTooltipMenu","onAlignChange","onAspectRatioToggle","onDelete","onClose","initialPreserveAspectRatio","setPosition","isVisible","setIsVisible","menuPosition","setMenuPosition","preserveAspectRatio","setPreserveAspectRatio","menuRef","syncResizeOverlayPosition","getImageState","style","getCurrentAlignment","currentAlignment","setCurrentAlignment","calculateMenuPosition","imageRect","menuRect","viewportWidth","viewportHeight","isImageInViewport","top","left","spaceAbove","spaceBelow","adjustedLeft","adjustedTop","useLayoutEffect","alignmentStyles","handleAlign","alignment","oldAlignment","styles","handleDelete","handleAspectRatioToggle","oldPreserveRatio","newPreserveRatio","createPortal","suppressEvent","clearClasses","selector","classArray","isWithin","clearTextSelection","DEFAULT_TABLE_RESIZE_OPTIONS","TABLE_RESIZE_HANDLERS","isResizableTable","getTableStructure","rows","columns","columnWidths","colgroup","cols","col","firstRow","cell","rowHeights","row","calculateTableResizeDimensions","delta","currentStructure","applyResize","arrayIndex","min","max","synchronizeTableColgroup","columnCount","existingCols","currentColCount","applyTableDimensions","tableWidth","tableHeight","sumWidth","sum","w","sumHeight","h","createTableResizeOverlay","structure","createIndexedResizeHandler","bottomHandler","createBoundaryResizeHandler","rightHandler","HANDLER_CONFIG","createResizeHandler","primarySize","positionResizeHandler","updateTableResizeOverlay","columnHandlers","rowHandlers","newBottomHandler","newRightHandler","removeTableResizeOverlay","validateTable","operationName","createRowWithCells","referenceRow","newRow","cellCount","newCell","insertRowAtPosition","rowIndex","offset","targetIndex","insertRowAbove","insertRowBelow","createColumnCell","insertColumnAtPosition","columnIndex","insertColumnLeft","insertColumnRight","positionColumnHandler","positionRowHandler","positionBottomHandler","positionRightHandler","cellRect","tableRect","deleteTableElement","deleteRowInternal","deleteColumnInternal","deleteRow","deleteColumn","TableResizeHandlers","onTableResize","onTableSelect","onTableDeselect","resizeOverlayRef","resizeTableRef","resizeStartRef","resizeTypeRef","resizeIndexRef","isResizingRef","selectedTable","setSelectedTable","clearTableSelection","cursor","createAndAttachOverlay","handleTableSelection","startStructure","tableToRemove","tables","BUTTON_BASE_STYLE","ALIGNMENT_STYLES","OPERATION_TYPES","syncResizeOverlay","callback","getTableAlignmentState","TableTooltipMenu","selectedRowIndex","selectedColIndex","viewportRect","isTableInViewport","createTableOperationHandler","operationType","operationFn","isRowOperation","selectedIndex","handleInsertRowAbove","handleInsertRowBelow","handleInsertColumnLeft","handleInsertColumnRight","handleDeleteRow","handleDeleteColumn","ACTION_BUTTON_STYLES","MENU_CONTAINER_STYLE","Fragment","SELECTION_CLASSES","clearVisualSelection","TableCellSelection","onCellSelectionChange","selectionStateRef","isSelecting","setIsSelecting","hasDragged","setHasDragged","startCell","setStartCell","currentTable","setCurrentTable","lastSelectionRef","resetSelectionState","clearSelection","getCellCoordinates","table","cellIndex","checkSelectionExpansion","cells","cellArray","firstCell","coords","cellCoords","applyVisualSelection","colIndex","updateSelection","newCells","expansion","newSelection","handleMouseDown","handleMouseEnter","startCoords","currentCoords","minRow","maxRow","minCol","maxCol","tableRow","tableCell","handleMouseUp","handleMouseDownCapture","handleMouseEnterCapture","INITIAL_BOUNDARY_DELAY","NAVIGATION_DELAY","SCROLL_DEBOUNCE","NAVIGATION_LOCK_TIMEOUT","HtmlEditor","pageManagerComponent","onNavigatePage","onPageSizeChangeCallback","onPageMarginsChangeCallback","onChange","showSidebar","showToolbar","showPageManager","imageSelected","setImageSelected","selectedImage","setSelectedImage","tableSelected","setTableSelected","setSelectedRowIndex","setSelectedColIndex","sidebarCollapsed","setSidebarCollapsed","scrollTimeoutRef","addingPageRef","isNavigatingRef","contentSetRef","lastContentRef","navigateToNewPage","newPageIndex","timer","updateContentAndBoundaries","insertHtmlWithCursorRestore","updatedContent","exposedMethods","commonAncestor","clonedContents","normalizedHtml","useImperativeHandle","updateContent","previousContent","updateOperation","handleInput","_event","handlePageSizeChange","handlePageMarginsChange","handleNavigatePage","handleAddPage","nextPageNumber","handleAddPageBreak","pageBreakHTML","handleInsertImage","handleRemovePageBreak","actionHandlers","words","handleImageSelect","handleImageDeselect","handleImageResize","__","handleCellSelectionChange","handleTableSelect","handleTableDeselect","handleTableResize","_alignment","imageKey","ErrorBoundary","errorInfo"],"mappings":"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","x_google_ignoreList":[0,1,2,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47]}