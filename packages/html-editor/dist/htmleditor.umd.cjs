(function(f,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("react"),require("react-redux"),require("@reduxjs/toolkit"),require("uuid")):typeof define=="function"&&define.amd?define(["exports","react","react-redux","@reduxjs/toolkit","uuid"],g):(f=typeof globalThis<"u"?globalThis:f||self,g(f.HTMLEditor={},f.React,f.ReactRedux,f.RTK,f.uuid))})(this,(function(f,g,K,je,re){"use strict";var X={exports:{}},W={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var le;function we(){if(le)return W;le=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function a(o,i,s){var d=null;if(s!==void 0&&(d=""+s),i.key!==void 0&&(d=""+i.key),"key"in i){s={};for(var h in i)h!=="key"&&(s[h]=i[h])}else s=i;return i=s.ref,{$$typeof:e,type:o,key:d,ref:i!==void 0?i:null,props:s}}return W.Fragment=n,W.jsx=a,W.jsxs=a,W}var Y={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ce;function Ne(){return ce||(ce=1,process.env.NODE_ENV!=="production"&&(function(){function e(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===P?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case L:return"Fragment";case c:return"Profiler";case R:return"StrictMode";case k:return"Suspense";case b:return"SuspenseList";case M:return"Activity"}if(typeof t=="object")switch(typeof t.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),t.$$typeof){case B:return"Portal";case v:return t.displayName||"Context";case p:return(t._context.displayName||"Context")+".Consumer";case l:var u=t.render;return t=t.displayName,t||(t=u.displayName||u.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case T:return u=t.displayName||null,u!==null?u:e(t.type)||"Memo";case E:u=t._payload,t=t._init;try{return e(t(u))}catch{}}return null}function n(t){return""+t}function a(t){try{n(t);var u=!1}catch{u=!0}if(u){u=console;var A=u.error,_=typeof Symbol=="function"&&Symbol.toStringTag&&t[Symbol.toStringTag]||t.constructor.name||"Object";return A.call(u,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",_),n(t)}}function o(t){if(t===L)return"<>";if(typeof t=="object"&&t!==null&&t.$$typeof===E)return"<...>";try{var u=e(t);return u?"<"+u+">":"<...>"}catch{return"<...>"}}function i(){var t=C.A;return t===null?null:t.getOwner()}function s(){return Error("react-stack-top-frame")}function d(t){if(j.call(t,"key")){var u=Object.getOwnPropertyDescriptor(t,"key").get;if(u&&u.isReactWarning)return!1}return t.key!==void 0}function h(t,u){function A(){F||(F=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",u))}A.isReactWarning=!0,Object.defineProperty(t,"key",{get:A,configurable:!0})}function N(){var t=e(this.type);return ee[t]||(ee[t]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),t=this.props.ref,t!==void 0?t:null}function m(t,u,A,_,ae,ie){var I=A.ref;return t={$$typeof:w,type:t,key:u,props:A,_owner:_},(I!==void 0?I:null)!==null?Object.defineProperty(t,"ref",{enumerable:!1,get:N}):Object.defineProperty(t,"ref",{enumerable:!1,value:null}),t._store={},Object.defineProperty(t._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(t,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(t,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:ae}),Object.defineProperty(t,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:ie}),Object.freeze&&(Object.freeze(t.props),Object.freeze(t)),t}function O(t,u,A,_,ae,ie){var I=u.children;if(I!==void 0)if(_)if(z(I)){for(_=0;_<I.length;_++)S(I[_]);Object.freeze&&Object.freeze(I)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else S(I);if(j.call(u,"key")){I=e(t);var G=Object.keys(u).filter(function(Xe){return Xe!=="key"});_=0<G.length?"{key: someKey, "+G.join(": ..., ")+": ...}":"{key: someKey}",x[I+_]||(G=0<G.length?"{"+G.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,_,I,G,I),x[I+_]=!0)}if(I=null,A!==void 0&&(a(A),I=""+A),d(u)&&(a(u.key),I=""+u.key),"key"in u){A={};for(var se in u)se!=="key"&&(A[se]=u[se])}else A=u;return I&&h(A,typeof t=="function"?t.displayName||t.name||"Unknown":t),m(t,I,A,i(),ae,ie)}function S(t){y(t)?t._store&&(t._store.validated=1):typeof t=="object"&&t!==null&&t.$$typeof===E&&(t._payload.status==="fulfilled"?y(t._payload.value)&&t._payload.value._store&&(t._payload.value._store.validated=1):t._store&&(t._store.validated=1))}function y(t){return typeof t=="object"&&t!==null&&t.$$typeof===w}var D=g,w=Symbol.for("react.transitional.element"),B=Symbol.for("react.portal"),L=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),p=Symbol.for("react.consumer"),v=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),b=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),E=Symbol.for("react.lazy"),M=Symbol.for("react.activity"),P=Symbol.for("react.client.reference"),C=D.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,j=Object.prototype.hasOwnProperty,z=Array.isArray,H=console.createTask?console.createTask:function(){return null};D={react_stack_bottom_frame:function(t){return t()}};var F,ee={},te=D.react_stack_bottom_frame.bind(D,s)(),ne=H(o(s)),x={};Y.Fragment=L,Y.jsx=function(t,u,A){var _=1e4>C.recentlyCreatedOwnerStacks++;return O(t,u,A,!1,_?Error("react-stack-top-frame"):te,_?H(o(t)):ne)},Y.jsxs=function(t,u,A){var _=1e4>C.recentlyCreatedOwnerStacks++;return O(t,u,A,!0,_?Error("react-stack-top-frame"):te,_?H(o(t)):ne)}})()),Y}var ue;function Te(){return ue||(ue=1,process.env.NODE_ENV==="production"?X.exports=we():X.exports=Ne()),X.exports}var r=Te();const Z="A4",U="<p><br></p>",J=(e,n=Z)=>({id:re.v4(),index:e,size:n,content:U,images:[],isBreakPoint:!1}),de=(e,n=Z)=>(e.length>0?e:[J(0,n)]).map((o,i)=>({id:o.id||re.v4(),index:i,size:o.size||n,content:Q(o.content),images:o.images||[],isBreakPoint:!!o.isBreakPoint})),Q=e=>typeof e!="string"||e.trim()===""?U:e,oe=(e={})=>{const n=new Date().toISOString(),a=e.pageSize||Z,o=de(e.pages||[J(0,a)],a);return{id:re.v4(),title:e.title||"Untitled Document",createdAt:n,updatedAt:n,pageSize:a,pages:o,activePage:e.activePage&&e.activePage<o.length?e.activePage:0,pageBreaks:e.pageBreaks||[],totalPages:o.length,editorMode:e.editorMode||"continuous",continuousContent:e.continuousContent||U,pageBoundaries:e.pageBoundaries||[]}},Re=oe(),ge=je.createSlice({name:"document",initialState:Re,reducers:{initializeDocument:(e,n)=>{const{initialContent:a=U,pageSize:o=Z}=n.payload||{},i={...J(0,o),content:Q(a)};return oe({title:e.title,pageSize:o,pages:[i]})},updateTitle:(e,n)=>{e.title=n.payload,e.updatedAt=new Date().toISOString()},updatePageContent:(e,n)=>{const{pageIndex:a,content:o}=n.payload;a<0||a>=e.pages.length||(e.pages[a].content=Q(o),e.updatedAt=new Date().toISOString())},updatePages:(e,n)=>{const a=Array.isArray(n.payload)?{pages:n.payload}:n.payload||{},o=de(a.pages||[],e.pageSize);e.pages=o,e.activePage=Math.min(e.activePage,o.length-1),e.pageBreaks=Array.isArray(a.pageBreaks)?a.pageBreaks:o.slice(0,-1).map((i,s)=>({id:`auto-break-${s}`,pageNumber:s+1})),e.totalPages=o.length,e.updatedAt=new Date().toISOString()},addPage:(e,n)=>{const a=typeof n.payload?.index=="number"?Math.min(Math.max(n.payload.index,0),e.pages.length):e.pages.length;e.pages.splice(a,0,J(a,e.pageSize)),e.pages=e.pages.map((o,i)=>({...o,index:i,size:e.pageSize})),e.activePage=a,e.pageBreaks=e.pages.slice(0,-1).map((o,i)=>({id:`auto-break-${i}`,pageNumber:i+1})),e.totalPages=e.pages.length,e.updatedAt=new Date().toISOString()},deletePage:(e,n)=>{const a=n.payload;e.pages.length<=1||(e.pages.splice(a,1),e.pages=e.pages.map((o,i)=>({...o,index:i,size:e.pageSize})),e.activePage>=e.pages.length?e.activePage=e.pages.length-1:a<=e.activePage&&e.activePage>0&&(e.activePage-=1),e.pageBreaks=e.pages.slice(0,-1).map((o,i)=>({id:`auto-break-${i}`,pageNumber:i+1})),e.totalPages=e.pages.length,e.updatedAt=new Date().toISOString())},setActivePage:(e,n)=>{const a=n.payload;a>=0&&a<e.pages.length&&a!==e.activePage&&(e.activePage=a,e.updatedAt=new Date().toISOString())},updatePageSize:(e,n)=>{const a=n.payload;e.pageSize=a,e.pages=e.pages.map((o,i)=>({...o,index:i,size:a})),e.pageBreaks=e.pages.slice(0,-1).map((o,i)=>({id:`auto-break-${i}`,pageNumber:i+1})),e.updatedAt=new Date().toISOString()},resetDocument:()=>oe(),updateContinuousContent:(e,n)=>{e.continuousContent=Q(n.payload),e.updatedAt=new Date().toISOString()},updatePageBoundaries:(e,n)=>{e.pageBoundaries=n.payload||[],e.totalPages=e.pageBoundaries.length,e.updatedAt=new Date().toISOString()},addPageBreak:(e,n)=>{const{position:a="end"}=n.payload||{},o='<page-break data-page-break="true" style="display: block; height: 20px; border-top: 2px dashed #ccc; margin: 20px 0; page-break-after: always;"></page-break>';if(a==="end")e.continuousContent=e.continuousContent+o+"<p><br></p>";else if(typeof a=="number"){const i=e.continuousContent.substring(0,a),s=e.continuousContent.substring(a);e.continuousContent=i+o+s}e.updatedAt=new Date().toISOString()},removePageBreak:(e,n)=>{const{pageIndex:a}=n.payload||{};if(typeof a=="number"&&typeof document<"u"){const o=document.createElement("div");o.innerHTML=e.continuousContent;const i=o.querySelectorAll('page-break, [data-page-break="true"]');i[a]&&i[a].remove(),o.querySelectorAll('page-break, [data-page-break="true"]').forEach((d,h)=>{d.setAttribute("data-page-number",String(h+2))}),e.continuousContent=o.innerHTML,e.updatedAt=new Date().toISOString()}},setEditorMode:(e,n)=>{const a=n.payload;if(a!==e.editorMode){if(e.editorMode=a,a==="continuous"){const o=e.pages.map(i=>i.content).filter(i=>i&&i!==U).join(`
`);e.continuousContent=o||U}else e.continuousContent&&e.continuousContent!==U&&(e.pages=[{...J(0,e.pageSize),content:e.continuousContent}]);e.updatedAt=new Date().toISOString()}}}}),{initializeDocument:_e,updateTitle:Ie,updatePageContent:Be,updatePages:Oe,addPage:Le,deletePage:De,setActivePage:V,updatePageSize:pe,resetDocument:ze,updateContinuousContent:q,updatePageBoundaries:fe,addPageBreak:me,removePageBreak:Me,setEditorMode:Ue}=ge.actions,He=ge.reducer,he=()=>{const[e,n]=g.useState({bold:!1,italic:!1,underline:!1,strikethrough:!1,alignLeft:!1,alignCenter:!1,alignRight:!1,alignJustify:!1,fontFamily:"Arial",fontSize:"16px"}),a=g.useCallback((o,i=null)=>{document.execCommand(o,!1,i),o==="bold"?n(s=>({...s,bold:!s.bold})):o==="italic"?n(s=>({...s,italic:!s.italic})):o==="underline"?n(s=>({...s,underline:!s.underline})):o==="strikethrough"?n(s=>({...s,strikethrough:!s.strikethrough})):o==="justifyLeft"?n(s=>({...s,alignLeft:!0,alignCenter:!1,alignRight:!1,alignJustify:!1})):o==="justifyCenter"?n(s=>({...s,alignLeft:!1,alignCenter:!0,alignRight:!1,alignJustify:!1})):o==="justifyRight"?n(s=>({...s,alignLeft:!1,alignCenter:!1,alignRight:!0,alignJustify:!1})):o==="justifyFull"&&n(s=>({...s,alignLeft:!1,alignCenter:!1,alignRight:!1,alignJustify:!0}))},[]);return{currentFormat:e,formatText:a}},$={A4:{width:794,height:1123},Letter:{width:816,height:1056},Legal:{width:816,height:1344}},be={top:60,bottom:100,left:72,right:72},ke=(e,n)=>{const a=K.useDispatch(),o=g.useRef(null),i=g.useRef(null),s=g.useRef(e),d=g.useRef(!1);g.useEffect(()=>{s.current=e},[e]),g.useEffect(()=>()=>{o.current&&clearTimeout(o.current),i.current&&clearTimeout(i.current)},[]);const h=g.useCallback((c,p)=>{let v=0;for(let l=0;l<c.length;l++){const k=c[l],b=k.getBoundingClientRect().height;if(v+b>p)return{overflowIndex:l,overflowElement:k,accumulatedHeight:v};v+=b}return null},[]),N=g.useCallback((c,p)=>{if(!c||!n?.current)return!1;try{const v=n.current,l=document.createElement("page-break");return l.setAttribute("data-page-break","true"),l.setAttribute("contenteditable","false"),l.setAttribute("data-page-number",p||"2"),c.parentNode.insertBefore(l,c),!0}catch(v){return console.warn("[insertPageBreakBefore] Failed to insert page break:",v),!1}},[n]),m=g.useCallback(()=>{if(!(!n?.current||d.current))try{d.current=!0;const c=n.current,p=s.current||"A4",l=($[p]||$.A4).height-be.top-be.bottom,k=Array.from(c.children),b=k.filter(P=>P.tagName==="PAGE-BREAK"||P.getAttribute("data-page-break")==="true"),T=[];let E=[];for(const P of k)P.tagName==="PAGE-BREAK"||P.getAttribute("data-page-break")==="true"?E.length>0&&(T.push(E),E=[]):E.push(P);E.length>0&&T.push(E),T.length===0&&k.length>0&&T.push(k.filter(P=>!(P.tagName==="PAGE-BREAK"||P.getAttribute("data-page-break")==="true")));let M=!1;for(let P=0;P<T.length;P++){const C=T[P],j=h(C,l);if(j&&j.overflowIndex>0){const z=P+2;if(N(j.overflowElement,z)){M=!0;break}}}if(M){const P=c.innerHTML;a(q(P)),setTimeout(()=>{y()},50)}}catch(c){console.warn("[checkAndReflow] Reflow failed:",c)}finally{d.current=!1}},[n,h,N,a]),O=g.useCallback((c=500)=>{i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{i.current=null,m()},c)},[m]),S=g.useCallback((c={})=>{if(!n?.current||typeof document>"u")return[];const p=c.pageSize||s.current||"A4",v=$[p]||$.A4,l=n.current,k=l.querySelectorAll('page-break, [data-page-break="true"]'),b=[];return b.push({id:"page-0",pageNumber:1,top:0,height:v.height}),k.forEach((T,E)=>{const M=T.getBoundingClientRect(),P=l.getBoundingClientRect(),C=M.top-P.top+l.scrollTop;b.push({id:`page-${E+1}`,pageNumber:E+2,top:C,height:v.height})}),b},[n]),y=g.useCallback((c={})=>{const p=S(c);return a(fe(p)),p},[S,a]),D=g.useCallback((c={})=>{o.current&&clearTimeout(o.current);const p=typeof c.delay=="number"?c.delay:300;o.current=setTimeout(()=>{o.current=null,y(c)},Math.max(0,p))},[y]),w=g.useCallback(()=>{if(!n?.current)return 0;const c=window.getSelection();if(!c||c.rangeCount===0)return 0;try{const p=c.getRangeAt(0),v=n.current;let l=p.startContainer;const k=Array.from(v.querySelectorAll('page-break, [data-page-break="true"]'));if(k.length===0)return 0;for(;l&&l!==v;){for(let b=k.length-1;b>=0;b--)if(k[b].compareDocumentPosition(l)&Node.DOCUMENT_POSITION_FOLLOWING)return b+1;l=l.parentNode}return 0}catch(p){return console.warn("[getCurrentPage] Failed to calculate page:",p),0}},[n]),B=g.useCallback((c,p)=>{if(!p?.current||!n?.current)return;n.current;const l=S().find(k=>k.pageNumber===c+1);l&&(p.current.scrollTo({top:l.top-40,behavior:"smooth"}),setTimeout(()=>{L(c)},300))},[n]),L=g.useCallback(c=>{if(!n?.current)return;const p=n.current;p.focus();try{let v=null,l=0;if(c===0)v=p.firstChild,l=0;else{const b=p.querySelectorAll('page-break, [data-page-break="true"]')[c-1];b&&b.nextSibling&&(v=b.nextSibling,l=0)}if(v){const k=document.createRange(),b=window.getSelection();v.nodeType===Node.TEXT_NODE?k.setStart(v,l):k.setStart(v,0),k.collapse(!0),b.removeAllRanges(),b.addRange(k)}}catch(v){console.warn("[positionCursorAtPage] Failed to position cursor:",v)}},[n]),R=g.useCallback(c=>{if(!n?.current)return!1;const p=n.current;if(S().length<=1)return console.warn("[removePageAndContent] Cannot delete the only page"),!1;try{const l=Array.from(p.querySelectorAll('page-break, [data-page-break="true"]'));if(c>l.length)return console.warn("[removePageAndContent] Invalid page index"),!1;const k=window.getSelection();let b=!1,T=[],E=null;if(c===0){const C=l[0];if(!C)return console.warn("[removePageAndContent] No page break found for first page"),!1;let j=p.firstChild;for(;j&&j!==C;)T.push(j),j=j.nextSibling;E=C}else{const C=l[c-1];if(!C)return console.warn("[removePageAndContent] Page break not found"),!1;const j=l[c];let z=C.nextSibling;for(;z&&z!==j;)T.push(z),z=z.nextSibling;E=C}if(k&&k.rangeCount>0){const j=k.getRangeAt(0).startContainer;for(const z of T)if(z.contains(j)||z===j){b=!0;break}}E&&E.parentNode&&E.remove(),T.forEach(C=>{C.parentNode&&C.remove()}),p.querySelectorAll('page-break, [data-page-break="true"]').forEach((C,j)=>{C.setAttribute("data-page-number",String(j+2))}),b&&setTimeout(()=>{L(0)},50);const P=p.innerHTML;return a(q(P)),setTimeout(()=>{y()},100),!0}catch(l){return console.error("[removePageAndContent] Failed to remove page:",l),!1}},[n,S,a,y,L]);return{calculatePageBoundaries:S,checkAndUpdateBoundaries:D,updateBoundaries:y,getCurrentPage:w,scrollToPage:B,positionCursorAtPage:L,checkAndReflow:m,triggerAutoReflow:O,removePageAndContent:R,boundaryTimeoutRef:o,reflowTimeoutRef:i}},ve=({editorView:e,isCollapsed:n,onToggle:a,wordCount:o,pageCount:i})=>{const s=K.useSelector(B=>B.document),{pages:d,activePage:h,continuousContent:N,editorMode:m}=s,[O,S]=g.useState(0),[y,D]=g.useState([]);g.useEffect(()=>{if(o!==void 0&&i!==void 0){if(S(o),N){const R=document.createElement("div");R.innerHTML=N;const c=R.querySelectorAll("h1, h2, h3, h4, h5, h6"),p=Array.from(c).map((v,l)=>{const k=parseInt(v.tagName.charAt(1)),b=v.textContent.trim();return b?{id:`heading-${l}`,level:k,text:b,page:1}:null}).filter(Boolean);D(p)}return}let B=0;const L=[];d.forEach((R,c)=>{if(R.content){const p=document.createElement("div");p.innerHTML=R.content;const l=(p.textContent||p.innerText||"").trim().split(/\s+/).filter(b=>b.length>0);B+=l.length,p.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach((b,T)=>{const E=parseInt(b.tagName.charAt(1)),M=b.textContent.trim();M&&L.push({id:`heading-${c}-${T}`,level:E,text:M,page:c+1})})}}),S(B),D(L)},[d,o,i,N]);const w=i!==void 0?i:d.length;return r.jsxs("aside",{className:`sidebar ${n?"collapsed":""}`,role:"complementary","aria-label":"Document information","data-testid":"sidebar",children:[r.jsxs("div",{className:"sidebar-header",children:[r.jsx("h2",{children:"Document Info"}),r.jsx("button",{className:"sidebar-toggle",onClick:a,"aria-label":n?"Expand sidebar":"Collapse sidebar",title:n?"Expand sidebar":"Collapse sidebar",children:n?"▶":"◀"})]}),!n&&r.jsxs("div",{className:"sidebar-content",children:[r.jsxs("div",{className:"sidebar-section",children:[r.jsx("h3",{children:"Statistics"}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Pages:"}),r.jsx("span",{className:"stat-value",children:w})]}),r.jsxs("div",{className:"stat-item","data-testid":"word-count",children:[r.jsx("span",{className:"stat-label",children:"Words:"}),r.jsx("span",{className:"stat-value",children:O.toLocaleString()})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Active Page:"}),r.jsx("span",{className:"stat-value",children:h+1})]})]}),y.length>0&&r.jsxs("div",{className:"sidebar-section",children:[r.jsx("h3",{children:"Document Outline"}),r.jsx("div",{className:"document-outline","data-testid":"outline",children:y.map(B=>r.jsxs("div",{className:`outline-item outline-level-${B.level}`,style:{marginLeft:`${(B.level-1)*12}px`},children:[r.jsx("span",{className:"outline-text",children:B.text}),r.jsxs("span",{className:"outline-page",children:["p.",B.page]})]},B.id))})]}),r.jsxs("div",{className:"sidebar-section",children:[r.jsx("h3",{children:"Document"}),r.jsx("p",{children:"HTML Editor"}),r.jsx("p",{children:"Multi-page support"})]})]})]})};function Ge(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const n=Math.random()*16|0;return(e==="x"?n:n&3|8).toString(16)})}function xe(e){return new Promise((n,a)=>{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(e.type)){a(new Error("Invalid image format. Supported formats: png, jpeg, gif, webp"));return}if(e.size>5*1024*1024){a(new Error("Image exceeds maximum size of 5MB"));return}const i=new FileReader;i.onload=s=>{const d=s.target.result;if(d.split(",")[1].length*3/4>5*1024*1024){a(new Error("Image exceeds maximum size of 5MB"));return}try{const m=`editor-image-${Ge()}`;localStorage.setItem(m,d),n(m)}catch(m){m.name==="QuotaExceededError"?a(new Error("Storage quota exceeded")):a(m)}},i.onerror=()=>{a(new Error("Error reading image file"))},i.readAsDataURL(e)})}function We(e){return localStorage.getItem(e)}function Ye(e){localStorage.removeItem(e)}function Je(){Object.keys(localStorage).forEach(e=>{e.startsWith("editor-image-")&&localStorage.removeItem(e)})}function Ve(){return Object.keys(localStorage).filter(e=>e.startsWith("editor-image-"))}class Ce{constructor(n="Editor"){this.namespace=n}_format(n,a,o){return`[${new Date().toISOString()}] [${this.namespace}] [${n}] ${a}`}info(n,a){}warn(n,a){}error(n,a){}debug(n,a){}}const Se=new Ce("Editor"),Ee=({currentFormat:e,pageSize:n,onFormatText:a,onPageSizeChange:o,onAddPageBreak:i})=>{const s=async d=>{try{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(d.type)){alert("Invalid image format. Supported: PNG, JPEG, GIF, WEBP");return}if(d.size>5242880){alert("Image exceeds maximum size of 5MB");return}const N=await xe(d),m=localStorage.getItem(N);m&&(document.execCommand("insertImage",!1,m),Se.info("Image inserted",{key:N}))}catch(h){Se.error("Error uploading image",h)}};return r.jsxs("div",{className:"editor-toolbar",children:[r.jsx("button",{onClick:()=>a("bold"),className:e.bold?"active":"",title:"Bold",children:r.jsx("strong",{children:"B"})}),r.jsx("button",{onClick:()=>a("italic"),className:e.italic?"active":"",title:"Italic",children:r.jsx("em",{children:"I"})}),r.jsx("button",{onClick:()=>a("underline"),className:e.underline?"active":"",title:"Underline",children:r.jsx("u",{children:"U"})}),r.jsx("button",{onClick:()=>a("strikethrough"),className:e.strikethrough?"active":"",title:"Strikethrough",children:r.jsx("s",{children:"S"})}),r.jsx("div",{className:"toolbar-separator"}),r.jsx("button",{onClick:()=>a("justifyLeft"),className:e.alignLeft?"active":"",title:"Align Left",children:"⬅️"}),r.jsx("button",{onClick:()=>a("justifyCenter"),className:e.alignCenter?"active":"",title:"Align Center",children:"⬌"}),r.jsx("button",{onClick:()=>a("justifyRight"),className:e.alignRight?"active":"",title:"Align Right",children:"➡️"}),r.jsx("button",{onClick:()=>a("justifyFull"),className:e.alignJustify?"active":"",title:"Justify",children:"⬌"}),r.jsx("div",{className:"toolbar-separator"}),r.jsxs("select",{onChange:d=>a("fontName",d.target.value),defaultValue:"Arial",title:"Font Family",children:[r.jsx("option",{value:"Arial",children:"Arial"}),r.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),r.jsx("option",{value:"Courier New",children:"Courier New"}),r.jsx("option",{value:"Georgia",children:"Georgia"}),r.jsx("option",{value:"Verdana",children:"Verdana"})]}),r.jsxs("select",{onChange:d=>a("fontSize",d.target.value),defaultValue:"16px",title:"Font Size",children:[r.jsx("option",{value:"10px",children:"10"}),r.jsx("option",{value:"12px",children:"12"}),r.jsx("option",{value:"14px",children:"14"}),r.jsx("option",{value:"16px",children:"16"}),r.jsx("option",{value:"18px",children:"18"}),r.jsx("option",{value:"24px",children:"24"}),r.jsx("option",{value:"32px",children:"32"})]}),r.jsx("div",{className:"toolbar-separator"}),r.jsx("button",{onClick:()=>a("insertUnorderedList"),title:"Bullet List",children:"• List"}),r.jsx("button",{onClick:()=>a("insertOrderedList"),title:"Numbered List",children:"1. List"}),r.jsx("button",{onClick:()=>a("insertCheckList"),title:"Checklist",children:"☑️ List"}),r.jsx("div",{className:"toolbar-separator"}),r.jsx("button",{onClick:()=>{const d=prompt("Enter URL:");d&&a("createLink",d)},title:"Insert Link",children:"🔗 Link"}),r.jsx("button",{onClick:()=>a("insertHTML",'<table border="1"><tr><td>Cell 1</td><td>Cell 2</td></tr><tr><td>Cell 3</td><td>Cell 4</td></tr></table>'),title:"Insert Table",children:"📊 Table"}),i&&r.jsx("button",{onClick:i,title:"Insert Page Break",children:"📄 Page Break"}),r.jsx("div",{className:"toolbar-separator"}),r.jsx("button",{onClick:()=>a("undo"),title:"Undo",children:"↶ Undo"}),r.jsx("button",{onClick:()=>a("redo"),title:"Redo",children:"↷ Redo"}),r.jsx("div",{className:"toolbar-separator"}),r.jsx("input",{type:"file",accept:"image/*",onChange:d=>d.target.files[0]&&s(d.target.files[0]),style:{display:"none"},id:"image-upload"}),r.jsx("button",{onClick:()=>document.getElementById("image-upload").click(),title:"Insert Image",children:"🖼️ Image"}),r.jsx("div",{className:"toolbar-separator"}),r.jsxs("select",{value:n,onChange:d=>o(d.target.value),title:"Page Size",children:[r.jsx("option",{value:"A4",children:"A4"}),r.jsx("option",{value:"Letter",children:"Letter"}),r.jsx("option",{value:"Legal",children:"Legal"})]})]})},Pe=({content:e,dimensions:n,pageSize:a,pageBoundaries:o=[],editorRef:i,onInput:s,onKeyDown:d,onClick:h,onScroll:N})=>{const m={top:60,bottom:100,left:72,right:72},O=S=>{const y=window.getSelection();if(!y||y.rangeCount===0)return;const D=y.getRangeAt(0),{startContainer:w,endContainer:B}=D,L=R=>R?R.nodeType===Node.ELEMENT_NODE?R.tagName==="PAGE-BREAK"||R.getAttribute("data-page-break")==="true":R.parentElement&&L(R.parentElement):!1;if((S.key==="Backspace"||S.key==="Delete")&&(L(w)||L(B)))return S.preventDefault(),!1;d&&d(S)};return r.jsx("div",{className:"continuous-page-container",style:{position:"relative",width:"100%",maxWidth:`${n.width}px`,margin:"40px auto",backgroundColor:"transparent",minHeight:"100vh"},children:r.jsx("div",{ref:i,contentEditable:!0,suppressContentEditableWarning:!0,className:"continuous-content",style:{position:"relative",zIndex:1,minHeight:`${n.height}px`,backgroundColor:"white",padding:`${m.top}px ${m.right}px ${m.bottom}px ${m.left}px`,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",outline:"none",cursor:"text",fontFamily:"Arial, sans-serif",fontSize:"16px",lineHeight:"1.6",color:"#333",wordWrap:"break-word",whiteSpace:"pre-wrap",overflowWrap:"break-word",border:"1px solid #e0e0e0"},onInput:s,onKeyDown:O,onClick:h,onScroll:N,"data-testid":"continuous-editor"})})},Ae=({pages:e,activePage:n,pageSize:a,onNavigate:o,onAddPage:i,onDeletePage:s,onPageSizeChange:d,continuousMode:h=!1})=>r.jsxs("div",{className:"page-manager",children:[r.jsxs("div",{className:"page-size-controls",children:[r.jsx("label",{htmlFor:"page-size-selector",children:"Page Size:"}),r.jsxs("select",{id:"page-size-selector",role:"combobox","aria-label":"Page size selector",value:a,onChange:N=>d(N.target.value),children:[r.jsx("option",{value:"A4",children:"A4"}),r.jsx("option",{value:"Letter",children:"Letter"}),r.jsx("option",{value:"Legal",children:"Legal"})]})]}),r.jsx("div",{className:"page-list",children:e.map((N,m)=>r.jsxs("div",{className:"page-item",children:[r.jsxs("button",{type:"button",className:`page-button ${m===n?"active":""}`,onClick:()=>o(m),"aria-label":`Go to page ${m+1}`,children:["Page ",m+1]}),!h&&e.length>1&&r.jsx("button",{type:"button",className:"delete-page-button",onClick:O=>{O.stopPropagation(),s(m)},"aria-label":`Delete page ${m+1}`,title:"Delete this page and its content",children:"×"})]},N.id))}),!h&&r.jsx("button",{type:"button",className:"add-page-button",onClick:i,"aria-label":"Add new page",children:"+ Add Page"})]}),ye={A4:{width:794,height:1123},Letter:{width:816,height:1056},Legal:{width:816,height:1344}},Fe=({pageManagerComponent:e=null,onNavigatePage:n,onAddPage:a,onDeletePage:o,onPageSizeChange:i,showSidebar:s=!0,showToolbar:d=!0})=>{const h=K.useDispatch(),N=K.useSelector(x=>x.document),{pageSize:m,continuousContent:O,pageBoundaries:S,activePage:y}=N,D=g.useRef(null),w=g.useRef(null),{currentFormat:B,formatText:L}=he(),{checkAndUpdateBoundaries:R,getCurrentPage:c,scrollToPage:p,positionCursorAtPage:v,updateBoundaries:l,triggerAutoReflow:k,removePageAndContent:b}=ke(m,w),T=ye[m]||ye.A4,[E,M]=g.useState(!1);g.useEffect(()=>{w.current&&w.current.innerHTML!==O&&(w.current.innerHTML=O,setTimeout(()=>{l()},100))},[O,l]),g.useEffect(()=>{const x=setTimeout(()=>{w.current&&w.current.focus()},200);return()=>clearTimeout(x)},[]);const P=g.useCallback(x=>{const t=x.currentTarget.innerHTML;h(q(t)),R(),k();const u=c();u!==y&&h(V(u))},[R,h,c,y,k]),C=g.useCallback(x=>{h(pe(x)),l({pageSize:x}),i&&i(x)},[h,l,i]),j=g.useCallback(x=>{h(V(x)),p(x,D),n&&n(x)},[h,p,n]),z=g.useCallback(()=>{h(me({position:"end"})),setTimeout(()=>{l()},100),a&&a()},[h,l,a]),H=g.useCallback(()=>{const x=window.getSelection();if(x&&x.rangeCount>0){if(!w?.current)return;const A=`<page-break data-page-break="true" contenteditable="false" data-page-number="${w.current.querySelectorAll('page-break, [data-page-break="true"]').length+2}"></page-break><p><br></p>`;document.execCommand("insertHTML",!1,A),setTimeout(()=>{l()},100)}},[l,w]),F=g.useCallback(x=>{if(S.length<=1){console.warn("Cannot delete the only page");return}b(x)&&(h(V(0)),o&&o(x))},[S.length,b,h,o]),ee=g.useCallback(()=>{if(!D.current||!w.current)return;const x=c();x!==y&&h(V(x))},[c,y,h]),te=O?(O.replace(/<[^>]*>/g," ").match(/\b\w+\b/g)||[]).length:0,ne=S.length||1;return r.jsxs("div",{className:"multi-page-editor",children:[d&&r.jsx(Ee,{currentFormat:B,pageSize:m,onFormatText:L,onPageSizeChange:C,onAddPageBreak:H}),r.jsxs("div",{className:"editor-container",children:[s&&r.jsx(ve,{editorView:null,isCollapsed:E,onToggle:()=>M(x=>!x),wordCount:te,pageCount:ne}),r.jsx("div",{className:"editor-viewport continuous-scroll",ref:D,onScroll:ee,children:r.jsx(Pe,{content:O,dimensions:T,pageSize:m,pageBoundaries:S,editorRef:w,onInput:P,onClick:()=>w.current?.focus()})}),r.jsx("div",{className:"page-manager-sidebar",children:e?g.cloneElement(e,{pages:S.map((x,t)=>({id:x.id,index:t,size:m})),activePage:y,pageSize:m,onNavigate:j,onAddPage:z,onDeletePage:F,onPageSizeChange:C}):r.jsx(Ae,{pages:S.map((x,t)=>({id:x.id,index:t,size:m})),activePage:y,pageSize:m,onNavigate:j,onAddPage:z,onDeletePage:F,onPageSizeChange:C,continuousMode:!1})})]})]})},Ke={A4:{width:794,height:1123},Letter:{width:816,height:1056},Legal:{width:816,height:1344}};f.ContentEditableEditor=Fe,f.ContinuousPageView=Pe,f.EditorToolbar=Ee,f.PAGE_DIMENSIONS=Ke,f.PageManager=Ae,f.Sidebar=ve,f.addPage=Le,f.addPageBreak=me,f.clearImages=Je,f.deleteImage=Ye,f.deletePage=De,f.documentReducer=He,f.getAllImageKeys=Ve,f.getImage=We,f.initializeDocument=_e,f.logger=Ce,f.removePageBreak=Me,f.resetDocument=ze,f.saveImage=xe,f.setActivePage=V,f.setEditorMode=Ue,f.updateContinuousContent=q,f.updatePageBoundaries=fe,f.updatePageContent=Be,f.updatePageSize=pe,f.updatePages=Oe,f.updateTitle=Ie,f.useContinuousReflow=ke,f.useFormatting=he,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=htmleditor.umd.cjs.map
